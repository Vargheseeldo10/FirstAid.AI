function Y$(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var ua=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function yW(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}),n}var Q$={exports:{}},wy={},J$={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qd=Symbol.for("react.element"),vW=Symbol.for("react.portal"),xW=Symbol.for("react.fragment"),_W=Symbol.for("react.strict_mode"),wW=Symbol.for("react.profiler"),bW=Symbol.for("react.provider"),CW=Symbol.for("react.context"),IW=Symbol.for("react.forward_ref"),kW=Symbol.for("react.suspense"),SW=Symbol.for("react.memo"),TW=Symbol.for("react.lazy"),vT=Symbol.iterator;function EW(t){return t===null||typeof t!="object"?null:(t=vT&&t[vT]||t["@@iterator"],typeof t=="function"?t:null)}var eR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tR=Object.assign,nR={};function wu(t,e,n){this.props=t,this.context=e,this.refs=nR,this.updater=n||eR}wu.prototype.isReactComponent={};wu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};wu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function sR(){}sR.prototype=wu.prototype;function Ib(t,e,n){this.props=t,this.context=e,this.refs=nR,this.updater=n||eR}var kb=Ib.prototype=new sR;kb.constructor=Ib;tR(kb,wu.prototype);kb.isPureReactComponent=!0;var xT=Array.isArray,iR=Object.prototype.hasOwnProperty,Sb={current:null},rR={key:!0,ref:!0,__self:!0,__source:!0};function oR(t,e,n){var s,i={},r=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)iR.call(e,s)&&!rR.hasOwnProperty(s)&&(i[s]=e[s]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)i[s]===void 0&&(i[s]=a[s]);return{$$typeof:qd,type:t,key:r,ref:o,props:i,_owner:Sb.current}}function NW(t,e){return{$$typeof:qd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Tb(t){return typeof t=="object"&&t!==null&&t.$$typeof===qd}function $W(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _T=/\/+/g;function a_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?$W(""+t.key):e.toString(36)}function Em(t,e,n,s,i){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case qd:case vW:o=!0}}if(o)return o=t,i=i(o),t=s===""?"."+a_(o,0):s,xT(i)?(n="",t!=null&&(n=t.replace(_T,"$&/")+"/"),Em(i,e,n,"",function(c){return c})):i!=null&&(Tb(i)&&(i=NW(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(_T,"$&/")+"/")+t)),e.push(i)),1;if(o=0,s=s===""?".":s+":",xT(t))for(var a=0;a<t.length;a++){r=t[a];var l=s+a_(r,a);o+=Em(r,e,n,l,i)}else if(l=EW(t),typeof l=="function")for(t=l.call(t),a=0;!(r=t.next()).done;)r=r.value,l=s+a_(r,a++),o+=Em(r,e,n,l,i);else if(r==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Kp(t,e,n){if(t==null)return t;var s=[],i=0;return Em(t,s,"","",function(r){return e.call(n,r,i++)}),s}function RW(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var gs={current:null},Nm={transition:null},AW={ReactCurrentDispatcher:gs,ReactCurrentBatchConfig:Nm,ReactCurrentOwner:Sb};function aR(){throw Error("act(...) is not supported in production builds of React.")}Ye.Children={map:Kp,forEach:function(t,e,n){Kp(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Kp(t,function(){e++}),e},toArray:function(t){return Kp(t,function(e){return e})||[]},only:function(t){if(!Tb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ye.Component=wu;Ye.Fragment=xW;Ye.Profiler=wW;Ye.PureComponent=Ib;Ye.StrictMode=_W;Ye.Suspense=kW;Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AW;Ye.act=aR;Ye.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=tR({},t.props),i=t.key,r=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=Sb.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)iR.call(e,l)&&!rR.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:qd,type:t.type,key:i,ref:r,props:s,_owner:o}};Ye.createContext=function(t){return t={$$typeof:CW,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:bW,_context:t},t.Consumer=t};Ye.createElement=oR;Ye.createFactory=function(t){var e=oR.bind(null,t);return e.type=t,e};Ye.createRef=function(){return{current:null}};Ye.forwardRef=function(t){return{$$typeof:IW,render:t}};Ye.isValidElement=Tb;Ye.lazy=function(t){return{$$typeof:TW,_payload:{_status:-1,_result:t},_init:RW}};Ye.memo=function(t,e){return{$$typeof:SW,type:t,compare:e===void 0?null:e}};Ye.startTransition=function(t){var e=Nm.transition;Nm.transition={};try{t()}finally{Nm.transition=e}};Ye.unstable_act=aR;Ye.useCallback=function(t,e){return gs.current.useCallback(t,e)};Ye.useContext=function(t){return gs.current.useContext(t)};Ye.useDebugValue=function(){};Ye.useDeferredValue=function(t){return gs.current.useDeferredValue(t)};Ye.useEffect=function(t,e){return gs.current.useEffect(t,e)};Ye.useId=function(){return gs.current.useId()};Ye.useImperativeHandle=function(t,e,n){return gs.current.useImperativeHandle(t,e,n)};Ye.useInsertionEffect=function(t,e){return gs.current.useInsertionEffect(t,e)};Ye.useLayoutEffect=function(t,e){return gs.current.useLayoutEffect(t,e)};Ye.useMemo=function(t,e){return gs.current.useMemo(t,e)};Ye.useReducer=function(t,e,n){return gs.current.useReducer(t,e,n)};Ye.useRef=function(t){return gs.current.useRef(t)};Ye.useState=function(t){return gs.current.useState(t)};Ye.useSyncExternalStore=function(t,e,n){return gs.current.useSyncExternalStore(t,e,n)};Ye.useTransition=function(){return gs.current.useTransition()};Ye.version="18.3.1";J$.exports=Ye;var ie=J$.exports;const qm=Cb(ie),DW=Y$({__proto__:null,default:qm},[ie]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PW=ie,OW=Symbol.for("react.element"),LW=Symbol.for("react.fragment"),FW=Object.prototype.hasOwnProperty,MW=PW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zW={key:!0,ref:!0,__self:!0,__source:!0};function lR(t,e,n){var s,i={},r=null,o=null;n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)FW.call(e,s)&&!zW.hasOwnProperty(s)&&(i[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:OW,type:t,key:r,ref:o,props:i,_owner:MW.current}}wy.Fragment=LW;wy.jsx=lR;wy.jsxs=lR;Q$.exports=wy;var A=Q$.exports,cR={exports:{}},Ks={},uR={exports:{}},hR={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(O,q){var V=O.length;O.push(q);e:for(;0<V;){var te=V-1>>>1,ae=O[te];if(0<i(ae,q))O[te]=q,O[V]=ae,V=te;else break e}}function n(O){return O.length===0?null:O[0]}function s(O){if(O.length===0)return null;var q=O[0],V=O.pop();if(V!==q){O[0]=V;e:for(var te=0,ae=O.length,ue=ae>>>1;te<ue;){var he=2*(te+1)-1,le=O[he],ce=he+1,we=O[ce];if(0>i(le,V))ce<ae&&0>i(we,le)?(O[te]=we,O[ce]=V,te=ce):(O[te]=le,O[he]=V,te=he);else if(ce<ae&&0>i(we,V))O[te]=we,O[ce]=V,te=ce;else break e}}return q}function i(O,q){var V=O.sortIndex-q.sortIndex;return V!==0?V:O.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,d=null,f=3,m=!1,g=!1,v=!1,_=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(O){for(var q=n(c);q!==null;){if(q.callback===null)s(c);else if(q.startTime<=O)s(c),q.sortIndex=q.expirationTime,e(l,q);else break;q=n(c)}}function I(O){if(v=!1,C(O),!g)if(n(l)!==null)g=!0,Y(S);else{var q=n(c);q!==null&&oe(I,q.startTime-O)}}function S(O,q){g=!1,v&&(v=!1,x($),$=-1),m=!0;var V=f;try{for(C(q),d=n(l);d!==null&&(!(d.expirationTime>q)||O&&!z());){var te=d.callback;if(typeof te=="function"){d.callback=null,f=d.priorityLevel;var ae=te(d.expirationTime<=q);q=t.unstable_now(),typeof ae=="function"?d.callback=ae:d===n(l)&&s(l),C(q)}else s(l);d=n(l)}if(d!==null)var ue=!0;else{var he=n(c);he!==null&&oe(I,he.startTime-q),ue=!1}return ue}finally{d=null,f=V,m=!1}}var T=!1,E=null,$=-1,D=5,P=-1;function z(){return!(t.unstable_now()-P<D)}function H(){if(E!==null){var O=t.unstable_now();P=O;var q=!0;try{q=E(!0,O)}finally{q?Q():(T=!1,E=null)}}else T=!1}var Q;if(typeof w=="function")Q=function(){w(H)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,J=Z.port2;Z.port1.onmessage=H,Q=function(){J.postMessage(null)}}else Q=function(){_(H,0)};function Y(O){E=O,T||(T=!0,Q())}function oe(O,q){$=_(function(){O(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,Y(S))},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<O?Math.floor(1e3/O):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(O){switch(f){case 1:case 2:case 3:var q=3;break;default:q=f}var V=f;f=q;try{return O()}finally{f=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(O,q){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var V=f;f=O;try{return q()}finally{f=V}},t.unstable_scheduleCallback=function(O,q,V){var te=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?te+V:te):V=te,O){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=V+ae,O={id:h++,callback:q,priorityLevel:O,startTime:V,expirationTime:ae,sortIndex:-1},V>te?(O.sortIndex=V,e(c,O),n(l)===null&&O===n(c)&&(v?(x($),$=-1):v=!0,oe(I,V-te))):(O.sortIndex=ae,e(l,O),g||m||(g=!0,Y(S))),O},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(O){var q=f;return function(){var V=f;f=q;try{return O.apply(this,arguments)}finally{f=V}}}})(hR);uR.exports=hR;var BW=uR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UW=ie,Hs=BW;function me(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dR=new Set,sd={};function Fl(t,e){Qc(t,e),Qc(t+"Capture",e)}function Qc(t,e){for(sd[t]=e,t=0;t<e.length;t++)dR.add(e[t])}var eo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gw=Object.prototype.hasOwnProperty,WW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wT={},bT={};function VW(t){return gw.call(bT,t)?!0:gw.call(wT,t)?!1:WW.test(t)?bT[t]=!0:(wT[t]=!0,!1)}function GW(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function jW(t,e,n,s){if(e===null||typeof e>"u"||GW(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ys(t,e,n,s,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Un={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Un[t]=new ys(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Un[e]=new ys(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Un[t]=new ys(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Un[t]=new ys(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Un[t]=new ys(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Un[t]=new ys(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Un[t]=new ys(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Un[t]=new ys(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Un[t]=new ys(t,5,!1,t.toLowerCase(),null,!1,!1)});var Eb=/[\-:]([a-z])/g;function Nb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Eb,Nb);Un[e]=new ys(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Eb,Nb);Un[e]=new ys(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Eb,Nb);Un[e]=new ys(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Un[t]=new ys(t,1,!1,t.toLowerCase(),null,!1,!1)});Un.xlinkHref=new ys("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Un[t]=new ys(t,1,!1,t.toLowerCase(),null,!0,!0)});function $b(t,e,n,s){var i=Un.hasOwnProperty(e)?Un[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(jW(e,n,i,s)&&(n=null),s||i===null?VW(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,s=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var fo=UW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xp=Symbol.for("react.element"),wc=Symbol.for("react.portal"),bc=Symbol.for("react.fragment"),Rb=Symbol.for("react.strict_mode"),yw=Symbol.for("react.profiler"),fR=Symbol.for("react.provider"),pR=Symbol.for("react.context"),Ab=Symbol.for("react.forward_ref"),vw=Symbol.for("react.suspense"),xw=Symbol.for("react.suspense_list"),Db=Symbol.for("react.memo"),bo=Symbol.for("react.lazy"),mR=Symbol.for("react.offscreen"),CT=Symbol.iterator;function ch(t){return t===null||typeof t!="object"?null:(t=CT&&t[CT]||t["@@iterator"],typeof t=="function"?t:null)}var jt=Object.assign,l_;function Sh(t){if(l_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);l_=e&&e[1]||""}return`
`+l_+t}var c_=!1;function u_(t,e){if(!t||c_)return"";c_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){s=c}t.call(e.prototype)}else{try{throw Error()}catch(c){s=c}t()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),r=s.stack.split(`
`),o=i.length-1,a=r.length-1;1<=o&&0<=a&&i[o]!==r[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==r[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==r[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{c_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Sh(t):""}function HW(t){switch(t.tag){case 5:return Sh(t.type);case 16:return Sh("Lazy");case 13:return Sh("Suspense");case 19:return Sh("SuspenseList");case 0:case 2:case 15:return t=u_(t.type,!1),t;case 11:return t=u_(t.type.render,!1),t;case 1:return t=u_(t.type,!0),t;default:return""}}function _w(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case bc:return"Fragment";case wc:return"Portal";case yw:return"Profiler";case Rb:return"StrictMode";case vw:return"Suspense";case xw:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case pR:return(t.displayName||"Context")+".Consumer";case fR:return(t._context.displayName||"Context")+".Provider";case Ab:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Db:return e=t.displayName||null,e!==null?e:_w(t.type)||"Memo";case bo:e=t._payload,t=t._init;try{return _w(t(e))}catch{}}return null}function qW(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _w(e);case 8:return e===Rb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Jo(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function gR(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function KW(t){var e=gR(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,r.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Zp(t){t._valueTracker||(t._valueTracker=KW(t))}function yR(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=gR(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function Km(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ww(t,e){var n=e.checked;return jt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function IT(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Jo(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function vR(t,e){e=e.checked,e!=null&&$b(t,"checked",e,!1)}function bw(t,e){vR(t,e);var n=Jo(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Cw(t,e.type,n):e.hasOwnProperty("defaultValue")&&Cw(t,e.type,Jo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function kT(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Cw(t,e,n){(e!=="number"||Km(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Th=Array.isArray;function Lc(t,e,n,s){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Jo(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,s&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Iw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return jt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ST(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(me(92));if(Th(n)){if(1<n.length)throw Error(me(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Jo(n)}}function xR(t,e){var n=Jo(e.value),s=Jo(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function TT(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function _R(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function kw(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?_R(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Yp,wR=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Yp=Yp||document.createElement("div"),Yp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Yp.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function id(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Mh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},XW=["Webkit","ms","Moz","O"];Object.keys(Mh).forEach(function(t){XW.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Mh[e]=Mh[t]})});function bR(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Mh.hasOwnProperty(t)&&Mh[t]?(""+e).trim():e+"px"}function CR(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,i=bR(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,i):t[n]=i}}var ZW=jt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sw(t,e){if(e){if(ZW[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function Tw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ew=null;function Pb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Nw=null,Fc=null,Mc=null;function ET(t){if(t=Zd(t)){if(typeof Nw!="function")throw Error(me(280));var e=t.stateNode;e&&(e=Sy(e),Nw(t.stateNode,t.type,e))}}function IR(t){Fc?Mc?Mc.push(t):Mc=[t]:Fc=t}function kR(){if(Fc){var t=Fc,e=Mc;if(Mc=Fc=null,ET(t),e)for(t=0;t<e.length;t++)ET(e[t])}}function SR(t,e){return t(e)}function TR(){}var h_=!1;function ER(t,e,n){if(h_)return t(e,n);h_=!0;try{return SR(t,e,n)}finally{h_=!1,(Fc!==null||Mc!==null)&&(TR(),kR())}}function rd(t,e){var n=t.stateNode;if(n===null)return null;var s=Sy(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(me(231,e,typeof n));return n}var $w=!1;if(eo)try{var uh={};Object.defineProperty(uh,"passive",{get:function(){$w=!0}}),window.addEventListener("test",uh,uh),window.removeEventListener("test",uh,uh)}catch{$w=!1}function YW(t,e,n,s,i,r,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(h){this.onError(h)}}var zh=!1,Xm=null,Zm=!1,Rw=null,QW={onError:function(t){zh=!0,Xm=t}};function JW(t,e,n,s,i,r,o,a,l){zh=!1,Xm=null,YW.apply(QW,arguments)}function eV(t,e,n,s,i,r,o,a,l){if(JW.apply(this,arguments),zh){if(zh){var c=Xm;zh=!1,Xm=null}else throw Error(me(198));Zm||(Zm=!0,Rw=c)}}function Ml(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function NR(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function NT(t){if(Ml(t)!==t)throw Error(me(188))}function tV(t){var e=t.alternate;if(!e){if(e=Ml(t),e===null)throw Error(me(188));return e!==t?null:t}for(var n=t,s=e;;){var i=n.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){n=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===n)return NT(i),t;if(r===s)return NT(i),e;r=r.sibling}throw Error(me(188))}if(n.return!==s.return)n=i,s=r;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o){for(a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o)throw Error(me(189))}}if(n.alternate!==s)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?t:e}function $R(t){return t=tV(t),t!==null?RR(t):null}function RR(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=RR(t);if(e!==null)return e;t=t.sibling}return null}var AR=Hs.unstable_scheduleCallback,$T=Hs.unstable_cancelCallback,nV=Hs.unstable_shouldYield,sV=Hs.unstable_requestPaint,tn=Hs.unstable_now,iV=Hs.unstable_getCurrentPriorityLevel,Ob=Hs.unstable_ImmediatePriority,DR=Hs.unstable_UserBlockingPriority,Ym=Hs.unstable_NormalPriority,rV=Hs.unstable_LowPriority,PR=Hs.unstable_IdlePriority,by=null,yr=null;function oV(t){if(yr&&typeof yr.onCommitFiberRoot=="function")try{yr.onCommitFiberRoot(by,t,void 0,(t.current.flags&128)===128)}catch{}}var Wi=Math.clz32?Math.clz32:cV,aV=Math.log,lV=Math.LN2;function cV(t){return t>>>=0,t===0?32:31-(aV(t)/lV|0)|0}var Qp=64,Jp=4194304;function Eh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Qm(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,i=t.suspendedLanes,r=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?s=Eh(a):(r&=o,r!==0&&(s=Eh(r)))}else o=n&~i,o!==0?s=Eh(o):r!==0&&(s=Eh(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Wi(e),i=1<<n,s|=t[n],e&=~i;return s}function uV(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hV(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,i=t.expirationTimes,r=t.pendingLanes;0<r;){var o=31-Wi(r),a=1<<o,l=i[o];l===-1?(!(a&n)||a&s)&&(i[o]=uV(a,e)):l<=e&&(t.expiredLanes|=a),r&=~a}}function Aw(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function OR(){var t=Qp;return Qp<<=1,!(Qp&4194240)&&(Qp=64),t}function d_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Kd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Wi(e),t[e]=n}function dV(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Wi(n),r=1<<i;e[i]=0,s[i]=-1,t[i]=-1,n&=~r}}function Lb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Wi(n),i=1<<s;i&e|t[s]&e&&(t[s]|=e),n&=~i}}var gt=0;function LR(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var FR,Fb,MR,zR,BR,Dw=!1,em=[],Fo=null,Mo=null,zo=null,od=new Map,ad=new Map,ko=[],fV="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function RT(t,e){switch(t){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Mo=null;break;case"mouseover":case"mouseout":zo=null;break;case"pointerover":case"pointerout":od.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ad.delete(e.pointerId)}}function hh(t,e,n,s,i,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=Zd(e),e!==null&&Fb(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function pV(t,e,n,s,i){switch(e){case"focusin":return Fo=hh(Fo,t,e,n,s,i),!0;case"dragenter":return Mo=hh(Mo,t,e,n,s,i),!0;case"mouseover":return zo=hh(zo,t,e,n,s,i),!0;case"pointerover":var r=i.pointerId;return od.set(r,hh(od.get(r)||null,t,e,n,s,i)),!0;case"gotpointercapture":return r=i.pointerId,ad.set(r,hh(ad.get(r)||null,t,e,n,s,i)),!0}return!1}function UR(t){var e=Ka(t.target);if(e!==null){var n=Ml(e);if(n!==null){if(e=n.tag,e===13){if(e=NR(n),e!==null){t.blockedOn=e,BR(t.priority,function(){MR(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function $m(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Pw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);Ew=s,n.target.dispatchEvent(s),Ew=null}else return e=Zd(n),e!==null&&Fb(e),t.blockedOn=n,!1;e.shift()}return!0}function AT(t,e,n){$m(t)&&n.delete(e)}function mV(){Dw=!1,Fo!==null&&$m(Fo)&&(Fo=null),Mo!==null&&$m(Mo)&&(Mo=null),zo!==null&&$m(zo)&&(zo=null),od.forEach(AT),ad.forEach(AT)}function dh(t,e){t.blockedOn===e&&(t.blockedOn=null,Dw||(Dw=!0,Hs.unstable_scheduleCallback(Hs.unstable_NormalPriority,mV)))}function ld(t){function e(i){return dh(i,t)}if(0<em.length){dh(em[0],t);for(var n=1;n<em.length;n++){var s=em[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Fo!==null&&dh(Fo,t),Mo!==null&&dh(Mo,t),zo!==null&&dh(zo,t),od.forEach(e),ad.forEach(e),n=0;n<ko.length;n++)s=ko[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<ko.length&&(n=ko[0],n.blockedOn===null);)UR(n),n.blockedOn===null&&ko.shift()}var zc=fo.ReactCurrentBatchConfig,Jm=!0;function gV(t,e,n,s){var i=gt,r=zc.transition;zc.transition=null;try{gt=1,Mb(t,e,n,s)}finally{gt=i,zc.transition=r}}function yV(t,e,n,s){var i=gt,r=zc.transition;zc.transition=null;try{gt=4,Mb(t,e,n,s)}finally{gt=i,zc.transition=r}}function Mb(t,e,n,s){if(Jm){var i=Pw(t,e,n,s);if(i===null)b_(t,e,s,eg,n),RT(t,s);else if(pV(i,t,e,n,s))s.stopPropagation();else if(RT(t,s),e&4&&-1<fV.indexOf(t)){for(;i!==null;){var r=Zd(i);if(r!==null&&FR(r),r=Pw(t,e,n,s),r===null&&b_(t,e,s,eg,n),r===i)break;i=r}i!==null&&s.stopPropagation()}else b_(t,e,s,null,n)}}var eg=null;function Pw(t,e,n,s){if(eg=null,t=Pb(s),t=Ka(t),t!==null)if(e=Ml(t),e===null)t=null;else if(n=e.tag,n===13){if(t=NR(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return eg=t,null}function WR(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iV()){case Ob:return 1;case DR:return 4;case Ym:case rV:return 16;case PR:return 536870912;default:return 16}default:return 16}}var Ro=null,zb=null,Rm=null;function VR(){if(Rm)return Rm;var t,e=zb,n=e.length,s,i="value"in Ro?Ro.value:Ro.textContent,r=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===i[r-s];s++);return Rm=i.slice(t,1<s?1-s:void 0)}function Am(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function tm(){return!0}function DT(){return!1}function Xs(t){function e(n,s,i,r,o){this._reactName=n,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(r):r[a]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?tm:DT,this.isPropagationStopped=DT,this}return jt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=tm)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=tm)},persist:function(){},isPersistent:tm}),e}var bu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bb=Xs(bu),Xd=jt({},bu,{view:0,detail:0}),vV=Xs(Xd),f_,p_,fh,Cy=jt({},Xd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ub,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==fh&&(fh&&t.type==="mousemove"?(f_=t.screenX-fh.screenX,p_=t.screenY-fh.screenY):p_=f_=0,fh=t),f_)},movementY:function(t){return"movementY"in t?t.movementY:p_}}),PT=Xs(Cy),xV=jt({},Cy,{dataTransfer:0}),_V=Xs(xV),wV=jt({},Xd,{relatedTarget:0}),m_=Xs(wV),bV=jt({},bu,{animationName:0,elapsedTime:0,pseudoElement:0}),CV=Xs(bV),IV=jt({},bu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),kV=Xs(IV),SV=jt({},bu,{data:0}),OT=Xs(SV),TV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},EV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $V(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=NV[t])?!!e[t]:!1}function Ub(){return $V}var RV=jt({},Xd,{key:function(t){if(t.key){var e=TV[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Am(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?EV[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ub,charCode:function(t){return t.type==="keypress"?Am(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Am(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),AV=Xs(RV),DV=jt({},Cy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),LT=Xs(DV),PV=jt({},Xd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ub}),OV=Xs(PV),LV=jt({},bu,{propertyName:0,elapsedTime:0,pseudoElement:0}),FV=Xs(LV),MV=jt({},Cy,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zV=Xs(MV),BV=[9,13,27,32],Wb=eo&&"CompositionEvent"in window,Bh=null;eo&&"documentMode"in document&&(Bh=document.documentMode);var UV=eo&&"TextEvent"in window&&!Bh,GR=eo&&(!Wb||Bh&&8<Bh&&11>=Bh),FT=" ",MT=!1;function jR(t,e){switch(t){case"keyup":return BV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function HR(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Cc=!1;function WV(t,e){switch(t){case"compositionend":return HR(e);case"keypress":return e.which!==32?null:(MT=!0,FT);case"textInput":return t=e.data,t===FT&&MT?null:t;default:return null}}function VV(t,e){if(Cc)return t==="compositionend"||!Wb&&jR(t,e)?(t=VR(),Rm=zb=Ro=null,Cc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return GR&&e.locale!=="ko"?null:e.data;default:return null}}var GV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!GV[t.type]:e==="textarea"}function qR(t,e,n,s){IR(s),e=tg(e,"onChange"),0<e.length&&(n=new Bb("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Uh=null,cd=null;function jV(t){iA(t,0)}function Iy(t){var e=Sc(t);if(yR(e))return t}function HV(t,e){if(t==="change")return e}var KR=!1;if(eo){var g_;if(eo){var y_="oninput"in document;if(!y_){var BT=document.createElement("div");BT.setAttribute("oninput","return;"),y_=typeof BT.oninput=="function"}g_=y_}else g_=!1;KR=g_&&(!document.documentMode||9<document.documentMode)}function UT(){Uh&&(Uh.detachEvent("onpropertychange",XR),cd=Uh=null)}function XR(t){if(t.propertyName==="value"&&Iy(cd)){var e=[];qR(e,cd,t,Pb(t)),ER(jV,e)}}function qV(t,e,n){t==="focusin"?(UT(),Uh=e,cd=n,Uh.attachEvent("onpropertychange",XR)):t==="focusout"&&UT()}function KV(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Iy(cd)}function XV(t,e){if(t==="click")return Iy(e)}function ZV(t,e){if(t==="input"||t==="change")return Iy(e)}function YV(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ki=typeof Object.is=="function"?Object.is:YV;function ud(t,e){if(Ki(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var i=n[s];if(!gw.call(e,i)||!Ki(t[i],e[i]))return!1}return!0}function WT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function VT(t,e){var n=WT(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=WT(n)}}function ZR(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ZR(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function YR(){for(var t=window,e=Km();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Km(t.document)}return e}function Vb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function QV(t){var e=YR(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ZR(n.ownerDocument.documentElement,n)){if(s!==null&&Vb(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!t.extend&&r>s&&(i=s,s=r,r=i),i=VT(n,r);var o=VT(n,s);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),r>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var JV=eo&&"documentMode"in document&&11>=document.documentMode,Ic=null,Ow=null,Wh=null,Lw=!1;function GT(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lw||Ic==null||Ic!==Km(s)||(s=Ic,"selectionStart"in s&&Vb(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Wh&&ud(Wh,s)||(Wh=s,s=tg(Ow,"onSelect"),0<s.length&&(e=new Bb("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Ic)))}function nm(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var kc={animationend:nm("Animation","AnimationEnd"),animationiteration:nm("Animation","AnimationIteration"),animationstart:nm("Animation","AnimationStart"),transitionend:nm("Transition","TransitionEnd")},v_={},QR={};eo&&(QR=document.createElement("div").style,"AnimationEvent"in window||(delete kc.animationend.animation,delete kc.animationiteration.animation,delete kc.animationstart.animation),"TransitionEvent"in window||delete kc.transitionend.transition);function ky(t){if(v_[t])return v_[t];if(!kc[t])return t;var e=kc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in QR)return v_[t]=e[n];return t}var JR=ky("animationend"),eA=ky("animationiteration"),tA=ky("animationstart"),nA=ky("transitionend"),sA=new Map,jT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ha(t,e){sA.set(t,e),Fl(e,[t])}for(var x_=0;x_<jT.length;x_++){var __=jT[x_],eG=__.toLowerCase(),tG=__[0].toUpperCase()+__.slice(1);ha(eG,"on"+tG)}ha(JR,"onAnimationEnd");ha(eA,"onAnimationIteration");ha(tA,"onAnimationStart");ha("dblclick","onDoubleClick");ha("focusin","onFocus");ha("focusout","onBlur");ha(nA,"onTransitionEnd");Qc("onMouseEnter",["mouseout","mouseover"]);Qc("onMouseLeave",["mouseout","mouseover"]);Qc("onPointerEnter",["pointerout","pointerover"]);Qc("onPointerLeave",["pointerout","pointerover"]);Fl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Fl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Fl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Fl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Fl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Fl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nh));function HT(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,eV(s,e,void 0,t),t.currentTarget=null}function iA(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==r&&i.isPropagationStopped())break e;HT(i,a,c),r=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==r&&i.isPropagationStopped())break e;HT(i,a,c),r=l}}}if(Zm)throw t=Rw,Zm=!1,Rw=null,t}function At(t,e){var n=e[Uw];n===void 0&&(n=e[Uw]=new Set);var s=t+"__bubble";n.has(s)||(rA(e,t,2,!1),n.add(s))}function w_(t,e,n){var s=0;e&&(s|=4),rA(n,t,s,e)}var sm="_reactListening"+Math.random().toString(36).slice(2);function hd(t){if(!t[sm]){t[sm]=!0,dR.forEach(function(n){n!=="selectionchange"&&(nG.has(n)||w_(n,!1,t),w_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[sm]||(e[sm]=!0,w_("selectionchange",!1,e))}}function rA(t,e,n,s){switch(WR(e)){case 1:var i=gV;break;case 4:i=yV;break;default:i=Mb}n=i.bind(null,e,n,t),i=void 0,!$w||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function b_(t,e,n,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Ka(a),o===null)return;if(l=o.tag,l===5||l===6){s=r=o;continue e}a=a.parentNode}}s=s.return}ER(function(){var c=r,h=Pb(n),d=[];e:{var f=sA.get(t);if(f!==void 0){var m=Bb,g=t;switch(t){case"keypress":if(Am(n)===0)break e;case"keydown":case"keyup":m=AV;break;case"focusin":g="focus",m=m_;break;case"focusout":g="blur",m=m_;break;case"beforeblur":case"afterblur":m=m_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=PT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=_V;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=OV;break;case JR:case eA:case tA:m=CV;break;case nA:m=FV;break;case"scroll":m=vV;break;case"wheel":m=zV;break;case"copy":case"cut":case"paste":m=kV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=LT}var v=(e&4)!==0,_=!v&&t==="scroll",x=v?f!==null?f+"Capture":null:f;v=[];for(var w=c,C;w!==null;){C=w;var I=C.stateNode;if(C.tag===5&&I!==null&&(C=I,x!==null&&(I=rd(w,x),I!=null&&v.push(dd(w,I,C)))),_)break;w=w.return}0<v.length&&(f=new m(f,g,null,n,h),d.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==Ew&&(g=n.relatedTarget||n.fromElement)&&(Ka(g)||g[to]))break e;if((m||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=n.relatedTarget||n.toElement,m=c,g=g?Ka(g):null,g!==null&&(_=Ml(g),g!==_||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(v=PT,I="onMouseLeave",x="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(v=LT,I="onPointerLeave",x="onPointerEnter",w="pointer"),_=m==null?f:Sc(m),C=g==null?f:Sc(g),f=new v(I,w+"leave",m,n,h),f.target=_,f.relatedTarget=C,I=null,Ka(h)===c&&(v=new v(x,w+"enter",g,n,h),v.target=C,v.relatedTarget=_,I=v),_=I,m&&g)t:{for(v=m,x=g,w=0,C=v;C;C=pc(C))w++;for(C=0,I=x;I;I=pc(I))C++;for(;0<w-C;)v=pc(v),w--;for(;0<C-w;)x=pc(x),C--;for(;w--;){if(v===x||x!==null&&v===x.alternate)break t;v=pc(v),x=pc(x)}v=null}else v=null;m!==null&&qT(d,f,m,v,!1),g!==null&&_!==null&&qT(d,_,g,v,!0)}}e:{if(f=c?Sc(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var S=HV;else if(zT(f))if(KR)S=ZV;else{S=KV;var T=qV}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=XV);if(S&&(S=S(t,c))){qR(d,S,n,h);break e}T&&T(t,f,c),t==="focusout"&&(T=f._wrapperState)&&T.controlled&&f.type==="number"&&Cw(f,"number",f.value)}switch(T=c?Sc(c):window,t){case"focusin":(zT(T)||T.contentEditable==="true")&&(Ic=T,Ow=c,Wh=null);break;case"focusout":Wh=Ow=Ic=null;break;case"mousedown":Lw=!0;break;case"contextmenu":case"mouseup":case"dragend":Lw=!1,GT(d,n,h);break;case"selectionchange":if(JV)break;case"keydown":case"keyup":GT(d,n,h)}var E;if(Wb)e:{switch(t){case"compositionstart":var $="onCompositionStart";break e;case"compositionend":$="onCompositionEnd";break e;case"compositionupdate":$="onCompositionUpdate";break e}$=void 0}else Cc?jR(t,n)&&($="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&($="onCompositionStart");$&&(GR&&n.locale!=="ko"&&(Cc||$!=="onCompositionStart"?$==="onCompositionEnd"&&Cc&&(E=VR()):(Ro=h,zb="value"in Ro?Ro.value:Ro.textContent,Cc=!0)),T=tg(c,$),0<T.length&&($=new OT($,t,null,n,h),d.push({event:$,listeners:T}),E?$.data=E:(E=HR(n),E!==null&&($.data=E)))),(E=UV?WV(t,n):VV(t,n))&&(c=tg(c,"onBeforeInput"),0<c.length&&(h=new OT("onBeforeInput","beforeinput",null,n,h),d.push({event:h,listeners:c}),h.data=E))}iA(d,e)})}function dd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function tg(t,e){for(var n=e+"Capture",s=[];t!==null;){var i=t,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=rd(t,n),r!=null&&s.unshift(dd(t,r,i)),r=rd(t,e),r!=null&&s.push(dd(t,r,i))),t=t.return}return s}function pc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function qT(t,e,n,s,i){for(var r=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,i?(l=rd(n,r),l!=null&&o.unshift(dd(n,l,a))):i||(l=rd(n,r),l!=null&&o.push(dd(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var sG=/\r\n?/g,iG=/\u0000|\uFFFD/g;function KT(t){return(typeof t=="string"?t:""+t).replace(sG,`
`).replace(iG,"")}function im(t,e,n){if(e=KT(e),KT(t)!==e&&n)throw Error(me(425))}function ng(){}var Fw=null,Mw=null;function zw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Bw=typeof setTimeout=="function"?setTimeout:void 0,rG=typeof clearTimeout=="function"?clearTimeout:void 0,XT=typeof Promise=="function"?Promise:void 0,oG=typeof queueMicrotask=="function"?queueMicrotask:typeof XT<"u"?function(t){return XT.resolve(null).then(t).catch(aG)}:Bw;function aG(t){setTimeout(function(){throw t})}function C_(t,e){var n=e,s=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(s===0){t.removeChild(i),ld(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=i}while(n);ld(e)}function Bo(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ZT(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Cu=Math.random().toString(36).slice(2),pr="__reactFiber$"+Cu,fd="__reactProps$"+Cu,to="__reactContainer$"+Cu,Uw="__reactEvents$"+Cu,lG="__reactListeners$"+Cu,cG="__reactHandles$"+Cu;function Ka(t){var e=t[pr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[to]||n[pr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=ZT(t);t!==null;){if(n=t[pr])return n;t=ZT(t)}return e}t=n,n=t.parentNode}return null}function Zd(t){return t=t[pr]||t[to],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Sc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(me(33))}function Sy(t){return t[fd]||null}var Ww=[],Tc=-1;function da(t){return{current:t}}function Pt(t){0>Tc||(t.current=Ww[Tc],Ww[Tc]=null,Tc--)}function Tt(t,e){Tc++,Ww[Tc]=t.current,t.current=e}var ea={},ss=da(ea),Es=da(!1),cl=ea;function Jc(t,e){var n=t.type.contextTypes;if(!n)return ea;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in n)i[r]=e[r];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Ns(t){return t=t.childContextTypes,t!=null}function sg(){Pt(Es),Pt(ss)}function YT(t,e,n){if(ss.current!==ea)throw Error(me(168));Tt(ss,e),Tt(Es,n)}function oA(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(me(108,qW(t)||"Unknown",i));return jt({},n,s)}function ig(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ea,cl=ss.current,Tt(ss,t),Tt(Es,Es.current),!0}function QT(t,e,n){var s=t.stateNode;if(!s)throw Error(me(169));n?(t=oA(t,e,cl),s.__reactInternalMemoizedMergedChildContext=t,Pt(Es),Pt(ss),Tt(ss,t)):Pt(Es),Tt(Es,n)}var Ur=null,Ty=!1,I_=!1;function aA(t){Ur===null?Ur=[t]:Ur.push(t)}function uG(t){Ty=!0,aA(t)}function fa(){if(!I_&&Ur!==null){I_=!0;var t=0,e=gt;try{var n=Ur;for(gt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Ur=null,Ty=!1}catch(i){throw Ur!==null&&(Ur=Ur.slice(t+1)),AR(Ob,fa),i}finally{gt=e,I_=!1}}return null}var Ec=[],Nc=0,rg=null,og=0,oi=[],ai=0,ul=null,Gr=1,jr="";function Ma(t,e){Ec[Nc++]=og,Ec[Nc++]=rg,rg=t,og=e}function lA(t,e,n){oi[ai++]=Gr,oi[ai++]=jr,oi[ai++]=ul,ul=t;var s=Gr;t=jr;var i=32-Wi(s)-1;s&=~(1<<i),n+=1;var r=32-Wi(e)+i;if(30<r){var o=i-i%5;r=(s&(1<<o)-1).toString(32),s>>=o,i-=o,Gr=1<<32-Wi(e)+i|n<<i|s,jr=r+t}else Gr=1<<r|n<<i|s,jr=t}function Gb(t){t.return!==null&&(Ma(t,1),lA(t,1,0))}function jb(t){for(;t===rg;)rg=Ec[--Nc],Ec[Nc]=null,og=Ec[--Nc],Ec[Nc]=null;for(;t===ul;)ul=oi[--ai],oi[ai]=null,jr=oi[--ai],oi[ai]=null,Gr=oi[--ai],oi[ai]=null}var Vs=null,Us=null,Ft=!1,Oi=null;function cA(t,e){var n=ci(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function JT(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Vs=t,Us=Bo(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Vs=t,Us=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ul!==null?{id:Gr,overflow:jr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ci(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Vs=t,Us=null,!0):!1;default:return!1}}function Vw(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Gw(t){if(Ft){var e=Us;if(e){var n=e;if(!JT(t,e)){if(Vw(t))throw Error(me(418));e=Bo(n.nextSibling);var s=Vs;e&&JT(t,e)?cA(s,n):(t.flags=t.flags&-4097|2,Ft=!1,Vs=t)}}else{if(Vw(t))throw Error(me(418));t.flags=t.flags&-4097|2,Ft=!1,Vs=t}}}function eE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Vs=t}function rm(t){if(t!==Vs)return!1;if(!Ft)return eE(t),Ft=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!zw(t.type,t.memoizedProps)),e&&(e=Us)){if(Vw(t))throw uA(),Error(me(418));for(;e;)cA(t,e),e=Bo(e.nextSibling)}if(eE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(me(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Us=Bo(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Us=null}}else Us=Vs?Bo(t.stateNode.nextSibling):null;return!0}function uA(){for(var t=Us;t;)t=Bo(t.nextSibling)}function eu(){Us=Vs=null,Ft=!1}function Hb(t){Oi===null?Oi=[t]:Oi.push(t)}var hG=fo.ReactCurrentBatchConfig;function ph(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var s=n.stateNode}if(!s)throw Error(me(147,t));var i=s,r=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var a=i.refs;o===null?delete a[r]:a[r]=o},e._stringRef=r,e)}if(typeof t!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,t))}return t}function om(t,e){throw t=Object.prototype.toString.call(e),Error(me(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function tE(t){var e=t._init;return e(t._payload)}function hA(t){function e(x,w){if(t){var C=x.deletions;C===null?(x.deletions=[w],x.flags|=16):C.push(w)}}function n(x,w){if(!t)return null;for(;w!==null;)e(x,w),w=w.sibling;return null}function s(x,w){for(x=new Map;w!==null;)w.key!==null?x.set(w.key,w):x.set(w.index,w),w=w.sibling;return x}function i(x,w){return x=Go(x,w),x.index=0,x.sibling=null,x}function r(x,w,C){return x.index=C,t?(C=x.alternate,C!==null?(C=C.index,C<w?(x.flags|=2,w):C):(x.flags|=2,w)):(x.flags|=1048576,w)}function o(x){return t&&x.alternate===null&&(x.flags|=2),x}function a(x,w,C,I){return w===null||w.tag!==6?(w=R_(C,x.mode,I),w.return=x,w):(w=i(w,C),w.return=x,w)}function l(x,w,C,I){var S=C.type;return S===bc?h(x,w,C.props.children,I,C.key):w!==null&&(w.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===bo&&tE(S)===w.type)?(I=i(w,C.props),I.ref=ph(x,w,C),I.return=x,I):(I=zm(C.type,C.key,C.props,null,x.mode,I),I.ref=ph(x,w,C),I.return=x,I)}function c(x,w,C,I){return w===null||w.tag!==4||w.stateNode.containerInfo!==C.containerInfo||w.stateNode.implementation!==C.implementation?(w=A_(C,x.mode,I),w.return=x,w):(w=i(w,C.children||[]),w.return=x,w)}function h(x,w,C,I,S){return w===null||w.tag!==7?(w=il(C,x.mode,I,S),w.return=x,w):(w=i(w,C),w.return=x,w)}function d(x,w,C){if(typeof w=="string"&&w!==""||typeof w=="number")return w=R_(""+w,x.mode,C),w.return=x,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Xp:return C=zm(w.type,w.key,w.props,null,x.mode,C),C.ref=ph(x,null,w),C.return=x,C;case wc:return w=A_(w,x.mode,C),w.return=x,w;case bo:var I=w._init;return d(x,I(w._payload),C)}if(Th(w)||ch(w))return w=il(w,x.mode,C,null),w.return=x,w;om(x,w)}return null}function f(x,w,C,I){var S=w!==null?w.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return S!==null?null:a(x,w,""+C,I);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Xp:return C.key===S?l(x,w,C,I):null;case wc:return C.key===S?c(x,w,C,I):null;case bo:return S=C._init,f(x,w,S(C._payload),I)}if(Th(C)||ch(C))return S!==null?null:h(x,w,C,I,null);om(x,C)}return null}function m(x,w,C,I,S){if(typeof I=="string"&&I!==""||typeof I=="number")return x=x.get(C)||null,a(w,x,""+I,S);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Xp:return x=x.get(I.key===null?C:I.key)||null,l(w,x,I,S);case wc:return x=x.get(I.key===null?C:I.key)||null,c(w,x,I,S);case bo:var T=I._init;return m(x,w,C,T(I._payload),S)}if(Th(I)||ch(I))return x=x.get(C)||null,h(w,x,I,S,null);om(w,I)}return null}function g(x,w,C,I){for(var S=null,T=null,E=w,$=w=0,D=null;E!==null&&$<C.length;$++){E.index>$?(D=E,E=null):D=E.sibling;var P=f(x,E,C[$],I);if(P===null){E===null&&(E=D);break}t&&E&&P.alternate===null&&e(x,E),w=r(P,w,$),T===null?S=P:T.sibling=P,T=P,E=D}if($===C.length)return n(x,E),Ft&&Ma(x,$),S;if(E===null){for(;$<C.length;$++)E=d(x,C[$],I),E!==null&&(w=r(E,w,$),T===null?S=E:T.sibling=E,T=E);return Ft&&Ma(x,$),S}for(E=s(x,E);$<C.length;$++)D=m(E,x,$,C[$],I),D!==null&&(t&&D.alternate!==null&&E.delete(D.key===null?$:D.key),w=r(D,w,$),T===null?S=D:T.sibling=D,T=D);return t&&E.forEach(function(z){return e(x,z)}),Ft&&Ma(x,$),S}function v(x,w,C,I){var S=ch(C);if(typeof S!="function")throw Error(me(150));if(C=S.call(C),C==null)throw Error(me(151));for(var T=S=null,E=w,$=w=0,D=null,P=C.next();E!==null&&!P.done;$++,P=C.next()){E.index>$?(D=E,E=null):D=E.sibling;var z=f(x,E,P.value,I);if(z===null){E===null&&(E=D);break}t&&E&&z.alternate===null&&e(x,E),w=r(z,w,$),T===null?S=z:T.sibling=z,T=z,E=D}if(P.done)return n(x,E),Ft&&Ma(x,$),S;if(E===null){for(;!P.done;$++,P=C.next())P=d(x,P.value,I),P!==null&&(w=r(P,w,$),T===null?S=P:T.sibling=P,T=P);return Ft&&Ma(x,$),S}for(E=s(x,E);!P.done;$++,P=C.next())P=m(E,x,$,P.value,I),P!==null&&(t&&P.alternate!==null&&E.delete(P.key===null?$:P.key),w=r(P,w,$),T===null?S=P:T.sibling=P,T=P);return t&&E.forEach(function(H){return e(x,H)}),Ft&&Ma(x,$),S}function _(x,w,C,I){if(typeof C=="object"&&C!==null&&C.type===bc&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case Xp:e:{for(var S=C.key,T=w;T!==null;){if(T.key===S){if(S=C.type,S===bc){if(T.tag===7){n(x,T.sibling),w=i(T,C.props.children),w.return=x,x=w;break e}}else if(T.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===bo&&tE(S)===T.type){n(x,T.sibling),w=i(T,C.props),w.ref=ph(x,T,C),w.return=x,x=w;break e}n(x,T);break}else e(x,T);T=T.sibling}C.type===bc?(w=il(C.props.children,x.mode,I,C.key),w.return=x,x=w):(I=zm(C.type,C.key,C.props,null,x.mode,I),I.ref=ph(x,w,C),I.return=x,x=I)}return o(x);case wc:e:{for(T=C.key;w!==null;){if(w.key===T)if(w.tag===4&&w.stateNode.containerInfo===C.containerInfo&&w.stateNode.implementation===C.implementation){n(x,w.sibling),w=i(w,C.children||[]),w.return=x,x=w;break e}else{n(x,w);break}else e(x,w);w=w.sibling}w=A_(C,x.mode,I),w.return=x,x=w}return o(x);case bo:return T=C._init,_(x,w,T(C._payload),I)}if(Th(C))return g(x,w,C,I);if(ch(C))return v(x,w,C,I);om(x,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,w!==null&&w.tag===6?(n(x,w.sibling),w=i(w,C),w.return=x,x=w):(n(x,w),w=R_(C,x.mode,I),w.return=x,x=w),o(x)):n(x,w)}return _}var tu=hA(!0),dA=hA(!1),ag=da(null),lg=null,$c=null,qb=null;function Kb(){qb=$c=lg=null}function Xb(t){var e=ag.current;Pt(ag),t._currentValue=e}function jw(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Bc(t,e){lg=t,qb=$c=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Cs=!0),t.firstContext=null)}function yi(t){var e=t._currentValue;if(qb!==t)if(t={context:t,memoizedValue:e,next:null},$c===null){if(lg===null)throw Error(me(308));$c=t,lg.dependencies={lanes:0,firstContext:t}}else $c=$c.next=t;return e}var Xa=null;function Zb(t){Xa===null?Xa=[t]:Xa.push(t)}function fA(t,e,n,s){var i=e.interleaved;return i===null?(n.next=n,Zb(e)):(n.next=i.next,i.next=n),e.interleaved=n,no(t,s)}function no(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Co=!1;function Yb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pA(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Yr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Uo(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,it&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,no(t,n)}return i=s.interleaved,i===null?(e.next=e,Zb(s)):(e.next=i.next,i.next=e),s.interleaved=e,no(t,n)}function Dm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,Lb(t,n)}}function nE(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var i=null,r=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};r===null?i=r=o:r=r.next=o,n=n.next}while(n!==null);r===null?i=r=e:r=r.next=e}else i=r=e;n={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function cg(t,e,n,s){var i=t.updateQueue;Co=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?r=c:o.next=c,o=l;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(r!==null){var d=i.baseState;o=0,h=c=l=null,a=r;do{var f=a.lane,m=a.eventTime;if((s&f)===f){h!==null&&(h=h.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,v=a;switch(f=e,m=n,v.tag){case 1:if(g=v.payload,typeof g=="function"){d=g.call(m,d,f);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=v.payload,f=typeof g=="function"?g.call(m,d,f):g,f==null)break e;d=jt({},d,f);break e;case 2:Co=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=m,l=d):h=h.next=m,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(h===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);dl|=o,t.lanes=o,t.memoizedState=d}}function sE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],i=s.callback;if(i!==null){if(s.callback=null,s=n,typeof i!="function")throw Error(me(191,i));i.call(s)}}}var Yd={},vr=da(Yd),pd=da(Yd),md=da(Yd);function Za(t){if(t===Yd)throw Error(me(174));return t}function Qb(t,e){switch(Tt(md,e),Tt(pd,t),Tt(vr,Yd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:kw(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=kw(e,t)}Pt(vr),Tt(vr,e)}function nu(){Pt(vr),Pt(pd),Pt(md)}function mA(t){Za(md.current);var e=Za(vr.current),n=kw(e,t.type);e!==n&&(Tt(pd,t),Tt(vr,n))}function Jb(t){pd.current===t&&(Pt(vr),Pt(pd))}var Wt=da(0);function ug(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var k_=[];function e1(){for(var t=0;t<k_.length;t++)k_[t]._workInProgressVersionPrimary=null;k_.length=0}var Pm=fo.ReactCurrentDispatcher,S_=fo.ReactCurrentBatchConfig,hl=0,Gt=null,vn=null,Tn=null,hg=!1,Vh=!1,gd=0,dG=0;function Xn(){throw Error(me(321))}function t1(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ki(t[n],e[n]))return!1;return!0}function n1(t,e,n,s,i,r){if(hl=r,Gt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Pm.current=t===null||t.memoizedState===null?gG:yG,t=n(s,i),Vh){r=0;do{if(Vh=!1,gd=0,25<=r)throw Error(me(301));r+=1,Tn=vn=null,e.updateQueue=null,Pm.current=vG,t=n(s,i)}while(Vh)}if(Pm.current=dg,e=vn!==null&&vn.next!==null,hl=0,Tn=vn=Gt=null,hg=!1,e)throw Error(me(300));return t}function s1(){var t=gd!==0;return gd=0,t}function lr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tn===null?Gt.memoizedState=Tn=t:Tn=Tn.next=t,Tn}function vi(){if(vn===null){var t=Gt.alternate;t=t!==null?t.memoizedState:null}else t=vn.next;var e=Tn===null?Gt.memoizedState:Tn.next;if(e!==null)Tn=e,vn=t;else{if(t===null)throw Error(me(310));vn=t,t={memoizedState:vn.memoizedState,baseState:vn.baseState,baseQueue:vn.baseQueue,queue:vn.queue,next:null},Tn===null?Gt.memoizedState=Tn=t:Tn=Tn.next=t}return Tn}function yd(t,e){return typeof e=="function"?e(t):e}function T_(t){var e=vi(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var s=vn,i=s.baseQueue,r=n.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}s.baseQueue=i=r,n.pending=null}if(i!==null){r=i.next,s=s.baseState;var a=o=null,l=null,c=r;do{var h=c.lane;if((hl&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:t(s,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=s):l=l.next=d,Gt.lanes|=h,dl|=h}c=c.next}while(c!==null&&c!==r);l===null?o=s:l.next=a,Ki(s,e.memoizedState)||(Cs=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){i=t;do r=i.lane,Gt.lanes|=r,dl|=r,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function E_(t){var e=vi(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var s=n.dispatch,i=n.pending,r=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do r=t(r,o.action),o=o.next;while(o!==i);Ki(r,e.memoizedState)||(Cs=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),n.lastRenderedState=r}return[r,s]}function gA(){}function yA(t,e){var n=Gt,s=vi(),i=e(),r=!Ki(s.memoizedState,i);if(r&&(s.memoizedState=i,Cs=!0),s=s.queue,i1(_A.bind(null,n,s,t),[t]),s.getSnapshot!==e||r||Tn!==null&&Tn.memoizedState.tag&1){if(n.flags|=2048,vd(9,xA.bind(null,n,s,i,e),void 0,null),Rn===null)throw Error(me(349));hl&30||vA(n,e,i)}return i}function vA(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Gt.updateQueue,e===null?(e={lastEffect:null,stores:null},Gt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function xA(t,e,n,s){e.value=n,e.getSnapshot=s,wA(e)&&bA(t)}function _A(t,e,n){return n(function(){wA(e)&&bA(t)})}function wA(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ki(t,n)}catch{return!0}}function bA(t){var e=no(t,1);e!==null&&Vi(e,t,1,-1)}function iE(t){var e=lr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yd,lastRenderedState:t},e.queue=t,t=t.dispatch=mG.bind(null,Gt,t),[e.memoizedState,t]}function vd(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Gt.updateQueue,e===null?(e={lastEffect:null,stores:null},Gt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function CA(){return vi().memoizedState}function Om(t,e,n,s){var i=lr();Gt.flags|=t,i.memoizedState=vd(1|e,n,void 0,s===void 0?null:s)}function Ey(t,e,n,s){var i=vi();s=s===void 0?null:s;var r=void 0;if(vn!==null){var o=vn.memoizedState;if(r=o.destroy,s!==null&&t1(s,o.deps)){i.memoizedState=vd(e,n,r,s);return}}Gt.flags|=t,i.memoizedState=vd(1|e,n,r,s)}function rE(t,e){return Om(8390656,8,t,e)}function i1(t,e){return Ey(2048,8,t,e)}function IA(t,e){return Ey(4,2,t,e)}function kA(t,e){return Ey(4,4,t,e)}function SA(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function TA(t,e,n){return n=n!=null?n.concat([t]):null,Ey(4,4,SA.bind(null,e,t),n)}function r1(){}function EA(t,e){var n=vi();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&t1(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function NA(t,e){var n=vi();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&t1(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function $A(t,e,n){return hl&21?(Ki(n,e)||(n=OR(),Gt.lanes|=n,dl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Cs=!0),t.memoizedState=n)}function fG(t,e){var n=gt;gt=n!==0&&4>n?n:4,t(!0);var s=S_.transition;S_.transition={};try{t(!1),e()}finally{gt=n,S_.transition=s}}function RA(){return vi().memoizedState}function pG(t,e,n){var s=Vo(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},AA(t))DA(e,n);else if(n=fA(t,e,n,s),n!==null){var i=hs();Vi(n,t,s,i),PA(n,e,s)}}function mG(t,e,n){var s=Vo(t),i={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(AA(t))DA(e,i);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,a=r(o,n);if(i.hasEagerState=!0,i.eagerState=a,Ki(a,o)){var l=e.interleaved;l===null?(i.next=i,Zb(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=fA(t,e,i,s),n!==null&&(i=hs(),Vi(n,t,s,i),PA(n,e,s))}}function AA(t){var e=t.alternate;return t===Gt||e!==null&&e===Gt}function DA(t,e){Vh=hg=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function PA(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,Lb(t,n)}}var dg={readContext:yi,useCallback:Xn,useContext:Xn,useEffect:Xn,useImperativeHandle:Xn,useInsertionEffect:Xn,useLayoutEffect:Xn,useMemo:Xn,useReducer:Xn,useRef:Xn,useState:Xn,useDebugValue:Xn,useDeferredValue:Xn,useTransition:Xn,useMutableSource:Xn,useSyncExternalStore:Xn,useId:Xn,unstable_isNewReconciler:!1},gG={readContext:yi,useCallback:function(t,e){return lr().memoizedState=[t,e===void 0?null:e],t},useContext:yi,useEffect:rE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Om(4194308,4,SA.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Om(4194308,4,t,e)},useInsertionEffect:function(t,e){return Om(4,2,t,e)},useMemo:function(t,e){var n=lr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=lr();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=pG.bind(null,Gt,t),[s.memoizedState,t]},useRef:function(t){var e=lr();return t={current:t},e.memoizedState=t},useState:iE,useDebugValue:r1,useDeferredValue:function(t){return lr().memoizedState=t},useTransition:function(){var t=iE(!1),e=t[0];return t=fG.bind(null,t[1]),lr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Gt,i=lr();if(Ft){if(n===void 0)throw Error(me(407));n=n()}else{if(n=e(),Rn===null)throw Error(me(349));hl&30||vA(s,e,n)}i.memoizedState=n;var r={value:n,getSnapshot:e};return i.queue=r,rE(_A.bind(null,s,r,t),[t]),s.flags|=2048,vd(9,xA.bind(null,s,r,n,e),void 0,null),n},useId:function(){var t=lr(),e=Rn.identifierPrefix;if(Ft){var n=jr,s=Gr;n=(s&~(1<<32-Wi(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=gd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=dG++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},yG={readContext:yi,useCallback:EA,useContext:yi,useEffect:i1,useImperativeHandle:TA,useInsertionEffect:IA,useLayoutEffect:kA,useMemo:NA,useReducer:T_,useRef:CA,useState:function(){return T_(yd)},useDebugValue:r1,useDeferredValue:function(t){var e=vi();return $A(e,vn.memoizedState,t)},useTransition:function(){var t=T_(yd)[0],e=vi().memoizedState;return[t,e]},useMutableSource:gA,useSyncExternalStore:yA,useId:RA,unstable_isNewReconciler:!1},vG={readContext:yi,useCallback:EA,useContext:yi,useEffect:i1,useImperativeHandle:TA,useInsertionEffect:IA,useLayoutEffect:kA,useMemo:NA,useReducer:E_,useRef:CA,useState:function(){return E_(yd)},useDebugValue:r1,useDeferredValue:function(t){var e=vi();return vn===null?e.memoizedState=t:$A(e,vn.memoizedState,t)},useTransition:function(){var t=E_(yd)[0],e=vi().memoizedState;return[t,e]},useMutableSource:gA,useSyncExternalStore:yA,useId:RA,unstable_isNewReconciler:!1};function Di(t,e){if(t&&t.defaultProps){e=jt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Hw(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:jt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ny={isMounted:function(t){return(t=t._reactInternals)?Ml(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=hs(),i=Vo(t),r=Yr(s,i);r.payload=e,n!=null&&(r.callback=n),e=Uo(t,r,i),e!==null&&(Vi(e,t,i,s),Dm(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=hs(),i=Vo(t),r=Yr(s,i);r.tag=1,r.payload=e,n!=null&&(r.callback=n),e=Uo(t,r,i),e!==null&&(Vi(e,t,i,s),Dm(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=hs(),s=Vo(t),i=Yr(n,s);i.tag=2,e!=null&&(i.callback=e),e=Uo(t,i,s),e!==null&&(Vi(e,t,s,n),Dm(e,t,s))}};function oE(t,e,n,s,i,r,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,r,o):e.prototype&&e.prototype.isPureReactComponent?!ud(n,s)||!ud(i,r):!0}function OA(t,e,n){var s=!1,i=ea,r=e.contextType;return typeof r=="object"&&r!==null?r=yi(r):(i=Ns(e)?cl:ss.current,s=e.contextTypes,r=(s=s!=null)?Jc(t,i):ea),e=new e(n,r),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ny,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=r),e}function aE(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&Ny.enqueueReplaceState(e,e.state,null)}function qw(t,e,n,s){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Yb(t);var r=e.contextType;typeof r=="object"&&r!==null?i.context=yi(r):(r=Ns(e)?cl:ss.current,i.context=Jc(t,r)),i.state=t.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(Hw(t,e,r,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ny.enqueueReplaceState(i,i.state,null),cg(t,n,i,s),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function su(t,e){try{var n="",s=e;do n+=HW(s),s=s.return;while(s);var i=n}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:t,source:e,stack:i,digest:null}}function N_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Kw(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var xG=typeof WeakMap=="function"?WeakMap:Map;function LA(t,e,n){n=Yr(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){pg||(pg=!0,i0=s),Kw(t,e)},n}function FA(t,e,n){n=Yr(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;n.payload=function(){return s(i)},n.callback=function(){Kw(t,e)}}var r=t.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(n.callback=function(){Kw(t,e),typeof s!="function"&&(Wo===null?Wo=new Set([this]):Wo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function lE(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new xG;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(n)||(i.add(n),t=DG.bind(null,t,e,n),e.then(t,t))}function cE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function uE(t,e,n,s,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Yr(-1,1),e.tag=2,Uo(n,e,1))),n.lanes|=1),t)}var _G=fo.ReactCurrentOwner,Cs=!1;function as(t,e,n,s){e.child=t===null?dA(e,null,n,s):tu(e,t.child,n,s)}function hE(t,e,n,s,i){n=n.render;var r=e.ref;return Bc(e,i),s=n1(t,e,n,s,r,i),n=s1(),t!==null&&!Cs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,so(t,e,i)):(Ft&&n&&Gb(e),e.flags|=1,as(t,e,s,i),e.child)}function dE(t,e,n,s,i){if(t===null){var r=n.type;return typeof r=="function"&&!f1(r)&&r.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=r,MA(t,e,r,s,i)):(t=zm(n.type,null,s,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!(t.lanes&i)){var o=r.memoizedProps;if(n=n.compare,n=n!==null?n:ud,n(o,s)&&t.ref===e.ref)return so(t,e,i)}return e.flags|=1,t=Go(r,s),t.ref=e.ref,t.return=e,e.child=t}function MA(t,e,n,s,i){if(t!==null){var r=t.memoizedProps;if(ud(r,s)&&t.ref===e.ref)if(Cs=!1,e.pendingProps=s=r,(t.lanes&i)!==0)t.flags&131072&&(Cs=!0);else return e.lanes=t.lanes,so(t,e,i)}return Xw(t,e,n,s,i)}function zA(t,e,n){var s=e.pendingProps,i=s.children,r=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tt(Ac,zs),zs|=n;else{if(!(n&1073741824))return t=r!==null?r.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Tt(Ac,zs),zs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:n,Tt(Ac,zs),zs|=s}else r!==null?(s=r.baseLanes|n,e.memoizedState=null):s=n,Tt(Ac,zs),zs|=s;return as(t,e,i,n),e.child}function BA(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Xw(t,e,n,s,i){var r=Ns(n)?cl:ss.current;return r=Jc(e,r),Bc(e,i),n=n1(t,e,n,s,r,i),s=s1(),t!==null&&!Cs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,so(t,e,i)):(Ft&&s&&Gb(e),e.flags|=1,as(t,e,n,i),e.child)}function fE(t,e,n,s,i){if(Ns(n)){var r=!0;ig(e)}else r=!1;if(Bc(e,i),e.stateNode===null)Lm(t,e),OA(e,n,s),qw(e,n,s,i),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=yi(c):(c=Ns(n)?cl:ss.current,c=Jc(e,c));var h=n.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==c)&&aE(e,o,s,c),Co=!1;var f=e.memoizedState;o.state=f,cg(e,s,o,i),l=e.memoizedState,a!==s||f!==l||Es.current||Co?(typeof h=="function"&&(Hw(e,n,h,s),l=e.memoizedState),(a=Co||oE(e,n,a,s,f,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=c,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,pA(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Di(e.type,a),o.props=c,d=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=yi(l):(l=Ns(n)?cl:ss.current,l=Jc(e,l));var m=n.getDerivedStateFromProps;(h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&aE(e,o,s,l),Co=!1,f=e.memoizedState,o.state=f,cg(e,s,o,i);var g=e.memoizedState;a!==d||f!==g||Es.current||Co?(typeof m=="function"&&(Hw(e,n,m,s),g=e.memoizedState),(c=Co||oE(e,n,c,s,f,g,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),o.props=s,o.state=g,o.context=l,s=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),s=!1)}return Zw(t,e,n,s,r,i)}function Zw(t,e,n,s,i,r){BA(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return i&&QT(e,n,!1),so(t,e,r);s=e.stateNode,_G.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=tu(e,t.child,null,r),e.child=tu(e,null,a,r)):as(t,e,a,r),e.memoizedState=s.state,i&&QT(e,n,!0),e.child}function UA(t){var e=t.stateNode;e.pendingContext?YT(t,e.pendingContext,e.pendingContext!==e.context):e.context&&YT(t,e.context,!1),Qb(t,e.containerInfo)}function pE(t,e,n,s,i){return eu(),Hb(i),e.flags|=256,as(t,e,n,s),e.child}var Yw={dehydrated:null,treeContext:null,retryLane:0};function Qw(t){return{baseLanes:t,cachePool:null,transitions:null}}function WA(t,e,n){var s=e.pendingProps,i=Wt.current,r=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(r=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Tt(Wt,i&1),t===null)return Gw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,r?(s=e.mode,r=e.child,o={mode:"hidden",children:o},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=Ay(o,s,0,null),t=il(t,s,n,null),r.return=e,t.return=e,r.sibling=t,e.child=r,e.child.memoizedState=Qw(n),e.memoizedState=Yw,t):o1(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return wG(t,e,o,s,a,i,n);if(r){r=s.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Go(i,l),s.subtreeFlags=i.subtreeFlags&14680064),a!==null?r=Go(a,r):(r=il(r,o,n,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,o=t.child.memoizedState,o=o===null?Qw(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=t.childLanes&~n,e.memoizedState=Yw,s}return r=t.child,t=r.sibling,s=Go(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function o1(t,e){return e=Ay({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function am(t,e,n,s){return s!==null&&Hb(s),tu(e,t.child,null,n),t=o1(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function wG(t,e,n,s,i,r,o){if(n)return e.flags&256?(e.flags&=-257,s=N_(Error(me(422))),am(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=Ay({mode:"visible",children:s.children},i,0,null),r=il(r,i,o,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&tu(e,t.child,null,o),e.child.memoizedState=Qw(o),e.memoizedState=Yw,r);if(!(e.mode&1))return am(t,e,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var a=s.dgst;return s=a,r=Error(me(419)),s=N_(r,s,void 0),am(t,e,o,s)}if(a=(o&t.childLanes)!==0,Cs||a){if(s=Rn,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,no(t,i),Vi(s,t,i,-1))}return d1(),s=N_(Error(me(421))),am(t,e,o,s)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=PG.bind(null,t),i._reactRetry=e,null):(t=r.treeContext,Us=Bo(i.nextSibling),Vs=e,Ft=!0,Oi=null,t!==null&&(oi[ai++]=Gr,oi[ai++]=jr,oi[ai++]=ul,Gr=t.id,jr=t.overflow,ul=e),e=o1(e,s.children),e.flags|=4096,e)}function mE(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),jw(t.return,e,n)}function $_(t,e,n,s,i){var r=t.memoizedState;r===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=n,r.tailMode=i)}function VA(t,e,n){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(as(t,e,s.children,n),s=Wt.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&mE(t,n,e);else if(t.tag===19)mE(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Tt(Wt,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&ug(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),$_(e,!1,i,n,r);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&ug(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}$_(e,!0,n,null,r);break;case"together":$_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Lm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function so(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),dl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(me(153));if(e.child!==null){for(t=e.child,n=Go(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Go(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function bG(t,e,n){switch(e.tag){case 3:UA(e),eu();break;case 5:mA(e);break;case 1:Ns(e.type)&&ig(e);break;case 4:Qb(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;Tt(ag,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Tt(Wt,Wt.current&1),e.flags|=128,null):n&e.child.childLanes?WA(t,e,n):(Tt(Wt,Wt.current&1),t=so(t,e,n),t!==null?t.sibling:null);Tt(Wt,Wt.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return VA(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Tt(Wt,Wt.current),s)break;return null;case 22:case 23:return e.lanes=0,zA(t,e,n)}return so(t,e,n)}var GA,Jw,jA,HA;GA=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Jw=function(){};jA=function(t,e,n,s){var i=t.memoizedProps;if(i!==s){t=e.stateNode,Za(vr.current);var r=null;switch(n){case"input":i=ww(t,i),s=ww(t,s),r=[];break;case"select":i=jt({},i,{value:void 0}),s=jt({},s,{value:void 0}),r=[];break;case"textarea":i=Iw(t,i),s=Iw(t,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=ng)}Sw(n,s);var o;n=null;for(c in i)if(!s.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(sd.hasOwnProperty(c)?r||(r=[]):(r=r||[]).push(c,null));for(c in s){var l=s[c];if(a=i!=null?i[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(r||(r=[]),r.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(r=r||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(sd.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&At("scroll",t),r||a===l||(r=[])):(r=r||[]).push(c,l))}n&&(r=r||[]).push("style",n);var c=r;(e.updateQueue=c)&&(e.flags|=4)}};HA=function(t,e,n,s){n!==s&&(e.flags|=4)};function mh(t,e){if(!Ft)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Zn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function CG(t,e,n){var s=e.pendingProps;switch(jb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zn(e),null;case 1:return Ns(e.type)&&sg(),Zn(e),null;case 3:return s=e.stateNode,nu(),Pt(Es),Pt(ss),e1(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(rm(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Oi!==null&&(a0(Oi),Oi=null))),Jw(t,e),Zn(e),null;case 5:Jb(e);var i=Za(md.current);if(n=e.type,t!==null&&e.stateNode!=null)jA(t,e,n,s,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(me(166));return Zn(e),null}if(t=Za(vr.current),rm(e)){s=e.stateNode,n=e.type;var r=e.memoizedProps;switch(s[pr]=e,s[fd]=r,t=(e.mode&1)!==0,n){case"dialog":At("cancel",s),At("close",s);break;case"iframe":case"object":case"embed":At("load",s);break;case"video":case"audio":for(i=0;i<Nh.length;i++)At(Nh[i],s);break;case"source":At("error",s);break;case"img":case"image":case"link":At("error",s),At("load",s);break;case"details":At("toggle",s);break;case"input":IT(s,r),At("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},At("invalid",s);break;case"textarea":ST(s,r),At("invalid",s)}Sw(n,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];o==="children"?typeof a=="string"?s.textContent!==a&&(r.suppressHydrationWarning!==!0&&im(s.textContent,a,t),i=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(r.suppressHydrationWarning!==!0&&im(s.textContent,a,t),i=["children",""+a]):sd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&At("scroll",s)}switch(n){case"input":Zp(s),kT(s,r,!0);break;case"textarea":Zp(s),TT(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=ng)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=_R(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[pr]=e,t[fd]=s,GA(t,e,!1,!1),e.stateNode=t;e:{switch(o=Tw(n,s),n){case"dialog":At("cancel",t),At("close",t),i=s;break;case"iframe":case"object":case"embed":At("load",t),i=s;break;case"video":case"audio":for(i=0;i<Nh.length;i++)At(Nh[i],t);i=s;break;case"source":At("error",t),i=s;break;case"img":case"image":case"link":At("error",t),At("load",t),i=s;break;case"details":At("toggle",t),i=s;break;case"input":IT(t,s),i=ww(t,s),At("invalid",t);break;case"option":i=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},i=jt({},s,{value:void 0}),At("invalid",t);break;case"textarea":ST(t,s),i=Iw(t,s),At("invalid",t);break;default:i=s}Sw(n,i),a=i;for(r in a)if(a.hasOwnProperty(r)){var l=a[r];r==="style"?CR(t,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&wR(t,l)):r==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&id(t,l):typeof l=="number"&&id(t,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(sd.hasOwnProperty(r)?l!=null&&r==="onScroll"&&At("scroll",t):l!=null&&$b(t,r,l,o))}switch(n){case"input":Zp(t),kT(t,s,!1);break;case"textarea":Zp(t),TT(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Jo(s.value));break;case"select":t.multiple=!!s.multiple,r=s.value,r!=null?Lc(t,!!s.multiple,r,!1):s.defaultValue!=null&&Lc(t,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=ng)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Zn(e),null;case 6:if(t&&e.stateNode!=null)HA(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(me(166));if(n=Za(md.current),Za(vr.current),rm(e)){if(s=e.stateNode,n=e.memoizedProps,s[pr]=e,(r=s.nodeValue!==n)&&(t=Vs,t!==null))switch(t.tag){case 3:im(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&im(s.nodeValue,n,(t.mode&1)!==0)}r&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[pr]=e,e.stateNode=s}return Zn(e),null;case 13:if(Pt(Wt),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ft&&Us!==null&&e.mode&1&&!(e.flags&128))uA(),eu(),e.flags|=98560,r=!1;else if(r=rm(e),s!==null&&s.dehydrated!==null){if(t===null){if(!r)throw Error(me(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(me(317));r[pr]=e}else eu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Zn(e),r=!1}else Oi!==null&&(a0(Oi),Oi=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Wt.current&1?bn===0&&(bn=3):d1())),e.updateQueue!==null&&(e.flags|=4),Zn(e),null);case 4:return nu(),Jw(t,e),t===null&&hd(e.stateNode.containerInfo),Zn(e),null;case 10:return Xb(e.type._context),Zn(e),null;case 17:return Ns(e.type)&&sg(),Zn(e),null;case 19:if(Pt(Wt),r=e.memoizedState,r===null)return Zn(e),null;if(s=(e.flags&128)!==0,o=r.rendering,o===null)if(s)mh(r,!1);else{if(bn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ug(t),o!==null){for(e.flags|=128,mh(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)r=n,t=s,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=t,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,t=o.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Tt(Wt,Wt.current&1|2),e.child}t=t.sibling}r.tail!==null&&tn()>iu&&(e.flags|=128,s=!0,mh(r,!1),e.lanes=4194304)}else{if(!s)if(t=ug(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),mh(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Ft)return Zn(e),null}else 2*tn()-r.renderingStartTime>iu&&n!==1073741824&&(e.flags|=128,s=!0,mh(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(n=r.last,n!==null?n.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=tn(),e.sibling=null,n=Wt.current,Tt(Wt,s?n&1|2:n&1),e):(Zn(e),null);case 22:case 23:return h1(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?zs&1073741824&&(Zn(e),e.subtreeFlags&6&&(e.flags|=8192)):Zn(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function IG(t,e){switch(jb(e),e.tag){case 1:return Ns(e.type)&&sg(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return nu(),Pt(Es),Pt(ss),e1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Jb(e),null;case 13:if(Pt(Wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(me(340));eu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Pt(Wt),null;case 4:return nu(),null;case 10:return Xb(e.type._context),null;case 22:case 23:return h1(),null;case 24:return null;default:return null}}var lm=!1,Qn=!1,kG=typeof WeakSet=="function"?WeakSet:Set,Ce=null;function Rc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Ht(t,e,s)}else n.current=null}function e0(t,e,n){try{n()}catch(s){Ht(t,e,s)}}var gE=!1;function SG(t,e){if(Fw=Jm,t=YR(),Vb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{n.nodeType,r.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,h=0,d=t,f=null;t:for(;;){for(var m;d!==n||i!==0&&d.nodeType!==3||(a=o+i),d!==r||s!==0&&d.nodeType!==3||(l=o+s),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)f=d,d=m;for(;;){if(d===t)break t;if(f===n&&++c===i&&(a=o),f===r&&++h===s&&(l=o),(m=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=m}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Mw={focusedElem:t,selectionRange:n},Jm=!1,Ce=e;Ce!==null;)if(e=Ce,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ce=t;else for(;Ce!==null;){e=Ce;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var v=g.memoizedProps,_=g.memoizedState,x=e.stateNode,w=x.getSnapshotBeforeUpdate(e.elementType===e.type?v:Di(e.type,v),_);x.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(I){Ht(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,Ce=t;break}Ce=e.return}return g=gE,gE=!1,g}function Gh(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&t)===t){var r=i.destroy;i.destroy=void 0,r!==void 0&&e0(e,n,r)}i=i.next}while(i!==s)}}function $y(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function t0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function qA(t){var e=t.alternate;e!==null&&(t.alternate=null,qA(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[pr],delete e[fd],delete e[Uw],delete e[lG],delete e[cG])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function KA(t){return t.tag===5||t.tag===3||t.tag===4}function yE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||KA(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function n0(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ng));else if(s!==4&&(t=t.child,t!==null))for(n0(t,e,n),t=t.sibling;t!==null;)n0(t,e,n),t=t.sibling}function s0(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(s0(t,e,n),t=t.sibling;t!==null;)s0(t,e,n),t=t.sibling}var Mn=null,Pi=!1;function _o(t,e,n){for(n=n.child;n!==null;)XA(t,e,n),n=n.sibling}function XA(t,e,n){if(yr&&typeof yr.onCommitFiberUnmount=="function")try{yr.onCommitFiberUnmount(by,n)}catch{}switch(n.tag){case 5:Qn||Rc(n,e);case 6:var s=Mn,i=Pi;Mn=null,_o(t,e,n),Mn=s,Pi=i,Mn!==null&&(Pi?(t=Mn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Mn.removeChild(n.stateNode));break;case 18:Mn!==null&&(Pi?(t=Mn,n=n.stateNode,t.nodeType===8?C_(t.parentNode,n):t.nodeType===1&&C_(t,n),ld(t)):C_(Mn,n.stateNode));break;case 4:s=Mn,i=Pi,Mn=n.stateNode.containerInfo,Pi=!0,_o(t,e,n),Mn=s,Pi=i;break;case 0:case 11:case 14:case 15:if(!Qn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&e0(n,e,o),i=i.next}while(i!==s)}_o(t,e,n);break;case 1:if(!Qn&&(Rc(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){Ht(n,e,a)}_o(t,e,n);break;case 21:_o(t,e,n);break;case 22:n.mode&1?(Qn=(s=Qn)||n.memoizedState!==null,_o(t,e,n),Qn=s):_o(t,e,n);break;default:_o(t,e,n)}}function vE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new kG),e.forEach(function(s){var i=OG.bind(null,t,s);n.has(s)||(n.add(s),s.then(i,i))})}}function $i(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var i=n[s];try{var r=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Mn=a.stateNode,Pi=!1;break e;case 3:Mn=a.stateNode.containerInfo,Pi=!0;break e;case 4:Mn=a.stateNode.containerInfo,Pi=!0;break e}a=a.return}if(Mn===null)throw Error(me(160));XA(r,o,i),Mn=null,Pi=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Ht(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ZA(e,t),e=e.sibling}function ZA(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($i(e,t),ar(t),s&4){try{Gh(3,t,t.return),$y(3,t)}catch(v){Ht(t,t.return,v)}try{Gh(5,t,t.return)}catch(v){Ht(t,t.return,v)}}break;case 1:$i(e,t),ar(t),s&512&&n!==null&&Rc(n,n.return);break;case 5:if($i(e,t),ar(t),s&512&&n!==null&&Rc(n,n.return),t.flags&32){var i=t.stateNode;try{id(i,"")}catch(v){Ht(t,t.return,v)}}if(s&4&&(i=t.stateNode,i!=null)){var r=t.memoizedProps,o=n!==null?n.memoizedProps:r,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&r.type==="radio"&&r.name!=null&&vR(i,r),Tw(a,o);var c=Tw(a,r);for(o=0;o<l.length;o+=2){var h=l[o],d=l[o+1];h==="style"?CR(i,d):h==="dangerouslySetInnerHTML"?wR(i,d):h==="children"?id(i,d):$b(i,h,d,c)}switch(a){case"input":bw(i,r);break;case"textarea":xR(i,r);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var m=r.value;m!=null?Lc(i,!!r.multiple,m,!1):f!==!!r.multiple&&(r.defaultValue!=null?Lc(i,!!r.multiple,r.defaultValue,!0):Lc(i,!!r.multiple,r.multiple?[]:"",!1))}i[fd]=r}catch(v){Ht(t,t.return,v)}}break;case 6:if($i(e,t),ar(t),s&4){if(t.stateNode===null)throw Error(me(162));i=t.stateNode,r=t.memoizedProps;try{i.nodeValue=r}catch(v){Ht(t,t.return,v)}}break;case 3:if($i(e,t),ar(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{ld(e.containerInfo)}catch(v){Ht(t,t.return,v)}break;case 4:$i(e,t),ar(t);break;case 13:$i(e,t),ar(t),i=t.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(c1=tn())),s&4&&vE(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Qn=(c=Qn)||h,$i(e,t),Qn=c):$i(e,t),ar(t),s&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(Ce=t,h=t.child;h!==null;){for(d=Ce=h;Ce!==null;){switch(f=Ce,m=f.child,f.tag){case 0:case 11:case 14:case 15:Gh(4,f,f.return);break;case 1:Rc(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){s=f,n=f.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(v){Ht(s,n,v)}}break;case 5:Rc(f,f.return);break;case 22:if(f.memoizedState!==null){_E(d);continue}}m!==null?(m.return=f,Ce=m):_E(d)}h=h.sibling}e:for(h=null,d=t;;){if(d.tag===5){if(h===null){h=d;try{i=d.stateNode,c?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=bR("display",o))}catch(v){Ht(t,t.return,v)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(v){Ht(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:$i(e,t),ar(t),s&4&&vE(t);break;case 21:break;default:$i(e,t),ar(t)}}function ar(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(KA(n)){var s=n;break e}n=n.return}throw Error(me(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(id(i,""),s.flags&=-33);var r=yE(t);s0(t,r,i);break;case 3:case 4:var o=s.stateNode.containerInfo,a=yE(t);n0(t,a,o);break;default:throw Error(me(161))}}catch(l){Ht(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function TG(t,e,n){Ce=t,YA(t)}function YA(t,e,n){for(var s=(t.mode&1)!==0;Ce!==null;){var i=Ce,r=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||lm;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Qn;a=lm;var c=Qn;if(lm=o,(Qn=l)&&!c)for(Ce=i;Ce!==null;)o=Ce,l=o.child,o.tag===22&&o.memoizedState!==null?wE(i):l!==null?(l.return=o,Ce=l):wE(i);for(;r!==null;)Ce=r,YA(r),r=r.sibling;Ce=i,lm=a,Qn=c}xE(t)}else i.subtreeFlags&8772&&r!==null?(r.return=i,Ce=r):xE(t)}}function xE(t){for(;Ce!==null;){var e=Ce;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Qn||$y(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Qn)if(n===null)s.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Di(e.type,n.memoizedProps);s.componentDidUpdate(i,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&sE(e,r,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}sE(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&ld(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}Qn||e.flags&512&&t0(e)}catch(f){Ht(e,e.return,f)}}if(e===t){Ce=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ce=n;break}Ce=e.return}}function _E(t){for(;Ce!==null;){var e=Ce;if(e===t){Ce=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ce=n;break}Ce=e.return}}function wE(t){for(;Ce!==null;){var e=Ce;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{$y(4,e)}catch(l){Ht(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(l){Ht(e,i,l)}}var r=e.return;try{t0(e)}catch(l){Ht(e,r,l)}break;case 5:var o=e.return;try{t0(e)}catch(l){Ht(e,o,l)}}}catch(l){Ht(e,e.return,l)}if(e===t){Ce=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ce=a;break}Ce=e.return}}var EG=Math.ceil,fg=fo.ReactCurrentDispatcher,a1=fo.ReactCurrentOwner,mi=fo.ReactCurrentBatchConfig,it=0,Rn=null,ln=null,Bn=0,zs=0,Ac=da(0),bn=0,xd=null,dl=0,Ry=0,l1=0,jh=null,ws=null,c1=0,iu=1/0,Br=null,pg=!1,i0=null,Wo=null,cm=!1,Ao=null,mg=0,Hh=0,r0=null,Fm=-1,Mm=0;function hs(){return it&6?tn():Fm!==-1?Fm:Fm=tn()}function Vo(t){return t.mode&1?it&2&&Bn!==0?Bn&-Bn:hG.transition!==null?(Mm===0&&(Mm=OR()),Mm):(t=gt,t!==0||(t=window.event,t=t===void 0?16:WR(t.type)),t):1}function Vi(t,e,n,s){if(50<Hh)throw Hh=0,r0=null,Error(me(185));Kd(t,n,s),(!(it&2)||t!==Rn)&&(t===Rn&&(!(it&2)&&(Ry|=n),bn===4&&So(t,Bn)),$s(t,s),n===1&&it===0&&!(e.mode&1)&&(iu=tn()+500,Ty&&fa()))}function $s(t,e){var n=t.callbackNode;hV(t,e);var s=Qm(t,t===Rn?Bn:0);if(s===0)n!==null&&$T(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&$T(n),e===1)t.tag===0?uG(bE.bind(null,t)):aA(bE.bind(null,t)),oG(function(){!(it&6)&&fa()}),n=null;else{switch(LR(s)){case 1:n=Ob;break;case 4:n=DR;break;case 16:n=Ym;break;case 536870912:n=PR;break;default:n=Ym}n=rD(n,QA.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function QA(t,e){if(Fm=-1,Mm=0,it&6)throw Error(me(327));var n=t.callbackNode;if(Uc()&&t.callbackNode!==n)return null;var s=Qm(t,t===Rn?Bn:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=gg(t,s);else{e=s;var i=it;it|=2;var r=eD();(Rn!==t||Bn!==e)&&(Br=null,iu=tn()+500,sl(t,e));do try{RG();break}catch(a){JA(t,a)}while(!0);Kb(),fg.current=r,it=i,ln!==null?e=0:(Rn=null,Bn=0,e=bn)}if(e!==0){if(e===2&&(i=Aw(t),i!==0&&(s=i,e=o0(t,i))),e===1)throw n=xd,sl(t,0),So(t,s),$s(t,tn()),n;if(e===6)So(t,s);else{if(i=t.current.alternate,!(s&30)&&!NG(i)&&(e=gg(t,s),e===2&&(r=Aw(t),r!==0&&(s=r,e=o0(t,r))),e===1))throw n=xd,sl(t,0),So(t,s),$s(t,tn()),n;switch(t.finishedWork=i,t.finishedLanes=s,e){case 0:case 1:throw Error(me(345));case 2:za(t,ws,Br);break;case 3:if(So(t,s),(s&130023424)===s&&(e=c1+500-tn(),10<e)){if(Qm(t,0)!==0)break;if(i=t.suspendedLanes,(i&s)!==s){hs(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Bw(za.bind(null,t,ws,Br),e);break}za(t,ws,Br);break;case 4:if(So(t,s),(s&4194240)===s)break;for(e=t.eventTimes,i=-1;0<s;){var o=31-Wi(s);r=1<<o,o=e[o],o>i&&(i=o),s&=~r}if(s=i,s=tn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*EG(s/1960))-s,10<s){t.timeoutHandle=Bw(za.bind(null,t,ws,Br),s);break}za(t,ws,Br);break;case 5:za(t,ws,Br);break;default:throw Error(me(329))}}}return $s(t,tn()),t.callbackNode===n?QA.bind(null,t):null}function o0(t,e){var n=jh;return t.current.memoizedState.isDehydrated&&(sl(t,e).flags|=256),t=gg(t,e),t!==2&&(e=ws,ws=n,e!==null&&a0(e)),t}function a0(t){ws===null?ws=t:ws.push.apply(ws,t)}function NG(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var i=n[s],r=i.getSnapshot;i=i.value;try{if(!Ki(r(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function So(t,e){for(e&=~l1,e&=~Ry,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Wi(e),s=1<<n;t[n]=-1,e&=~s}}function bE(t){if(it&6)throw Error(me(327));Uc();var e=Qm(t,0);if(!(e&1))return $s(t,tn()),null;var n=gg(t,e);if(t.tag!==0&&n===2){var s=Aw(t);s!==0&&(e=s,n=o0(t,s))}if(n===1)throw n=xd,sl(t,0),So(t,e),$s(t,tn()),n;if(n===6)throw Error(me(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,za(t,ws,Br),$s(t,tn()),null}function u1(t,e){var n=it;it|=1;try{return t(e)}finally{it=n,it===0&&(iu=tn()+500,Ty&&fa())}}function fl(t){Ao!==null&&Ao.tag===0&&!(it&6)&&Uc();var e=it;it|=1;var n=mi.transition,s=gt;try{if(mi.transition=null,gt=1,t)return t()}finally{gt=s,mi.transition=n,it=e,!(it&6)&&fa()}}function h1(){zs=Ac.current,Pt(Ac)}function sl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,rG(n)),ln!==null)for(n=ln.return;n!==null;){var s=n;switch(jb(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&sg();break;case 3:nu(),Pt(Es),Pt(ss),e1();break;case 5:Jb(s);break;case 4:nu();break;case 13:Pt(Wt);break;case 19:Pt(Wt);break;case 10:Xb(s.type._context);break;case 22:case 23:h1()}n=n.return}if(Rn=t,ln=t=Go(t.current,null),Bn=zs=e,bn=0,xd=null,l1=Ry=dl=0,ws=jh=null,Xa!==null){for(e=0;e<Xa.length;e++)if(n=Xa[e],s=n.interleaved,s!==null){n.interleaved=null;var i=s.next,r=n.pending;if(r!==null){var o=r.next;r.next=i,s.next=o}n.pending=s}Xa=null}return t}function JA(t,e){do{var n=ln;try{if(Kb(),Pm.current=dg,hg){for(var s=Gt.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}hg=!1}if(hl=0,Tn=vn=Gt=null,Vh=!1,gd=0,a1.current=null,n===null||n.return===null){bn=1,xd=e,ln=null;break}e:{var r=t,o=n.return,a=n,l=e;if(e=Bn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=cE(o);if(m!==null){m.flags&=-257,uE(m,o,a,r,e),m.mode&1&&lE(r,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var v=new Set;v.add(l),e.updateQueue=v}else g.add(l);break e}else{if(!(e&1)){lE(r,c,e),d1();break e}l=Error(me(426))}}else if(Ft&&a.mode&1){var _=cE(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),uE(_,o,a,r,e),Hb(su(l,a));break e}}r=l=su(l,a),bn!==4&&(bn=2),jh===null?jh=[r]:jh.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var x=LA(r,l,e);nE(r,x);break e;case 1:a=l;var w=r.type,C=r.stateNode;if(!(r.flags&128)&&(typeof w.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Wo===null||!Wo.has(C)))){r.flags|=65536,e&=-e,r.lanes|=e;var I=FA(r,a,e);nE(r,I);break e}}r=r.return}while(r!==null)}nD(n)}catch(S){e=S,ln===n&&n!==null&&(ln=n=n.return);continue}break}while(!0)}function eD(){var t=fg.current;return fg.current=dg,t===null?dg:t}function d1(){(bn===0||bn===3||bn===2)&&(bn=4),Rn===null||!(dl&268435455)&&!(Ry&268435455)||So(Rn,Bn)}function gg(t,e){var n=it;it|=2;var s=eD();(Rn!==t||Bn!==e)&&(Br=null,sl(t,e));do try{$G();break}catch(i){JA(t,i)}while(!0);if(Kb(),it=n,fg.current=s,ln!==null)throw Error(me(261));return Rn=null,Bn=0,bn}function $G(){for(;ln!==null;)tD(ln)}function RG(){for(;ln!==null&&!nV();)tD(ln)}function tD(t){var e=iD(t.alternate,t,zs);t.memoizedProps=t.pendingProps,e===null?nD(t):ln=e,a1.current=null}function nD(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=IG(n,e),n!==null){n.flags&=32767,ln=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{bn=6,ln=null;return}}else if(n=CG(n,e,zs),n!==null){ln=n;return}if(e=e.sibling,e!==null){ln=e;return}ln=e=t}while(e!==null);bn===0&&(bn=5)}function za(t,e,n){var s=gt,i=mi.transition;try{mi.transition=null,gt=1,AG(t,e,n,s)}finally{mi.transition=i,gt=s}return null}function AG(t,e,n,s){do Uc();while(Ao!==null);if(it&6)throw Error(me(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(me(177));t.callbackNode=null,t.callbackPriority=0;var r=n.lanes|n.childLanes;if(dV(t,r),t===Rn&&(ln=Rn=null,Bn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||cm||(cm=!0,rD(Ym,function(){return Uc(),null})),r=(n.flags&15990)!==0,n.subtreeFlags&15990||r){r=mi.transition,mi.transition=null;var o=gt;gt=1;var a=it;it|=4,a1.current=null,SG(t,n),ZA(n,t),QV(Mw),Jm=!!Fw,Mw=Fw=null,t.current=n,TG(n),sV(),it=a,gt=o,mi.transition=r}else t.current=n;if(cm&&(cm=!1,Ao=t,mg=i),r=t.pendingLanes,r===0&&(Wo=null),oV(n.stateNode),$s(t,tn()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],s(i.value,{componentStack:i.stack,digest:i.digest});if(pg)throw pg=!1,t=i0,i0=null,t;return mg&1&&t.tag!==0&&Uc(),r=t.pendingLanes,r&1?t===r0?Hh++:(Hh=0,r0=t):Hh=0,fa(),null}function Uc(){if(Ao!==null){var t=LR(mg),e=mi.transition,n=gt;try{if(mi.transition=null,gt=16>t?16:t,Ao===null)var s=!1;else{if(t=Ao,Ao=null,mg=0,it&6)throw Error(me(331));var i=it;for(it|=4,Ce=t.current;Ce!==null;){var r=Ce,o=r.child;if(Ce.flags&16){var a=r.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Ce=c;Ce!==null;){var h=Ce;switch(h.tag){case 0:case 11:case 15:Gh(8,h,r)}var d=h.child;if(d!==null)d.return=h,Ce=d;else for(;Ce!==null;){h=Ce;var f=h.sibling,m=h.return;if(qA(h),h===c){Ce=null;break}if(f!==null){f.return=m,Ce=f;break}Ce=m}}}var g=r.alternate;if(g!==null){var v=g.child;if(v!==null){g.child=null;do{var _=v.sibling;v.sibling=null,v=_}while(v!==null)}}Ce=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,Ce=o;else e:for(;Ce!==null;){if(r=Ce,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Gh(9,r,r.return)}var x=r.sibling;if(x!==null){x.return=r.return,Ce=x;break e}Ce=r.return}}var w=t.current;for(Ce=w;Ce!==null;){o=Ce;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,Ce=C;else e:for(o=w;Ce!==null;){if(a=Ce,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:$y(9,a)}}catch(S){Ht(a,a.return,S)}if(a===o){Ce=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,Ce=I;break e}Ce=a.return}}if(it=i,fa(),yr&&typeof yr.onPostCommitFiberRoot=="function")try{yr.onPostCommitFiberRoot(by,t)}catch{}s=!0}return s}finally{gt=n,mi.transition=e}}return!1}function CE(t,e,n){e=su(n,e),e=LA(t,e,1),t=Uo(t,e,1),e=hs(),t!==null&&(Kd(t,1,e),$s(t,e))}function Ht(t,e,n){if(t.tag===3)CE(t,t,n);else for(;e!==null;){if(e.tag===3){CE(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Wo===null||!Wo.has(s))){t=su(n,t),t=FA(e,t,1),e=Uo(e,t,1),t=hs(),e!==null&&(Kd(e,1,t),$s(e,t));break}}e=e.return}}function DG(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=hs(),t.pingedLanes|=t.suspendedLanes&n,Rn===t&&(Bn&n)===n&&(bn===4||bn===3&&(Bn&130023424)===Bn&&500>tn()-c1?sl(t,0):l1|=n),$s(t,e)}function sD(t,e){e===0&&(t.mode&1?(e=Jp,Jp<<=1,!(Jp&130023424)&&(Jp=4194304)):e=1);var n=hs();t=no(t,e),t!==null&&(Kd(t,e,n),$s(t,n))}function PG(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),sD(t,n)}function OG(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(me(314))}s!==null&&s.delete(e),sD(t,n)}var iD;iD=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Es.current)Cs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Cs=!1,bG(t,e,n);Cs=!!(t.flags&131072)}else Cs=!1,Ft&&e.flags&1048576&&lA(e,og,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Lm(t,e),t=e.pendingProps;var i=Jc(e,ss.current);Bc(e,n),i=n1(null,e,s,t,i,n);var r=s1();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ns(s)?(r=!0,ig(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Yb(e),i.updater=Ny,e.stateNode=i,i._reactInternals=e,qw(e,s,t,n),e=Zw(null,e,s,!0,r,n)):(e.tag=0,Ft&&r&&Gb(e),as(null,e,i,n),e=e.child),e;case 16:s=e.elementType;e:{switch(Lm(t,e),t=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=FG(s),t=Di(s,t),i){case 0:e=Xw(null,e,s,t,n);break e;case 1:e=fE(null,e,s,t,n);break e;case 11:e=hE(null,e,s,t,n);break e;case 14:e=dE(null,e,s,Di(s.type,t),n);break e}throw Error(me(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Di(s,i),Xw(t,e,s,i,n);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Di(s,i),fE(t,e,s,i,n);case 3:e:{if(UA(e),t===null)throw Error(me(387));s=e.pendingProps,r=e.memoizedState,i=r.element,pA(t,e),cg(e,s,null,n);var o=e.memoizedState;if(s=o.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=su(Error(me(423)),e),e=pE(t,e,s,n,i);break e}else if(s!==i){i=su(Error(me(424)),e),e=pE(t,e,s,n,i);break e}else for(Us=Bo(e.stateNode.containerInfo.firstChild),Vs=e,Ft=!0,Oi=null,n=dA(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(eu(),s===i){e=so(t,e,n);break e}as(t,e,s,n)}e=e.child}return e;case 5:return mA(e),t===null&&Gw(e),s=e.type,i=e.pendingProps,r=t!==null?t.memoizedProps:null,o=i.children,zw(s,i)?o=null:r!==null&&zw(s,r)&&(e.flags|=32),BA(t,e),as(t,e,o,n),e.child;case 6:return t===null&&Gw(e),null;case 13:return WA(t,e,n);case 4:return Qb(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=tu(e,null,s,n):as(t,e,s,n),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Di(s,i),hE(t,e,s,i,n);case 7:return as(t,e,e.pendingProps,n),e.child;case 8:return as(t,e,e.pendingProps.children,n),e.child;case 12:return as(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,Tt(ag,s._currentValue),s._currentValue=o,r!==null)if(Ki(r.value,o)){if(r.children===i.children&&!Es.current){e=so(t,e,n);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var a=r.dependencies;if(a!==null){o=r.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(r.tag===1){l=Yr(-1,n&-n),l.tag=2;var c=r.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}r.lanes|=n,l=r.alternate,l!==null&&(l.lanes|=n),jw(r.return,n,e),a.lanes|=n;break}l=l.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(me(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),jw(o,n,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}as(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,Bc(e,n),i=yi(i),s=s(i),e.flags|=1,as(t,e,s,n),e.child;case 14:return s=e.type,i=Di(s,e.pendingProps),i=Di(s.type,i),dE(t,e,s,i,n);case 15:return MA(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Di(s,i),Lm(t,e),e.tag=1,Ns(s)?(t=!0,ig(e)):t=!1,Bc(e,n),OA(e,s,i),qw(e,s,i,n),Zw(null,e,s,!0,t,n);case 19:return VA(t,e,n);case 22:return zA(t,e,n)}throw Error(me(156,e.tag))};function rD(t,e){return AR(t,e)}function LG(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ci(t,e,n,s){return new LG(t,e,n,s)}function f1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function FG(t){if(typeof t=="function")return f1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ab)return 11;if(t===Db)return 14}return 2}function Go(t,e){var n=t.alternate;return n===null?(n=ci(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function zm(t,e,n,s,i,r){var o=2;if(s=t,typeof t=="function")f1(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case bc:return il(n.children,i,r,e);case Rb:o=8,i|=8;break;case yw:return t=ci(12,n,e,i|2),t.elementType=yw,t.lanes=r,t;case vw:return t=ci(13,n,e,i),t.elementType=vw,t.lanes=r,t;case xw:return t=ci(19,n,e,i),t.elementType=xw,t.lanes=r,t;case mR:return Ay(n,i,r,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case fR:o=10;break e;case pR:o=9;break e;case Ab:o=11;break e;case Db:o=14;break e;case bo:o=16,s=null;break e}throw Error(me(130,t==null?t:typeof t,""))}return e=ci(o,n,e,i),e.elementType=t,e.type=s,e.lanes=r,e}function il(t,e,n,s){return t=ci(7,t,s,e),t.lanes=n,t}function Ay(t,e,n,s){return t=ci(22,t,s,e),t.elementType=mR,t.lanes=n,t.stateNode={isHidden:!1},t}function R_(t,e,n){return t=ci(6,t,null,e),t.lanes=n,t}function A_(t,e,n){return e=ci(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function MG(t,e,n,s,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=d_(0),this.expirationTimes=d_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=d_(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function p1(t,e,n,s,i,r,o,a,l){return t=new MG(t,e,n,a,l),e===1?(e=1,r===!0&&(e|=8)):e=0,r=ci(3,null,null,e),t.current=r,r.stateNode=t,r.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yb(r),t}function zG(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wc,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function oD(t){if(!t)return ea;t=t._reactInternals;e:{if(Ml(t)!==t||t.tag!==1)throw Error(me(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ns(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(t.tag===1){var n=t.type;if(Ns(n))return oA(t,n,e)}return e}function aD(t,e,n,s,i,r,o,a,l){return t=p1(n,s,!0,t,i,r,o,a,l),t.context=oD(null),n=t.current,s=hs(),i=Vo(n),r=Yr(s,i),r.callback=e??null,Uo(n,r,i),t.current.lanes=i,Kd(t,i,s),$s(t,s),t}function Dy(t,e,n,s){var i=e.current,r=hs(),o=Vo(i);return n=oD(n),e.context===null?e.context=n:e.pendingContext=n,e=Yr(r,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=Uo(i,e,o),t!==null&&(Vi(t,i,o,r),Dm(t,i,o)),o}function yg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function IE(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function m1(t,e){IE(t,e),(t=t.alternate)&&IE(t,e)}function BG(){return null}var lD=typeof reportError=="function"?reportError:function(t){console.error(t)};function g1(t){this._internalRoot=t}Py.prototype.render=g1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(me(409));Dy(t,e,null,null)};Py.prototype.unmount=g1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;fl(function(){Dy(null,t,null,null)}),e[to]=null}};function Py(t){this._internalRoot=t}Py.prototype.unstable_scheduleHydration=function(t){if(t){var e=zR();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ko.length&&e!==0&&e<ko[n].priority;n++);ko.splice(n,0,t),n===0&&UR(t)}};function y1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Oy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function kE(){}function UG(t,e,n,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var c=yg(o);r.call(c)}}var o=aD(e,s,t,0,null,!1,!1,"",kE);return t._reactRootContainer=o,t[to]=o.current,hd(t.nodeType===8?t.parentNode:t),fl(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof s=="function"){var a=s;s=function(){var c=yg(l);a.call(c)}}var l=p1(t,0,!1,null,null,!1,!1,"",kE);return t._reactRootContainer=l,t[to]=l.current,hd(t.nodeType===8?t.parentNode:t),fl(function(){Dy(e,l,n,s)}),l}function Ly(t,e,n,s,i){var r=n._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var a=i;i=function(){var l=yg(o);a.call(l)}}Dy(e,o,t,i)}else o=UG(n,e,t,i,s);return yg(o)}FR=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Eh(e.pendingLanes);n!==0&&(Lb(e,n|1),$s(e,tn()),!(it&6)&&(iu=tn()+500,fa()))}break;case 13:fl(function(){var s=no(t,1);if(s!==null){var i=hs();Vi(s,t,1,i)}}),m1(t,1)}};Fb=function(t){if(t.tag===13){var e=no(t,134217728);if(e!==null){var n=hs();Vi(e,t,134217728,n)}m1(t,134217728)}};MR=function(t){if(t.tag===13){var e=Vo(t),n=no(t,e);if(n!==null){var s=hs();Vi(n,t,e,s)}m1(t,e)}};zR=function(){return gt};BR=function(t,e){var n=gt;try{return gt=t,e()}finally{gt=n}};Nw=function(t,e,n){switch(e){case"input":if(bw(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var i=Sy(s);if(!i)throw Error(me(90));yR(s),bw(s,i)}}}break;case"textarea":xR(t,n);break;case"select":e=n.value,e!=null&&Lc(t,!!n.multiple,e,!1)}};SR=u1;TR=fl;var WG={usingClientEntryPoint:!1,Events:[Zd,Sc,Sy,IR,kR,u1]},gh={findFiberByHostInstance:Ka,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},VG={bundleType:gh.bundleType,version:gh.version,rendererPackageName:gh.rendererPackageName,rendererConfig:gh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$R(t),t===null?null:t.stateNode},findFiberByHostInstance:gh.findFiberByHostInstance||BG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var um=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!um.isDisabled&&um.supportsFiber)try{by=um.inject(VG),yr=um}catch{}}Ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WG;Ks.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y1(e))throw Error(me(200));return zG(t,e,null,n)};Ks.createRoot=function(t,e){if(!y1(t))throw Error(me(299));var n=!1,s="",i=lD;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=p1(t,1,!1,null,null,n,!1,s,i),t[to]=e.current,hd(t.nodeType===8?t.parentNode:t),new g1(e)};Ks.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(me(188)):(t=Object.keys(t).join(","),Error(me(268,t)));return t=$R(e),t=t===null?null:t.stateNode,t};Ks.flushSync=function(t){return fl(t)};Ks.hydrate=function(t,e,n){if(!Oy(e))throw Error(me(200));return Ly(null,t,e,!0,n)};Ks.hydrateRoot=function(t,e,n){if(!y1(t))throw Error(me(405));var s=n!=null&&n.hydratedSources||null,i=!1,r="",o=lD;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=aD(e,null,t,1,n??null,i,!1,r,o),t[to]=e.current,hd(t),s)for(t=0;t<s.length;t++)n=s[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Py(e)};Ks.render=function(t,e,n){if(!Oy(e))throw Error(me(200));return Ly(null,t,e,!1,n)};Ks.unmountComponentAtNode=function(t){if(!Oy(t))throw Error(me(40));return t._reactRootContainer?(fl(function(){Ly(null,null,t,!1,function(){t._reactRootContainer=null,t[to]=null})}),!0):!1};Ks.unstable_batchedUpdates=u1;Ks.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Oy(n))throw Error(me(200));if(t==null||t._reactInternals===void 0)throw Error(me(38));return Ly(t,e,n,!1,s)};Ks.version="18.3.1-next-f1338f8080-20240426";function cD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cD)}catch(t){console.error(t)}}cD(),cR.exports=Ks;var uD=cR.exports,hD,SE=uD;hD=SE.createRoot,SE.hydrateRoot;/**
 * @remix-run/router v1.22.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _d(){return _d=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},_d.apply(this,arguments)}var Do;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Do||(Do={}));const TE="popstate";function GG(t){t===void 0&&(t={});function e(s,i){let{pathname:r,search:o,hash:a}=s.location;return l0("",{pathname:r,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(s,i){return typeof i=="string"?i:vg(i)}return HG(e,n,null,t)}function hn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function dD(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function jG(){return Math.random().toString(36).substr(2,8)}function EE(t,e){return{usr:t.state,key:t.key,idx:e}}function l0(t,e,n,s){return n===void 0&&(n=null),_d({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Iu(e):e,{state:n,key:e&&e.key||s||jG()})}function vg(t){let{pathname:e="/",search:n="",hash:s=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Iu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function HG(t,e,n,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:r=!1}=s,o=i.history,a=Do.Pop,l=null,c=h();c==null&&(c=0,o.replaceState(_d({},o.state,{idx:c}),""));function h(){return(o.state||{idx:null}).idx}function d(){a=Do.Pop;let _=h(),x=_==null?null:_-c;c=_,l&&l({action:a,location:v.location,delta:x})}function f(_,x){a=Do.Push;let w=l0(v.location,_,x);c=h()+1;let C=EE(w,c),I=v.createHref(w);try{o.pushState(C,"",I)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;i.location.assign(I)}r&&l&&l({action:a,location:v.location,delta:1})}function m(_,x){a=Do.Replace;let w=l0(v.location,_,x);c=h();let C=EE(w,c),I=v.createHref(w);o.replaceState(C,"",I),r&&l&&l({action:a,location:v.location,delta:0})}function g(_){let x=i.location.origin!=="null"?i.location.origin:i.location.href,w=typeof _=="string"?_:vg(_);return w=w.replace(/ $/,"%20"),hn(x,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,x)}let v={get action(){return a},get location(){return t(i,o)},listen(_){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(TE,d),l=_,()=>{i.removeEventListener(TE,d),l=null}},createHref(_){return e(i,_)},createURL:g,encodeLocation(_){let x=g(_);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:f,replace:m,go(_){return o.go(_)}};return v}var NE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(NE||(NE={}));function qG(t,e,n){return n===void 0&&(n="/"),KG(t,e,n)}function KG(t,e,n,s){let i=typeof e=="string"?Iu(e):e,r=v1(i.pathname||"/",n);if(r==null)return null;let o=fD(t);XG(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=aj(r);a=ij(o[l],c)}return a}function fD(t,e,n,s){e===void 0&&(e=[]),n===void 0&&(n=[]),s===void 0&&(s="");let i=(r,o,a)=>{let l={relativePath:a===void 0?r.path||"":a,caseSensitive:r.caseSensitive===!0,childrenIndex:o,route:r};l.relativePath.startsWith("/")&&(hn(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let c=jo([s,l.relativePath]),h=n.concat(l);r.children&&r.children.length>0&&(hn(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),fD(r.children,e,h,c)),!(r.path==null&&!r.index)&&e.push({path:c,score:nj(c,r.index),routesMeta:h})};return t.forEach((r,o)=>{var a;if(r.path===""||!((a=r.path)!=null&&a.includes("?")))i(r,o);else for(let l of pD(r.path))i(r,o,l)}),e}function pD(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,i=n.endsWith("?"),r=n.replace(/\?$/,"");if(s.length===0)return i?[r,""]:[r];let o=pD(s.join("/")),a=[];return a.push(...o.map(l=>l===""?r:[r,l].join("/"))),i&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function XG(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:sj(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const ZG=/^:[\w-]+$/,YG=3,QG=2,JG=1,ej=10,tj=-2,$E=t=>t==="*";function nj(t,e){let n=t.split("/"),s=n.length;return n.some($E)&&(s+=tj),e&&(s+=QG),n.filter(i=>!$E(i)).reduce((i,r)=>i+(ZG.test(r)?YG:r===""?JG:ej),s)}function sj(t,e){return t.length===e.length&&t.slice(0,-1).every((s,i)=>s===e[i])?t[t.length-1]-e[e.length-1]:0}function ij(t,e,n){let{routesMeta:s}=t,i={},r="/",o=[];for(let a=0;a<s.length;++a){let l=s[a],c=a===s.length-1,h=r==="/"?e:e.slice(r.length)||"/",d=rj({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},h),f=l.route;if(!d)return null;Object.assign(i,d.params),o.push({params:i,pathname:jo([r,d.pathname]),pathnameBase:hj(jo([r,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(r=jo([r,d.pathnameBase]))}return o}function rj(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=oj(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let r=i[0],o=r.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:s.reduce((c,h,d)=>{let{paramName:f,isOptional:m}=h;if(f==="*"){let v=a[d]||"";o=r.slice(0,r.length-v.length).replace(/(.)\/+$/,"$1")}const g=a[d];return m&&!g?c[f]=void 0:c[f]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:r,pathnameBase:o,pattern:t}}function oj(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),dD(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function aj(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dD(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function v1(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}function lj(t,e){e===void 0&&(e="/");let{pathname:n,search:s="",hash:i=""}=typeof t=="string"?Iu(t):t;return{pathname:n?n.startsWith("/")?n:cj(n,e):e,search:dj(s),hash:fj(i)}}function cj(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function D_(t,e,n,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function uj(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function mD(t,e){let n=uj(t);return e?n.map((s,i)=>i===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function gD(t,e,n,s){s===void 0&&(s=!1);let i;typeof t=="string"?i=Iu(t):(i=_d({},t),hn(!i.pathname||!i.pathname.includes("?"),D_("?","pathname","search",i)),hn(!i.pathname||!i.pathname.includes("#"),D_("#","pathname","hash",i)),hn(!i.search||!i.search.includes("#"),D_("#","search","hash",i)));let r=t===""||i.pathname==="",o=r?"/":i.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!s&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=lj(i,a),c=o&&o!=="/"&&o.endsWith("/"),h=(r||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}const jo=t=>t.join("/").replace(/\/\/+/g,"/"),hj=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),dj=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,fj=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function pj(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const yD=["post","put","patch","delete"];new Set(yD);const mj=["get",...yD];new Set(mj);/**
 * React Router v6.29.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wd(){return wd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},wd.apply(this,arguments)}const x1=ie.createContext(null),gj=ie.createContext(null),zl=ie.createContext(null),Fy=ie.createContext(null),Bl=ie.createContext({outlet:null,matches:[],isDataRoute:!1}),vD=ie.createContext(null);function yj(t,e){let{relative:n}=e===void 0?{}:e;Qd()||hn(!1);let{basename:s,navigator:i}=ie.useContext(zl),{hash:r,pathname:o,search:a}=wD(t,{relative:n}),l=o;return s!=="/"&&(l=o==="/"?s:jo([s,o])),i.createHref({pathname:l,search:a,hash:r})}function Qd(){return ie.useContext(Fy)!=null}function My(){return Qd()||hn(!1),ie.useContext(Fy).location}function xD(t){ie.useContext(zl).static||ie.useLayoutEffect(t)}function _D(){let{isDataRoute:t}=ie.useContext(Bl);return t?$j():vj()}function vj(){Qd()||hn(!1);let t=ie.useContext(x1),{basename:e,future:n,navigator:s}=ie.useContext(zl),{matches:i}=ie.useContext(Bl),{pathname:r}=My(),o=JSON.stringify(mD(i,n.v7_relativeSplatPath)),a=ie.useRef(!1);return xD(()=>{a.current=!0}),ie.useCallback(function(c,h){if(h===void 0&&(h={}),!a.current)return;if(typeof c=="number"){s.go(c);return}let d=gD(c,JSON.parse(o),r,h.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:jo([e,d.pathname])),(h.replace?s.replace:s.push)(d,h.state,h)},[e,s,o,r,t])}function wD(t,e){let{relative:n}=e===void 0?{}:e,{future:s}=ie.useContext(zl),{matches:i}=ie.useContext(Bl),{pathname:r}=My(),o=JSON.stringify(mD(i,s.v7_relativeSplatPath));return ie.useMemo(()=>gD(t,JSON.parse(o),r,n==="path"),[t,o,r,n])}function xj(t,e){return _j(t,e)}function _j(t,e,n,s){Qd()||hn(!1);let{navigator:i,static:r}=ie.useContext(zl),{matches:o}=ie.useContext(Bl),a=o[o.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let h=My(),d;if(e){var f;let x=typeof e=="string"?Iu(e):e;c==="/"||(f=x.pathname)!=null&&f.startsWith(c)||hn(!1),d=x}else d=h;let m=d.pathname||"/",g=m;if(c!=="/"){let x=c.replace(/^\//,"").split("/");g="/"+m.replace(/^\//,"").split("/").slice(x.length).join("/")}let v=qG(t,{pathname:g}),_=kj(v&&v.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:jo([c,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?c:jo([c,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),o,n,s);return e&&_?ie.createElement(Fy.Provider,{value:{location:wd({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Do.Pop}},_):_}function wj(){let t=Nj(),e=pj(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ie.createElement(ie.Fragment,null,ie.createElement("h2",null,"Unexpected Application Error!"),ie.createElement("h3",{style:{fontStyle:"italic"}},e),n?ie.createElement("pre",{style:i},n):null,null)}const bj=ie.createElement(wj,null);class Cj extends ie.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?ie.createElement(Bl.Provider,{value:this.props.routeContext},ie.createElement(vD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ij(t){let{routeContext:e,match:n,children:s}=t,i=ie.useContext(x1);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),ie.createElement(Bl.Provider,{value:e},s)}function kj(t,e,n,s){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),s===void 0&&(s=null),t==null){var r;if(!n)return null;if(n.errors)t=n.matches;else if((r=s)!=null&&r.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(i=n)==null?void 0:i.errors;if(a!=null){let h=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);h>=0||hn(!1),o=o.slice(0,Math.min(o.length,h+1))}let l=!1,c=-1;if(n&&s&&s.v7_partialHydration)for(let h=0;h<o.length;h++){let d=o[h];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=h),d.route.id){let{loaderData:f,errors:m}=n,g=d.route.loader&&f[d.route.id]===void 0&&(!m||m[d.route.id]===void 0);if(d.route.lazy||g){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((h,d,f)=>{let m,g=!1,v=null,_=null;n&&(m=a&&d.route.id?a[d.route.id]:void 0,v=d.route.errorElement||bj,l&&(c<0&&f===0?(Rj("route-fallback"),g=!0,_=null):c===f&&(g=!0,_=d.route.hydrateFallbackElement||null)));let x=e.concat(o.slice(0,f+1)),w=()=>{let C;return m?C=v:g?C=_:d.route.Component?C=ie.createElement(d.route.Component,null):d.route.element?C=d.route.element:C=h,ie.createElement(Ij,{match:d,routeContext:{outlet:h,matches:x,isDataRoute:n!=null},children:C})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?ie.createElement(Cj,{location:n.location,revalidation:n.revalidation,component:v,error:m,children:w(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):w()},null)}var bD=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(bD||{}),xg=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(xg||{});function Sj(t){let e=ie.useContext(x1);return e||hn(!1),e}function Tj(t){let e=ie.useContext(gj);return e||hn(!1),e}function Ej(t){let e=ie.useContext(Bl);return e||hn(!1),e}function CD(t){let e=Ej(),n=e.matches[e.matches.length-1];return n.route.id||hn(!1),n.route.id}function Nj(){var t;let e=ie.useContext(vD),n=Tj(xg.UseRouteError),s=CD(xg.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[s]}function $j(){let{router:t}=Sj(bD.UseNavigateStable),e=CD(xg.UseNavigateStable),n=ie.useRef(!1);return xD(()=>{n.current=!0}),ie.useCallback(function(i,r){r===void 0&&(r={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,wd({fromRouteId:e},r)))},[t,e])}const RE={};function Rj(t,e,n){RE[t]||(RE[t]=!0)}function Aj(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Ba(t){hn(!1)}function Dj(t){let{basename:e="/",children:n=null,location:s,navigationType:i=Do.Pop,navigator:r,static:o=!1,future:a}=t;Qd()&&hn(!1);let l=e.replace(/^\/*/,"/"),c=ie.useMemo(()=>({basename:l,navigator:r,static:o,future:wd({v7_relativeSplatPath:!1},a)}),[l,a,r,o]);typeof s=="string"&&(s=Iu(s));let{pathname:h="/",search:d="",hash:f="",state:m=null,key:g="default"}=s,v=ie.useMemo(()=>{let _=v1(h,l);return _==null?null:{location:{pathname:_,search:d,hash:f,state:m,key:g},navigationType:i}},[l,h,d,f,m,g,i]);return v==null?null:ie.createElement(zl.Provider,{value:c},ie.createElement(Fy.Provider,{children:n,value:v}))}function Pj(t){let{children:e,location:n}=t;return xj(c0(e),n)}new Promise(()=>{});function c0(t,e){e===void 0&&(e=[]);let n=[];return ie.Children.forEach(t,(s,i)=>{if(!ie.isValidElement(s))return;let r=[...e,i];if(s.type===ie.Fragment){n.push.apply(n,c0(s.props.children,r));return}s.type!==Ba&&hn(!1),!s.props.index||!s.props.children||hn(!1);let o={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=c0(s.props.children,r)),n.push(o)}),n}/**
 * React Router DOM v6.29.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function u0(){return u0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},u0.apply(this,arguments)}function Oj(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Lj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Fj(t,e){return t.button===0&&(!e||e==="_self")&&!Lj(t)}const Mj=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],zj="6";try{window.__reactRouterVersion=zj}catch{}const Bj="startTransition",AE=DW[Bj];function Uj(t){let{basename:e,children:n,future:s,window:i}=t,r=ie.useRef();r.current==null&&(r.current=GG({window:i,v5Compat:!0}));let o=r.current,[a,l]=ie.useState({action:o.action,location:o.location}),{v7_startTransition:c}=s||{},h=ie.useCallback(d=>{c&&AE?AE(()=>l(d)):l(d)},[l,c]);return ie.useLayoutEffect(()=>o.listen(h),[o,h]),ie.useEffect(()=>Aj(s),[s]),ie.createElement(Dj,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:s})}const Wj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Vj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gn=ie.forwardRef(function(e,n){let{onClick:s,relative:i,reloadDocument:r,replace:o,state:a,target:l,to:c,preventScrollReset:h,viewTransition:d}=e,f=Oj(e,Mj),{basename:m}=ie.useContext(zl),g,v=!1;if(typeof c=="string"&&Vj.test(c)&&(g=c,Wj))try{let C=new URL(window.location.href),I=c.startsWith("//")?new URL(C.protocol+c):new URL(c),S=v1(I.pathname,m);I.origin===C.origin&&S!=null?c=S+I.search+I.hash:v=!0}catch{}let _=yj(c,{relative:i}),x=Gj(c,{replace:o,state:a,target:l,preventScrollReset:h,relative:i,viewTransition:d});function w(C){s&&s(C),C.defaultPrevented||x(C)}return ie.createElement("a",u0({},f,{href:g||_,onClick:v||r?s:w,ref:n,target:l}))});var DE;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(DE||(DE={}));var PE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(PE||(PE={}));function Gj(t,e){let{target:n,replace:s,state:i,preventScrollReset:r,relative:o,viewTransition:a}=e===void 0?{}:e,l=_D(),c=My(),h=wD(t,{relative:o});return ie.useCallback(d=>{if(Fj(d,n)){d.preventDefault();let f=s!==void 0?s:vg(c)===vg(h);l(t,{replace:f,state:i,preventScrollReset:r,relative:o,viewTransition:a})}},[c,l,h,s,i,n,t,r,o,a])}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var jj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hj=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),zt=(t,e)=>{const n=ie.forwardRef(({color:s="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:a="",children:l,...c},h)=>ie.createElement("svg",{ref:h,...jj,width:i,height:i,stroke:s,strokeWidth:o?Number(r)*24/Number(i):r,className:["lucide",`lucide-${Hj(t)}`,a].join(" "),...c},[...e.map(([d,f])=>ie.createElement(d,f)),...Array.isArray(l)?l:[l]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0=zt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ID=zt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OE=zt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LE=zt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=zt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qj=zt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kj=zt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xj=zt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kD=zt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zj=zt("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FE=zt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yj=zt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qj=zt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d0=zt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jj=zt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eH=zt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tH=zt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nH=zt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ME=zt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zE=zt("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sH=zt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iH=zt("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=zt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rH=zt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var BE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge=function(t,e){if(!t)throw ku(e)},ku=function(t){return new Error("Firebase Database ("+SD.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},oH=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},_1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,c=l?t[i+2]:0,h=r>>2,d=(r&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),s.push(n[h],n[d],n[f],n[m])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(TD(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):oH(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const r=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const c=i<t.length?n[t.charAt(i)]:64;++i;const d=i<t.length?n[t.charAt(i)]:64;if(++i,r==null||a==null||c==null||d==null)throw new aH;const f=r<<2|a>>4;if(s.push(f),c!==64){const m=a<<4&240|c>>2;if(s.push(m),d!==64){const g=c<<6&192|d;s.push(g)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class aH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ED=function(t){const e=TD(t);return _1.encodeByteArray(e,!0)},wg=function(t){return ED(t).replace(/\./g,"")},bg=function(t){try{return _1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lH(t){return ND(void 0,t)}function ND(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!cH(n)||(t[n]=ND(t[n],e[n]));return t}function cH(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uH(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hH=()=>uH().__FIREBASE_DEFAULTS__,dH=()=>{if(typeof process>"u"||typeof BE>"u")return;const t=BE.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},fH=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&bg(t[1]);return e&&JSON.parse(e)},w1=()=>{try{return hH()||dH()||fH()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},$D=t=>{var e,n;return(n=(e=w1())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},pH=t=>{const e=$D(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},RD=()=>{var t;return(t=w1())===null||t===void 0?void 0:t.config},AD=t=>{var e;return(e=w1())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mH(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[wg(JSON.stringify(n)),wg(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function b1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fs())}function gH(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function DD(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function PD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function yH(){const t=fs();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function vH(){return SD.NODE_ADMIN===!0}function OD(){try{return typeof indexedDB=="object"}catch{return!1}}function LD(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(n){e(n)}})}function xH(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _H="FirebaseError";class Dr extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=_H,Object.setPrototypeOf(this,Dr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ul.prototype.create)}}class Ul{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?wH(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Dr(i,a,s)}}function wH(t,e){return t.replace(bH,(n,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const bH=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(t){return JSON.parse(t)}function Nn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=function(t){let e={},n={},s={},i="";try{const r=t.split(".");e=bd(bg(r[0])||""),n=bd(bg(r[1])||""),i=r[2],s=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:s,signature:i}},CH=function(t){const e=FD(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},IH=function(t){const e=FD(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ru(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function f0(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Cg(t,e,n){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=e.call(n,t[i],i,t));return s}function Cd(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const r=t[i],o=e[i];if(UE(r)&&UE(o)){if(!Cd(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function UE(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function $h(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function Rh(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kH{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let d=0;d<16;d++)s[d]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let d=16;d<80;d++){const f=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(f<<1|f>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let d=0;d<80;d++){d<40?d<20?(c=a^r&(o^a),h=1518500249):(c=r^o^a,h=1859775393):d<60?(c=r&o|a&(r|o),h=2400959708):(c=r^o^a,h=3395469782);const f=(i<<5|i>>>27)+c+l+h+s[d]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=i,i=f}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const s=n-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<n;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<n;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function SH(t,e){const n=new TH(t,e);return n.subscribe.bind(n)}class TH{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let i;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");EH(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:s},i.next===void 0&&(i.next=P_),i.error===void 0&&(i.error=P_),i.complete===void 0&&(i.complete=P_);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function EH(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function P_(){}function C1(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NH=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,ge(s<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},By=function(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $H=1e3,RH=2,AH=4*60*60*1e3,DH=.5;function WE(t,e=$H,n=RH){const s=e*Math.pow(n,t),i=Math.round(DH*s*(Math.random()-.5)*2);return Math.min(AH,s+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(t){return t&&t._delegate?t._delegate:t}class Xi{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PH{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new zy;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(LH(e))try{this.getOrInitializeService({instanceIdentifier:Ua})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=Ua){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ua){return this.instances.has(e)}getOptions(e=Ua){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,n){var s;const i=this.normalizeInstanceIdentifier(n),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const i of s)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:OH(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ua){return this.component?this.component.multipleInstances?e:Ua:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function OH(t){return t===Ua?void 0:t}function LH(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FH{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new PH(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(xt||(xt={}));const MH={debug:xt.DEBUG,verbose:xt.VERBOSE,info:xt.INFO,warn:xt.WARN,error:xt.ERROR,silent:xt.SILENT},zH=xt.INFO,BH={[xt.DEBUG]:"log",[xt.VERBOSE]:"log",[xt.INFO]:"info",[xt.WARN]:"warn",[xt.ERROR]:"error"},UH=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),i=BH[e];if(i)console[i](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Uy=class{constructor(e){this.name=e,this._logLevel=zH,this._logHandler=UH,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?MH[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xt.DEBUG,...e),this._logHandler(this,xt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xt.VERBOSE,...e),this._logHandler(this,xt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xt.INFO,...e),this._logHandler(this,xt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xt.WARN,...e),this._logHandler(this,xt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xt.ERROR,...e),this._logHandler(this,xt.ERROR,...e)}};const WH=(t,e)=>e.some(n=>t instanceof n);let VE,GE;function VH(){return VE||(VE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function GH(){return GE||(GE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const MD=new WeakMap,p0=new WeakMap,zD=new WeakMap,O_=new WeakMap,I1=new WeakMap;function jH(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(Ho(t.result)),i()},o=()=>{s(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&MD.set(n,t)}).catch(()=>{}),I1.set(e,t),e}function HH(t){if(p0.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),i()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});p0.set(t,e)}let m0={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return p0.get(t);if(e==="objectStoreNames")return t.objectStoreNames||zD.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ho(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function qH(t){m0=t(m0)}function KH(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(L_(this),e,...n);return zD.set(s,e.sort?e.sort():[e]),Ho(s)}:GH().includes(t)?function(...e){return t.apply(L_(this),e),Ho(MD.get(this))}:function(...e){return Ho(t.apply(L_(this),e))}}function XH(t){return typeof t=="function"?KH(t):(t instanceof IDBTransaction&&HH(t),WH(t,VH())?new Proxy(t,m0):t)}function Ho(t){if(t instanceof IDBRequest)return jH(t);if(O_.has(t))return O_.get(t);const e=XH(t);return e!==t&&(O_.set(t,e),I1.set(e,t)),e}const L_=t=>I1.get(t);function BD(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=Ho(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Ho(o.result),l.oldVersion,l.newVersion,Ho(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const ZH=["get","getKey","getAll","getAllKeys","count"],YH=["put","add","delete","clear"],F_=new Map;function jE(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(F_.get(e))return F_.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=YH.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||ZH.includes(n)))return;const r=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return F_.set(e,r),r}qH(t=>({...t,get:(e,n,s)=>jE(e,n)||t.get(e,n,s),has:(e,n)=>!!jE(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QH{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(JH(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function JH(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const g0="@firebase/app",HE="0.10.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const io=new Uy("@firebase/app"),e6="@firebase/app-compat",t6="@firebase/analytics-compat",n6="@firebase/analytics",s6="@firebase/app-check-compat",i6="@firebase/app-check",r6="@firebase/auth",o6="@firebase/auth-compat",a6="@firebase/database",l6="@firebase/data-connect",c6="@firebase/database-compat",u6="@firebase/functions",h6="@firebase/functions-compat",d6="@firebase/installations",f6="@firebase/installations-compat",p6="@firebase/messaging",m6="@firebase/messaging-compat",g6="@firebase/performance",y6="@firebase/performance-compat",v6="@firebase/remote-config",x6="@firebase/remote-config-compat",_6="@firebase/storage",w6="@firebase/storage-compat",b6="@firebase/firestore",C6="@firebase/vertexai",I6="@firebase/firestore-compat",k6="firebase",S6="11.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y0="[DEFAULT]",T6={[g0]:"fire-core",[e6]:"fire-core-compat",[n6]:"fire-analytics",[t6]:"fire-analytics-compat",[i6]:"fire-app-check",[s6]:"fire-app-check-compat",[r6]:"fire-auth",[o6]:"fire-auth-compat",[a6]:"fire-rtdb",[l6]:"fire-data-connect",[c6]:"fire-rtdb-compat",[u6]:"fire-fn",[h6]:"fire-fn-compat",[d6]:"fire-iid",[f6]:"fire-iid-compat",[p6]:"fire-fcm",[m6]:"fire-fcm-compat",[g6]:"fire-perf",[y6]:"fire-perf-compat",[v6]:"fire-rc",[x6]:"fire-rc-compat",[_6]:"fire-gcs",[w6]:"fire-gcs-compat",[b6]:"fire-fst",[I6]:"fire-fst-compat",[C6]:"fire-vertex","fire-js":"fire-js",[k6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Id=new Map,E6=new Map,v0=new Map;function qE(t,e){try{t.container.addComponent(e)}catch(n){io.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tr(t){const e=t.name;if(v0.has(e))return io.debug(`There were multiple attempts to register component ${e}.`),!1;v0.set(e,t);for(const n of Id.values())qE(n,t);for(const n of E6.values())qE(n,t);return!0}function Wl(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function mr(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N6={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qo=new Ul("app","Firebase",N6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Xi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu=S6;function k1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:y0,automaticDataCollectionEnabled:!1},e),i=s.name;if(typeof i!="string"||!i)throw qo.create("bad-app-name",{appName:String(i)});if(n||(n=RD()),!n)throw qo.create("no-options");const r=Id.get(i);if(r){if(Cd(n,r.options)&&Cd(s,r.config))return r;throw qo.create("duplicate-app",{appName:i})}const o=new FH(i);for(const l of v0.values())o.addComponent(l);const a=new $6(n,s,o);return Id.set(i,a),a}function Wy(t=y0){const e=Id.get(t);if(!e&&t===y0&&RD())return k1();if(!e)throw qo.create("no-app",{appName:t});return e}function R6(){return Array.from(Id.values())}function gi(t,e,n){var s;let i=(s=T6[t])!==null&&s!==void 0?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),io.warn(a.join(" "));return}Tr(new Xi(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A6="firebase-heartbeat-database",D6=1,kd="firebase-heartbeat-store";let M_=null;function UD(){return M_||(M_=BD(A6,D6,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(kd)}catch(n){console.warn(n)}}}}).catch(t=>{throw qo.create("idb-open",{originalErrorMessage:t.message})})),M_}async function P6(t){try{const n=(await UD()).transaction(kd),s=await n.objectStore(kd).get(WD(t));return await n.done,s}catch(e){if(e instanceof Dr)io.warn(e.message);else{const n=qo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});io.warn(n.message)}}}async function KE(t,e){try{const s=(await UD()).transaction(kd,"readwrite");await s.objectStore(kd).put(e,WD(t)),await s.done}catch(n){if(n instanceof Dr)io.warn(n.message);else{const s=qo.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});io.warn(s.message)}}}function WD(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O6=1024,L6=30*24*60*60*1e3;class F6{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new z6(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=XE();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=L6}),this._storage.overwrite(this._heartbeatsCache))}catch(s){io.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=XE(),{heartbeatsToSend:s,unsentEntries:i}=M6(this._heartbeatsCache.heartbeats),r=wg(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(n){return io.warn(n),""}}}function XE(){return new Date().toISOString().substring(0,10)}function M6(t,e=O6){const n=[];let s=t.slice();for(const i of t){const r=n.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),ZE(n)>e){r.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ZE(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class z6{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return OD()?LD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await P6(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return KE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return KE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function ZE(t){return wg(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B6(t){Tr(new Xi("platform-logger",e=>new QH(e),"PRIVATE")),Tr(new Xi("heartbeat",e=>new F6(e),"PRIVATE")),gi(g0,HE,t),gi(g0,HE,"esm2017"),gi("fire-js","")}B6("");var U6="firebase",W6="11.2.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gi(U6,W6,"app");const VD="@firebase/installations",S1="0.6.12";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD=1e4,jD=`w:${S1}`,HD="FIS_v2",V6="https://firebaseinstallations.googleapis.com/v1",G6=60*60*1e3,j6="installations",H6="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q6={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},pl=new Ul(j6,H6,q6);function qD(t){return t instanceof Dr&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KD({projectId:t}){return`${V6}/projects/${t}/installations`}function XD(t){return{token:t.token,requestStatus:2,expiresIn:X6(t.expiresIn),creationTime:Date.now()}}async function ZD(t,e){const s=(await e.json()).error;return pl.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function YD({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function K6(t,{refreshToken:e}){const n=YD(t);return n.append("Authorization",Z6(e)),n}async function QD(t){const e=await t();return e.status>=500&&e.status<600?t():e}function X6(t){return Number(t.replace("s","000"))}function Z6(t){return`${HD} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y6({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const s=KD(t),i=YD(t),r=e.getImmediate({optional:!0});if(r){const c=await r.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={fid:n,authVersion:HD,appId:t.appId,sdkVersion:jD},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await QD(()=>fetch(s,a));if(l.ok){const c=await l.json();return{fid:c.fid||n,registrationStatus:2,refreshToken:c.refreshToken,authToken:XD(c.authToken)}}else throw await ZD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JD(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q6(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J6=/^[cdef][\w-]{21}$/,x0="";function e5(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=t5(t);return J6.test(n)?n:x0}catch{return x0}}function t5(t){return Q6(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vy(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP=new Map;function tP(t,e){const n=Vy(t);nP(n,e),n5(n,e)}function nP(t,e){const n=eP.get(t);if(n)for(const s of n)s(e)}function n5(t,e){const n=s5();n&&n.postMessage({key:t,fid:e}),i5()}let Ya=null;function s5(){return!Ya&&"BroadcastChannel"in self&&(Ya=new BroadcastChannel("[Firebase] FID Change"),Ya.onmessage=t=>{nP(t.data.key,t.data.fid)}),Ya}function i5(){eP.size===0&&Ya&&(Ya.close(),Ya=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r5="firebase-installations-database",o5=1,ml="firebase-installations-store";let z_=null;function T1(){return z_||(z_=BD(r5,o5,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(ml)}}})),z_}async function Ig(t,e){const n=Vy(t),i=(await T1()).transaction(ml,"readwrite"),r=i.objectStore(ml),o=await r.get(n);return await r.put(e,n),await i.done,(!o||o.fid!==e.fid)&&tP(t,e.fid),e}async function sP(t){const e=Vy(t),s=(await T1()).transaction(ml,"readwrite");await s.objectStore(ml).delete(e),await s.done}async function Gy(t,e){const n=Vy(t),i=(await T1()).transaction(ml,"readwrite"),r=i.objectStore(ml),o=await r.get(n),a=e(o);return a===void 0?await r.delete(n):await r.put(a,n),await i.done,a&&(!o||o.fid!==a.fid)&&tP(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E1(t){let e;const n=await Gy(t.appConfig,s=>{const i=a5(s),r=l5(t,i);return e=r.registrationPromise,r.installationEntry});return n.fid===x0?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function a5(t){const e=t||{fid:e5(),registrationStatus:0};return iP(e)}function l5(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(pl.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=c5(t,n);return{installationEntry:n,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:u5(t)}:{installationEntry:e}}async function c5(t,e){try{const n=await Y6(t,e);return Ig(t.appConfig,n)}catch(n){throw qD(n)&&n.customData.serverCode===409?await sP(t.appConfig):await Ig(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function u5(t){let e=await YE(t.appConfig);for(;e.registrationStatus===1;)await JD(100),e=await YE(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:s}=await E1(t);return s||n}return e}function YE(t){return Gy(t,e=>{if(!e)throw pl.create("installation-not-found");return iP(e)})}function iP(t){return h5(t)?{fid:t.fid,registrationStatus:0}:t}function h5(t){return t.registrationStatus===1&&t.registrationTime+GD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d5({appConfig:t,heartbeatServiceProvider:e},n){const s=f5(t,n),i=K6(t,n),r=e.getImmediate({optional:!0});if(r){const c=await r.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={installation:{sdkVersion:jD,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await QD(()=>fetch(s,a));if(l.ok){const c=await l.json();return XD(c)}else throw await ZD("Generate Auth Token",l)}function f5(t,{fid:e}){return`${KD(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N1(t,e=!1){let n;const s=await Gy(t.appConfig,r=>{if(!rP(r))throw pl.create("not-registered");const o=r.authToken;if(!e&&g5(o))return r;if(o.requestStatus===1)return n=p5(t,e),r;{if(!navigator.onLine)throw pl.create("app-offline");const a=v5(r);return n=m5(t,a),a}});return n?await n:s.authToken}async function p5(t,e){let n=await QE(t.appConfig);for(;n.authToken.requestStatus===1;)await JD(100),n=await QE(t.appConfig);const s=n.authToken;return s.requestStatus===0?N1(t,e):s}function QE(t){return Gy(t,e=>{if(!rP(e))throw pl.create("not-registered");const n=e.authToken;return x5(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function m5(t,e){try{const n=await d5(t,e),s=Object.assign(Object.assign({},e),{authToken:n});return await Ig(t.appConfig,s),n}catch(n){if(qD(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await sP(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ig(t.appConfig,s)}throw n}}function rP(t){return t!==void 0&&t.registrationStatus===2}function g5(t){return t.requestStatus===2&&!y5(t)}function y5(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+G6}function v5(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function x5(t){return t.requestStatus===1&&t.requestTime+GD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _5(t){const e=t,{installationEntry:n,registrationPromise:s}=await E1(e);return s?s.catch(console.error):N1(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w5(t,e=!1){const n=t;return await b5(n),(await N1(n,e)).token}async function b5(t){const{registrationPromise:e}=await E1(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C5(t){if(!t||!t.options)throw B_("App Configuration");if(!t.name)throw B_("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw B_(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function B_(t){return pl.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP="installations",I5="installations-internal",k5=t=>{const e=t.getProvider("app").getImmediate(),n=C5(e),s=Wl(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},S5=t=>{const e=t.getProvider("app").getImmediate(),n=Wl(e,oP).getImmediate();return{getId:()=>_5(n),getToken:i=>w5(n,i)}};function T5(){Tr(new Xi(oP,k5,"PUBLIC")),Tr(new Xi(I5,S5,"PRIVATE"))}T5();gi(VD,S1);gi(VD,S1,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kg="analytics",E5="firebase_id",N5="origin",$5=60*1e3,R5="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",$1="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs=new Uy("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A5={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Gs=new Ul("analytics","Analytics",A5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D5(t){if(!t.startsWith($1)){const e=Gs.create("invalid-gtag-resource",{gtagURL:t});return Rs.warn(e.message),""}return t}function aP(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function P5(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function O5(t,e){const n=P5("firebase-js-sdk-policy",{createScriptURL:D5}),s=document.createElement("script"),i=`${$1}?l=${t}&id=${e}`;s.src=n?n==null?void 0:n.createScriptURL(i):i,s.async=!0,document.head.appendChild(s)}function L5(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function F5(t,e,n,s,i,r){const o=s[i];try{if(o)await e[o];else{const l=(await aP(n)).find(c=>c.measurementId===i);l&&await e[l.appId]}}catch(a){Rs.error(a)}t("config",i,r)}async function M5(t,e,n,s,i){try{let r=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await aP(n);for(const l of o){const c=a.find(d=>d.measurementId===l),h=c&&e[c.appId];if(h)r.push(h);else{r=[];break}}}r.length===0&&(r=Object.values(e)),await Promise.all(r),t("event",s,i||{})}catch(r){Rs.error(r)}}function z5(t,e,n,s){async function i(r,...o){try{if(r==="event"){const[a,l]=o;await M5(t,e,n,a,l)}else if(r==="config"){const[a,l]=o;await F5(t,e,n,s,a,l)}else if(r==="consent"){const[a,l]=o;t("consent",a,l)}else if(r==="get"){const[a,l,c]=o;t("get",a,l,c)}else if(r==="set"){const[a]=o;t("set",a)}else t(r,...o)}catch(a){Rs.error(a)}}return i}function B5(t,e,n,s,i){let r=function(...o){window[s].push(arguments)};return window[i]&&typeof window[i]=="function"&&(r=window[i]),window[i]=z5(r,t,e,n),{gtagCore:r,wrappedGtag:window[i]}}function U5(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes($1)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W5=30,V5=1e3;class G5{constructor(e={},n=V5){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const lP=new G5;function j5(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function H5(t){var e;const{appId:n,apiKey:s}=t,i={method:"GET",headers:j5(s)},r=R5.replace("{app-id}",n),o=await fetch(r,i);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw Gs.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function q5(t,e=lP,n){const{appId:s,apiKey:i,measurementId:r}=t.options;if(!s)throw Gs.create("no-app-id");if(!i){if(r)return{measurementId:r,appId:s};throw Gs.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Z5;return setTimeout(async()=>{a.abort()},$5),cP({appId:s,apiKey:i,measurementId:r},o,a,e)}async function cP(t,{throttleEndTimeMillis:e,backoffCount:n},s,i=lP){var r;const{appId:o,measurementId:a}=t;try{await K5(s,e)}catch(l){if(a)return Rs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw l}try{const l=await H5(t);return i.deleteThrottleMetadata(o),l}catch(l){const c=l;if(!X5(c)){if(i.deleteThrottleMetadata(o),a)return Rs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:o,measurementId:a};throw l}const h=Number((r=c==null?void 0:c.customData)===null||r===void 0?void 0:r.httpStatus)===503?WE(n,i.intervalMillis,W5):WE(n,i.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return i.setThrottleMetadata(o,d),Rs.debug(`Calling attemptFetch again in ${h} millis`),cP(t,d,s,i)}}function K5(t,e){return new Promise((n,s)=>{const i=Math.max(e-Date.now(),0),r=setTimeout(n,i);t.addEventListener(()=>{clearTimeout(r),s(Gs.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function X5(t){if(!(t instanceof Dr)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class Z5{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Y5(t,e,n,s,i){if(i&&i.global){t("event",n,s);return}else{const r=await e,o=Object.assign(Object.assign({},s),{send_to:r});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q5(){if(OD())try{await LD()}catch(t){return Rs.warn(Gs.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Rs.warn(Gs.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function J5(t,e,n,s,i,r,o){var a;const l=q5(t);l.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&Rs.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>Rs.error(m)),e.push(l);const c=Q5().then(m=>{if(m)return s.getId()}),[h,d]=await Promise.all([l,c]);U5(r)||O5(r,h.measurementId),i("js",new Date);const f=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return f[N5]="firebase",f.update=!0,d!=null&&(f[E5]=d),i("config",h.measurementId,f),h.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eq{constructor(e){this.app=e}_delete(){return delete qh[this.app.options.appId],Promise.resolve()}}let qh={},JE=[];const eN={};let U_="dataLayer",tq="gtag",tN,uP,nN=!1;function nq(){const t=[];if(DD()&&t.push("This is a browser extension environment."),xH()||t.push("Cookies are not available."),t.length>0){const e=t.map((s,i)=>`(${i+1}) ${s}`).join(" "),n=Gs.create("invalid-analytics-context",{errorInfo:e});Rs.warn(n.message)}}function sq(t,e,n){nq();const s=t.options.appId;if(!s)throw Gs.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Rs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Gs.create("no-api-key");if(qh[s]!=null)throw Gs.create("already-exists",{id:s});if(!nN){L5(U_);const{wrappedGtag:r,gtagCore:o}=B5(qh,JE,eN,U_,tq);uP=r,tN=o,nN=!0}return qh[s]=J5(t,JE,eN,e,tN,U_,n),new eq(t)}function iq(t=Wy()){t=Dn(t);const e=Wl(t,kg);return e.isInitialized()?e.getImmediate():rq(t)}function rq(t,e={}){const n=Wl(t,kg);if(n.isInitialized()){const i=n.getImmediate();if(Cd(e,n.getOptions()))return i;throw Gs.create("already-initialized")}return n.initialize({options:e})}function oq(t,e,n,s){t=Dn(t),Y5(uP,qh[t.app.options.appId],e,n,s).catch(i=>Rs.error(i))}const sN="@firebase/analytics",iN="0.10.11";function aq(){Tr(new Xi(kg,(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return sq(s,i,n)},"PUBLIC")),Tr(new Xi("analytics-internal",t,"PRIVATE")),gi(sN,iN),gi(sN,iN,"esm2017");function t(e){try{const n=e.getProvider(kg).getImmediate();return{logEvent:(s,i,r)=>oq(n,s,i,r)}}catch(n){throw Gs.create("interop-component-reg-failed",{reason:n})}}}aq();function R1(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n}function hP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const lq=hP,dP=new Ul("auth","Firebase",hP());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sg=new Uy("@firebase/auth");function cq(t,...e){Sg.logLevel<=xt.WARN&&Sg.warn(`Auth (${Tu}): ${t}`,...e)}function Bm(t,...e){Sg.logLevel<=xt.ERROR&&Sg.error(`Auth (${Tu}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zi(t,...e){throw A1(t,...e)}function xr(t,...e){return A1(t,...e)}function fP(t,e,n){const s=Object.assign(Object.assign({},lq()),{[e]:n});return new Ul("auth","Firebase",s).create(e,{appName:t.name})}function Qr(t){return fP(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function A1(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return dP.create(t,...e)}function Oe(t,e,...n){if(!t)throw A1(e,...n)}function Hr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Bm(e),new Error(e)}function ro(t,e){t||Hr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _0(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function uq(){return rN()==="http:"||rN()==="https:"}function rN(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hq(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uq()||DD()||"connection"in navigator)?navigator.onLine:!0}function dq(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e,n){this.shortDelay=e,this.longDelay=n,ro(n>e,"Short delay should be less than long delay!"),this.isMobile=b1()||PD()}get(){return hq()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D1(t,e){ro(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Hr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Hr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Hr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fq={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pq=new Jd(3e4,6e4);function pa(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function ma(t,e,n,s,i={}){return mP(t,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const a=Su(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const c=Object.assign({method:e,headers:l},r);return gH()||(c.referrerPolicy="no-referrer"),pP.fetch()(gP(t,t.config.apiHost,n,a),c)})}async function mP(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},fq),e);try{const i=new gq(t),r=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw hm(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw hm(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw hm(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw hm(t,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw fP(t,h,c);Zi(t,h)}}catch(i){if(i instanceof Dr)throw i;Zi(t,"network-request-failed",{message:String(i)})}}async function ef(t,e,n,s,i={}){const r=await ma(t,e,n,s,i);return"mfaPendingCredential"in r&&Zi(t,"multi-factor-auth-required",{_serverResponse:r}),r}function gP(t,e,n,s){const i=`${e}${n}?${s}`;return t.config.emulator?D1(t.config,i):`${t.config.apiScheme}://${i}`}function mq(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class gq{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(xr(this.auth,"network-request-failed")),pq.get())})}}function hm(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=xr(t,e,s);return i.customData._tokenResponse=n,i}function oN(t){return t!==void 0&&t.enterprise!==void 0}class yq{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return mq(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function vq(t,e){return ma(t,"GET","/v2/recaptchaConfig",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xq(t,e){return ma(t,"POST","/v1/accounts:delete",e)}async function yP(t,e){return ma(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function _q(t,e=!1){const n=Dn(t),s=await n.getIdToken(e),i=P1(s);Oe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Kh(W_(i.auth_time)),issuedAtTime:Kh(W_(i.iat)),expirationTime:Kh(W_(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function W_(t){return Number(t)*1e3}function P1(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return Bm("JWT malformed, contained fewer than 3 sections"),null;try{const i=bg(n);return i?JSON.parse(i):(Bm("Failed to decode base64 JWT payload"),null)}catch(i){return Bm("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function aN(t){const e=P1(t);return Oe(e,"internal-error"),Oe(typeof e.exp<"u","internal-error"),Oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sd(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof Dr&&wq(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function wq({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Kh(this.lastLoginAt),this.creationTime=Kh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tg(t){var e;const n=t.auth,s=await t.getIdToken(),i=await Sd(t,yP(n,{idToken:s}));Oe(i==null?void 0:i.users.length,n,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?vP(r.providerUserInfo):[],a=Iq(t.providerData,o),l=t.isAnonymous,c=!(t.email&&r.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new w0(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(t,d)}async function Cq(t){const e=Dn(t);await Tg(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Iq(t,e){return[...t.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function vP(t){return t.map(e=>{var{providerId:n}=e,s=R1(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kq(t,e){const n=await mP(t,{},async()=>{const s=Su({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,o=gP(t,i,"/v1/token",`key=${r}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",pP.fetch()(o,{method:"POST",headers:a,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Sq(t,e){return ma(t,"POST","/v2/accounts:revokeToken",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oe(e.idToken,"internal-error"),Oe(typeof e.idToken<"u","internal-error"),Oe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):aN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Oe(e.length!==0,"internal-error");const n=aN(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:i,expiresIn:r}=await kq(e,n);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:i,expirationTime:r}=n,o=new Wc;return s&&(Oe(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(Oe(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(Oe(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Wc,this.toJSON())}_performRefresh(){return Hr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wo(t,e){Oe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class qr{constructor(e){var{uid:n,auth:s,stsTokenManager:i}=e,r=R1(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new bq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new w0(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await Sd(this,this.stsTokenManager.getToken(this.auth,e));return Oe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return _q(this,e)}reload(){return Cq(this)}_assign(e){this!==e&&(Oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new qr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Tg(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(mr(this.auth.app))return Promise.reject(Qr(this.auth));const e=await this.getIdToken();return await Sd(this,xq(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,i,r,o,a,l,c,h;const d=(s=n.displayName)!==null&&s!==void 0?s:void 0,f=(i=n.email)!==null&&i!==void 0?i:void 0,m=(r=n.phoneNumber)!==null&&r!==void 0?r:void 0,g=(o=n.photoURL)!==null&&o!==void 0?o:void 0,v=(a=n.tenantId)!==null&&a!==void 0?a:void 0,_=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,x=(c=n.createdAt)!==null&&c!==void 0?c:void 0,w=(h=n.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:C,emailVerified:I,isAnonymous:S,providerData:T,stsTokenManager:E}=n;Oe(C&&E,e,"internal-error");const $=Wc.fromJSON(this.name,E);Oe(typeof C=="string",e,"internal-error"),wo(d,e.name),wo(f,e.name),Oe(typeof I=="boolean",e,"internal-error"),Oe(typeof S=="boolean",e,"internal-error"),wo(m,e.name),wo(g,e.name),wo(v,e.name),wo(_,e.name),wo(x,e.name),wo(w,e.name);const D=new qr({uid:C,auth:e,email:f,emailVerified:I,displayName:d,isAnonymous:S,photoURL:g,phoneNumber:m,tenantId:v,stsTokenManager:$,createdAt:x,lastLoginAt:w});return T&&Array.isArray(T)&&(D.providerData=T.map(P=>Object.assign({},P))),_&&(D._redirectEventId=_),D}static async _fromIdTokenResponse(e,n,s=!1){const i=new Wc;i.updateFromServerResponse(n);const r=new qr({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Tg(r),r}static async _fromGetAccountInfoResponse(e,n,s){const i=n.users[0];Oe(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?vP(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),a=new Wc;a.updateFromIdToken(s);const l=new qr({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new w0(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lN=new Map;function Kr(t){ro(t instanceof Function,"Expected a class definition");let e=lN.get(t);return e?(ro(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,lN.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}xP.type="NONE";const cN=xP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Um(t,e,n){return`firebase:${t}:${e}:${n}`}class Vc{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=Um(this.userKey,i.apiKey,r),this.fullPersistenceKey=Um("persistence",i.apiKey,r),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?qr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Vc(Kr(cN),e,s);const i=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let r=i[0]||Kr(cN);const o=Um(s,e.config.apiKey,e.name);let a=null;for(const c of n)try{const h=await c._get(o);if(h){const d=qr._fromJSON(e,h);c!==r&&(a=d),r=c;break}}catch{}const l=i.filter(c=>c._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new Vc(r,e,s):(r=l[0],a&&await r._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==r)try{await c._remove(o)}catch{}})),new Vc(r,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uN(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(CP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_P(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(kP(e))return"Blackberry";if(SP(e))return"Webos";if(wP(e))return"Safari";if((e.includes("chrome/")||bP(e))&&!e.includes("edge/"))return"Chrome";if(IP(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function _P(t=fs()){return/firefox\//i.test(t)}function wP(t=fs()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bP(t=fs()){return/crios\//i.test(t)}function CP(t=fs()){return/iemobile/i.test(t)}function IP(t=fs()){return/android/i.test(t)}function kP(t=fs()){return/blackberry/i.test(t)}function SP(t=fs()){return/webos/i.test(t)}function O1(t=fs()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Tq(t=fs()){var e;return O1(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Eq(){return yH()&&document.documentMode===10}function TP(t=fs()){return O1(t)||IP(t)||SP(t)||kP(t)||/windows phone/i.test(t)||CP(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EP(t,e=[]){let n;switch(t){case"Browser":n=uN(fs());break;case"Worker":n=`${uN(fs())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Tu}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nq{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=r=>new Promise((o,a)=>{try{const l=e(r);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $q(t,e={}){return ma(t,"GET","/v2/passwordPolicy",pa(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rq=6;class Aq{constructor(e){var n,s,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:Rq,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,i,r,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(r=l.containsUppercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dq{constructor(e,n,s,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hN(this),this.idTokenSubscription=new hN(this),this.beforeStateQueue=new Nq(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Kr(n)),this._initializationPromise=this.queue(async()=>{var s,i;if(!this._deleted&&(this.persistenceManager=await Vc.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await yP(this,{idToken:e}),s=await qr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(mr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let i=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Tg(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=dq()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(mr(this.app))return Promise.reject(Qr(this));const n=e?Dn(e):null;return n&&Oe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return mr(this.app)?Promise.reject(Qr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return mr(this.app)?Promise.reject(Qr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Kr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $q(this),n=new Aq(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ul("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await Sq(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Kr(e)||this._popupRedirectResolver;Oe(n,this,"argument-error"),this.redirectPersistenceManager=await Vc.create(this,[Kr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,i){if(this._deleted)return()=>{};const r=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oe(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,s,i);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=EP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&cq(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Vl(t){return Dn(t)}class hN{constructor(e){this.auth=e,this.observer=null,this.addObserver=SH(n=>this.observer=n)}get next(){return Oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Pq(t){jy=t}function NP(t){return jy.loadJS(t)}function Oq(){return jy.recaptchaEnterpriseScript}function Lq(){return jy.gapiScript}function Fq(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Mq{constructor(){this.enterprise=new zq}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class zq{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Bq="recaptcha-enterprise",$P="NO_RECAPTCHA";class Uq{constructor(e){this.type=Bq,this.auth=Vl(e)}async verify(e="verify",n=!1){async function s(r){if(!n){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,a)=>{vq(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new yq(l);return r.tenantId==null?r._agentRecaptchaConfig=c:r._tenantRecaptchaConfigs[r.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function i(r,o,a){const l=window.grecaptcha;oN(l)?l.enterprise.ready(()=>{l.enterprise.execute(r,{action:e}).then(c=>{o(c)}).catch(()=>{o($P)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Mq().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(a=>{if(!n&&oN(window.grecaptcha))i(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Oq();l.length!==0&&(l+=a),NP(l).then(()=>{i(a,r,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function dN(t,e,n,s=!1,i=!1){const r=new Uq(t);let o;if(i)o=$P;else try{o=await r.verify(n)}catch{o=await r.verify(n,!0)}const a=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function b0(t,e,n,s,i){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await dN(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await dN(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wq(t,e){const n=Wl(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),r=n.getOptions();if(Cd(r,e??{}))return i;Zi(i,"already-initialized")}return n.initialize({options:e})}function Vq(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Kr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Gq(t,e,n){const s=Vl(t);Oe(s._canInitEmulator,s,"emulator-config-failed"),Oe(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=RP(e),{host:o,port:a}=jq(e),l=a===null?"":`:${a}`;s.config.emulator={url:`${r}//${o}${l}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})}),Hq()}function RP(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function jq(t){const e=RP(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:fN(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:fN(o)}}}function fN(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Hq(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Hr("not implemented")}_getIdTokenResponse(e){return Hr("not implemented")}_linkToIdToken(e,n){return Hr("not implemented")}_getReauthenticationResolver(e){return Hr("not implemented")}}async function qq(t,e){return ma(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kq(t,e){return ef(t,"POST","/v1/accounts:signInWithPassword",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xq(t,e){return ef(t,"POST","/v1/accounts:signInWithEmailLink",pa(t,e))}async function Zq(t,e){return ef(t,"POST","/v1/accounts:signInWithEmailLink",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td extends L1{constructor(e,n,s,i=null){super("password",s),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Td(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Td(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return b0(e,n,"signInWithPassword",Kq);case"emailLink":return Xq(e,{email:this._email,oobCode:this._password});default:Zi(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return b0(e,s,"signUpPassword",qq);case"emailLink":return Zq(e,{idToken:n,email:this._email,oobCode:this._password});default:Zi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gc(t,e){return ef(t,"POST","/v1/accounts:signInWithIdp",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yq="http://localhost";class gl extends L1{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new gl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Zi("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i}=n,r=R1(n,["providerId","signInMethod"]);if(!s||!i)return null;const o=new gl(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Gc(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,Gc(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Gc(e,n)}buildRequest(){const e={requestUri:Yq,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Su(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qq(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Jq(t){const e=$h(Rh(t)).link,n=e?$h(Rh(e)).deep_link_id:null,s=$h(Rh(t)).deep_link_id;return(s?$h(Rh(s)).link:null)||s||n||e||t}class F1{constructor(e){var n,s,i,r,o,a;const l=$h(Rh(e)),c=(n=l.apiKey)!==null&&n!==void 0?n:null,h=(s=l.oobCode)!==null&&s!==void 0?s:null,d=Qq((i=l.mode)!==null&&i!==void 0?i:null);Oe(c&&h&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=h,this.continueUrl=(r=l.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=Jq(e);try{return new F1(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(){this.providerId=Eu.PROVIDER_ID}static credential(e,n){return Td._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=F1.parseLink(n);return Oe(s,"argument-error"),Td._fromEmailAndCode(e,s.code,s.tenantId)}}Eu.PROVIDER_ID="password";Eu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Eu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf extends AP{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To extends tf{constructor(){super("facebook.com")}static credential(e){return gl._fromParams({providerId:To.PROVIDER_ID,signInMethod:To.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return To.credentialFromTaggedObject(e)}static credentialFromError(e){return To.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return To.credential(e.oauthAccessToken)}catch{return null}}}To.FACEBOOK_SIGN_IN_METHOD="facebook.com";To.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo extends tf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return gl._fromParams({providerId:Eo.PROVIDER_ID,signInMethod:Eo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Eo.credentialFromTaggedObject(e)}static credentialFromError(e){return Eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return Eo.credential(n,s)}catch{return null}}}Eo.GOOGLE_SIGN_IN_METHOD="google.com";Eo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No extends tf{constructor(){super("github.com")}static credential(e){return gl._fromParams({providerId:No.PROVIDER_ID,signInMethod:No.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return No.credentialFromTaggedObject(e)}static credentialFromError(e){return No.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return No.credential(e.oauthAccessToken)}catch{return null}}}No.GITHUB_SIGN_IN_METHOD="github.com";No.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends tf{constructor(){super("twitter.com")}static credential(e,n){return gl._fromParams({providerId:$o.PROVIDER_ID,signInMethod:$o.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return $o.credentialFromTaggedObject(e)}static credentialFromError(e){return $o.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return $o.credential(n,s)}catch{return null}}}$o.TWITTER_SIGN_IN_METHOD="twitter.com";$o.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eK(t,e){return ef(t,"POST","/v1/accounts:signUp",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,i=!1){const r=await qr._fromIdTokenResponse(e,s,i),o=pN(s);return new yl({user:r,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const i=pN(s);return new yl({user:e,providerId:i,_tokenResponse:s,operationType:n})}}function pN(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends Dr{constructor(e,n,s,i){var r;super(n.code,n.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,Eg.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,i){return new Eg(e,n,s,i)}}function DP(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Eg._fromErrorAndOperation(t,r,e,s):r})}async function tK(t,e,n=!1){const s=await Sd(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return yl._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nK(t,e,n=!1){const{auth:s}=t;if(mr(s.app))return Promise.reject(Qr(s));const i="reauthenticate";try{const r=await Sd(t,DP(s,i,e,t),n);Oe(r.idToken,s,"internal-error");const o=P1(r.idToken);Oe(o,s,"internal-error");const{sub:a}=o;return Oe(t.uid===a,s,"user-mismatch"),yl._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Zi(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PP(t,e,n=!1){if(mr(t.app))return Promise.reject(Qr(t));const s="signIn",i=await DP(t,s,e),r=await yl._fromIdTokenResponse(t,s,i);return n||await t._updateCurrentUser(r.user),r}async function sK(t,e){return PP(Vl(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OP(t){const e=Vl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function iK(t,e,n){if(mr(t.app))return Promise.reject(Qr(t));const s=Vl(t),o=await b0(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eK).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&OP(t),l}),a=await yl._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function rK(t,e,n){return mr(t.app)?Promise.reject(Qr(t)):sK(Dn(t),Eu.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&OP(t),s})}function oK(t,e,n,s){return Dn(t).onIdTokenChanged(e,n,s)}function aK(t,e,n){return Dn(t).beforeAuthStateChanged(e,n)}function lK(t,e,n,s){return Dn(t).onAuthStateChanged(e,n,s)}function cK(t){return Dn(t).signOut()}const Ng="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ng,"1"),this.storage.removeItem(Ng),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uK=1e3,hK=10;class FP extends LP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=TP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),i=this.localCache[n];s!==i&&e(n,i,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);Eq()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,hK):i()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},uK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}FP.type="LOCAL";const dK=FP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP extends LP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}MP.type="SESSION";const zP=MP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fK(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const s=new Hy(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:i,data:r}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const a=Array.from(o).map(async c=>c(n.origin,r)),l=await fK(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M1(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pK{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((a,l)=>{const c=M1("",20);i.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(d){const f=d;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(f.data.response);break;default:clearTimeout(h),clearTimeout(r),l(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(){return window}function mK(t){_r().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BP(){return typeof _r().WorkerGlobalScope<"u"&&typeof _r().importScripts=="function"}async function gK(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function yK(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function vK(){return BP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP="firebaseLocalStorageDb",xK=1,$g="firebaseLocalStorage",WP="fbase_key";class nf{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function qy(t,e){return t.transaction([$g],e?"readwrite":"readonly").objectStore($g)}function _K(){const t=indexedDB.deleteDatabase(UP);return new nf(t).toPromise()}function C0(){const t=indexedDB.open(UP,xK);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore($g,{keyPath:WP})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains($g)?e(s):(s.close(),await _K(),e(await C0()))})})}async function mN(t,e,n){const s=qy(t,!0).put({[WP]:e,value:n});return new nf(s).toPromise()}async function wK(t,e){const n=qy(t,!1).get(e),s=await new nf(n).toPromise();return s===void 0?null:s.value}function gN(t,e){const n=qy(t,!0).delete(e);return new nf(n).toPromise()}const bK=800,CK=3;class VP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await C0(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>CK)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return BP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hy._getInstance(vK()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await gK(),!this.activeServiceWorker)return;this.sender=new pK(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||yK()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await C0();return await mN(e,Ng,"1"),await gN(e,Ng),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>mN(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>wK(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>gN(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=qy(i,!1).getAll();return new nf(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}VP.type="LOCAL";const IK=VP;new Jd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kK(t,e){return e?Kr(e):(Oe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1 extends L1{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Gc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Gc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Gc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function SK(t){return PP(t.auth,new z1(t),t.bypassAuthState)}function TK(t){const{auth:e,user:n}=t;return Oe(n,e,"internal-error"),nK(n,new z1(t),t.bypassAuthState)}async function EK(t){const{auth:e,user:n}=t;return Oe(n,e,"internal-error"),tK(n,new z1(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{constructor(e,n,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:i,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return SK;case"linkViaPopup":case"linkViaRedirect":return EK;case"reauthViaPopup":case"reauthViaRedirect":return TK;default:Zi(this.auth,"internal-error")}}resolve(e){ro(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ro(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NK=new Jd(2e3,1e4);class Dc extends GP{constructor(e,n,s,i,r){super(e,n,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Dc.currentPopupAction&&Dc.currentPopupAction.cancel(),Dc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oe(e,this.auth,"internal-error"),e}async onExecution(){ro(this.filter.length===1,"Popup operations only handle one event");const e=M1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Dc.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,NK.get())};e()}}Dc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $K="pendingRedirect",Wm=new Map;class RK extends GP{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=Wm.get(this.auth._key());if(!e){try{const s=await AK(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}Wm.set(this.auth._key(),e)}return this.bypassAuthState||Wm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function AK(t,e){const n=OK(e),s=PK(t);if(!await s._isAvailable())return!1;const i=await s._get(n)==="true";return await s._remove(n),i}function DK(t,e){Wm.set(t._key(),e)}function PK(t){return Kr(t._redirectPersistence)}function OK(t){return Um($K,t.config.apiKey,t.name)}async function LK(t,e,n=!1){if(mr(t.app))return Promise.reject(Qr(t));const s=Vl(t),i=kK(s,e),o=await new RK(s,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FK=10*60*1e3;class MK{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zK(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!jP(e)){const i=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(xr(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=FK&&this.cachedEventUids.clear(),this.cachedEventUids.has(yN(e))}saveEventToCache(e){this.cachedEventUids.add(yN(e)),this.lastProcessedEventTime=Date.now()}}function yN(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function jP({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function zK(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jP(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BK(t,e={}){return ma(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UK=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,WK=/^https?/;async function VK(t){if(t.config.emulator)return;const{authorizedDomains:e}=await BK(t);for(const n of e)try{if(GK(n))return}catch{}Zi(t,"unauthorized-domain")}function GK(t){const e=_0(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!WK.test(n))return!1;if(UK.test(t))return s===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jK=new Jd(3e4,6e4);function vN(){const t=_r().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function HK(t){return new Promise((e,n)=>{var s,i,r;function o(){vN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vN(),n(xr(t,"network-request-failed"))},timeout:jK.get()})}if(!((i=(s=_r().gapi)===null||s===void 0?void 0:s.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=_r().gapi)===null||r===void 0)&&r.load)o();else{const a=Fq("iframefcb");return _r()[a]=()=>{gapi.load?o():n(xr(t,"network-request-failed"))},NP(`${Lq()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw Vm=null,e})}let Vm=null;function qK(t){return Vm=Vm||HK(t),Vm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KK=new Jd(5e3,15e3),XK="__/auth/iframe",ZK="emulator/auth/iframe",YK={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},QK=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JK(t){const e=t.config;Oe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?D1(e,ZK):`https://${t.config.authDomain}/${XK}`,s={apiKey:e.apiKey,appName:t.name,v:Tu},i=QK.get(t.config.apiHost);i&&(s.eid=i);const r=t._getFrameworks();return r.length&&(s.fw=r.join(",")),`${n}?${Su(s).slice(1)}`}async function e8(t){const e=await qK(t),n=_r().gapi;return Oe(n,t,"internal-error"),e.open({where:document.body,url:JK(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:YK,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=xr(t,"network-request-failed"),a=_r().setTimeout(()=>{r(o)},KK.get());function l(){_r().clearTimeout(a),i(s)}s.ping(l).then(l,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},n8=500,s8=600,i8="_blank",r8="http://localhost";class xN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function o8(t,e,n,s=n8,i=s8){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l=Object.assign(Object.assign({},t8),{width:s.toString(),height:i.toString(),top:r,left:o}),c=fs().toLowerCase();n&&(a=bP(c)?i8:n),_P(c)&&(e=e||r8,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[m,g])=>`${f}${m}=${g},`,"");if(Tq(c)&&a!=="_self")return a8(e||"",a),new xN(null);const d=window.open(e||"",a,h);Oe(d,t,"popup-blocked");try{d.focus()}catch{}return new xN(d)}function a8(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l8="__/auth/handler",c8="emulator/auth/handler",u8=encodeURIComponent("fac");async function _N(t,e,n,s,i,r){Oe(t.config.authDomain,t,"auth-domain-config-required"),Oe(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:Tu,eventId:i};if(e instanceof AP){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",f0(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof tf){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await t._getAppCheckToken(),c=l?`#${u8}=${encodeURIComponent(l)}`:"";return`${h8(t)}?${Su(a).slice(1)}${c}`}function h8({config:t}){return t.emulator?D1(t,c8):`https://${t.authDomain}/${l8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_="webStorageSupport";class d8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=zP,this._completeRedirectFn=LK,this._overrideRedirectResult=DK}async _openPopup(e,n,s,i){var r;ro((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await _N(e,n,s,_0(),i);return o8(e,o,M1())}async _openRedirect(e,n,s,i){await this._originValidation(e);const r=await _N(e,n,s,_0(),i);return mK(r),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:r}=this.eventManagers[n];return i?Promise.resolve(i):(ro(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await e8(e),s=new MK(e);return n.register("authEvent",i=>(Oe(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(V_,{type:V_},i=>{var r;const o=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[V_];o!==void 0&&n(!!o),Zi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=VK(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return TP()||wP()||O1()}}const f8=d8;var wN="@firebase/auth",bN="1.8.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m8(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function g8(t){Tr(new Xi("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Oe(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:EP(t)},c=new Dq(s,i,r,l);return Vq(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),Tr(new Xi("auth-internal",e=>{const n=Vl(e.getProvider("auth").getImmediate());return(s=>new p8(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),gi(wN,bN,m8(t)),gi(wN,bN,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y8=5*60,v8=AD("authIdTokenMaxAge")||y8;let CN=null;const x8=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>v8)return;const i=n==null?void 0:n.token;CN!==i&&(CN=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function _8(t=Wy()){const e=Wl(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Wq(t,{popupRedirectResolver:f8,persistence:[IK,dK,zP]}),s=AD("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=x8(r.toString());aK(n,o,()=>o(n.currentUser)),oK(n,a=>o(a))}}const i=$D("auth");return i&&Gq(n,`http://${i}`),n}function w8(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Pq({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=i=>{const r=xr("internal-error");r.customData=i,n(r)},s.type="text/javascript",s.charset="UTF-8",w8().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});g8("Browser");const b8={apiKey:"AIzaSyAsKLxAzdt_Wf3CyoUCE4izrSdNh50SLto",authDomain:"firstaid-ai-4a1fd.firebaseapp.com",projectId:"firstaid-ai-4a1fd",storageBucket:"firstaid-ai-4a1fd.firebasestorage.app",messagingSenderId:"407902398252",appId:"1:407902398252:web:a51757f1b013738eb2ae89",measurementId:"G-G8DVPBMB94"},HP=k1(b8),dm=_8(HP);iq(HP);const qP=ie.createContext(null);function C8({children:t}){const[e,n]=ie.useState(null);ie.useEffect(()=>lK(dm,a=>{n(a)}),[]);const s=async(o,a)=>{await rK(dm,o,a)},i=async(o,a)=>{await iK(dm,o,a)},r=async()=>{await cK(dm)};return A.jsx(qP.Provider,{value:{user:e,signIn:s,signUp:i,signOut:r},children:t})}function B1(){const t=ie.useContext(qP);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}function I8(){const{user:t,signOut:e}=B1(),[n,s]=ie.useState(!1),[i,r]=ie.useState(!1),o=ie.useRef(null);return ie.useEffect(()=>{const a=l=>{o.current&&!o.current.contains(l.target)&&r(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),A.jsx("nav",{className:"bg-gradient-to-r from-blue-500 to-blue-600 shadow-lg",children:A.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[A.jsxs("div",{className:"flex justify-between items-center h-16",children:[A.jsxs(gn,{to:"/",className:"flex items-center group",children:[A.jsx("div",{className:"bg-white p-2 rounded-full transition-transform group-hover:scale-110",children:A.jsx(kD,{className:"h-6 w-6 text-red-500"})}),A.jsx("span",{className:"ml-2 text-xl font-bold text-white hidden md:inline",children:"FirstAid.AI"})]}),A.jsx("button",{onClick:()=>s(!n),className:"md:hidden text-white hover:text-gray-200",children:n?A.jsx(rH,{size:24}):A.jsx(Qj,{size:24})}),A.jsxs("div",{className:"hidden md:flex items-center space-x-6",children:[A.jsxs(gn,{to:"/first-aid",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(LE,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Guide"})]}),A.jsxs(gn,{to:"/injury-detection",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(_g,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Detection"})]}),A.jsxs(gn,{to:"/nearby-hospitals",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(zE,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Hospitals"})]}),A.jsxs(gn,{to:"/chat",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(d0,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Chat"})]}),A.jsxs("button",{className:"text-white hover:text-gray-200 relative group",children:[A.jsx(OE,{className:"h-5 w-5 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:"2"})]}),t?A.jsxs("div",{className:"relative",ref:o,children:[A.jsx("button",{onClick:()=>r(!i),className:"text-white hover:text-gray-200 flex items-center group",children:A.jsx("div",{className:"bg-blue-700 p-2 rounded-full transition-transform group-hover:scale-110",children:A.jsx(yh,{className:"h-5 w-5"})})}),i&&A.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl z-50",children:[A.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center",children:[A.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3",children:t.displayName?t.displayName.charAt(0).toUpperCase():A.jsx(yh,{})}),A.jsxs("div",{className:"overflow-hidden",children:[A.jsx("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:t.displayName||"User"}),A.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.email})]})]}),A.jsxs("div",{className:"py-1",children:[A.jsxs(gn,{to:"/profile",className:"block px-4 py-2 text-gray-700 hover:bg-blue-50 flex items-center",children:[A.jsx(yh,{className:"h-4 w-4 mr-2"})," Profile"]}),A.jsxs(gn,{to:"/settings",className:"block px-4 py-2 text-gray-700 hover:bg-blue-50 flex items-center",children:[A.jsx(ME,{className:"h-4 w-4 mr-2"})," Settings"]}),A.jsxs("button",{onClick:e,className:"block w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 flex items-center",children:[A.jsx(FE,{className:"h-4 w-4 mr-2"})," Logout"]})]})]})]}):A.jsx(gn,{to:"/login",className:"bg-white text-blue-600 px-4 py-2 rounded-full font-medium hover:bg-blue-50 transition-colors",children:"Login"})]})]}),n&&A.jsx("div",{className:"md:hidden bg-white rounded-lg shadow-xl mt-2",children:A.jsxs("div",{className:"p-4 space-y-4",children:[A.jsxs(gn,{to:"/first-aid",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(LE,{className:"h-5 w-5 mr-3"}),"First Aid Guide"]}),A.jsxs(gn,{to:"/injury-detection",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(_g,{className:"h-5 w-5 mr-3"}),"Injury Detection"]}),A.jsxs(gn,{to:"/nearby-hospitals",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(zE,{className:"h-5 w-5 mr-3"}),"Nearby Hospitals"]}),A.jsxs(gn,{to:"/chat",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(d0,{className:"h-5 w-5 mr-3"}),"Chat"]}),A.jsxs("div",{className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",children:[A.jsx(OE,{className:"h-5 w-5 mr-3"}),"Notifications",A.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:"2"})]}),t?A.jsxs("div",{children:[A.jsxs("div",{className:"flex items-center border-b pb-3 mb-3",children:[A.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3",children:t.displayName?t.displayName.charAt(0).toUpperCase():A.jsx(yh,{})}),A.jsxs("div",{className:"overflow-hidden",children:[A.jsx("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:t.displayName||"User"}),A.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.email})]})]}),A.jsxs(gn,{to:"/profile",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(yh,{className:"h-5 w-5 mr-3"})," Profile"]}),A.jsxs(gn,{to:"/settings",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(ME,{className:"h-5 w-5 mr-3"})," Settings"]}),A.jsxs("button",{onClick:()=>{e(),s(!1)},className:"w-full text-left flex items-center text-red-600 hover:bg-red-50 p-2 rounded-lg",children:[A.jsx(FE,{className:"h-5 w-5 mr-3"})," Logout"]})]}):A.jsx(gn,{to:"/login",className:"block w-full text-center bg-blue-500 text-white px-4 py-2 rounded-full font-medium hover:bg-blue-600 transition-colors",onClick:()=>s(!1),children:"Login"})]})})]})})}const k8=()=>A.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-green-500",children:[A.jsx("path",{d:"M12 6v4"}),A.jsx("path",{d:"M14 14h-4"}),A.jsx("path",{d:"M14 18h-4"}),A.jsx("path",{d:"M14 8h-4"}),A.jsx("path",{d:"M18 12h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2"}),A.jsx("path",{d:"M18 22V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18"})]});function S8(){return A.jsxs("div",{className:"container mx-auto px-4 py-12",children:[A.jsxs("div",{className:"text-center mb-12",children:[A.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Welcome to FirstAid.AI"}),A.jsx("p",{className:"text-xl text-gray-600",children:"Your intelligent first aid assistant for emergency situations"})]}),A.jsxs("div",{className:"grid md:grid-cols-4 gap-8 max-w-6xl mx-auto",children:[A.jsx(gn,{to:"/first-aid",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(kD,{size:48,className:"text-red-500"})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"First Aid Guide"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"Get instant first aid instructions for various injuries"})]})}),A.jsx(gn,{to:"/injury-detection",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(_g,{size:48,className:"text-blue-500"})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"Injury Detection"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"AI-powered injury assessment through image analysis"})]})}),A.jsx(gn,{to:"/nearby-hospitals",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(k8,{})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"Nearby Hospitals"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"Find emergency medical facilities in your area"})]})}),A.jsx(gn,{to:"/chat",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(d0,{size:48,className:"text-purple-500"})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"AI Chat Assistant"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"Get instant first aid advice from our AI assistant"})]})})]}),A.jsxs("div",{className:"mt-16 bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto",children:[A.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Why Choose FirstAid.AI?"}),A.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[A.jsxs("div",{children:[A.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Instant AI Analysis"}),A.jsx("p",{className:"text-gray-600",children:"Our advanced AI technology helps assess injuries and provides appropriate first aid recommendations"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Emergency Location Services"}),A.jsx("p",{className:"text-gray-600",children:"Quickly locate nearby hospitals and emergency services when you need them most"})]})]})]})]})}function T8(){const[t,e]=ie.useState(""),[n,s]=ie.useState(null),r=Object.entries({"Cuts and Wounds":[{title:"Minor Cuts",steps:["Clean your hands thoroughly with soap and water","Clean the cut with mild soap and water","Apply antibiotic ointment","Cover with a sterile bandage"],warning:"Seek medical attention if the wound is deep, gaping, or shows signs of infection"},{title:"Severe Bleeding",steps:["Apply direct pressure with a clean cloth","Keep the injured area elevated","Apply a pressure bandage","Call emergency services immediately"],warning:"This is a medical emergency - call for help right away"}],Burns:[{title:"First-Degree Burns",steps:["Cool the burn under cool (not cold) running water for 10-20 minutes","Apply aloe vera gel or moisturizer","Take pain reliever if needed","Cover with a sterile gauze bandage"],warning:"Do not apply ice directly to a burn"},{title:"Second-Degree Burns",steps:["Run under cool water for 15-20 minutes","Do not break blisters","Cover loosely with sterile gauze","Seek medical attention"],warning:"Never apply butter or oil to burns"}],"CPR and Breathing":[{title:"Adult CPR",steps:["Check the scene is safe and call for emergency help","Check for responsiveness and breathing","Begin chest compressions (30 compressions at 100-120 bpm)","Give 2 rescue breaths","Continue cycles of 30 compressions and 2 breaths"],warning:"Proper CPR training is strongly recommended. This is only a basic guide."},{title:"Recovery Position",steps:["Kneel beside the person and straighten their legs","Place the arm nearest to you at a right angle to their body","Place their other arm across their chest","Roll them onto their side","Tilt their head back to keep airway open"],warning:"Only use recovery position if the person is breathing normally"}],Choking:[{title:"Conscious Adult/Child",steps:["Give 5 back blows between shoulder blades","Perform abdominal thrusts (Heimlich maneuver)","Alternate between back blows and abdominal thrusts","Continue until object is expelled or person becomes unconscious"],warning:"If person becomes unconscious, start CPR immediately and call emergency services"},{title:"Infant Choking",steps:["Support infant face down on your forearm","Give 5 back blows between shoulder blades","Turn infant face up and give 5 chest thrusts","Continue alternating until object is expelled"],warning:"Seek immediate medical attention after any choking incident"}],"Fractures and Sprains":[{title:"Suspected Fracture",steps:["Keep the injured area still","Apply ice wrapped in cloth to reduce swelling","Immobilize the area if possible","Seek immediate medical attention"],warning:"Do not attempt to realign broken bones"},{title:"Sprain Treatment",steps:["Remember RICE: Rest, Ice, Compression, Elevation","Apply ice for 20 minutes every 2-3 hours","Use an elastic bandage for compression","Keep the injured area elevated above heart level"],warning:"Seek medical attention if unable to bear weight or severe pain persists"}],"Head Injuries":[{title:"Concussion",steps:["Stop any activity immediately","Rest in a quiet, dark place","Apply cold pack to swelling","Monitor for worsening symptoms"],warning:"Seek immediate medical attention if unconscious or vomiting"},{title:"Severe Head Trauma",steps:["Call emergency services immediately","Keep person still - do not move them","Monitor breathing and consciousness","Stop any bleeding with gentle pressure"],warning:"Do not remove any object penetrating the head"}],Poisoning:[{title:"Swallowed Poison",steps:["Call poison control center immediately","Do not induce vomiting unless told to do so","Save the container or substance","Follow professional guidance exactly"],warning:"Never give anything by mouth unless instructed by professionals"},{title:"Inhaled Poison",steps:["Get to fresh air immediately","Open windows and doors if inside","Call emergency services","Begin CPR if needed and you are trained"],warning:"Do not enter a contaminated area without proper protection"}],"Heat-Related":[{title:"Heat Exhaustion",steps:["Move to a cool place","Lie down and elevate feet slightly","Remove excess clothing","Sip cool water","Apply cool, wet cloths to body"],warning:"If symptoms worsen, seek immediate medical attention"},{title:"Heat Stroke",steps:["Call emergency services immediately","Move to a cool area","Remove excess clothing","Cool body with water or ice packs","Monitor breathing and consciousness"],warning:"This is a life-threatening emergency requiring immediate medical attention"}],"Cold-Related":[{title:"Frostbite",steps:["Get to a warm area","Remove wet clothing","Gradually warm affected areas","Do not rub or massage frozen areas"],warning:"Do not use direct heat (fire, heating pad) on frostbitten areas"},{title:"Hypothermia",steps:["Call emergency services","Move to warm area","Remove wet clothing","Warm core body first","Give warm beverages if conscious"],warning:"Severe hypothermia requires immediate professional medical care"}],"Allergic Reactions":[{title:"Mild Allergic Reaction",steps:["Remove exposure to allergen if possible","Take antihistamine if available","Apply cool compress to itchy areas","Monitor for worsening symptoms"],warning:"Watch for signs of severe reaction (difficulty breathing, swelling)"},{title:"Severe Allergic Reaction",steps:["Use epinephrine auto-injector if available","Call emergency services immediately","Help person lie flat","Monitor breathing and pulse"],warning:"Anaphylaxis is life-threatening - seek immediate medical care"}],"Eye Injuries":[{title:"Foreign Object",steps:["Do not rub the eye","Blink repeatedly to remove loose object","Flush with clean water if needed","Seek medical attention if object persists"],warning:"Do not attempt to remove embedded objects"},{title:"Chemical Splash",steps:["Flush eye immediately with clean water","Continue flushing for 15-20 minutes","Remove contact lenses if present","Seek immediate medical attention"],warning:"Chemical eye injuries require immediate professional care"}],Seizures:[{title:"During a Seizure",steps:["Clear the area of harmful objects","Protect head with something soft","Turn person on their side if possible","Time the seizure","Never put anything in their mouth"],warning:"Call emergency services if seizure lasts more than 5 minutes"}],"Dental Emergencies":[{title:"Knocked Out Tooth",steps:["Handle tooth by crown, not root","Rinse tooth gently if dirty","Try to reinsert in socket if possible","If not possible, keep tooth in milk","See dentist immediately"],warning:"Time is critical - seek dental care within 30 minutes if possible"}],"Stings and Bites":[{title:"Insect Stings",steps:["Remove stinger if present","Clean area with soap and water","Apply cold compress","Take antihistamine if needed"],warning:"Watch for signs of severe allergic reaction"},{title:"Snake Bite",steps:["Keep victim calm and still","Remove constricting items","Mark time of bite and symptoms","Seek immediate medical attention"],warning:"Do not attempt to suck out venom or apply tourniquet"}],Drowning:[{title:"Near-Drowning",steps:["Remove from water if safe to do so","Check breathing and circulation","Begin CPR if necessary","Call emergency services"],warning:"All near-drowning victims need medical evaluation"}],"Electrical Injuries":[{title:"Electrical Shock",steps:["Do not touch person until power source is off","Check breathing and pulse","Cover burns with sterile dressing","Seek immediate medical attention"],warning:"Always assume power lines are live"}]}).reduce((o,[a,l])=>{const c=l.filter(h=>h.title.toLowerCase().includes(t.toLowerCase())||a.toLowerCase().includes(t.toLowerCase()));return c.length>0&&(o[a]=c),o},{});return A.jsx("div",{className:"container mx-auto px-4 py-8",children:A.jsxs("div",{className:"max-w-4xl mx-auto",children:[A.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"First Aid Guide"}),A.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-8",children:A.jsxs("div",{className:"flex items-start",children:[A.jsx(h0,{className:"text-red-500 mr-2 flex-shrink-0 mt-1"}),A.jsxs("div",{children:[A.jsx("p",{className:"font-semibold text-red-700",children:"Emergency Warning"}),A.jsx("p",{className:"text-red-600",children:"This guide is for informational purposes only. In case of a medical emergency, immediately call your local emergency services or visit the nearest hospital."})]})]})}),A.jsxs("div",{className:"relative mb-8",children:[A.jsx("input",{type:"text",placeholder:"Search first aid guides...",value:t,onChange:o=>e(o.target.value),className:"w-full px-4 py-3 pl-12 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),A.jsx(tH,{className:"absolute left-4 top-3.5 text-gray-400",size:20})]}),A.jsx("div",{className:"space-y-4",children:Object.entries(r).map(([o,a])=>A.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[A.jsxs("button",{onClick:()=>s(n===o?null:o),className:"w-full px-6 py-4 flex justify-between items-center bg-gray-50 hover:bg-gray-100 transition-colors",children:[A.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:o}),n===o?A.jsx(Xj,{className:"text-gray-600"}):A.jsx(Kj,{className:"text-gray-600"})]}),n===o&&A.jsx("div",{className:"p-6 space-y-6",children:a.map((l,c)=>A.jsxs("div",{className:"border-b border-gray-200 last:border-0 pb-6 last:pb-0",children:[A.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:l.title}),A.jsx("ol",{className:"list-decimal pl-6 space-y-2 mb-4",children:l.steps.map((h,d)=>A.jsx("li",{className:"text-gray-700",children:h},d))}),l.warning&&A.jsx("div",{className:"mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4",children:A.jsxs("div",{className:"flex",children:[A.jsx(h0,{className:"text-yellow-400 mr-2 flex-shrink-0"}),A.jsx("p",{className:"text-sm text-yellow-700",children:l.warning})]})})]},c))})]},o))})]})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8=1e-7,N8=1e-4;class KP{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class U1{refCount(e){return _s("refCount")}incRef(e){return _s("incRef")}timerAvailable(){return!0}time(e){return _s("time")}read(e){return _s("read")}readSync(e){return _s("readSync")}readToGPU(e,n){return _s("readToGPU")}numDataIds(){return _s("numDataIds")}disposeData(e,n){return _s("disposeData")}write(e,n,s){return _s("write")}move(e,n,s,i,r){return _s("move")}createTensorFromGPUData(e,n,s){return _s("createTensorFromGPUData")}memory(){return _s("memory")}floatPrecision(){return _s("floatPrecision")}epsilon(){return this.floatPrecision()===32?E8:N8}dispose(){return _s("dispose")}}function _s(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,vc(t,e,n)}function vl(t,e,n){return Math.max(t,Math.min(e,n))}function W1(t){return t%2===0?t:t+1}function vc(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function R8(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function R(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function V1(t,e,n=""){R(ct(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function G1(t){R(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function re(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function ct(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ou(t){return t%1===0}function I0(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function jc(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function IN(t,e=i=>0,n,s){return new Promise((i,r)=>{let o=0;const a=()=>{if(t()){i();return}o++;const l=e(o);if(n!=null&&o>=n){r();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function XP(t,e){let n=1,s=-1;for(let r=0;r<t.length;++r)if(t[r]>=0)n*=t[r];else if(t[r]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${r}`);s=r}else if(t[r]<0)throw Error(`Shapes can not be < 0. Found ${t[r]} at dim ${r}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[s]=e/n,i}function je(t,e){const n=e.length;return t=t==null?e.map((s,i)=>i):[].concat(t),R(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),R(t.every(s=>ou(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function ga(t,e){const n=[],s=[],i=e!=null&&Array.isArray(e)&&e.length===0,r=e==null||i?null:je(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(r!=null){if(r[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(r[o]==null||r[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),r[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function Wn(t,e){return qt(t,e)}function qt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function A8(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function D8(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function ZP(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Rg(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function P8(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function sf(t){return typeof t=="string"||t instanceof String}function O8(t){return typeof t=="boolean"}function k0(t){return typeof t=="number"}function Nu(t){return Array.isArray(t)?Nu(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":k0(t)?"float32":sf(t)?"string":O8(t)?"bool":"float32"}function S0(t){return!!(t&&t.constructor&&t.call&&t.apply)}function T0(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Te(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function YP(t,e,n,s=!1){const i=new Array;if(e.length===1){const r=e[0]*(s?2:1);for(let o=0;o<r;o++)i[o]=n[t+o]}else{const r=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<r;l++)i[l]=YP(t+l*a,o,n,s)}return i}function Gi(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((i,r)=>i*r)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return YP(0,t,e,n)}function L8(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function j1(t,e){const n=Vn(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function Vn(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function QP(t,e){const n=t.reduce((s,i)=>s*i,1);if(e==null||e==="float32")return Gi(t,new Float32Array(n));if(e==="int32")return Gi(t,new Int32Array(n));if(e==="bool")return Gi(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function po(t){t.forEach(e=>{R(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function wr(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let i=0;i<t.length-1;++i)s+=n[i]*t[i];return s}function $u(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(t/n[i]),t-=s[i]*n[i];return s[s.length-1]=t,s}function H1(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kN="tfjsflags";class F8{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=M8,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const i=this.urlFlags[e];ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(H1(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);kN in e&&e[kN].split(",").forEach(s=>{const[i,r]=s.split(":");this.urlFlags[i]=B8(i,r)})}}function M8(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(z8(e,s[0],s[1]),s.join("="))),e}function z8(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function B8(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function ee(){return JP}let JP=null;function U8(t){JP=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let G_;function eO(){if(G_==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");G_=t}return G_}function W8(){const t=eO();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function q1(t,e){const n=W8();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Ky="Abs",rf="Acos",of="Acosh",Ru="Add",K1="AddN",X1="All",Z1="Any",Xy="ArgMax",Zy="ArgMin",af="Asin",lf="Asinh",cf="Atan",uf="Atanh",hf="Atan2",Yy="AvgPool",Y1="AvgPoolGrad",Qy="AvgPool3D",Q1="AvgPool3DGrad",Jy="BatchMatMul",ev="BatchToSpaceND",J1="Bincount",eC="BitwiseAnd",V8="BroadcastTo",tO="BroadcastArgs",df="Cast",ff="Ceil",pf="ClipByValue",tC="Complex",tv="ComplexAbs",nv="Concat",sv="Conv2D",nC="Conv2DBackpropFilter",iv="Conv2DBackpropInput",rv="Conv3D",sC="Conv3DBackpropFilterV2",iC="Conv3DBackpropInputV2",mf="Cos",gf="Cosh",rC="Cumprod",ov="Cumsum",oC="CropAndResize",aC="DenseBincount",lC="DepthToSpace",av="DepthwiseConv2dNative",cC="DepthwiseConv2dNativeBackpropFilter",uC="DepthwiseConv2dNativeBackpropInput",nO="Diag",lv="Dilation2D",E0="Dilation2DBackpropInput",N0="Dilation2DBackpropFilter",G8="Draw",yf="RealDiv",hC="Einsum",vf="Elu",dC="EluGrad",xf="Erf",cv="Equal",_f="Exp",uv="ExpandDims",wf="Expm1",fC="FFT",pC="Fill",mC="FlipLeftRight",bf="Floor",Cf="FloorDiv",hv="FusedBatchNorm",dv="GatherV2",sO="GatherNd",fv="Greater",If="GreaterEqual",kf="Identity",gC="IFFT",yC="Imag",Sf="IsFinite",Tf="IsInf",Ef="IsNan",pv="LeakyRelu",mv="Less",gv="LessEqual",iO="LinSpace",Nf="Log",$f="Log1p",yv="LogicalAnd",vv="LogicalNot",xv="LogicalOr",j8="LogSoftmax",_v="LRN",vC="LRNGrad",wv="Max",Rf="Maximum",bv="MaxPool",xC="MaxPoolGrad",Cv="MaxPool3D",_C="MaxPool3DGrad",rO="MaxPoolWithArgmax",Iv="Mean",kv="Min",Af="Minimum",Sv="MirrorPad",Df="Mod",oO="Multinomial",Pf="Multiply",Tv="Neg",Ev="NotEqual",wC="NonMaxSuppressionV3",bC="NonMaxSuppressionV4",CC="NonMaxSuppressionV5",Nv="OnesLike",$v="OneHot",Rv="Pack",Av="PadV2",Of="Pow",Dv="Prelu",Pv="Prod",aO="RaggedGather",lO="RaggedRange",cO="RaggedTensorToTensor",IC="Range",kC="Real",Lf="Reciprocal",Ff="Relu",Ov="Reshape",Lv="ResizeNearestNeighbor",SC="ResizeNearestNeighborGrad",Fv="ResizeBilinear",TC="ResizeBilinearGrad",Mf="Relu6",Mv="Reverse",zf="Round",Bf="Rsqrt",uO="ScatterNd",hO="TensorScatterUpdate",dO="SearchSorted",zv="Select",Uf="Selu",Bv="Slice",Wf="Sin",Vf="Sinh",Gf="Sign",jf="Sigmoid",Hf="Softplus",qf="Sqrt",Uv="Sum",Wv="SpaceToBatchND",Vv="SplitV",Gv="Softmax",fO="SparseFillEmptyRows",pO="SparseReshape",mO="SparseSegmentMean",gO="SparseSegmentSum",yO="SparseToDense",Kf="SquaredDifference",EC="Square",NC="StaticRegexReplace",$C="StridedSlice",vO="StringNGrams",xO="StringSplit",_O="StringToHashBucketFast",Xf="Sub",Zf="Tan",Yf="Tanh",Qf="Tile",RC="TopK",AC="Transform",Hc="Transpose",DC="Unique",jv="Unpack",Hv="UnsortedSegmentSum",qv="ZerosLike",Jf="Step",$0="FromPixels",PC="RotateWithOffset",Ag="_FusedMatMul",Dg="FusedConv2D",wO="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bs(...t){ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(...t)}function H8(...t){ee().getBool("IS_TEST")||ee().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pg=q1("kernelRegistry",()=>new Map),R0=q1("gradRegistry",()=>new Map);function A0(t,e){const n=CO(t,e);return Pg.get(n)}function SN(t){return R0.get(t)}function TN(t){const e=Pg.entries(),n=[];for(;;){const{done:s,value:i}=e.next();if(s)break;const[r,o]=i,[a]=r.split("_");a===t&&n.push(o)}return n}function bO(t){const{kernelName:e,backendName:n}=t,s=CO(e,n);Pg.has(s)&&Bs(`The kernel '${e}' for backend '${n}' is already registered`),Pg.set(s,t)}function q8(t){const{kernelName:e}=t;R0.has(e)&&ee().getBool("DEBUG")&&Bs(`Overriding the gradient for '${e}'`),R0.set(e,t)}function CO(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IO(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var kO=Nt,ui=null;try{ui=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Nt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Nt.prototype.__isLong__;Object.defineProperty(Nt.prototype,"__isLong__",{value:!0});function Fs(t){return(t&&t.__isLong__)===!0}Nt.isLong=Fs;var EN={},NN={};function Gl(t,e){var n,s,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(s=NN[t],s)?s:(n=$t(t,(t|0)<0?-1:0,!0),i&&(NN[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(s=EN[t],s)?s:(n=$t(t,t<0?-1:0,!1),i&&(EN[t]=n),n))}Nt.fromInt=Gl;function hi(t,e){if(isNaN(t))return e?Qa:di;if(e){if(t<0)return Qa;if(t>=SO)return NO}else{if(t<=-9223372036854776e3)return Is;if(t+1>=X8)return EO}return t<0?hi(-t,e).neg():$t(t%au|0,t/au|0,e)}Nt.fromNumber=hi;function $t(t,e,n){return new Nt(t,e,n)}Nt.fromBits=$t;var Og=Math.pow;function OC(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return di;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return OC(t.substring(1),e,n).neg();for(var i=hi(Og(n,8)),r=di,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=hi(Og(n,a));r=r.mul(c).add(hi(l))}else r=r.mul(i),r=r.add(hi(l))}return r.unsigned=e,r}Nt.fromString=OC;function er(t,e){return typeof t=="number"?hi(t,e):typeof t=="string"?OC(t,e):$t(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Nt.fromValue=er;var $N=65536,K8=1<<24,au=$N*$N,SO=au*au,X8=SO/2,RN=Gl(K8),di=Gl(0);Nt.ZERO=di;var Qa=Gl(0,!0);Nt.UZERO=Qa;var Pc=Gl(1);Nt.ONE=Pc;var TO=Gl(1,!0);Nt.UONE=TO;var D0=Gl(-1);Nt.NEG_ONE=D0;var EO=$t(-1,2147483647,!1);Nt.MAX_VALUE=EO;var NO=$t(-1,-1,!0);Nt.MAX_UNSIGNED_VALUE=NO;var Is=$t(0,-2147483648,!1);Nt.MIN_VALUE=Is;var ve=Nt.prototype;ve.toInt=function(){return this.unsigned?this.low>>>0:this.low};ve.toNumber=function(){return this.unsigned?(this.high>>>0)*au+(this.low>>>0):this.high*au+(this.low>>>0)};ve.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Is)){var n=hi(e),s=this.div(n),i=s.mul(n).sub(this);return s.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=hi(Og(e,6),this.unsigned),o=this,a="";;){var l=o.div(r),c=o.sub(l.mul(r)).toInt()>>>0,h=c.toString(e);if(o=l,o.isZero())return h+a;for(;h.length<6;)h="0"+h;a=""+h+a}};ve.getHighBits=function(){return this.high};ve.getHighBitsUnsigned=function(){return this.high>>>0};ve.getLowBits=function(){return this.low};ve.getLowBitsUnsigned=function(){return this.low>>>0};ve.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Is)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ve.isZero=function(){return this.high===0&&this.low===0};ve.eqz=ve.isZero;ve.isNegative=function(){return!this.unsigned&&this.high<0};ve.isPositive=function(){return this.unsigned||this.high>=0};ve.isOdd=function(){return(this.low&1)===1};ve.isEven=function(){return(this.low&1)===0};ve.equals=function(e){return Fs(e)||(e=er(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ve.eq=ve.equals;ve.notEquals=function(e){return!this.eq(e)};ve.neq=ve.notEquals;ve.ne=ve.notEquals;ve.lessThan=function(e){return this.comp(e)<0};ve.lt=ve.lessThan;ve.lessThanOrEqual=function(e){return this.comp(e)<=0};ve.lte=ve.lessThanOrEqual;ve.le=ve.lessThanOrEqual;ve.greaterThan=function(e){return this.comp(e)>0};ve.gt=ve.greaterThan;ve.greaterThanOrEqual=function(e){return this.comp(e)>=0};ve.gte=ve.greaterThanOrEqual;ve.ge=ve.greaterThanOrEqual;ve.compare=function(e){if(Fs(e)||(e=er(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ve.comp=ve.compare;ve.negate=function(){return!this.unsigned&&this.eq(Is)?Is:this.not().add(Pc)};ve.neg=ve.negate;ve.add=function(e){Fs(e)||(e=er(e));var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,r=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,h=0,d=0,f=0,m=0;return m+=r+c,f+=m>>>16,m&=65535,f+=i+l,d+=f>>>16,f&=65535,d+=s+a,h+=d>>>16,d&=65535,h+=n+o,h&=65535,$t(f<<16|m,h<<16|d,this.unsigned)};ve.subtract=function(e){return Fs(e)||(e=er(e)),this.add(e.neg())};ve.sub=ve.subtract;ve.multiply=function(e){if(this.isZero())return di;if(Fs(e)||(e=er(e)),ui){var n=ui.mul(this.low,this.high,e.low,e.high);return $t(n,ui.get_high(),this.unsigned)}if(e.isZero())return di;if(this.eq(Is))return e.isOdd()?Is:di;if(e.eq(Is))return this.isOdd()?Is:di;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(RN)&&e.lt(RN))return hi(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,h=e.low&65535,d=0,f=0,m=0,g=0;return g+=o*h,m+=g>>>16,g&=65535,m+=r*h,f+=m>>>16,m&=65535,m+=o*c,f+=m>>>16,m&=65535,f+=i*h,d+=f>>>16,f&=65535,f+=r*c,d+=f>>>16,f&=65535,f+=o*l,d+=f>>>16,f&=65535,d+=s*h+i*c+r*l+o*a,d&=65535,$t(m<<16|g,d<<16|f,this.unsigned)};ve.mul=ve.multiply;ve.divide=function(e){if(Fs(e)||(e=er(e)),e.isZero())throw Error("division by zero");if(ui){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?ui.div_u:ui.div_s)(this.low,this.high,e.low,e.high);return $t(n,ui.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qa:di;var s,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qa;if(e.gt(this.shru(1)))return TO;r=Qa}else{if(this.eq(Is)){if(e.eq(Pc)||e.eq(D0))return Is;if(e.eq(Is))return Pc;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(di)?e.isNegative()?Pc:D0:(i=this.sub(e.mul(s)),r=s.add(i.div(e)),r)}else if(e.eq(Is))return this.unsigned?Qa:di;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=di}for(i=this;i.gte(e);){s=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Og(2,a-48),c=hi(s),h=c.mul(e);h.isNegative()||h.gt(i);)s-=l,c=hi(s,this.unsigned),h=c.mul(e);c.isZero()&&(c=Pc),r=r.add(c),i=i.sub(h)}return r};ve.div=ve.divide;ve.modulo=function(e){if(Fs(e)||(e=er(e)),ui){var n=(this.unsigned?ui.rem_u:ui.rem_s)(this.low,this.high,e.low,e.high);return $t(n,ui.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ve.mod=ve.modulo;ve.rem=ve.modulo;ve.not=function(){return $t(~this.low,~this.high,this.unsigned)};ve.and=function(e){return Fs(e)||(e=er(e)),$t(this.low&e.low,this.high&e.high,this.unsigned)};ve.or=function(e){return Fs(e)||(e=er(e)),$t(this.low|e.low,this.high|e.high,this.unsigned)};ve.xor=function(e){return Fs(e)||(e=er(e)),$t(this.low^e.low,this.high^e.high,this.unsigned)};ve.shiftLeft=function(e){return Fs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$t(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):$t(0,this.low<<e-32,this.unsigned)};ve.shl=ve.shiftLeft;ve.shiftRight=function(e){return Fs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$t(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):$t(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ve.shr=ve.shiftRight;ve.shiftRightUnsigned=function(e){if(Fs(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return $t(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?$t(n,0,this.unsigned):$t(n>>>e-32,0,this.unsigned)};ve.shru=ve.shiftRightUnsigned;ve.shr_u=ve.shiftRightUnsigned;ve.toSigned=function(){return this.unsigned?$t(this.low,this.high,!1):this};ve.toUnsigned=function(){return this.unsigned?this:$t(this.low,this.high,!0)};ve.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ve.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ve.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Nt.fromBytes=function(e,n,s){return s?Nt.fromBytesLE(e,n):Nt.fromBytesBE(e,n)};Nt.fromBytesLE=function(e,n){return new Nt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Nt.fromBytesBE=function(e,n){return new Nt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const $O=Cb(kO),Z8=Y$({__proto__:null,default:$O},[kO]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ja=$O||Z8;function Kv(t){return ja.fromString(t,!0,16)}const RO=Kv("c3a5c85c97cb3127"),Wa=Kv("b492b66fbe98f273"),Jn=Kv("9ae16a3b2f90404f");function P0(t){return t.xor(t.shru(47))}function AO(t,e,n){const s=t.slice(e,e+n);return ja.fromBytes(Array.from(s),!0,!0)}function bt(t,e){return AO(t,e,8)}function AN(t,e){return AO(t,e,4)}function xn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Ko(t,e,n=Kv("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let i=e.xor(s).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function Y8(t,e,n,s,i,r){i=i.add(t),r=xn(r.add(i).add(s),21);const o=i;return i=i.add(e),i=i.add(n),r=r.add(xn(i,44)),[i.add(s),r.add(o)]}function fm(t,e,n,s){return Y8(bt(t,e),bt(t,e+8),bt(t,e+16),bt(t,e+24),n,s)}function Q8(t,e=t.length){if(e>=8){const n=Jn.add(e*2),s=bt(t,0).add(Jn),i=bt(t,e-8),r=xn(i,37).mul(n).add(s),o=xn(s,25).add(i).mul(n);return Ko(r,o,n)}if(e>=4){const n=Jn.add(e*2),s=AN(t,0);return Ko(s.shl(3).add(e),AN(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],i=t[e-1],r=n+(s<<8),o=e+(i<<2);return P0(Jn.mul(r).xor(RO.mul(o))).mul(Jn)}return Jn}function J8(t,e=t.length){const n=Jn.add(e*2),s=bt(t,0).mul(Wa),i=bt(t,8),r=bt(t,e-8).mul(n),o=bt(t,e-16).mul(Jn);return Ko(xn(s.add(i),43).add(xn(r,30)).add(o),s.add(xn(i.add(Jn),18)).add(r),n)}function eX(t,e=t.length){const n=Jn.add(e*2),s=bt(t,0).mul(Jn),i=bt(t,8),r=bt(t,e-8).mul(n),o=bt(t,e-16).mul(Jn),a=xn(s.add(i),43).add(xn(r,30)).add(o),l=Ko(a,s.add(xn(i.add(Jn),18)).add(r),n),c=bt(t,16).mul(n),h=bt(t,24),d=a.add(bt(t,e-32)).mul(n),f=l.add(bt(t,e-24)).mul(n);return Ko(xn(c.add(h),43).add(xn(d,30)).add(f),c.add(xn(h.add(s),18)).add(d),n)}function tX(t,e=t.length){const n=ja.fromNumber(81,!0);if(e<=32)return e<=16?Q8(t,e):J8(t,e);if(e<=64)return eX(t,e);let s=n,i=n.mul(Wa).add(113),r=P0(i.mul(Jn).add(113)).mul(Jn),o=[ja.UZERO,ja.UZERO],a=[ja.UZERO,ja.UZERO];s=s.mul(Jn).add(bt(t,0));let l=0;const c=(e-1>>6)*64,h=c+(e-1&63)-63;do s=xn(s.add(i).add(o[0]).add(bt(t,l+8)),37).mul(Wa),i=xn(i.add(o[1]).add(bt(t,l+48)),42).mul(Wa),s=s.xor(a[1]),i=i.add(o[0]).add(bt(t,l+40)),r=xn(r.add(a[0]),33).mul(Wa),o=fm(t,l,o[1].mul(Wa),s.add(a[0])),a=fm(t,l+32,r.add(a[1]),i.add(bt(t,l+16))),[r,s]=[s,r],l+=64;while(l!==c);const d=Wa.add(r.and(255).shl(1));return l=h,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=xn(s.add(i).add(o[0]).add(bt(t,l+8)),37).mul(d),i=xn(i.add(o[1]).add(bt(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(bt(t,l+40))),r=xn(r.add(a[0]),33).mul(d),o=fm(t,l,o[1].mul(d),s.add(a[0])),a=fm(t,l+32,r.add(a[1]),i.add(bt(t,l+16))),[r,s]=[s,r],Ko(Ko(o[0],a[0],d).add(P0(i).mul(RO)).add(r),Ko(o[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ya(t,e){return e==="string"?Xo(t):jl([t],e)}function nX(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function jl(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=xl(t)),ee().getBool("DEBUG")&&A8(t,e),nX(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function ls(){return ee().platform.now()}function Xo(t,e="utf-8"){return e=e||"utf-8",ee().platform.encode(t,e)}function ta(t,e="utf-8"){return e=e||"utf-8",ee().platform.decode(t,e)}function xi(t){return ee().platform.isTypedArray!=null?ee().platform.isTypedArray(t):IO(t)}function xl(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||H1(t)||t==null||xi(t)&&n)e.push(t);else if(Array.isArray(t)||xi(t))for(let s=0;s<t.length;++s)xl(t[s],e,n);else{let s=-1;for(const i of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(i)&&(s=Math.max(s,Number(i)));for(let i=0;i<=s;i++)xl(t[i],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sX{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new rX)}profileKernel(e,n,s){let i;const r=()=>{i=s()};let o;const a=ls();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(r);else{r();for(const c of i)c.dataSync();o=Promise.resolve({kernelMs:ls()-a})}if(ee().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<i.length;c++){const h=i[c];h.data().then(d=>{iX(d,h.dtype,e)})}return{kernelName:e,outputs:i,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:i,inputs:r,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),i,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],r,l[2])})})}}function iX(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const i=t[s];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class rX{logKernelProfile(e,n,s,i,r,o){const a=typeof i=="number"?jc(`${i}ms`,9):i.error,l=jc(e,25),c=n.rank,h=n.size,d=jc(n.shape.toString(),14);let f="";for(const m in r){const g=r[m];if(g!=null){const v=g.shape||n.shape,_=v.length;f+=`${m}: ${_}D ${_>0?v:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${h}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oX(t,e,n){const s={},i={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],h=c.inputs;for(const d in h){const f=h[d];let m=!1;for(let g=0;g<e.length;g++)if(s[f.id]){c.outputs.forEach(v=>s[v.id]=!0),m=!0,i[c.id]=!0;break}if(m)break}}const r={};r[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],h=c.inputs;for(let d=0;d<c.outputs.length;d++)if(r[c.outputs[d].id]){for(const f in h)r[h[f].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(i[c.id]&&o[c.id]){const h={};for(const f in c.inputs){const m=c.inputs[f];s[m.id]&&(h[f]=m)}const d=Object.assign({},c);d.inputs=h,d.outputs=c.outputs,a.push(d)}}return a}function aX(t,e,n,s){for(let i=e.length-1;i>=0;i--){const r=e[i],o=[];if(r.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),r.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${r.kernelName}.`);const a=r.gradient(o);for(const l in r.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const h=r.inputs[l];if(!ct(c.shape,h.shape))throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${h.shape}'`);if(t[h.id]==null)t[h.id]=c;else{const d=t[h.id];t[h.id]=s(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DN=20,vh=3,j_=7;function lX(t,e,n,s){const i=Te(e),r=cX(t,e,n,i),o=e.length,a=Gm(t,e,n,i,r),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function cX(t,e,n,s){const i=re(e),r=s[s.length-1],o=new Array(r).fill(0),a=e.length,l=n==="complex64"?Dh(t):t;if(a>1)for(let c=0;c<i/r;c++){const h=c*r;for(let d=0;d<r;d++)o[d]=Math.max(o[d],Ah(l[h+d],0,n).length)}return o}function Ah(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(j_))} + ${parseFloat(t[1].toFixed(j_))}j`:sf(t)?s=`'${t}'`:n==="bool"?s=DO(t):s=parseFloat(t.toFixed(j_)).toString(),jc(s,e)}function DO(t){return t===0?"false":"true"}function Gm(t,e,n,s,i,r=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const v=Dh(t);return[Ah(v[0],0,n)]}return n==="bool"?[DO(t[0])]:[t[0].toString()]}if(l===1){if(a>DN){const _=vh*o;let x=Array.from(t.slice(0,_)),w=Array.from(t.slice((a-vh)*o,a*o));return n==="complex64"&&(x=Dh(x),w=Dh(w)),["["+x.map((C,I)=>Ah(C,i[I],n)).join(", ")+", ..., "+w.map((C,I)=>Ah(C,i[a-vh+I],n)).join(", ")+"]"]}return["["+(n==="complex64"?Dh(t):Array.from(t)).map((_,x)=>Ah(_,i[x],n)).join(", ")+"]"]}const c=e.slice(1),h=s.slice(1),d=s[0]*o,f=[];if(a>DN){for(let v=0;v<vh;v++){const _=v*d,x=_+d;f.push(...Gm(t.slice(_,x),c,n,h,i,!1))}f.push("...");for(let v=a-vh;v<a;v++){const _=v*d,x=_+d;f.push(...Gm(t.slice(_,x),c,n,h,i,v===a-1))}}else for(let v=0;v<a;v++){const _=v*d,x=_+d;f.push(...Gm(t.slice(_,x),c,n,h,i,v===a-1))}const m=l===2?",":"";f[0]="["+(a>0?f[0]+m:"");for(let v=1;v<f.length-1;v++)f[v]=" "+f[v]+m;let g=`,
`;for(let v=2;v<l;v++)g+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(r?"":g),f}function Dh(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class An{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=re(e),s!=null){const i=s.length;R(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||qt(n,this.size),this.strides=Te(e)}set(e,...n){n.length===0&&(n=[0]),R(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const i of e){if(i<0||i>=this.shape[n]){const r=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(r)}n++}let s=e[e.length-1];for(let i=0;i<e.length-1;++i)s+=this.strides[i]*e[i];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Li().makeTensor(this.values,this.shape,this.dtype)}}let Li=null,xc=null;function uX(t){Li=t}function hX(t){xc=t}class an{constructor(e,n,s,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=re(e),this.strides=Te(e),this.dataId=s,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return xc.buffer(this.shape,this.dtype,e)}bufferSync(){return xc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Gi(this.shape,e,this.dtype==="complex64")}arraySync(){return Gi(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Li().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ta(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Li().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Li().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ta(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Li().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Li().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return xc.print(this,e)}clone(){return this.throwIfDisposed(),xc.clone(this)}toString(e=!1){const n=this.dataSync();return lX(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),xc.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Li().makeVariable(this,e,n,s)}}Object.defineProperty(an,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function se(){return q1("Tensor",()=>an)}se();class Lg extends an{constructor(e,n,s,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ct(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Li().disposeTensor(this),this.dataId=e.dataId,Li().incRef(this,null)}dispose(){Li().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Lg,Symbol.hasInstance,{value:t=>t instanceof an&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var PN;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(PN||(PN={}));var O0;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(O0||(O0={}));var L0;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(L0||(L0={}));var F0;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(F0||(F0={}));var M0;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(M0||(M0={}));const dX={float32:F0,int32:O0,bool:L0,complex64:M0};function Ds(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return dX[t][e]}function LC(t){return Ds(t,"int32")}function PO(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function OO(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(t,e){if(t.dtype===e.dtype)return[t,e];const n=Ds(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function LO(t){const e=[];return FO(t,e,new Set),e}function FO(t,e,n){if(t==null)return;if(t instanceof an){e.push(t);return}if(!fX(t))return;const s=t;for(const i in s){const r=s[i];n.has(r)||(n.add(r),FO(r,e,n))}}function fX(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(t){return t.kernelName!=null}class ON{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class lu{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ON}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Bs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new sX(this.backendInstance),!0}setupRegisteredKernels(){TN(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){TN(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof U1)&&typeof s.then=="function"){const i=++this.pendingBackendInitId,r=s.then(o=>i<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Bs(`Initialization of backend ${e} failed`),Bs(o.stack||o.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Bs(`Initialization of backend ${e} failed`),Bs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:i,asyncInit:r}=this.initializeBackend(s);if(r||i)return{name:s,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),i=s.backend,r=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),s.backend=e,e.move(n,r,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let i;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,n,s){e();try{const i=s();return n(),i}catch(i){throw n(),i}}nextTensorId(){return lu.nextTensorId++}nextVariableId(){return lu.nextVariableId++}clone(e){const n=W.runKernel(kf,{x:e}),s={x:e},i=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return W.runKernel(df,l,c)}}),r=[];return this.addTapeNode(this.state.activeScope.name,s,[n],i,r,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(A0(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const i=this.backend.numDataIds();let r=0;s.forEach(l=>{r+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-r-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const i=this.isTapeOn(),r=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=H_(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(H_(e)){const{kernelName:g,inputs:v,attrs:_}=e;this.backendName==null&&this.backend;const x=A0(g,this.backendName);R(x!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=x.kernelFunc({inputs:v,attrs:_,backend:this.backend});const C=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,w,C);const I=C.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(i){const S=this.getTensorsForGradient(g,v,I);s=this.saveTensorsForBackwardMode(S)}return I}}else{const{forwardFunc:g}=e,v=_=>{i&&(s=_.map(x=>this.keep(this.clone(x))))};a=()=>{const _=this.backend.numDataIds();l=this.tidy(()=>g(this.backend,v));const x=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,_,x),x}}const{inputs:h,attrs:d}=e,f=H_(e)?null:e.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(m=this.profiler.profileKernel(c,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),n=m.outputs)}),i&&this.addTapeNode(c,h,n,f,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(g=>h[g]!=null?h[g].shape:null),outputShapes:n.map(g=>g.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const i=SN(e);if(i!=null){const r=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(R(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=r.map(c=>n[c]);const l=s.filter((c,h)=>o[h]);return a.concat(l)}return[]}makeTensor(e,n,s,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",i=i||this.backend;let r=e;s==="string"&&sf(e[0])&&(r=e.map(l=>Xo(l)));const o=i.write(r,n,s),a=new an(n,s,o,this.nextTensorId());if(this.trackTensor(a,i),s==="string"){const l=this.state.tensorInfo.get(o),c=P8(r);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,i){s=s||"float32";const r={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(r,i)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:i,dtype:r}=e,o=new an(i,r,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,i){s=s||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const r=new Lg(e,n,s,this.nextTensorId());if(this.state.registeredVariables[r.name]!=null)throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Rg(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Lg||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Rg(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,i,r,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:r},l=SN(e);l!=null&&(i=l.gradFunc),i!=null&&(a.gradient=c=>(c=c.map((h,d)=>{if(h==null){const f=s[d],m=Vn(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return h}),i(c.length>1?c:c[0],r,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=LO(e),s=new Set(n.map(r=>r.id));for(let r=0;r<this.state.activeScope.track.length;r++){const o=this.state.activeScope.track[r];!o.kept&&!s.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(r=>{!r.kept&&r.scopeId===i.id&&this.track(r)})}gradients(e,n,s,i=!1){if(R(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));R(r instanceof an,()=>"The result y returned by f() must be a tensor.");const o=oX(this.state.activeTape,n,r);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[r.id]=s??pX(r.shape),aX(a,o,c=>this.tidy(c),mX);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const h of c.saved)h.dispose()}),this.state.activeTape=null),{value:r,grads:l}})}customGrad(e){return R(S0(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{R(n.every(a=>a instanceof an),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const i={};n.forEach((a,l)=>{i[l]=a});const r=(a,l)=>(s=e(...n,l),R(s.value instanceof an,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),R(S0(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const c=s.gradFunc(a,l),h=Array.isArray(c)?c:[c];R(h.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),R(h.every(f=>f instanceof an),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return h.forEach((f,m)=>{d[m]=()=>f}),d};return this.runKernelFunc({forwardFunc:r,backwardsFunc:o,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=ls(),s=await this.backend.time(e);return s.wallMs=ls()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ON;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}lu.nextTensorId=0;lu.nextVariableId=0;function pX(t){const e=j1(re(t),"float32");return W.makeTensor(e,t,"float32")}function MO(){const t=eO();if(t._tfengine==null){const e=new F8(t);t._tfengine=new lu(e)}return U8(t._tfengine.ENV),uX(()=>t._tfengine),t._tfengine}const W=MO();function mX(t,e){const n={a:t,b:e};return W.runKernel(Ru,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(){return typeof navigator<"u"&&navigator!=null}function zO(t){if(t||gX()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function BO(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ps=ee();ps.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ps.registerFlag("IS_BROWSER",()=>BO());ps.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ps.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ps.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ps.registerFlag("PROD",()=>!1);ps.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ps.getBool("DEBUG"));ps.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ps.registerFlag("IS_TEST",()=>!1);ps.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ps.getBool("DEBUG"));ps.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ps.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ps.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ep(t,e){let n=t;if(xi(t))return e==="string"?[]:[t.length];if(PO(t)){const i=t.channels||"RGBA";return[t.height,t.width*i.length]}else if(OO(t))return[t.buffer.size/(e==null?4:Rg(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||xi(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&ee().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&UO(t,s,[]),s}function UO(t,e,n){if(n=n||[],!Array.isArray(t)&&!xi(t)){R(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}R(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),R(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let i=0;i<t.length;++i)UO(t[i],s,n.concat(i))}function LN(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function F(t,e,n,s="numeric"){if(t instanceof se())return LN(s,t.dtype,e,n),t;let i=Nu(t);if(i!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),LN(s,i,e,n),t==null||!xi(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const r=ep(t,i);!xi(t)&&!Array.isArray(t)&&(t=[t]);const a=i!=="string"?jl(t,i):xl(t,[],!0);return W.makeTensor(a,r,i)}function WO(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((r,o)=>F(r,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yX="__op";function j(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+yX;const i=(...r)=>{W.startScope(n);try{const o=s(...r);return H1(o)&&console.error("Cannot return a Promise inside of tidy."),W.endScope(o),o}catch(o){throw W.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(t,e){const n=F(t,"real","complex"),s=F(e,"imag","complex");V1(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:n,imag:s};return W.runKernel(tC,i)}const _l=j({complex_:vX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tp(t,e,n,s){if(s==null)s=Nu(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(OO(t)||PO(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return W.backend.createTensorFromGPUData(t,e||n,s)}if(!xi(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){po(e);const i=re(e),r=re(n);R(i===r,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${r}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==re(e.slice(o)):!0;R(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!xi(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?jl(t,s):xl(t,[],!0),W.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(t,e,n){const s=ep(t,n);return tp(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class va{static join(e){return new va(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>xi(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const i=e[s];s!==e.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const r=n+i.byteLength;this.shards.push({buffer:i,start:n,end:r}),n=r}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const i=n-e,r=new ArrayBuffer(i),o=new Uint8Array(r);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,f=a,g=Math.min(n,c.end)-c.start,v=new Uint8Array(c.buffer,d,g-d);if(o.set(v,f),a+=v.length,n<c.end)break}return r}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(i){return e<i.start?-1:e>=i.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=xX(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function xX(t,e){let n=0,s=t.length;for(;n<=s;){const i=Math.floor((s-n)/2)+n,r=e(t[i]);if(r===0)return i;r<0?s=i:n=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cr(){return W}function FN(){return W.memory()}function X(t,e){return W.tidy(t,e)}function We(t){LO(t).forEach(n=>n.dispose())}function br(t){return W.keep(t)}function VO(t,e,n=1){return W.registerBackend(t,e,n)}function _X(){return W.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cu=4;async function MN(t,e){const n=[],s=[],i=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<i.length;++o){const a=i[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async d=>{const f=await l.bytes(),m=f.reduce((_,x)=>_+x.length,0)+cu*f.length,g=new Uint8Array(m);let v=0;for(let _=0;_<f.length;_++){const x=f[_],w=new Uint8Array(new Uint32Array([x.length]).buffer);g.set(w,v),v+=cu,g.set(x,v),v+=x.length}d(g)});s.push(h)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const r=await Promise.all(s);return{data:IX(r),specs:n}}function wX(t,e){const n=new va(t),s={};let i=0;for(const r of e){const o=bX(r,(a,l)=>n.slice(i+a,i+l));s[r.name]=CX(r,n.slice(i,i+o)),i+=o}return s}function bX(t,e){const n=re(t.shape);let s;if("quantization"in t){const i=t.quantization;s=Fg[i.dtype]}else if(t.dtype==="string"){let i=0;for(let r=0;r<n;r++)i+=cu+new Uint32Array(e(i,i+cu))[0];return i}else s=Fg[t.dtype];return n*s}function CX(t,e){const n=t.name,s=t.dtype,i=t.shape,r=re(i);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=Fg[l.dtype],h=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(h.length);for(let d=0;d<h.length;d++){const f=h[d];o[d]=f*l.scale+l.min}}else if(l.dtype==="float16")o=PX()(h);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(h.length);for(let d=0;d<h.length;d++){const f=h[d];o[d]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=r*c}else if(s==="string"){const l=re(t.shape);o=[];for(let c=0;c<l;c++){const h=new Uint32Array(e.slice(a,a+cu))[0];a+=cu;const d=new Uint8Array(e.slice(a,a+h));o.push(d),a+=h}}else{const l=Fg[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const c=new Float32Array(o.length/2),h=new Float32Array(o.length/2);for(let g=0;g<c.length;g++)c[g]=o[g*2],h[g]=o[g*2+1];const d=Xh(c,i,"float32"),f=Xh(h,i,"float32"),m=_l(d,f);return d.dispose(),f.dispose(),m}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=r*l}return Xh(o,i,s)}function IX(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(r=>{if(e+=r.byteLength,n.push(r.byteLength===r.buffer.byteLength?r:new r.constructor(r)),!(r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${r.constructor.name}`)});const s=new Uint8Array(e);let i=0;return n.forEach(r=>{s.set(new Uint8Array(r.buffer),i),i+=r.byteLength}),s.buffer}const FC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function zN(t){return FC?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function kX(t){if(FC)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,i=e.length;s<i;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function SX(t){if(FC){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function TX(t){return va.join(t)}function EX(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function NX(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function $X(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),NX(t,n,s)}function MC(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:zN(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:zN(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new va(t.weightData).byteLength}}function BN(t){const e=[];for(const n of t)e.push(...n.weights);return e}function RX(){const t=n=>{let s=n<<13,i=0;for(;!(s&8388608);)i-=8388608,s<<=1;return s&=-8388609,i+=947912704,s|i},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function AX(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function DX(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function PX(){const t=RX(),e=AX(),n=DX();return s=>{const i=new ArrayBuffer(4*s.length),r=new Uint32Array(i);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];r[o]=l}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return yn.instance==null&&(yn.instance=new yn),yn.instance}static registerSaveRouter(e){yn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){yn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return yn.getHandlers(e,"save")}static getLoadHandlers(e,n){return yn.getHandlers(e,"load",n)}static getHandlers(e,n,s){const i=[];return(n==="load"?yn.getInstance().loadRouters:yn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&i.push(a)}),i}}const OX=t=>yn.getSaveHandlers(t),LX=(t,e)=>yn.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z0="tensorflowjs",B0=1,Ja="models_store",Po="model_info_store";function GO(){if(!ee().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function U0(t){const e=t.result;e.createObjectStore(Ja,{keyPath:"modelPath"}),e.createObjectStore(Po,{keyPath:"modelPath"})}class wl{constructor(e){if(this.indexedDB=GO(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,i)=>{const r=this.indexedDB.open(z0,B0);r.onupgradeneeded=()=>U0(r),r.onsuccess=()=>{const o=r.result;if(n==null){const a=o.transaction(Ja,"readonly"),c=a.objectStore(Ja).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=h=>(o.close(),i(c.error)),a.oncomplete=()=>o.close()}else{n.weightData=va.join(n.weightData);const a=MC(n),l=o.transaction(Po,"readwrite");let c=l.objectStore(Po),h;try{h=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return i(f)}let d;h.onsuccess=()=>{d=o.transaction(Ja,"readwrite");const f=d.objectStore(Ja);let m;try{m=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(g){return i(g)}m.onsuccess=()=>s({modelArtifactsInfo:a}),m.onerror=g=>{c=l.objectStore(Po);const v=c.delete(this.modelPath);v.onsuccess=()=>(o.close(),i(m.error)),v.onerror=_=>(o.close(),i(m.error))}},h.onerror=f=>(o.close(),i(h.error)),l.oncomplete=()=>{d==null?o.close():d.oncomplete=()=>o.close()}}},r.onerror=o=>i(r.error)})}}wl.URL_SCHEME="indexeddb://";const jO=t=>ee().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(wl.URL_SCHEME)?FX(t.slice(wl.URL_SCHEME.length)):null;yn.registerSaveRouter(jO);yn.registerLoadRouter(jO);function FX(t){return new wl(t)}function MX(t){return t.startsWith(wl.URL_SCHEME)?t.slice(wl.URL_SCHEME.length):t}class zX{constructor(){this.indexedDB=GO()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(z0,B0);s.onupgradeneeded=()=>U0(s),s.onsuccess=()=>{const i=s.result,r=i.transaction(Po,"readonly"),a=r.objectStore(Po).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(i.close(),n(a.error)),r.oncomplete=()=>i.close()},s.onerror=i=>n(s.error)})}async removeModel(e){return e=MX(e),new Promise((n,s)=>{const i=this.indexedDB.open(z0,B0);i.onupgradeneeded=()=>U0(i),i.onsuccess=()=>{const r=i.result,o=r.transaction(Po,"readwrite"),a=o.objectStore(Po),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return r.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=a.delete(e),d=()=>{c=r.transaction(Ja,"readwrite");const m=c.objectStore(Ja).delete(e);m.onsuccess=()=>n(l.result.modelArtifactsInfo),m.onerror=g=>s(l.error)};h.onsuccess=d,h.onerror=f=>(d(),r.close(),s(l.error))}},l.onerror=h=>(r.close(),s(l.error)),o.oncomplete=()=>{c==null?r.close():c.oncomplete=()=>r.close()}},i.onerror=r=>s(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vr="/",_c="tensorflowjs_models",HO="info",BX="model_topology",UX="weight_specs",WX="weight_data",VX="model_metadata";function qO(t){return{info:[_c,t,HO].join(Vr),topology:[_c,t,BX].join(Vr),weightSpecs:[_c,t,UX].join(Vr),weightData:[_c,t,WX].join(Vr),modelMetadata:[_c,t,VX].join(Vr)}}function KO(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function GX(t){const e=t.split(Vr);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Vr)}function jX(t){return t.startsWith(bl.URL_SCHEME)?t.slice(bl.URL_SCHEME.length):t}class bl{constructor(e){if(!ee().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=qO(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),i=MC(e),r=va.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,kX(r));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}}catch{throw KO(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const r=this.LS.getItem(this.keys.modelMetadata);if(r!=null){const a=JSON.parse(r);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=SX(o),n}}bl.URL_SCHEME="localstorage://";const XO=t=>ee().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(bl.URL_SCHEME)?HX(t.slice(bl.URL_SCHEME.length)):null;yn.registerSaveRouter(XO);yn.registerLoadRouter(XO);function HX(t){return new bl(t)}class qX{constructor(){R(ee().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),R(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=_c+Vr,s=Vr+HO;for(let i=0;i<this.LS.length;++i){const r=this.LS.key(i);if(r.startsWith(n)&&r.endsWith(s)){const o=GX(r);e[o]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){e=jX(e);const n=qO(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return KO(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UN="://";class ur{constructor(){this.managers={}}static getInstance(){return ur.instance==null&&(ur.instance=new ur),ur.instance}static registerManager(e,n){R(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(UN)&&(e=e.slice(0,e.indexOf(UN))),R(e.length>0,()=>"scheme must not be an empty string.");const s=ur.getInstance();R(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=ur.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(ur.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KX{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!ee().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const i=this.functionRefs[s.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return IO(e)}}if(ee().get("IS_BROWSER")){ee().setPlatform("browser",new KX);try{ur.registerManager(bl.URL_SCHEME,new qX)}catch{}try{ur.registerManager(wl.URL_SCHEME,new zX)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XX={importFetch:()=>require("node-fetch")};let q_;class ZX{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return ee().global.fetch!=null?ee().global.fetch(e,n):(q_==null&&(q_=XX.importFetch()),q_(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ee().get("IS_NODE")&&!ee().get("IS_BROWSER")&&ee().setPlatform("node",new ZX);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ge(t,e="float32",n){return e=e||"float32",po(t),new An(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(t,e){const n=F(t,"x","cast");if(!D8(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},i={dtype:e};return W.runKernel(df,s,i)}const _e=j({cast_:YX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(t){const n={x:F(t,"x","clone","string_or_numeric")};return W.runKernel(kf,n)}const rl=j({clone_:QX});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */MO();const eZ={buffer:Ge,cast:_e,clone:rl,print:JX};hX(eZ);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tZ(t,e){let n=F(t,"a","add"),s=F(e,"b","add");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Ru,i)}const pe=j({add_:tZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(t,e){let n=F(t,"a","floorDiv"),s=F(e,"b","floorDiv");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Cf,i)}const ZO=j({floorDiv_:nZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(t,e){let n=F(t,"a","div"),s=F(e,"b","div");if([n,s]=Xt(n,s),n.dtype==="int32"&&s.dtype==="int32")return ZO(n,s);const i={a:n,b:s},r={};return W.runKernel(yf,i,r)}const Re=j({div_:sZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iZ(t,e){let n=F(t,"a","mul"),s=F(e,"b","mul");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Pf,i)}const U=j({mul_:iZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(t){const e=F(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return W.runKernel(tv,n)}else{const n={x:e};return W.runKernel(Ky,n)}}const Yn=j({abs_:rZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oZ(t){const n={x:F(t,"x","acos")};return W.runKernel(rf,n)}const aZ=j({acos_:oZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(t){const n={x:F(t,"x","acosh")};return W.runKernel(of,n)}const cZ=j({acosh_:lZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(t,e=null,n=!1){const i={x:F(t,"x","all","bool")},r={axis:e,keepDims:n};return W.runKernel(X1,i,r)}const YO=j({all_:uZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(t,e=null,n=!1){const i={x:F(t,"x","any","bool")},r={axis:e,keepDims:n};return W.runKernel(Z1,i,r)}const W0=j({any_:hZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dZ(t,e=0){const s={x:F(t,"x","argMax")},i={axis:e};return W.runKernel(Xy,s,i)}const Ed=j({argMax_:dZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(t,e=0){const s={x:F(t,"x","argMin")},i={axis:e};return W.runKernel(Zy,s,i)}const pZ=j({argMin_:fZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(t){const n={x:F(t,"x","asin")};return W.runKernel(af,n)}const gZ=j({asin_:mZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(t){const n={x:F(t,"x","asinh")};return W.runKernel(lf,n)}const vZ=j({asinh_:yZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xZ(t){const n={x:F(t,"x","atan")};return W.runKernel(cf,n)}const _Z=j({atan_:xZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t,e){let n=F(t,"a","atan2"),s=F(e,"b","atan2");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(hf,i)}const bZ=j({atan2_:wZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(t){const n={x:F(t,"x","atanh")};return W.runKernel(uf,n)}const IZ=j({atanh_:CZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function np(t,e,n,s,i="NHWC",r){const o=t[3],a=[...e,o],l=go(i);return Pn(t,a,n,r,s,null,null,l)}function wi(t,e,n,s,i,r,o="channelsLast"){const[a,l]=Nd(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Pn(t,c,n,s,i,r,!1,o)}function mo(t,e,n,s,i,r,o="NDHWC"){const[a,l,c]=V0(e);let h,d;if(o==="NDHWC")d="channelsLast",h=[a,l,c,t[4],t[4]];else if(o==="NCDHW")d="channelsFirst",h=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return xa(t,h,n,s,i,!1,d,r)}function Pn(t,e,n,s,i,r,o=!1,a="channelsLast"){let[l,c,h,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,h,d]=t;else if(a==="channelsFirst")[l,d,c,h]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,m,,g]=e,[v,_]=Nd(n),[x,w]=Nd(s),C=qc(f,x),I=qc(m,w),{padInfo:S,outHeight:T,outWidth:E}=TZ(i,c,h,v,_,C,I,r,a),$=o?g*d:g;let D;return a==="channelsFirst"?D=[l,$,T,E]:a==="channelsLast"&&(D=[l,T,E,$]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:h,inChannels:d,outHeight:T,outWidth:E,outChannels:$,padInfo:S,strideHeight:v,strideWidth:_,filterHeight:f,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:I,dilationHeight:x,dilationWidth:w,inShape:t,outShape:D,filterShape:e}}function xa(t,e,n,s,i,r=!1,o="channelsLast",a){let[l,c,h,d,f]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,h,d,f]=t;else if(o==="channelsFirst")[l,f,c,h,d]=t;else throw new Error(`Unknown dataFormat ${o}`);const[m,g,v,,_]=e,[x,w,C]=V0(n),[I,S,T]=V0(s),E=qc(m,I),$=qc(g,S),D=qc(v,T),{padInfo:P,outDepth:z,outHeight:H,outWidth:Q}=EZ(i,c,h,d,x,w,C,E,$,D,a),Z=r?_*f:_;let J;return o==="channelsFirst"?J=[l,Z,z,H,Q]:o==="channelsLast"&&(J=[l,z,H,Q,Z]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:h,inWidth:d,inChannels:f,outDepth:z,outHeight:H,outWidth:Q,outChannels:Z,padInfo:P,strideDepth:x,strideHeight:w,strideWidth:C,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:E,effectiveFilterHeight:$,effectiveFilterWidth:D,dilationDepth:I,dilationHeight:S,dilationWidth:T,inShape:t,outShape:J,filterShape:e}}function kZ(t,e,n,s,i){s==null&&(s=zC(t,e,n));const r=t[0],o=t[1],a=$d((r-e+2*s)/n+1,i),l=$d((o-e+2*s)/n+1,i);return[a,l]}function SZ(t,e,n,s,i,r){i==null&&(i=zC(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*i>=e[a]&&(o[a]=$d((t[a]-e[a]+2*i)/s[a]+1,r));return o}function zC(t,e,n,s=1){const i=qc(e,s);return Math.floor((t[0]*(n-1)-n+i)/2)}function Nd(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function V0(t){return typeof t=="number"?[t,t,t]:t}function qc(t,e){return e<=1?t:t+(t-1)*(e-1)}function TZ(t,e,n,s,i,r,o,a,l){let c,h,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const m=kZ([e,n],r,s,t,a);h=m[0],d=m[1]}else if(t==="same"){h=Math.ceil(e/s),d=Math.ceil(n/i);const f=Math.max(0,(h-1)*s+r-e),m=Math.max(0,(d-1)*i+o-n),g=Math.floor(f/2),v=f-g,_=Math.floor(m/2),x=m-_;c={top:g,bottom:v,left:_,right:x,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-r+1)/s),d=Math.ceil((n-o+1)/i);else if(typeof t=="object"){const f=l==="channelsLast"?t[1][0]:t[2][0],m=l==="channelsLast"?t[1][1]:t[2][1],g=l==="channelsLast"?t[2][0]:t[3][0],v=l==="channelsLast"?t[2][1]:t[3][1];c={top:f,bottom:m,left:g,right:v,type:f===0&&m===0&&g===0&&v===0?"VALID":"EXPLICIT"},h=$d((e-r+f+m)/s+1,a),d=$d((n-o+g+v)/i+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:h,outWidth:d}}function EZ(t,e,n,s,i,r,o,a,l,c,h){let d,f,m,g;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const _=SZ([e,n,s,1],[a,l,c],1,[i,r,o],t,h);f=_[0],m=_[1],g=_[2]}else if(t==="same"){f=Math.ceil(e/i),m=Math.ceil(n/r),g=Math.ceil(s/o);const v=(f-1)*i+a-e,_=(m-1)*r+l-n,x=(g-1)*o+c-s,w=Math.floor(v/2),C=v-w,I=Math.floor(_/2),S=_-I,T=Math.floor(x/2),E=x-T;d={top:I,bottom:S,left:T,right:E,front:w,back:C,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:f,outHeight:m,outWidth:g}}function $d(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Cl(t){const[e,n,s]=Nd(t);return e===1&&n===1&&s===1}function jn(t,e){return Cl(t)||Cl(e)}function Il(t){return Nd(t).every(e=>e>0)}function go(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function vs(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")R(ou(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(i=>{R(ou(i),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(t,e){const s={x:F(t,"x","reshape","string_or_numeric")},i={shape:e};return W.runKernel(Ov,s,i)}const G=j({reshape_:NZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(t,e,n,s,i){const r=F(t,"x","avgPool","float32"),o=1;R(jn(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=r,l=!1;r.rank===3&&(l=!0,a=G(r,[1,r.shape[0],r.shape[1],r.shape[2]])),R(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),vs("avgPool",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i};let d=W.runKernel(Yy,c,h);return d=_e(d,r.dtype),l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const BC=j({avgPool_:$Z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(t,e,n,s,i,r="NDHWC"){const o=F(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),R(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),R(r==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),R(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),vs("avgPool3d",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:r};let d=W.runKernel(Qy,c,h);return d=_e(d,a.dtype),l?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const AZ=j({avgPool3d_:RZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(t,e=0){R(t.length>=1,()=>"Pass at least one tensor to concat");const n=WO(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(r=>{if(r.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${r.dtype}. `)}),n.length===1)return rl(n[0]);const s=n,i={axis:e};return W.runKernel(nv,s,i)}const ds=j({concat_:DZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(t,e,n=!1,s=!1){let i=F(t,"a","matMul"),r=F(e,"b","matMul");[i,r]=Xt(i,r);const o={a:i,b:r},a={transposeA:n,transposeB:s};return W.runKernel(Jy,o,a)}const lt=j({matMul_:PZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(t){const n={x:F(t,"x","sigmoid","float32")};return W.runKernel(jf,n)}const Au=j({sigmoid_:OZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LZ(t,e,n){const s=F(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const i={x:s},r={begin:e,size:n};return W.runKernel(Bv,i,r)}const Ct=j({slice_:LZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(t){const n={x:F(t,"x","tanh","float32")};return W.runKernel(Yf,n)}const Xv=j({tanh_:FZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(t,e,n){const s=F(t,"x","batchToSpaceND"),i=e.reduce((a,l)=>a*l);R(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),R(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),R(s.shape[0]%i===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`);const r={x:s},o={blockShape:e,crops:n};return W.runKernel(ev,r,o)}const UC=j({batchToSpaceND_:MZ});function zZ(t){let e;return t.rank===0||t.rank===1?e=G(t,[1,1,1,t.size]):t.rank===2?e=G(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(t,e,n,s,i,r){r==null&&(r=.001);const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;s!=null&&(h=F(s,"offset","batchNorm")),R(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:zZ(o),scale:c,offset:h,mean:a,variance:l},m={varianceEpsilon:r},g=W.runKernel(hv,f,m);return G(g,o.shape)}const Zv=j({batchNorm_:BZ});function UZ(t,e,n,s,i,r){const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;return s!=null&&(h=F(s,"offset","batchNorm")),R(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),R(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),R(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&R(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&R(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Zv(o,a,l,h,c,r)}const WZ=j({batchNorm2d_:UZ});function VZ(t,e,n,s,i,r){const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;return s!=null&&(h=F(s,"offset","batchNorm")),R(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),R(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),R(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&R(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&R(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Zv(o,a,l,h,c,r)}const GZ=j({batchNorm3d_:VZ});function jZ(t,e,n,s,i,r){const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;return s!=null&&(h=F(s,"offset","batchNorm")),R(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),R(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),R(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&R(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&R(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Zv(o,a,l,h,c,r)}const HZ=j({batchNorm4d_:jZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qZ(t,e,n){const s=F(t,"x","bincount"),i=F(e,"weights","bincount");R(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),R(n>=0,()=>`size must be non-negative, but got ${n}.`),R(i.size===s.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${i.shape}.`);const r={x:s,weights:i},o={size:n};return W.runKernel(J1,r,o)}const KZ=j({bincount_:qZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(t,e){let n=F(t,"broadcastTo","x");const s=n.shape;if(po(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=G(n,c)}const i=n.shape,r=Array.from(e);for(let c=e.length-1;c>=0;c--)if(i[c]===e[c])r[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(r.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return rl(n);const a={x:n},l={reps:r};return W.runKernel(Qf,a,l)}const Zh=j({broadcastTo_:XZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(t){const n={x:F(t,"x","ceil","float32")};return W.runKernel(ff,n)}const YZ=j({ceil_:ZZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yv(t,e,n){po(t),n=n||Nu(e);const s={shape:t,value:e,dtype:n};return W.runKernel(pC,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(t,e,n){const s=F(t,"x","clipByValue");if(R(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Yv(s.shape,e,s.dtype);const i={x:s},r={clipValueMin:e,clipValueMax:n};return W.runKernel(pf,i,r)}const qs=j({clipByValue_:QZ});function JZ(t){return ds(t,0)}const e7=j({concat1d_:JZ});function t7(t,e){return ds(t,e)}const n7=j({concat2d_:t7});function s7(t,e){return ds(t,e)}const i7=j({concat3d_:s7});function r7(t,e){return ds(t,e)}const o7=j({concat4d_:r7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7(t,e,n,s,i="NHWC",r=[1,1],o){const a=F(t,"x","conv2d","float32"),l=F(e,"filter","conv2d","float32");let c=a,h=!1;a.rank===3&&(h=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),vs("conv2d",s,o);const d=i==="NHWC"?c.shape[3]:c.shape[1];R(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),R(jn(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),R(Il(r),()=>"Error in conv2D: Dilated rates should be larger than 0."),R(Il(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},m={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},g=W.runKernel(sv,f,m);return h?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const kl=j({conv2d_:a7});function l7(t,e,n,s,i="NWC",r=1,o){const a=F(t,"x","conv1d"),l=F(e,"filter","conv1d");let c=a,h=!1;a.rank===2&&(h=!0,c=G(a,[1,a.shape[0],a.shape[1]])),R(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),R(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),vs("conv1d",s,o),R(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),R(jn(n,r),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${r}'`),R(Il(r),()=>"Error in conv1D: Dilated rates should be larger than 0."),R(Il(n),()=>"Error in conv1D: Stride should be larger than 0."),R(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const d=G(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=G(c,[c.shape[0],1,c.shape[1],c.shape[2]]),_=kl(f,d,[1,n],s,"NHWC",[1,r],o);return h?G(_,[_.shape[2],_.shape[3]]):G(_,[_.shape[0],_.shape[2],_.shape[3]])}const QO=j({conv1d_:l7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7(t,e,n,s,i,r="NHWC",o){R(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),R(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),R(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),R(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const h=r==="NHWC"?a[3]:a[1],d=r==="NHWC"?l.shape[3]:l.shape[1];R(h===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[2]}.`),R(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),vs("conv2dDerInput",i,o);const f={dy:l,filter:n},m={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,inputShape:a},g=W.runKernel(iv,f,m);return c?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const WC=j({conv2DBackpropInput_:c7});function u7(t,e,n,s,i,r){const o=F(t,"x","conv2dTranspose"),a=F(e,"filter","conv2dTranspose");return WC(n,o,a,s,i,"NHWC",r)}const JO=j({conv2dTranspose_:u7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(t,e,n,s,i="NDHWC",r=[1,1,1]){const o=F(t,"x","conv3d"),a=F(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),R(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),R(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),R(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),R(jn(n,r),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),R(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),R(Il(r),()=>"Error in conv3D: Dilated rates should be larger than 0."),R(Il(n),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},d={strides:n,pad:s,dataFormat:i,dilations:r},f=W.runKernel(rv,h,d);return c?G(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const d7=j({conv3d_:h7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(t,e,n,s,i){R(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let r=t,o=e,a=!1;e.rank===4&&(a=!0,o=G(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),r=[1,t[0],t[1],t[2],t[3]]);const l=r[4],c=o.shape[4];R(r.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${r.length}.`),R(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),R(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),R(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),R(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const h={dy:o,filter:n},d={pad:i,strides:s,inputShape:r},f=W.runKernel(iC,h,d);return a?G(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const eL=j({conv3DBackpropInput_:f7});function p7(t,e,n,s,i){const r=F(t,"x","conv3dTranspose"),o=F(e,"filter","conv3dTranspose");return eL(n,r,o,s,i)}const m7=j({conv3dTranspose_:p7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(t){const n={x:F(t,"x","cos","float32")};return W.runKernel(mf,n)}const VC=j({cos_:g7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(t){const n={x:F(t,"x","cosh","float32")};return W.runKernel(gf,n)}const tL=j({cosh_:y7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v7(t,e=0,n=!1,s=!1){const r={x:F(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return W.runKernel(rC,r,o)}const G0=j({cumprod_:v7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(t,e=0,n=!1,s=!1){const r={x:F(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return W.runKernel(ov,r,o)}const nL=j({cumsum_:x7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(t,e,n,s=!1){const i=F(t,"x","denseBincount"),r=F(e,"weights","denseBincount");R(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),R(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),R(n>=0,()=>`size must be non-negative, but got ${n}.`),R(r.size===i.size||r.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${r.shape}.`);const o={x:i,weights:r},a={size:n,binaryOutput:s};return W.runKernel(aC,o,a)}const WN=j({denseBincount_:_7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(t,e,n="NHWC"){const s=F(t,"x","depthToSpace","float32"),i=n==="NHWC"?s.shape[1]:s.shape[2],r=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];R(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),R(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e}  for depthToSpace with input shape
    ${s.shape}`),R(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e} for depthToSpace with input shape
        ${s.shape}`),R(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return W.runKernel(lC,a,l)}const b7=j({depthToSpace_:w7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7(t,e,n,s,i="NHWC",r=[1,1],o){const a=F(t,"x","depthwiseConv2d","float32"),l=F(e,"filter","depthwiseConv2d","float32");let c=a,h=!1;a.rank===3&&(h=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=i==="NHWC"?c.shape[3]:c.shape[1];R(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),vs("depthwiseConv2d",s,o);const f={x:c,filter:l},m={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},g=W.runKernel(av,f,m);return h?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const GC=j({depthwiseConv2d_:C7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(t,e,n,s,i=[1,1],r="NHWC"){const o=F(t,"x","dilation2d"),a=F(e,"filter","dilation2d");R(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),R(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),R(r==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${r}`);let l=o,c=!1;o.rank===3&&(l=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),R(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},d={strides:n,pad:s,dilations:i},f=W.runKernel(lv,h,d);return c?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const k7=j({dilation2d_:I7});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uu(t,e){const n=t.length,s=[];for(let i=0;i<n;i++){const r=n-1-i,o=t[r]||1;(e[e.length-1-i]||1)>1&&o===1&&s.unshift(r)}return s}function pn(t,e){const n=[];for(let s=0;s<e.length;s++){const i=t[t.length-s-1],r=e.length-s-1,o=e[r];(i==null||i===1&&o>1)&&n.unshift(r)}return n}function ze(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let i=0;i<n;i++){let r=t[t.length-i-1];r==null&&(r=1);let o=e[e.length-i-1];if(o==null&&(o=1),r===1)s[n-i-1]=o;else if(o===1)s[n-i-1]=r;else if(r!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-i-1]=r}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(t,e){let n=F(t,"a","equal","string_or_numeric"),s=F(e,"b","equal","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(cv,i)}const Er=j({equal_:S7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T7(t,e,n){const s=F(e,"a","where"),i=F(n,"b","where"),r=F(t,"condition","where","bool"),o=ze(ze(r.shape,s.shape),i.shape),a=Zh(r,o),l=Zh(s,o),c=Zh(i,o),h={condition:a,t:l,e:c};return W.runKernel(zv,h)}const ns=j({where_:T7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(t){const n={x:F(t,"x","zerosLike")};return W.runKernel(qv,n)}const et=j({zerosLike_:E7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7(t,e){let n=F(t,"a","div"),s=F(e,"b","div");[n,s]=Xt(n,s);const i=Re(n,s),r=et(i),o=Er(s,r);return ns(o,r,i)}const $7=j({divNoNan_:N7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(t,e){const n=F(t,"t1","dot"),s=F(e,"t2","dot");R((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const i=n.rank===1?n.size:n.shape[1],r=s.rank===1?s.size:s.shape[0];if(R(i===r,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${r}.`),n.rank===1&&s.rank===1){const o=G(n,[1,-1]),a=G(s,[-1,1]),l=lt(o,a);return G(l,[])}else if(n.rank===1&&s.rank===2){const o=G(n,[1,-1]),a=G(s,[s.shape[0],s.shape[1]]),l=lt(o,a);return G(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=G(s,[-1,1]),a=lt(n,o);return G(a,[a.size])}else{const o=G(s,[s.shape[0],s.shape[1]]);return lt(n,o)}}const A7=j({dot_:R7});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(t,...e){const n=e.map((i,r)=>F(i,`tensors${r}`,"einsum")),s={equation:t};return W.runKernel(hC,n,s)}const xh=j({einsum_:D7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(t){const n={x:F(t,"x","elu","float32")};return W.runKernel(vf,n)}const Qv=j({elu_:P7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(t){let e=F(t,"x","erf");R(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=_e(e,"float32"));const n={x:e};return W.runKernel(xf,n)}const sL=j({erf_:O7});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jC(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function iL(t,e,n){const s=t.length+e.length,i=[];let r=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?i.push(t[r++]):i.push(e[o++]);return i}function In(t,e){const n=[],s=t.length;for(let r=0;r<s;r++)e.indexOf(r)===-1&&n.push(t[r]);const i=e.map(r=>t[r]);return[n,i]}function sn(t,e){const n=e.map(s=>1);return iL(t,n,e)}function On(t,e,n){R(jC(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Bt(t,e){if(jC(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function _a(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Zt(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(t,e=null,n=!1){const i={x:F(t,"x","max")},r={reductionIndices:e,keepDims:n};return W.runKernel(wv,i,r)}const ji=j({max_:L7});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7(t,e=null,n=!1){const i={x:F(t,"x","min")},r={axis:e,keepDims:n};return W.runKernel(kv,i,r)}const Mg=j({min_:F7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(t,e){let n=F(t,"base","pow"),s=F(e,"exp","pow");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Of,i)}const Sl=j({pow_:M7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rt(t,e){if((xi(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&xi(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return tp(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(t){const n={x:F(t,"x","sqrt","float32")};return W.runKernel(qf,n)}const Gn=j({sqrt_:z7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7(t){const e=F(t,"x","square"),n={};return W.runKernel("Square",{x:e},n)}const Et=j({square_:B7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(t,e=null,n=!1){let s=F(t,"x","sum");s.dtype==="bool"&&(s=_e(s,"int32"));const i={x:s},r={axis:e,keepDims:n};return W.runKernel(Uv,i,r)}const $e=j({sum_:U7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(t,e="euclidean",n=null,s=!1){t=F(t,"x","norm");const i=rL(t,e,n);let r=i.shape;if(s){const o=je(n,t.shape);r=sn(i.shape,o)}return G(i,r)}function rL(t,e,n=null){if(t.rank===0)return Yn(t);if(t.rank!==1&&n===null)return rL(G(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return $e(Yn(t),n);if(e===1/0)return ji(Yn(t),n);if(e===-1/0)return Mg(Yn(t),n);if(e==="euclidean"||e===2)return Gn($e(Sl(Yn(t),rt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return ji($e(Yn(t),n[0]),n[1]-1);if(e===1/0)return ji($e(Yn(t),n[1]),n[0]);if(e===-1/0)return Mg($e(Yn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return Gn($e(Et(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Jv=j({norm_:W7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(t,e=null,n=!1){return Jv(t,"euclidean",e,n)}const G7=j({euclideanNorm_:V7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(t){const n={x:F(t,"x","exp")};return W.runKernel(_f,n)}const Nr=j({exp_:j7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H7(t,e=0){const n=F(t,"x","expandDims","string_or_numeric");R(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},i={dim:e};return W.runKernel(uv,s,i)}const cs=j({expandDims_:H7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(t){const n={x:F(t,"x","expm1")};return W.runKernel(wf,n)}const K7=j({expm1_:q7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(t,e){const n=F(t,"x","tile","string_or_numeric");R(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},i={reps:e};return W.runKernel(Qf,s,i)}const zi=j({tile_:X7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(t,e,n,s="float32"){e==null&&(e=t);const i=Ge([t,e],s),r=t<=e?t:e;for(let a=0;a<r;++a)i.set(1,a,a);const o=G(i.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return zi(cs(o,0),[n[0],1,1]);if(n.length===2)return zi(cs(cs(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return zi(cs(cs(cs(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const oL=j({eye_:Z7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(t){const n={x:F(t,"x","floor","float32")};return W.runKernel(bf,n)}const ex=j({floor_:Y7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(t,e,n=0,s=0){const i=F(t,"x","gather"),r=F(e,"indices","gather","int32"),o={x:i,indices:r},a={axis:n,batchDims:s};return W.runKernel(dv,o,a)}const HC=j({gather_:Q7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J7(t,e){let n=F(t,"a","greater","string_or_numeric"),s=F(e,"b","greater","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(fv,i)}const Zs=j({greater_:J7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(t,e){let n=F(t,"a","greaterEqual","string_or_numeric"),s=F(e,"b","greaterEqual","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(If,i)}const Hl=j({greaterEqual_:e9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9(t){const n={input:F(t,"input","imag")};return W.runKernel(yC,n)}const qC=j({imag_:t9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n9(t){const n={x:F(t,"x","isFinite")};return W.runKernel(Sf,n)}const s9=j({isFinite_:n9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(t){const n={x:F(t,"x","isInf")};return W.runKernel(Tf,n)}const r9=j({isInf_:i9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o9(t){const n={x:F(t,"x","isNaN")};return W.runKernel(Ef,n)}const a9=j({isNaN_:o9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9(t,e=.2){const s={x:F(t,"x","leakyRelu")},i={alpha:e};return W.runKernel(pv,s,i)}const KC=j({leakyRelu_:l9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(t,e){let n=F(t,"a","less","string_or_numeric"),s=F(e,"b","less","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(mv,i)}const zg=j({less_:c9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u9(t,e){let n=F(t,"a","lessEqual","string_or_numeric"),s=F(e,"b","lessEqual","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(gv,i)}const Du=j({lessEqual_:u9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h9(t,e=5,n=1,s=1,i=.5){const r=F(t,"x","localResponseNormalization");R(r.rank===4||r.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${r.rank}.`),R(ou(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=r,a=!1;r.rank===3&&(a=!0,o=G(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:s,beta:i},h=W.runKernel(_v,l,c);return a?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const d9=j({localResponseNormalization_:h9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(t){const n={x:F(t,"x","log","float32")};return W.runKernel(Nf,n)}const $r=j({log_:f9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9(t){const n={x:F(t,"x","log1p")};return W.runKernel($f,n)}const aL=j({log1p_:p9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(t,e){R(S0(t),()=>"The f passed in variableGrads(f) must be a function"),R(e==null||Array.isArray(e)&&e.every(c=>c instanceof Lg),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in W.registeredVariables)e.push(W.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,i=e.length;e=e.filter(c=>c.trainable),R(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const r=!0,{value:o,grads:a}=W.gradients(t,e,null,r);R(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),R(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,h)=>{a[h]!=null&&(l[c.name]=a[h])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:o,grads:l}}function hu(t){return W.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(t){const n={x:F(t,"x","neg")};return W.runKernel(Tv,n)}const Kt=j({neg_:g9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y9(t){const n={x:F(t,"x","softplus")};return W.runKernel(Hf,n)}const sp=j({softplus_:y9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(t){const e=F(t,"x","logSigmoid");return hu(s=>({value:Kt(sp(Kt(s))),gradFunc:o=>U(o,Au(Kt(s)))}))(e)}const x9=j({logSigmoid_:v9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _9(t,e){let n=F(t,"a","sub"),s=F(e,"b","sub");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Xf,i)}const Ae=j({sub_:_9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(t,e=-1){const n=F(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return hu((i,r)=>{const a=ji(i,e,!0),l=Ae(i,a),c=Ae(_e(l,"float32"),$r($e(Nr(l),e,!0)));return r([c]),{value:c,gradFunc:(d,f)=>{const[m]=f,g=!0,v=Nr(m);return Ae(d,U($e(d,e,g),v))}}})(n)}const lL=j({logSoftmax_:w9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9(t,e=null,n=!1){const s=F(t,"x","logSumExp"),i=je(e,s.shape),r=ji(s,i,!0),o=Ae(s,r),a=Nr(o),l=$e(a,i),c=$r(l),h=pe(G(r,c.shape),c);if(n){const d=sn(h.shape,i);return G(h,d)}return h}const cL=j({logSumExp_:b9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(t,e){const n=F(t,"a","logicalAnd","bool"),s=F(e,"b","logicalAnd","bool");ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(yv,i)}const oo=j({logicalAnd_:C9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I9(t){const n={x:F(t,"x","logicalNot","bool")};return W.runKernel(vv,n)}const XC=j({logicalNot_:I9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(t,e){const n=F(t,"a","logicalOr","bool"),s=F(e,"b","logicalOr","bool");ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(xv,i)}const uL=j({logicalOr_:k9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(t,e){const n=F(t,"a","logicalXor","bool"),s=F(e,"b","logicalXor","bool");return ze(n.shape,s.shape),oo(uL(t,e),XC(oo(t,e)))}const T9=j({logicalXor_:S9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(t,e,n,s,i){const r=F(t,"x","maxPool"),o=1;let a=r,l=!1;r.rank===3&&(l=!0,a=G(r,[1,r.shape[0],r.shape[1],r.shape[2]])),R(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),R(jn(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),vs("maxPool",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i},d=W.runKernel(bv,c,h);return l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const ZC=j({maxPool_:E9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(t,e=[1,1,1],n,s,i,r="NDHWC"){const o=F(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),R(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),R(r==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),vs("maxPool3d",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:r},d=W.runKernel(Cv,c,h);return l?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const $9=j({maxPool3d_:N9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(t,e){let n=F(t,"a","maximum"),s=F(e,"b","maximum");[n,s]=Xt(n,s),n.dtype==="bool"&&(n=_e(n,"int32"),s=_e(s,"int32")),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(Rf,i)}const wa=j({maximum_:R9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(t,e=null,n=!1){const i={x:F(t,"x","mean")},r={axis:e,keepDims:n};return W.runKernel(Iv,i,r)}const nn=j({mean_:A9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _n(t,e="float32"){if(po(t),e==="complex64"){const s=_n(t,"float32"),i=_n(t,"float32");return _l(s,i)}const n=Vn(re(t),e);return W.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ba(t,e="float32"){if(po(t),e==="complex64"){const s=ba(t,"float32"),i=_n(t,"float32");return _l(s,i)}const n=j1(re(t),e);return W.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(t,e){let n=F(t,"a","minimum"),s=F(e,"b","minimum");[n,s]=Xt(n,s),n.dtype==="bool"&&(n=_e(n,"int32"),s=_e(s,"int32")),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(Af,i)}const Rd=j({minimum_:D9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(t,e,n){R(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=F(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");R(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)R(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),R(e[a][0]>=0&&e[a][0]<=s.shape[a]-i&&e[a][1]>=0&&e[a][1]<=s.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-i} or less than 0 for input of shape ${s.shape}`);const r={paddings:e,mode:n},o={x:s};return W.runKernel(Sv,o,r)}const O9=j({mirrorPad_:P9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(t,e){let n=F(t,"a","mod"),s=F(e,"b","mod");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Df,i)}const F9=j({mod_:L9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M9(t,e=null,n=!1){t=F(t,"x","moments");const s=je(e,t.shape),i=nn(t,s,n);let r=i.shape;n||(r=sn(i.shape,s));const o=Et(Ae(_e(t,"float32"),G(i,r))),a=nn(o,s,n);return{mean:i,variance:a}}const YC=j({moments_:M9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(t,e){let n=F(t,"a","notEqual","string_or_numeric"),s=F(e,"b","notEqual","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(Ev,i)}const Bg=j({notEqual_:z9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B9(t,e,n=1,s=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:F(t,"indices","oneHot","int32")},a={dtype:i,depth:e,onValue:n,offValue:s};return W.runKernel($v,o,a)}const hL=j({oneHot_:B9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(t){const n={x:F(t,"x","onesLike")};return W.runKernel(Nv,n)}const _i=j({onesLike_:U9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9(t,e,n=0){const s=F(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},r={x:s};return W.runKernel(Av,r,i)}const QC=j({pad_:W9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(t,e,n){const s=F(t,"x","spaceToBatchND");R(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),R(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),R(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const i={x:s},r={blockShape:e,paddings:n};return W.runKernel(Wv,i,r)}const JC=j({spaceToBatchND_:V9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(t,e,n,s,i,r,o){i==null&&(i=[1,1]),r==null&&(r=1),s===0&&(s="valid");const a=F(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(jn(r,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`);const h=wi(l.shape,e,r,i,s),d=[h.dilationHeight,h.dilationWidth];let f;s==="same"?f=H9([h.filterHeight,h.filterWidth],d):f=[[0,0],[0,0]];const m=d[0]===1&&d[1]===1,[g,v]=j9([h.inHeight,h.inWidth],d,f),_=m?s:"valid",x=m?l:JC(l,d,g),C=(n==="avg"?()=>BC(x,e,r,_,o):()=>ZC(x,e,r,_,o))(),I=m?C:UC(C,d,v);return c?G(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function j9(t,e,n){const s=n.map(h=>h[0]),i=n.map(h=>h[1]),r=t.concat(s,i),o=e.map((h,d)=>(h-r[d]%h)%h),a=i.map((h,d)=>h+o[d]),l=e.map((h,d)=>[s[d],a[d]]),c=e.map((h,d)=>[0,o[d]]);return[l,c]}function H9(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),i=s.map(o=>Math.floor(o/2)),r=s.map((o,a)=>o-i[a]);return s.map((o,a)=>[i[a],r[a]])}const q9=j({pool_:G9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(t,e){const n=F(t,"x","prelu"),s=F(e,"alpha","prelu"),i={x:n,alpha:s};return W.runKernel(Dv,i)}const eI=j({prelu_:K9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(t,e=null,n=!1){let s=F(t,"x","prod");s.dtype==="bool"&&(s=_e(s,"int32"));const i={x:s},r={axis:e,keepDims:n};return W.runKernel(Pv,i,r)}const Z9=j({prod_:X9});var tI={exports:{}};tI.exports;(function(t){(function(e,n,s){function i(l){var c=this,h=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(l),c.s0<0&&(c.s0+=1),c.s1-=h(l),c.s1<0&&(c.s1+=1),c.s2-=h(l),c.s2<0&&(c.s2+=1),h=null}function r(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var h=new i(l),d=c&&c.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&r(d,h),f.state=function(){return r(h,{})}),f}function a(){var l=4022871197,c=function(h){h=String(h);for(var d=0;d<h.length;d++){l+=h.charCodeAt(d);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:this.alea=o})(ua,t)})(tI);var Y9=tI.exports,nI={exports:{}};nI.exports;(function(t){(function(e,n,s){function i(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(typeof h=="object"&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xor128=o})(ua,t)})(nI);var Q9=nI.exports,sI={exports:{}};sI.exports;(function(t){(function(e,n,s){function i(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,h==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(typeof h=="object"&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xorwow=o})(ua,t)})(sI);var J9=sI.exports,iI={exports:{}};iI.exports;(function(t){(function(e,n,s){function i(a){var l=this;l.next=function(){var h=l.x,d=l.i,f,m;return f=h[d],f^=f>>>7,m=f^f<<24,f=h[d+1&7],m^=f^f>>>10,f=h[d+3&7],m^=f^f>>>3,f=h[d+4&7],m^=f^f<<7,f=h[d+7&7],f=f^f<<13,m^=f^f<<9,h[d]=m,l.i=d+1&7,m};function c(h,d){var f,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,f=0;f<d.length;++f)m[f&7]=m[f&7]<<15^d.charCodeAt(f)+m[f+1&7]<<13;for(;m.length<8;)m.push(0);for(f=0;f<8&&m[f]===0;++f);for(f==8?m[7]=-1:m[f],h.x=m,h.i=0,f=256;f>0;--f)h.next()}c(l,a)}function r(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(h.x&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xorshift7=o})(ua,t)})(iI);var eY=iI.exports,rI={exports:{}};rI.exports;(function(t){(function(e,n,s){function i(a){var l=this;l.next=function(){var h=l.w,d=l.X,f=l.i,m,g;return l.w=h=h+1640531527|0,g=d[f+34&127],m=d[f=f+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,g=d[f]=g^m,l.i=f,g+(h^h>>>16)|0};function c(h,d){var f,m,g,v,_,x=[],w=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,w=Math.max(w,d.length)),g=0,v=-32;v<w;++v)d&&(m^=d.charCodeAt((v+32)%d.length)),v===0&&(_=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,v>=0&&(_=_+1640531527|0,f=x[v&127]^=m+_,g=f==0?g+1:0);for(g>=128&&(x[(d&&d.length||0)&127]=-1),g=127,v=4*128;v>0;--v)m=x[g+34&127],f=x[g=g+1&127],m^=m<<13,f^=f<<17,m^=m>>>15,f^=f>>>12,x[g]=m^f;h.w=_,h.X=x,h.i=g}c(l,a)}function r(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(h.X&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xor4096=o})(ua,t)})(rI);var tY=rI.exports,oI={exports:{}};oI.exports;(function(t){(function(e,n,s){function i(a){var l=this,c="";l.next=function(){var d=l.b,f=l.c,m=l.d,g=l.a;return d=d<<25^d>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-m|0,l.d=m<<16^f>>>16^g,l.a=g-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var h=0;h<c.length+20;h++)l.b^=c.charCodeAt(h)|0,l.next()}function r(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(typeof h=="object"&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.tychei=o})(ua,t)})(oI);var nY=oI.exports,dL={exports:{}};const sY={},iY=Object.freeze(Object.defineProperty({__proto__:null,default:sY},Symbol.toStringTag,{value:"Module"})),rY=yW(iY);(function(t){(function(e,n,s){var i=256,r=6,o=52,a="random",l=s.pow(i,r),c=s.pow(2,o),h=c*2,d=i-1,f;function m(I,S,T){var E=[];S=S==!0?{entropy:!0}:S||{};var $=x(_(S.entropy?[I,C(n)]:I??w(),3),E),D=new g(E),P=function(){for(var z=D.g(r),H=l,Q=0;z<c;)z=(z+Q)*i,H*=i,Q=D.g(1);for(;z>=h;)z/=2,H/=2,Q>>>=1;return(z+Q)/H};return P.int32=function(){return D.g(4)|0},P.quick=function(){return D.g(4)/4294967296},P.double=P,x(C(D.S),n),(S.pass||T||function(z,H,Q,Z){return Z&&(Z.S&&v(Z,D),z.state=function(){return v(D,{})}),Q?(s[a]=z,H):z})(P,$,"global"in S?S.global:this==s,S.state)}function g(I){var S,T=I.length,E=this,$=0,D=E.i=E.j=0,P=E.S=[];for(T||(I=[T++]);$<i;)P[$]=$++;for($=0;$<i;$++)P[$]=P[D=d&D+I[$%T]+(S=P[$])],P[D]=S;(E.g=function(z){for(var H,Q=0,Z=E.i,J=E.j,Y=E.S;z--;)H=Y[Z=d&Z+1],Q=Q*i+Y[d&(Y[Z]=Y[J=d&J+H])+(Y[J]=H)];return E.i=Z,E.j=J,Q})(i)}function v(I,S){return S.i=I.i,S.j=I.j,S.S=I.S.slice(),S}function _(I,S){var T=[],E=typeof I,$;if(S&&E=="object")for($ in I)try{T.push(_(I[$],S-1))}catch{}return T.length?T:E=="string"?I:I+"\0"}function x(I,S){for(var T=I+"",E,$=0;$<T.length;)S[d&$]=d&(E^=S[d&$]*19)+T.charCodeAt($++);return C(S)}function w(){try{var I;return f&&(I=f.randomBytes)?I=I(i):(I=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(I)),C(I)}catch{var S=e.navigator,T=S&&S.plugins;return[+new Date,e,T,e.screen,C(n)]}}function C(I){return String.fromCharCode.apply(0,I)}if(x(s.random(),n),t.exports){t.exports=m;try{f=rY}catch{}}else s["seed"+a]=m})(typeof self<"u"?self:ua,[],Math)})(dL);var oY=dL.exports,aY=Y9,lY=Q9,cY=J9,uY=eY,hY=tY,dY=nY,ql=oY;ql.alea=aY;ql.xor128=lY;ql.xorwow=cY;ql.xorshift7=uY;ql.xor4096=hY;ql.tychei=dY;var aI=ql;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fL{constructor(e,n,s,i,r){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=r||Math.random();this.random=aI.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let e,n,s=!1;for(;!s;){let i,r,o;do i=2*this.random()-1,r=2*this.random()-1,o=i*i+r*r;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*r*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class fY{constructor(e=0,n=1,s,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=aI.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pY(t,e=0,n=1,s,i){if(po(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const r=new fL(e,n,s,!1,i),o=Ge(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const mY=j({randomNormal_:pY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gY(t,e=0,n=1,s="float32",i){po(t);const r=Ge(t,s),o=new fY(e,n,null,i);for(let a=0;a<r.values.length;a++)r.values[a]=o.nextValue();return r.toTensor()}const ip=j({randomUniform_:gY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ad(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:s};return W.runKernel(IC,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(t){const n={input:F(t,"input","real")};return W.runKernel(kC,n)}const Ug=j({real_:yY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(t){const n={x:F(t,"x","reciprocal")};return W.runKernel(Lf,n)}const xY=j({reciprocal_:vY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Y(t){const n={x:F(t,"x","relu")};return W.runKernel(Ff,n)}const Kl=j({relu_:_Y});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(t){const n={x:F(t,"x","relu6")};return W.runKernel(Mf,n)}const pL=j({relu6_:wY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(t,e){const s={x:F(t,"x","reverse")},i={dims:e};return W.runKernel(Mv,s,i)}const Tl=j({reverse_:bY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(t){const n={x:F(t,"x","round")};return W.runKernel(zf,n)}const mL=j({round_:CY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IY(t){const n={x:F(t,"x","rsqrt","float32")};return W.runKernel(Bf,n)}const gL=j({rsqrt_:IY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(t){const n={x:F(t,"x","selu")};return W.runKernel(Uf,n)}const yL=j({selu_:kY});function SY(t,e,n,s,i,r=[1,1],o="NHWC"){const a=F(t,"x","separableConv2d"),l=F(e,"depthwiseFilter","separableConv2d"),c=F(n,"pointwiseFilter","separableConv2d");let h=a,d=!1;if(a.rank===3&&(d=!0,h=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");R(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),R(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),R(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),R(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],m=l.shape[3];R(c.shape[2]===f*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*m}, but got ${c.shape[2]}.`);const g=GC(h,l,s,i,o,r),_=kl(g,c,1,"valid",o);return d?G(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const vL=j({separableConv2d_:SY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(t){const n={x:F(t,"x","sign")};return W.runKernel(Gf,n)}const EY=j({sign_:TY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(t){const n={x:F(t,"x","sin","float32")};return W.runKernel(Wf,n)}const xL=j({sin_:NY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(t){const n={x:F(t,"x","sinh")};return W.runKernel(Vf,n)}const _L=j({sinh_:$Y});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(t,e,n){const s=F(t,"x","slice1d");return R(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ct(s,[e],[n])}const lI=j({slice1d_:RY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(t,e,n){const s=F(t,"x","slice2d");return R(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ct(s,e,n)}const wL=j({slice2d_:AY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(t,e,n){const s=F(t,"x","slice3d");return R(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ct(s,e,n)}const cI=j({slice3d_:DY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(t,e,n){const s=F(t,"x","slice4d");return R(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ct(s,e,n)}const Wg=j({slice4d_:PY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(t,e=-1){const n=F(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},i={dim:e};return W.runKernel(Gv,s,i)}const uI=j({softmax_:OY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(t){R(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(fC,e)}const bL=j({fft_:LY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(t){R(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(gC,e)}const j0=j({ifft_:FY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MY(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const i=G(t,[n,e]);s=j0(i)}else{const i=[n,2*(e-1)],r=G(Ug(t),[n,e]),o=G(qC(t),[n,e]),a=Tl(Ct(r,[0,1],[n,e-2]),1),l=U(Tl(Ct(o,[0,1],[n,e-2]),1),rt(-1)),c=ds([r,a],1),h=ds([o,l],1),d=G(_l(c,h),[i[0],i[1]]);s=j0(d)}if(s=Ug(s),t.rank===3&&t.shape[0]!==0){const i=s,r=t.shape[0];s=G(s,[r,s.shape[0]/r,s.shape[1]]),i.dispose()}return s}const zY=j({irfft_:MY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BY(t,e,n=0){const i={x:F(t,"x","split")},r={numOrSizeSplits:e,axis:n};return W.runKernel(Vv,i,r)}const js=j({split_:BY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(t,e){R(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let i;if(e!=null&&e<n){const g=t.shape.map(_=>0),v=t.shape.map(_=>_);v[t.shape.length-1]=e,i=Ct(t,g,v),n=e}else if(e!=null&&e>n){const g=t.shape.map(v=>v);g[t.shape.length-1]=e-n,i=ds([t,_n(g)],t.shape.length-1),n=e}else i=t;const r=et(i),o=G(_l(i,r),[s,n]),a=bL(o),l=Math.floor(n/2)+1,c=Ug(a),h=qC(a),d=js(c,[l,n-l],c.shape.length-1),f=js(h,[l,n-l],h.shape.length-1),m=i.shape.slice();return m[i.shape.length-1]=l,G(_l(d[0],f[0]),m)}const WY=j({rfft_:UY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VY(t,e){let n=F(t,"a","squaredDifference"),s=F(e,"b","squaredDifference");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s},r={};return W.runKernel(Kf,i,r)}const GY=j({squaredDifference_:VY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jY(t,e){const n=F(t,"x","squeeze","string_or_numeric");return G(n,ga(n.shape,e).newShape)}const rp=j({squeeze_:jY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HY(t,e=0){const n=WO(t,"tensors","stack","string_or_numeric");R(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&R(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,i={axis:e};return W.runKernel(Rv,s,i)}const ao=j({stack_:HY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(t,e=0){const s={x:F(t,"x","step")},i={alpha:e};return W.runKernel(Jf,s,i)}const op=j({step_:qY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(t,e,n,s,i=0,r=0,o=0,a=0,l=0){const h={x:F(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return W.runKernel($C,h,d)}const XY=j({stridedSlice_:KY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(t){const n={x:F(t,"x","tan","float32")};return W.runKernel(Zf,n)}const YY=j({tan_:ZY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(t,e){G1(t);const n=ep(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return tp(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_(t,e,n){if(G1(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=ep(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return tp(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(t,e,n){if(G1(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=ep(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return tp(t,e,s,n)}function CL(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,r=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(r+` update.rank < ${i}. `);if(t.length<s+(n.rank-i))throw new Error(r+` Output shape length < ${s+(n.rank-i)}`);if(n.rank!==i+t.length-s)throw new Error(r+` update.rank != ${i+t.length-s}`);for(let o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(r+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+s])throw new Error(r+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${t[o+i]})`)}function JY(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}CL(n,e,t)}function Xl(t,e,n){const s=e.shape.length,i=s>1?e.shape[s-1]:1,r=n.length;let o=1;for(let d=i;d<r;++d)o*=n[d];const a=i<1?1:i,l=re(e.shape)/a,c=[...Te(n.slice(0,i)),1],h=re(n);return{sliceRank:i,numUpdates:l,sliceSize:o,strides:c,outputSize:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(t,e=1,n=!0){const s=F(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const r={x:s},o={k:e,sorted:n},[a,l]=W.runKernel(RC,r,o);return{values:a,indices:l}}const tQ=j({topk_:eQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(t,e=0,n=1,s,i){if(po(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const r=new fL(e,n,s,!0,i),o=Ge(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const IL=j({truncatedNormal_:nQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(t,e=0){const n=F(t,"x","unique","string_or_numeric");R(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},i={axis:e},[r,o]=W.runKernel(DC,s,i);return{values:r,indices:o}}const iQ=j({unique_:sQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(t,e,n){const s=F(t,"x","unsortedSegmentSum"),i=F(e,"segmentIds","unsortedSegmentSum","int32");R(ou(n),()=>"numSegments must be of dtype int");const r={x:s,segmentIds:i},o={numSegments:n};return W.runKernel(Hv,r,o)}const kL=j({unsortedSegmentSum_:rQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(t,e=0){const n=F(t,"x","unstack","string_or_numeric");R(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},i={axis:e};return W.runKernel(jv,s,i)}const El=j({unstack_:oQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(t,e=!0,n,s){return W.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(t,e){const n=[];for(let r=0;r<e.length;r++)e[r]&&n.push(r);const s=Ge(t,"int32"),i=Ge([n.length,t.length],"int32");for(let r=0;r<n.length;r++){const o=s.indexToLoc(n[r]),a=r*t.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(t,e,n){const s=F(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),R(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{R(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const i={x:s},r={perm:e};return s.dtype==="complex64"?X(()=>{let o=Ug(s),a=qC(s);return o=W.runKernel(Hc,{x:o},r),a=W.runKernel(Hc,{x:a},r),n&&(a=Kt(a)),_l(o,a)}):W.runKernel(Hc,i,r)}const Je=j({transpose_:lQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(t,e){if(e==null)return t.shape.slice();if(ct(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(t,e,n,s){const i=F(t,"x","dropout");if(R(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),R(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof an?i.clone():i;const r=cQ(i,n),o=1-e,a=Re(ex(pe(ip(r,0,1,"float32",s),o)),o);return U(i,a)}const hQ=j({dropout_:uQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(t,e,n,s,i,r="NHWC",o){let a=t;t.rank===3&&(a=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]])),R(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),R(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),R(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=r==="NHWC"?a.shape[3]:a.shape[1],h=r==="NHWC"?l.shape[3]:l.shape[1];R(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),R(h===n[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${n[3]}).`),vs("conv2dDerFilter",i,o);const d={x:a,dy:l},f={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,filterShape:n};return W.runKernel(nC,d,f)}const hI=j({conv2DBackpropFilter_:dQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dI(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return U(t,op(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function fI(t,e){let n=e;const s=pn(t.shape,e.shape);return s.length>0&&(n=$e(n,s)),G(n,t.shape)}function pI(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Kl(t);if(e==="elu")return Qv(t);if(e==="relu6")return pL(t);if(e==="prelu")return eI(t,n);if(e==="leakyrelu")return KC(t,s);if(e==="sigmoid")return Au(t);throw new Error(`Unknown fused activation ${e}.`)}const mI=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ({x:t,filter:e,strides:n,pad:s,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(l=l||"linear",mI(W.state.gradientDepth,l)===!1){R(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let T=kl(t,e,n,s,i,r,o);return a!=null&&(T=pe(T,a)),pI(T,l,c,h)}const d=F(t,"x","conv2d","float32"),f=F(e,"filter","conv2d","float32");let m=d,g=!1;d.rank===3&&(g=!0,m=G(d,[1,d.shape[0],d.shape[1],d.shape[2]])),R(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),R(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),vs("fused conv2d",s,o);const v=i==="NHWC"?m.shape[3]:m.shape[1];R(f.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${f.shape[2]}.`),R(jn(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`);const _=Pn(m.shape,f.shape,n,r,s,o);let x;a!=null&&(x=F(a,"bias","fused conv2d"),[x]=Xt(x,d),i==="NHWC"?ze(_.outShape,x.shape):(R(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),R(x.shape.length===0||x.shape[0]===_.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${_.outChannels})`)));let w;if(c!=null){const T=c.shape;if(R(T.length<=1||T.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${T.length}.`),T.length===1)R(T[0]===1||T[0]===_.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the number of output channels (${_.outChannels}).`);else if(T.length===3)try{ze(T,_.outShape)}catch{const $=`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the output shape of the conv2d (${_.outShape}).`;throw Error($)}w=F(c,"prelu weights","fused conv2d")}const C=(T,E)=>{R(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[$,D,P,z]=E,H=dI(T,P,l);R(Cl(r),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const Q=WC(D.shape,H,$,n,s),Z=hI(D,H,$.shape,n,s),J=[Q,Z];if(z!=null){const Y=fI(z,H);J.push(Y)}return J},I={x:m,filter:f,bias:x,preluActivationWeights:w},S={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?hu((E,$,D)=>{let P=W.runKernel(Dg,I,S);return D([$,E,P]),g&&(P=G(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:C}})(m,f):hu((E,$,D,P)=>{let z=W.runKernel(Dg,I,S);return P([$,E,z,D]),g&&(z=G(z,[z.shape[1],z.shape[2],z.shape[3]])),{value:z,gradFunc:C}})(m,f,x)}const pQ=j({fusedConv2d_:fQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(t,e,n,s,i,r=[1,1],o){let a=t;t.rank===3&&(a=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},h={strides:s,pad:i,dimRoundingMode:o,dilations:r,filterShape:n};return W.runKernel(cC,c,h)}const gQ=j({depthwiseConv2dNativeBackpropFilter_:mQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(t,e,n,s,i,r=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},h={strides:s,pad:i,dimRoundingMode:o,dilations:r,inputShape:t},d=W.runKernel(uC,c,h);return l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const vQ=j({depthwiseConv2dNativeBackpropInput_:yQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:i,activation:r="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(mI(W.state.gradientDepth,r)===!1){let z=lt(t,e,n,s);return i!=null&&(z=pe(z,i)),pI(z,r,o,a)}let l=F(t,"a","fused matMul"),c=F(e,"b","fused matMul");[l,c]=Xt(l,c);const h=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],m=s?c.shape[c.rank-2]:c.shape[c.rank-1],g=l.shape.slice(0,-2),v=c.shape.slice(0,-2),_=re(g),x=re(v);R(h===d,()=>`Error in fused matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const C=ze(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,m]),I=n?G(l,[_,h,f]):G(l,[_,f,h]),S=s?G(c,[x,m,d]):G(c,[x,d,m]);let T;i!=null&&(T=F(i,"bias","fused matMul"),[T]=Xt(T,l),ze(C,T.shape));let E;o!=null&&(E=F(o,"prelu weights","fused matMul"));const $=(z,H)=>{const[Q,Z,J,Y]=H,oe=dI(G(z,J.shape),J,r);let O,q;if(!n&&!s?(O=lt(oe,Z,!1,!0),q=lt(Q,oe,!0,!1)):!n&&s?(O=lt(oe,Z,!1,!1),q=lt(oe,Q,!0,!1)):n&&!s?(O=lt(Z,oe,!1,!0),q=lt(Q,oe,!1,!1)):(O=lt(Z,oe,!0,!0),q=lt(oe,Q,!0,!0)),i!=null){const V=fI(Y,oe);return[O,q,V]}else return[O,q]},D={a:I,b:S,bias:T,preluActivationWeights:E},P={transposeA:n,transposeB:s,activation:r,leakyreluAlpha:a};return i==null?hu((H,Q,Z)=>{const J=W.runKernel(Ag,D,P);return Z([H,Q,J]),{value:G(J,C),gradFunc:$}})(I,S):hu((H,Q,Z,J)=>{const Y=W.runKernel(Ag,D,P);return J([H,Q,Y,Z]),{value:G(Y,C),gradFunc:$}})(I,S,T)}const VN=j({fusedMatMul_:xQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(t,e,n,s,i="bilinear",r=0){const o=F(t,"image","cropAndResize"),a=F(e,"boxes","cropAndResize","float32"),l=F(n,"boxInd","cropAndResize","int32"),c=a.shape[0];R(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),R(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),R(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),R(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),R(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),R(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const h={image:o,boxes:a,boxInd:l},d={method:i,extrapolationValue:r,cropSize:s};return W.runKernel(oC,h,d)}const wQ=j({cropAndResize_:_Q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(t){const e=F(t,"image","flipLeftRight","float32");R(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return W.runKernel(mC,n,{})}const CQ=j({flipLeftRight_:bQ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(t){const e=F(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];R(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),R(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,zi(e,i)}const kQ=j({grayscaleToRGB_:IQ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(t){const e=F(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];R(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),R(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const i=e.dtype,r=_e(e,"float32"),o=ks([.2989,.587,.114]);let a;switch(e.rank){case 2:a=xh("ij,j->i",r,o);break;case 3:a=xh("ijk,k->ij",r,o);break;case 4:a=xh("ijkl,l->ijk",r,o);break;case 5:a=xh("ijklm,m->ijkl",r,o);break;case 6:a=xh("ijklmn,n->ijklm",r,o);break;default:throw new Error("Not a valid tensor rank.")}return a=cs(a,-1),_e(a,i)}const TQ=j({rgbToGrayscale_:SQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(t,e,n=0,s=.5){const i=F(t,"image","rotateWithOffset","float32");R(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const r={image:i},o={radians:e,fillValue:n,center:s};return W.runKernel(PC,r,o)}const NQ=j({rotateWithOffset_:EQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pu(t,e,n,s,i,r){s==null&&(s=.5),i==null&&(i=Number.NEGATIVE_INFINITY),r==null&&(r=0);const o=t.shape[0];return n=Math.min(n,o),R(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),R(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),R(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),R(e.rank===1,()=>"scores must be a 1D tensor"),R(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),R(0<=r&&r<=1,()=>`softNmsSigma must be in [0, 1], but was '${r}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const r=F(t,"boxes","nonMaxSuppression","float32"),o=F(e,"scores","nonMaxSuppression","float32"),a=Pu(r,o,n,s,i);n=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:i};return W.runKernel(wC,{boxes:r,scores:o},l)}const RQ=j({nonMaxSuppression_:$Q});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(t,e,n){const s=DQ(t,e,n),i=s<0?-(s+1):s;t.splice(i,0,e)}function DQ(t,e,n){return OQ(t,e,n||PQ)}function PQ(t,e){return t>e?1:t<e?-1:0}function OQ(t,e,n){let s=0,i=t.length,r=0,o=!1;for(;s<i;){r=s+(i-s>>>1);const a=n(e,t[r]);a>0?s=r+1:(i=r,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gI(t,e,n,s,i){return xI(t,e,n,s,i,0)}function yI(t,e,n,s,i,r){return xI(t,e,n,s,i,0,!1,r,!0)}function vI(t,e,n,s,i,r){return xI(t,e,n,s,i,r,!0)}function xI(t,e,n,s,i,r,o=!1,a=!1,l=!1){const c=[];for(let _=0;_<e.length;_++)e[_]>i&&c.push({score:e[_],boxIndex:_,suppressBeginIndex:0});c.sort(GN);const h=r>0?-.5/r:0,d=[],f=[];for(;d.length<n&&c.length>0;){const _=c.pop(),{score:x,boxIndex:w,suppressBeginIndex:C}=_;if(x<i)break;let I=!1;for(let S=d.length-1;S>=C;--S){const T=LQ(t,w,d[S]);if(T>=s){I=!0;break}if(_.score=_.score*FQ(s,h,T),_.score<=i)break}_.suppressBeginIndex=d.length,I||(_.score===x?(d.push(w),f.push(_.score)):_.score>i&&AQ(c,_,GN))}const m=d.length,g=n-m;a&&g>0&&(d.push(...new Array(g).fill(0)),f.push(...new Array(g).fill(0)));const v={selectedIndices:d};return o&&(v.selectedScores=f),l&&(v.validOutputs=m),v}function LQ(t,e,n){const s=t.subarray(e*4,e*4+4),i=t.subarray(n*4,n*4+4),r=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(i[0],i[2]),h=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),m=(a-r)*(l-o),g=(d-c)*(f-h);if(m<=0||g<=0)return 0;const v=Math.max(r,c),_=Math.max(o,h),x=Math.min(a,d),w=Math.min(l,f),C=Math.max(x-v,0)*Math.max(w-_,0);return C/(m+g-C)}function FQ(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function GN(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function MQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const r=F(t,"boxes","nonMaxSuppressionAsync"),o=F(e,"scores","nonMaxSuppressionAsync"),a=Pu(r,o,n,s,i);n=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const l=await Promise.all([r.data(),o.data()]),c=l[0],h=l[1],{selectedIndices:d}=gI(c,h,n,s,i);return r!==t&&r.dispose(),o!==e&&o.dispose(),ks(d,"int32")}const zQ=MQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Pu(o,a,n,s,i,r);n=l.maxOutputSize,s=l.iouThreshold,i=l.scoreThreshold,r=l.softNmsSigma;const c={boxes:o,scores:a},h={maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:r},d=W.runKernel(CC,c,h);return{selectedIndices:d[0],selectedScores:d[1]}}const UQ=j({nonMaxSuppressionWithScore_:BQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function WQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Pu(o,a,n,s,i,r);n=l.maxOutputSize,s=l.iouThreshold,i=l.scoreThreshold,r=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),h=c[0],d=c[1],{selectedIndices:f,selectedScores:m}=vI(h,d,n,s,i,r);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ks(f,"int32"),selectedScores:ks(m)}}const VQ=WQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Pu(o,a,n,s,i,null),c=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,f={boxes:o,scores:a},m={maxOutputSize:c,iouThreshold:h,scoreThreshold:d,padToMaxOutputSize:r},g=W.runKernel(bC,f,m);return{selectedIndices:g[0],validOutputs:g[1]}}const jQ=j({nonMaxSuppressionPadded_:GQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function HQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Pu(o,a,n,s,i,null),c=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,[f,m]=await Promise.all([o.data(),a.data()]),{selectedIndices:g,validOutputs:v}=yI(f,m,c,h,d,r);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ks(g,"int32"),validOutputs:rt(v,"int32")}}const qQ=HQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KQ(t,e,n=!1,s=!1){const i=F(t,"images","resizeBilinear");R(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),R(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),R(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let r=i,o=!1;i.rank===3&&(o=!0,r=G(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},c=W.runKernel(Fv,a,l);return o?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const TL=j({resizeBilinear_:KQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(t,e,n=!1,s=!1){const i=F(t,"images","resizeNearestNeighbor");R(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),R(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),R(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),R(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let r=i,o=!1;i.rank===3&&(o=!0,r=G(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},c=W.runKernel(Lv,a,l);return o?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const EL=j({resizeNearestNeighbor_:XQ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZQ(t,e="binary",n=!1,s=.5){const i=F(t,"image","threshold"),r=.2989,o=.587,a=.114,l=i.shape[0]*i.shape[1];let c=U(ks([s]),255),h,d,f,m;if(R(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),R(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),R(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),R(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),i.shape[2]===3){[h,d,f]=js(i,[1,1,1],-1);const _=U(h,r),x=U(d,o),w=U(f,a);m=pe(pe(_,x),w)}else m=t;if(e==="otsu"){const _=KZ(_e(mL(m),"int32"),Xh([]),256);c=YQ(_,l)}const g=n?Du(m,c):Zs(m,c);return _e(U(g,255),"int32")}function YQ(t,e){let n=ks([-1]),s=ks([0]),i=ks([0]),r,o,a,l,c,h;for(let d=0;d<t.size-1;d++){r=Ct(t,0,d+1),o=Ct(t,d+1),c=Re($e(r),e),h=Re($e(o),e);const f=$e(U(r,Ad(0,r.size)));a=Re(f,$e(r));const m=Yv(o.shape,r.size),g=pe(Ad(0,o.size),m),v=U(o,g);l=Re($e(v),$e(o));const _=Ae(a,l),x=Ae(a,l),w=U(c,h);i=U(U(w,_),x);const C=Zs(i,s);s=ns(C,i,s),n=ns(C,ks([d]),n)}return n}const QQ=j({threshold_:ZQ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(t,e,n="nearest",s="constant",i=0,r){const o=F(t,"image","transform","float32"),a=F(e,"transforms","transform","float32");R(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),R(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),R(r==null||r.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${r}.`);const l={image:o,transforms:a},c={interpolation:n,fillMode:s,fillValue:i,outputShape:r};return W.runKernel(AC,l,c)}const eJ=j({transform_:JQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tJ(t,e,n){const s=F(t,"a","bandPart");R(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const i=s.shape,[r,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(R(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),R(e<=r,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${r}).`),a=F(e<0?r:e,"numLower","bandPart")):(R(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ns(zg(e,0),r,Rd(e,r))),typeof n=="number"?(R(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),R(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=F(n<0?o:n,"numUpper","bandPart")):(R(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ns(zg(n,0),o,Rd(n,o)));const c=G(Ad(0,r,1,"int32"),[-1,1]),h=Ad(0,o,1,"int32"),d=Ae(c,h),f=oo(Du(d,a),Hl(d,Kt(l))),m=_n([r,o],s.dtype);return G(ao(El(G(s,[-1,r,o])).map(g=>ns(f,g,m))),i)}const nJ=j({bandPart_:tJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sJ(t){let e;if(Array.isArray(t)){e=!1,R(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=t[0].shape[0];for(let r=1;r<t.length;++r)R(t[r].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[r].shape[0]} vs. ${i})`)}else e=!0,t=js(t,t.shape[0],0).map(i=>rp(i,[0]));R(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let i=0;i<t.length;++i)n.push(W.tidy(()=>{let r=s[i];if(i>0)for(let o=0;o<i;++o){const a=U($e(U(n[o],r)),n[o]);r=Ae(r,a)}return Re(r,Jv(r,"euclidean"))}));return e?ao(n,0):n}const iJ=j({gramSchmidt_:sJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rJ(t,e=!1){if(R(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return jN(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=El(G(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],r=[];s.forEach(l=>{const[c,h]=jN(l,e);i.push(c),r.push(h)});const o=G(ao(i,0),t.shape),a=G(ao(r,0),t.shape);return[o,a]}}function jN(t,e=!1){return W.tidy(()=>{R(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let i=oL(n),r=rl(t);const o=K_([[1]],[1,1]);let a=rl(o);const l=n>=s?s:n;for(let c=0;c<l;++c){const h=r,d=a,f=i;[a,r,i]=W.tidy(()=>{const m=Ct(r,[c,c],[n-c,1]),g=Jv(m),v=Ct(r,[c,c],[1,1]),_=ns(Zs(v,0),K_([[-1]]),K_([[1]])),x=Ae(v,U(_,g)),w=Re(m,x);w.shape[0]===1?a=rl(o):a=ds([o,Ct(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const C=Kt(Re(lt(_,x),g)),I=Ct(r,[c,0],[n-c,s]),S=U(C,a),T=Je(a);if(c===0)r=Ae(I,lt(S,lt(T,I)));else{const D=Ae(I,lt(S,lt(T,I)));r=ds([Ct(r,[0,0],[c,s]),D],0)}const E=Je(S),$=Ct(i,[0,c],[n,i.shape[1]-c]);if(c===0)i=Ae($,lt(lt($,a),E));else{const D=Ae($,lt(lt($,a),E));i=ds([Ct(i,[0,0],[n,c]),D],1)}return[a,r,i]}),We([h,d,f])}return!e&&n>s&&(i=Ct(i,[0,0],[n,s]),r=Ct(r,[0,0],[s,s])),[i,r]})}const oJ=j({qr_:rJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xr={flipLeftRight:CQ,grayscaleToRGB:kQ,resizeNearestNeighbor:EL,resizeBilinear:TL,rgbToGrayscale:TQ,rotateWithOffset:NQ,cropAndResize:wQ,nonMaxSuppression:RQ,nonMaxSuppressionAsync:zQ,nonMaxSuppressionWithScore:UQ,nonMaxSuppressionWithScoreAsync:VQ,nonMaxSuppressionPadded:jQ,nonMaxSuppressionPaddedAsync:qQ,threshold:QQ,transform:eJ},aJ={bandPart:nJ,gramSchmidt:iJ,qr:oJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ=new Map,cJ=new Map;class Ou{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class li{constructor(){this.classNameMap={}}static getMap(){return li.instance==null&&(li.instance=new li),li.instance}static register(e){li.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function de(t,e,n){R(t.className!=null,()=>"Class being registered does not have the static className property defined."),R(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),R(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,i=e+">"+s;return li.register(t),lJ.set(i,t),cJ.set(t,i),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ca extends Ou{minimize(e,n=!1,s){const{value:i,grads:r}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:r[a.name]}));this.applyGradients(o)}else this.applyGradients(r);return We(r),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return m9(e,n)}dispose(){this.iterations_!=null&&We(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:rt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ca,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NL extends Ca{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accum_grad`,variable:X(()=>et(r).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${s}/accum_var`,variable:X(()=>et(r).variable(o))});const a=Array.isArray(e)?e[i].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[i].variable,c=this.accumulatedUpdates[i].variable;X(()=>{const h=pe(U(l,this.rho),U(Et(a),1-this.rho)),d=U(Re(Gn(pe(c,this.epsilon)),Gn(pe(l,this.epsilon))),a),f=pe(U(c,this.rho),U(Et(d),1-this.rho));l.assign(h),c.assign(f);const m=pe(U(d,-this.learningRate),r);r.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(We(this.accumulatedGrads.map(e=>e.variable)),We(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $L extends Ca{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accumulator`,variable:X(()=>Yv(r.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[i].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[i].variable;X(()=>{const l=pe(a,Et(o));a.assign(l);const c=pe(U(Re(o,Gn(pe(l,W.backend.epsilon()))),-this.learningRate),r);r.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&We(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RL extends Ca{static get className(){return"Adam"}constructor(e,n,s,i=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],X(()=>{this.accBeta1=rt(n).variable(),this.accBeta2=rt(s).variable()}),i==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);X(()=>{const s=Ae(1,this.accBeta1),i=Ae(1,this.accBeta2);n.forEach((r,o)=>{const a=W.registeredVariables[r],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${r}/m`,variable:X(()=>et(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${r}/v`,variable:X(()=>et(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[r];if(c==null)return;const h=this.accumulatedFirstMoment[o].variable,d=this.accumulatedSecondMoment[o].variable,f=pe(U(h,this.beta1),U(c,1-this.beta1)),m=pe(U(d,this.beta2),U(Et(c),1-this.beta2)),g=Re(f,s),v=Re(m,i);h.assign(f),d.assign(m);const _=pe(U(Re(g,pe(Gn(v),this.epsilon)),-this.learningRate),a);a.assign(_)}),this.accBeta1.assign(U(this.accBeta1,this.beta1)),this.accBeta2.assign(U(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&We(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&We(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),X(()=>{this.accBeta1.assign(Sl(this.beta1,this.iterations_+1)),this.accBeta2.assign(Sl(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AL extends Ca{static get className(){return"Adamax"}constructor(e,n,s,i=null,r=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=i,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],X(()=>{this.iteration=rt(0).variable(),this.accBeta1=rt(n).variable()}),i==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);X(()=>{const s=Ae(1,this.accBeta1),i=Re(-this.learningRate,pe(U(this.iteration,this.decay),1));n.forEach((r,o)=>{const a=W.registeredVariables[r],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${r}/m`,variable:et(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${r}/v`,variable:et(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[r];if(c==null)return;const h=this.accumulatedFirstMoment[o].variable,d=this.accumulatedWeightedInfNorm[o].variable,f=pe(U(h,this.beta1),U(c,1-this.beta1)),m=U(d,this.beta2),g=Yn(c),v=wa(m,g);h.assign(f),d.assign(v);const _=pe(U(Re(i,s),Re(f,pe(v,this.epsilon))),a);a.assign(_)}),this.iteration.assign(pe(this.iteration,1)),this.accBeta1.assign(U(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&We(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&We(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _I extends Ca{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=Array.isArray(e)?e[i].tensor:e[s];if(r==null)return;const o=W.registeredVariables[s];X(()=>{const a=pe(U(this.c,r),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=br(rt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DL extends _I{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=rt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${s}/momentum`,variable:X(()=>et(r).variable(!1))});const o=this.accumulations[i].variable,a=Array.isArray(e)?e[i].tensor:e[s];a!=null&&X(()=>{let l;const c=pe(U(this.m,o),a);this.useNesterov?l=pe(U(this.c,pe(a,U(c,this.m))),r):l=pe(U(this.c,c),r),o.assign(c),r.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&We(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PL extends Ca{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,i=null,r=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,i==null&&(this.epsilon=W.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${s}/rms`,variable:X(()=>et(r).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${s}/momentum`,variable:X(()=>et(r).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${s}/mg`,variable:X(()=>et(r).variable(o))});const a=Array.isArray(e)?e[i].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[i].variable,c=this.accumulatedMoments[i].variable;X(()=>{const h=pe(U(l,this.decay),U(Et(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[i].variable,f=pe(U(d,this.decay),U(a,1-this.decay)),m=Re(U(a,this.learningRate),Gn(Ae(h,pe(Et(f),this.epsilon)))),g=pe(U(c,this.momentum),m);l.assign(h),d.assign(f),c.assign(g);const v=Ae(r,g);r.assign(v)}else{const d=pe(U(l,this.decay),U(Et(a),1-this.decay)),f=pe(U(c,this.momentum),Re(U(a,this.learningRate),Gn(pe(d,this.epsilon))));l.assign(d),c.assign(f);const m=Ae(r,f);r.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&We(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&We(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&We(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uJ=[NL,$L,RL,AL,DL,PL,_I];function hJ(){for(const t of uJ)de(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HN(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let i=0;const r=l=>(l.then(c=>{const h=n+ ++i/t.length*(s-n);return e(h),c}),l);function o(l){R(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){R(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),R(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),R(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function dJ(t,e){e==null&&(e={});const n=e.fetchFunc==null?ee().platform.fetch:e.fetchFunc,s=t.map(d=>n(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await HN(s,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await HN(a,e.onProgress,.5,1)}function fJ(t,e){var n;const s=e.fetchFunc==null?ee().platform.fetch:e.fetchFunc;let i=0,r;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;i<t.length;){r||(r=(await s(t[i],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await r.read();if(l){i++,r=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,i/t.length);continue}o.enqueue(c);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pJ="application/octet-stream",mJ="application/json";class wI{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(R(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ee().platform.fetch,R(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&R(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=EX(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(i)],{type:mJ}),"model.json"),e.weightData!=null){const o=va.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:pJ}),"model.weights.bin")}const r=await this.fetch(this.path,n);if(r.ok)return{modelArtifactsInfo:MC(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,i=n.weightsManifest;if(s==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return $X(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=BN(e.weightsManifest),i=()=>fJ(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:i})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,i]=gJ(n),r=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):o.push(r+c+i);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=BN(e),i=await dJ(n,this.loadOptions);return[s,i]}}wI.URL_SCHEME_REGEX=/^https?:\/\//;function gJ(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),i=n>e?t.substring(n):"";return[s+"/",i]}function qN(t){return t.match(wI.URL_SCHEME_REGEX)!=null}const OL=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>qN(s)):n=qN(t),n)return LL(t,e)}return null};yn.registerSaveRouter(OL);yn.registerLoadRouter(OL);function LL(t,e){return new wI(t,e)}function yJ(t,e){return LL(t,e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Oa;function vJ(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,i=!1,r=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)r=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(A0($0,W.backendName)!=null){const g={pixels:t},v={numChannels:e};return W.runKernel($0,g,v)}const[c,h]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let d;if(o)d=t.getContext("2d").getImageData(0,0,c,h).data;else if(s||n)d=t.data;else if(r||i||a){if(Oa==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Oa=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Oa=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Oa.canvas.width=c,Oa.canvas.height=h,Oa.drawImage(t,0,0,c,h),d=Oa.getImageData(0,0,c,h).data}let f;if(e===4)f=new Int32Array(d);else{const g=c*h;f=new Int32Array(g*e);for(let v=0;v<g;v++)for(let _=0;_<e;++_)f[v*e+_]=d[v*4+_]}return QY(f,[h,c,e],"int32")}const xJ=j({fromPixels_:vJ});function bI(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(re(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,r=i[i.length-1];let o=1;for(let d=0;d<i.length-1;++d)o*=i[d];const a=t.shape,l=i.slice();l.pop();let c=1;for(let d=r;d<n;++d)c*=a[d],l.push(a[d]);const h=[...Te(t.shape).map(d=>d/c),1].slice(0,r);return[l,o,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H0=-2,_J=-1;function CI(t,e,n){const s=t.shape.length;R(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),R(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let i=0;i<s;++i)R(e[i]+n[i]<=t.shape[i],()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`)}function wJ(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function II(t,e,n){const s=[];for(let i=0;i<t.length;i++)s[i]=Math.ceil((e[i]-t[i])/n[i]);return s}function FL(t,e,n,s){const i=[...t];for(let r=i.length;r<s.length;r++)i.push(1);for(let r=0;r<n;r++)r===0?i[e]=1:(i.splice(e,0,1),i.pop());return i}function ML(t,e,n){return n<=t?n:n-(e-1)}function zL(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function bJ(t,e,n,s,i,r,o,a,l){const c=t.length;let h=new Array(c),d=new Array(c),f=new Array(c);if(e.length&&n>0){const m=e[0],g=n+1;h=BL(o,m,g,s,t),d=UL(a,m,g,i,t),f=FL(r,m,g,t)}else for(let m=0;m<c;m++)h[m]=VL(o,s,r,t,m,l),d[m]=GL(a,i,r,t,m,l),f[m]=WL(r,m,l);return{begin:h,end:d,strides:f}}function BL(t,e,n,s,i){const r=[...i],o=zL(n,e);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=0;else{const l=ML(e,n,a);let c=s[l];t&1<<l&&(c=0),r[a]=c}return r}function UL(t,e,n,s,i){const r=[...i],o=zL(n,e);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=Number.MAX_SAFE_INTEGER;else{const l=ML(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),r[a]=c}for(let a=0;a<r.length;a++){const l=i[a];r[a]<0&&(r[a]+=l),r[a]=vl(0,r[a],i[a])}return r}function WL(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function VL(t,e,n,s,i,r){let o=e[i];const a=n[i]||1;(t&1<<i||r&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[i];return o<0&&(o+=l),o=vl(0,o,l-1),o}function GL(t,e,n,s,i,r){let o=e[i];const a=n[i]||1;(t&1<<i||r&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[i];return o<0&&(o+=l),a>0?o=vl(0,o,l):o=vl(-1,o,l-1),o}function kI(t,e,n){let s=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){s=i;break}for(let i=s+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function SI(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function tx(t,e,n){let s;const i=t.shape.length;typeof e=="number"?s=[e,...new Array(i-1).fill(0)]:e.length<i?s=e.concat(new Array(i-e.length).fill(0)):s=e.slice(),s.forEach(o=>{R(o!==-1,()=>"slice() does not support negative begin indexing.")});let r;return n==null?r=new Array(i).fill(-1):typeof n=="number"?r=[n,...new Array(i-1).fill(-1)]:n.length<i?r=n.concat(new Array(i-n.length).fill(-1)):r=n,r=r.map((o,a)=>o>=0?o:(R(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,r]}function TI(t,e,n,s,i,r,o,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let C=0;C<d.dims;C++)h&&1<<C&a&&d.numAddAxisAfterEllipsis++,1<<C&o&&(h=!0);h||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};CJ(d,f);let m=!0,g=!0,v=!0;const _=[],x=[];for(let C=0;C<t.length;++C){if(f.strides[C]===0)throw Error(`strides[${C}] must be non-zero`);const I=!!(f.shrinkAxisMask&1<<C),S=t[C];if(S===-1){_.push(I?1:-1);continue}const T=[f.beginMask&1<<C,f.endMask&1<<C],E=[f.strides[C]>0?0:-1,f.strides[C]>0?S:S-1];if(I&&f.strides[C]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&f.strides[C]===1;const $=!!(f.beginMask&1<<C&&f.endMask&1<<C);if(f.beginValid&&f.endValid){if(I){const H=f.begin[C]<0?S+f.begin[C]:f.begin[C];if(f.begin[C]=H,f.end[C]=f.begin[C]+1,H<0||H>=S)throw Error(`slice index ${f.begin[C]} of dimension ${C} out of bounds.`)}else f.begin[C]=KN(f.begin[C],0,f.strides[C],S,T,E),f.end[C]=KN(f.end[C],1,f.strides[C],S,T,E);const z=f.strides[C]===1&&f.begin[C]===0&&f.end[C]===S;m=m&&z,g=g&&(C===0&&f.strides[C]===1||z)}else m=m&&f.strides[C]===1&&$,g=g&&(C===0&&f.strides[C]===1||$);let D,P=!1;if(f.beginValid&&f.endValid?(D=f.end[C]-f.begin[C],P=!0):I?(D=1,P=!0):$&&S>=0&&(f.strides[C]<0?D=-S:D=S,P=!0),P){let z;D===0||D<0!=f.strides[C]<0?z=0:z=Math.trunc(D/f.strides[C])+(D%f.strides[C]!==0?1:0),_.push(z)}else _.push(-1)}for(let C=0;C<f.finalShapeGatherIndices.length;++C){const I=f.finalShapeGatherIndices[C];I>=0?x.push(_[I]):I===H0&&x.push(1)}return{finalShapeSparse:x.filter((C,I)=>f.finalShapeGatherIndices[I]!==H0),finalShape:x,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function CJ(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(H0),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(_J),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function KN(t,e,n,s,i,r){if(i[e])return n>0?r[e]:r[e+1&1];{const o=t<0?s+t:t;return o<r[0]?r[0]:o>r[1]?r[1]:o}}const IJ=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:CI,computeFlatOffset:SI,computeOutShape:II,getNormalizedAxes:bJ,isSliceContinous:kI,maskToAxes:wJ,parseSliceParams:tx,sliceInfo:TI,startForAxis:VL,startIndicesWithElidedDims:BL,stopForAxis:GL,stopIndicesWithElidedDims:UL,stridesForAxis:WL,stridesWithElidedDims:FL},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kJ{static sgd(e){return new _I(e)}static momentum(e,n,s=!1){return new DL(e,n,s)}static rmsprop(e,n=.9,s=0,i=null,r=!1){return new PL(e,n,s,i,r)}static adam(e=.001,n=.9,s=.999,i=null){return new RL(e,n,s,i)}static adadelta(e=.001,n=.95,s=null){return new NL(e,n,s)}static adamax(e=.002,n=.9,s=.999,i=null,r=0){return new AL(e,n,s,i,r)}static adagrad(e,n=.1){return new $L(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=kJ;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function jL(){return new Promise(t=>SJ(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EI(t,e){const n=t[0].length;t.forEach((i,r)=>{R(i.length===n,()=>`Error in concat${n}D: rank of tensors[${r}] must be the same as the rank of the rest (${n})`)}),R(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((i,r)=>{for(let o=0;o<n;o++)R(o===e||i[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${r}] (${i}) does not match the shape of the rest (${s}) along the non-concatenated axis ${r}.`)})}function Cr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fi;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Fi||(Fi={}));function HL(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let i=1;i<n.length;++i){const r=n[i],o=s[s.length-n.length+i],a=s[o];if(r>=0)if(a>=0){if(a!==r)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${r} but shape[${i+t}] = ${a}`)}else s[o]=r}return s}function qL(t){const e={FIRST_DIM_SIZE:Fi.FIRST_DIM_SIZE,VALUE_ROWIDS:Fi.VALUE_ROWIDS,ROW_LENGTHS:Fi.ROW_LENGTHS,ROW_SPLITS:Fi.ROW_SPLITS,ROW_LIMITS:Fi.ROW_LIMITS,ROW_STARTS:Fi.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function KL(t){return t.length===0?0:t[0]===Fi.FIRST_DIM_SIZE?t.length-1:t.length}function XL(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let i=0;i<Math.min(n,s-1);++i){const r=t[i],o=e[i+1];if(r>=0&&o>=0&&r!==1&&r!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${r} but ragged tensor input.flatValues.shape[${i-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NI=30;function nx(t){return t<=NI?t:T0(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $I(t,e,n){const s=n*(typeof t=="number"?t:t[0]),i=e*(typeof t=="number"?t:t[1]);return[s,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ap(t,e,n,s=!0){let i=[];if(s)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const r=e.length;for(let o=0;o<r;++o)i=i.concat([t[o+1]/e[o],e[o]]);i=i.concat(t.slice(r+1))}return i}function lp(t,e,n=!0){const s=[];if(n){s.push(e);for(let i=e+1;i<t;++i)i<=2*e?(s.push(i),s.push(i-(e+1))):s.push(i)}else{const i=[],r=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?r.push(o):i.push(o);s.push(...i),s.push(0),s.push(...r)}return s}function cp(t,e,n,s=!0){const i=[];s?i.push(t[0]/n):i.push(t[0]*n);for(let r=1;r<t.length;++r)r<=e.length?s?i.push(e[r-1]*t[r]):i.push(t[r]/e[r-1]):i.push(t[r]);return i}function RI(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function AI(t,e,n){const s=t.slice(0,1);for(let i=0;i<n;++i)s.push(t[i+1]-e[i][0]-e[i][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sx=1.7580993408473768,ix=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DI=.3275911,PI=.254829592,OI=-.284496736,LI=1.421413741,FI=-1.453152027,MI=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lo(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function ZL(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function YL(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function QL(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function zI(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function JL(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function eF(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const r=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(r),s[i]=Math.sin(r)}return{real:n,imag:s}}function tF(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),i=Math.cos(s),r=Math.sin(s);return{real:i,imag:r}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_="->",TJ=/->/g,XN=",",ZN="...";function BI(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(TJ,"").length)/X_.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${X_}").`);const[s,i]=t.split(X_);R(s.indexOf(ZN)===-1,()=>`The ellipsis notation ("${ZN}") is not supported yet.`);const r=s.split(XN),o=r.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<i.length;++f){const m=i[f];if(!r.some(g=>g.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);a.indexOf(m)===-1&&a.push(m)}for(let f=0;f<s.length;++f){const m=s[f];a.indexOf(m)===-1&&m!==XN&&a.push(m)}const l=new Array(r.length);for(let f=0;f<o;++f){if(new Set(r[f].split("")).size!==r[f].length)throw new Error(`Found duplicate axes in input component ${r[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let m=0;m<r[f].length;++m)l[f].push(a.indexOf(r[f][m]))}const c=a.length,h=i.length,d=[];for(let f=h;f<c;++f)d.push(f);return{allDims:a,summedDims:d,idDims:l}}function UI(t,e){let n=new Array(t);n.fill(-1);for(let i=0;i<e.length;++i)n[e[i]]=i;const s=[];for(let i=0;i<t;++i)n[i]===-1&&s.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:s}}function WI(t,e,n){const s=new Array(t);for(let i=0;i<n.length;++i){const r=n[i].shape;for(let o=0;o<e[i].length;++o)s[e[i][o]]===void 0?s[e[i][o]]=r[o]:R(s[e[i][o]]===r[o],()=>`Expected dimension ${s[e[i][o]]} at axis ${o} of input shaped ${JSON.stringify(r)}, but got dimension ${r[o]}`)}}function VI(t,e){const n=t,s=[];let i=0;t.length===0&&n.push(-1),i=t.length+1;for(let o=0;o<i;++o)s.push([]);const r=[];for(let o=0;o<n.length;++o){const a=n[o],l=EJ(e,a);for(const c of l)r.indexOf(c)===-1&&(s[o].push(c),r.push(c))}return{path:n,steps:s}}function GI(t){return t.every((e,n)=>e===n)}function EJ(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function jI(t,e,n=0){let s=[];if(typeof e=="number")R(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);R(i<=1,()=>"There should be only one negative value in split array.");const r=e.indexOf(-1);if(r!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[r]=t.shape[n]-o}R(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nF(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function sF(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function iF(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rF(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function oF(t,e){return`size ${t} must be non-negative, not ${e}`}function aF(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lF(t,e){const n=re(t),s=re(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function cF(t,e){const n=re(t),s=re(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0(){return"segment ids must be >= 0"}function uF(){return"segment ids are not increasing"}function hF(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function dF(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fF(t,e){let n=!1,s;for(t<=NI?(s=t,n=!0):s=T0(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=T0(t,s+1);return s}function pF(t,e,n){const s=[],i=t.length;for(let r=0;r<i;r++)r!==e?s.push(t[r]):s.push(n);return s}function HI(t,e,n,s){const i=e.shape.length,r=t.shape.length;if(s!==0&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>r)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${r}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const o=t.shape[n],a=[];let l=1,c=1,h=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=s;d<i;d++)a.push(e.shape[d]);for(let d=n+1;d<r;d++)a.push(t.shape[d]),h*=t.shape[d];return{batchSize:l,sliceSize:h,outerSize:c,dimSize:o,outputShape:a}}const NJ=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:HI,computeOutShape:pF,segOpComputeOptimalWindowSize:fF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function co(t){try{return t.map(e=>ta(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function mF(t){return t.map(e=>Xo(e))}const $J=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:PI,ERF_A2:OI,ERF_A3:LI,ERF_A4:FI,ERF_A5:MI,ERF_P:DI,PARALLELIZE_THRESHOLD:NI,get RowPartitionType(){return Fi},SELU_SCALE:ix,SELU_SCALEALPHA:sx,applyActivation:pI,assertAndGetBroadcastShape:ze,assertAxesAreInnerMostDims:On,assertParamsConsistent:EI,assignToTypedArray:JL,axesAreInnerMostDims:jC,calculateShapes:Xl,checkEinsumDimSizes:WI,checkPadOnDimRoundingMode:vs,combineLocations:iL,combineRaggedTensorToTensorShapes:HL,complexWithEvenIndex:YL,complexWithOddIndex:QL,computeConv2DInfo:Pn,computeConv3DInfo:xa,computeDefaultPad:zC,computeDilation2DInfo:np,computeOptimalWindowSize:nx,computeOutAndReduceShapes:In,computeOutShape:Cr,computePool2DInfo:wi,computePool3DInfo:mo,convertConv2DDataFormat:go,decodeEinsumEquation:BI,eitherStridesOrDilationsAreOne:jn,expandShapeToKeepDim:sn,exponent:tF,exponents:eF,fromStringArrayToUint8:mF,fromUint8ToStringArray:co,getAxesPermutation:Bt,getBroadcastDims:uu,getComplexWithIndex:zI,getEinsumComputePath:VI,getEinsumPermutation:UI,getFusedBiasGradient:fI,getFusedDyActivation:dI,getImageCenter:$I,getInnerMostAxes:Zt,getPermuted:lp,getRaggedRank:KL,getReductionAxes:pn,getReshaped:ap,getReshapedPermuted:cp,getRowPartitionTypesHelper:qL,getSliceBeginCoords:RI,getSliceSize:AI,getSparseFillEmptyRowsIndicesDenseShapeMismatch:nF,getSparseFillEmptyRowsNegativeIndexErrorMessage:sF,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:iF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:aF,getSparseReshapeInputOutputMismatchErrorMessage:cF,getSparseReshapeInputOutputMultipleErrorMessage:lF,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:rF,getSparseReshapeNegativeOutputDimErrorMessage:oF,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:dF,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:q0,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:uF,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:hF,getUndoAxesPermutation:_a,isIdentityPermutation:GI,log:H8,mergeRealAndImagArrays:lo,prepareAndValidate:bI,prepareSplitSize:jI,segment_util:NJ,shouldFuse:mI,slice_util:IJ,splitRealAndImagArrays:ZL,stridesOrDilationsArePositive:Il,tupleValuesAreOne:Cl,upcastType:Ds,validateDefaultValueShape:XL,validateInput:JY,validateUpdateShape:CL,warn:Bs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */hJ();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gF={kernelName:Ky,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,op(_e(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ={kernelName:rf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Et(_e(n,"float32")),i=Gn(Ae(rt(1),s));return Kt(Re(t,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AJ={kernelName:of,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Gn(Ae(Et(_e(n,"float32")),1));return Re(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DJ={kernelName:Ru,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{let a=t;const l=pn(n.shape,i);return l.length>0&&(a=$e(a,l)),G(a,n.shape)},b:()=>{let a=t;const l=pn(s.shape,i);return l.length>0&&(a=$e(a,l)),G(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PJ={kernelName:K1,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,i)=>{n[i]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OJ={kernelName:Xy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>et(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LJ={kernelName:Zy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>et(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ={kernelName:af,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Gn(Ae(rt(1),Et(_e(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MJ={kernelName:lf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Gn(pe(rt(1),Et(_e(n,"float32"))));return Re(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zJ={kernelName:hf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=pe(Et(n),Et(s));let l=U(t,Re(s,a));const c=pn(n.shape,i);return c.length>0&&(l=$e(l,c)),G(l,n.shape)},b:()=>{const a=pe(Et(n),Et(s));let l=Kt(U(t,Re(n,a)));const c=pn(s.shape,i);return c.length>0&&(l=$e(l,c)),G(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BJ={kernelName:cf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,pe(Et(_e(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UJ={kernelName:uf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Ae(rt(1),Et(_e(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(t,e,n,s,i,r){const o=F(t,"dy","avgPool3dGrad"),a=F(e,"input","avgPool3dGrad");let l=o,c=a,h=!1;a.rank===4&&(h=!0,l=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),R(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),R(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),vs("avgPool3dGrad",i,r);const d={dy:l,input:c},f={filterSize:n,strides:s,pad:i,dimRoundingMode:r},m=W.runKernel(Q1,d,f);return h?G(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const VJ=j({avgPool3dGrad_:WJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GJ={kernelName:Qy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:i,strides:r,pad:o,dimRoundingMode:a}=n;return{x:()=>VJ(t,s,i,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jJ(t,e,n,s,i){const r=F(t,"dy","avgPoolGrad"),o=F(e,"input","avgPoolGrad");R(o.rank===r.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${r.rank})`);let a=o,l=r,c=!1;o.rank===3&&(c=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=G(r,[1,r.shape[0],r.shape[1],r.shape[2]])),R(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),R(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const h={dy:l,input:a},d={filterSize:n,strides:s,pad:i},f=W.runKernel(Y1,h,d);return c?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const HJ=j({avgPoolGrad_:jJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qJ={kernelName:Yy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:i,strides:r,pad:o}=n;return{x:()=>HJ(t,s,i,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ={kernelName:Jy,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,i]=e,{transposeA:r,transposeB:o}=n;return!r&&!o?{a:()=>lt(t,i,!1,!0),b:()=>lt(s,t,!0,!1)}:!r&&o?{a:()=>lt(t,i,!1,!1),b:()=>lt(t,s,!0,!1)}:r&&!o?{a:()=>lt(i,t,!1,!0),b:()=>lt(s,t,!1,!1)}:{a:()=>lt(i,t,!0,!0),b:()=>lt(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XJ={kernelName:ev,gradFunc:(t,e,n)=>{const{blockShape:s,crops:i}=n;return{x:()=>JC(t,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZJ={kernelName:V8,gradFunc:(t,e,n)=>{const s=n,i=s.inputShape,r=s.shape,o=Array.from(r);for(let l=i.length-1;l>=0;l--)if(i[l]===r[l])o[l]=1;else if(i[l]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${r}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>$e(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YJ={kernelName:df,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ={kernelName:ff,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JJ={kernelName:pf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:i,clipValueMax:r}=n;return{x:()=>ns(oo(Hl(s,i),Du(s,r)),t,et(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eee={kernelName:tv,inputsToSave:["x"],gradFunc:gF.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tee={kernelName:nv,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:i}=n,r=je(i,e[0].shape)[0],o=s.map(l=>l[r]);return js(t,o,r).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nee={kernelName:sv,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,{dilations:r,strides:o,pad:a,dataFormat:l}=n;return R(Cl(r),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`),{x:()=>WC(s.shape,t,i,o,a,l),filter:()=>hI(s,t,i.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const see={kernelName:iv,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,{strides:r,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>kl(t,i,r,o,a,1,l),filter:()=>hI(t,s,i.shape,r,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iee(t,e,n,s,i){let r=t;t.rank===4&&(r=G(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=G(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),R(r.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${r.shape}.`),R(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),R(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),R(r.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${r.shape[4]}) must match input depth in filter (${n[3]}.`),R(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:r,dy:o},l={strides:s,pad:i,filterShape:n};return W.runKernel(sC,a,l)}const ree=j({conv3DBackpropFilter_:iee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oee={kernelName:rv,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:i,pad:r}=n;R(Cl(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>eL(o.shape,t,a,i,r),filter:()=>ree(o,t,a.shape,i,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aee={kernelName:mf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Kt(xL(_e(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lee={kernelName:gf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(_L(_e(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cee={kernelName:ov,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i,exclusive:r,reverse:o}=n;return{x:()=>{const a=Bt([i],s.rank);let l=nL(t,i,r,!o);return a!=null&&(l=Je(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uee={kernelName:av,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:i,pad:r,dimRoundingMode:o}=n,a=s??[1,1];R(Cl(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return R(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),R(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),R(jn(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),vs("depthwiseConv2d",r,o),{x:()=>vQ(l.shape,t,c,i,r,a,o),filter:()=>gQ(l,t,c.shape,i,r,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hee={kernelName:lv,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,r={x:s,filter:i,dy:t},o={x:s,filter:i,dy:t};return{x:()=>W.runKernel(E0,r,n),filter:()=>W.runKernel(N0,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dee={kernelName:vf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>W.runKernel(dC,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fee={kernelName:xf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=U(Nr(Kt(Et(n))),2/Math.sqrt(Math.PI));return{x:()=>U(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pee={kernelName:_f,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mee={kernelName:uv,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>G(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gee={kernelName:wf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Nr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yee={kernelName:bf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vee={kernelName:Cf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=Re(t,_e(s,"float32")),l=pn(n.shape,i);return l.length>0?G($e(a,l),n.shape):a},b:()=>{let a=U(t,_e(n,"float32"));const l=pn(s.shape,i);l.length>0&&(a=G($e(a,l),s.shape));const c=Et(s);return Kt(Re(a,_e(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xee={kernelName:hv,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[i,r,o,a]=e,l=a??rt(1),c=pn(r.shape,i.shape),h=[];if(r.rank===1){for(let I=0;I<i.shape.length-1;++I)h.push(i.shape[I]);h.push(1)}const d=Ae(i,r),f=U(t,l),m=gL(pe(o,rt(s))),g=U(U(U(m,m),m),rt(-.5));return{x:()=>r.rank===1?G(U(U(t,zi(G(m,[1,1,1,r.shape[0]]),h)),l),i.shape):G(U(U(t,m),l),i.shape),mean:()=>{let I=U(U(m,rt(-1)),f);return r.rank===1&&(I=$e(I,c)),G(I,r.shape)},variance:()=>{let I=U(U(g,d),f);return r.rank===1&&(I=$e(I,c)),G(I,r.shape)},scale:()=>{const I=U(d,m);let S=U(t,I);return r.rank===1&&(S=$e(S,c)),G(S,r.shape)},offset:()=>{let I=t;return r.rank===1&&(I=$e(I,c)),G(I,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ee={kernelName:dv,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,i]=e,{axis:r,batchDims:o}=n,a=je(r,s.shape)[0],l=(c,h,d)=>()=>{const f=c.shape,m=h.size,g=f.slice(0,a),v=g.length,_=f.slice(r,f.length).slice(1),x=_.length,w=YN(0,v),C=YN(v+1,v+1+x),I=QN([g,[m],_]),S=G(d,I),T=G(h,[m]),E=QN([[v],w,C]),$=Je(S,E);let D=kL($,T,c.shape[a]);const P=_a(E);return D=Je(D,P),D};if(o===1){const c=s.shape[0],h=s.split(c,0);return{x:()=>ao(h.map((m,g)=>l(m,i.slice(g,1),t.slice(g,1))())).reshape(s.shape),indices:()=>i}}else return{x:l(s,i,t),indices:()=>i}}};function YN(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function QN(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wee={kernelName:If,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>et(n),b:()=>et(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bee={kernelName:kf,gradFunc:t=>({x:()=>_e(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cee={kernelName:Sf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iee={kernelName:Tf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kee={kernelName:Ef,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const See={kernelName:pv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:i}=n,r=Zs(s,0);return{x:()=>ns(r,t,U(t,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee={kernelName:$f,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,pe(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eee={kernelName:Nf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,_e(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nee={kernelName:j8,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n;return{logits:()=>{const o=Nr(s);return Ae(t,U($e(t,i,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ee(t,e,n,s=5,i=1,r=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:i,alpha:r,beta:o};return W.runKernel(vC,a,l)}const Ree=j({localResponseNormalizationBackprop_:$ee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aee={kernelName:_v,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{depthRadius:r,bias:o,alpha:a,beta:l}=n;return{x:()=>Ree(s,i,t,r,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yF(t,e,n,s){return e.rank<n.rank&&(e=G(e,sn(e.shape,s))),t.rank<n.rank&&(t=G(t,sn(t.shape,s))),{x:()=>U(t,_e(Er(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN={kernelName:wv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:i}=s,r=e[0],o=e[1],a=je(i,r.shape),l=yF(t,o,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dee={kernelName:Rf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>U(t,_e(Hl(n,s),"float32")),b:()=>U(t,_e(zg(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pee(t,e,n,s,i,r,o){const a=F(t,"dy","maxPool3dGrad"),l=F(e,"input","maxPool3dGrad"),c=F(n,"output","maxPool3dGrad");let h=a,d=l,f=c,m=!1;l.rank===4&&(m=!0,h=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=G(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=G(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),R(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),R(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),R(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),vs("maxPool3dGrad",r,o);const g={dy:h,input:d,output:f},v={filterSize:s,strides:i,pad:r,dimRoundingMode:o},_=W.runKernel(_C,g,v);return m?G(_,[_.shape[1],_.shape[2],_.shape[3],_.shape[4]]):_}const Oee=j({maxPool3dGrad_:Pee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lee={kernelName:Cv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>Oee(t,s,i,r,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fee(t,e,n,s,i,r,o){const a=F(t,"dy","maxPoolGrad"),l=F(e,"input","maxPoolGrad"),c=F(n,"output","maxPoolGrad");R(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),R(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),R(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),vs("maxPoolGrad",r,o);const h={dy:a,input:l,output:c},d={filterSize:s,strides:i,pad:r,dimRoundingMode:o};return W.runKernel(xC,h,d)}const Mee=j({maxPoolGrad_:Fee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zee={kernelName:bv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{filterSize:r,strides:o,pad:a}=n;return{x:()=>Mee(t,s,i,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bee={kernelName:Iv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n,r=je(i,s.shape),a=In(s.shape,r)[1],l=re(a);return{x:()=>{const h=s.shape.slice();r.forEach(m=>{h[m]=1});const d=G(t,h);return Re(U(d,ba(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uee={kernelName:kv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:i}=s,[r,o]=e,a=je(i,r.shape),l=yF(t,o,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wee={kernelName:Af,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>U(t,_e(Du(n,s),"float32")),b:()=>U(t,_e(Zs(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vee={kernelName:Sv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:i}=n,r=i.map(o=>o[0]);return{x:()=>Ct(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gee={kernelName:Df,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=pn(n.shape,i);return a.length>0?G($e(t,a),n.shape):t},b:()=>{const a=U(t,Kt(ex(Re(n,s)))),l=pn(s.shape,i);return l.length>0?G($e(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jee={kernelName:Pf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=U(t,_e(s,"float32")),l=pn(n.shape,i);return l.length>0?G($e(a,l),n.shape):a},b:()=>{const a=U(t,_e(n,"float32")),l=pn(s.shape,i);return l.length>0?G($e(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hee={kernelName:Tv,gradFunc:t=>({x:()=>Kt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qee={kernelName:$v,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>_n(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kee={kernelName:Nv,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xee={kernelName:Rv,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return El(t,s).map(r=>()=>r)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e2={kernelName:Av,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:i}=n,r=i.map(o=>o[0]);return{x:()=>Ct(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee={kernelName:Of,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,i]=e,r=n,o=s,a=ze(r.shape,o.shape);return{a:()=>{const h=_e(o,"float32");let d=U(t,U(h,Sl(r,Ae(h,rt(1)))));const f=pn(r.shape,a);return f.length>0&&(d=$e(d,f)),G(d,r.shape)},b:()=>{const h=Zs(r,0),d=ns(h,$r(r),et(r));let f=U(t,U(i,d));const m=pn(o.shape,a);return m.length>0&&(f=$e(f,m)),G(f,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yee={kernelName:Dv,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,i=Zs(n,0);return{x:()=>ns(i,t,U(t,s)),alpha:()=>{let r=ns(i,et(t),U(t,n));const o=pn(s.shape,t.shape);return o.length>0&&(r=$e(r,o)),G(r,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qee(t,e,n){const s=t.shape.slice();s[n]=1;const i=G(e,s),r=G0(t,n,!0,!1),o=G0(t,n,!0,!0),a=U(r,o);return U(i,a)}function Jee(t,e,n){const s=t.shape.length,i=s-n.length,r=Bt(n,s);let o=t;r!=null&&(o=Je(t,r));const a=o.shape.slice(),c=a.splice(s-n.length,n.length).reduce((f,m)=>f*m,1);a.push(c);const h=o.reshape(a);let d=Qee(h,e,i);if(d=d.reshape(o.shape),r!=null){const f=_a(r);d=Je(d,f)}return d}const ete={kernelName:Pv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n;let r=[];return i==null?r=s.shape.map((o,a)=>a):typeof i=="number"?r=[i]:r=i,{x:()=>Jee(s,t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tte={kernelName:yf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=Re(t,_e(s,"float32")),l=pn(n.shape,i);return l.length>0?G($e(a,l),n.shape):a},b:()=>{let a=U(t,_e(n,"float32"));const l=pn(s.shape,i);l.length>0&&(a=G($e(a,l),s.shape));const c=Et(s);return Kt(Re(a,_e(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nte={kernelName:Lf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Kt(Et(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ste={kernelName:Mf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=U(Du(n,6),op(n));return{x:()=>U(t,_e(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ite={kernelName:Ff,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,_e(op(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rte={kernelName:Ov,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ote={kernelName:Fv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,i={dy:t,images:s};return{images:()=>W.runKernel(TC,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ate={kernelName:Lv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,i={dy:t,images:s};return{images:()=>W.runKernel(SC,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lte={kernelName:Mv,gradFunc:(t,e,n)=>{const{dims:s}=n,i=je(s,t.shape);return{x:()=>Tl(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cte={kernelName:zf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute={kernelName:Bf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Kt(Re(t,U(Sl(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hte={kernelName:zv,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>_e(et(n),"float32"),t:()=>U(t,_e(n,t.dtype)),e:()=>U(t,_e(XC(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dte={kernelName:Uf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Zs(n,rt(0)),i=rt(sx),r=rt(ix),o=U(t,r),a=U(U(t,i),Nr(_e(n,"float32")));return ns(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fte={kernelName:jf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(n,Ae(rt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pte={kernelName:Gf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte={kernelName:Wf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(VC(_e(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gte={kernelName:Vf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(tL(_e(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yte={kernelName:Bv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:i,size:r}=n,o=s.shape,[a,l]=tx(s,i,r),c=[];for(let h=0;h<t.rank;h++)c.push([a[h],o[h]-a[h]-l[h]]);return{x:()=>QC(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vte={kernelName:Gv,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:i}=n,r=!0,o=U(t,s);return{logits:()=>Ae(o,U($e(o,[i],r),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte={kernelName:Hf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Au(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t2={kernelName:Wv,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:i}=n;return{x:()=>UC(t,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n2={kernelName:Vv,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>ds(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _te={kernelName:qf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,U(Gn(_e(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wte={kernelName:EC,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(_e(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bte={kernelName:Kf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=rt(2);return{a:()=>U(t,U(i,Ae(n,s))),b:()=>U(t,U(i,Ae(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte={kernelName:Jf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite={kernelName:Xf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{let a=t;const l=pn(n.shape,i);return l.length>0&&(a=$e(a,l)),G(a,n.shape)},b:()=>{let a=t;const l=pn(s.shape,i);return l.length>0&&(a=$e(a,l)),G(Kt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kte={kernelName:Uv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,i=s.shape.slice(),{axis:r}=n;je(r,s.shape).forEach(c=>{i[c]=1});const a=G(t,i),l=U(a,ba(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ste={kernelName:Zf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Et(VC(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tte={kernelName:Yf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Ae(rt(1),Et(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete={kernelName:Qf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:i}=n;return{x:()=>{let o=et(s);if(s.rank===1)for(let a=0;a<i[0];++a)o=pe(o,Ct(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)o=pe(o,Ct(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)o=pe(o,Ct(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)for(let h=0;h<i[3];++h)o=pe(o,Ct(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte={kernelName:Hc,gradFunc:(t,e,n)=>{const s=n,{perm:i}=s,r=_a(i);return{x:()=>Je(t,r)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te={kernelName:jv,gradFunc:(t,e,n)=>{const s=n,{axis:i}=s;return{value:()=>ao(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte={kernelName:Hv,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ate(t,n)}}};function Ate(t,e){const n=wa(e,et(e)),s=HC(t,n);let i=Hl(e,rt(0,"int32"));const r=s.rank-i.rank;for(let a=0;a<r;++a)i=cs(i,a+1);i=oo(i,ba(s.shape,"bool"));const o=et(s);return ns(i,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dte={kernelName:qv,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte=[gF,RJ,AJ,DJ,PJ,OJ,LJ,FJ,MJ,zJ,BJ,UJ,GJ,qJ,KJ,XJ,ZJ,YJ,QJ,JJ,eee,tee,see,nee,oee,aee,lee,cee,uee,hee,tte,dee,fee,pee,mee,gee,vee,yee,xee,_ee,wee,bee,Cee,Iee,kee,See,Tee,Eee,Nee,Aee,JN,JN,Dee,Lee,zee,Bee,Uee,Wee,Vee,Gee,jee,Hee,qee,Kee,Xee,e2,e2,Zee,Yee,ete,nte,ste,ite,rte,ote,ate,lte,cte,ute,hte,dte,fte,pte,mte,gte,yte,vte,xte,t2,t2,n2,n2,_te,bte,wte,Cte,Ite,kte,Ste,Tte,Ete,Nte,$te,Rte,Dte];for(const t of Pte)q8(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.abs=function(){return this.throwIfDisposed(),Yn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.acos=function(){return this.throwIfDisposed(),aZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.acosh=function(){return this.throwIfDisposed(),cZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.add=function(t){return this.throwIfDisposed(),pe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.all=function(t,e){return this.throwIfDisposed(),YO(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.any=function(t,e){return this.throwIfDisposed(),W0(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.argMax=function(t){return this.throwIfDisposed(),Ed(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.argMin=function(t){return this.throwIfDisposed(),pZ(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.asScalar=function(){return this.throwIfDisposed(),R(this.size===1,()=>"The array must have only 1 element."),G(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.asType=function(t){return this.throwIfDisposed(),_e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.as1D=function(){return this.throwIfDisposed(),G(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.as2D=function(t,e){return this.throwIfDisposed(),G(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),G(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),G(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.as5D=function(t,e,n,s,i){return this.throwIfDisposed(),G(this,[t,e,n,s,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.asin=function(){return this.throwIfDisposed(),gZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.asinh=function(){return this.throwIfDisposed(),vZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.atan=function(){return this.throwIfDisposed(),_Z(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.atan2=function(t){return this.throwIfDisposed(),bZ(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.atanh=function(){return this.throwIfDisposed(),IZ(this)};se().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),BC(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),UC(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.batchNorm=function(t,e,n,s,i){return this.throwIfDisposed(),Zv(this,t,e,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Zh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.cast=function(t){return this.throwIfDisposed(),_e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.ceil=function(){return this.throwIfDisposed(),YZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof an&&(t=[t]),ds([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.conv1d=function(t,e,n,s,i,r){return this.throwIfDisposed(),QO(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.conv2dTranspose=function(t,e,n,s,i){return this.throwIfDisposed(),JO(this,t,e,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.conv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),kl(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.cos=function(){return this.throwIfDisposed(),VC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.cosh=function(){return this.throwIfDisposed(),tL(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),G0(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),nL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),b7(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.depthwiseConv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),GC(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.dilation2d=function(t,e,n,s,i){return this.throwIfDisposed(),k7(this,t,e,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.divNoNan=function(t){return this.throwIfDisposed(),$7(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.div=function(t){return this.throwIfDisposed(),Re(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.dot=function(t){return this.throwIfDisposed(),A7(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.elu=function(){return this.throwIfDisposed(),Qv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.equal=function(t){return this.throwIfDisposed(),Er(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.erf=function(){return this.throwIfDisposed(),sL(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),G7(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.exp=function(){return this.throwIfDisposed(),Nr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.expandDims=function(t){return this.throwIfDisposed(),cs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.expm1=function(){return this.throwIfDisposed(),K7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.fft=function(){return this.throwIfDisposed(),bL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.flatten=function(){return this.throwIfDisposed(),G(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.floor=function(){return this.throwIfDisposed(),ex(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.floorDiv=function(t){return this.throwIfDisposed(),ZO(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.gather=function(t,e,n){return this.throwIfDisposed(),HC(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Hl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.greater=function(t){return this.throwIfDisposed(),Zs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.ifft=function(){return this.throwIfDisposed(),j0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.irfft=function(){return this.throwIfDisposed(),zY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.isFinite=function(){return this.throwIfDisposed(),s9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.isInf=function(){return this.throwIfDisposed(),r9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.isNaN=function(){return this.throwIfDisposed(),a9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.leakyRelu=function(t){return this.throwIfDisposed(),KC(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.lessEqual=function(t){return this.throwIfDisposed(),Du(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.less=function(t){return this.throwIfDisposed(),zg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),d9(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logSigmoid=function(){return this.throwIfDisposed(),x9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logSoftmax=function(t){return this.throwIfDisposed(),lL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),cL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.log=function(){return this.throwIfDisposed(),$r(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.log1p=function(){return this.throwIfDisposed(),aL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logicalAnd=function(t){return this.throwIfDisposed(),oo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logicalNot=function(){return this.throwIfDisposed(),XC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logicalOr=function(t){return this.throwIfDisposed(),uL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.logicalXor=function(t){return this.throwIfDisposed(),T9(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),lt(this,t,e,n)};se().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),ZC(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.max=function(t,e){return this.throwIfDisposed(),ji(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.maximum=function(t){return this.throwIfDisposed(),wa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.mean=function(t,e){return this.throwIfDisposed(),nn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.min=function(t,e){return this.throwIfDisposed(),Mg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.minimum=function(t){return this.throwIfDisposed(),Rd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),O9(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.mod=function(t){return this.throwIfDisposed(),F9(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.mul=function(t){return this.throwIfDisposed(),U(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.neg=function(){return this.throwIfDisposed(),Kt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Jv(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.notEqual=function(t){return this.throwIfDisposed(),Bg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),hL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.onesLike=function(){return this.throwIfDisposed(),_i(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.pad=function(t,e){return this.throwIfDisposed(),QC(this,t,e)};se().prototype.pool=function(t,e,n,s,i,r){return this.throwIfDisposed(),q9(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.pow=function(t){return this.throwIfDisposed(),Sl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.prelu=function(t){return this.throwIfDisposed(),eI(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.prod=function(t,e){return this.throwIfDisposed(),Z9(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.reciprocal=function(){return this.throwIfDisposed(),xY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.relu=function(){return this.throwIfDisposed(),Kl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.relu6=function(){return this.throwIfDisposed(),pL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.reshapeAs=function(t){return this.throwIfDisposed(),G(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.reshape=function(t){return this.throwIfDisposed(),G(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),TL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),EL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.reverse=function(t){return this.throwIfDisposed(),Tl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.rfft=function(){return this.throwIfDisposed(),WY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.round=function(){return this.throwIfDisposed(),mL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.rsqrt=function(){return this.throwIfDisposed(),gL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.selu=function(){return this.throwIfDisposed(),yL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.separableConv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),vL(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sigmoid=function(){return this.throwIfDisposed(),Au(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sign=function(){return this.throwIfDisposed(),EY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sin=function(){return this.throwIfDisposed(),xL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sinh=function(){return this.throwIfDisposed(),_L(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.slice=function(t,e){return this.throwIfDisposed(),Ct(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.softmax=function(t){return this.throwIfDisposed(),uI(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.softplus=function(){return this.throwIfDisposed(),sp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),JC(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.split=function(t,e){return this.throwIfDisposed(),js(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sqrt=function(){return this.throwIfDisposed(),Gn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.square=function(){return this.throwIfDisposed(),Et(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.squaredDifference=function(t){return this.throwIfDisposed(),GY(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.squeeze=function(t){return this.throwIfDisposed(),rp(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof an?[this,t]:[this,...t];return ao(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.step=function(t){return this.throwIfDisposed(),op(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.stridedSlice=function(t,e,n,s,i,r,o,a){return this.throwIfDisposed(),XY(this,t,e,n,s,i,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sub=function(t){return this.throwIfDisposed(),Ae(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.sum=function(t,e){return this.throwIfDisposed(),$e(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.tan=function(){return this.throwIfDisposed(),YY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.tanh=function(){return this.throwIfDisposed(),Xv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.tile=function(t){return this.throwIfDisposed(),zi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.toBool=function(){return this.throwIfDisposed(),_e(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.toFloat=function(){return this.throwIfDisposed(),_e(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.toInt=function(){return this.throwIfDisposed(),_e(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.topk=function(t,e){return this.throwIfDisposed(),tQ(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.transpose=function(t){return this.throwIfDisposed(),Je(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.unique=function(t){return this.throwIfDisposed(),iQ(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),kL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.unstack=function(t){return this.throwIfDisposed(),El(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.where=function(t,e){return this.throwIfDisposed(),ns(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */se().prototype.zerosLike=function(){return this.throwIfDisposed(),et(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,hr.prototype)}}class fi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,fi.prototype)}}class B extends Error{constructor(e){super(e),Object.setPrototypeOf(this,B.prototype)}}class Ue extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ue.prototype)}}class qI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qI.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vF{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nl(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function dr(t,e){if(!t)throw new qI(e)}function s2(t,e){let n=0;for(const s of t)s===e&&n++;return n}function us(t){return t.length===1?t[0]:t}function pt(t){return Array.isArray(t)?t:[t]}function Wr(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Ha(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let si={};function KI(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function K0(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>K0(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:K0(s))}}}function up(t,e={},n={},s="object",i=!1){if(typeof t=="string"){const r=t;let o;if(r in n)o=n[r];else if(r in si)o=si[r];else if(o=e[r],o==null)throw new B(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const r=t;if(r.className==null||r.config==null)throw new B(`${s}: Improper config format: ${JSON.stringify(r)}.
'className' and 'config' must set.`);const o=r.className;let a,l;if(o in n?[a,l]=n[o]:o in si?[a,l]=si.className:o in e&&([a,l]=e[o]),a==null)throw new B(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const m of Object.keys(si))c[m]=si[m];for(const m of Object.keys(n))c[m]=n[m];const h=r.config;h.customObjects=c;const d=Object.assign({},si);for(const m of Object.keys(n))si[m]=n[m];K0(r.config);const f=l(a,r.config,n,i);return si=Object.assign({},d),f}else{const c=Object.assign({},si);for(const d of Object.keys(n))si[d]=n[d];const h=new a(r.config);return si=Object.assign({},c),h}}}function Ote(t,e){return t<e?-1:t>e?1:0}function pm(t,e){return-1*Ote(t,e)}function Zo(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function Lte(t){if(t==null)throw new B(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Zl(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new B(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function XI(t,e,n=0,s=1/0){return dr(n>=0),dr(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(i=>typeof i===e)}function Cn(t,e){Array.isArray(t)?(R(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Cn(n,`element ${s+1} of ${e}`))):R(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${xF(t)}.`)}function xF(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>xF(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function Fte(t,e,n){let s=n!=null?n():ls(),i;return(...o)=>{const a=n!=null?n():ls();return a-s<e||(s=a,i=t(...o)),i}}function _F(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Mte=0;function wF(){return Mte++}const mm={};function rx(t=""){return t in mm||(mm[t]=0),mm[t]+=1,t+mm[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zte=["channelsFirst","channelsLast"],Bte=["nearest","bilinear"],Ute=["valid","same","causal"],Wte=["max","avg"],Vte=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mc=new Map;function Yt(t){Zl(zte,"DataFormat",t)}function Gte(t){Zl(Bte,"InterpolationFormat",t)}function Ys(t){Zl(Ute,"PaddingMode",t)}function bF(t){Zl(Wte,"PoolMode",t)}const Yh=[],i2="/";function ol(t,e){Yh.push(t);try{const n=e();return Yh.pop(),n}catch(n){throw Yh.pop(),n}}function jte(){return Yh.length===0?"":Yh.join(i2)+i2}function CF(t){if(!kF(t))throw new Error("Not a valid tensor name: '"+t+"'");return jte()+t}function IF(t){if(!kF(t))throw new Error("Not a valid tensor name: '"+t+"'");mc.has(t)||mc.set(t,0);const e=mc.get(t);if(mc.set(t,mc.get(t)+1),e>0){const n=`${t}_${e}`;return mc.set(n,1),n}else return t}const Hte=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function kF(t){return!!t.match(Hte)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qte(t){return t===parseInt(t.toString(),10)}function Yo(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let i=e;i<n;++i)s*=t[i];return s}function du(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function na(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Yi(t,e){if(e<t)throw new B(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Z_;function cn(){return Z_==null&&(Z_=_X().epsilon()),Z_}function Qi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ir(t,e){return _e(t,e)}function hp(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),G(t,n)}function Kte(t,e){return X(()=>{if(t.shape.length!==2)throw new B(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=hp(t,1);return X0(n,[1,e,1])})}function Xte(t){const e=[Yo(t.shape)];return G(t,e)}function Zte(t){if(t.rank<=1)throw new B(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Yo(t.shape,1)];return G(t,e)}function al(t,e,n){return X(()=>{switch(t.rank){case 1:return lI(t,e,n);case 2:return wL(t,[e,0],[n,t.shape[1]]);case 3:return cI(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Wg(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Ct(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Ct(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new B(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Y_(t,e,n){return X(()=>{switch(t.rank){case 1:return lI(t,e,n);case 2:return wL(t,[0,e],[t.shape[0],n]);case 3:return cI(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Wg(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new B(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function gm(t,e,n,s){return X(()=>{switch(t.rank){case 1:return lI(t,e,n);case 2:switch(s){case 1:return al(t,e,n);case 2:return Y_(t,e,n);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return al(t,e,n);case 2:return cI(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Y_(t,e,n);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return al(t,e,n);case 2:return Wg(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Wg(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Y_(t,e,n);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}default:throw new B(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function ZI(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),ds(t,e)}function r2(t,e){switch(t.rank){case 1:return e7([t,e]);case 2:return n7([t,e],0);case 3:return i7([t,e],0);case 4:return o7([t,e],0);default:throw new B(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function X0(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new B(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return zi(t,e)}function ox(t,e=0,n=1,s,i){return mY(t,e,n,s,i)}function kr(t,e,n,s){if(t.rank<2||e.rank<2)throw new Ue(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const i=t.shape.slice(-1)[0],r=e.shape.slice(-2)[0];if(i!==r)throw new Ue(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return VN({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?Z0(t.rank,s,Qi()):null,activation:n});{const i=t.shape.slice(),r=i.pop();t=G(t,[-1,r]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],h=Array.from({length:e.rank},(g,v)=>v===0?e.rank-2:v<=e.rank-2?v-1:v);e=G(Je(e,h),[l,-1]);const d=[...i,...c];return G(VN({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?Z0(t.rank,s,Qi()):null,activation:n}),d)}}function SF(t,e,n){return X(()=>(Array.isArray(e)?e=ks(e,"int32"):e=_e(e,"int32"),HC(t,e,n)))}function dp(t){return U(t,t)}function Z0(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new B(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?G(e,[1,s[0],1,1,1]):G(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?G(e,[1,1,1,1,s[0]]):G(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?G(e,[1,s[0],1,1]):G(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?G(e,[1,1,1,s[0]]):G(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?G(e,[1,s[0],1]):G(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?G(e,[1,1,s[0]]):G(e,[1].concat(s))}else if(t<3)return e;throw new B(`Unsupported input rank by biasAdd: ${e.rank}`)}function tr(t,e,n){return X(()=>(n==null&&(n=Qi()),Yt(n),pe(t,Z0(t.rank,e,n))))}function Yte(t,e=1){if(e!==1)throw new Ue(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Qv(t)}function Qte(t){return X(()=>Re(t,pe(Yn(t),1)))}function TF(t,e,n,s){return X(()=>hQ(t,e,n,s))}function Jte(t){return X(()=>{const e=pe(.5,U(.2,t));return qs(e,0,1)})}function fp(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ene=["fanIn","fanOut","fanAvg"],tne=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nne(t){Zl(ene,"FanMode",t)}function sne(t){Zl(tne,"Distribution",t)}class bi extends Ou{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class EF extends bi{apply(e,n){return _n(e,n)}}EF.className="Zeros";de(EF);class YI extends bi{apply(e,n){return ba(e,n)}}YI.className="Ones";de(YI);class NF extends bi{constructor(e){if(super(),typeof e!="object")throw new B(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new B(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return X(()=>U(rt(this.value),ba(e,n)))}getConfig(){return{value:this.value}}}NF.className="Constant";de(NF);class $F extends bi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return ip(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}$F.className="RandomUniform";de($F);class RF extends bi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ue(`randomNormal does not support dType ${n}.`);return ox(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}RF.className="RandomNormal";de(RF);class AF extends bi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ue(`truncatedNormal does not support dType ${n}.`);return IL(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}AF.className="TruncatedNormal";de(AF);class DF extends bi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return X(()=>{if(e.length!==2||e[0]!==e[1])throw new B("Identity matrix initializer can only be used for 2D square matrices.");return U(this.gain,oL(e[0]))})}getConfig(){return{gain:this.gain}}}DF.className="Identity";de(DF);function ine(t,e="channelsLast"){let n,s;if(Yt(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const i=Yo(t,2);n=t[1]*i,s=t[0]*i}else if(e==="channelsLast"){const i=Yo(t,0,t.length-2);n=t[t.length-2]*i,s=t[t.length-1]*i}}else{const i=Yo(t);n=Math.sqrt(i),s=Math.sqrt(i)}return[n,s]}class Ps extends bi{constructor(e){if(super(),e.scale<0)throw new B(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,nne(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,sne(this.distribution),this.seed=e.seed}apply(e,n){const s=ine(e),i=s[0],r=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,r):o/=Math.max(1,(i+r)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ue(`${this.getClassName()} does not support dType ${n}.`);return IL(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return ip(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ps.className="VarianceScaling";de(Ps);class QI extends Ps{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}QI.className="GlorotUniform";de(QI);class JI extends Ps{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}JI.className="GlorotNormal";de(JI);class ek extends Ps{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}ek.className="HeNormal";de(ek);class tk extends Ps{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}tk.className="HeUniform";de(tk);class nk extends Ps{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}nk.className="LeCunNormal";de(nk);class sk extends Ps{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}sk.className="LeCunUniform";de(sk);class PF extends bi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return X(()=>{if(e.length<2)throw new Ue("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=re(e.slice(0,-1)),i=e[e.length-1],r=s*i;r>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${r}) elements: Slowness may result.`);const o=[Math.max(i,s),Math.min(i,s)],a=ox(o,0,1,n,this.seed),l=aJ.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(i,s)*Math.min(i,s)],[Math.min(i,s)+1]);return c=U(c,d.sign()),s<i&&(c=c.transpose()),U(rt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}PF.className="Orthogonal";de(PF);const o2={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function a2(t,e={}){return up(t,li.getMap().classNameMap,e,"initializer")}function Mt(t){return KI(t)}function Ot(t){if(typeof t=="string"){const e=t in o2?o2[t]:t;if(e==="GlorotNormal")return new JI;if(e==="GlorotUniform")return new QI;if(e==="HeNormal")return new ek;if(e==="HeUniform")return new tk;if(e==="LeCunNormal")return new nk;if(e==="LeCunUniform")return new sk;{const n={};return n.className=e,n.config={},a2(n)}}else return t instanceof bi?t:a2(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Y0(t){return Array.isArray(t)&&Array.isArray(t[0])}function Vg(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function De(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new B(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function st(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new B(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gg(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,i)=>s*i);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const l2="Variable";class rne{constructor(e,n="float32",s=l2,i=!0,r=null){this.dtype=n??"float32",this.shape=e.shape,this.id=wF(),s=s??l2,this.originalName=CF(s),this.name=IF(this.originalName),this.trainable_=i,this.constraint=r,this.val=aQ(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),one(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function one(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function Q0(t){return t.map(e=>e.read())}function ik(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class un{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Rr{constructor(e,n,s,i,r,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=wF(),o!=null&&(this.originalName=CF(o),this.name=IF(this.originalName)),this.rank=n.length}}let ane=0;class ax{constructor(e,n){this.callArgs=n,this.id=ane++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let lne=0;class He extends Ou{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=lne++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Wr(s)+"_"+rx(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),s=[r].concat(e.inputShape)}this.batchInputShape=s;let i=e.dtype;i==null&&(i=e.inputDType),i==null&&(i="float32"),this.dtype=i}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new fi(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new B(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return us(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return us(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new hr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new hr(`Layer ${this.name} is not connected, no input to return.`);return us(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new hr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new hr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return us(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=pt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=pt(this.inputSpec);if(n.length!==s.length)throw new B(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let i=0;i<n.length;i++){const r=n[i],o=s[i];if(o==null)continue;const a=r.rank;if(o.ndim!=null&&a!==o.ndim)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&r.dtype!==o.dtype)throw new B(`Input ${i} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${r.dtype}.`);if(o.axes){const l=r.shape;for(const c in o.axes){const h=Number(c),d=o.axes[c],f=h>=0?l[h]:l[l.length+h];if(d!=null&&[d,null].indexOf(f)===-1)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${d} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const c=o.shape[l],h=r.shape[l];if(c!=null&&h!=null&&c!==h)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${r.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=pt(e),i=hne(e),r=dne(e);if(i===r)throw new B("Arguments to apply() must be all SymbolicTensors or all Tensors");return ol(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of pt(e))o.push(a.shape);this.build(us(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=pt(o),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=us(l),this.activityRegularizer!=null)throw new Ue("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=cne(e),a=this.computeOutputShape(o);let l;const c=une(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((h,d)=>new Rr(c,h,this,pt(e),n,this.name,d)):l=new Rr(c,a,this,pt(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new Ue("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,i)=>{s!=null&&e[i]!=null&&e[i]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new hr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new hr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new fi(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Gg(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Q0(e?this.trainableWeights:this.weights)}setWeights(e){X(()=>{const n=this.weights;if(n.length!==e.length)throw new B(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],i=Q0(n);for(let r=0;r<i.length;++r){const o=i[r],a=n[r],l=e[r];if(!ct(o.shape,l.shape))throw new B(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}ik(s)})}addWeight(e,n,s,i,r,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new B(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(i=l!=null?l():Ot("zeros"));const c=i.apply(n,s),h=new rne(c,s,e,o,a);return c.dispose(),r!=null&&this.addLoss(()=>r.apply(h.read())),o==null&&(o=!0),o?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=pt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const i=this.computeMask(e,s),r=pt(n),o=pt(i);if(r.length!==o.length)throw new Error(`${this.name} outputs ${r.length} tensors but ${r.length} masks for those tensors`);for(let a=0;a<r.length;a++)r[a].kerasMask=o[a]}addInboundNode(e,n,s,i,r,o,a=null){const l=pt(e);n=pt(n),s=pt(s),i=pt(i),r=Vg(r),o=Vg(o);const c=[],h=[],d=[];for(const f of l)c.push(f.sourceLayer),h.push(f.nodeIndex),d.push(f.tensorIndex);new ax({outboundLayer:this,inboundLayers:c,nodeIndices:h,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:i,inputShapes:r,outputShapes:o},a);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function cne(t){t=pt(t);const e=[];for(const n of t)e.push(n.shape);return us(e)}function une(t){return"float32"}function OF(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const i=[];for(let r=0;r<s.inboundLayers.length;r++){const o=s.inputTensors[r],a=s.inboundLayers[r],l=s.nodeIndices[r],c=OF(o,a,l);for(const h of c)i.indexOf(h)===-1&&i.push(h)}return i}}}function hne(t){let e=!0;for(const n of pt(t))if(!(n instanceof Rr)){e=!1;break}return e}function dne(t){let e=!0;for(const n of pt(t))if(n instanceof Rr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pp extends He{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:rx("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new B("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new B("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new B("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const i=new Rr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new ax({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new B(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}pp.className="InputLayer";de(pp);function fne(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new B("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new pp({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pne(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return _e(e,t.dtype)}catch{throw new B(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class Oo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Oo)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=pne(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new B(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Rr){if(this.id2Value[e.id]==null)throw new B(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new B(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Rr){if(this.id2Value[e.id]==null)throw new B(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new B(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&We(this.id2Mask)}}const jg=new vF,Hg=new vF;function mne(t){jg!=null&&jg.setMaxEntries(t),Hg!=null&&Hg.setMaxEntries(t)}function Ph(t,e,n,s){const i=n==null?!1:n.training,r=Array.isArray(t),o=r?t:[t],a=o.map(g=>g.name),l=[],c=e.names();for(const g of a)c.indexOf(g)!==-1?l.push(e.getValue(g)):l.push(null);const h=a.join(",")+"|"+e.names().sort().join(",");let d=jg.get(h),f;if(d==null){const g=gne(o,e);d=g.sorted,f=g.recipientCounts,jg.put(h,d),Hg.put(h,f)}f={},i||Object.assign(f,Hg.get(h));const m=new Oo(e);for(let g=0;g<d.length;++g){const v=d[g],_=v.sourceLayer;if(_ instanceof pp)continue;const x=[],w=[],C=[];let I=!1;for(const D of v.inputs){const P=m.getValue(D),z=m.getMask(D);x.push(P),w.push(z),z!=null&&(I=!0),i||(f[D.name]--,f[D.name]===0&&!e.hasKey(D)&&a.indexOf(D.name)===-1&&!P.isDisposed&&D.sourceLayer.stateful!==!0&&C.push(P))}I&&(n=n||{},n.mask=w[0]);const S=pt(_.apply(x,n));let T=null;_.supportsMasking&&(T=_.computeMask(x,w));const E=vne(v),$=Array.isArray(E)?E:[E];for(let D=0;D<$.length;++D){m.hasKey($[D])||m.add($[D],S[D],Array.isArray(T)?T[0]:T);const P=a.indexOf($[D].name);P!==-1&&(l[P]=S[D])}i||We(C)}return m.disposeMasks(),r?l:l[0]}function gne(t,e){R(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const i=c2(t[0],e);n=i.sorted,s=i.recipientMap}else{const i=new Set;for(const r of t){const{sorted:o,recipientMap:a}=c2(r,e);for(const l of o)i.has(l.name)||(n.push(l),i.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:n,recipientCounts:yne(s)}}function yne(t){const e={};for(const n in t)e[n]=t[n].size;return e}function c2(t,e){const n=new Set,s=[],i={};for(const a of e.names())n.add(a);const r=[],o=[];for(r.push(t);r.length>0;){const a=r[r.length-1];if(n.has(a.name)){r.pop();continue}const l=o[o.length-1]===r.length-1;if(a.inputs.length===0||l)r.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(r.length-1);for(const c of a.inputs)i[c.name]==null&&(i[c.name]=new Set),i[c.name].add(a.name),!n.has(c.name)&&r.push(c)}}return{sorted:s,recipientMap:i}}function vne(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const i of t.sourceLayer.inboundNodes[s].outputTensors)if(i.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xne=ee();xne.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,mne);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rk(t,e){return X(()=>Gn($e(U(t,t),e,!0)))}class mp extends Ou{getConfig(){return{}}}class LF extends mp{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return X(()=>{const n=rk(e,this.axis),s=qs(n,0,this.maxValue);return U(e,Re(s,pe(cn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}LF.className="MaxNorm";de(LF);class FF extends mp{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return X(()=>Re(e,pe(cn(),rk(e,this.axis))))}getConfig(){return{axis:this.axis}}}FF.className="UnitNorm";de(FF);class MF extends mp{apply(e){return Kl(e)}}MF.className="NonNeg";de(MF);class zF extends mp{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return X(()=>{const n=rk(e,this.axis),s=pe(U(this.rate,qs(n,this.minValue,this.maxValue)),U(1-this.rate,n));return U(e,Re(s,pe(cn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}zF.className="MinMaxNorm";de(zF);const u2={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function dn(t){return KI(t)}function h2(t,e={}){return up(t,li.getMap().classNameMap,e,"constraint")}function fn(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in u2?u2[t]:t,config:{}};return h2(n)}else return t instanceof mp?t:h2(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function La(t){if(t==null)return;const e=[],n=[],s=[];for(const i in t){const r=t[i];if(typeof r!="number"){const o=r;e.push(o.data()),n.push(i),s.push(o)}}if(e.length>0){const i=await Promise.all(e);for(let r=0;r<i.length;++r)t[n[r]]=i[r][0];We(s)}}function BF(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var d2;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(d2||(d2={}));const _ne=125;class Dd{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class wne{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class bne extends Dd{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const i in n){const r=n[i];if(typeof r=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+r*s;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=X(()=>pe(this.totals[i],U(r,s)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:X(()=>{const i=U(Re(1,this.seen),this.totals[s]);n[s]=i,this.totals[s].dispose(),br(n[s])}))}}class Cne extends Dd{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const r in this.history){const o=this.history[r];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(r),s.push(a)}}const i=await Promise.all(e);for(let r=0;r<i.length;++r)this.history[n[r]][s[r]].dispose(),this.history[n[r]][s[r]]=i[r][0]}}class Ine extends Dd{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||jL,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=_ne),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");k0(this.yieldEvery)&&(this.maybeWait=Fte(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const i=[];this.yield!=null&&(await La(s),i.push(this.yield(e,n,s))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await La(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await La(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await La(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await La(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):k0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await La(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await La(e),await this.trainEnd(e))}}function UF(t,e){return t==null&&(t={}),t instanceof Dd?[t]:Array.isArray(t)&&t[0]instanceof Dd?t:pt(t).map(s=>new Ine(s,e))}class ri{constructor(){}static registerCallbackConstructor(e,n){R(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ri.checkForDuplicate(n),ri.constructors[e]==null&&(ri.constructors[e]=[]),ri.constructors[e].push(n)}static checkForDuplicate(e){for(const n in ri.constructors)ri.constructors[+n].forEach(i=>{if(i===e)throw new B("Duplicate callback constructor.")})}static clear(){ri.constructors={}}static createCallbacks(e){const n=[];for(const s in ri.constructors){const i=+s;e>=i&&n.push(...ri.constructors[i])}return n.map(s=>new s)}}ri.constructors={};function WF(t,e,n,s,i,r,o,a,l){const c=new Cne,h=[new bne,...ri.createCallbacks(e)];t!=null&&h.push(...t),h.push(c);const d=new wne(h);return d.setParams({epochs:n,initialEpoch:s,samples:i,steps:r,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sr(t,e={},n=!1){return up(t,li.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qg(t,e){return X(()=>{t.dtype!=="float32"&&(t=_e(t,"float32"));const n=$e(dp(t),e,!0),s=Yv(n.shape,cn()),i=Gn(wa(n,s));return Re(t,i)})}function lx(t,e){return X(()=>nn(dp(Ae(e,t)),-1))}function ok(t,e){return X(()=>nn(Yn(Ae(e,t)),-1))}function ak(t,e){return X(()=>{const n=Ae(t,e),s=qs(Yn(t),cn(),Number.MAX_VALUE),i=Yn(Re(n,s));return U(100,nn(i,-1))})}function kne(t,e){return X(()=>{const n=qs(e,cn(),Number.MAX_VALUE),s=$r(pe(1,n)),i=qs(t,cn(),Number.MAX_VALUE),r=$r(pe(1,i));return nn(dp(Ae(s,r)),-1)})}function Sne(t,e){return X(()=>{const n=wa(0,Ae(1,U(t,e)));return nn(dp(n),-1)})}function Tne(t,e){return X(()=>{const n=wa(0,Ae(1,U(t,e)));return nn(n,-1)})}function Ene(t,e){return X(()=>{const n=$e(U(t,e),-1),s=ji(U(Ae(1,t),e),-1);return wa(0,pe(1,Ae(s,n)))})}function Nne(t,e){return X(()=>{const n=Math.log(2),s=Ae(e,t),i=Ae(pe(s,sp(U(-2,s))),n);return nn(i,-1)})}function Pd(t,e,n=!1){return X(()=>{if(n)e=uI(e);else{const s=$e(e,e.shape.length-1,!0);e=Re(e,s)}return e=qs(e,cn(),1-cn()),Kt($e(U(_e(t,"float32"),$r(e)),e.shape.length-1))})}function Kg(t,e,n=!1){return X(()=>{const s=_e(ex(Xte(t)),"int32");e=qs(e,cn(),1-cn());const i=e.shape,r=G(hL(s,i[i.length-1]),i);return Pd(r,e,n)})}function $ne(t,e){if(!ct(t.shape,e.shape))throw new B(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return X(()=>{const n=Kl(e),s=Kt(Yn(e));return pe(Ae(n,U(e,t)),aL(Nr(s)))})}function cx(t,e){return X(()=>{let n;return n=qs(e,cn(),1-cn()),n=$r(Re(n,Ae(1,n))),nn($ne(t,n),-1)})}function Rne(t,e){return X(()=>{const n=qs(t,cn(),1),s=qs(e,cn(),1);return $e(U(t,$r(Re(n,s))),-1)})}function Ane(t,e){return X(()=>{const n=$r(pe(cn(),e));return nn(Ae(e,U(t,n)),-1)})}function VF(t,e){return X(()=>{const n=qg(t,-1),s=qg(e,-1),i=U(n,s);return Kt($e(i,-1))})}const Xg={meanSquaredError:lx,meanAbsoluteError:ok,meanAbsolutePercentageError:ak,meanSquaredLogarithmicError:kne,squaredHinge:Sne,hinge:Tne,categoricalHinge:Ene,logcosh:Nne,categoricalCrossentropy:Pd,sparseCategoricalCrossentropy:Kg,binaryCrossentropy:cx,kullbackLeiblerDivergence:Rne,poisson:Ane,cosineProximity:VF};function Q_(t){if(typeof t=="string"){if(t in Xg)return Xg[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new B(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GF(t,e){return X(()=>{const n=U(.5,_i(e)),s=Ir(Zs(e,n),t.dtype);return nn(Er(t,s),-1)})}function jF(t,e){return X(()=>Ir(Er(Ed(t,-1),Ed(e,-1)),"float32"))}function Dne(t,e){return X(()=>_e($e(oo(Er(t,1),Er(e,1))),"float32"))}function Pne(t,e){return X(()=>_e($e(oo(Er(t,0),Er(e,1))),"float32"))}function One(t,e){return X(()=>{const n=Dne(t,e),s=Pne(t,e),i=pe(n,s);return _e(ns(Zs(i,0),Re(n,i),0),"float32")})}function Lne(t,e){return cx(t,e)}function Fne(t,e){return t.rank===e.rank&&(t=rp(t,[t.rank-1])),e=Ed(e,-1),e.dtype!==t.dtype&&(e=_e(e,t.dtype)),_e(Er(t,e),"float32")}const Mne=lx,zne=lx,Bne=ok,Une=ok,Wne=ak,Vne=ak,HF=Pd,Gne=VF,qF=Kg,Zg={binaryAccuracy:GF,categoricalAccuracy:jF,precision:One,categoricalCrossentropy:HF,sparseCategoricalCrossentropy:qF,mse:Mne,MSE:zne,mae:Bne,MAE:Une,mape:Wne,MAPE:Vne,cosine:Gne};function jne(t){if(typeof t=="string"&&t in Zg)return Zg[t];if(typeof t!="string"&&t!=null)return t;throw new B(`Unknown metric ${t}`)}function ym(t){if(dr(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Xg))if(Xg[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Zg))if(Zg[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hne(t){const e={Adagrad:()=>Va.adagrad(.01),Adadelta:()=>Va.adadelta(1,.95,cn()),Adam:()=>Va.adam(.001,.9,.999,cn()),Adamax:()=>Va.adamax(.002,.9,.999,cn(),0),RMSProp:()=>Va.rmsprop(.001,.9,0,cn()),SGD:()=>Va.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new B(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const f2=1*1024*1024;function p2(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!J0(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>f2&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${f2}.`)}}function J0(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!J0(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!J0(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qne(t,e,n,s=console.log){const i=Xne(t),r=["Layer (type)","Input Shape","Output shape","Param #"];i?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(h=>Math.floor(e*h)));let o;if(!i){r.push("Receives inputs"),o=[];for(const h in t.nodesByDepth)o.push(...t.nodesByDepth[h])}s("_".repeat(e)),Yg(r,n,s),s("=".repeat(e));const a=t.layers;for(let h=0;h<a.length;++h)i?Zne(a[h],n,s):Yne(a[h],n,o,s),s((h===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=Kne(t),c=Gg(t.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function Kne(t){let e;return t.collectedTrainableWeights!=null?e=Gg(t.collectedTrainableWeights):e=Gg(t.trainableWeights),e}function Xne(t){let e=!0;const n=[],s=[];for(const i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){e=!1;break}s.push(...i)}if(e)for(const i of t.layers){let r=!1;for(const o of i.inboundNodes)if(s.indexOf(o)!==-1)if(r){e=!1;break}else r=!0;if(!e)break}return e}function Yg(t,e,n=console.log){let s="";for(let i=0;i<t.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=t[i],s=s.slice(0,e[i]),s+=" ".repeat(e[i]-s.length);n(s)}function Zne(t,e,n){let s,i;try{i=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const r=t.name,o=t.getClassName(),a=[`${r} (${o})`,i,s,t.countParams().toString()];Yg(a,e,n)}function Yne(t,e,n,s){let i,r;try{r=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{r="multiple"}try{i=JSON.stringify(t.outputShape)}catch{i="multiple"}const o=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let f=0;f<d.inboundLayers.length;++f){const m=d.inboundLayers[f].name,g=d.nodeIndices[f],v=d.tensorIndices[f];o.push(`${m}[${g}][${v}]`)}const a=t.name,l=t.getClassName(),c=o.length===0?"":o[0],h=[`${a} (${l})`,r,i,t.countParams().toString(),c];Yg(h,e,s);for(let d=1;d<o.length;++d)Yg(["","","","",o[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KF(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Qg(t,e){if(t===null)return null;if(typeof t=="string")return Ha(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let i=0;i<s;++i){const r=t[i];KF(e,i,r)?n.push(r):n.push(Qg(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const i=t[s];if(s==="name"&&typeof i=="string")n[s]=i;else{const r=Ha(s);n[r]=Qg(i,r)}}return n}}function eb(t,e){if(t==null)return null;if(typeof t=="string")return Wr(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let i=0;i<s;++i){const r=t[i];KF(e,i,r)?n.push(r):n.push(eb(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const i=t[s],r=Wr(s);(s==="name"||s==="className")&&typeof i=="string"?n[r]=i:n[r]=eb(i,s)}return n}}/** @license See the LICENSE file. */const XF="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Qne=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Ai extends He{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=rx(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Zo(this.inputs).length!==this.inputs.length)throw new B(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);Zo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const C=w.sourceLayer,I=w.nodeIndex,S=w.tensorIndex;this.outputLayers.push(C),this.outputLayersNodeIndices.push(I),this.outputLayersTensorIndices.push(S)}for(const w of this.inputs){const C=w.sourceLayer,I=w.nodeIndex,S=w.tensorIndex;dr(I===0,"input layer has >1 nodes"),dr(S===0,"input layer has >1 tensors"),this.inputLayers.push(C),this.inputLayersNodeIndices.push(I),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const C=this.inputLayers[w];if(!(C instanceof pp))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${C.getClassName()}.`);this.inputNames.push(C.name),this.feedInputShapes.push(C.batchInputShape),this.feedInputNames.push(C.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const n={},s={},i={},r={},o={},a=[],l=(w,C,I,S,T,E)=>{(S==null||T==null||E==null)&&(S=w.sourceLayer,T=w.nodeIndex,E=w.tensorIndex);const $=S.inboundNodes[T];if(I.indexOf($)!==-1)throw new fi(`The tensor ${w.name} at layer "${S.name}" is part of a cycle.`);if(C.indexOf($)!==-1)return;this.containerNodes.add(Ai.nodeKey(S,T)),S.id in o||(o[S.id]=Object.keys(o).length),I.indexOf($)===-1&&I.push($);const D=$.inboundLayers.length;for(let P=0;P<D;P++){const z=$.inputTensors[P],H=$.inboundLayers[P],Q=$.nodeIndices[P],Z=$.tensorIndices[P];l(z,C,I,H,Q,Z)}for(C.push($);I.indexOf($)>=0;)I.splice(I.indexOf($),1);a.push($)},c=[],h=[];for(const w of this.outputs)l(w,c,h);const d=a.slice().reverse();for(const w of d){s[w.id]=w,w.id in n||(n[w.id]=0);let C=n[w.id];const I=i[w.outboundLayer.id]==null?0:i[w.outboundLayer.id];C=Math.max(C,I),i[w.outboundLayer.id]=C,r[w.outboundLayer.id]=w.outboundLayer,n[w.id]=C;for(let S=0;S<w.inboundLayers.length;S++){const T=w.inboundLayers[S],E=w.nodeIndices[S],$=T.inboundNodes[E],D=n[$.id]==null?0:n[$.id];n[$.id]=Math.max(C+1,D),s[$.id]=$}}const f={};for(const w in n){const C=n[w];C in f||(f[C]=[]),f[C].push(s[w])}const m={};for(const w in i){const C=i[w];C in m||(m[C]=[]),m[C].push(r[w])}let g=Object.keys(m).map(w=>parseInt(w,10)).sort(pm);this.layers=[];for(const w of g){const C=m[w];C.sort((I,S)=>{const T=o[I.id],E=o[S.id];return T<E?-1:T>E?1:0});for(const I of C)I instanceof Ai&&this.internalContainerRefs.push(I),this.layers.push(I)}this.layersByDepth=m,g=Object.keys(f).map(w=>parseInt(w,10)).sort(pm);const v=this.inputs.slice(),_=[];for(const w of g)for(const C of f[w]){const I=C.outboundLayer;if(I!=null){for(const S of C.inputTensors)if(v.indexOf(S)===-1)throw new fi(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${I.name}". The following previous layers were accessed without issue: ${_}`);for(const S of C.outputTensors)v.push(S);_.push(I.name)}}this.nodesByDepth=f;const x=this.layers.map(w=>w.name);for(const w of x){const C=x.filter(I=>I===w).length;if(C!==1)throw new fi(`The name "${w}" is used ${C} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new ax({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new B("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let i=0;const r=Qne(e);r&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const h=r?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[h]!=null)throw new B(`Duplicate weight name: ${h}`);s[h]=c,i++}const o=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new B(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new B(`${a.length} of ${i} weights are not set: ${a}`)}ik(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),i=["vars","layer_checkpoint_dependencies"],r=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!i.includes(o)).join("/");r!==n&&(e[r]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${XF}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=eb(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return X(()=>{e=pt(e);const s=new Oo;for(let i=0;i<this.inputs.length;++i)s.add(this.inputs[i],e[i]);return Ph(this.outputs,s,n)})}computeMask(e,n){return X(()=>{e=pt(e);let s;return n==null?s=Nl(null,e.length):s=pt(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=Vg(e);if(n.length!==this.inputLayers.length)throw new B(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],h=l.name+"_0_0";s[h]=c}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(pm);if(i.length>1)for(const a of i){const l=this.nodesByDepth[a];for(const c of l){const h=c.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(h.id)!==-1)continue;const d=[];for(let v=0;v<c.inboundLayers.length;v++){const _=c.inboundLayers[v],x=c.nodeIndices[v],w=c.tensorIndices[v],C=`${_.name}_${x}_${w}`,I=s[C];d.push(I)}const f=h.computeOutputShape(us(d)),m=Vg(f),g=h.inboundNodes.indexOf(c);for(let v=0;v<m.length;v++){const _=`${h.name}_${g}_${v}`;s[_]=m[v]}}}const r=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${h}`;o.push(d)}for(let a=0;a<o.length;a++){const l=o[a];dr(l in s),r.push(s[l])}return us(r)}runInternalGraph(e,n){n==null&&(n=Nl(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],h=e[l],d=n[l];s[c.id]=[h,d]}const i=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(pm);for(const l of i){const c=this.nodesByDepth[l];for(const h of c){const d=h.outboundLayer,f=h.inputTensors,m=h.outputTensors,g=new Array;for(const v of f)v.id in s&&g.push(s[v.id]);if(g.length===f.length){let v={},_,x,w,C;if(h.callArgs!=null&&(v=h.callArgs),g.length===1){const[I,S]=g[0];v.mask==null&&(v.mask=S),w=pt(d.call(I,v)),C=pt(d.computeMask(I,S)),_=[I],x=[S]}else _=g.map(I=>I[0]),x=g.map(I=>I[1]),v.mask==null&&(v.mask=x),w=pt(d.call(_,v)),C=pt(d.computeMask(_,x));if(d.activityRegularizer)throw new Ue("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let I=0;I<m.length;++I){const S=m[I],T=w[I],E=C[I];s[S.id]=[T,E]}}}}const r=[],o=[],a=[];for(const l of this.outputs){dr(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,h]=s[l.id];a.push(c.shape),r.push(c),o.push(h)}return[r,o,a]}buildNodeConversionMap(e){const n={};let s;for(const i of this.layers){s=i instanceof Ai?1:0;for(let r=0;r<i.inboundNodes.length;r++){const o=Ai.nodeKey(i,r);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new B("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new B(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new B(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return X(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const i=Ai.nodeKey(n,s);this.containerNodes.has(i)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let d=0;d<o.inboundNodes.length;d++){const f=o.inboundNodes[d],m=Ai.nodeKey(o,d);let g={};if(this.containerNodes.has(m)){if(f.callArgs)try{JSON.stringify(f.callArgs),g=f.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),g={}}if(f.inboundLayers.length>0){const v=[];for(let _=0;_<f.inboundLayers.length;_++){const x=f.inboundLayers[_],w=f.nodeIndices[_],C=f.tensorIndices[_],I=Ai.nodeKey(x,w);let S=n[I];S==null&&(S=0),v.push([x.name,S,C,g])}c.push(v)}}}const h={};h.name=o.name,h.className=a,h.config=l,h.inboundNodes=c,s.push(h)}e.layers=s;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=Ai.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let h=n[c];h==null&&(h=0);const d=this.inputLayersTensorIndices[o];i.push([a.name,h,d])}e.inputLayers=i;const r=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=Ai.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let h=n[c];h==null&&(h=0);const d=this.outputLayersTensorIndices[o];r.push([a.name,h,d])}return e.outputLayers=r,e}static fromConfig(e,n,s={},i=!1){const r={},o={};function a(_,x){_.name in o?o[_.name].push(x):o[_.name]=[x]}function l(_,x){const w=[];let C;for(const I of x){const S=I[0],T=I[1],E=I[2];if(C=I[3]==null?{}:I[3],!(S in r)){a(_,x);return}const $=r[S];if($.inboundNodes.length<=T){a(_,x);return}const D=$.inboundNodes[T];w.push(D.outputTensors[E])}w.length>0&&_.apply(us(w),C)}function c(_){const x=_.name,w=Sr(_,n.customObjects!=null?n.customObjects:{});w.setFastWeightInitDuringBuild(i),r[x]=w,_.inboundNodes.forEach(I=>{if(!(I instanceof Array))throw new B(`Corrupted configuration, expected array for nodeData: ${I}`);a(w,I)})}const h=n.name,d=n.layers;for(const _ of d)c(_);for(;!Lte(o);)for(const _ of d){const x=r[_.name];if(x.name in o){const w=o[x.name];delete o[x.name];for(const C of w)l(x,C)}}const f=[],m=[],g=n.inputLayers;for(const _ of g){const x=_[0],w=_[1],C=_[2];dr(x in r);const S=r[x].inboundNodes[w].outputTensors;f.push(S[C])}const v=n.outputLayers;for(const _ of v){const x=_[0],w=_[1],C=_[2];dr(x in r);const S=r[x].inboundNodes[w].outputTensors;m.push(S[C])}return new e({inputs:f,outputs:m,name:h})}get stateful(){if(this._stateful)throw new B("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){X(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jne(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(i=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const i=[];return e.forEach(r=>{r in t?i.push(t[r]):i.push(null)}),i}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function ZF(t,e){return Jne(t,e,"classWeight")}async function YF(t,e,n,s){if(n!=null){const i=X(()=>{if(t.shape.length===1)return rl(t);if(t.shape.length===2){if(t.shape[1]>1)return Ed(t,1);if(t.shape[1]===1)return G(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await i.data());We(i);const o=[];return r.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),ks(o,"float32")}else return null}function ese(t,e){return U(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tse=32;function QF(t,e){let n,s;const i=e;n=i.xs,s=i.ys,R(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const r=m2("input",t.inputNames,n),o=m2("output",t.outputNames,s),a=r[0].shape[0];R(r.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${r.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),R(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<r.length;l++)R(r[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${r[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)R(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:r,ys:o}}function m2(t,e,n){if(n instanceof an)return[n];if(Array.isArray(n))return R(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const i of e){if(n[i]==null)throw new B(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);s.push(n[i])}return s}}function nse(t){if(t.length===3)throw new Ue("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function sse(t,e,n){const s=n.batchesPerEpoch!=null;if(R(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),R(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),R(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),R(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),R(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=n.validationData!=null;let r,o;if(i)if(g2(n.validationData))R(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const _=nse(n.validationData);r=_.xs,o=_.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;i?c=l.slice().concat(l.map(_=>"val_"+_)):c=l.slice();const h=UF(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:f,history:m}=WF(h,d,n.epochs,null,null,ise(e,n),null,i,c);f.setModel(t),t.history=m,await f.onTrainBegin(),t.stopTraining_=!1;let g=n.initialEpoch==null?0:n.initialEpoch,v=await e.iterator();for(;g<n.epochs;){const _={};await f.onEpochBegin(g);let x=0,w=0;for(s||(v=await e.iterator());!s||x<n.batchesPerEpoch;){const C=await v.next();if(s&&C.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(C.value!=null){const{xs:I,ys:S}=QF(t,C.value),T={};T.batch=w,T.size=I[0].shape[0],await f.onBatchBegin(w,T);const E=[];if(n.classWeight!=null){const P=ZF(n.classWeight,t.outputNames);for(let z=0;z<P.length;++z)E.push(await YF(S[z],null,P[z]))}const $=I.concat(S).concat(E),D=a($);We($);for(let P=0;P<l.length;++P){const z=l[P],H=D[P];T[z]=H,br(H)}await f.onBatchEnd(w,T),BF(T),w++,x++}if(s?x>=n.batchesPerEpoch:C.done){if(i){let I;g2(n.validationData)?I=pt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):I=pt(t.evaluate(r,o,{batchSize:n.validationBatchSize==null?tse:n.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)_[`val_${t.metricsNames[S]}`]=I[S]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(g,_),g++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function ise(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function g2(t){return typeof t.iterator=="function"}function rse(t){return typeof t.next=="function"}async function ose(t,e,n){n=n||{};const s=n.batches!=null,i=t.testFunction;let r=[];if(n.verbose>0)throw new Ue("Verbose mode is not implemented yet.");R(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=rse(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const c=await o.next();if(r=X(()=>{if(c.value){const{xs:h,ys:d}=QF(t,c.value),f=h.concat(d),m=X(()=>i(f));if(We(f),l===0)for(let v=0;v<m.length;++v)r.push(rt(0));const g=f[0].shape[0];for(let v=0;v<m.length;++v){const _=m[v],x=r[v];r[v]=X(()=>pe(r[v],U(g,_))),l>0&&We(x)}We(m),a+=g,++l}return r}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<r.length;++c){const h=r[c];r[c]=Re(r[c],a),We(h)}return us(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function J_(t){R(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function _h(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>al(s,e,n-e)):al(t,e,n-e)}function tb(t,e){return X(()=>t==null?null:Array.isArray(t)?t.map(n=>tb(n,e)):SF(t,e.dtype==="int32"?e:_e(e,"int32")))}function ew(t,e){const n=[];let s=0,i=null;for(;s<t;)i=s+e,i>=t&&(i=t),n.push([s,i]),s=i;return n}function JF(t){const e=[];t instanceof an&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(hp(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Ri(t,e){if(t==null)return;const n=[];if(e instanceof an)n.push(e.id);else if(Array.isArray(e))e.forEach(i=>n.push(i.id));else if(e!=null)for(const i in e){const r=e[i];n.push(r.id)}const s=[];if(t instanceof an)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(i=>{n.indexOf(i.id)===-1&&s.push(i)});else if(t!=null)for(const i in t){const r=t[i];n.indexOf(r.id)===-1&&s.push(r)}s.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ase(t){return t instanceof an}function nb(t){return Array.isArray(t)}function y2(t){return!ase(t)&&!nb(t)}function v2(t,e,n,s=!0,i=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(nb(t)&&t.length>0)o=!0;else if(y2(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new B(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let r;if(y2(t)){t=t,r=[];for(const o of e){if(t[o]==null)throw new B(`No data provided for "${o}". Need data for each key in: ${e}`);r.push(t[o])}}else if(nb(t)){if(t=t,t.length!==e.length)throw new B(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);r=t}else{if(t=t,e.length>1)throw new B(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);r=[t]}if(r=JF(r),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=r[o];if(a.shape.length!==n[o].length)throw new B(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],h=n[o][l];if(h!=null&&h>=0&&c!==h)throw new B(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return r}function lse(t,e,n){const s=Zo(t.map(r=>r.shape[0]));s.sort();const i=Zo(e.map(r=>r.shape[0]));if(i.sort(),s.length>1)throw new B(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(r=>r.shape))}`);if(i.length>1)throw new B(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(r=>r.shape))}`);if(s.length>0&&i.length>0&&!ct(s,i))throw new B(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function cse(t,e,n){const s=[lx,cx,Pd];for(let i=0;i<t.length;++i){const r=t[i],o=e[i],a=n[i];if(o!=null){if(o===Pd&&r.shape[r.shape.length-1]===1)throw new B(`You are passing a target array of shape ${r.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=r.shape.slice(1),c=a.slice(1);for(let h=0;h<l.length;++h){const d=l[h],f=c[h];if(f!=null&&d!==f)throw new B(`A target Tensor with shape ${r.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function x2(t,e,n,s=!0,i=""){let r;if(Array.isArray(t)){if(t.length!==e.length)throw new B(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);r=t}else{if(e.length>1)throw new B(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);r=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=r[o];if(a.shape.length!==n[o].length)throw new B(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],h=n[o][l];if(h!=null&&h!==c)throw new B(`Error when checking ${i}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function use(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const i of e){let r=n.hasOwnProperty(i)?n[i]:[];Array.isArray(r)||(r=[r]),s.push(r)}return s}}const hse="layers-model";class Kc extends Ai{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new B("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");qne(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Hne(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ca))throw new B("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new B(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(Q_(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new B(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>Q_(a))}else{const o=Q_(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ol("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=use(e.metrics,this.outputNames),r=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};ol("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=i[o];(c=>{const h="";let d,f,m;for(const g of c){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){const _=this.internalOutputShapes[o];_[_.length-1]===1||this.lossFunctions[o]===cx?["accuracy","acc"].indexOf(g)!==-1?f=GF:["crossentropy","ce"].indexOf(g)!==-1&&(f=Lne):this.lossFunctions[o]===Kg?["accuracy","acc"].indexOf(g)!==-1?f=Fne:["crossentropy","ce"].indexOf(g)!==-1&&(f=qF):["accuracy","acc"].indexOf(g)!==-1?f=jF:["crossentropy","ce"].indexOf(g)!==-1&&(f=HF);let x;["accuracy","acc"].indexOf(g)!==-1?x="acc":["crossentropy","ce"].indexOf(g)!==-1&&(x="ce"),m=f,d=h+x}else m=jne(g),d=h+ym(g);let v;ol(d,()=>{v=m}),r(o,d,v)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const i=s.batchSize==null?32:s.batchSize;J_(i);const o=this.standardizeUserDataXY(e,n,!0,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,i,s.verbose,s.steps);return us(c)}finally{Ri(o[0],e),Ri(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),ose(this,e,n)}checkNumSamples(e,n,s,i="steps"){let r;if(s!=null){if(r=null,n!=null)throw new B(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?r=e[0].shape[0]:r=e.shape[0];else throw new B(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return r}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new B("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),i=s?n:[n],r=this.retrieveSymbolicTensors(i),o=new Oo;if(e instanceof an&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new B(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new B(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=Ph(r,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Nl(null,e.length);let s=e.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],o=r.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=r[l],s--),s===0)break}if(s===0)break}if(s>0){const i=[];throw n.forEach((r,o)=>{r==null&&i.push(e[o])}),new B(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(e,n=32,s=!1){return X(()=>{const i=this.checkNumSamples(e);if(s)throw new Ue("Verbose predictLoop() is not implemented yet.");const r=ew(i,n),o=this.outputs.map(a=>[]);for(let a=0;a<r.length;++a)X(()=>{const c=r[a][0],h=r[a][1],d=_h(e,c,h),f=[];if(Array.isArray(d))for(let g=0;g<d.length;++g)f.push({key:this.inputs[g],value:d[g]});else f.push({key:this.inputs[0],value:d});const m=new Oo(f);return Ph(this.outputs,m)}).forEach((c,h)=>o[h].push(c));return us(o.map(a=>ds(a,0)))})}predict(e,n={}){const s=JF(e);x2(s,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return J_(i),this.predictLoop(s,i)}finally{Ri(s,e)}}predictOnBatch(e){x2(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,i){if(this.optimizer_==null)throw new fi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Kg?r.push(a.slice(0,a.length-1).concat([1])):r.push(a)}if(e=v2(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=v2(n,this.feedOutputNames,r,!1,"target"),lse(e,n),cse(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new B(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,i,r=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,r,o);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(i!=null){const h=ZF(i,this.outputNames);c=[];for(let d=0;d<h.length;++d)c.push(await YF(l[d],null,h[d]))}return[a,l,c]}testLoop(e,n,s,i=0,r){return X(()=>{const o=this.checkNumSamples(n,s,r,"steps"),a=[];if(i>0)throw new Ue("Verbose mode is not implemented yet.");if(r!=null)throw new Ue("steps mode in testLoop() is not implemented yet");{const l=ew(o,s),c=ks(Yi(0,o));for(let h=0;h<l.length;++h){const d=l[h][0],f=l[h][1],m=al(c,d,f-d),g=tb(n,m),v=e(g);if(h===0)for(let _=0;_<v.length;++_)a.push(rt(0));for(let _=0;_<v.length;++_){const x=v[_];a[_]=pe(a[_],U(f-d,x))}}for(let h=0;h<a.length;++h)a[h]=Re(a[h],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const i=e[s];let r=i;if(s2(e,i)>1){const o=s2(e.slice(0,s),i);r+=`_${o}`}n.push(r)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const d=[];for(let v=0;v<this.inputs.length;++v)d.push({key:this.inputs[v],value:s[v]});const f=new Oo(d),m=Ph(this.outputs,f,{training:!0});let g;for(let v=0;v<this.lossFunctions.length;++v){const _=this.lossFunctions[v];let x=_(i[v],m[v]);r[v]!=null&&(x=ese(x,r[v]));const w=nn(x);n.push(w),v===0?g=x:g=pe(g,x)}for(let v=0;v<this.metricsTensors.length;++v){let _;if(this.outputs.length>1&&v<this.outputs.length)_=n[v];else{const x=this.metricsTensors[v][0],w=this.metricsTensors[v][1];_=nn(x(i[w],m[w]))}br(_),o.push(_)}return g=nn(g),this.calculateLosses().forEach(v=>{g=pe(g,v)}),g},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>X(()=>{const n=[];let s;const i=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:i[c]});const a=new Oo(o),l=Ph(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const h=this.lossFunctions[c],d=nn(h(r[c],l[c]));c===0?s=d:s=pe(s,d),n.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const h=this.metricsTensors[c][0],d=this.metricsTensors[c][1],f=nn(h(r[d],l[d]));n.push(f)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,r,o,a,l,c,h,d,f;try{const m=s.batchSize==null?32:s.batchSize;J_(m);const v=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,m);i=v[0],r=v[1],f=v[2];let _=!1,x;if(s.validationData!=null&&s.validationData.length>0){if(_=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new Ue("validationData including sample weights is not supported yet."):new B(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const P=await this.standardizeUserData(l,c,null,null,!0,m);h=P[0],d=P[1],x=h.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){_=!0;const D=Math.floor(i[0].shape[0]*(1-s.validationSplit)),P=i[0].shape[0];h=_h(i,D,P),o=i,i=_h(i,0,D),d=_h(r,D,P),a=r,r=_h(r,0,D),x=h.concat(d)}else s.validationSteps!=null&&(_=!0);const w=i.concat(r).concat(f);this.checkTrainableWeightsConsistency();const C=this.makeTrainFunction(),I=this.getDedupedMetricsNames();let S,T;_?(this.makeTestFunction(),S=this.testFunction,T=I.slice().concat(I.map(D=>"val_"+D))):(S=null,x=[],T=I.slice());const E=UF(s.callbacks,s.yieldEvery);return await this.fitLoop(C,w,I,m,s.epochs,s.verbose,E,S,x,s.shuffle,T,s.initialEpoch,null,null)}finally{this.isTraining=!1,Ri(i,e),Ri(r,n),Ri(o,e),Ri(a,n),Ri(h,l),Ri(d,c),f!=null&&We(f)}}async fitLoop(e,n,s,i,r,o,a,l,c,h,d,f,m,g){i==null&&(i=32),r==null&&(r=1),h==null&&(h=!0),f==null&&(f=0);let v=!1;if(l!=null&&c!=null&&(v=!0),g!=null&&(v=!0,m==null))throw new B("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const _=this.checkNumSamples(n,i,m,"steps_per_epoch");let x;_!=null&&(x=Yi(0,_)),o==null&&(o=1);const{callbackList:w,history:C}=WF(a,o,r,f,_,m,i,v,d);w.setModel(this),this.history=C,await w.onTrainBegin(),this.stopTraining_=!1;for(let I=f;I<r;++I){await w.onEpochBegin(I);const S={};if(m!=null)throw new Ue("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Ue("batch shuffling is not implemneted yet");h&&$8(x);const T=ks(x),E=ew(_,i);for(let $=0;$<E.length;++$){const D={};if(await w.onBatchBegin($,D),X(()=>{const P=E[$][0],z=E[$][1],H=al(T,P,z-P);D.batch=$,D.size=z-P;const Q=tb(n,H),Z=e(Q);for(let J=0;J<s.length;++J){const Y=s[J],oe=Z[J];D[Y]=oe,br(oe)}if($===E.length-1&&v){const J=this.testLoop(l,c,i);for(let Y=0;Y<s.length;++Y){const oe=s[Y],O=J[Y];br(O),S["val_"+oe]=O}}}),await w.onBatchEnd($,D),BF(D),this.stopTraining_)break}T.dispose()}if(await w.onEpochEnd(I,S),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return sse(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),i=s[0],r=s[1],a=this.makeTrainFunction()(i.concat(r)),l=[];for(const c of a){const h=await c.data();l.push(h[0])}return We(a),Ri(s[0],e),Ri(s[1],n),us(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,i=s?this.trainableWeights:this.weights,r=this.getWeights(s);for(let o=0;o<i.length;++o)s&&!i[o].trainable||n.push({name:i[o].originalName,tensor:r[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=FN().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-FN().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Wr(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Wr(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const i of n)if(typeof s[i]=="string")e[i]=Wr(s[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Wr(ym(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Wr(ym(e)));{const e={};for(const n in this.metrics)e[n]=Wr(ym(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Qg(e.optimizer_config),s=Sr(n);let i;if(typeof e.loss=="string")i=Ha(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(o=>Ha(o));else if(e.loss!=null){i={};for(const o in e.loss)i[o]=Ha(e.loss[o])}let r;if(Array.isArray(e.metrics))r=e.metrics.map(o=>Ha(o));else if(e.metrics!=null){r={};for(const o in e.metrics)r[o]=Ha(e.metrics[o])}this.compile({loss:i,metrics:r,optimizer:s})}async save(e,n){if(typeof e=="string"){const c=OX(e);if(c.length===0)throw new B(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new B(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new B("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await MN(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:hse,generatedBy:`TensorFlow.js tfjs-layers v${XF}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:h,specs:d}=await MN(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=TX([s.data,h])}return this.userDefinedMetadata!=null&&(p2(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){p2(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Kc.className="Model";de(Kc);class eM extends Kc{}eM.className="Functional";de(eM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function dse(t,e){if(e==null&&(e={}),typeof t=="string"){const n=LX(t,e);if(n.length===0)n.push(yJ(t,e));else if(n.length>1)throw new B(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return fse(t,void 0,e)}async function fse(t,e,n){if(n==null&&(n={}),t.load==null)throw new B("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let i=s.modelTopology;i.model_config!=null&&(i=i.model_config);const r=n.strict==null?!0:n.strict,o=s.weightData!=null&&s.weightSpecs!=null&&r,a=Sr(Qg(i),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new B("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:h}=pse(s.weightData,s.weightSpecs);a.loadWeights(c,r),a.optimizer!=null&&h.length>0&&await a.optimizer.setWeights(h),We(c),We(h.map(d=>d.tensor))}return a}function pse(t,e){const n=wX(t,e),s={},i=[];return e.forEach(r=>{r.group==="optimizer"?i.push({name:r.name,tensor:n[r.name]}):s[r.name]=n[r.name]}),{modelWeights:s,optimizerWeights:i}}class fu extends Kc{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:rx("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new B(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof fu||e instanceof Kc;let s;if(n){if(s=e,s.outputs.length!==1)throw new B("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new B("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new B("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=fne({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new B(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new B("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=OF(this.outputs[0])}this.inboundNodes=[],new ax({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Nl(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(st(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Kc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},i=!1){let r,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new B("Legacy serialization format not supported yet.");r=n}else R(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof fu))throw new Ue(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of r){const h=Sr(l,void 0,i);i&&h.setFastWeightInitDuringBuild(!0),a.add(h)}return a}set stopTraining(e){if(this.model==null)throw new B("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new B("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}fu.className="Sequential";de(fu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mse(t){return new fu(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Hn=class extends Ou{getConfig(){return{}}};class tM extends Hn{apply(e,n=1){return Yte(e,n)}}tM.className="elu";de(tM);class nM extends Hn{apply(e){return yL(e)}}nM.className="selu";de(nM);class sM extends Hn{apply(e){return Kl(e)}}sM.className="relu";de(sM);class iM extends Hn{apply(e){return X(()=>Rd(6,Kl(e)))}}iM.className="relu6";de(iM);class rM extends Hn{apply(e){return e}}rM.className="linear";de(rM);class oM extends Hn{apply(e){return Au(e)}}oM.className="sigmoid";de(oM);class aM extends Hn{apply(e){return Jte(e)}}aM.className="hardSigmoid";de(aM);class lM extends Hn{apply(e){return sp(e)}}lM.className="softplus";de(lM);class cM extends Hn{apply(e){return Qte(e)}}cM.className="softsign";de(cM);class uM extends Hn{apply(e){return Xv(e)}}uM.className="tanh";de(uM);let lk=class extends Hn{apply(e,n=-1){return uI(e,n)}};lk.className="softmax";de(lk);class hM extends Hn{apply(e,n=-1){return lL(e,n)}}hM.className="logSoftmax";de(hM);class dM extends Hn{apply(e){return X(()=>X(()=>{const n=Math.sqrt(2),s=U(.5,pe(1,sL(Re(e,n))));return U(e,s)}))}}dM.className="gelu";de(dM);class fM extends Hn{apply(e){return X(()=>U(.5,U(e,pe(1,Xv(U(Gn(Re(2,Math.PI)),pe(e,U(.044715,Sl(e,3)))))))))}}fM.className="gelu_new";de(fM);class pM extends Hn{apply(e){return X(()=>U(e,Xv(sp(e))))}}pM.className="mish";de(pM);class mM extends Hn{apply(e,n=1){return X(()=>U(Au(U(e,n)),e))}}mM.className="swish";de(mM);function sa(t){return t.getClassName()}function tw(t,e={}){return up(t,li.getMap().classNameMap,e,"activation")}function ia(t){if(t==null){const e={};return e.className="linear",e.config={},tw(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},tw(e)}else return t instanceof Hn?t:tw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gse(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class gM extends Ou{}class yM extends gM{constructor(e){super(),gse(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return X(()=>{let n=_n([1]);return this.hasL1&&(n=pe(n,$e(U(this.l1,Yn(e))))),this.hasL2&&(n=pe(n,$e(U(this.l2,dp(e))))),G(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}yM.className="L1L2";de(yM);const _2={l1l2:"L1L2"};function _t(t){return KI(t)}function w2(t,e={}){return up(t,li.getMap().classNameMap,e,"regularizer")}function Lt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in _2?_2[t]:t,config:{}};return w2(n)}else return t instanceof gM?t:w2(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vM extends He{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=De(e);let s=Kl(e);return this.maxValue!=null&&(s=qs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}vM.className="ReLU";de(vM);class xM extends He{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=De(e);return KC(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}xM.className="LeakyReLU";de(xM);class _M extends He{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ot(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Lt(e.alphaRegularizer),this.alphaConstraint=fn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new B(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=st(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)s[i]=e[i];this.inputSpec=[new un({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=De(e),eI(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Mt(this.alphaInitializer),alphaRegularizer:_t(this.alphaRegularizer),alphaConstraint:dn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}_M.className="PReLU";de(_M);let wM=class extends He{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ue(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=De(e);return Qv(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};wM.className="ELU";de(wM);class bM extends He{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=De(e);return U(s,_e(Zs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}bM.className="ThresholdedReLU";de(bM);class CM extends He{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new lk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return X(()=>{let s=De(e);const i=n.mask;if(i!=null){const r=U(Ae(ba(s.shape),_e(i,s.dtype)),rt(-1e9));s=pe(s,r)}return this.axis instanceof Array?this.axis.length>1?Nr(Ae(s,cL(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}CM.className="Softmax";de(CM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xc(t,e,n){if(typeof t=="number")return Nl(t,e);if(t.length!==e)throw new B(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const i=t[s];if(!qte(i))throw new B(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${i}`)}return t}function Hi(t,e,n,s,i=1){if(t==null)return t;const r=e+(e-1)*(i-1);let o;return n==="same"?o=t:o=t-r+1,Math.floor((o+s-1)/s)}function fr(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+na([n-e,0]);else if(s==="same")t=t*e;else throw new B(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ck(t,e){return X(()=>(Yt(e),e==="channelsFirst"?Je(t,[0,2,3,1]):t))}function IM(t,e){return X(()=>(Yt(e),e==="channelsFirst"?Je(t,[0,2,3,4,1]):t))}function yse(t,e,n,s=1,i="valid",r,o=1){return X(()=>{if(r==null&&(r=Qi()),Yt(r),t.shape.length!==3)throw new B(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new B(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new B(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(r==="channelsFirst"&&(t=Je(t,[0,2,1])),i==="causal")throw new Ue("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=QO(t,e,s,i==="same"?"same":"valid","NWC",o);return n!=null&&(a=tr(a,n)),a})}function b2(t,e,n,s=[1,1],i="valid",r,o,a=null){return X(()=>{if(r==null&&(r=Qi()),Yt(r),t.rank!==3&&t.rank!==4)throw new B(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new B(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=ck(t,r);if(i==="causal")throw new Ue("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=pQ({x:l,filter:e,strides:s,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),r==="channelsFirst"&&(l=Je(l,[0,3,1,2])),l})}function vse(t,e,n,s=[1,1,1],i="valid",r,o){return X(()=>{if(r==null&&(r=Qi()),Yt(r),t.rank!==4&&t.rank!==5)throw new B(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new B(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=IM(t,r);if(i==="causal")throw new Ue("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=d7(a,e,s,i==="same"?"same":"valid","NDHWC",o),n!=null&&(a=tr(a,n)),r==="channelsFirst"&&(a=Je(a,[0,4,1,2,3])),a})}class ux extends He{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",ux.verifyArgs(n),this.rank=e,Cn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ue(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Xc(n.kernelSize,e,"kernelSize"),this.strides=Xc(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Ys(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Yt(this.dataFormat),this.activation=ia(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Ot(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=fn(n.biasConstraint),this.biasRegularizer=Lt(n.biasRegularizer),this.activityRegularizer=Lt(n.activityRegularizer),this.dilationRate=Xc(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new B(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new B(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new B(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(dr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!XI(e.kernelSize,"number",1,3))throw new B(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:sa(this.activation),useBias:this.useBias,biasInitializer:Mt(this.biasInitializer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),biasConstraint:dn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Lu extends ux{constructor(e,n){super(e,n),this.kernel=null,Lu.verifyArgs(n),this.filters=n.filters,Cn(this.filters,"filters"),this.kernelInitializer=Ot(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=fn(n.kernelConstraint),this.kernelRegularizer=Lt(n.kernelRegularizer)}build(e){e=st(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new B(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],i=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return X(()=>{e=De(e);let s;const i=this.bias==null?null:this.bias.read(),r=_F(this.activation.getClassName());if(r!=null&&this.rank===2)s=b2(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(this.rank===1)s=yse(e,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=b2(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=vse(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ue("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=st(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let r=0;r<s.length;++r){const o=Hi(s[r],this.kernelSize[r],this.padding,this.strides[r],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[r]);n.push(o)}let i=[e[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const e={filters:this.filters,kernelInitializer:Mt(this.kernelInitializer),kernelRegularizer:_t(this.kernelRegularizer),kernelConstraint:dn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new B(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Fu extends Lu{constructor(e){super(2,e),Fu.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!XI(e.kernelSize,"number",1,2))throw new B(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Fu.className="Conv2D";de(Fu);class gp extends Lu{constructor(e){super(3,e),gp.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new B(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}gp.className="Conv3D";de(gp);class kM extends Fu{constructor(e){if(super(e),this.inputSpec=[new un({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new B(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=st(e),e.length!==4)throw new B("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new B("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new un({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return X(()=>{let s=De(e);if(s.shape.length!==4)throw new B(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,r=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=i[o],c=i[a],h=this.kernelSize[0],d=this.kernelSize[1],f=this.strides[0],m=this.strides[1],g=fr(l,f,h,this.padding),v=fr(c,m,d,this.padding),_=[r,g,v,this.filters];this.dataFormat!=="channelsLast"&&(s=Je(s,[0,2,3,1]));let x=JO(s,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=Je(x,[0,3,1,2])),this.bias!=null&&(x=tr(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=st(e);const n=e.slice();let s,i,r;this.dataFormat==="channelsFirst"?(s=1,i=2,r=3):(s=3,i=1,r=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[s]=this.filters,n[i]=fr(n[i],l,o,this.padding),n[r]=fr(n[r],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}kM.className="Conv2DTranspose";de(kM);class SM extends gp{constructor(e){if(super(e),this.inputSpec=[new un({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new B(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=st(e),e.length!==5)throw new B("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new B("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new un({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return X(()=>{let s=De(e);if(s.shape.length!==5)throw new B(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,r=i[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=i[l],h=i[o],d=i[a],f=this.kernelSize[0],m=this.kernelSize[1],g=this.kernelSize[2],v=this.strides[0],_=this.strides[1],x=this.strides[2],w=fr(c,v,f,this.padding),C=fr(h,_,m,this.padding),I=fr(d,x,g,this.padding),S=[r,w,C,I,this.filters];this.dataFormat!=="channelsLast"&&(s=Je(s,[0,2,3,4,1]));let T=m7(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(T=Je(T,[0,4,1,2,3])),this.bias!==null&&(T=tr(T,this.bias.read(),this.dataFormat)),this.activation!==null&&(T=this.activation.apply(T)),T})}computeOutputShape(e){e=st(e);const n=e.slice();let s,i,r,o;this.dataFormat==="channelsFirst"?(s=1,i=2,r=3,o=4):(s=4,i=1,r=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],h=this.strides[0],d=this.strides[1],f=this.strides[2];return n[s]=this.filters,n[i]=fr(n[i],h,a,this.padding),n[r]=fr(n[r],d,l,this.padding),n[o]=fr(n[o],f,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}SM.className="Conv3DTranspose";de(SM);class TM extends Lu{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new B("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new B("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new B(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Ot(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Lt(n.depthwiseRegularizer),this.depthwiseConstraint=fn(n.depthwiseConstraint),this.pointwiseInitializer=Ot(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Lt(n.pointwiseRegularizer),this.pointwiseConstraint=fn(n.pointwiseConstraint)}build(e){if(e=st(e),e.length<this.rank+2)throw new B(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new B(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],i=this.kernelSize.concat([s,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new un({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return X(()=>{e=De(e);let s;if(this.rank===1)throw new Ue("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Je(e,[0,2,3,1])),s=vL(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=tr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Je(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Mt(this.depthwiseInitializer),e.pointwiseInitializer=Mt(this.pointwiseInitializer),e.depthwiseRegularizer=_t(this.depthwiseRegularizer),e.pointwiseRegularizer=_t(this.pointwiseRegularizer),e.depthwiseConstraint=dn(this.depthwiseConstraint),e.pointwiseConstraint=dn(this.pointwiseConstraint),e}}TM.className="SeparableConv";class EM extends TM{constructor(e){super(2,e)}}EM.className="SeparableConv2D";de(EM);class hx extends Lu{constructor(e){super(1,e),hx.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!XI(e.kernelSize,"number",1,1))throw new B(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}hx.className="Conv1D";de(hx);class NM extends He{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return X(()=>{if(e=De(e),this.dataFormat==="channelsLast"){const s=gm(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return gm(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=gm(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return gm(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}NM.className="Cropping2D";de(NM);class $M extends He{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Gte(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return X(()=>{let s=De(e);const i=s.shape;if(this.dataFormat==="channelsFirst"){s=Je(s,[0,2,3,1]);const r=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?Xr.resizeNearestNeighbor(s,[r,o]):Xr.resizeBilinear(s,[r,o]);return Je(a,[0,3,1,2])}else{const r=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?Xr.resizeNearestNeighbor(s,[r,o]):Xr.resizeBilinear(s,[r,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}$M.className="UpSampling2D";de($M);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xse(t,e,n=[1,1],s="valid",i,r){return X(()=>{i==null&&(i=Qi()),Yt(i);let o=ck(t,i);if(t.rank!==4)throw new B(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new B(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=GC(o,e,n,s==="same"?"same":"valid","NHWC",r),i==="channelsFirst"&&(o=Je(o,[0,3,1,2])),o})}class RM extends ux{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Ot(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=fn(e.depthwiseConstraint),this.depthwiseRegularizer=Lt(e.depthwiseRegularizer)}build(e){if(e=st(e),e.length<4)throw new B(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new B(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],i=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return X(()=>{e=De(e);let s=xse(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=tr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=st(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=Hi(n,this.kernelSize[0],this.padding,this.strides[0]),o=Hi(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,r,o]:[e[0],r,o,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Mt(this.depthwiseInitializer),e.depthwiseRegularizer=_t(this.depthwiseRegularizer),e.depthwiseConstraint=dn(this.depthwiseRegularizer),e}}RM.className="DepthwiseConv2D";de(RM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AM(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new B("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(r){return r==null||Array.isArray(r)?r:[r]}return e=i(e),n=i(n),{inputs:t,initialState:e,constants:n}}function DM(t,e,n,s=!1,i,r,o=!1,a=!1){return X(()=>{const l=e.shape.length;if(l<3)throw new B(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Yi(2,l));e=Je(e,c),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=_e(_e(i,"bool"),"float32"),i.rank===l-1&&(i=cs(i,-1)),i=Je(i,c)),s&&(e=Tl(e,0),i!=null&&(i=Tl(i,0)));const h=[];let d,f=n;const m=e.shape[0],g=El(e);let v;i!=null&&(v=El(i));for(let x=0;x<m;++x){const w=g[x],C=X(()=>t(w,f));if(i==null)d=C[0],f=C[1];else{const I=X(()=>{const S=v[x],T=Ae(_i(S),S),E=pe(U(C[0],S),U(f[0],T)),$=f.map((D,P)=>pe(U(C[1][P],S),U(D,T)));return{output:E,newStates:$}});d=I.output,f=I.newStates}a&&h.push(d)}let _;return a&&(_=ao(h,1)),[d,_,f]})}class Ia extends He{constructor(e){super(e);let n;if(e.cell==null)throw new B("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new dk({cells:e.cell}):n=e.cell,n.stateSize==null)throw new B("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new un({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Yi(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Y0(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let i;if(this.returnSequences?i=[e[0],e[1],s]:i=[e[0],s],this.returnState){const r=[];for(const o of n)r.push([e[0],o]);return[i].concat(r)}else return i}computeMask(e,n){return X(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(r=>null);return[s].concat(i)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ue("Constants support is not implemented in RNN yet.");Y0(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new un({shape:[n,null,...s]});const i=[e[0]].concat(e.slice(2));this.cell.build(i);let r;if(Array.isArray(this.cell.stateSize)?r=this.cell.stateSize:r=[this.cell.stateSize],this.stateSpec!=null){if(!ct(this.stateSpec.map(o=>o.shape[o.shape.length-1]),r))throw new B(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map(o=>new un({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){X(()=>{if(!this.stateful)throw new hr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new B("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>_n([s,i])):this.states_=[_n([s,this.cell.stateSize])];else if(e==null)We(this.states_),this.keptStates!=null&&(We(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>_n([s,i])):this.states_[0]=_n([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new B(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):We(this.states_);for(let i=0;i<this.states_.length;++i){const r=e[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[s,o];if(!ct(r.shape,a))throw new B(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[i]=r}}this.states_=this.states_.map(i=>br(i.clone()))})}apply(e,n){let s=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const r=AM(e,s,i,this.numConstants);e=r.inputs,s=r.initialState,i=r.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new un({shape:c.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof Rr){const c=[e].concat(o),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const f=super.apply(c,n);return this.inputSpec=d,f}else return super.apply(e,n)}call(e,n){return X(()=>{const s=n==null?null:n.mask,i=n==null?null:n.training;let r=n==null?null:n.initialState;e=De(e),r==null&&(this.stateful?r=this.states_:r=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==o)throw new B(`RNN Layer has ${o} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},c=DM((g,v)=>{const _=this.cell.call([g].concat(v),a);return[_[0],_.slice(1)]},e,r,this.goBackwards,s,null,this.unroll,this.returnSequences),h=c[0],d=c[1],f=c[2];this.stateful&&this.resetStates(f,i);const m=this.returnSequences?d:h;return this.returnState?[m].concat(f):m})}getInitialState(e){return X(()=>{let n=_n(e.shape);return n=$e(n,[1,2]),n=hp(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?X0(n,[1,s]):n):this.cell.stateSize>1?[X0(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ia.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const i=n.cell,r=Sr(i,s);return new e(Object.assign(n,{cell:r}))}}Ia.className="RNN";de(Ia);class dx extends He{}class uk extends dx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Lt(e.kernelRegularizer),this.recurrentRegularizer=Lt(e.recurrentRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.kernelConstraint=fn(e.kernelConstraint),this.recurrentConstraint=fn(e.recurrentConstraint),this.biasConstraint=fn(e.biasConstraint),this.dropout=du([1,na([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=du([1,na([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=st(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return X(()=>{if(e=e,e.length!==2)throw new B(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>_i(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>_i(s),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let r;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?r=kr(U(e,o),this.kernel.read()):r=kr(e,this.kernel.read()),this.bias!=null&&(r=tr(r,this.bias.read())),a!=null&&(s=U(s,a));let l=pe(r,kr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:sa(this.activation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:_t(this.kernelRegularizer),recurrentRegularizer:_t(this.recurrentRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),recurrentConstraint:dn(this.recurrentConstraint),biasConstraint:dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}uk.className="SimpleRNNCell";de(uk);class PM extends Ia{constructor(e){e.cell=new uk(e),super(e)}call(e,n){return X(()=>{this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}static fromConfig(e,n){return new e(n)}}PM.className="SimpleRNN";de(PM);class hk extends dx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new B("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ia(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Lt(e.kernelRegularizer),this.recurrentRegularizer=Lt(e.recurrentRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.kernelConstraint=fn(e.kernelConstraint),this.recurrentConstraint=fn(e.recurrentConstraint),this.biasConstraint=fn(e.biasConstraint),this.dropout=du([1,na([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=du([1,na([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=st(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return X(()=>{if(e=e,e.length!==2)throw new B(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>_i(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>_i(i),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=U(e,r[0]));let h=kr(e,this.kernel.read());this.useBias&&(h=tr(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=U(i,o[0]));const d=this.recurrentKernel.read(),[f,m]=js(d,[2*this.units,this.units],d.rank-1),g=kr(i,f),[v,_,x]=js(h,3,h.rank-1),[w,C]=js(g,2,g.rank-1);a=this.recurrentActivation.apply(pe(v,w)),l=this.recurrentActivation.apply(pe(_,C));const I=kr(U(l,i),m);c=this.activation.apply(pe(x,I));const S=pe(U(a,i),U(pe(1,Kt(a)),c));return[S,S]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:sa(this.activation),recurrentActivation:sa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:_t(this.kernelRegularizer),recurrentRegularizer:_t(this.recurrentRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),recurrentConstraint:dn(this.recurrentConstraint),biasConstraint:dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}hk.className="GRUCell";de(hk);class OM extends Ia{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new hk(e),super(e)}call(e,n){return X(()=>{this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}OM.className="GRU";de(OM);class fx extends dx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ia(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Lt(e.kernelRegularizer),this.recurrentRegularizer=Lt(e.recurrentRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.kernelConstraint=fn(e.kernelConstraint),this.recurrentConstraint=fn(e.recurrentConstraint),this.biasConstraint=fn(e.biasConstraint),this.dropout=du([1,na([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=du([1,na([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=st(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const r=this.biasInitializer,o=this.units;i=new(n=class extends bi{apply(l,c){const h=r.apply([o]),d=new YI().apply([o]),f=r.apply([o*2]);return r2(r2(h,d),f)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return X(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new B(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1];const r=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>_i(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>_i(i),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,h,d;0<this.dropout&&this.dropout<1&&(e=U(e,o[0]));let f=kr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=U(i,a[0])),f=pe(f,kr(i,this.recurrentKernel.read())),this.useBias&&(f=tr(f,this.bias.read()));const[m,g,v,_]=js(f,4,f.rank-1);l=this.recurrentActivation.apply(m),c=this.recurrentActivation.apply(g),h=pe(U(c,r),U(l,this.activation.apply(v))),d=this.recurrentActivation.apply(_);const x=U(d,this.activation.apply(h));return[x,x,h]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:sa(this.activation),recurrentActivation:sa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:_t(this.kernelRegularizer),recurrentRegularizer:_t(this.recurrentRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),recurrentConstraint:dn(this.recurrentConstraint),biasConstraint:dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}fx.className="LSTMCell";de(fx);class LM extends Ia{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new fx(e),super(e)}call(e,n){return X(()=>{this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}LM.className="LSTM";de(LM);class dk extends dx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return X(()=>{e=e;let s=e.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(s.splice(0,a.stateSize.length)):i.push(s.splice(0,1));i.reverse();const r=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=i[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),r.push(o.slice(1))}s=[];for(const a of r.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){Y0(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,i)=>{ol(`RNNCell_${i}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=r=>({className:r.getClassName(),config:r.getConfig()}),i={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),i)}static fromConfig(e,n,s={}){const i=[];for(const r of n.cells)i.push(Sr(r,s));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return Q0(e)}setWeights(e){const n=[];for(const s of this.cells){const i=s.weights.length,r=e.splice(i);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],r[o]])}ik(n)}}dk.className="StackedRNNCells";de(dk);function ra(t){const{ones:e,rate:n,training:s=!1,count:i=1,dropoutFunc:r}=t,o=()=>r!=null?r(e(),n):TF(e(),n),a=()=>fp(o,e,s);return!i||i<=1?br(a().clone()):Array(i).fill(void 0).map(a).map(c=>br(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var _se=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n};class FM extends Ia{constructor(e){if(e.unroll)throw new Ue("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ue("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new un({ndim:5})]}call(e,n){return X(()=>{if(this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new B("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return X(()=>{const{stateSize:n}=this.cell,s=e.shape,i=this.computeSingleOutputShape(s),r=[i[0],...i.slice(2)],o=_n(r);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){X(()=>{if(!this.stateful)throw new hr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,i=this.computeSingleOutputShape(s),r=[i[0],...i.slice(2)];if(s[0]==null)throw new B("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>_n(r)):this.states_=[_n(r)];else if(e==null)We(this.states_),this.keptStates!=null&&(We(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>_n(r)):this.states_[0]=_n(r);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new B(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):We(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=r;if(!ct(l.shape,c))throw new B(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>br(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:i,padding:r,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],h=e[l?4:3],d=Hi(c,i[0],r,o[0],a[0]),f=Hi(h,i[1],r,o[1],a[1]);return[...e.slice(0,2),...l?[s,d,f]:[d,f,s]]}}FM.className="ConvRNN2D";class fk extends fx{constructor(e){const{filters:n,kernelSize:s,strides:i,padding:r,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Cn(this.filters,"filters"),this.kernelSize=Xc(s,2,"kernelSize"),this.kernelSize.forEach(l=>Cn(l,"kernelSize")),this.strides=Xc(i||1,2,"strides"),this.strides.forEach(l=>Cn(l,"strides")),this.padding=r||"valid",Ys(this.padding),this.dataFormat=o||"channelsLast",Yt(this.dataFormat),this.dilationRate=Xc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Cn(l,"dilationRate"))}build(e){var n;e=st(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new B(`The channel dimension of the input should be defined. Found ${e[s]}`);const i=e[s],r=4,o=this.kernelSize.concat([i,this.filters*r]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*r]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,h=this.filters;l=new(n=class extends bi{apply(f,m){const g=c.apply([h]),v=ba([h]),_=c.apply([h*2]);return ZI([g,v,_])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*r],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return X(()=>{if(e.length!==3)throw new B(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,i=e[0],r=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>_i(i),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(V,te,ae)=>!te||!te[ae]?V:U(te[ae],V);let h=c(i,l,0),d=c(i,l,1),f=c(i,l,2),m=c(i,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>_i(r),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const g=this.recurrentDropoutMask;let v=c(r,g,0),_=c(r,g,1),x=c(r,g,2),w=c(r,g,3);const C=3,[I,S,T,E]=js(this.kernel.read(),a,C),[$,D,P,z]=this.useBias?js(this.bias.read(),a):[null,null,null,null];h=this.inputConv(h,I,$,this.padding),d=this.inputConv(d,S,D,this.padding),f=this.inputConv(f,T,P,this.padding),m=this.inputConv(m,E,z,this.padding);const[H,Q,Z,J]=js(this.recurrentKernel.read(),a,C);v=this.recurrentConv(v,H),_=this.recurrentConv(_,Q),x=this.recurrentConv(x,Z),w=this.recurrentConv(w,J);const Y=this.recurrentActivation.apply(pe(h,v)),oe=this.recurrentActivation.apply(pe(d,_)),O=pe(U(oe,o),U(Y,this.activation.apply(pe(f,x)))),q=U(this.recurrentActivation.apply(pe(m,w)),this.activation.apply(O));return[q,q,O]})}getConfig(){const e=super.getConfig(),{units:n}=e,s=_se(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),i)}inputConv(e,n,s,i){const r=kl(e,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?tr(r,s,this.dataFormat):r}recurrentConv(e,n){return kl(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}fk.className="ConvLSTM2DCell";de(fk);class MM extends FM{constructor(e){const n=new fk(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}MM.className="ConvLSTM2D";de(MM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class px extends He{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let i=0;i<this.noiseShape.length;++i)s.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return s}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,r=this.getNoiseShape(s);return fp(()=>TF(s,this.rate,r,this.seed),()=>s,i)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}px.className="Dropout";de(px);class zM extends px{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}zM.className="SpatialDropout1D";de(zM);class pk extends He{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=fn(e.kernelConstraint),this.biasConstraint=fn(e.biasConstraint),this.kernelRegularizer=Lt(e.kernelRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.activityRegularizer=Lt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=st(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=st(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e),i=_F(this.activation.getClassName());let r;return i!=null?r=kr(s,this.kernel.read(),i,this.bias?this.bias.read():null):(r=kr(s,this.kernel.read()),this.bias!=null&&(r=tr(r,this.bias.read())),this.activation!=null&&(r=this.activation.apply(r))),r})}getConfig(){const e={units:this.units,activation:sa(this.activation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:_t(this.kernelRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),biasConstraint:dn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}pk.className="Dense";de(pk);class mk extends He{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=st(e);for(const n of e.slice(1))if(n==null)throw new B(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Yo(e,1)]}call(e,n){return X(()=>{this.invokeCallHook(e,n);let s=De(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const i=[0];for(let r=2;r<s.rank;++r)i.push(r);i.push(1),s=Je(s,i)}return Zte(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}mk.className="Flatten";de(mk);class BM extends He{constructor(e){super(e),this.supportsMasking=!0,this.activation=ia(e.activation)}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e);return this.activation.apply(s)})}getConfig(){const e={activation:sa(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}BM.className="Activation";de(BM);class UM extends He{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return X(()=>(e=De(e),Kte(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}UM.className="RepeatVector";de(UM);class WM extends He{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",i=n.slice();let r=1,o=null;for(let l=0;l<i.length;++l){const c=i[l];if(this.isUnknown(c))if(o===null)o=l;else throw new B("Can only specifiy one unknown dimension.");else r*=c}const a=Yo(e);if(o!==null){if(r===0||a%r!==0)throw new B(s);i[o]=a/r}else if(a!==r)throw new B(s);return i}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e),i=s.shape,r=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return G(s,r)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}WM.className="Reshape";de(WM);class VM extends He{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Yi(1,e.dims.length+1);if(!ct(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new un({ndim:this.dims.length+1})]}computeOutputShape(e){e=st(e);const n=e.slice();return this.dims.forEach((s,i)=>{n[i+1]=e[s]}),n}call(e,n){return Je(De(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}VM.className="Permute";de(VM);class GM extends He{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=De(e);return W0(Bg(s,this.maskValue),-1)}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e),o=W0(Bg(s,this.maskValue),-1,!0);return U(s,_e(o,s.dtype))})}}GM.className="Masking";de(GM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jM extends He{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(pt(e.inputLength))}this.inputDim=e.inputDim,Cn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Cn(this.outputDim,"outputDim"),this.embeddingsInitializer=Ot(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Lt(e.embeddingsRegularizer),this.activityRegularizer=Lt(e.activityRegularizer),this.embeddingsConstraint=fn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return X(()=>this.maskZero?(e=De(e),Bg(e,et(e))):null)}computeOutputShape(e){if(e=st(e),this.inputLength==null)return[...e,this.outputDim];const n=pt(this.inputLength);if(n.length!==e.length-1)throw new B(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let i=0;i<n.length;++i){const r=n[i],o=e[i+1];if(r!=null&&o!=null&&r!==o)throw new B(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);r==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return X(()=>{this.invokeCallHook(e,n);let s=De(e);s.dtype!=="int32"&&(s=Ir(s,"int32"));const i=SF(this.embeddings.read(),G(s,[s.size]));return G(i,st(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Mt(this.embeddingsInitializer),embeddingsRegularizer:_t(this.embeddingsRegularizer),activityRegularizer:_t(this.activityRegularizer),embeddingsConstraint:dn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}jM.className="Embedding";de(jM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Yl=class extends He{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ue}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let i=0;i<n.length;++i){const r=e[e.length-n.length+i],o=n[i];if(r==null||o==null||r<0||o<0)s.push(null);else if(r===1)s.push(o);else if(o===1)s.push(r);else{if(r!==o)throw new B("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(r)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[st(e)]),e=e,e.length<2)throw new B(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const r of e)r!=null&&r[0]!==null&&n.push(r[0]);if(n=Zo(n),n.length>1)throw new B(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const i=e.map(r=>r.length);e.indexOf(null)===-1&&Zo(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return X(()=>{if(e=e,this.reshapeRequired){const s=[],i=e.map(r=>r.rank);if(i.indexOf(null)===-1){const r=na(i);for(let o of e){const a=o.rank;for(let l=0;l<r-a;++l)o=hp(o,1);s.push(o)}return this.mergeFunction(s)}else{let r=!1;for(const l of e){const c=l.rank;if(c==null){const h=l.shape,d=h[0],f=h.slice(1).concat([d]);let m=G(l,[d].concat(Yo(h.slice(1))));m=Je(m,[1,0]),m=G(m,f),s.push(m),r=!0}else if(c>1){const h=Yi(1,c).concat([0]);s.push(Je(l,h)),r=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(r){if(a==null){const l=o.shape,c=l.length,h=l[c-1],d=[h].concat(l.slice(0,l.length-1));o=G(Je(G(o,[-1,h]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Yi(0,a-1));o=Je(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let i=1;i<e.length;++i){const r=e[i]==null?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}let s=[];for(const i of e)i!=null&&i[0]!==null&&s.push(i[0]);return s=Zo(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return X(()=>{if(n==null)return null;if(!Array.isArray(n))throw new B("`mask` should be an Array");if(!Array.isArray(e))throw new B("`inputs` should be an Array");if(n.length!==e.length)throw new B(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:cs(i,0));let s=n[0];for(let i=1;i<n.length-1;++i)s=oo(s,n[i]);return s})}};class HM extends Yl{constructor(e){super(e)}mergeFunction(e){return X(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=pe(n,e[s]);return n})}}HM.className="Add";de(HM);class qM extends Yl{constructor(e){super(e)}mergeFunction(e){return X(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=U(n,e[s]);return n})}}qM.className="Multiply";de(qM);class KM extends Yl{constructor(e){super(e)}mergeFunction(e){return X(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=pe(n,e[s]);return U(1/e.length,n)})}}KM.className="Average";de(KM);class XM extends Yl{constructor(e){super(e)}mergeFunction(e){return X(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=wa(n,e[s]);return n})}}XM.className="Maximum";de(XM);class ZM extends Yl{constructor(e){super(e)}mergeFunction(e){return X(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Rd(n,e[s]);return n})}}ZM.className="Minimum";de(ZM);class YM extends Yl{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new B("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const i of e)if(i!=null){n=!1;break}if(n)return;const s=[];for(let i=0;i<e.length;++i){const r=e[i].slice();r.splice(this.axis,1);let o=!1;for(const a of s)if(ct(a,r)){o=!0;break}o||s.push(r)}if(s.length>1)throw new B("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return X(()=>ZI(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new B("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),i=this.axis<0?s.length+this.axis:this.axis;for(const r of n.slice(1)){if(s[i]==null||r[i]==null){s[i]=null;break}s[i]+=r[i]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new B("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new B("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new B(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return X(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const i=[];for(let o=0;o<e.length;++o)n[o]==null?i.push(_e(_i(e[o]),"bool")):n[o].rank<e[o].rank?i.push(cs(n[o],-1)):i.push(n[o]);const r=ds(i,this.axis);return YO(r,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}YM.className="Concatenate";de(YM);function wh(t,e){for(;t<0;)t+=e;return t}function wse(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ue("batchDot is not implemented for tensors of 4D or higher rank yet");if(R(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),R(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Ue("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,i=e.shape.length;n==null&&(n=[s-1,i-2]);const r=n;return X(()=>{let o;if(s>i){o=s-i;const l=[];for(let c=0;c<o;++c)l.push(1);e=G(e,e.shape.concat(l))}else if(i>s){o=i-s;const l=[];for(let c=0;c<o;++c)l.push(1);t=G(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)r[0]===r[1]?a=$e(U(t,e),r[0]):a=$e(U(Je(t,[1,0]),e),r[1]);else{const l=r[0]!==t.shape.length-1,c=r[1]===e.shape.length-1;a=lt(t,e,l,c)}if(o>0){let l;s>i?l=s+i-3:l=s-1;const c=[];for(let h=l;h<l+o;++h)c.push(h);a=rp(a,c)}return a.shape.length===1&&(a=cs(a,1)),a})}class QM extends Yl{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Ue("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,s);if(n[i[0]]!==s[i[1]])throw new B(`Dimension incompatibility: ${n[i[0]]} !== ${s[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new B(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((r,o)=>wh(r,e[o].shape.length)):i=[wh(this.axes,n.shape.length),wh(this.axes,s.shape.length)],this.normalize&&(n=qg(n,i[0]),s=qg(s,i[1])),wse(n,s,i)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[wh(this.axes,e.length),wh(this.axes,n.length)],s}computeOutputShape(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Ue("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,s);n.splice(i[0],1),s.splice(i[1],1),s.splice(0,1);const r=n.concat(s);return r.length===1&&r.push(1),r}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}QM.className="Dot";de(QM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JM extends He{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e);return fp(()=>pe(ox(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}JM.className="GaussianNoise";de(JM);class e3 extends He{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return X(()=>{this.invokeCallHook(e,n);const s=De(e);return this.rate>0&&this.rate<1?fp(()=>{const r=Math.sqrt(this.rate/(1-this.rate));return U(s,ox(s.shape,1,r))},()=>s,n.training||!1):s})}}e3.className="GaussianDropout";de(e3);class t3 extends He{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||De(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return X(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return fp(()=>{const r=De(e),a=-1.6732632423543772*1.0507009873554805;let l=Hl(ip(s),this.rate);l=Ir(l,"float32");const c=((1-this.rate)*(1+this.rate*a**2))**-.5,h=-c*a*this.rate,d=pe(U(r,l),U(pe(l,-1),a));return pe(U(d,c),h)},()=>De(e),n.training||!1)}return e})}}t3.className="AlphaDropout";de(t3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Od(t,e,n,s,i,r=.001){let o;if(t.rank===2)o=WZ(t,e,n,s,i,r);else if(t.rank===3)o=GZ(t,e,n,s,i,r);else if(t.rank===4)o=HZ(t,e,n,s,i,r);else throw new Ue(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function bse(t,e,n,s,i=.001){return X(()=>{const r=YC(t,s),o=r.mean,a=r.variance;return[Od(t,o,a,n,e,i),o,a]})}function Cse(t,e,n,s,i=.001){return X(()=>{const r=YC(t,s),o=r.mean,a=r.variance,l=[];for(const g of Yi(0,t.rank))s.indexOf(g)!==-1?l.push(1):l.push(t.shape[g]);const c=G(o,l),h=G(a,l),d=e==null?null:G(e,l),f=n==null?null:G(n,l);return[Od(t,c,h,f,d,i),o,a]})}function Ise(t,e,n,s,i=.001){return ct(s.slice().sort(),Yi(0,t.rank-1))?bse(t,e,n,s,i):Cse(t,e,n,s,i)}class n3 extends He{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ot(e.betaInitializer||"zeros"),this.gammaInitializer=Ot(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ot(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ot(e.movingVarianceInitializer||"ones"),this.betaConstraint=fn(e.betaConstraint),this.gammaConstraint=fn(e.gammaConstraint),this.betaRegularizer=Lt(e.betaRegularizer),this.gammaRegularizer=Lt(e.gammaRegularizer)}build(e){e=st(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new B(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new un({ndim:e.length,axes:{[n]:s}})];const i=[s];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return X(()=>{const s=n.training==null?!1:n.training,i=De(e),r=i.shape,o=r.length,a=Yi(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=Nl(1,o);c[l]=r[l];const h=a.slice();h.sort();const d=!ct(h,Yi(0,o).slice(0,o-1)),f=()=>{if(d){const w=G(this.movingMean.read(),c),C=G(this.movingVariance.read(),c),I=this.center?G(this.beta.read(),c):null,S=this.scale?G(this.gamma.read(),c):null;return Od(i,w,C,I,S,this.epsilon)}else return Od(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[m,g,v]=Ise(i,this.gamma.read(),this.beta.read(),a,this.epsilon),_=(w,C,I)=>{X(()=>{const S=1-I,T=w.read(),E=U(Ae(T,C),S);w.write(Ae(T,E))})};return(()=>{_(this.movingMean,g,this.momentum),_(this.movingVariance,v,this.momentum)})(),m})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mt(this.betaInitializer),gammaInitializer:Mt(this.gammaInitializer),movingMeanInitializer:Mt(this.movingMeanInitializer),movingVarianceInitializer:Mt(this.movingVarianceInitializer),betaRegularizer:_t(this.betaRegularizer),gammaRegularizer:_t(this.gammaRegularizer),betaConstraint:dn(this.betaConstraint),gammaConstraint:dn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}n3.className="BatchNormalization";de(n3);class s3 extends He{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ot(e.betaInitializer||"zeros"),this.gammaInitializer=Ot(e.gammaInitializer||"ones"),this.betaRegularizer=Lt(e.betaRegularizer),this.gammaRegularizer=Lt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=st(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=n);for(const r of this.axis)if(r<0||r>=n)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==Zo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(r=>e[r]),i=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,n){const s=De(e),i=s.shape,r=i.length;return X(()=>{let{mean:a,variance:l}=YC(s,this.axis,!0);const c=Nl(1,r);for(const v of this.axis)c[v]=i[v];const h=v=>v!=null&&v.shape.length!==r?G(v,c):v;let d=this.scale?h(this.gamma.read()):null,f=this.center?h(this.beta.read()):null;const m=[],g=[];for(let v=0;v<r;++v)this.axis.indexOf(v)!==-1?(m.push(i[v]),g.push(1)):(m.push(1),g.push(i[v]));return a=zi(a,m),l=zi(l,m),d!=null&&(d=zi(d,g)),f!=null&&(f=zi(f,g)),Od(s,a,l,f,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mt(this.betaInitializer),gammaInitializer:Mt(this.gammaInitializer),betaRegularizer:_t(this.betaRegularizer),gammaRegularizer:_t(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}s3.className="LayerNormalization";de(s3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kse(t,e,n){return X(()=>{if(t.rank!==4)throw new B(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new B("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Qi()),n!=="channelsLast"&&n!=="channelsFirst")throw new B(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],QC(t,s)})}class i3 extends He{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Qi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new B(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new B(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new B(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){e=st(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return X(()=>kse(De(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}i3.className="ZeroPadding2D";de(i3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mx(t,e,n,s,i,r){return X(()=>{Yt(i),bF(r),Ys(s),n==null&&(n=[1,1]),s==null&&(s="valid"),i==null&&(i=Qi()),r==null&&(r="max"),t=ck(t,i);let o;const a=s==="same"?"same":"valid";return r==="max"?o=ZC(t,e,n,a):o=BC(t,e,n,a),i==="channelsFirst"&&(o=Je(o,[0,3,1,2])),o})}function r3(t,e,n,s,i,r){return X(()=>{Yt(i),bF(r),Ys(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),i==null&&(i=Qi()),r==null&&(r="max"),t=IM(t,i);let o;const a=s==="same"?"same":"valid";return r==="max"?o=$9(t,e,n,a):o=AZ(t,e,n,a),i==="channelsFirst"&&(o=Je(o,[0,4,1,2,3])),o})}class o3 extends He{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new B(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Cn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new B(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ys(this.padding),this.inputSpec=[new un({ndim:3})]}computeOutputShape(e){e=st(e);const n=Hi(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return X(()=>{this.invokeCallHook(e,n),e=hp(De(e),2);const s=this.poolingFunction(De(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return rp(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class a3 extends o3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),mx(e,n,s,i,r,"max")}}a3.className="MaxPooling1D";de(a3);class l3 extends o3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),mx(e,n,s,i,r,"avg")}}l3.className="AveragePooling1D";de(l3);class c3 extends He{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new B(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Cn(this.poolSize,"poolSize"),Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),Ys(this.padding),this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){e=st(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Hi(n,this.poolSize[0],this.padding,this.strides[0]),s=Hi(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return X(()=>(this.invokeCallHook(e,n),this.poolingFunction(De(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class gk extends c3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),mx(e,n,s,i,r,"max")}}gk.className="MaxPooling2D";de(gk);class u3 extends c3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),mx(e,n,s,i,r,"avg")}}u3.className="AveragePooling2D";de(u3);class h3 extends He{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new B(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Cn(this.poolSize,"poolSize"),Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),Ys(this.padding),this.inputSpec=[new un({ndim:5})]}computeOutputShape(e){e=st(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Hi(n,this.poolSize[0],this.padding,this.strides[0]),s=Hi(s,this.poolSize[1],this.padding,this.strides[1]),i=Hi(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,i]:[e[0],n,s,i,e[4]]}call(e,n){return X(()=>(this.invokeCallHook(e,n),this.poolingFunction(De(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class d3 extends h3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),r3(e,n,s,i,r,"max")}}d3.className="MaxPooling3D";de(d3);class f3 extends h3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),r3(e,n,s,i,r,"avg")}}f3.className="AveragePooling3D";de(f3);class p3 extends He{constructor(e){super(e),this.inputSpec=[new un({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Ue}}class m3 extends p3{constructor(e){super(e||{})}call(e,n){return X(()=>{const s=De(e);return nn(s,1)})}}m3.className="GlobalAveragePooling1D";de(m3);class g3 extends p3{constructor(e){super(e||{})}call(e,n){return X(()=>{const s=De(e);return ji(s,1)})}}g3.className="GlobalMaxPooling1D";de(g3);class y3 extends He{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Ue}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class v3 extends y3{call(e,n){return X(()=>{const s=De(e);return this.dataFormat==="channelsLast"?nn(s,[1,2]):nn(s,[2,3])})}}v3.className="GlobalAveragePooling2D";de(v3);class x3 extends y3{call(e,n){return X(()=>{const s=De(e);return this.dataFormat==="channelsLast"?ji(s,[1,2]):ji(s,[2,3])})}}x3.className="GlobalMaxPooling2D";de(x3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _3 extends He{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const i=n.layer,r=Sr(i,s);delete n.layer;const o={layer:r};return Object.assign(o,n),new e(o)}}class w3 extends _3{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=st(e),e.length<3)throw new B(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=st(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),i=e[1];return[s[0],i].concat(s.slice(1))}call(e,n){return X(()=>(e=De(e),DM((o,a)=>[De(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}w3.className="TimeDistributed";de(w3);function Sse(t){Zl(Vte,"BidirectionalMergeMode",t)}const Tse="concat";class b3 extends _3{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=Sr(s),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=e.layer.getClassName(),i.config=n,this.backwardLayer=Sr(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Tse:e.mergeMode,Sse(this.mergeMode),e.weights)throw new Ue("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,i,r;return this.returnState&&(r=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,i=[s]):this.mergeMode==null?i=[s,s.slice()]:i=[s],this.returnState?this.mergeMode==null?i.concat(r).concat(r.slice()):[s].concat(r).concat(r.slice()):us(i)}apply(e,n){let s=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const r=AM(e,s,i,this.numConstants);if(e=r.inputs,s=r.initialState,i=r.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&i==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new B("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const h=s.map(d=>new un({shape:d.shape}));this.forwardLayer.stateSpec=h.slice(0,c/2),this.backwardLayer.stateSpec=h.slice(c/2),a.push(...h)}if(i!=null)throw new Ue("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Rr;for(const c of o)if(c instanceof Rr!==l)throw new B("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const f=super.apply(c,n);return this.inputSpec=d,f}else return super.apply(e,n)}call(e,n){return X(()=>{const s=n.initialState;let i,r;if(s==null)i=this.forwardLayer.call(e,n),r=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);i=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),r=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(r.slice(1))),i=i[0],r=r[0]),this.returnSequences&&(r=Tl(r,1));let a;return this.mergeMode==="concat"?a=ZI([i,r]):this.mergeMode==="sum"?a=pe(i,r):this.mergeMode==="ave"?a=U(.5,pe(i,r)):this.mergeMode==="mul"?a=U(i,r):this.mergeMode==null&&(a=[i,r]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ol(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ol(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const r=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(r).concat(r):[s].concat(r).concat(r)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=Sr(n.layer);if(delete n.layer,n.numConstants!=null)throw new Ue("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=s,new e(i)}}b3.className="Bidirectional";de(b3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class C3 extends He{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return X(()=>(e=De(e),e.dtype!=="float32"&&(e=Ir(e,"float32")),pe(U(e,this.scale),this.offset)))}}C3.className="Rescaling";de(C3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:Ese,cropAndResize:Nse}=Xr;class I3 extends He{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,i,r,o,a,l){return X(()=>{let c,h=!1;const d=n/o,f=s/a,m=(i+n)/o,g=(r+s)/a,v=[d,f,m,g],_=[];e.rank===3?(h=!0,c=ao([e])):c=e;for(let S=0;S<c.shape[0];S++)_.push(v);const x=Xh(_,[_.length,4]),w=Ad(0,_.length,1,"int32"),I=Nse(c,x,w,[i,r],"nearest");return Ir(h?De(El(I)):I,l)})}upsize(e,n,s,i){return X(()=>{const r=Ese(e,[n,s]);return Ir(r,i)})}call(e,n){return X(()=>{const s=De(e),i=s.dtype,r=s.shape,o=r[r.length-3],a=r[r.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,o,a,i):this.upsize(e,this.height,this.width,i)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=st(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}I3.className="CenterCrop";de(I3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $se(t,e,n,s){let i=De(t);if(i.dtype!=="int32"&&(i=Ir(i,"int32")),e==="int")return i;const r=i.shape;if(i.rank===0&&(i=cs(i,-1)),e==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=cs(i,-1)),i.rank>2)throw new B(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${r} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(e),a=i;let l;if(typeof s<"u"&&e==="count"?l=WN(a,s,n,o):l=WN(a,[],n,o),e!=="tfIdf")return l;if(s)return U(l,s);throw new B("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class k3 extends He{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=st(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return X(()=>{e=De(e),e.dtype!=="int32"&&(e=Ir(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new B(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=De(n.countWeights)}const i=ji(e),r=Mg(e),o=Zs(this.numTokens,i).bufferSync().get(0),a=Hl(r,0).bufferSync().get(0);if(!(o&&a))throw new B(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return $se(e,this.outputMode,this.numTokens,s)})}}k3.className="CategoryEncoding";de(k3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Rse=["bilinear","nearest"],C2=new Set(Rse);class S3 extends He{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(C2.has(e.interpolation))this.interpolation=e.interpolation;else throw new B(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=st(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return X(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Xr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...C2]} are supported`)})}}S3.className="Resizing";de(S3);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class T3{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}T3.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class E3 extends He{constructor(e){super(e),this.randomGenerator=new T3(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}E3.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ase=["bilinear","nearest"],I2=new Set(Ase);class N3 extends E3{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new B(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new B(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new B(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(I2.has(s))this.interpolation=s;else throw new B(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=st(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return X(()=>{const s=De(e);this.imgHeight=s.shape[s.shape.length-3];const i=s.shape[s.shape.length-2];this.widthFactor=ip([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*i;r=Math.round(r);const o=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return Xr.resizeBilinear(e,o);case"nearest":return Xr.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...I2]} are supported`)}})}}N3.className="RandomWidth";de(N3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k2(t){return new Fu(t)}function S2(t){return new pk(t)}function Dse(t){return new px(t)}function Pse(t){return new mk(t)}function T2(t){return new gk(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ose=ee();Ose.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var E2;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(E2||(E2={}));var N2;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(N2||(N2={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var $2;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})($2||($2={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ie(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&R(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse=SL;class gx extends U1{nextDataId(){return gx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new KP(this,cr())}write(e,n,s){this.firstUse&&(this.firstUse=!1,ee().get("IS_NODE")&&Bs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:s,refCount:1}),i}makeTensorInfo(e,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&sf(s[0])){const r=s.map(o=>Xo(o));i=this.write(r,e,n)}else i=this.write(s,e,n);return{dataId:i,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,i,r){this.data.set(e,{values:n,dtype:i,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const i=this.readSync(s.real.dataId),r=this.readSync(s.imag.dataId);return lo(i,r)}return L8(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(i=>ta(i));return Ge(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ge(e.shape,e.dtype,n)}makeOutput(e,n,s){return cr().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=ls();return e(),{kernelMs:ls()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ie([e],"where");const n=this.readSync(e.dataId);return Lse(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}gx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $3(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Fse=t=>{const{x:e}=t.inputs,n=t.backend;Ie(e,"abs");let s=new Float32Array(re(e.shape));const i=n.data.get(e.dataId).values;return s=$3(i),n.makeOutput(s,e.shape,e.dtype)},Mse={kernelName:Ky,backendName:"cpu",kernelFunc:Fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qt(t){return(e,n,s,i,r)=>{const o=ze(e,n),a=o.length,l=Te(o),c=re(o),h=Wn(r,c),d=e.length,f=n.length,m=Te(e),g=Te(n),v=uu(e,o),_=uu(n,o);if(v.length+_.length===0)for(let x=0;x<h.length;++x)h[x]=t(s[x%s.length],i[x%i.length]);else for(let x=0;x<h.length;++x){const w=$u(x,a,l),C=w.slice(-d);v.forEach(E=>C[E]=0);const I=wr(C,d,m),S=w.slice(-f);_.forEach(E=>S[E]=0);const T=wr(S,f,g);h[x]=t(s[I],i[T])}return[h,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bs(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",r),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const zse={kernelName:tC,backendName:"cpu",kernelFunc:bs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jg(t,e,n="float32"){if(n==="complex64"){const i=Jg(t,e,"float32"),r=Jg(t,e,"float32");return bs({inputs:{real:i,imag:r},backend:t})}const s=Vn(re(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ar(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Bse={kernelName:kf,backendName:"cpu",kernelFunc:Ar};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.real,r=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,r)}const Use={kernelName:kC,backendName:"cpu",kernelFunc:$l};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R3(t,e,n,s){if(s==="int32"){const i=Int32Array.from(t);return[e,"int32",i]}if(s==="bool"){const i=jl([0],n),[r,o]=Qt((a,l)=>a!==l?1:0)(e,[],t,i,"bool");return[o,"bool",r]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function oa(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:r}=s;if(r==="complex64"){if(i.dtype==="complex64")return Ar({inputs:{x:i},backend:n});const h=Jg(n,i.shape,i.dtype),d=oa({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),f=bs({inputs:{real:d,imag:h},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),f}if(i.dtype==="complex64"){const h=$l({inputs:{input:i},backend:n}),d=oa({inputs:{x:h},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(h),d}if(!ZP(i.dtype,r)){const h=Ar({inputs:{x:i},backend:n});return{dataId:h.dataId,shape:h.shape,dtype:r}}const o=n.data.get(i.dataId).values,[a,l,c]=R3(o,i.shape,i.dtype,r);return n.makeTensorInfo(a,l,c)}const Wse={kernelName:df,backendName:"cpu",kernelFunc:oa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mn(t,e,n,s){return n==null?({inputs:i,backend:r})=>{const{a:o,b:a}=i,l=r;Ie([o,a],t);const c=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,d=o.dtype==="string"?co(c):c,f=o.dtype==="string"?co(h):h,m=s||o.dtype,[g,v]=e(o.shape,a.shape,d,f,m);return l.makeTensorInfo(v,m,g)}:({inputs:i,backend:r})=>{const{a:o,b:a}=i,l=r;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=oa({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(c.dataId),d=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,m=l.data.get(d.dataId).values,g=l.data.get(f.dataId).values,v=oa({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),_=l.data.get(v.dataId),x=_.complexTensorInfos.real,w=_.complexTensorInfos.imag,C=l.data.get(x.dataId).values,I=l.data.get(w.dataId).values,[S,T,E]=n(o.shape,a.shape,m,g,C,I),$=l.makeTensorInfo(E,"float32",S),D=l.makeTensorInfo(E,"float32",T),P=bs({inputs:{real:$,imag:D},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo($),l.disposeIntermediateTensorInfo(D),P}else{const c=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,d=s||o.dtype,[f,m]=e(o.shape,a.shape,c,h,d);return l.makeTensorInfo(m,d,f)}}}function yk(t){return(e,n,s,i,r,o)=>{const a=ze(e,n),l=re(a),c=a.length,h=Te(a),d=Wn("float32",l),f=Wn("float32",l),m=uu(e,a),g=uu(n,a),v=lo(s,i),_=lo(r,o),x=e.length,w=Te(e),C=n.length,I=Te(n);if(m.length+g.length===0)for(let S=0;S<d.length;S++){const T=S%v.length,E=S%_.length,$=t(v[T*2],v[T*2+1],_[E*2],_[E*2+1]);d[S]=$.real,f[S]=$.imag}else for(let S=0;S<d.length;S++){const T=$u(S,c,h),E=T.slice(-x);m.forEach(H=>E[H]=0);const $=wr(E,x,w),D=T.slice(-C);g.forEach(H=>D[H]=0);const P=wr(D,C,I),z=t(v[$*2],v[$*2+1],_[P*2],_[P*2+1]);d[S]=z.real,f[S]=z.imag}return[d,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A3=Qt((t,e)=>t+e),Vse=yk((t,e,n,s)=>({real:t+n,imag:e+s})),pu=mn(Ru,A3,Vse),Gse={kernelName:Ru,backendName:"cpu",kernelFunc:pu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vk(t,e,n,s,i){const r=re(s),o=Vn(i,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=i||(r>0?o[l]+=e[a]:o[l]+=1)}return o}function D3(t,e,n,s=!1){const i=t.shape[0],r=t.shape[1],o=Ge([i,n],e.dtype);for(let a=0;a<i;a++)for(let l=0;l<r;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P3=Qt((t,e)=>t&e),jse=mn(eC,P3),Hse={kernelName:eC,backendName:"cpu",kernelFunc:jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Or(t){return(e,n,s)=>{const i=qt(n,e.length);for(let r=0;r<e.length;++r)i[r]=t(e[r],s);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mt(t,e,n){const s=Or(e);return ka(t,s,n)}function ka(t,e,n){return({inputs:s,attrs:i,backend:r})=>{const{x:o}=s;Ie(o,t);const a=r,l=a.data.get(o.dataId).values;let c;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=co(l)}else c=l;const h=n||o.dtype,d=e(c,h,i);return a.makeTensorInfo(o.shape,h,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3=Or(t=>Math.ceil(t)),qse=ka(ff,O3),Kse={kernelName:ff,backendName:"cpu",kernelFunc:qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(t,e,n,s){const i=qt(n,re(e));if(s&&n!=="string"){let r=0;t.forEach(o=>{const a=re(o.shape);i.set(o.vals,r),r+=a})}else{let r=0;t.forEach(o=>{const a=n==="string"?co(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const h=c*e[1]+r;for(let d=0;d<o.shape[1];++d)i[h+d]=a[l++]}r+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3=Qt((t,e)=>t===e?1:0),M3=mn(cv,F3,null,"bool"),Xse={kernelName:cv,backendName:"cpu",kernelFunc:M3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3=Or(t=>Math.exp(t)),B3=ka(_f,z3,"float32"),Zse={kernelName:_f,backendName:"cpu",kernelFunc:B3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U3=Or(t=>Math.expm1(t)),Yse=ka(wf,U3),Qse={kernelName:wf,backendName:"cpu",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W3=Or(t=>Math.floor(t)),Jse=ka(bf,W3),eie={kernelName:bf,backendName:"cpu",kernelFunc:Jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V3=Qt((t,e)=>Math.floor(t/e)),tie=mn(Cf,V3,null,"int32"),nie={kernelName:Cf,backendName:"cpu",kernelFunc:tie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3(t,e,n,s,i,r,o,a,l){const c=Ge([s,r],n);for(let h=0;h<s;h++){const d=[];let f=0;for(let m=0;m<i;m++){const g=t[h*i+m];f+=g*o[m],d.push(g)}if(f<0||f>=l/r)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let m=0;m<r;m++)c.values[h*r+m]=e.get(...e.indexToLoc(f*r+m))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j3(t,e,n){const s=Ge(n,t.dtype);for(let i=0;i<s.size;++i){const o=s.indexToLoc(i).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const h=t.locToIndex(o);0<=h&&h<t.values.length&&(s.values[i]=t.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3=Qt((t,e)=>t>e?1:0),sie=mn(fv,H3,null,"bool"),iie={kernelName:fv,backendName:"cpu",kernelFunc:sie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q3=Qt((t,e)=>t>=e?1:0),rie=mn(If,q3,null,"bool"),oie={kernelName:If,backendName:"cpu",kernelFunc:rie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3=Qt((t,e)=>t<e?1:0),aie=mn(mv,K3,null,"bool"),lie={kernelName:mv,backendName:"cpu",kernelFunc:aie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X3=Qt((t,e)=>t<=e?1:0),cie=mn(gv,X3,null,"bool"),uie={kernelName:gv,backendName:"cpu",kernelFunc:cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z3(t,e,n){const s=(e-t)/(n-1),i=Vn(n,"float32");i[0]=t;for(let r=1;r<i.length;r++)i[r]=i[r-1]+s;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y3=Or(t=>Math.log(t)),hie=ka(Nf,Y3),die={kernelName:Nf,backendName:"cpu",kernelFunc:hie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3(t,e,n,s){const i=Wn(s,re(n));for(let r=0;r<i.length;++r){const o=r*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}i[r]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J3=Qt((t,e)=>Math.max(t,e)),fie=mn(Rf,J3),pie={kernelName:Rf,backendName:"cpu",kernelFunc:fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ez=Qt((t,e)=>Math.min(t,e)),mie=mn(Af,ez),gie={kernelName:Af,backendName:"cpu",kernelFunc:mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xk=Qt((t,e)=>t*e),yie=yk((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),yx=mn(Pf,xk,yie),vie={kernelName:Pf,backendName:"cpu",kernelFunc:yx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(t,e,n){const s=ya(-1,n);return xk([],e,s,t,n)}function xie(t){const{inputs:e,backend:n}=t,{x:s}=e;Ie(s,"neg");const i=n.data.get(s.dataId).values,[r,o]=tz(i,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,r)}const _ie={kernelName:Tv,backendName:"cpu",kernelFunc:xie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nz=Qt((t,e)=>t!==e?1:0),wie=mn(Ev,nz,null,"bool"),bie={kernelName:Ev,backendName:"cpu",kernelFunc:wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _k(t,e,n,s,i){const r=e.length,o=re(e),a=Te(e),l=Te(i),c=Wn(n,re(i));for(let h=0;h<o;++h){const d=$u(h,r,a),f=new Array(d.length);for(let g=0;g<f.length;g++)f[g]=d[s[g]];const m=wr(f,r,l);c[m]=t[h]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ms(t){const{inputs:e,attrs:n,backend:s}=t,{x:i}=e,{perm:r}=n;Ie(i,"transpose");const o=i.shape.length,a=new Array(o);for(let d=0;d<a.length;d++)a[d]=i.shape[r[d]];const l=s.data.get(i.dataId).values,c=_k(l,i.shape,i.dtype,r,a);return{dataId:s.write(c,a,i.dtype),shape:a,dtype:i.dtype}}const Cie={kernelName:Hc,backendName:"cpu",kernelFunc:ms};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sz(t,e,n,s){const[i,r]=In(t,s),o=Ds(e,"int32"),a=Vn(re(i),o),l=re(r);for(let c=0;c<a.length;++c){const h=c*l;let d=1;for(let f=0;f<l;++f)d*=n[h+f];a[c]=d}return{outVals:a,outShape:i,outDtype:o}}function Iie(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"prod");const a=i.shape.length,l=je(r,i.shape),c=Bt(l,a);let h=l,d=i;const f=[];c!=null&&(d=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),f.push(d),h=Zt(h.length,a));const m=n.data.get(d.dataId).values,{outVals:g,outShape:v,outDtype:_}=sz(d.shape,d.dtype,m,h);let x=v;return o&&(x=sn(v,l)),f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(x,_,g)}const kie={kernelName:Pv,backendName:"cpu",kernelFunc:Iie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sie(t,e,n){t.forEach((s,i)=>{if(s<0||s>=n){const r=$u(i,e.length,Te(e)).join(",");throw new Error(`indices[${r}] = ${s} is not in [0, ${n})`)}})}function Tie(t,e){for(let n=0;n<t.length;++n){const s=t[n],i=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>i)throw new Error("Ragged splits must not point past values");for(let r=1;r<s.length;++r)if(s[r-1]>s[r])throw new Error("Ragged splits must be sorted in ascending order")}}function Eie(t,e,n,s){const i=[];let r=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);Tie(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const h=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*h)}for(let c=0;c<t.length;++c){let h=t[c],d=t[c]+1;for(let f=0;f<n.length;++f){const m=n[f],g=f+e.length-1;if(g>=0){const v=a[g],_=v[v.length-1]-m[h];for(let x=h;x<d;++x)a[g].push(m[x+1]+_)}h=m[h],d=m[d]}d!==h&&(i.push([h,d]),r+=d-h)}return{outSplits:a,valueSlices:i,numValues:r}}function Nie(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,i=qt("int32",s);e.push(i),t[n].forEach((r,o)=>i[o]=r)}return e}function R2(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function $ie(t,e,n,s,i,r){const o=R2(e,2)[1],a=R2(r,2)[1];let l=0;for(const c of n)for(let h=c[0];h<c[1];++h){for(let d=0;d<s;++d)i[l*a+d]=t[h*o+d];++l}}function Rie(t,e,n,s,i){const r=e.slice();r[0]=i;const o=qt(n,re(r)),a=t.length,l=a===0?0:a/e[0];return $ie(t,e,s,l,o,r),[o,r]}function iz(t,e,n,s,i,r,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(Sie(r,o,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:h,valueSlices:d,numValues:f}=Eie(r,o,t,c),m=Nie(h),g=Rie(n,s,i,d,f);return[m,g[0],g[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2=2147483647;function rz(t,e,n,s,i,r,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=i.length===0,c=o.length===0,h=[];a||h.push(e[0]),l||h.push(i[0]),c||h.push(o[0]);for(let _=1;_<h.length;++_)if(h[_]!==h[_-1])throw new Error("starts, limits, and deltas must have the same shape");const d=h.length===0?1:h[0],f=qt("int32",d+1);f[0]=0;for(let _=0;_<d;++_){const x=a?t[0]:t[_],w=l?s[0]:s[_],C=c?r[0]:r[_];if(C===0)throw new Error("Requires delta != 0");let I;if(C>0&&w<x||C<0&&w>x)I=0;else if(I=Math.ceil(Math.abs((w-x)/C)),I>A2)throw new Error(`Requires ((limit - start) / delta) <= ${A2}`);f[_+1]=f[_]+I}const m=f[d],g=qt(n,m);let v=0;for(let _=0;_<d;++_){const x=f[_+1]-f[_];let w=a?t[0]:t[_];const C=c?r[0]:r[_];for(let I=0;I<x;++I)g[v++]=w,w+=C}return[f,g]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ii=Fi;class ey{constructor(e,n,s,i,r,o,a,l,c,h){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=i,this.valuesDType=r,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=qL(h),this.raggedRank=KL(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ii.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ii.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ii.VALUE_ROWIDS:return ey.getMaxWidthValueRowID(n);case ii.ROW_SPLITS:return ey.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ii[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let i=0;i<n-1;++i){const r=e[i+1]-e[i];r>s&&(s=r)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,i=e[0],r=0;for(let o=1;o<n;++o){const a=e[o];a!==i&&(i=a,r=Math.max(o-s,r),s=o)}return Math.max(n-s,r)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return P2(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;XL(s,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=HL(this.raggedRank,i,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const i=Math.min(e,s),r=[];let o=0;for(let a=0;a<i;++a,o+=n)r.push(o);for(let a=i;a<e;++a)r.push(-1);return R(r.length===e,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(e,n,s,i){const r=e.length,o=[];for(let a=0;a<r-1;++a){const l=e[a+1]-e[a];let c=Math.min(i,l),h=n[a];h===-1&&(c=0);for(let d=0;d<c;++d)o.push(h),h+=s;for(let d=0;d<l-c;++d)o.push(-1)}if(r>0&&o.length!==e[r-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,i){const r=e.length,o=[];if(r===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];o.push(c);for(let h=1;h<r;++h){const d=e[h];if(d===l)c>=0&&(++a,a<i?c+=s:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,i){const r=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ii.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,n,s,i);case ii.ROW_SPLITS:if(r.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${r.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(r,n,s,i);default:throw new Error(`Unsupported partition type: ${ii[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case ii.FIRST_DIM_SIZE:return e[0];case ii.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ii.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ii[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let l=i.length-2;l>=0;--l)i[l]=i[l+1]*s[l+1];const r=P2(s,!1),o=qt(this.valuesDType,re(r));if(i[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,i[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,i[c],s[c]);this.setOutput(this.raggedRank,l,o,r)}return[r,o]}setOutput(e,n,s,i){if(s.length===0)return;const r=this.values,o=s;let a=i.slice();a=a.slice(e+1);const l=re(a),c=n.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const g=this.defaultValueShape;X(()=>{const v=G(h,g);h=Zh(v,a).dataSync()})}let d=0,f=0,m=0;for(let g=0;g<=c;++g){let v=g<c?n[g]:-1;if(v===m){++m;continue}if(f<m){const _=r.subarray(d*l),x=o.subarray(f*l),w=(m-f)*l;D2(x,_,w)}if(g>=c){const _=s.length;v=Math.floor(_/l)}if(v>m)if(this.defaultValue.length===1)o.subarray(m*l,v*l).fill(this.defaultValue[0]),m=v;else for(;v>m;){const _=o.slice(m*l);D2(_,h,l),++m}v<0?(d=g+1,f=m):(d=g,f=m,m=f+1)}}}function D2(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function P2(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function oz(t,e,n,s,i,r,o,a,l,c){return new ey(t,e,n,s,i,r,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(t,e,n,s){const i=t===e,r=t<e&&n<0,o=e<t&&n>1;if(i||r||o)return Vn(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=Vn(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lz=Or(t=>1/Math.sqrt(t)),Aie=ka(Bf,lz),Die={kernelName:Bf,backendName:"cpu",kernelFunc:Aie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function el(t,e,n,s,i,r,o,a,l,c){const h=[s/i,i],d=t.values,f=e.values;if(s===0)return Ge(n,e.dtype);const m=l instanceof An?l:Ge(h,e.dtype);typeof l=="string"||typeof l=="number"?m.values.fill(l):typeof l=="boolean"&&m.values.fill(+l);for(let g=0;g<r;g++){const v=[];let _=0;for(let x=0;x<o;x++){const w=d[g*o+x];v.push(w),_+=w*a[x]}if(_<0||_>=s/i)throw new Error(`Invalid indices: ${v} does not index into ${n}`);for(let x=0;x<i;x++)c?m.values[_*i+x]+=f[g*i+x]:m.values[_*i+x]=e.rank===0?f[0]:f[g*i+x]}return m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pie=Or(t=>1/(1+Math.exp(-t))),cz=mt(jf,t=>1/(1+Math.exp(-t))),Oie={kernelName:jf,backendName:"cpu",kernelFunc:cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(t,e,n,s,i){const r=kI(s,e,n),o=re(n),a=Te(s);if(r){const d=SI(e,a);return i==="string"?t.slice(d,d+o):t.subarray(d,d+o)}const l=i==="string"?co(t):t,c=Ge(s,i,l),h=Ge(n,i);for(let d=0;d<h.size;++d){const f=h.indexToLoc(d),m=f.map((g,v)=>g+e[v]);h.set(c.get(...m),...f)}return i==="string"?mF(h.values):h.values}function Rl(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,size:o}=s;Ie(i,"slice");const[a,l]=tx(i,r,o);CI(i,a,l);const c=n.data.get(i.dataId).values,h=uz(c,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,h)}const Lie={kernelName:Bv,backendName:"cpu",kernelFunc:Rl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(t,e,n,s,i,r,o){const a=e[0],l=r[0],c=new Array(l),h=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(nF(a));const _=qt(n,0),x=qt(i,0);return[_,[0,d],x,c,h]}let f=!0,m=0;const g=new Array(l).fill(0);for(let _=0;_<a;++_){const x=t[_*d];if(x<0)throw new Error(sF(_,x));if(x>=l)throw new Error(iF(_,x,l));++g[x],f=f&&x>=m,m=x}let v=!0;for(let _=0;_<l;++_){const x=g[_]===0;c[_]=x,v=v&&!x,g[_]=Math.max(g[_],1),_>0&&(g[_]+=g[_-1])}if(v&&f){const _=t,x=s;for(let w=0;w<a;++w)h[w]=w;return[_,[a,d],x,c,h]}else{const _=g[l-1],x=qt(n,_*d),w=qt(i,_),C=new Array(l).fill(0);for(let I=0;I<a;++I){const S=t[I*d],T=C[S],E=(S===0?0:g[S-1])+T;C[S]++;for(let $=0;$<d;++$)x[E*d+$]=t[I*d+$];w[E]=s[I],h[I]=E}for(let I=0;I<l;++I)if(C[I]===0){const T=I===0?0:g[I-1];x[T*d+0]=I;for(let E=1;E<d;++E)x[T*d+E]=0;w[T]=o}return[x,[_,d],w,c,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dz(t,e,n,s,i){const r=re(s),o=e[0],a=i.length,l=[];let c=1,h=-1;for(let _=0;_<a;++_){const x=i[_];if(x===-1){if(h!==-1)throw new Error(rF(h,_));h=_,l.push(1)}else{if(x<0)throw new Error(oF(_,x));c*=x,l.push(x)}}if(h!==-1){if(c<=0)throw new Error(aF());const _=Math.trunc(r/c);if(c*_!==r)throw new Error(lF(s,l));l[h]=_}if(re(l)!==r)throw new Error(cF(s,l));const f=s.length,m=[];if(f>0){m[f-1]=1;for(let _=f-2;_>=0;--_)m[_]=m[_+1]*s[_+1]}const g=[];if(a>0){g[a-1]=1;for(let _=a-2;_>=0;--_)g[_]=g[_+1]*l[_+1]}const v=qt(n,o*a);for(let _=0;_<o;++_){let x=0;for(let w=0;w<f;++w)x+=t[_*f+w]*m[w];for(let w=0;w<a;++w)v[_*a+w]=Math.trunc(x/g[w]),x%=g[w]}return[v,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wk(t,e,n,s,i,r=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?i[a-1]+1:0;if(d<0)throw new Error(q0());const f=e.slice();f[0]=d;const m=f.reduce((C,I)=>C*I,1),g=qt(n,m);if(a===0)return d>0&&g.fill(o),[g,f];if(d<=0)throw new Error(q0());let v=0,_=1,x=0,w=i[v];for(;;){let C=0;if(_<a){if(C=i[_],w===C){++_;continue}if(w>=C)throw new Error(uF())}if(w<0||w>=d)throw new Error(hF(w,d));w>x&&g.fill(o,x*c,w*c);for(let I=v;I<_;++I){const S=s[I];if(S<0||S>=l[0])throw new Error(dF(I,s[I],l[0]));for(let T=0;T<c;T++)g[w*c+T]+=t[S*c+T]}if(r)for(let I=0;I<c;I++)g[w*c+I]/=_-v;if(v=_,++_,x=w+1,w=C,_>a)break}return x<d&&g.fill(o,x*c,d*c),[g,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fie=Or(t=>Math.sqrt(t)),Mie=mt(qf,t=>Math.sqrt(t)),zie={kernelName:qf,backendName:"cpu",kernelFunc:Mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fz=Qt((t,e)=>{const n=t-e;return n*n}),Bie=mn(Kf,fz),Uie={kernelName:Kf,backendName:"cpu",kernelFunc:Bie};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pz=Or((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:i}=e;return t.replace(new RegExp(n,s?"g":""),i)}),Wie=ka(NC,pz),Vie={kernelName:NC,backendName:"cpu",kernelFunc:Wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mz(t,e,n,s){const i=Ge(t,e.dtype);for(let r=0;r<i.size;r++){const o=i.indexToLoc(r),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];i.set(e.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gie{constructor(e,n,s,i,r,o){this.separator=Xo(e),this.nGramWidths=n,this.leftPad=Xo(s),this.rightPad=Xo(i),this.padWidth=r,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,i,r,o){for(let a=0;a<r;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),h=Math.max(0,l-(r-(a+1))),d=o-(c+h),f=n+(c>0?0:a-l);let m=0;m+=c*this.leftPad.length;for(let w=0;w<d;++w)m+=e[f+w].length;m+=h*this.rightPad.length;const g=c+h+d-1;m+=g*this.separator.length,s[i+a]=new Uint8Array(m);const v=s[i+a];let _=0;const x=w=>w.forEach(C=>v[_++]=C);for(let w=0;w<c;++w)x(this.leftPad),x(this.separator);for(let w=0;w<d-1;++w)x(e[f+w]),x(this.separator);if(d>0){x(e[f+d-1]);for(let w=0;w<h;++w)x(this.separator),x(this.rightPad)}else{for(let w=0;w<h-1;++w)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(e,n){const s=e.length,i=n.length;if(i>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<i;++c){let h=n[c]>=l;if(h=h&&n[c]<=s,!h)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const r=i-1,o=qt("int32",i);if(s===0||i===0){const l=new Array(s);for(let c=0;c<=r;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=r;++l){const c=n[l]-n[l-1];let h=0;this.nGramWidths.forEach(d=>{h+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&h===0&&(h=1),o[l]=o[l-1]+h}const a=new Array(o[r]);for(let l=0;l<r;++l){const c=n[l];let h=o[l];if(this.nGramWidths.forEach(d=>{const f=n[l+1]-n[l],m=this.getNumNGrams(f,d);this.createNGrams(e,c,a,h,m,d),h+=m}),this.preserveShort&&h===o[l]){const d=n[l+1]-n[l];if(d===0)continue;const f=d+2*this.padWidth;this.createNGrams(e,c,a,h,1,f)}}return[a,o]}}function gz(t,e,n,s,i,r,o,a){return new Gie(n,s,i,r,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(t,e,n,s){if(!t.length)return;if(e.length===0){for(let r=0;r<t.length;++r)s.push(t.subarray(r,r+1));return}if(e.length===1){const r=e[0];let o=t.indexOf(r);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(r)}(!n||t.length!==0)&&s.push(t);return}let i=0;for(let r=0;r<t.length+1;r++)if(r===t.length||e.indexOf(t[r])!==-1){const o=t.subarray(i,r);(!n||o.length!==0)&&s.push(o),i=r+1}}function yz(t,e,n){const s=t.length,i=[];let r=0,o=0;const a=new Array(s);for(let f=0;f<s;++f){const m=i.length;jie(t[f],e,n,i);const g=i.length-m;a[f]=g,r+=g,o=Math.max(o,g)}const l=qt("int32",r*2),c=new Array(r),h=[s,o];let d=0;for(let f=0;f<s;++f)for(let m=0;m<a[f];++m)l[d*2]=f,l[d*2+1]=m,c[d]=i[d],++d;return[l,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(t,e){const n=qt("int32",t.length);for(let s=0;s<t.length;++s)n[s]=tX(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xz=Qt((t,e)=>t-e),Hie=yk((t,e,n,s)=>({real:t-n,imag:e-s})),bk=mn(Xf,xz,Hie),qie={kernelName:Xf,backendName:"cpu",kernelFunc:bk};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _z(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const s=Ge(n,t.dtype);for(let i=0;i<s.values.length;++i){const r=s.indexToLoc(i),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=r[l]%t.shape[l];const a=t.locToIndex(o);s.values[i]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oh=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function wz(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*Math.sign(l-a/2),f=Math.max(n,Math.floor(e-l*h/a+d)),m=Math.min(s,Math.floor(e+(a-l)*h/a+d));wz(t,e,f,m)}const i=t[e];let r=n,o=s;for(vc(t,n,e),Oh(t[s],i)>0&&vc(t,n,s);r<o;){for(vc(t,r,o),r++,o--;Oh(t[r],i)<0;)r=r+1;for(;Oh(t[o],i)>0;)o=o-1}Oh(t[n],i)===0?vc(t,n,o):(o=o+1,vc(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function bz(t,e,n,s,i){const r=e[e.length-1],[o,a]=[t.length/r,r],l=Wn(n,o*s),c=Wn("int32",o*s);for(let d=0;d<o;d++){const f=d*a,m=t.subarray(f,f+a);let g=new Array(m.length);m.forEach((w,C)=>g[C]={value:w,index:C}),s<g.length&&(wz(g,s),g=g.slice(0,s)),i&&g.sort(Oh);const v=d*s,_=l.subarray(v,v+s),x=c.subarray(v,v+s);for(let w=0;w<s;w++)_[w]=g[w].value,x[w]=g[w].index}const h=e.slice();return h[h.length-1]=s,[Ge(h,n,l),Ge(h,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(t,e,n,s){const i=je(e,n)[0],r=[1,n[0],1];for(let g=0;g<i;g++)r[0]*=n[g];r[1]=n[i];for(let g=i+1;g<n.length;g++)r[2]*=n[g];const o=new Map,a=new Int32Array(n[i]),l=new An(r,s,t),c=[],h=r[0]===1&&r[2]===1;for(let g=0;g<n[i];g++){let v;if(h)v=t[g].toString();else{const x=[];for(let w=0;w<r[0];w++)for(let C=0;C<r[2];C++)x.push(l.get(w,g,C));v=x.join(",")}const _=o.get(v);if(_!=null)a[g]=_;else{const x=o.size;o.set(v,x),a[g]=x,c.push(g)}}const d=r.slice();d[1]=o.size;const f=new An(d,s);c.forEach((g,v)=>{for(let _=0;_<r[0];_++)for(let x=0;x<r[2];x++)f.set(l.get(_,g,x),_,v,x)});const m=n.slice();return m[i]=d[1],{outputValues:f.values,outputShape:m,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kie=Object.freeze(Object.defineProperty({__proto__:null,addImpl:A3,bincountImpl:vk,bincountReduceImpl:D3,bitwiseAndImpl:P3,castImpl:R3,ceilImpl:O3,concatImpl:L3,equalImpl:F3,expImpl:z3,expm1Impl:U3,floorDivImpl:V3,floorImpl:W3,gatherNdImpl:G3,gatherV2Impl:j3,greaterEqualImpl:q3,greaterImpl:H3,lessEqualImpl:X3,lessImpl:K3,linSpaceImpl:Z3,logImpl:Y3,maxImpl:Q3,maximumImpl:J3,minimumImpl:ez,multiplyImpl:xk,negImpl:tz,notEqualImpl:nz,prodImpl:sz,raggedGatherImpl:iz,raggedRangeImpl:rz,raggedTensorToTensorImpl:oz,rangeImpl:az,rsqrtImpl:lz,scatterImpl:el,sigmoidImpl:Pie,simpleAbsImpl:$3,sliceImpl:uz,sparseFillEmptyRowsImpl:hz,sparseReshapeImpl:dz,sparseSegmentReductionImpl:wk,sqrtImpl:Fie,squaredDifferenceImpl:fz,staticRegexReplaceImpl:pz,stridedSliceImpl:mz,stringNGramsImpl:gz,stringSplitImpl:yz,stringToHashBucketFastImpl:vz,subImpl:xz,tileImpl:_z,topKImpl:bz,transposeImpl:_k,uniqueImpl:Cz},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */VO("cpu",()=>new gx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iz=mt(vf,t=>t>=0?t:Math.exp(t)-1),Xie={kernelName:vf,backendName:"cpu",kernelFunc:Iz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:r}=s;Ie([i],"leakyRelu");const o=re(i.shape),a=n.data.get(i.dataId).values,l=Wn("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?r*a[c]:a[c];return n.makeTensorInfo(i.shape,"float32",l)}const Zie={kernelName:pv,backendName:"cpu",kernelFunc:kz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yie=Qt((t,e)=>t<0?e*t:t);function Sz(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e;Ie([s,i],"prelu");const r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,[a,l]=Yie(s.shape,i.shape,r,o,"float32");return n.makeTensorInfo(l,"float32",a)}const Qie={kernelName:Dv,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tz=mt(Ff,t=>Math.max(0,t)),Jie={kernelName:Ff,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ez=mt(Mf,t=>Math.min(Math.max(0,t),6)),ere={kernelName:Mf,backendName:"cpu",kernelFunc:Ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ty(t,e,n,s,i){if(n==="linear")return Ar({inputs:{x:e},backend:t});if(n==="relu")return Tz({inputs:{x:e},backend:t});if(n==="elu")return Iz({inputs:{x:e},backend:t});if(n==="relu6")return Ez({inputs:{x:e},backend:t});if(n==="prelu")return Sz({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return kz({inputs:{x:e},backend:t,attrs:{alpha:i}});if(n==="sigmoid")return cz({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function It(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:r}=s,o=re(i.shape),a=XP(r,o),l=re(a);R(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const c=n.data.get(i.dataId);if(c.complexTensorInfos!=null){const h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;h.shape=a,d.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const tre={kernelName:Ov,backendName:"cpu",kernelFunc:It};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r}=e,{transposeA:o,transposeB:a}=s;Ie([i,r],"matMul");const l=i.shape.length,c=r.shape.length,h=o?i.shape[l-2]:i.shape[l-1],d=a?r.shape[c-1]:r.shape[c-2],f=o?i.shape[l-1]:i.shape[l-2],m=a?r.shape[c-2]:r.shape[c-1],g=i.shape.slice(0,-2),v=r.shape.slice(0,-2),_=re(g),x=re(v),C=ze(i.shape.slice(0,-2),r.shape.slice(0,-2)).concat([f,m]);R(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${i.shape} and ${r.shape} and transposeA=${o} and transposeB=${a} must match.`);const I=o?[_,h,f]:[_,f,h],S=a?[x,m,d]:[x,d,m],T=It({inputs:{x:i},backend:n,attrs:{shape:I}}),E=It({inputs:{x:r},backend:n,attrs:{shape:S}}),$=o?T.shape[1]:T.shape[2],D=o?T.shape[2]:T.shape[1],P=a?E.shape[1]:E.shape[2],z=Math.max(_,x),H=n.data.get(T.dataId).values,Q=n.data.get(E.dataId).values,Z=Te(T.shape),J=Te(E.shape),[Y,oe,O]=o?[Z[0],1,Z[1]]:[Z[0],Z[1],1],[q,V,te]=a?[1,J[1],J[0]]:[J[1],1,J[0]],ae=D*P,ue=Ge([z,D,P],T.dtype),he=ue.values,le=n.blockSize;for(let ce=0;ce<z;ce++){const we=ce%_,Se=ce%x;for(let Ee=0;Ee<D;Ee+=le){const Fe=Math.min(Ee+le,D);for(let Me=0;Me<P;Me+=le){const Qe=Math.min(Me+le,P);for(let ut=0;ut<$;ut+=le){const Rt=Math.min(ut+le,$);for(let dt=Ee;dt<Fe;dt++)for(let ot=Me;ot<Qe;ot++){let vt=0;for(let ft=ut;ft<Rt;ft++){const Ii=H[we*Y+dt*oe+ft*O],Jt=Q[ft*q+ot*V+Se*te];vt+=Ii*Jt}he[ce*ae+(dt*P+ot)]+=vt}}}}}return n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(E),n.makeTensorInfo(C,ue.dtype,ue.values)}const nre={kernelName:Jy,backendName:"cpu",kernelFunc:Nz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:d}=s;let f,m,g;const v=[];f=Nz({inputs:{a:i,b:r},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(m=pu({inputs:{a:f,b:o},backend:n}),v.push(f),f=m),h&&(g=ty(n,f,h,a,d),v.push(f),f=g);for(const x of v)n.disposeIntermediateTensorInfo(x);return f}const ire={kernelName:Ag,backendName:"cpu",kernelFunc:sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rre=mt(rf,t=>Math.acos(t)),ore={kernelName:rf,backendName:"cpu",kernelFunc:rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are=mt(of,t=>Math.acosh(t)),lre={kernelName:of,backendName:"cpu",kernelFunc:are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(t){const{inputs:e,backend:n}=t,s=e;Ie(e,"addN");const i=s.map(a=>n.data.get(a.dataId).values),r=Ge(s[0].shape,s[0].dtype),o=r.values;for(let a=0;a<s.length;a++){const l=i[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return n.makeTensorInfo(r.shape,r.dtype,r.values)}const ure={kernelName:K1,backendName:"cpu",kernelFunc:cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"all");const a=je(r,i.shape);let l=a;const c=Bt(l,i.shape.length);let h=i;c!=null&&(h=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Zt(l.length,i.shape.length)),On("all",l,h.shape.length);const[d,f]=In(h.shape,l),m=re(f),g=Vn(re(d),h.dtype),v=n.data.get(h.dataId).values;for(let x=0;x<g.length;++x){const w=x*m;let C=v[w];for(let I=0;I<m;++I){const S=v[w+I];C=C&&S}g[x]=C}c!=null&&n.disposeIntermediateTensorInfo(h);const _=n.makeTensorInfo(d,h.dtype,g);if(o){const x=sn(d,a),w=It({inputs:{x:_},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(_),w}return _}const dre={kernelName:X1,backendName:"cpu",kernelFunc:hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"any");const a=je(r,i.shape);let l=a;const c=Bt(l,i.shape.length);let h=i;c!=null&&(h=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Zt(l.length,i.shape.length)),On("any",l,h.shape.length);const[d,f]=In(h.shape,l),m=re(f),g=Vn(re(d),h.dtype),v=n.data.get(h.dataId).values;for(let x=0;x<g.length;++x){const w=x*m;let C=v[w];for(let I=0;I<m;++I){const S=v[w+I];C=C||S}g[x]=C}c!=null&&n.disposeIntermediateTensorInfo(h);const _=n.makeTensorInfo(d,h.dtype,g);if(o){const x=sn(d,a),w=It({inputs:{x:_},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(_),w}return _}const pre={kernelName:Z1,backendName:"cpu",kernelFunc:fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;Ie(i,"argMax");let o=je(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=ms({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),o=[o[0]],On("argMax",o,l.shape.length);const[h,d]=In(l.shape,o),f=re(h),m=Vn(f,"int32"),g=re(d),v=n.data.get(l.dataId).values;for(let _=0;_<m.length;++_){const x=_*g;let w=v[x],C=0;for(let I=0;I<g;++I){const S=v[x+I];S>w&&(w=S,C=I)}m[_]=C}return c.forEach(_=>n.disposeIntermediateTensorInfo(_)),n.makeTensorInfo(h,"int32",m)}const gre={kernelName:Xy,backendName:"cpu",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;Ie(i,"argMin");let o=je(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=ms({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),o=[o[0]],On("argMin",o,l.shape.length);const[h,d]=In(l.shape,o),f=re(h),m=Vn(f,"int32"),g=re(d),v=n.data.get(l.dataId).values;for(let _=0;_<m.length;++_){const x=_*g;let w=v[x],C=0;for(let I=0;I<g;++I){const S=v[x+I];S<w&&(w=S,C=I)}m[_]=C}return c.forEach(_=>n.disposeIntermediateTensorInfo(_)),n.makeTensorInfo(h,"int32",m)}const vre={kernelName:Zy,backendName:"cpu",kernelFunc:yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xre=mt(af,t=>Math.asin(t)),_re={kernelName:af,backendName:"cpu",kernelFunc:xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre=mt(lf,t=>Math.asinh(t)),bre={kernelName:lf,backendName:"cpu",kernelFunc:wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre=mt(cf,t=>Math.atan(t)),Ire={kernelName:cf,backendName:"cpu",kernelFunc:Cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kre=Qt((t,e)=>Math.atan2(t,e)),Sre=mn(hf,kre),Tre={kernelName:hf,backendName:"cpu",kernelFunc:Sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ere=mt(uf,t=>Math.atanh(t)),Nre={kernelName:uf,backendName:"cpu",kernelFunc:Ere};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ck(t,e,n,s,i,r){const o=i.strideHeight,a=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=i.padInfo.top,m=i.padInfo.left,g=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Ge(i.outShape,n),_=v.values,x=i.outShape[1]*i.outShape[2]*i.outShape[3],w=i.outShape[2]*i.outShape[3],C=i.outShape[3];for(let I=0;I<i.batchSize;++I){const S=I*x,T=I*s[0];for(let E=0;E<i.inChannels;++E)for(let $=0;$<i.outHeight;++$){const D=$*o-f,P=Math.max(0,D),z=Math.min(i.inHeight,h+D),H=S+$*w;for(let Q=0;Q<i.outWidth;++Q){const Z=Q*a-m,J=Math.max(0,Z),Y=Math.min(i.inWidth,d+Z);let oe=g,O=0,q=0;for(let te=P;te<z;te+=l){const ae=T+te*s[1];for(let ue=J;ue<Y;ue+=c){const he=ae+ue*s[2],le=t[he+E];r==="max"&&le>oe?oe=le:r==="avg"&&(O+=le,q++)}if(isNaN(oe))break}const V=H+Q*C+E;_[V]=r==="avg"?O/q:oe}}}return v}function $z(t,e,n,s,i=!1,r=!1){const o=Ge(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,h=s.dilationWidth,d=s.effectiveFilterHeight,f=s.effectiveFilterWidth,m=s.padInfo.top,g=s.padInfo.left,v=Ge(e,n,t);for(let _=0;_<s.batchSize;++_)for(let x=0;x<s.inChannels;++x)for(let w=0;w<s.outHeight;++w){const C=w*a-m;let I=C;for(;I<0;)I+=c;const S=Math.min(s.inHeight,d+C);for(let T=0;T<s.outWidth;++T){const E=T*l-g;let $=E;for(;$<0;)$+=h;const D=Math.min(s.inWidth,f+E);let P=Number.NEGATIVE_INFINITY,z=-1;for(let H=I;H<S;H+=c){const Q=H-C;for(let Z=$;Z<D;Z+=h){const J=Z-E,Y=v.get(_,H,Z,x);Y>P&&(P=Y,i?z=r?((_*s.inHeight+H)*s.inWidth+Z)*s.inChannels+x:(H*s.inWidth+Z)*s.inChannels+x:z=Q*f+J)}}o.set(z,_,w,T,x)}}return o}function Rz(t,e,n,s,i,r){const o=i.strideDepth,a=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,f=i.effectiveFilterDepth,m=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=i.padInfo.front,_=i.padInfo.top,x=i.padInfo.left,w=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=Ge(i.outShape,n),I=C.values,S=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],T=i.outShape[2]*i.outShape[3]*i.outShape[4],E=i.outShape[3]*i.outShape[4],$=i.outShape[4];for(let D=0;D<i.batchSize;++D){const P=D*S,z=D*s[0];for(let H=0;H<i.inChannels;++H)for(let Q=0;Q<i.outDepth;++Q){const Z=Q*o-v;let J=Z;for(;J<0;)J+=c;const Y=Math.min(i.inDepth,f+Z),oe=P+Q*T;for(let O=0;O<i.outHeight;++O){const q=O*a-_;let V=q;for(;V<0;)V+=h;const te=Math.min(i.inHeight,m+q),ae=oe+O*E;for(let ue=0;ue<i.outWidth;++ue){const he=ue*l-x;let le=he;for(;le<0;)le+=d;const ce=Math.min(i.inWidth,g+he),we=ae+ue*$;let Se=w,Ee=0,Fe=0;for(let Qe=J;Qe<Y;Qe+=c){const ut=z+Qe*s[1];for(let Rt=V;Rt<te;Rt+=h){const dt=ut+Rt*s[2];for(let ot=le;ot<ce;ot+=d){const vt=dt+ot*s[3],ft=t[vt+H];if(r==="max"&&ft>Se?Se=ft:r==="avg"&&(Ee+=ft,Fe++),isNaN(Se))break}if(isNaN(Se))break}if(isNaN(Se))break}const Me=we+H;I[Me]=r==="avg"?Ee/Math.max(Fe,1):Se}}}}return C}function $re(t,e){const n=Ge(e.outShape,"int32"),s=e.strideDepth,i=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;for(let v=0;v<e.batchSize;++v)for(let _=0;_<e.inChannels;++_)for(let x=0;x<e.outDepth;++x){const w=x*s-f;let C=w;for(;C<0;)C+=o;const I=Math.min(e.inDepth,c+w);for(let S=0;S<e.outHeight;++S){const T=S*i-m;let E=T;for(;E<0;)E+=a;const $=Math.min(e.inHeight,h+T);for(let D=0;D<e.outWidth;++D){const P=D*r-g;let z=P;for(;z<0;)z+=l;const H=Math.min(e.inWidth,d+P);let Q=Number.NEGATIVE_INFINITY,Z=-1;for(let J=C;J<I;J+=o){const Y=J-w;for(let oe=E;oe<$;oe+=a){const O=oe-T;for(let q=z;q<H;q+=l){const V=q-P,te=t.get(v,J,oe,q,_);te>=Q&&(Q=te,Z=Y*h*d+O*h+V)}}}n.set(Z,v,x,S,D,_)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;Ie(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(jn(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=wi(i.shape,r,o,c,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))d=Ar({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,m=Te(i.shape),g=Ck(f,i.shape,i.dtype,m,h,"avg");d=n.makeTensorInfo(h.outShape,i.dtype,g.values)}return d}const Are={kernelName:Yy,backendName:"cpu",kernelFunc:Rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;Ie(i,"avgPool3d");const h=mo(i.shape,r,o,1,a,l,c),d=n.data.get(i.dataId).values,f=Rz(d,i.shape,i.dtype,Te(i.shape),h,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const Pre={kernelName:Qy,backendName:"cpu",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ore(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;Ie([i,r],"avgPool3DGrad");const h=mo(r.shape,o,a,1,l,c),d=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.filterDepth,v=h.filterHeight,_=h.filterWidth,x=h.dilationDepth,w=h.dilationHeight,C=h.dilationWidth,I=h.effectiveFilterDepth,S=h.effectiveFilterHeight,T=h.effectiveFilterWidth,E=I-1-h.padInfo.front,$=T-1-h.padInfo.left,D=S-1-h.padInfo.top,P=Ge(r.shape,"float32"),z=1/(g*v*_),H=n.bufferSync(i);for(let Q=0;Q<h.batchSize;++Q)for(let Z=0;Z<h.inChannels;++Z)for(let J=0;J<h.inDepth;++J)for(let Y=0;Y<h.inHeight;++Y)for(let oe=0;oe<h.inWidth;++oe){const O=J-E,q=Y-D,V=oe-$;let te=0;for(let ae=0;ae<I;ae+=x){const ue=(O+ae)/d;if(!(ue<0||ue>=h.outDepth||Math.floor(ue)!==ue))for(let he=0;he<S;he+=w){const le=(q+he)/f;if(!(le<0||le>=h.outHeight||Math.floor(le)!==le))for(let ce=0;ce<T;ce+=C){const we=(V+ce)/m;if(we<0||we>=h.outWidth||Math.floor(we)!==we)continue;const Se=H.get(Q,ue,le,we,Z);te+=Se}}}P.set(te*z,Q,J,Y,oe,Z)}return n.makeTensorInfo(P.shape,P.dtype,P.values)}const Lre={kernelName:Q1,backendName:"cpu",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r;Ie([i,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,h=wi(o.shape,a,l,1,c),d=h.strideHeight,f=h.strideWidth,m=h.filterHeight,g=h.filterWidth,v=h.dilationHeight,_=h.dilationWidth,x=h.effectiveFilterHeight,w=h.effectiveFilterWidth,C=w-1-h.padInfo.left,I=x-1-h.padInfo.top,S=Ge(o.shape,"float32"),T=1/(m*g),E=n.data.get(i.dataId).values,$=Ge(i.shape,"float32",E);for(let D=0;D<h.batchSize;++D)for(let P=0;P<h.inChannels;++P)for(let z=0;z<h.inHeight;++z)for(let H=0;H<h.inWidth;++H){const Q=z-I,Z=H-C;let J=0;for(let Y=0;Y<x;Y+=v){const oe=(Q+Y)/d;if(!(oe<0||oe>=h.outHeight||Math.floor(oe)!==oe))for(let O=0;O<w;O+=_){const q=(Z+O)/f;if(q<0||q>=h.outWidth||Math.floor(q)!==q)continue;const V=$.get(D,oe,q,P);J+=V}}S.set(J*T,D,z,H,P)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const Mre={kernelName:Y1,backendName:"cpu",kernelFunc:Fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,scale:r,offset:o,mean:a,variance:l}=e;R(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(r==null||a.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ie([i,a,l,r,o],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const h=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,m=r?n.data.get(r.dataId).values:new Float32Array([1]),g=o?n.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(h.length),_=g.length,x=m.length,w=f.length,C=d.length;let I=0,S=0,T=0,E=0;for(let $=0;$<h.length;++$)v[$]=g[I++]+(h[$]-d[S++])*m[T++]/Math.sqrt(f[E++]+c),I>=_&&(I=0),S>=C&&(S=0),T>=x&&(T=0),E>=w&&(E=0);return n.makeTensorInfo(i.shape,i.dtype,v)}const Bre={kernelName:hv,backendName:"cpu",kernelFunc:zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,crops:o}=s;Ie([i],"batchToSpaceND");const a=r.reduce((x,w)=>x*w),l=ap(i.shape,r,a),c=lp(l.length,r.length),h=cp(i.shape,r,a),d=RI(o,r.length),f=AI(h,o,r.length),m=It({inputs:{x:i},backend:n,attrs:{shape:l}}),g=ms({inputs:{x:m},backend:n,attrs:{perm:c}}),v=It({inputs:{x:g},backend:n,attrs:{shape:h}}),_=Rl({inputs:{x:v},backend:n,attrs:{begin:d,size:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),_}const Wre={kernelName:ev,backendName:"cpu",kernelFunc:Ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o}=s,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=vk(a,l,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,c)}const Gre={kernelName:J1,backendName:"cpu",kernelFunc:Vre};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(t){const{inputs:e,backend:n}=t,{s0:s,s1:i}=e,r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,a=ze(Array.from(r),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Hre={kernelName:tO,backendName:"cpu",kernelFunc:jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qre=mt(pf,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),Kre={kernelName:pf,backendName:"cpu",kernelFunc:qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xre=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(re(e.shape)),i=n.data.get(e.dataId),r=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const h=a[c],d=l[c];s[c]=Math.hypot(h,d)}return n.makeOutput(s,e.shape,"float32")},Zre={kernelName:tv,backendName:"cpu",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mu(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.imag,r=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,r)}const Yre={kernelName:yC,backendName:"cpu",kernelFunc:mu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gu(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,r=je(i,e[0].shape)[0],o=e.map(v=>v.shape);EI(o,r);let a=Cr(e.map(v=>v.shape),r);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(v=>re(v.shape)>0);if(l.length===1)return Ar({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const v=l.map(I=>$l({inputs:{input:I},backend:n})),_=l.map(I=>mu({inputs:{input:I},backend:n})),x=gu({inputs:v,backend:n,attrs:{axis:r}}),w=gu({inputs:_,backend:n,attrs:{axis:r}}),C=bs({inputs:{real:x,imag:w},backend:n});return v.forEach(I=>n.disposeIntermediateTensorInfo(I)),_.forEach(I=>n.disposeIntermediateTensorInfo(I)),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),C}const c=l.map(v=>{const x=[-1,re(v.shape.slice(r))];return It({inputs:{x:v},backend:n,attrs:{shape:x}})}),h=c.map(v=>({vals:n.data.get(v.dataId).values,shape:v.shape}));a=Cr(c.map(v=>v.shape),1);const d=c[0].shape[0]===1,f=L3(h,a,e[0].dtype,d),m=Cr(l.map(v=>v.shape),r),g=n.makeTensorInfo(m,e[0].dtype,f);return c.forEach(v=>n.disposeIntermediateTensorInfo(v)),g}const Qre={kernelName:nv,backendName:"cpu",kernelFunc:gu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:h}=s;Ie([i,r],"conv2d");const d=go(l),f=Pn(i.shape,r.shape,o,c,a,h,!1,d),m=f.filterHeight,g=f.filterWidth,v=f.dilationHeight,_=f.dilationWidth,x=f.padInfo.left,w=f.padInfo.top,C=f.dataFormat==="channelsLast",I=new An(f.outShape,i.dtype),S=Te(i.shape),T=Te(r.shape),E=S[0],$=C?S[1]:S[2],D=C?S[2]:1,P=C?1:S[1],z=I.strides[0],H=C?I.strides[1]:I.strides[2],Q=C?I.strides[2]:1,Z=C?1:I.strides[1],J=n.data.get(i.dataId).values,Y=n.data.get(r.dataId).values,oe=I.values;for(let O=0;O<f.batchSize;++O){const q=O*E,V=O*z;for(let te=0;te<f.outHeight;++te){const ae=V+te*H,ue=te*f.strideHeight-w;for(let he=0;he<m;++he){const le=ue+he*v;if(le<0||le>=f.inHeight)continue;const ce=he*T[0],we=q+le*$;for(let Se=0;Se<f.outWidth;++Se){const Ee=ae+Se*Q,Fe=Se*f.strideWidth-x;for(let Me=0;Me<g;++Me){const Qe=Fe+Me*_;if(Qe<0||Qe>=f.inWidth)continue;const ut=ce+Me*T[1],Rt=we+Qe*D;let dt=ut;for(let ot=0;ot<f.inChannels;++ot){const vt=J[Rt+ot*P];for(let ft=0;ft<f.outChannels;++ft)oe[Ee+ft*Z]+=vt*Y[dt+ft];dt+=f.outChannels}}}}}}return n.makeTensorInfo(I.shape,I.dtype,oe)}const Jre={kernelName:sv,backendName:"cpu",kernelFunc:Az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:h}=s;Ie([i,r],"conv2dBackpropFilter");const d=go(l),f=Pn(i.shape,h,o,1,a,c,!1,d),{strideHeight:m,strideWidth:g,filterHeight:v,filterWidth:_}=f,x=f.dataFormat==="channelsLast",w=new An(f.filterShape,"float32"),C=f.padInfo.left,I=f.padInfo.top,S=n.data.get(i.dataId).values,T=n.data.get(r.dataId).values,E=new An(i.shape,i.dtype,S),$=new An(r.shape,r.dtype,T);for(let D=0;D<v;++D){const P=Math.max(0,Math.ceil((I-D)/m)),z=Math.min(f.outHeight,(f.inHeight+I-D)/m);for(let H=0;H<_;++H){const Q=Math.max(0,Math.ceil((C-H)/g)),Z=Math.min(f.outWidth,(f.inWidth+C-H)/g);for(let J=0;J<f.inChannels;++J)for(let Y=0;Y<f.outChannels;++Y){let oe=0;for(let O=0;O<f.batchSize;++O)for(let q=P;q<z;++q){const V=D+q*m-I;for(let te=Q;te<Z;++te){const ae=H+te*g-C;x?oe+=E.get(O,V,ae,J)*$.get(O,q,te,Y):oe+=E.get(O,J,V,ae)*$.get(O,Y,q,te)}}w.set(oe,D,H,J,Y)}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const toe={kernelName:nC,backendName:"cpu",kernelFunc:eoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:h}=s;Ie([i,r],"conv2dBackpropInput");const d=Te(r.shape),f=Te(i.shape);let m=go(c);const g=Pn(o,r.shape,a,1,l,h,!1,m),v=new An(g.inShape,"float32"),_=v.values,x=n.data.get(i.dataId).values,w=n.data.get(r.dataId).values,[C,I,S]=d,{batchSize:T,filterHeight:E,filterWidth:$,inChannels:D,inHeight:P,inWidth:z,outChannels:H,outHeight:Q,outWidth:Z,strideHeight:J,strideWidth:Y}=g;m=g.dataFormat;const oe=E-1-g.padInfo.top,O=$-1-g.padInfo.left,q=m==="channelsLast",V=v.strides[0],te=q?v.strides[1]:v.strides[2],ae=q?v.strides[2]:1,ue=q?1:v.strides[1],he=f[0],le=q?f[1]:f[2],ce=q?f[2]:1,we=q?1:f[1];for(let Se=0;Se<T;++Se)for(let Ee=0;Ee<D;++Ee)for(let Fe=0;Fe<P;++Fe){const Me=Fe-oe,Qe=Math.max(0,Math.ceil(Me/J)),ut=Math.min(Q,(E+Me)/J);for(let Rt=0;Rt<z;++Rt){const dt=Rt-O,ot=Math.max(0,Math.ceil(dt/Y)),vt=Math.min(Z,($+dt)/Y);let ft=0;for(let Jt=Qe;Jt<ut;++Jt){const Qs=Jt*J-Me;for(let Kn=ot;Kn<vt;++Kn){const nr=Kn*Y-dt,Ms=he*Se+le*Jt+ce*Kn,ki=C*(E-1-Qs)+I*($-1-nr)+S*Ee;for(let Js=0;Js<H;++Js){const Si=x[Ms+we*Js],Ti=w[ki+Js];ft+=Si*Ti}}}const Ii=V*Se+te*Fe+ae*Rt+ue*Ee;_[Ii]=ft}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const soe={kernelName:iv,backendName:"cpu",kernelFunc:noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l}=s;Ie([i,r],"conv3d");const c=xa(i.shape,r.shape,o,l,a),{filterDepth:h,filterHeight:d,filterWidth:f,dilationDepth:m,dilationHeight:g,dilationWidth:v,padInfo:_}=c,x=_.front,w=_.left,C=_.top,I=new An(c.outShape,i.dtype),S=n.data.get(i.dataId).values,T=n.data.get(r.dataId).values,E=I.values,$=Te(i.shape),D=Te(r.shape);for(let P=0;P<c.batchSize;++P){const z=P*$[0],H=P*I.strides[0];for(let Q=0;Q<c.outDepth;++Q){const Z=H+Q*I.strides[1],J=Q*c.strideDepth-x;for(let Y=0;Y<h;++Y){const oe=J+Y*m;if(oe<0||oe>=c.inDepth)continue;const O=Y*D[0],q=z+oe*$[1];for(let V=0;V<c.outHeight;++V){const te=Z+V*I.strides[2],ae=V*c.strideHeight-C;for(let ue=0;ue<d;++ue){const he=ae+ue*g;if(he<0||he>=c.inHeight)continue;const le=O+ue*D[1],ce=q+he*$[2];for(let we=0;we<c.outWidth;++we){const Se=te+we*c.outChannels,Ee=we*c.strideWidth-w;for(let Fe=0;Fe<f;++Fe){const Me=Ee+Fe*v;if(Me<0||Me>=c.inWidth)continue;const Qe=le+Fe*D[2],ut=ce+Me*c.inChannels;let Rt=Qe;for(let dt=0;dt<c.inChannels;++dt){const ot=S[ut+dt];for(let vt=0;vt<c.outChannels;++vt)E[Se+vt]+=ot*T[Rt+vt];Rt+=c.outChannels}}}}}}}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const roe={kernelName:rv,backendName:"cpu",kernelFunc:ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,filterShape:l}=s;Ie([i,r],"conv3dBackpropFilterV2");const c=Te(i.shape),h=Te(r.shape),d=xa(i.shape,l,o,1,a),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,v=d.filterDepth,_=d.filterHeight,x=d.filterWidth,w=new An(d.filterShape,"float32"),C=w.values,[I,S,T,E]=w.strides,$=n.data.get(r.dataId).values,[D,P,z,H]=h,Q=n.data.get(i.dataId).values,[Z,J,Y,oe]=c,O=d.padInfo.front,q=d.padInfo.left,V=d.padInfo.top;for(let te=0;te<v;++te){const ae=Math.max(0,Math.ceil((O-te)/f)),ue=Math.min(d.outDepth,(d.inDepth+O-te)/f),he=te*I;for(let le=0;le<_;++le){const ce=Math.max(0,Math.ceil((V-le)/m)),we=Math.min(d.outHeight,(d.inHeight+V-le)/m),Se=le*S+he;for(let Ee=0;Ee<x;++Ee){const Fe=Math.max(0,Math.ceil((q-Ee)/g)),Me=Math.min(d.outWidth,(d.inWidth+q-Ee)/g),Qe=Ee*T+Se;for(let ut=0;ut<d.inChannels;++ut){const Rt=ut*E+Qe;for(let dt=0;dt<d.outChannels;++dt){let ot=0;for(let vt=0;vt<d.batchSize;++vt){const ft=vt*Z,Ii=vt*D;for(let Jt=ae;Jt<ue;++Jt){const Kn=(te+Jt*f-O)*J+ft,nr=Jt*P+Ii;for(let Ms=ce;Ms<we;++Ms){const Js=(le+Ms*m-V)*Y+Kn,Si=Ms*z+nr;for(let Ti=Fe;Ti<Me;++Ti){const sc=(Ee+Ti*g-q)*oe+Js,ic=Ti*H+Si;ot+=Q[sc+ut]*$[ic+dt]}}}}C[Rt+dt]=ot}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const aoe={kernelName:sC,backendName:"cpu",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{pad:o,strides:a,inputShape:l}=s;Ie([i],"conv3dBackpropInputV2");const c=Te(i.shape),h=Te(r.shape),d=xa(l,r.shape,a,1,o),f=new An(d.inShape,"float32"),m=f.values,[g,v,_,x]=f.strides,w=n.data.get(i.dataId).values,[C,I,S,T]=c,E=n.data.get(r.dataId).values,[$,D,P,z]=h,{batchSize:H,filterDepth:Q,filterHeight:Z,filterWidth:J,inChannels:Y,inDepth:oe,inHeight:O,inWidth:q,outChannels:V,outDepth:te,outHeight:ae,outWidth:ue,strideDepth:he,strideHeight:le,strideWidth:ce}=d,we=Q-1-d.padInfo.front,Se=Z-1-d.padInfo.top,Ee=J-1-d.padInfo.left;for(let Fe=0;Fe<H;++Fe)for(let Me=0;Me<Y;++Me)for(let Qe=0;Qe<oe;++Qe){const ut=Qe-we,Rt=Math.max(0,Math.ceil(ut/he)),dt=Math.min(te,(Q+ut)/he);for(let ot=0;ot<O;++ot){const vt=ot-Se,ft=Math.max(0,Math.ceil(vt/le)),Ii=Math.min(ae,(Z+vt)/le);for(let Jt=0;Jt<q;++Jt){const Qs=Jt-Ee,Kn=Math.max(0,Math.ceil(Qs/ce)),nr=Math.min(ue,(J+Qs)/ce);let Ms=0;for(let ki=Rt;ki<dt;++ki){const Js=ki*he-ut;for(let Si=ft;Si<Ii;++Si){const Ti=Si*le-vt;for(let Ea=Kn;Ea<nr;++Ea){const sc=Ea*ce-Qs,ic=C*Fe+I*ki+S*Si+T*Ea,Dx=$*(Q-1-Js)+D*(Z-1-Ti)+P*(J-1-sc)+z*Me;for(let Na=0;Na<V;++Na){const Xu=w[ic+Na],Np=E[Dx+Na];Ms+=Xu*Np}}}}m[g*Fe+v*Qe+_*ot+x*Jt+Me]=Ms}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const coe={kernelName:iC,backendName:"cpu",kernelFunc:loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uoe=mt(mf,t=>Math.cos(t)),hoe={kernelName:mf,backendName:"cpu",kernelFunc:uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const doe=mt(gf,t=>Math.cosh(t)),foe={kernelName:gf,backendName:"cpu",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:r,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[h,d,f,m]=i.shape,g=r.shape[0],[v,_]=a,x=Ge([g,v,_,m],"float32"),w=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,I=n.data.get(i.dataId).values,S=Te(i.shape),T=Te(x.shape);for(let E=0;E<g;E++){const $=E*4,D=w[$],P=w[$+1],z=w[$+2],H=w[$+3],Q=C[E];if(Q>=h)continue;const Z=v>1?(z-D)*(d-1)/(v-1):0,J=_>1?(H-P)*(f-1)/(_-1):0;for(let Y=0;Y<v;Y++){const oe=v>1?D*(d-1)+Y*Z:.5*(D+z)*(d-1);if(oe<0||oe>d-1){for(let O=0;O<_;O++)for(let q=0;q<m;q++){const V=q+O*T[2]+Y*T[1]+E*T[0];x.values[V]=c}continue}if(l==="bilinear"){const O=Math.floor(oe),q=Math.ceil(oe),V=oe-O;for(let te=0;te<_;te++){const ae=_>1?P*(f-1)+te*J:.5*(P+H)*(f-1);if(ae<0||ae>f-1){for(let ce=0;ce<m;ce++){const we=ce+te*T[2]+Y*T[1]+E*T[0];x.values[we]=c}continue}const ue=Math.floor(ae),he=Math.ceil(ae),le=ae-ue;for(let ce=0;ce<m;ce++){let we=ce+ue*S[2]+O*S[1]+Q*S[0];const Se=I[we];we=ce+he*S[2]+O*S[1]+Q*S[0];const Ee=I[we];we=ce+ue*S[2]+q*S[1]+Q*S[0];const Fe=I[we];we=ce+he*S[2]+q*S[1]+Q*S[0];const Me=I[we],Qe=Se+(Ee-Se)*le,ut=Fe+(Me-Fe)*le;we=ce+te*T[2]+Y*T[1]+E*T[0],x.values[we]=Qe+(ut-Qe)*V}}}else for(let O=0;O<_;++O){const q=_>1?P*(f-1)+O*J:.5*(P+H)*(f-1);if(q<0||q>f-1){for(let ae=0;ae<m;ae++){const ue=ae+O*T[2]+Y*T[1]+E*T[0];x.values[ue]=c}continue}const V=Math.round(q),te=Math.round(oe);for(let ae=0;ae<m;ae++){const ue=ae+V*S[2]+te*S[1]+Q*S[0],he=ae+O*T[2]+Y*T[1]+E*T[0];x.values[he]=I[ue]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const moe={kernelName:oC,backendName:"cpu",kernelFunc:poe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;Ie(i,"cumprod");const l=Bt([r],i.shape.length);let c=i;l!=null&&(c=ms({inputs:{x:i},backend:n,attrs:{perm:l}}));const h=Zt(1,i.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const d=Ds(c.dtype,"int32"),f=j1(re(c.shape),d),m=n.data.get(c.dataId).values,g=c.shape[c.shape.length-1],v=a?(x,w)=>x+g-w-1:(x,w)=>x+w;for(let x=0;x<m.length;x+=g)for(let w=0;w<g;w++){const C=v(x,w);if(w===0)f[C]=o?1:m[C];else{const I=v(x,w-1);f[C]=o?m[I]*f[I]:m[C]*f[I]}}const _=n.makeTensorInfo(c.shape,d,f);if(l!=null){const x=_a(l),w=ms({inputs:{x:_},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(c),w}return _}const yoe={kernelName:rC,backendName:"cpu",kernelFunc:goe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;Ie(i,"cumsum");const l=Bt([r],i.shape.length);let c=i;l!=null&&(c=ms({inputs:{x:i},backend:n,attrs:{perm:l}}));const h=Zt(1,i.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const d=Ds(c.dtype,"int32"),f=Vn(re(c.shape),d),m=n.data.get(c.dataId).values,g=c.shape[c.shape.length-1],v=a?(x,w)=>x+g-w-1:(x,w)=>x+w;for(let x=0;x<m.length;x+=g)for(let w=0;w<g;w++){const C=v(x,w);if(w===0)f[C]=o?0:m[C];else{const I=v(x,w-1);f[C]=o?m[I]+f[I]:m[C]+f[I]}}const _=n.makeTensorInfo(c.shape,d,f);if(l!=null){const x=_a(l),w=ms({inputs:{x:_},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(c),w}return _}const xoe={kernelName:ov,backendName:"cpu",kernelFunc:voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o,binaryOutput:a}=s;if(i.shape.length===1){const l=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,h=vk(l,c,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,h)}else if(i.shape.length===2){const l=n.bufferSync(i),c=n.bufferSync(r),h=D3(l,c,o,a);return n.makeTensorInfo(h.shape,r.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const woe={kernelName:aC,backendName:"cpu",kernelFunc:_oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:r,dataFormat:o}=s;R(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],l=i.shape[1],c=i.shape[2],h=i.shape[3],d=l*r,f=c*r,m=h/(r*r),g=n.data.get(i.dataId).values,v=new Float32Array(a*d*f*m);let _=0;for(let x=0;x<a;++x)for(let w=0;w<d;++w){const C=Math.floor(w/r),I=w%r;for(let S=0;S<f;++S){const T=Math.floor(S/r),E=S%r,$=(I*r+E)*m;for(let D=0;D<m;++D){const z=D+$+h*(T+c*(C+l*x));v[_++]=g[z]}}}return n.makeTensorInfo([a,d,f,m],i.dtype,v)}const Coe={kernelName:lC,backendName:"cpu",kernelFunc:boe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;Ie([i,r],"depthwiseConv2DNative");const h=Te(i.shape),d=Te(r.shape);let f=l;f==null&&(f=[1,1]),R(jn(o,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`);const m=Pn(i.shape,r.shape,o,f,a,c,!0),{filterHeight:g,filterWidth:v,dilationHeight:_,dilationWidth:x,padInfo:w}=m,C=w.left,I=w.top,S=m.outChannels/m.inChannels,T=new An(m.outShape,i.dtype),E=n.data.get(i.dataId).values,$=n.data.get(r.dataId).values,D=T.values;for(let P=0;P<m.batchSize;++P){const z=P*h[0],H=P*T.strides[0];for(let Q=0;Q<m.outHeight;++Q){const Z=H+Q*T.strides[1],J=Q*m.strideHeight-I;for(let Y=0;Y<g;++Y){const oe=J+Y*_;if(oe<0||oe>=m.inHeight)continue;const O=Y*d[0],q=z+oe*h[1];for(let V=0;V<m.outWidth;++V){const te=Z+V*T.strides[2],ae=V*m.strideWidth-C;for(let ue=0;ue<v;++ue){const he=ae+ue*x;if(he<0||he>=m.inWidth)continue;const le=O+ue*d[1],ce=q+he*m.inChannels;let we=te,Se=le;for(let Ee=0;Ee<m.inChannels;++Ee){const Fe=E[ce+Ee];for(let Me=0;Me<S;++Me)D[we+Me]+=Fe*$[Se+Me];we+=S,Se+=S}}}}}}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const Ioe={kernelName:av,backendName:"cpu",kernelFunc:Dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:h}=s;Ie([i,r],"depthwiseConv2dNativeBackpropFilter");const d=Pn(i.shape,h,o,a,l,c,!0),{strideHeight:f,strideWidth:m,filterHeight:g,filterWidth:v}=d,_=new An(d.filterShape,"float32"),x=d.padInfo.left,w=d.padInfo.top,C=d.outChannels/d.inChannels,I=n.data.get(i.dataId).values,S=new An(i.shape,i.dtype,I),T=n.data.get(r.dataId).values,E=new An(r.shape,r.dtype,T);for(let $=0;$<g;++$){const D=Math.max(0,Math.ceil((w-$)/f)),P=Math.min(d.outHeight,(d.inHeight+w-$)/f);for(let z=0;z<v;++z){const H=Math.max(0,Math.ceil((x-z)/m)),Q=Math.min(d.outWidth,(d.inWidth+x-z)/m);for(let Z=0;Z<d.outChannels;++Z){const J=Math.trunc(Z/C),Y=Z%C;let oe=0;for(let O=0;O<d.batchSize;++O)for(let q=D;q<P;++q){const V=$+q*f-w;for(let te=H;te<Q;++te){const ae=z+te*m-x;oe+=S.get(O,V,ae,J)*E.get(O,q,te,Z)}}_.set(oe,$,z,J,Y)}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const Soe={kernelName:cC,backendName:"cpu",kernelFunc:koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:h}=s;Ie([i,r],"depthwiseConv2DNativeBackpropInput");const d=Te(i.shape),f=Te(r.shape),m=Pn(h,r.shape,o,a,l,c,!0),g=new An(m.inShape,"float32"),v=g.values,[_,x,w]=g.strides,C=n.data.get(i.dataId).values,[I,S,T]=d,E=n.data.get(r.dataId).values,[$,D,P]=f,{batchSize:z,filterHeight:H,filterWidth:Q,inChannels:Z,inHeight:J,inWidth:Y,outChannels:oe,outHeight:O,outWidth:q,strideHeight:V,strideWidth:te}=m,ae=H-1-m.padInfo.top,ue=Q-1-m.padInfo.left,he=oe/Z;for(let le=0;le<z;++le)for(let ce=0;ce<Z;++ce)for(let we=0;we<J;++we){const Se=we-ae,Ee=Math.max(0,Math.ceil(Se/V)),Fe=Math.min(O,(H+Se)/V);for(let Me=0;Me<Y;++Me){const Qe=Me-ue,ut=Math.max(0,Math.ceil(Qe/te)),Rt=Math.min(q,(Q+Qe)/te);let dt=0;for(let ot=Ee;ot<Fe;++ot){const vt=ot*V-Se;for(let ft=ut;ft<Rt;++ft){const Ii=ft*te-Qe,Jt=I*le+S*ot+T*ft,Qs=$*(H-1-vt)+D*(Q-1-Ii)+P*ce;for(let Kn=0;Kn<he;++Kn){const nr=ce*he+Kn,Ms=C[Jt+nr],ki=E[Qs+Kn];dt+=Ms*ki}}}v[_*le+x*we+w*Me+ce]=dt}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const Eoe={kernelName:uC,backendName:"cpu",kernelFunc:Toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(t){const{inputs:e,backend:n}=t,{x:s}=e,i=re(s.shape),r=n.data.get(s.dataId).values,o=Ge([i,i],s.dtype),a=o.values;for(let c=0;c<r.length;c++)a[c*i+c]=r[c];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const $oe={kernelName:nO,backendName:"cpu",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Roe={kernelName:lv,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i}=t,{strides:r,pad:o,dilations:a}=n,l=e,c=l.data.get(s.dataId).values,h=s.shape.length,d=l.data.get(i.dataId).values,f=i.shape.length,{batchSize:m,inHeight:g,inWidth:v,inChannels:_,outHeight:x,outWidth:w,padInfo:C,strideHeight:I,strideWidth:S,filterHeight:T,filterWidth:E,dilationHeight:$,dilationWidth:D,outShape:P}=np(s.shape,i.shape,r,o,"NHWC",a),z=re(P),H=P.length,Q=qt(s.dtype,z);for(let J=0;J<m;++J)for(let Y=0;Y<x;++Y){const oe=Y*I-C.top;for(let O=0;O<w;++O){const q=O*S-C.left;for(let V=0;V<_;++V){let te=Number.MIN_SAFE_INTEGER;for(let ue=0;ue<T;++ue){const he=oe+ue*$;if(he>=0&&he<g)for(let le=0;le<E;++le){const ce=q+le*D;if(ce>=0&&ce<v){const we=wr([J,he,ce,V],h,Te(s.shape)),Se=wr([ue,le,V],f,Te(i.shape)),Ee=c[we]+d[Se];Ee>te&&(te=Ee)}}}const ae=wr([J,Y,O,V],H,Te(P));Q[ae]=te}}}return{dataId:l.write(jl(Q,s.dtype),P,s.dtype),shape:P,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aoe={kernelName:N0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:r}=t,{strides:o,pad:a,dilations:l}=n,c=e,h=Gi(s.shape,c.data.get(s.dataId).values),d=Gi(i.shape,c.data.get(i.dataId).values),{batchSize:f,inHeight:m,inWidth:g,inChannels:v,outHeight:_,outWidth:x,padInfo:w,strideHeight:C,strideWidth:I,filterHeight:S,filterWidth:T,dilationHeight:E,dilationWidth:$,outShape:D}=np(s.shape,i.shape,o,a,"NHWC",l);R(r.rank===D.length,()=>`Error in ${N0}, dy must have the same rank as output ${D.length}, but got ${r.rank}`);const P=Gi(D,c.data.get(r.dataId).values),z=QP(i.shape,i.dtype);for(let Q=0;Q<f;++Q)for(let Z=0;Z<_;++Z){const J=Z*C-w.top;for(let Y=0;Y<x;++Y){const oe=Y*I-w.left;for(let O=0;O<v;++O){let q=Number.MIN_SAFE_INTEGER,V=0,te=0;for(let ae=0;ae<S;++ae){const ue=J+ae*E;if(ue>=0&&ue<m)for(let he=0;he<T;++he){const le=oe+he*$;if(le>=0&&le<g){const ce=h[Q][ue][le][O]+d[ae][he][O];ce>q&&(q=ce,V=ae,te=he)}}}z[V][te][O]+=P[Q][Z][Y][O]}}}return{dataId:c.write(jl(z,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Doe={kernelName:E0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:r}=t,{strides:o,pad:a,dilations:l}=n,c=e,h=Gi(s.shape,c.data.get(s.dataId).values),d=Gi(i.shape,c.data.get(i.dataId).values),{batchSize:f,inHeight:m,inWidth:g,inChannels:v,outHeight:_,outWidth:x,padInfo:w,strideHeight:C,strideWidth:I,filterHeight:S,filterWidth:T,dilationHeight:E,dilationWidth:$,outShape:D}=np(s.shape,i.shape,o,a,"NHWC",l);R(r.rank===D.length,()=>`Error in ${E0}, dy must have the same rank as output ${D.length}, but got ${r.rank}`);const P=Gi(D,c.data.get(r.dataId).values),z=QP(s.shape,s.dtype);for(let Q=0;Q<f;++Q)for(let Z=0;Z<_;++Z){const J=Z*C-w.top;for(let Y=0;Y<x;++Y){const oe=Y*I-w.left;for(let O=0;O<v;++O){let q=Number.MIN_SAFE_INTEGER,V=J<0?0:J,te=oe<0?0:oe;for(let ae=0;ae<S;++ae){const ue=J+ae*E;if(ue>=0&&ue<m)for(let he=0;he<T;++he){const le=oe+he*$;if(le>=0&&le<g){const ce=h[Q][ue][le][O]+d[ae][he][O];ce>q&&(q=ce,V=ue,te=le)}}}z[Q][V][te][O]+=P[Q][Z][Y][O]}}}return{dataId:c.write(jl(z,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Poe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i}=e,{canvas:r,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},c=(l==null?void 0:l.alpha)||1,h=(a==null?void 0:a.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=r.getContext(h,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${h} type.`);const[f,m]=i.shape.slice(0,2),g=i.shape.length===2?1:i.shape[2],v=n.data.get(i.dataId).values,_=i.dtype==="float32"?255:1,x=new Uint8ClampedArray(m*f*4);for(let C=0;C<f*m;++C){const I=[0,0,0,255*c];for(let T=0;T<g;T++){const E=v[C*g+T];if(i.dtype==="float32"){if(E<0||E>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${E}.`)}else if(i.dtype==="int32"&&(E<0||E>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${E}.`);g===1?(I[0]=E*_,I[1]=E*_,I[2]=E*_):I[T]=E*_}const S=C*4;x[S+0]=Math.round(I[0]),x[S+1]=Math.round(I[1]),x[S+2]=Math.round(I[2]),x[S+3]=Math.round(I[3])}r.width=m,r.height=f;const w=new ImageData(x,m,f);return d.putImageData(w,0,0),i}const Ooe={kernelName:G8,backendName:"cpu",kernelFunc:Poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yp(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"sum");let a;i.dtype==="bool"?a=oa({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):a=Ar({inputs:{x:i},backend:n});const l=a.shape.length,c=je(r,a.shape),h=Bt(c,l);let d=c,f=a;h!=null&&(f=ms({inputs:{x:a},backend:n,attrs:{perm:h}}),d=Zt(d.length,l)),On("sum",d,f.shape.length);const[m,g]=In(f.shape,d),v=Ds(f.dtype,"int32");let _=Jg(n,m,v);const x=re(g),w=n.data.get(_.dataId).values,C=n.data.get(f.dataId).values;for(let I=0;I<w.length;++I){const S=I*x;let T=0;for(let E=0;E<x;++E)T+=C[S+E];w[I]=T}if(o){const I=sn(_.shape,c),S=_;_=It({inputs:{x:_},backend:n,attrs:{shape:I}}),n.disposeIntermediateTensorInfo(S)}return n.disposeIntermediateTensorInfo(a),h!=null&&n.disposeIntermediateTensorInfo(f),_}const Loe={kernelName:Uv,backendName:"cpu",kernelFunc:yp};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:i}=s,r=e,{allDims:o,summedDims:a,idDims:l}=BI(i,r.length);WI(o.length,l,r);const{path:c,steps:h}=VI(a,l),d=h.length;let f=null,m=o.length;const g=[];for(let v=0;v<d;++v){for(const _ of h[v]){const{permutationIndices:x,expandDims:w}=UI(m,l[_]);let C;GI(x)?C=r[_]:(C=ms({inputs:{x:r[_]},backend:n,attrs:{perm:x}}),g.push(C));const I=C.shape.slice();for(let S=0;S<w.length;++S)I.splice(w[S],0,1);ct(C.shape,I)||(C=It({inputs:{x:C},backend:n,attrs:{shape:I}}),g.push(C)),f===null?f=C:(f=yx({inputs:{a:C,b:f},backend:n}),g.push(f))}v<d-1&&(c[v]>=0&&(f=yp({inputs:{x:f},backend:n,attrs:{axis:c[v]-(o.length-m),keepDims:!1}}),g.push(f)),m--)}for(const v of g)v!==f&&n.disposeIntermediateTensorInfo(v);return f}const Moe={kernelName:hC,backendName:"cpu",kernelFunc:Foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zoe(t){const{inputs:e,backend:n}=t,{dy:s,y:i}=e;Ie([s,i],"eluGrad");const r=new Float32Array(re(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=0?r[l]=a[l]:r[l]=a[l]*(c+1)}return n.makeTensorInfo(i.shape,"float32",r)}const Boe={kernelName:dC,backendName:"cpu",kernelFunc:zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uoe=DI,Woe=PI,Voe=OI,Goe=LI,joe=FI,Hoe=MI,qoe=mt(xf,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+Uoe*n);return e*(1-((((Hoe*s+joe)*s+Goe)*s+Voe)*s+Woe)*s*Math.exp(-n*n))}),Koe={kernelName:xf,backendName:"cpu",kernelFunc:qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ny(t){const{inputs:e,backend:n,attrs:s}=t,{input:i}=e,{dim:r}=s,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(R(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),It({inputs:{x:i},backend:n,attrs:{shape:a}})}const Xoe={kernelName:uv,backendName:"cpu",kernelFunc:ny};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zoe=Qt((t,e)=>t/e),Ik=mn(yf,Zoe),sb={kernelName:yf,backendName:"cpu",kernelFunc:Ik};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(t,e,n){const s=t.shape,i=s[0],r=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[i,r],h=re(c),d=Wn("float32",h),f=Wn("float32",h);for(let _=0;_<i;_++){const x=Rl({inputs:{x:a},backend:n,attrs:{begin:[_,0],size:[1,r]}}),w=Rl({inputs:{x:l},backend:n,attrs:{begin:[_,0],size:[1,r]}}),C=bs({inputs:{real:x,imag:w},backend:n}),{real:I,imag:S}=Yoe(C,e,n),T=lo(I,S);for(let E=0;E<r;E++){const $=zI(T,E);d[_*r+E]=$.real,f[_*r+E]=$.imag}n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(C)}const m=n.makeTensorInfo(c,"float32",d),g=n.makeTensorInfo(c,"float32",f),v=bs({inputs:{real:m,imag:g},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),v}function Yoe(t,e,n){const s=re(t.shape),i=n.data.get(t.dataId),r=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(Qoe(s)){const a=ib(r,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),h=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",ya(s,"float32")),f=Ar({inputs:{x:d},backend:n}),m=sb.kernelFunc({inputs:{a:c,b:d},backend:n}),g=sb.kernelFunc({inputs:{a:h,b:f},backend:n}),v=n.data.get(m.dataId).values,_=n.data.get(g.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),{real:v,imag:_}}return a}else{const a=lo(r,o),l=Joe(a,s,e);return ZL(l)}}function Qoe(t){return(t&t-1)===0}function ib(t,e,n,s,i){if(n===1)return{real:t,imag:e};const r=lo(t,e),o=n/2,a=YL(r),l=a.real,c=a.imag,h=[l.length],d=i.makeTensorInfo(h,"float32",l),f=i.makeTensorInfo(h,"float32",c),m=bs({inputs:{real:d,imag:f},backend:i}),g=QL(r),v=g.real,_=g.imag,x=[v.length],w=i.makeTensorInfo(x,"float32",v),C=i.makeTensorInfo(x,"float32",_),I=bs({inputs:{real:w,imag:C},backend:i}),S=ib(l,c,o,s,i),T=S.real,E=S.imag,$=[T.length],D=i.makeTensorInfo($,"float32",T),P=i.makeTensorInfo($,"float32",E),z=bs({inputs:{real:D,imag:P},backend:i}),H=ib(v,_,o,s,i),Q=H.real,Z=H.imag,J=[Q.length],Y=i.makeTensorInfo(J,"float32",Q),oe=i.makeTensorInfo(J,"float32",Z),O=bs({inputs:{real:Y,imag:oe},backend:i}),q=eF(n,s),V=[q.real.length],te=i.makeTensorInfo(V,"float32",q.real),ae=i.makeTensorInfo(V,"float32",q.imag),ue=bs({inputs:{real:te,imag:ae},backend:i}),he=yx({inputs:{a:ue,b:O},backend:i}),le=pu({inputs:{a:z,b:he},backend:i}),ce=bk({inputs:{a:z,b:he},backend:i}),we=$l({inputs:{input:le},backend:i}),Se=$l({inputs:{input:ce},backend:i}),Ee=mu({inputs:{input:le},backend:i}),Fe=mu({inputs:{input:ce},backend:i}),Me=gu({inputs:[we,Se],backend:i,attrs:{axis:0}}),Qe=gu({inputs:[Ee,Fe],backend:i,attrs:{axis:0}}),ut=i.data.get(Me.dataId).values,Rt=i.data.get(Qe.dataId).values;return i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(m),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(oe),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(te),i.disposeIntermediateTensorInfo(ae),i.disposeIntermediateTensorInfo(ue),i.disposeIntermediateTensorInfo(he),i.disposeIntermediateTensorInfo(le),i.disposeIntermediateTensorInfo(ce),i.disposeIntermediateTensorInfo(we),i.disposeIntermediateTensorInfo(Ee),i.disposeIntermediateTensorInfo(Se),i.disposeIntermediateTensorInfo(Fe),i.disposeIntermediateTensorInfo(Me),i.disposeIntermediateTensorInfo(Qe),{real:ut,imag:Rt}}function Joe(t,e,n){const s=new Float32Array(e*2);for(let i=0;i<e;i++){let r=0,o=0;for(let a=0;a<e;a++){const l=tF(i*a,e,n),c=zI(t,a);r+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}n&&(r/=e,o/=e),JL(s,r,o,i)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eae(t){const{inputs:e,backend:n}=t,{input:s}=e,i=re(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=It({inputs:{x:s},backend:n,attrs:{shape:[o,r]}}),l=Pz(a,!1,n),c=It({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const tae={kernelName:fC,backendName:"cpu",kernelFunc:eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kk(t){const{backend:e,attrs:n}=t,{shape:s,value:i,dtype:r}=n,o=r||Nu(i),a=qt(o,re(s));return sae(a,i,o),e.makeTensorInfo(s,o,a)}const nae={kernelName:pC,backendName:"cpu",kernelFunc:kk};function sae(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iae={kernelName:mC,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,i=n,r=Wn(s.dtype,re(s.shape)),[o,a,l,c]=s.shape,h=i.data.get(s.dataId).values;for(let f=0;f<o;f++){const m=f*l*a*c;for(let g=0;g<a;g++){const v=g*(l*c);for(let _=0;_<l;_++){const x=_*c;for(let w=0;w<c;w++){const C=Math.round(l-_-1),I=m+v+x+w;let S=h[I];if(C>=0&&C<l){const T=C*c,E=m+v+T+w;S=h[E]}r[I]=S}}}}return{dataId:i.write(r,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s;let v=Az({inputs:{x:i,filter:r},backend:n,attrs:{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f}});if(o){const _=v;if(h==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const x=It({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});v=pu({inputs:{a:v,b:x},backend:n}),n.disposeIntermediateTensorInfo(x)}else v=pu({inputs:{a:v,b:o},backend:n});n.disposeIntermediateTensorInfo(_)}if(m){const _=v;if(h==="NCHW"&&m==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const x=It({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});v=ty(n,v,m,x,g),n.disposeIntermediateTensorInfo(x)}else v=ty(n,v,m,a,g);n.disposeIntermediateTensorInfo(_)}return v}const oae={kernelName:Dg,backendName:"cpu",kernelFunc:rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s;let v=Dz({inputs:{x:i,filter:r},backend:n,attrs:{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f}});if(o){const _=v;v=pu({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(_)}if(m){const _=v;v=ty(n,v,m,a,g),n.disposeIntermediateTensorInfo(_)}return v}const lae={kernelName:wO,backendName:"cpu",kernelFunc:aae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,r=re(s.shape),o=i.shape,a=o[o.length-1],[l,c,h,d]=bI(s,i);if(c===0)return n.makeTensorInfo(l,s.dtype,[]);const f=n.data.get(i.dataId).values,m=n.bufferSync(s),g=G3(f,m,s.dtype,c,a,h,d,s.shape,r);return n.makeTensorInfo(l,s.dtype,g.values)}const uae={kernelName:sO,backendName:"cpu",kernelFunc:cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:r}=e,{axis:o,batchDims:a}=s;Ie([i,r],"gatherV2");const l=je(o,i.shape)[0],c=n.data.get(r.dataId).values,h=i.shape[l];for(let I=0;I<c.length;++I){const S=c[I];R(S<=h-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${h-1}]`)}let d=a;a==null&&(d=0);const f=re(r.shape),m=HI(i,r,l,d),g=It({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),v=It({inputs:{x:r},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),_=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],x=n.bufferSync(v),w=n.bufferSync(g),C=j3(w,x,_);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),n.makeTensorInfo(m.outputShape,C.dtype,C.values)}const dae={kernelName:dv,backendName:"cpu",kernelFunc:hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(t){const{inputs:e,backend:n}=t,{input:s}=e,i=re(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=It({inputs:{x:s},backend:n,attrs:{shape:[o,r]}}),l=Pz(a,!0,n),c=It({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const pae={kernelName:gC,backendName:"cpu",kernelFunc:fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mae=mt(Sf,t=>Number.isFinite(t)?1:0,"bool"),gae={kernelName:Sf,backendName:"cpu",kernelFunc:mae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yae=mt(Tf,t=>Math.abs(t)===1/0?1:0,"bool"),vae={kernelName:Tf,backendName:"cpu",kernelFunc:yae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xae=mt(Ef,t=>Number.isNaN(t)?1:0,"bool"),_ae={kernelName:Ef,backendName:"cpu",kernelFunc:xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wae(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:r}=n,o=Z3(s,i,r);return e.makeTensorInfo([o.length],"float32",o)}const bae={kernelName:iO,backendName:"cpu",kernelFunc:wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cae=mt($f,t=>Math.log1p(t)),Iae={kernelName:$f,backendName:"cpu",kernelFunc:Cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kae=Qt((t,e)=>t&&e),Sae=mn(yv,kae,null,"bool"),Tae={kernelName:yv,backendName:"cpu",kernelFunc:Sae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae=mt(vv,t=>t?0:1,"bool"),Nae={kernelName:vv,backendName:"cpu",kernelFunc:Eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ae=Qt((t,e)=>t||e),Rae=mn(xv,$ae,null,"bool"),Aae={kernelName:xv,backendName:"cpu",kernelFunc:Rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:r,bias:o,alpha:a,beta:l}=s;Ie(i,"LRN");const c=i.shape[3],h=c-1,d=n.data.get(i.dataId).values,f=re(i.shape),m=new Float32Array(f);function g(v){const _=v%c;let x=v-_+Math.max(0,_-r);const w=v-_+Math.min(_+r,h);let C=0;for(;x<=w;x++){const I=d[x];C+=I*I}return C}for(let v=0;v<f;v++){const _=g(v),x=d[v]*Math.pow(o+a*_,-l);m[v]=x}return n.makeTensorInfo(i.shape,i.dtype,m)}const Pae={kernelName:_v,backendName:"cpu",kernelFunc:Dae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,y:r,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:h}=s;Ie(o,"LRNGrad");const d=re(o.shape),f=o.shape[3],m=n.data.get(o.dataId).values,g=n.data.get(i.dataId).values,v=n.data.get(r.dataId).values,_=new Float32Array(d),x=d;for(let w=0;w<x;w++){const C=w%f,I=w-C+Math.max(0,C-a),S=w-C+Math.min(f,C+a+1);let T=0;for(let E=I;E<S;E++)T+=Math.pow(g[E],2);T=c*T+l;for(let E=I;E<S;E++){let $=-2*c*h*g[E]*v[w]/T;w===E&&($+=Math.pow(T,-h)),$*=m[w],_[E]+=$}}return n.makeTensorInfo(o.shape,i.dtype,_)}const Lae={kernelName:vC,backendName:"cpu",kernelFunc:Oae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:r,keepDims:o}=s,a=n;let l=i.shape;const c=l.length,h=je(r,l);let d=h;const f=Bt(d,c);let m=a.data.get(i.dataId).values;if(f!=null){const I=new Array(c);for(let S=0;S<I.length;S++)I[S]=l[f[S]];m=_k(m,l,i.dtype,f,I),d=Zt(d.length,c),l=I}Ie(i,"max"),On("max",d,c);const[g,v]=In(l,d),_=re(v),x=Q3(m,_,g,i.dtype),w=a.write(x,g,i.dtype);let C=g;return o&&(C=sn(g,h)),{dataId:w,shape:C,dtype:i.dtype}}const Fae={kernelName:wv,backendName:"cpu",kernelFunc:Oz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;Ie(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(jn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=wi(i.shape,r,o,c,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))d=Ar({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,m=Te(i.shape),g=Ck(f,i.shape,i.dtype,m,h,"max");d=n.makeTensorInfo(h.outShape,i.dtype,g.values)}return d}const zae={kernelName:bv,backendName:"cpu",kernelFunc:Mae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;Ie(i,"maxPool3d");const h=mo(i.shape,r,o,1,a,l,c),d=n.data.get(i.dataId).values,f=Rz(d,i.shape,i.dtype,Te(i.shape),h,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const Uae={kernelName:Cv,backendName:"cpu",kernelFunc:Bae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;Ie([i,r],"maxPool3DGrad");const h=mo(r.shape,o,a,1,l,c),d=n.bufferSync(r),f=$re(d,h),m=h.strideDepth,g=h.strideHeight,v=h.strideWidth,_=h.dilationDepth,x=h.dilationHeight,w=h.dilationWidth,C=h.effectiveFilterDepth,I=h.effectiveFilterHeight,S=h.effectiveFilterWidth,T=C-1-h.padInfo.front,E=S-1-h.padInfo.left,$=I-1-h.padInfo.top,D=Ge(r.shape,"float32"),P=n.bufferSync(i);for(let z=0;z<h.batchSize;++z)for(let H=0;H<h.inChannels;++H)for(let Q=0;Q<h.inDepth;++Q)for(let Z=0;Z<h.inHeight;++Z)for(let J=0;J<h.inWidth;++J){const Y=Q-T,oe=Z-$,O=J-E;let q=0;for(let V=0;V<C;V+=_){const te=(Y+V)/m;if(!(te<0||te>=h.outDepth||Math.floor(te)!==te))for(let ae=0;ae<I;ae+=x){const ue=(oe+ae)/g;if(!(ue<0||ue>=h.outHeight||Math.floor(ue)!==ue))for(let he=0;he<S;he+=w){const le=(O+he)/v;if(le<0||le>=h.outWidth||Math.floor(le)!==le)continue;const ce=C*I*S-1-f.get(z,te,ue,le,H),we=V*I*S+ae*S+he,Se=ce===we?1:0;if(Se===0)continue;const Ee=P.get(z,te,ue,le,H);q+=Ee*Se}}}D.set(q,z,Q,Z,J,H)}return n.makeTensorInfo(D.shape,D.dtype,D.values)}const Vae={kernelName:_C,backendName:"cpu",kernelFunc:Wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r,output:o}=e,a=r;Ie([r,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:d}=s,f=wi(a.shape,l,c,1,h,d),m=n.data.get(a.dataId).values,g=Ge(f.outShape,a.dtype,$z(m,a.shape,a.dtype,f).values),v=f.strideHeight,_=f.strideWidth,x=f.dilationHeight,w=f.dilationWidth,C=f.effectiveFilterHeight,I=f.effectiveFilterWidth,S=I-1-f.padInfo.left,T=C-1-f.padInfo.top,E=Ge(a.shape,"float32"),$=n.data.get(i.dataId).values,D=Ge(i.shape,"float32",$);for(let P=0;P<f.batchSize;++P)for(let z=0;z<f.inChannels;++z)for(let H=0;H<f.inHeight;++H)for(let Q=0;Q<f.inWidth;++Q){const Z=H-T,J=Q-S;let Y=0;for(let oe=0;oe<C;oe+=x){const O=(Z+oe)/v;if(!(O<0||O>=f.outHeight||Math.floor(O)!==O))for(let q=0;q<I;q+=w){const V=(J+q)/_;if(V<0||V>=f.outWidth||Math.floor(V)!==V)continue;const te=C*I-1-g.get(P,O,V,z),ae=oe*I+q,ue=te===ae?1:0;if(ue===0)continue;const he=D.get(P,O,V,z);Y+=he*ue}}E.set(Y,P,H,Q,z)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const jae={kernelName:xC,backendName:"cpu",kernelFunc:Gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hae(t,e,n,s,i){const r=Te(e),o=Ck(t,e,n,r,i,"max"),a=$z(t,e,n,i,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qae={kernelName:rO,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=e,l=n;Ie(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,h=wi(s.shape,i,r,[1,1],o),[d,f]=Hae(c,s.shape,s.dtype,a,h),m=l.write(d,h.outShape,s.dtype),g=l.write(f,h.outShape,s.dtype);return[{dataId:m,shape:h.outShape,dtype:s.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=je(r,i.shape),c=In(i.shape,a)[1],h=re(c),d=[],f=n.makeTensorInfo([],"float32",new Float32Array([h]));d.push(f);const m=oa({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});d.push(m);const g=Ik({inputs:{a:m,b:f},backend:n});d.push(g);const v=yp({inputs:{x:g},backend:n,attrs:{axis:r,keepDims:o}});return d.forEach(_=>n.disposeIntermediateTensorInfo(_)),v}const Xae={kernelName:Iv,backendName:"cpu",kernelFunc:Kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"min");const a=je(r,i.shape);let l=a;const c=Bt(l,i.shape.length);let h=i;c!=null&&(h=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Zt(l.length,i.shape.length)),On("min",l,h.shape.length);const[d,f]=In(h.shape,l),m=re(f),g=Vn(re(d),h.dtype),v=n.data.get(h.dataId).values;for(let x=0;x<g.length;++x){const w=x*m;let C=v[w];for(let I=0;I<m;++I){const S=v[w+I];(Number.isNaN(S)||S<C)&&(C=S)}g[x]=C}c!=null&&n.disposeIntermediateTensorInfo(h);const _=n.makeTensorInfo(d,h.dtype,g);if(o){const x=sn(d,a),w=It({inputs:{x:_},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(_),w}return _}const Yae={kernelName:kv,backendName:"cpu",kernelFunc:Zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,mode:o}=s;Ie(i,"mirrorPad");const a=r.map((C,I)=>C[0]+i.shape[I]+C[1]),l=r.map(C=>C[0]),c=r.map((C,I)=>C[0]+i.shape[I]),h=o==="reflect"?0:1,d=n.data.get(i.dataId).values,f=i.shape.length,m=Te(i.shape),g=re(a),v=a.length,_=Te(a),x=Wn(i.dtype,g);for(let C=0;C<g;C++){let I=$u(C,v,_);for(let T=0;T<v;T++)I[T]<l[T]?I[T]=l[T]*2-I[T]-h:I[T]>=c[T]&&(I[T]=(c[T]-1)*2-I[T]+h);I=I.map((T,E)=>T-l[E]);const S=wr(I,f,m);x[C]=d[S]}return{dataId:n.write(x,a,i.dtype),shape:a,dtype:i.dtype}}const Jae={kernelName:Sv,backendName:"cpu",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ele=Qt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),tle=mn(Df,ele),nle={kernelName:Df,backendName:"cpu",kernelFunc:tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:r}=s,o=i.shape.length;let a=r;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=je([a],i.shape),c=Oz({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),h=sn(c.shape,l),d=It({inputs:{x:c},backend:n,attrs:{shape:h}}),f=bk({inputs:{a:i,b:d},backend:n}),m=B3({inputs:{x:f},backend:n}),g=yp({inputs:{x:m},backend:n,attrs:{axis:l,keepDims:!1}}),v=It({inputs:{x:g},backend:n,attrs:{shape:h}}),_=Ik({inputs:{a:m,b:v},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),_}const sle={kernelName:Gv,backendName:"cpu",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ile(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:r,seed:o,normalized:a}=s;Ie(i,"multinomial");const l=a?i:Lz({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=l.shape[0],h=l.shape[1],d=n.data.get(l.dataId).values,f=[c,r],m=Vn(re(f),"int32");for(let g=0;g<c;++g){const v=g*h,_=new Float32Array(h-1);_[0]=d[v];for(let C=1;C<_.length;++C)_[C]=_[C-1]+d[v+C];const x=aI.alea(o.toString()),w=g*r;for(let C=0;C<r;++C){const I=x();m[w+C]=_.length;for(let S=0;S<_.length;S++)if(I<_[S]){m[w+C]=S;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(f,"int32",m)}const rle={kernelName:oO,backendName:"cpu",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ole=gI;function ale(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Ie(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,h=n.data.get(r.dataId).values,{selectedIndices:d}=ole(c,h,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const lle={kernelName:wC,backendName:"cpu",kernelFunc:ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cle=yI;function ule(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;Ie(i,"NonMaxSuppressionPadded");const h=n.data.get(i.dataId).values,d=n.data.get(r.dataId).values,{selectedIndices:f,validOutputs:m}=cle(h,d,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}const hle={kernelName:bC,backendName:"cpu",kernelFunc:ule};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dle=vI;function fle(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;Ie(i,"NonMaxSuppressionWithScore");const h=n.data.get(i.dataId).values,d=n.data.get(r.dataId).values,f=o,m=a,g=l,v=c,{selectedIndices:_,selectedScores:x}=dle(h,d,f,m,g,v);return[n.makeTensorInfo([_.length],"int32",new Int32Array(_)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const ple={kernelName:CC,backendName:"cpu",kernelFunc:fle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{dtype:r,depth:o,onValue:a,offValue:l}=s;Ie(i,"oneHot");const c=re(i.shape),h=new Float32Array(c*o);h.fill(l);const d=n.data.get(i.dataId).values;for(let f=0;f<c;++f)d[f]>=0&&d[f]<o&&(h[f*o+d[f]]=a);return n.makeTensorInfo([...i.shape,o],r,h)}const gle={kernelName:$v,backendName:"cpu",kernelFunc:mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=$l({inputs:{input:s},backend:n}),r=sy({inputs:{x:i},backend:n}),o=mu({inputs:{input:s},backend:n}),a=sy({inputs:{x:o},backend:n}),l=bs({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return kk({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const yle={kernelName:qv,backendName:"cpu",kernelFunc:sy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fz(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=$l({inputs:{input:s},backend:n}),r=Fz({inputs:{x:i},backend:n}),o=mu({inputs:{input:s},backend:n}),a=sy({inputs:{x:o},backend:n}),l=bs({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return kk({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const vle={kernelName:Nv,backendName:"cpu",kernelFunc:Fz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mz(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(e.length===1)return ny({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const r=e[0].shape,o=e[0].dtype;e.forEach(h=>{V1(r,h.shape,"All tensors passed to stack must have matching shapes"),R(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const d=ny({inputs:{input:h},backend:n,attrs:{dim:i}});return a.push(d),d}),c=gu({inputs:l,backend:n,attrs:{axis:i}});return a.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const xle={kernelName:Rv,backendName:"cpu",kernelFunc:Mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,constantValue:o}=s;Ie(i,"pad");const a=r.map((w,C)=>w[0]+i.shape[C]+w[1]),l=r.map(w=>w[0]),c=n.data.get(i.dataId).values,h=re(i.shape),d=i.shape.length,f=Te(i.shape),m=re(a),g=a.length,v=Te(a),_=Wn(i.dtype,m);o!==0&&_.fill(o);for(let w=0;w<h;w++){const I=$u(w,d,f).map((T,E)=>T+l[E]),S=wr(I,g,v);_[S]=c[w]}return{dataId:n.write(_,a,i.dtype),shape:a,dtype:i.dtype}}const zz={kernelName:Av,backendName:"cpu",kernelFunc:_le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wle=Qt((t,e)=>Math.pow(t,e)),ble=mn(Of,wle),Cle={kernelName:Of,backendName:"cpu",kernelFunc:ble};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:i,paramsDenseValues:r,indices:o}=e,{outputRaggedRank:a}=s,l=i.map(x=>n.data.get(x.dataId).values),c=i.map(x=>x.shape),h=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,[f,m,g]=iz(l,c,h,r.shape,r.dtype,d,o.shape),v=f.map(x=>n.makeTensorInfo([x.length],"int32",x)),_=n.makeTensorInfo(g,r.dtype,m);return v.concat([_])}const kle={kernelName:aO,backendName:"cpu",kernelFunc:Ile};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(t){const{inputs:e,backend:n}=t,{starts:s,limits:i,deltas:r}=e,o=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,[c,h]=rz(o,s.shape,s.dtype,a,i.shape,l,r.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([h.length],s.dtype,h);return[d,f]}const Tle={kernelName:lO,backendName:"cpu",kernelFunc:Sle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(t){const{inputs:e,backend:n,attrs:s}=t,{shape:i,values:r,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.data.get(i.dataId).values,h=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,f=a.map(_=>n.data.get(_.dataId).values),m=a.map(_=>_.shape),[g,v]=oz(c,i.shape,h,r.shape,r.dtype,d,o.shape,f,m,l);return n.makeTensorInfo(g,r.dtype,v)}const Nle={kernelName:cO,backendName:"cpu",kernelFunc:Ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $le(t){const{backend:e,attrs:n}=t,{start:s,stop:i,dtype:r,step:o}=n,a=az(s,i,o,r);return e.makeTensorInfo([a.length],r,a)}const Rle={kernelName:IC,backendName:"cpu",kernelFunc:$le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ale=mt(Lf,t=>1/t),Dle={kernelName:Lf,backendName:"cpu",kernelFunc:Ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s;Ie(i,"resizeBilinear");const l=Te(i.shape),[c,h]=a,[d,f,m,g]=i.shape,v=n.data.get(i.dataId).values,_=new Float32Array(re([d,c,h,g])),x=[r&&c>1?f-1:f,r&&h>1?m-1:m],w=[r&&c>1?c-1:c,r&&h>1?h-1:h];let C=0;const I=x[0]/w[0],S=x[1]/w[1];for(let T=0;T<d;T++)for(let E=0;E<c;E++){let $;o?$=I*(E+.5)-.5:$=I*E;const D=Math.max(0,Math.floor($)),P=$-D,z=Math.min(f-1,Math.ceil($)),H=T*l[0]+D*l[1],Q=T*l[0]+z*l[1];for(let Z=0;Z<h;Z++){let J;o?J=S*(Z+.5)-.5:J=S*Z;const Y=Math.max(0,Math.floor(J)),oe=J-Y,O=Math.min(m-1,Math.ceil(J)),q=H+Y*l[2],V=Q+Y*l[2],te=H+O*l[2],ae=Q+O*l[2];for(let ue=0;ue<g;ue++){const he=v[q+ue],le=v[V+ue],ce=v[te+ue],we=v[ae+ue],Se=he+(ce-he)*oe,Ee=le+(we-le)*oe,Fe=Se+(Ee-Se)*P;_[C++]=Fe}}}return n.makeTensorInfo([d,c,h,g],"float32",_)}const Ole={kernelName:Fv,backendName:"cpu",kernelFunc:Ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lle(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s;Ie([r,i],"resizeBilinearGrad");const a=Te(i.shape),[l,c,h,d]=i.shape,[,f,m]=r.shape,g=new Float32Array(l*c*h*d),v=[o&&f>1?c-1:c,o&&m>1?h-1:h],_=[o&&f>1?f-1:f,o&&m>1?m-1:m],x=v[0]/_[0],w=v[1]/_[1],C=n.data.get(r.dataId).values;let I=0;for(let S=0;S<l;S++){const T=S*a[0];for(let E=0;E<f;E++){const $=E*x,D=Math.floor($),P=Math.min(Math.ceil($),c-1),z=T+D*a[1],H=T+P*a[1],Q=$-D,Z=1-Q;for(let J=0;J<m;J++){const Y=J*w,oe=Math.floor(Y),O=Math.min(Math.ceil(Y),h-1),q=Y-oe,V=1-q,te=z+oe*a[2],ae=z+O*a[2],ue=H+oe*a[2],he=H+O*a[2],le=Z*V,ce=Z*q,we=Q*V,Se=Q*q;for(let Ee=0;Ee<d;Ee++){const Fe=C[I++];g[te+Ee]+=Fe*le,g[ae+Ee]+=Fe*ce,g[ue+Ee]+=Fe*we,g[he+Ee]+=Fe*Se}}}}return n.makeTensorInfo([l,h,c,d],"float32",g)}const Fle={kernelName:TC,backendName:"cpu",kernelFunc:Lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mle(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s;Ie(i,"resizeNearestNeighbor");const l=Te(i.shape),[c,h]=a,[d,f,m,g]=i.shape,v=n.data.get(i.dataId).values,_=new Float32Array(d*c*h*g),x=[r&&c>1?f-1:f,r&&h>1?m-1:m],w=[r&&c>1?c-1:c,r&&h>1?h-1:h],C=x[0]/w[0],I=x[1]/w[1];let S=0;for(let T=0;T<d;T++){const E=T*l[0];for(let $=0;$<c;$++){const D=o?C*($+.5):C*$;let P=Math.min(f-1,r?Math.round(D):Math.floor(D));o&&(P=Math.max(0,P));const z=E+P*l[1];for(let H=0;H<h;H++){const Q=o?I*(H+.5):I*H;let Z=Math.min(m-1,r?Math.round(Q):Math.floor(Q));o&&(Z=Math.max(0,Z));const J=z+Z*l[2];for(let Y=0;Y<g;Y++){const oe=v[J+Y];_[S++]=oe}}}}return n.makeTensorInfo([d,c,h,g],i.dtype,_)}const zle={kernelName:Lv,backendName:"cpu",kernelFunc:Mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s;Ie([r,i],"resizeNearestNeighborGrad");const a=Te(i.shape),l=Te(r.shape),[c,h,d,f]=i.shape,[,m,g]=r.shape,v=new Float32Array(c*h*d*f),_=n.data.get(r.dataId).values,x=[o&&m>1?h-1:h,o&&g>1?d-1:d],w=[o&&m>1?m-1:m,o&&g>1?g-1:g],C=x[0]/w[0],I=x[1]/w[1],S=1/C,T=1/I,E=Math.ceil(S)*2+2,$=Math.ceil(T)*2+2;for(let D=0;D<c;D++){const P=D*a[0];for(let z=0;z<h;z++){const H=P+z*a[1],Q=Math.floor(z*S),Z=Math.floor(Q-E/2);for(let J=0;J<d;J++){const Y=H+J*a[2],oe=Math.floor(J*T),O=Math.floor(oe-$/2);for(let q=0;q<f;q++){let V=0;for(let te=0;te<E;te++){const ae=te+Z;if(ae<0||ae>=m)continue;const ue=P+ae*l[1],he=ae*C,le=Math.min(h-1,o?Math.round(he):Math.floor(he));if(z===le)for(let ce=0;ce<$;ce++){const we=ce+O;if(we<0||we>=g)continue;const Se=ue+we*l[2],Ee=we*I,Fe=Math.min(d-1,o?Math.round(Ee):Math.floor(Ee));J===Fe&&(V+=_[Se+q])}}v[Y+q]=V}}}}return n.makeTensorInfo(i.shape,i.dtype,v)}const Ule={kernelName:SC,backendName:"cpu",kernelFunc:Ble};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:r}=s;Ie(i,"reverse");const o=i.shape.length,a=je(r,i.shape);if(o===0)return Ar({inputs:{x:i},backend:n});const l=new An(i.shape,i.dtype),c=n.bufferSync(i);for(let h=0;h<l.size;h++){const d=l.indexToLoc(h),f=d.slice();a.forEach(m=>f[m]=i.shape[m]-1-f[m]),l.set(c.get(...f),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const Vle={kernelName:Mv,backendName:"cpu",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gle={kernelName:PC,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:r,center:o}=e,a=n,l=Wn(s.dtype,re(s.shape)),[c,h,d,f]=s.shape,[m,g]=$I(o,h,d),v=255,_=Math.sin(i),x=Math.cos(i),w=a.data.get(s.dataId).values;for(let I=0;I<c;I++){const S=I*d*h*f;for(let T=0;T<h;T++){const E=T*(d*f);for(let $=0;$<d;$++){const D=$*f;for(let P=0;P<f;P++){const z=[c,T,$,P],H=z[2],Q=z[1];let Z=(H-m)*x-(Q-g)*_,J=(H-m)*_+(Q-g)*x;Z=Math.round(Z+m),J=Math.round(J+g);let Y=r;if(typeof r!="number"&&(P===3?Y=v:Y=r[P]),Z>=0&&Z<d&&J>=0&&J<h){const O=J*(d*f),q=Z*f,V=S+O+q+P;Y=w[V]}const oe=S+E+D+P;l[oe]=Y}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jle=mt(zf,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),Hle={kernelName:zf,backendName:"cpu",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:r}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=Xl(r,i,o),f=!0,m=n.bufferSync(i),g=n.bufferSync(r),v=el(m,g,o,d,c,l,a,h,0,f);return n.makeTensorInfo(o,v.dtype,v.values)}const Kle={kernelName:uO,backendName:"cpu",kernelFunc:qle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xle(t,e){let n=0,s=t.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),t[i]<e?n=i+1:s=i;return s}function Zle(t,e){let n=0,s=t.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),t[i]<=e?n=i+1:s=i;return s}function Yle(t,e,n,s,i,r){const o=qt("int32",n*i);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),c=a*i;for(let h=0;h<i;++h)o[c+h]=r==="left"?Xle(l,e[h+c]):Zle(l,e[h+c])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qle(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:i,values:r}=e,{side:o}=s,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=Yle(a,l,i.shape[0],i.shape[1],r.shape[1],o);return n.makeTensorInfo(r.shape,"int32",c)}const Jle={kernelName:dO,backendName:"cpu",kernelFunc:Qle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ece(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:r}=e;Ie([s,i,r],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,h=Ds(i.dtype,r.dtype),d=Vn(re(i.shape),h);let f=0;const m=o===0||o>1||i.shape.length===1?1:re(i.shape.slice(1));for(let g=0;g<a.length;g++)for(let v=0;v<m;v++)a[g]===1?d[f++]=l[g]:d[f++]=c[g];return n.makeTensorInfo(i.shape,h,d)}const tce={kernelName:zv,backendName:"cpu",kernelFunc:ece};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce=sx,sce=ix,ice=mt(Uf,t=>t>=0?sce*t:nce*(Math.exp(t)-1)),rce={kernelName:Uf,backendName:"cpu",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=mt(Gf,t=>t<0?-1:t>0?1:0),ace={kernelName:Gf,backendName:"cpu",kernelFunc:oce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lce=mt(Wf,t=>Math.sin(t)),cce={kernelName:Wf,backendName:"cpu",kernelFunc:lce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uce=mt(Vf,t=>Math.sinh(t)),hce={kernelName:Vf,backendName:"cpu",kernelFunc:uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dce=11920928955078125e-23,O2=Math.log(dce)+2,fce=mt(Hf,t=>{const e=t>-O2,n=t<O2,s=Math.exp(t);let i;return n?i=s:e?i=t:i=Math.log(1+s),i}),pce={kernelName:Hf,backendName:"cpu",kernelFunc:fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,paddings:o}=s;Ie([i],"spaceToBatchND");const a=re(r),l=[[0,0]];l.push(...o);for(let T=1+r.length;T<i.shape.length;++T)l.push([0,0]);const c=zz.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),h=ap(c.shape,r,a,!1),d=lp(h.length,r.length,!1),f=cp(c.shape,r,a,!1),v=It({inputs:{x:c},backend:n,attrs:{shape:h}}),w=ms({inputs:{x:v},backend:n,attrs:{perm:d}}),S=It({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),S}const gce={kernelName:Wv,backendName:"cpu",kernelFunc:mce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yce(t){const{inputs:e,backend:n}=t,{indices:s,values:i,denseShape:r,defaultValue:o}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values[0],[d,f,m,g,v]=hz(a,s.shape,s.dtype,l,i.dtype,c,h);return[n.makeTensorInfo(f,s.dtype,d),n.makeTensorInfo([f[0]],i.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(_=>Number(_)))),n.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const vce={kernelName:fO,backendName:"cpu",kernelFunc:yce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:i,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(r.dataId).values),[c,h,d]=dz(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(h,s.dtype,c),n.makeTensorInfo([d.length],r.dtype,new Int32Array(d))]}const _ce={kernelName:pO,backendName:"cpu",kernelFunc:xce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${r.shape}`);if(i.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,[c,h]=wk(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(h,s.dtype,c)}const bce={kernelName:mO,backendName:"cpu",kernelFunc:wce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cce(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${r.shape}`);if(i.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,[c,h]=wk(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(h,s.dtype,c)}const Ice={kernelName:gO,backendName:"cpu",kernelFunc:Cce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kce(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:r,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:d,outputSize:f}=Xl(r,i,a),m=!1,g=n.bufferSync(i);let v;switch(r.dtype){case"bool":{const _=n.bufferSync(r),x=!!n.data.get(o.dataId).values[0];v=el(g,_,a,f,h,c,l,d,x,m);break}case"float32":{const _=n.bufferSync(r),x=n.data.get(o.dataId).values[0];v=el(g,_,a,f,h,c,l,d,x,m);break}case"int32":{const _=n.bufferSync(r),x=n.data.get(o.dataId).values[0];v=el(g,_,a,f,h,c,l,d,x,m);break}case"string":{const _=n.bufferSync(r),x=ta(n.data.get(o.dataId).values[0]);v=el(g,_,a,f,h,c,l,d,x,m);break}default:throw new Error(`Unsupported type ${r.dtype}`)}return n.makeTensorInfo(a,v.dtype,v.values)}const Sce={kernelName:yO,backendName:"cpu",kernelFunc:kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:r,axis:o}=s,a=je(o,i.shape)[0],l=jI(i,r,a),c=new Array(i.shape.length).fill(0),h=i.shape.slice();return l.map(d=>{const f=[...h];f[a]=d;const m=Rl({inputs:{x:i},backend:n,attrs:{begin:c,size:f}});return c[a]+=d,m})}const Ece={kernelName:Vv,backendName:"cpu",kernelFunc:Tce};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nce={kernelName:EC,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Ie(n,"square");const i=s.data.get(n.dataId).values,r=new Float32Array(i.length);for(let a=0;a<i.length;++a){const l=i[a];r[a]=l*l}return{dataId:s.write(r,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ce=mt(Jf,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),Rce={kernelName:Jf,backendName:"cpu",kernelFunc:$ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:f}=s;Ie(i,"stridedSlice");const{finalShapeSparse:m,finalShape:g,isIdentity:v,sliceDim0:_,isSimpleSlice:x,begin:w,end:C,strides:I}=TI(i.shape,r,o,a,l,c,h,d,f);let S;if(v)S=It({inputs:{x:i},backend:n,attrs:{shape:g}});else if(_||x){R(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const T=II(w,C,I),E=Rl({inputs:{x:i},backend:n,attrs:{begin:w,size:T}});S=It({inputs:{x:E},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(E)}else{const T=n.bufferSync(i),E=mz(m,T,I,w);S=n.makeTensorInfo(g,E.dtype,E.values)}return S}const Dce={kernelName:$C,backendName:"cpu",kernelFunc:Ace};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pce(t){const{inputs:e,backend:n,attrs:s}=t,{separator:i,nGramWidths:r,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:d}=e,f=n.data.get(h.dataId).values,m=n.data.get(d.dataId).values,[g,v]=gz(f,m,i,r,o,a,l,c);return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(d.shape,"int32",v)]}const Oce={kernelName:vO,backendName:"cpu",kernelFunc:Pce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:i}=s,{input:r,delimiter:o}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values[0],[c,h,d]=yz(a,l,i),f=h.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const Fce={kernelName:xO,backendName:"cpu",kernelFunc:Lce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mce(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:i}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(r.dataId).values,a=vz(o,i);return n.makeTensorInfo(r.shape,"int32",a)}const zce={kernelName:_O,backendName:"cpu",kernelFunc:Mce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bce=mt(Zf,t=>Math.tan(t)),Uce={kernelName:Zf,backendName:"cpu",kernelFunc:Bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wce=mt(Yf,t=>Math.tanh(t)),Vce={kernelName:Yf,backendName:"cpu",kernelFunc:Wce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gce(t){const{inputs:e,backend:n}=t,{tensor:s,indices:i,updates:r}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:c,outputSize:h}=Xl(r,i,s.shape),d=!1,f=n.bufferSync(i),m=n.bufferSync(r),g=n.bufferSync(s),v=el(f,m,s.shape,h,l,a,o,c,g,d);return n.makeTensorInfo(s.shape,v.dtype,v.values)}const jce={kernelName:hO,backendName:"cpu",kernelFunc:Gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:r}=s;Ie(i,"tile");const o=_z(n.bufferSync(i),r);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const qce={kernelName:Qf,backendName:"cpu",kernelFunc:Hce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:r,sorted:o}=s;Ie(i,"topk");const a=n.data.get(i.dataId).values,[l,c]=bz(a,i.shape,i.dtype,r,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const Xce={kernelName:RC,backendName:"cpu",kernelFunc:Kce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zce(t){const{inputs:e,attrs:n,backend:s}=t,{image:i,transforms:r}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[h,d,f,m]=i.shape,[g,v]=c??[d,f],_=[h,g,v,m],x=Te(i.shape),w=x[0],C=x[1],I=x[2],S=Te(_),T=S[0],E=S[1],$=S[2],D=Wn(i.dtype,re(_));D.fill(l);const P=s.data.get(i.dataId).values,z=s.data.get(r.dataId).values;for(let Q=0;Q<h;++Q){const Z=r.shape[0]===1?z:z.subarray(Q*8,Q*8+8);for(let J=0;J<g;++J)for(let Y=0;Y<v;++Y)for(let oe=0;oe<m;++oe){let O;const q=Z[6]*Y+Z[7]*J+1;if(q===0)continue;const V=(Z[0]*Y+Z[1]*J+Z[2])/q,te=(Z[3]*Y+Z[4]*J+Z[5])/q,ae=L2(V,f,a),ue=L2(te,d,a);switch(o){case"nearest":O=nue(P,d,f,w,C,I,Q,ue,ae,oe,l);break;case"bilinear":O=sue(P,d,f,w,C,I,Q,ue,ae,oe,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const he=Q*T+J*E+Y*$+oe;D[he]=O}return s.makeTensorInfo(_,i.dtype,D)}return{dataId:s.write(D,_,i.dtype),shape:i.shape,dtype:i.dtype}}const Yce={kernelName:AC,backendName:"cpu",kernelFunc:Zce};function L2(t,e,n){switch(n){case"reflect":return Qce(t,e);case"wrap":return Jce(t,e);case"nearest":return tue(t,e);case"constant":default:return eue(t)}}function Qce(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return vl(0,n,e-1)}function Jce(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return vl(0,n,e-1)}function eue(t,e){return t}function tue(t,e){return vl(0,t,e-1)}function Lh(t,e,n,s,i,r,o,a,l,c,h){const d=o*s+a*i+l*r+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:h}function nue(t,e,n,s,i,r,o,a,l,c,h){const d=Math.round(a),f=Math.round(l);return Lh(t,e,n,s,i,r,o,d,f,c,h)}function sue(t,e,n,s,i,r,o,a,l,c,h){const d=Math.floor(a),f=Math.floor(l),m=d+1,g=f+1,v=(g-l)*Lh(t,e,n,s,i,r,o,d,f,c,h)+(l-f)*Lh(t,e,n,s,i,r,o,d,g,c,h),_=(g-l)*Lh(t,e,n,s,i,r,o,m,f,c,h)+(l-f)*Lh(t,e,n,s,i,r,o,m,g,c,h);return(m-a)*v+(a-d)*_}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:r}=e;Ie(r,"unique");const o=s.data.get(r.dataId).values,{outputValues:a,outputShape:l,indices:c}=Cz(o,i,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const rue={kernelName:DC,backendName:"cpu",kernelFunc:iue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i.shape.length,a=i.shape[r],l=new Array(o-1);let c=0;for(let m=0;m<o;m++)m!==r&&(l[c++]=i.shape[m]);const h=new Array(o).fill(0),d=i.shape.slice();d[r]=1;const f=new Array(a);for(let m=0;m<f.length;m++){h[r]=m;const g=Rl({inputs:{x:i},backend:n,attrs:{begin:h,size:d}});f[m]=It({inputs:{x:g},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(g)}return f}const aue={kernelName:jv,backendName:"cpu",kernelFunc:oue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:r}=e,{numSegments:o}=s;Ie(i,"unsortedSegmentSum");const a=i.shape.length,l=r.shape.length,c=[],h=[],d=a-l;let f=r;for(let g=0;g<d;++g){const v=ny({inputs:{input:f},backend:n,attrs:{dim:g+1}});f=v,h.push(v)}for(let g=0;g<o;++g){const v=ya(g,"int32"),_=n.makeTensorInfo([],"int32",v),x=M3({inputs:{a:_,b:f},backend:n}),w=oa({inputs:{x},backend:n,attrs:{dtype:"float32"}}),C=yx({inputs:{a:w,b:i},backend:n}),I=yp({inputs:{x:C},backend:n,attrs:{axis:0,keepDims:!1}});c.push(I),h.push(_),h.push(x),h.push(w),h.push(C),h.push(I)}const m=Mz({inputs:c,backend:n,attrs:{axis:0}});return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const cue={kernelName:Hv,backendName:"cpu",kernelFunc:lue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uue=[ire,Mse,ore,lre,Gse,ure,dre,pre,gre,vre,_re,bre,Ire,Tre,Nre,Are,Pre,Lre,Mre,nre,Bre,Wre,Gre,Hse,Hre,Wse,Kse,Kre,zse,Zre,Qre,Jre,toe,soe,roe,aoe,coe,hoe,foe,moe,yoe,xoe,woe,Coe,Ioe,Soe,Eoe,$oe,Roe,Aoe,Doe,Ooe,Moe,Xie,Boe,Xse,Koe,Zse,Xoe,Qse,tae,nae,iae,eie,nie,oae,lae,uae,dae,iie,oie,Bse,pae,Yre,gae,vae,_ae,Zie,lie,uie,bae,die,Iae,Tae,Nae,Aae,Pae,Lae,Fae,pie,zae,Uae,Vae,jae,qae,Xae,Yae,gie,Jae,nle,rle,vie,_ie,lle,hle,ple,bie,gle,vle,xle,zz,Cle,Qie,kie,kle,Tle,Nle,Rle,Use,sb,Dle,Jie,ere,tre,Ole,Fle,zle,Ule,Vle,Gle,Hle,Die,Kle,Jle,tce,rce,Oie,ace,cce,hce,Lie,sle,pce,gce,vce,_ce,bce,Ice,Sce,Ece,zie,Nce,Uie,Vie,Rce,Dce,Oce,Fce,zce,qie,Loe,Uce,Vce,jce,qce,Xce,Yce,Cie,rue,aue,cue,yle];for(const t of uue)bO(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qa={},vm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function hue(t,e){qa[t]=e}function Ji(t,e){if(!(t in qa)||e!=null){const s=fue(t,e);if(s!==null)qa[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=qa[t];return n==null||n.isContextLost()?(delete qa[t],Ji(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),qa[t])}function due(t){if(!ee().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function fue(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??due(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete qa[t]},!1),ee().getBool("SOFTWARE_WEBGL_ENABLED")&&(vm.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",vm)||n.getContext("experimental-webgl",vm):n.getContext("webgl2",vm)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ld;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Ld||(Ld={}));var Ws;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Ws||(Ws={}));var $n;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})($n||($n={}));function vp(t,e){return[e,t]}function pue(t,e){return t*e}function xm(t){const e=re(t),n=Math.ceil(e/4);return I0(n)}function Mu(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function mue(t,e){const[n,s]=Mu(t,e);return n*s*4}function Sk(t,e){const n=t;let s,i,r,o,a,l,c,h,d,f;return ee().getNumber("WEBGL_VERSION")===2?(s=n.R32F,i=n.R16F,r=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,h=1,d=n.HALF_FLOAT,f=n.FLOAT,l=n.RGBA8):(s=t.RGBA,i=t.RGBA,r=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,h=4,d=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:h,textureTypeHalfFloat:d,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xe(t,e){const n=e();return ee().getBool("DEBUG")&&gue(t),n}function gue(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+_ue(t,e))}const yue=596e-10,vue=65504;function xue(t){return!!(ee().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||yue<Math.abs(t)&&Math.abs(t)<vue)}function _ue(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function _m(t,e){return yo(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function wue(t,e){const n=yo(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(xe(t,()=>t.shaderSource(n,e)),xe(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function bue(t,e){const n=yo(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(xe(t,()=>t.shaderSource(n,e)),xe(t,()=>t.compileShader(n)),ee().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw Bz(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Cue=/ERROR: [0-9]+:([0-9]+):/g;function Bz(t,e){const n=Cue.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],i=t.split(`
`),r=i.length.toString().length+2,o=i.map((d,f)=>jc((f+1).toString(),r)+d);let a=0;for(let d=0;d<o.length;d++)a=Math.max(o[d].length,a);const l=o.slice(0,s-1),c=o.slice(s-1,s),h=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${jc(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function Iue(t){return yo(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function kue(t,e){if(xe(t,()=>t.linkProgram(e)),!ee().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function nw(t,e){if(xe(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Sue(t,e){const n=yo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return xe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),xe(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Tue(t,e){const n=yo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return xe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),xe(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Eue(t){return yo(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Nue(t,e){const n=ee().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function $ue(t){return yo(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function F2(t,e,n,s,i,r,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(xe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),xe(t,()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,r,o)),xe(t,()=>t.enableVertexAttribArray(a)),!0)}function Rue(t,e,n){Lue(t,n),xe(t,()=>t.activeTexture(t.TEXTURE0+n)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function Aue(t,e,n){return yo(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function Due(t,e,n){return t.getUniformLocation(e,n)}function Pue(t,e,n,s){xe(t,()=>Rue(t,e,s)),xe(t,()=>t.uniform1i(n,s))}function sw(t,e,n){xe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),xe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function M2(t,e){xe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),xe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function wm(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Oue(t,e))}function Oue(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function yo(t,e,n){const s=xe(t,()=>e());if(s==null)throw new Error(n);return s}function Lue(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function yu(t,e=2){return re(t.slice(0,t.length-e))}function vu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function bm(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[yu(t),...vu(t)]),e}function Fue(t,e=!1){let n=ee().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ee().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ee().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?W1(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=ga(t).newShape);let i=re(t),r=null;t.length<=1&&i<=n?r=[1,i]:t.length===2&&t[0]<=n&&t[1]<=n?r=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?r=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?r=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?r=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(r=[t[0],t[1]*t[2]*t[3]]);const o=r!=null&&Math.max(...r)>s&&Math.min(...r)<=(e?2:1)&&Math.min(...r)>0;if(r==null||o)if(e){const a=yu(t);let l=2,c=2;t.length&&([l,c]=vu(t)),i=a*(l/2)*(c/2),r=I0(i).map(h=>h*2)}else r=I0(i);return r}function Cm(t){return t%2===0}function iy(t,e){if(t=t.slice(-2),e=e.slice(-2),ct(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Cm(n)&&Cm(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Cm(t[0])&&Cm(e[0])}let iw,rw;function Mue(t){if(iw==null){const e=Ji(t);iw=e.getParameter(e.MAX_TEXTURE_SIZE)}return iw}function zue(t){if(rw==null){const e=Ji(t);rw=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,rw)}function Bue(t){if(t===0)return 0;let e;const n=Ji(t);return pi(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:pi(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function pi(t,e){return t.getExtension(e)!=null}function z2(t){try{if(Ji(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Uue(t){if(t===0)return!1;const e=Ji(t);if(t===1){if(!pi(e,"OES_texture_float"))return!1}else if(!pi(e,"EXT_color_buffer_float"))return!1;return rb(e)}function Wue(t){if(t===0)return!1;const e=Ji(t);if(t===1){if(!pi(e,"OES_texture_float")||!pi(e,"WEBGL_color_buffer_float"))return!1}else{if(pi(e,"EXT_color_buffer_float"))return rb(e);const s="EXT_color_buffer_half_float";if(pi(e,s)){const i=e.getExtension(s);return Vue(e,i)}return!1}return rb(e)}function rb(t){const e=Sk(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function Vue(t,e){const n=Sk(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function Gue(t){return t!==2?!1:Ji(t).fenceSync!=null}function xp(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&R(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ke=ee();ke.registerFlag("HAS_WEBGL",()=>ke.getNumber("WEBGL_VERSION")>0);ke.registerFlag("WEBGL_VERSION",()=>z2(2)?2:z2(1)?1:0);ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ke.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ke.get("WEBGL_VERSION")===2);ke.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ke.registerFlag("WEBGL_PACK",()=>ke.getBool("HAS_WEBGL"));ke.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_CLIP",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_REDUCE",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_LAZILY_UNPACK",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_CONV_IM2COL",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Mue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>zue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=ke.getNumber("WEBGL_VERSION");return t===0?0:Bue(t)});ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!zO());ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Uue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Wue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Gue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});ke.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>zO()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ke.registerFlag("WEBGL_EXP_CONV",()=>!1);ke.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ke.getBool("IS_TEST"));ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ke.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ke.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(){let t,e,n,s,i,r,o,a,l,c;return ee().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",i="texture",r="outputColor",o="out vec4 outputColor;",a=ee().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",i="texture2D",r="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:i,output:r,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(t,e,n="index"){const s=Te(e);return s.map((i,r)=>{const o=`int ${t[r]} = ${n} / ${i}`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${i}`:`index -= ${t[r]} * ${i}`;return`${o}; ${a};`}).join("")}function vx(t,e,n="index"){const s=Te(e);return s.map((i,r)=>{const o=`int ${t[r]} = ${n} / outShapeStrides[${r}]`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * outShapeStrides[${r}]`:`index -= ${t[r]} * outShapeStrides[${r}]`;return`${o}; ${a};`}).join("")}function jue(t,e){const n=t.length,s=t.map(r=>`${e}[${r}]`),i=new Array(n-1);i[n-2]=s[n-1];for(let r=n-3;r>=0;--r)i[r]=`(${i[r+1]} * ${s[r+1]})`;return i}function Hue(t,e,n="index"){const s=t.map((r,o)=>o),i=jue(s,e);return i.map((r,o)=>{const a=`int ${t[o]} = ${n} / ${i[o]}`,l=o===i.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${i[o]}`:`index -= ${t[o]} * ${i[o]}`;return`${a}; ${l};`}).join("")}function Tk(t){const e=Te(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Ek(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const Uz=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:Wz}=$J;function que(t,e,n){const s=[];if(t.forEach(m=>{const g=re(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?s.push(`uniform float ${m.name}${g>1?`[${g}]`:""};`):(s.push(`uniform sampler2D ${m.name};`),s.push(`uniform int offset${m.name};`)),n.enableShapeUniforms){const{uniformShape:v}=Nk(n.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(v.length){case 1:s.push(`uniform int ${m.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${m.name}Shape;`);break}s.push(`uniform ivec2 ${m.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(m=>{s.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});const i=s.join(`
`),r=t.map(m=>Kue(m,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=rs(),l=Yue(a);let c,h,d=ehe(a);return e.isPacked?(c=Xue(e.logicalShape,o,n.enableShapeUniforms),h=Jue(a)):(c=Zue(e.logicalShape,o,n.enableShapeUniforms),h=Que(a)),n.packedInputs&&(d+=ihe),[d,l,h,i,c,r,n.userCode].join(`
`)}function zu(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return ghe(t,e);case 1:return vhe(t,e);case 2:return _he(t,e);case 3:return bhe(t,e);case 4:return Ihe(t,e);case 5:return khe(t);case 6:return She(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Vz(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return mhe(t);case 1:return yhe(t,e);case 2:return xhe(t,e);case 3:return whe(t,e);default:return Che(t,e)}}function Kue(t,e,n=!1,s){let i="";n?i+=Vz(t,s):i+=zu(t,s);const r=t.shapeInfo.logicalShape,o=e.logicalShape;return r.length<=o.length&&(n?i+=The(t,e):i+=Ehe(t,e)),i}function Xue(t,e,n){switch(t.length){case 0:return Gz();case 1:return rhe(t,e,n);case 2:return fhe(t,e,n);case 3:return ahe(t,e,n);default:return che(t,e,n)}}function Zue(t,e,n){switch(t.length){case 0:return Gz();case 1:return ohe(t,e,n);case 2:return phe(t,e,n);case 3:return lhe(t,e,n);case 4:return uhe(t,e,n);case 5:return hhe(t,e);case 6:return dhe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Yue(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Que(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Jue(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function ehe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${the}
    ${nhe}
    ${she}
  `}const the=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,nhe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,she=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ihe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Gz(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function rhe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function ohe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function ahe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),r=i*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function lhe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${vx(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Ql(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function che(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),r=i*Math.ceil(t[t.length-2]/2);let o=r,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${t.length}(${l});
    }
  `}function uhe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${vx(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ql(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function hhe(t,e){const n=Ql(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function dhe(t,e){const n=Ql(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function fhe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(ct(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const i=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function phe(t,e,n){return ct(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Jl(t){return`offset${t}`}function mhe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=rs();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function ghe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[i,r]=t.shapeInfo.texShape;if(i===1&&r===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Jl(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function yhe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,r=rs();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${r.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${r.texture2D}(${n}, uv);
    }
  `}function vhe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Bu(t)}
      }
    `;const i=t.shapeInfo.texShape,r=i[0],o=i[1];if(o===1&&r===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Jl(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${r}.0);
        return sampleTexture(${n}, uv);
      }
    `:r===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${r}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function xhe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,o=r[0],a=r[1],l=rs();if(r!=null&&ct(n,r))return e?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],h=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function _he(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape;if(r!=null&&ct(n,r)){if(e)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=r[0],m=r[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=ga(n),l=o;if(l.length<n.length){const f=Uu(t,l),m=["row","col"];return`
      ${zu(f,e)}
      float ${i}(int row, int col) {
        return ${i}(${Wu(m,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Bu(t)}
      }
    `;const c=r[0],h=r[1],d=Jl(s);return h===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function whe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(n[0]===1){const f=n.slice(1),m=[1,2],g=Uu(t,f),v=["b","row","col"];return`
        ${Vz(g,e)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${Wu(v,m)});
        }
      `}const a=rs();if(e)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],c=o[1],h=Math.ceil(n[2]/2),d=h*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${h}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function bhe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=ga(n),c=a;if(c.length<n.length){const v=Uu(t,c),_=["row","col","depth"];return`
        ${zu(v,e)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${Wu(_,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${r}, ${o}, 1)));
        ${Bu(t)}
      }
    `;const h=t.shapeInfo.texShape,d=h[0],f=h[1],m=t.shapeInfo.flatOffset;if(f===r&&m==null)return e?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===o&&m==null)return e?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const g=Jl(s);return e?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${g};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r} + col * ${o} + depth + ${g};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function Che(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=rs();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const r=t.shapeInfo.logicalShape,o=r.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],h=l[1],d=Math.ceil(r[o-1]/2);let f=d*Math.ceil(r[o-2]/2),m="int b, int row, int col",g=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let v=2;v<o-1;v++)m=`int b${v}, `+m,f*=r[o-v-1],g=`b${v} * ${f} + `+g;return`
    vec4 ${s}(${m}) {
      int index = ${g};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${c});
      return ${i.texture2D}(${n}, uv);
    }
  `}function Ihe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[3],o=n[2]*r,a=n[1]*o,{newShape:l,keptDims:c}=ga(n);if(l.length<n.length){const w=Uu(t,l),C=["row","col","depth","depth2"];return`
      ${zu(w,e)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${Wu(C,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${r}, 1)));
        ${Bu(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],m=d[1],g=`int stride2 = ${s}Shape[3];`,v=`int stride1 = ${s}Shape[2] * stride2;`,_=`int stride0 = ${s}Shape[1] * stride1;`;if(m===a&&h==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${g}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(m===r&&h==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const x=Jl(s);return e?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${g}
      ${v}
      ${_}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${x});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${r} + depth2;
      vec2 uv = uvFromFlat(${f}, ${m}, index + ${x});
      return sampleTexture(${s}, uv);
    }
  `}function khe(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],r=e[3]*i,o=e[2]*r,a=e[1]*o,{newShape:l,keptDims:c}=ga(e);if(l.length<e.length){const v=Uu(t,l),_=["row","col","depth","depth2","depth3"];return`
      ${zu(v)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Wu(_,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${r}, ${i})) +
          depth3;
        ${Bu(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],m=d[1];if(m===a&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${r}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(m===i&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=Jl(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${r} +
          depth2 * ${i} + depth3 + ${g};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${n}, uv);
    }
  `}function She(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:r}=ga(e);if(i.length<e.length){const _=Uu(t,i),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${zu(_)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Wu(x,r)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,h=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Bu(t)}
      }
    `;const d=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,m=f[0],g=f[1];if(g===h&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(g===o&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;const v=Jl(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Bu(t){const e=t.name,n=re(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function The(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",r=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=Wz(t.shapeInfo.logicalShape,e.logicalShape),l=yt(o),c=o-r;let h;const d=["x","y","z","w","u","v"];r===0?h="":o<2&&a.length>=1?h="coords = 0;":h=a.map(w=>`coords.${d[w+c]} = 0;`).join(`
`);let f="";o<2&&r>0?f="coords":f=t.shapeInfo.logicalShape.map((w,C)=>`coords.${d[C+c]}`).join(", ");let m="return outputValue;";const v=re(t.shapeInfo.logicalShape)===1,x=re(e.logicalShape)===1;if(r===1&&!v&&!x)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!x)o===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=r-2,C=r-1;a.indexOf(w)>-1&&a.indexOf(C)>-1?m="return vec4(outputValue.x);":a.indexOf(w)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(C)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${f});
      ${m}
    }
  `}function Ehe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",r=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&ct(o,r))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=yt(l),h=Wz(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let f;const m=["x","y","z","w","u","v"];a===0?f="":l<2&&h.length>=1?f="coords = 0;":f=h.map(v=>`coords.${m[v+d]} = 0;`).join(`
`);let g="";return l<2&&a>0?g="coords":g=t.shapeInfo.logicalShape.map((v,_)=>`coords.${m[_+d]}`).join(", "),`
    float ${i}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${s}(${g});
    }
  `}function yt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Nk(t,e,n){const{newShape:s,keptDims:i}=ga(e),r=e.length,o=t&&r===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&r>1&&!ct(e,n)&&s.length<r||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:i}}function Uu(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Wu(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nhe(t,e,n,s){const i=n.map((h,d)=>{const f={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(f.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:f}}),r=i.map(h=>h.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=que(i,o,e),l=bue(t.gl,a),c=t.createProgram(l);return ee().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:r,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:r,outShapeInfo:o},jz(t,e,c)))}function jz(t,e,n){const s=[],i=[];let r,o,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),ee().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const h=!1;for(const d of e.variableNames){const f={name:d,uniform:t.getUniformLocation(n,d,h),offset:t.getUniformLocation(n,`offset${d}`,h)};e.enableShapeUniforms&&(f.shape=t.getUniformLocation(n,`${d}Shape`,h),f.texShape=t.getUniformLocation(n,`${d}TexShape`,h)),s.push(f)}if(e.enableShapeUniforms&&(r=t.getUniformLocation(n,"outShape",h),a=t.getUniformLocation(n,"outShapeStrides",h),o=t.getUniformLocation(n,"outTexShape",h)),e.customUniforms)for(const d of e.customUniforms)i.push(t.getUniformLocation(n,d.name,h));return{variablesLocations:s,customUniformLocations:i,infLoc:l,nanLoc:c,outShapeLocation:r,outShapeStridesLocation:a,outTexShapeLocation:o}}function B2(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const i=n.logicalShape,r=e[s],o=r.shape;if(!ct(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(n.isUniform&&r.isUniform)return;const a=n.texShape,l=r.isUniform?null:r.texData.texShape;if(!ct(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function $he(t,e,n,s,i){e.program.enableShapeUniforms||(B2(e.inShapeInfos,n),B2([e.outShapeInfo],[s]));const r=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(r.texture,o[0],o[1]):t.setOutputMatrixTexture(r.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),ee().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:h,offset:d,shape:f,texShape:m}=e.variablesLocations[l];if(f){const{uniformShape:g}=Nk(e.program.packedInputs,c.shape,c.texData.texShape);switch(g.length){case 1:t.gl.uniform1iv(f,new Int32Array(g));break;case 2:t.gl.uniform2iv(f,new Int32Array(g));break;case 3:t.gl.uniform3iv(f,new Int32Array(g));break;case 4:t.gl.uniform4iv(f,new Int32Array(g));break}}if(m&&t.gl.uniform2i(m,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(re(c.shape)<2)t.gl.uniform1f(h,c.uniformValues[0]);else{let g=c.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),t.gl.uniform1fv(h,g)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,h,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Te(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&i)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],h=e.customUniformLocations[l],d=i[l];if(c.type==="float")t.gl.uniform1fv(h,d);else if(c.type==="vec2")t.gl.uniform2fv(h,d);else if(c.type==="vec3")t.gl.uniform3fv(h,d);else if(c.type==="vec4")t.gl.uniform4fv(h,d);else if(c.type==="int")t.gl.uniform1iv(h,d);else if(c.type==="ivec2")t.gl.uniform2iv(h,d);else if(c.type==="ivec3")t.gl.uniform3iv(h,d);else if(c.type==="ivec4")t.gl.uniform4iv(h,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function Rhe(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:h,keptDims:d}=Nk(t.packedInputs,o.shape,l);let f="",m="",g="";if(h.length===1&&t.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${S[0]>1}_${S[1]>1}`}else if(h.length===2&&!t.packedInputs)m=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!t.packedInputs){const S=Te(h);g=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const v=o.shape.length,_=h.length===2&&ct(o.shape,l),x=re(o.shape)===1,w=uu(o.shape,n.shape),C=!t.packedInputs&&v===n.shape.length&&ct(l,n.texData.texShape),I=t.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${v}_${C}_${c?d:""}_${h.length}_${x}_${w}_${_}_${f}_${m}_${g}_${I}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const i=t.userCode;let r=t.constructor.name;return r+="_"+s+"_"+i+`${ee().getNumber("WEBGL_VERSION")}`,r}function qn(t){return ee().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ahe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ld.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?vx(["r","c","d"],e):Ql(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dhe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ld.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?vx(["r","c","d"],e):Ql(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Phe{constructor(e){this.variableNames=["A"],this.outTexUsage=Ws.DOWNLOAD;const n=rs();this.outputShape=e,this.userCode=`
      ${Uz}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ohe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ws.DOWNLOAD;const n=rs();this.outputShape=e,this.userCode=`
      ${Uz}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lhe={R:0,G:1,B:2,A:3};class U2{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);let r="result";n&&(r="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Lhe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Ek():Tk(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${o}
        }
        ${i.output} = vec4(${r}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fhe{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);let i="",r="result";n&&(r="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Ek():Tk(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${s.output} = ${r};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mhe(t){const e=rs(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return wue(t,n)}function zhe(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Sue(t,e)}function Bhe(t){const e=new Uint16Array([0,1,2,2,1,3]);return Tue(t,e)}function _p(t,e,n,s,i,r){Nue(e,n);const o=Eue(t),a=t.TEXTURE_2D;return xe(t,()=>t.bindTexture(a,o)),xe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),xe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),xe(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),xe(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ee().getNumber("WEBGL_VERSION")===1?xe(t,()=>t.texImage2D(a,0,s,e,n,0,i,r,null)):xe(t,()=>t.texStorage2D(a,1,s,e,n)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function Hz(t){return t.internalFormatFloat}function Uhe(t,e,n,s){const[i,r]=vp(e,n);return _p(t,i,r,Hz(s),s.textureFormatFloat,t.FLOAT)}function qz(t){return t.internalFormatHalfFloat}function Whe(t,e,n,s){const[i,r]=vp(e,n);return _p(t,i,r,qz(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function Kz(t){return t.downloadTextureFormat}function Vhe(t,e,n,s){const[i,r]=vp(e,n);return _p(t,i,r,Kz(s),t.RGBA,t.UNSIGNED_BYTE)}function Xz(t){return t.internalFormatPackedFloat}function Ghe(t,e,n,s){const[i,r]=Mu(e,n);return _p(t,i,r,Xz(s),t.RGBA,t.FLOAT)}function Zz(t){return t.internalFormatPackedHalfFloat}function jhe(t,e,n,s){const[i,r]=Mu(e,n);return _p(t,i,r,Zz(s),t.RGBA,s.textureTypeHalfFloat)}function Hhe(t,e,n){return xe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),F2(t,e,"clipSpacePos",n,3,20,0)&&F2(t,e,"uv",n,2,20,12)}function qhe(t,e,n,s,i,r){xe(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;i instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=r.internalFormatPackedFloat),o.set(i),ee().getNumber("WEBGL_VERSION")===2?xe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):xe(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Khe(t,e,n){xe(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?ee().getNumber("WEBGL_VERSION")===2?xe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):xe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):ee().getNumber("WEBGL_VERSION")===2?xe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):xe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Xhe(t,e,n,s){const i=t.createBuffer();xe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i));const a=4*4*e*n;return xe(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),xe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),xe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),i}function Zhe(t,e,n){const s=t,i=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function Yhe(t,e,n,s){const[i,r]=vp(e,n),o=4,a=new Uint8Array(pue(e*n,o));return xe(t,()=>t.readPixels(0,0,i,r,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Qhe(t,e,n,s,i,r,o,a){const l=t,c=new Float32Array(mue(r,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Jhe(t,e,n){const s=new Float32Array(e*n*4);return xe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ow{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ee().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,hue(n,e)):this.gl=Ji(n),e=this.gl,ee().getNumber("WEBGL_VERSION")===2){const r=e;this.createVertexArray=()=>xe(r,()=>r.createVertexArray()),this.bindVertexArray=o=>xe(r,()=>r.bindVertexArray(o)),this.deleteVertexArray=o=>xe(r,()=>r.deleteVertexArray(o)),this.getVertexArray=()=>xe(r,()=>r.getParameter(r.VERTEX_ARRAY_BINDING))}else if(e!=null){const r=e.getExtension("OES_vertex_array_object");if(r==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>xe(e,()=>r.createVertexArrayOES()),this.bindVertexArray=o=>xe(e,()=>r.bindVertexArrayOES(o)),this.deleteVertexArray=o=>xe(e,()=>r.deleteVertexArrayOES(o)),this.getVertexArray=()=>xe(e,()=>e.getParameter(r.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ee().getNumber("WEBGL_VERSION")===1){const r="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=_m(this.gl,r),pi(this.gl,o))this.textureHalfFloatExtension=_m(this.gl,o);else if(ee().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),pi(this.gl,i))this.colorBufferHalfFloatExtension=_m(this.gl,i);else if(ee().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",pi(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(pi(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=zhe(this.gl),this.indexBuffer=Bhe(this.gl),this.framebuffer=$ue(this.gl),this.textureConfig=Sk(this.gl,this.textureHalfFloatExtension)}get debug(){return ee().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;xe(e,()=>e.finish()),xe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),xe(e,()=>e.deleteFramebuffer(this.framebuffer)),xe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),xe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),xe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),Uhe(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),Whe(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),Vhe(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),Khe(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,i){this.throwIfDisposed(),qhe(this.gl,e,n,s,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),jhe(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),Ghe(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(M2(this.gl,this.framebuffer),this.outputTexture=null),xe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Yhe(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,i,r,o){return Qhe(this.gl,e,n,s,i,r,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return Zhe(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const i=Xhe(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(ee().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=i.clientWaitSync(r,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},n=r}else ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Jhe(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Mhe(n));const s=Iue(n);xe(n,()=>n.attachShader(s,this.vertexShader)),xe(n,()=>n.attachShader(s,e)),kue(n,s);const i=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&nw(n,i),i}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;xe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Hhe(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(xe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&nw(this.gl,this.program),xe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?Aue(this.gl,e,n):Due(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),xe(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),Pue(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[i,r]=Mu(n,s);this.setOutputMatrixTextureDriver(e,i,r)}setOutputMatrixWriteRegion(e,n,s,i){this.setOutputMatrixWriteRegionDriver(s,e,i,n)}setOutputPackedMatrixWriteRegion(e,n,s,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&nw(this.gl,this.program),wm(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}xe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),xe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=_m(this.gl,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),r=s.createQuery();return s.beginQuery(i.TIME_ELAPSED_EXT,r),r}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await IN(()=>this.disposed||this.isQueryAvailable(e,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),r=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),r&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),i=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=ede(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ee().platform&&(s=ee().platform.setTimeoutCustom.bind(ee().platform)),IN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),sw(this.gl,e,this.framebuffer),this.debug&&wm(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(sw(this.gl,this.outputTexture,this.framebuffer),this.debug&&wm(this.gl)):M2(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const i=this.gl;sw(i,e,this.framebuffer),this.debug&&wm(i),this.outputTexture=e,xe(i,()=>i.viewport(0,0,n,s)),xe(i,()=>i.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,i){this.throwIfDisposed(),xe(this.gl,()=>this.gl.scissor(e,n,s,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function ede(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:tde,bincountImpl:Yz,bincountReduceImpl:nde,bitwiseAndImpl:sde,castImpl:ide,ceilImpl:rde,concatImpl:ode,equalImpl:ade,expImpl:lde,expm1Impl:cde,floorImpl:ude,gatherNdImpl:hde,gatherV2Impl:dde,greaterImpl:fde,greaterEqualImpl:pde,lessImpl:mde,lessEqualImpl:gde,linSpaceImpl:yde,logImpl:vde,maxImpl:xde,maximumImpl:_de,minimumImpl:wde,multiplyImpl:bde,negImpl:Cde,notEqualImpl:Ide,prodImpl:kde,raggedGatherImpl:Sde,raggedRangeImpl:Tde,raggedTensorToTensorImpl:Ede,rangeImpl:Nde,rsqrtImpl:$de,scatterImpl:Rde,sigmoidImpl:Ade,simpleAbsImpl:Qz,sliceImpl:Dde,sparseFillEmptyRowsImpl:Pde,sparseReshapeImpl:Ode,sparseSegmentReductionImpl:Jz,sqrtImpl:Lde,staticRegexReplaceImpl:Fde,stridedSliceImpl:Mde,stringNGramsImpl:zde,stringSplitImpl:Bde,stringToHashBucketFastImpl:Ude,subImpl:Wde,tileImpl:Vde,topKImpl:Gde,transposeImpl:$k,uniqueImpl:jde}=Kie;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function ts(t,e){return e===1?[t]:eB(t,e)}function Hde(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qde{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=qn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=ts("rc",this.rank),s=yt(this.rank),i=this.getOutOfBoundsCondition(n),r=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${r}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let r=`${s===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)r=`${e[e.length-1-o]},`+r;n.push(r)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${i};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tB{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);let s="";for(let i=0;i<4;i++){let r="thisRC = rc;";i%2===1&&(r+="thisRC.z += 1;"),i>1&&(r+="thisRC.y += 1;"),s+=`
        ${r}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${Kde(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Ek():Tk(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function Kde(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Hue(["r","c","d"],"inputShape"):Ql(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xde{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const i=V2(n,s),r=G2(e,i,s);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const o=W2(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[r].pop();return this.usedTextures[r].push(l),l}let a;return i===$n.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===$n.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===$n.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===$n.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===$n.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,i){if(this.freeTextures==null)return;const r=V2(s,i),o=G2(n,r,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=W2(n,r,this.gpgpu.gl,this.gpgpu.textureConfig,i),l=ee().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],h=c&&c.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[h]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Zde(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function W2(t,e,n,s,i){const r=Yde(e,s);let o;if(i){const[l,c]=Mu(t[0],t[1]);o=l*c}else{const[l,c]=vp(t[0],t[1]);o=l*c}const a=Zde(n,r);return o*a}function Yde(t,e){switch(t){case $n.PACKED_2X2_FLOAT32:return Xz(e);case $n.PACKED_2X2_FLOAT16:return Zz(e);case $n.UNPACKED_FLOAT32:return Hz(e);case $n.UNPACKED_FLOAT16:return qz(e);case $n.PACKED_4X1_UNSIGNED_BYTE:return Kz(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Qde(t){return ee().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?$n.PACKED_2X2_FLOAT32:$n.UNPACKED_FLOAT32:t?$n.PACKED_2X2_FLOAT16:$n.UNPACKED_FLOAT16}function V2(t,e){if(t===Ws.UPLOAD)return $n.PACKED_2X2_FLOAT32;if(t===Ws.RENDER||t==null)return Qde(e);if(t===Ws.DOWNLOAD||t===Ws.PIXELS)return $n.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function G2(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gr{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Ci="if (isnan(x)) return x;",Jde="return x;",j2="return abs(x);",efe="return (x >= 0.0) ? x : (exp(x) - 1.0);",tfe=Ci+`
  return (x < 0.0) ? 0.0 : x;
`,nfe=Ci+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Io="return x;",sfe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ife="return x;",rfe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ofe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,afe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lfe="return 1.0 / (1.0 + exp(-1.0 * x));";class Lo{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cfe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);const n=e.length,s=ts("rc",n),i=yt(n),r=Hde(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${r});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ufe=SL,hfe=1e-7,dfe=1e-4,Im={};function ffe(t){return t in Im||(Im[t]={}),Im[t]}const pfe=ee().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),mfe=600;function gfe(){return ee().global.screen==null?1024:ee().global.screen.height*ee().global.screen.width*window.devicePixelRatio*mfe/1024/1024}class xx extends U1{nextDataId(){return xx.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ee().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof ow)n=e;else{const s=Ji(ee().getNumber("WEBGL_VERSION"),e);n=new ow(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Ji(ee().getNumber("WEBGL_VERSION"));n=new ow(s),this.binaryCache=ffe(ee().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Xde(this.gpgpu),this.numMBBeforeWarning=gfe(),this.texData=new KP(this,cr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,i,r,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[i,r]},l.texShape=[i,r];const c=bm(n),h=new U2(c,!1,o),d=this.runWebGLProgram(h,[a],s,[[i,r]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((ee().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ee().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:s,values:e,usage:Ws.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,i,r){if(ee().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:i,values:n,usage:Ws.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:i,complexTensorInfos:r,slice:o,shape:a,isPacked:l}=n;if(o!=null){let f;l?f=new Lo(a,Io):f=new gr(a,Io);const m=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:i}],i),g=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return s;const c=this.activeTimers!=null;let h;c&&(h=ls());let d;if(i==="complex64"){const f=this.readSync(r.real.dataId),m=this.readSync(r.imag.dataId);d=lo(f,m)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=ls()-h),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const g=this.pendingRead.get(e);return new Promise(v=>g.push(v))}const n=this.texData.get(e),{values:s,shape:i,slice:r,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(r!=null){let g;l?g=new Lo(i,Io):g=new gr(i,Io);const v=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:o}],o),_=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),_}if(s!=null)return this.convertAndCacheOnCPU(e);if(ee().getBool("DEBUG")&&!ee().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ee().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,h;if(o!=="complex64"&&ee().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const g=this.texData.get(h.dataId);c=this.gpgpu.createBufferFromTexture(g.texture.texture,...xm(i))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(o==="complex64"){const g=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),v=g[0],_=g[1];d=lo(v,_)}else if(c==null)d=this.getValuesFromTexture(e);else{const g=re(i);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,g)}if(h!=null&&this.disposeIntermediateTensorInfo(h),c!=null){const g=this.gpgpu.gl;xe(g,()=>g.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,d),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(g=>g(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&cr().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,n={}){const s=this.texData.get(e),{values:i,shape:r,slice:o,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let m;l?m=new Lo(r,Io):m=new gr(r,Io);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:a}],a),v=this.readToGPU(g,n);return this.disposeIntermediateTensorInfo(g),v}if(c==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,n.customTexShape),d=cr().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(i=>ta(i));return Ge(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ge(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!xue(s))throw ee().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:i}=this.texData.get(e),r=re(n);if(ee().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),m=this.texData.get(f.dataId),g=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...xm(n)).subarray(0,r);return this.disposeIntermediateTensorInfo(f),g}const o=ee().getBool("WEBGL_PACK")&&i===!0,a=o?bm(n):n,l=o?new Ohe(a):new Phe(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),h=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,e();const r=xl(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=xl(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(r);a.kernelMs=R8(l),a.getExtraProfileInfo=()=>l.map((c,h)=>({name:o[h],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ls(),endMs:null}}endTimer(e){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ls(),e)}async getQueryTime(e){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:i,usage:r,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(n,i,r,o)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=pfe){return ee().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&re(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Bs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return ufe(e.shape,n)}packedUnaryOp(e,n,s){const i=new Lo(e.shape,n),r=this.compileAndRun(i,[e],s);return cr().makeTensorFromTensorInfo(r)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const i=Qz(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(ee().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,j2,e.dtype);const n=new gr(e.shape,j2),s=this.compileAndRun(n,[e]);return cr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&sf(s[0])){const r=s.map(o=>Xo(o));i=this.write(r,e,n)}else i=this.write(s,e,n);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:n}}makeOutput(e,n,s){return cr().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new cfe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new qde(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[yu(e.shape),...vu(e.shape)],i={dtype:e.dtype,shape:s,dataId:e.dataId},r=[yu(n),...vu(n)],o=new tB(r,s),a=!0,l=[s],c=this.runWebGLProgram(o,[i],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:i,shape:r,dtype:o}=s;if(n!=null){const f=re(r),m=n[0]*n[1]*4;R(f<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=bm(r);let l;i?l=new Dhe(a):l=new Ahe(a);const c=!0,h=[n??xm(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,h,c,n);return{dtype:o,shape:r,dataId:d.dataId}}runWebGLProgram(e,n,s,i,r=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Ld.DENSE){const x=o??xm(e.outputShape);l.texShape=x.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),re(a.shape)===0)return l.values=Wn(a.dtype,0),a;const c=[],h=n.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(x.dataId);if(w.texture==null){if(!e.packedInputs&&re(x.shape)<=ee().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!w.isPacked!=!!e.packedInputs)x=w.isPacked?this.unpackTensor(x):this.packTensor(x),c.push(x),w=this.texData.get(x.dataId);else if(w.isPacked&&!iy(w.shape,x.shape)){const C=x,I=x.shape;x.shape=w.shape,x=this.packedReshape(x,I),c.push(x),w=this.texData.get(x.dataId),C.shape=I}return{shape:x.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},f=Rhe(e,h,d),m=this.getAndSaveBinary(f,()=>Nhe(this.gpgpu,e,h,d)),g=this.activeTimers!=null;let v;g&&(v=this.startTimer()),ee().get("ENGINE_COMPILE_ONLY")||$he(this.gpgpu,m,h,d,i),c.forEach(x=>this.disposeIntermediateTensorInfo(x)),g&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const _=ee().getNumber("WEBGL_FLUSH_THRESHOLD");if(_>0){const x=ls();x-this.lastGlFlushTime>_&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!ee().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&r===!1){const x=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),x}return a}compileAndRun(e,n,s,i,r=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,i,r)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ee().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=X(()=>{if(!ee().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ee().getBool("DEBUG");ee().set("DEBUG",!1);const n=this.abs(rt(1e-8)).dataSync()[0];if(ee().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?hfe:dfe}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:i,values:r,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let h;c&&(h=ls());let d=n.texShape;if(d==null&&(d=Fue(s,l),n.texShape=d),r!=null){const f=bm(s);let m,g=d[1],v=d[0];const _=r instanceof Uint8Array||r instanceof Uint8ClampedArray;(l||!_)&&([g,v]=Mu(d[0],d[1])),l?m=new Fhe(f,_):m=new U2(f,_);const x=_?[v,g]:d,w=this.makeTensorInfo(x,i),C=this.texData.get(w.dataId);_?C.usage=Ws.PIXELS:C.usage=Ws.UPLOAD,C.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),g,v,r);const I=[[v,g]],T=this.runWebGLProgram(m,[w],i,I,!0),E=this.texData.get(T.dataId);n.texShape=E.texShape,n.isPacked=E.isPacked,n.usage=E.usage,ee().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(n.texture=E.texture,n.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(w),c&&(this.uploadWaitMs+=ls()-h)}else{const f=this.acquireTexture(d,a,i,l);n.texture=f}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:i}=s;return n!=null&&(s.values=yfe(n,i)),s.values}acquireTexture(e,n,s,i){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const r=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${r} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,i)}computeBytes(e,n){return e[0]*e[1]*Rg(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(r){throw r}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await jL(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Bz(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:i,nanLoc:r,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=jz(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=i,e.nanLoc=r,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:i,height:r,width:o,channels:a}=e,l=cr().backend;if(!l.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(i,n,s,r,o,a);return cr().makeTensorFromDataId(c,n,s,l)}}xx.nextDataId=0;function yfe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */BO()&&VO("webgl",()=>new xx,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rk=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Al{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=ze(n,s),this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Vu{constructor(e,n,s,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ze(n,s);const r=this.outputShape.length;this.enableShapeUniforms=qn(r);let o="";if(i)if(r===0||re(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${yt(r)} coords = getOutputCoords();
        `,r===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=ts("coords",r);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= outShape[${r} - 2];
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= outShape[${r} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= ${this.outputShape[r-2]};
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= ${this.outputShape[r-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Os(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const vfe={kernelName:kf,backendName:"webgl",kernelFunc:Os};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,r=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(r.dataId),a=Os({inputs:{x:s},backend:n}),l=Os({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:l},r}const xfe={kernelName:tC,backendName:"webgl",kernelFunc:Sa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nB="return (a < 0.) ? b * a : a;",sB=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function _fe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:r}=s,o=n.makeTensorInfo([],"float32",ya(r,"float32")),a=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(sB,i.shape,o.shape):new Al(nB,i.shape,o.shape),l=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const wfe={kernelName:pv,backendName:"webgl",kernelFunc:_fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iB="return (a < 0.) ? b * a : a;",rB=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function bfe(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e,r=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(rB,s.shape,i.shape):new Al(iB,s.shape,i.shape);return n.runWebGLProgram(r,[s,i],"float32")}const Cfe={kernelName:Dv,backendName:"webgl",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gu="if (isnan(x)) return x;";function tt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:i,backend:r})=>{const{x:o}=i,a=r,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const d=a.texData.get(o.dataId),f=n(d.values,l);return a.makeTensorInfo(o.shape,l,f)}const c=ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return c?h=new Lo(o.shape,e):h=new gr(o.shape,t),a.runWebGLProgram(h,[o],l)}}function Ln({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:r}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,h=a;if(s&&l.dtype==="complex64"){const g=h.texData.get(l.dataId),v=h.texData.get(c.dataId),[_,x]=[[g.complexTensorInfos.real,v.complexTensorInfos.real],[g.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(C=>{const[I,S]=C,T={dataId:I.dataId,dtype:I.dtype,shape:l.shape},E={dataId:S.dataId,dtype:S.dtype,shape:c.shape},$=new Al(t,l.shape,c.shape);return h.runWebGLProgram($,[T,E],Ds(I.dtype,S.dtype))}),w=Sa({inputs:{real:_,imag:x},backend:h});return h.disposeIntermediateTensorInfo(_),h.disposeIntermediateTensorInfo(x),w}const d=r||Ds(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||h.shouldExecuteOnCPU([l,c]))&&i!=null){const g=h.texData.get(l.dataId).values,v=h.texData.get(c.dataId).values,_=l.dtype==="string"?co(g):g,x=l.dtype==="string"?co(v):v,[w,C]=i(l.shape,c.shape,_,x,d),I=h.makeTensorInfo(C,d),S=h.texData.get(I.dataId);return S.values=w,I}const f=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let m;return f?m=new Vu(e,l.shape,c.shape,n):m=new Al(t,l.shape,c.shape),h.runWebGLProgram(m,[l,c],d)}}function Fd(t,e=!1){if(t==="linear")return e?ife:Jde;if(t==="relu")return e?ofe:tfe;if(t==="elu")return e?rfe:efe;if(t==="relu6")return e?afe:nfe;if(t==="prelu")return e?rB:iB;if(t==="leakyrelu")return e?sB:nB;if(t==="sigmoid")return e?lfe:sfe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oB{constructor(e,n,s,i=!1,r=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=qn(this.outputShape.length);const h=i?e[1]:e[2],d=Math.ceil(h/2),f=i?"i * 2, rc.y":"rc.y, i * 2",m=r?"rc.z, i * 2":"i * 2, rc.z",g=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let _="",x="";a&&(l?_=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?_=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:_=`vec4 activation(vec4 x) {
          ${a}
        }`,x="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let C="rc.x",I="rc.x";e[0]<n[0]?C=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(I=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${_}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${C};
        int batchB = ${I};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${v[0]});
          result += (${g[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${x}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H2={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class q2{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ze(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2="return a * b;";function Ak(t){const{inputs:e,backend:n}=t,{a:s,b:i}=e,r=Ds(s.dtype,i.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(i.dataId),c=new q2(H2.REAL,s.shape,i.shape),h=new q2(H2.IMAG,s.shape,i.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:i.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:i.shape}],f=n.runWebGLProgram(c,d,"float32"),m=n.runWebGLProgram(h,d,"float32"),g=Sa({inputs:{real:f,imag:m},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}if(n.shouldExecuteOnCPU([s,i])){const a=n.texData.get(s.dataId),l=n.texData.get(i.dataId),[c,h]=bde(s.shape,i.shape,a.values,l.values,r),d=n.makeTensorInfo(h,r),f=n.texData.get(d.dataId);return f.values=c,d}let o;return ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Vu(K2,s.shape,i.shape):o=new Al(K2,s.shape,i.shape),n.runWebGLProgram(o,[s,i],r)}const Ife={kernelName:Pf,backendName:"webgl",kernelFunc:Ak};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kfe(t,e,n){const s=[yu(t.shape),...vu(t.shape)],i={dtype:t.dtype,shape:s,dataId:t.dataId},r=[yu(e),...vu(e)],o=new tB(r,s),a=!0,l=[s],c=n.runWebGLProgram(o,[i],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:r}=s,o=n,a=re(i.shape),l=XP(r,a),c=re(l);R(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const h=o.texData.get(i.dataId);return h.isPacked&&!iy(i.shape,l)&&!(h.texture!==null&&iy(h.shape,l))?kfe(i,l,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype})}const Sfe={kernelName:Ov,backendName:"webgl",kernelFunc:ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X2{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:r,outSize:o}=e;this.outputShape=[i,o];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${ou(d)?d.toPrecision(2):d}, ones);`}let h="";r%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tfe{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:r,outSize:o}=e;this.outputShape=[i,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const h=Math.floor(s/4)*4,d=s%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let g="";r%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Efe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=nx(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function tc(t,e,n,s){const i=Efe(t.shape);let r=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:l,outSize:c}=i[o];let h,d;n==="mean"?h=o===0?new X2({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new X2({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):h=new Tfe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=r,r=s.runWebGLProgram(h,[r],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nfe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const i=yt(this.rank),r=$fe(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${r}));
    }
    `}}function $fe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let i=0;i<t.length;i++)s[t[i]]=n[i];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rfe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let h=0;h<s.length;h++)s[h]=e[n[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=yt(this.rank),r=eB("rc",this.rank),o=new Array(this.rank);for(let h=0;h<n.length;h++)o[n[h]]=r[h];const a=`vec2(${o.slice(-2).join()})`,l=`++${r[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${r[this.rank-1]};
      if(++${r[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _x(t,e,n){const s=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Rfe(t.shape,e):new Nfe(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Afe(t,e,n,s){const i=e,r=t.shape.length,o=je(i,t.shape);let a=o;const l=Bt(a,r),c=l!=null;let h=t;c&&(h=_x(t,l,s),a=Zt(a.length,r)),On("sum",a,r);const[d,f]=In(h.shape,a);let m=d;n&&(m=sn(d,o));const g=re(f),_=re(t.shape)/g,x=ye({inputs:{x:h},attrs:{shape:[_,g]},backend:s}),w=LC(t.dtype),C=tc(x,w,"sum",s),I=ye({inputs:{x:C},attrs:{shape:m},backend:s});return s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(C),c&&s.disposeIntermediateTensorInfo(h),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wx(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;return Afe(i,r,o,n)}const Dfe={kernelName:Uv,backendName:"webgl",kernelFunc:wx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function is(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{perm:r}=s,o=n,a=i.shape.length,l=new Array(a);for(let h=0;h<l.length;h++)l[h]=i.shape[r[h]];let c;if(o.shouldExecuteOnCPU([i])){const d=o.texData.get(i.dataId).values,f=$k(d,i.shape,i.dtype,r,l);c=o.makeTensorInfo(l,i.dtype);const m=o.texData.get(c.dataId);m.values=f}else c=_x(i,r,o);return c}const Pfe={kernelName:Hc,backendName:"webgl",kernelFunc:is};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aB=1e3;function ry({a:t,b:e,transposeA:n,transposeB:s,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,h=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],f=s?e.shape[h-1]:e.shape[h-2],m=n?t.shape[c-1]:t.shape[c-2],g=s?e.shape[h-2]:e.shape[h-1],v=t.shape.slice(0,-2),_=e.shape.slice(0,-2),x=re(v),w=re(_),I=ze(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([m,g]);R(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=n?[x,d,m]:[x,m,d],T=s?[w,g,f]:[w,f,g],E=ye({inputs:{x:t},backend:i,attrs:{shape:S}}),$=ye({inputs:{x:e},backend:i,attrs:{shape:T}}),D=[E,$],P=Math.max(x,w),z=n?E.shape[1]:E.shape[2],H=r!=null,Q=o!=null,Z=l==="leakyrelu",J=l!=null?Fd(l,!0):null,Y=H||Q||Z||J!=null;let oe;if((m===1||g===1)&&z>aB&&Y===!1){let q=E,V=$;n&&(q=is({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),D.push(q)),s&&(V=is({inputs:{x:$},backend:i,attrs:{perm:[0,2,1]}}),D.push(V));const te=g!==1,ae=g===1;let ue=q;te&&(ue=ye({inputs:{x:q},backend:i,attrs:{shape:[P,z,1]}}),D.push(ue));const he=g===1?2:1;let le=V;ae&&(le=ye({inputs:{x:V},backend:i,attrs:{shape:[P,1,z]}}),D.push(le));const ce=Ak({inputs:{a:ue,b:le},backend:i});oe=wx({inputs:{x:ce},backend:i,attrs:{axis:he,keepDims:!0}}),D.push(ce)}else{const q=Ds(t.dtype,e.dtype),V=new oB(S,T,[P,m,g],n,s,H,J,Q,Z),te=[E,$];if(r!=null&&te.push(r),Q&&te.push(o),Z){const ae=i.makeTensorInfo([],"float32",ya(a,"float32"));te.push(ae),D.push(ae)}oe=i.runWebGLProgram(V,te,q)}const O=ye({inputs:{x:oe},backend:i,attrs:{shape:I}});D.push(oe);for(const q of D)i.disposeIntermediateTensorInfo(q);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ofe(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:d}=s;return ry({a:i,b:r,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:d,activation:h})}const Lfe={kernelName:Ag,backendName:"webgl",kernelFunc:Ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2="return abs(x);";function Ffe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const r=n.texData.get(s.dataId),o=Qz(r.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let i;return ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Lo(s.shape,Z2):i=new gr(s.shape,Z2),n.runWebGLProgram(i,[s],s.dtype)}const Mfe={kernelName:Ky,backendName:"webgl",kernelFunc:Ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zfe=Ci+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Bfe=tt({opSnippet:zfe}),Ufe={kernelName:rf,backendName:"webgl",kernelFunc:Bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wfe=Ci+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Vfe=tt({opSnippet:Wfe}),Gfe={kernelName:of,backendName:"webgl",kernelFunc:Vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2="return a + b;",jfe=Ln({opSnippet:Y2,packedOpSnippet:Y2,supportsComplex:!0,cpuKernelImpl:tde}),Hfe={kernelName:Ru,backendName:"webgl",kernelFunc:jfe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qfe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((r,o)=>`T${o}`);const s=[];this.variableNames.forEach(r=>{s.push(`float v${r} = get${r}AtOutCoords();`)});const i=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kfe{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((r,o)=>`T${o}`);const s=[];this.variableNames.forEach(r=>{s.push(`vec4 v${r} = get${r}AtOutCoords();`)});const i=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jm(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Os({inputs:{x:s[0]},backend:n});if(s.length>ee().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=jm({inputs:s.slice(0,l),backend:n}),h=jm({inputs:s.slice(l),backend:n});return jm({inputs:[c,h],backend:n})}const i=s.map(l=>l.dtype).reduce((l,c)=>Ds(l,c)),r=s.map(l=>l.shape),a=ee().getBool("WEBGL_PACK")?new Kfe(s[0].shape,r):new qfe(s[0].shape,r);return n.runWebGLProgram(a,s,i)}const Xfe={kernelName:K1,backendName:"webgl",kernelFunc:jm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=je(r,i.shape);let c=l;const h=Bt(c,a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Zt(c.length,a)),On("all",c,a);const[f,m]=In(d.shape,c),g=re(m),v=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),_=tc(v,v.dtype,"all",n);let x;if(o){const w=sn(f,l);x=ye({inputs:{x:_},backend:n,attrs:{shape:w}})}else x=ye({inputs:{x:_},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(_),h!=null&&n.disposeIntermediateTensorInfo(d),x}const Yfe={kernelName:X1,backendName:"webgl",kernelFunc:Zfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=je(r,i.shape);let c=l;const h=Bt(c,a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Zt(c.length,a)),On("any",c,a);const[f,m]=In(d.shape,c),g=re(m),v=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),_=tc(v,v.dtype,"any",n);let x;if(o){const w=sn(f,l);x=ye({inputs:{x:_},backend:n,attrs:{shape:w}})}else x=ye({inputs:{x:_},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(_),h!=null&&n.disposeIntermediateTensorInfo(d),x}const Jfe={kernelName:Z1,backendName:"webgl",kernelFunc:Qfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class epe{constructor(e,n,s){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[r,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tpe{constructor(e,n,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,R(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const r=e[e.length-1],o=Math.ceil(r/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=yt(l),h=ts("coords",l);let d,f;if(o===1){f=l+1;const $=yt(f);d=`
        ${$} sourceLocR = ${$}(${h.join()}, 0);
        ++${h[l-1]};
        ${$} sourceLocG = ${$}(${h.join()}, 0);
        ++${h[l-2]};
        ${$} sourceLocA = ${$}(${h.join()}, 0);
        --${h[l-1]};
        ${$} sourceLocB = ${$}(${h.join()}, 0);
        --${h[l-2]};`}else f=l,d=`
        ${c} sourceLocR = coords;
        ++${h[l-1]};
        ${c} sourceLocG = coords;
        ++${h[l-2]};
        ${c} sourceLocA = coords;
        --${h[l-1]};
        ${c} sourceLocB = coords;
        --${h[l-2]};`;const m=["x","y","z","w","u","v"].slice(0,f),g="."+m[f-1],v=m.map($=>"int "+$),_=ts("sourceLocR",f-1).concat("inIdx.r"),x=ts("sourceLocG",f-1).concat("inIdx.g"),w=ts("sourceLocB",f-1).concat("inIdx.b"),C=ts("sourceLocA",f-1).concat("inIdx.a"),I=s==="max"?"greaterThan":"lessThan",S=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${_.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${C.join()})));`,T=`vec4(
            getAChannel(${_.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${C.join()}) : 0.)`,E=i?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${E}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${T};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${T};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${I}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(t,e,n,s=null){let i=e.shape[0],r=e.shape[1];s!=null&&(i=s.shape[0],r=s.shape[1]);const o=nx(r),a={windowSize:o,inSize:r,batchSize:i,outSize:Math.ceil(r/o)},l=new epe(a,n,s==null),c=[e];s!=null&&c.push(s);const h=t.runWebGLProgram(l,c,"int32");if(h.shape[1]===1)return h;const d=lB(t,e,n,h);return t.disposeIntermediateTensorInfo(h),d}function cB(t,e,n,s=null){const i=s!=null?s.shape:e.shape,r=i[i.length-1],o=nx(r),a=new tpe(i,o,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const h=cB(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}return c}function uB(t,e,n,s){const i=[n];if(On("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,e.shape.length),!ee().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const r=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),r.push(l));const[c,h]=In(l.shape,i),d=re(h),f=ye({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});r.push(f);const m=lB(t,f,s);r.push(m);const g=ye({inputs:{x:m},backend:t,attrs:{shape:c}});return r.forEach(v=>t.disposeIntermediateTensorInfo(v)),g}return cB(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;let o=je(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=is({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),On("argMax",[o[0]],l.shape.length);const h=uB(n,l,o[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),h}const spe={kernelName:Xy,backendName:"webgl",kernelFunc:npe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ipe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;let o=je(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=is({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),On("argMin",[o[0]],l.shape.length);const h=uB(n,l,o[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),h}const rpe={kernelName:Zy,backendName:"webgl",kernelFunc:ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ope=Ci+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,ape=tt({opSnippet:ope}),lpe={kernelName:af,backendName:"webgl",kernelFunc:ape};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cpe=Ci+"return log(x + sqrt(x * x + 1.0));",upe=tt({opSnippet:cpe}),hpe={kernelName:lf,backendName:"webgl",kernelFunc:upe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dpe=Ci+`
  return atan(x);
`,fpe=tt({opSnippet:dpe}),ppe={kernelName:cf,backendName:"webgl",kernelFunc:fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mpe=Rk+`
  return atan(a, b);
`,gpe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ec+`
  return result;
`,ype=Ln({opSnippet:mpe,packedOpSnippet:gpe}),vpe={kernelName:hf,backendName:"webgl",kernelFunc:ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xpe=Ci+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,_pe=tt({opSnippet:xpe}),wpe={kernelName:uf,backendName:"webgl",kernelFunc:_pe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Md{constructor(e,n,s,i=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg",_=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,x=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(v||(w="-1.0 / 1e-20"),s){const $=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${m}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${$} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?r?_:x:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const C="max";let I=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(I="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,T=o%4,E=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${m}, ${g});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${E}
          }

          int xC = xCCorner + ${S};
          if (${T===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${T===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${T===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${E}
          }
        }
        setOutput(${I});
      }
    `}}class Dk{constructor(e,n,s,i=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=e.dilationDepth,d=e.dilationHeight,f=e.dilationWidth,m=e.effectiveFilterDepth,g=e.effectiveFilterHeight,v=e.effectiveFilterWidth,_=e.padInfo.front,x=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const C=n==="avg";let I="0.0";if(C||(I="-1.0 / 1e-20"),s){const P=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${_}, ${x}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${P} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?r?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${g} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let T=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(T="avgValue / max(count, 1.0)");const E=Math.floor(o/4)*4,$=o%4,D=`
      if (${C}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${_}, ${x}, ${w});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${E}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${D}
            }

            int xC = xCCorner + ${E};
            if (${$===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${$===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${$===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${D}
            }
          }
        }
        setOutput(${T});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;xp(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(jn(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=wi(i.shape,r,o,c,a,l);if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))return Os({inputs:{x:i},backend:n});const d=new Md(h,"avg",!1);return n.runWebGLProgram(d,[i],"float32")}const Cpe={kernelName:Yy,backendName:"webgl",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ipe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s,h=[1,1,1],d=mo(i.shape,r,o,h,a,l,c),f=new Dk(d,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const kpe={kernelName:Qy,backendName:"webgl",kernelFunc:Ipe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Spe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.top,d=c-1-e.padInfo.left,f=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Tpe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,i=e.filterWidth,r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=d-1-e.padInfo.front,v=f-1-e.padInfo.top,_=m-1-e.padInfo.left,x=1/(n*s*i);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${v}, ${_});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Epe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r,{filterSize:a,strides:l,pad:c,dimRoundingMode:h}=s,d=[1,1,1],f=mo(o.shape,a,l,d,c,h),m=new Tpe(f);return n.runWebGLProgram(m,[i],o.dtype)}const Npe={kernelName:Q1,backendName:"webgl",kernelFunc:Epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $pe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r;xp([i,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,h=wi(o.shape,a,l,1,c),d=new Spe(h);return n.runWebGLProgram(d,[i],o.dtype)}const Rpe={kernelName:Y1,backendName:"webgl",kernelFunc:$pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ape(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r}=e,{transposeA:o,transposeB:a}=s;return ry({a:i,b:r,transposeA:o,transposeB:a,backend:n})}const Dpe={kernelName:Jy,backendName:"webgl",kernelFunc:Ape};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ppe{constructor(e,n,s,i,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ze(e,n),ze(e,s);let a="0.0";i!=null&&(ze(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";r!=null&&(ze(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ope{constructor(e,n,s,i,r,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ze(e,n),ze(e,s);let a="vec4(0.0)";i!=null&&(ze(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";r!=null&&(ze(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lpe=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:i,variance:r,offset:o,scale:a}=t;R(i.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,i,r];let h=null;o!=null&&(h=o.shape,c.push(o));let d=null;a!=null&&(d=a.shape,c.push(a));const f=ee().getBool("WEBGL_PACK_NORMALIZATION")?new Ope(s.shape,i.shape,r.shape,h,d,l):new Ppe(s.shape,i.shape,r.shape,h,d,l);return e.runWebGLProgram(f,c,c[0].dtype)},Fpe={kernelName:hv,backendName:"webgl",kernelFunc:Lpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mpe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=yt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=zpe(this.rank);let i;const r=e.map((o,a)=>`sourceLoc.${ob[a]} = start[${a}] + coords.${ob[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${r.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${s}));
      }
    `}}const ob=["x","y","z","w","u","v"];function zpe(t){if(t===1)return"sourceLoc";if(t<=6)return ob.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bpe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=yt(this.rank),s=ts("coords",this.rank),i=ts("sourceLoc",this.rank),r=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${r})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((h,d)=>`start[${d}]`).join()});`:e.map((h,d)=>`${i[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Upe(t,e,n,s){const i=s.texData.get(t.dataId),r=s.makeTensorInfo(n,t.dtype),o=s.texData.get(r.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=SI(e,Te(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),r}function ju(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,size:o}=s,[a,l]=tx(i,r,o);if(CI(i,a,l),re(l)===0)return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const d=n.texData.get(i.dataId),f=Dde(d.values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,f)}const{isPacked:c}=n.texData.get(i.dataId),h=kI(i.shape,a,l);if(c||!h){const d=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Bpe(l):new Mpe(l),f=[a];return n.runWebGLProgram(d,[i],i.dtype,f)}return n.uploadToGPU(i.dataId),Upe(i,a,l,n)}const Wpe={kernelName:Bv,backendName:"webgl",kernelFunc:ju};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vpe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,crops:o}=s;R(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((w,C)=>w*C),l=ap(i.shape,r,a),c=lp(l.length,r.length),h=cp(i.shape,r,a),d=RI(o,r.length),f=AI(h,o,r.length),m=[],g=ye({inputs:{x:i},backend:n,attrs:{shape:l}}),v=is({inputs:{x:g},backend:n,attrs:{perm:c}}),_=ye({inputs:{x:v},backend:n,attrs:{shape:h}}),x=ju({inputs:{x:_},backend:n,attrs:{begin:d,size:f}});return m.push(g),m.push(v),m.push(_),m.forEach(w=>n.disposeIntermediateTensorInfo(w)),x},Gpe={kernelName:ev,backendName:"webgl",kernelFunc:Vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o}=s,a=n.readSync(i.dataId),l=n.readSync(r.dataId),c=Yz(a,l,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,c)}const Hpe={kernelName:J1,backendName:"webgl",kernelFunc:jpe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qpe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Kpe=`
  return float(int(a.r) & int(b.r));
`;function Xpe(t){const{inputs:e,backend:n}=t,{a:s,b:i}=e,r=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=ee().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,i])||o===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(i.dataId).values,[h,d]=sde(s.shape,i.shape,l,c,s.dtype),f=n.makeTensorInfo(d,s.dtype),m=n.texData.get(f.dataId);return m.values=h,f}let a;return r?a=new Vu(qpe,s.shape,i.shape,!1):a=new Al(Kpe,s.shape,i.shape),n.runWebGLProgram(a,[s,i],s.dtype)}const Zpe={kernelName:eC,backendName:"webgl",kernelFunc:Xpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(t){const{inputs:e,backend:n}=t,{s0:s,s1:i}=e,r=n.readSync(s.dataId),o=n.readSync(i.dataId),a=ze(Array.from(r),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Qpe={kernelName:tO,backendName:"webgl",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jpe="return float(a != b);",hB=Ln({opSnippet:Jpe,cpuKernelImpl:Ide,dtype:"bool"}),eme={kernelName:Ev,backendName:"webgl",kernelFunc:hB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return Os({inputs:{x:i.complexTensorInfos.real},backend:n})}const tme={kernelName:kC,backendName:"webgl",kernelFunc:wp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nme="return float(int(x));";function sme(t,e){const n=new gr(t.shape,nme),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ab(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:r}=s;if(r==="complex64"){if(i.dtype==="complex64")return Os({inputs:{x:i},backend:n});const o=_n(i.shape),a=ab({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),l=Sa({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(i.dtype==="complex64"){const o=wp({inputs:{input:i},backend:n}),a=ab({inputs:{x:o},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(o),a}if(!ZP(i.dtype,r)){const o=Os({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:r}}if(n.shouldExecuteOnCPU([i])){const o=n.texData.get(i.dataId).values,[a,l,c]=ide(o,i.shape,i.dtype,r);return n.makeTensorInfo(a,l,c)}if(r==="int32")return sme(i,n);if(r==="bool"){const o=n.makeTensorInfo([],"bool",Wn("bool",1)),l=hB({inputs:{a:i,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${r}`)}const ime={kernelName:df,backendName:"webgl",kernelFunc:ab};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q2="return ceil(x);",rme=tt({opSnippet:Q2,packedOpSnippet:Q2,cpuKernelImpl:rde}),ome={kernelName:ff,backendName:"webgl",kernelFunc:rme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ame{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lme{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{clipValueMin:r,clipValueMax:o}=s;let a;ee().getBool("WEBGL_PACK_CLIP")?a=new lme(i.shape):a=new ame(i.shape);const l=[[r],[o]];return n.runWebGLProgram(a,[i],i.dtype,l)}const ume={kernelName:pf,backendName:"webgl",kernelFunc:cme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hme{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function dme(t){const{inputs:e,backend:n}=t,{x:s}=e,i=n.texData.get(s.dataId),r=new hme(s.shape),o=[J2(s,i.complexTensorInfos.real),J2(s,i.complexTensorInfos.imag)];return n.runWebGLProgram(r,o,o[0].dtype)}const fme={kernelName:tv,backendName:"webgl",kernelFunc:dme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pme{constructor(e){this.outputShape=[],this.outputShape=Cr(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=n.length,r=n[n.length-1];s.push(`else setOutput(getT${i}(yR, yC-${r}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mme{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Cr(e,n);const s=this.outputShape,i=s.length,r=yt(i),o=ts("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((v,_)=>`T${_}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let v=1;v<l.length;v++)l[v]=l[v-1]+e[v][n];const c=a[n],h=a.slice(-2),d=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${h.join()}));
        }`;for(let v=1;v<l.length;v++){const _=l[v-1];f+=`
        if (${c} < ${l[v]}  && ${c} >= ${l[v-1]}) {
          return getChannel(
            getT${v}(${km(a,c,_)}),
            vec2(${km(h,c,_)}));
        }`}const m=l.length,g=l[l.length-1];f+=`
        return getChannel(
          getT${m}(${km(a,c,g)}),
          vec2(${km(h,c,g)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${f}
      }

      void main() {
        ${r} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${s[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${s[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${s[i-2]} &&
            ${o[i-1]} < ${s[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function km(t,e,n){const s=t.indexOf(e);return t.map((r,o)=>o===s?`${r} - ${n}`:r).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bx(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return Os({inputs:{x:i.complexTensorInfos.imag},backend:n})}const gme={kernelName:yC,backendName:"webgl",kernelFunc:bx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fh(t,e,n){const s=t[0].dtype;if(s==="complex64"){const m=t.map(w=>wp({inputs:{input:w},backend:n})),g=t.map(w=>bx({inputs:{input:w},backend:n})),v=Fh(m,e,n),_=Fh(g,e,n),x=Sa({inputs:{real:v,imag:_},backend:n});return m.forEach(w=>n.disposeIntermediateTensorInfo(w)),g.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(_),x}let i=n.shouldExecuteOnCPU(t);if(s==="string"&&(i=!0),i){const m=t.map(I=>{const T=[-1,re(I.shape.slice(e))];return ye({inputs:{x:I},backend:n,attrs:{shape:T}})}),g=m.map(I=>({vals:n.readSync(I.dataId),shape:I.shape})),v=Cr(m.map(I=>I.shape),1),_=m[0].shape[0]===1,x=ode(g,v,s,_),w=Cr(t.map(I=>I.shape),e),C=n.makeTensorInfo(w,s,x);return m.forEach(I=>n.disposeIntermediateTensorInfo(I)),C}const r=t.filter(m=>re(m.shape)>0),o=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1;if(r.length===1){const m=o?new gr(t[0].shape,Io):new Lo(t[0].shape,Io);return n.runWebGLProgram(m,t,s)}const a=ee().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>a){const m=[];for(let v=0;v<r.length;v+=a){const _=r.slice(v,v+a);m.push(Fh(_,e,n))}const g=Fh(m,e,n);for(const v of m)n.disposeIntermediateTensorInfo(v);return g}if(o){const m=new mme(r.map(g=>g.shape),e);return n.runWebGLProgram(m,r,s)}const{tensors2D:l,outShape:c}=yme(r,e,n),h=new pme(l.map(m=>m.shape)),d=n.runWebGLProgram(h,l,s);l.forEach(m=>n.disposeIntermediateTensorInfo(m));const f=ye({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),f}function yme(t,e,n){const s=Cr(t.map(r=>r.shape),e);return{tensors2D:t.map(r=>ye({inputs:{x:r},attrs:{shape:[-1,re(r.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,r=je(i,e[0].shape)[0],o=e.map(c=>c.shape);EI(o,r);const a=Cr(e.map(c=>c.shape),r);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>re(c.shape)>0);return l.length===1?Os({inputs:{x:l[0]},backend:n}):Fh(l,r,n)}const vme={kernelName:nv,backendName:"webgl",kernelFunc:dB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,h=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,m=e.filterWidth,g=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,_=e.dataFormat==="channelsLast",x=_?1:2,w=_?2:3,C=_?3:1;let I="",S="";s&&(i?I=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?I=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const T=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${C}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${_}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${_}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${_}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${_}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${T}
        ${S}
        setOutput(result);
      }
    `}}class xme{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,i=e.padInfo.left,r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterDepth,f=e.filterHeight,m=e.filterWidth,g=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${r}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=qn(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=h;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let _=0;_<h;_++)f+=`
           vec4 xTexelC${_*2};
           int xTexelC${_*2}Ready;
           vec4 xTexelC${_*2+1};
           int xTexelC${_*2+1}Ready;
           vec4 xC${_};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let _=0;_<h;_++)f+=`
           xTexelC${_*2} = vec4(0.0);
           xTexelC${_*2}Ready = 0;
           xTexelC${_*2+1} = vec4(0.0);
           xTexelC${_*2+1}Ready = 0;
           xC${_} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let _=0;_<(d+1)/2;_++){const x=_*2;if(f+=`
           xC = xCCorner + ${x*l};
           `,a===1){if(x<h&&(o%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,l===1&&x>0?f+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<h)){const w=o%2===0?W1(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:f+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):w===1?f+=`
                     xC${x+1} = xTexelC${x};
                     `:f+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<h&&(o%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<h&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<h&&(f+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<h&&(f+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<h&&(f+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let m="",g="";s&&(i?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:r?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:m=`vec4 activation(vec4 x) {
           ${s}
         }`,g="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${g}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _me{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);const{dataFormat:s}=n,i=rs(),r=s==="channelsLast",o=r?1:2,a=r?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let h=0;h<=1;h++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${r}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oy(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function mB({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),h=n.inChannels,d=l[0]*l[1]*l[2],f=n.outChannels,m=n.dataFormat==="channelsLast",g=!1,v=!1;let _;const x=[];if(r!=null){const I=oy(r.shape,m);I!=null&&(r=ye({inputs:{x:r},backend:s,attrs:{shape:I}}),x.push(r))}if(i!=null){const I=oy(i.shape,m);I!=null&&(i=ye({inputs:{x:i},backend:s,attrs:{shape:I}}),x.push(i))}if(!((d===1||f===1)&&h>aB)&&c.isPacked&&m&&c.texture!=null&&l[2]%2!==0&&ct(c.shape.slice(-3),l.slice(-3))){const I=l[0]*l[1]*(l[2]+1),S={dataId:t.dataId,shape:[1,I,n.inChannels],dtype:t.dtype},T=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,R(iy(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);const E=ye({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});x.push(E);const $=ry({a:S,b:E,backend:s,transposeA:g,transposeB:v,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o}),D=s.texData.get($.dataId);R(D.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=T,D.shape=n.outShape,_=Os({inputs:{x:$},backend:s}),_.shape=n.outShape,x.push($)}else{const I=n.outHeight*n.outWidth,S=ye({inputs:{x:t},backend:s,attrs:{shape:m?[n.batchSize,I,n.inChannels]:[n.batchSize,n.inChannels,I]}}),T=ye({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),E=ry({a:m?S:T,b:m?T:S,transposeA:!m,transposeB:v,backend:s,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o});_=ye({inputs:{x:E},backend:s,attrs:{shape:n.outShape}}),x.push(S),x.push(T),x.push(E)}for(const I of x)s.disposeIntermediateTensorInfo(I);return _}function gB({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:h,outWidth:d,outHeight:f,dataFormat:m}=n,g=m==="channelsLast",v=l*c*h,_=f*d,x=[n.batchSize,v,_],w=!0,C=!1,I=[];if(r!=null){const O=oy(r.shape,g);O!=null&&(r=ye({inputs:{x:r},backend:s,attrs:{shape:O}}),I.push(r))}if(i!=null){const O=oy(i.shape,g);O!=null&&(i=ye({inputs:{x:i},backend:s,attrs:{shape:O}}),I.push(i))}const S=ye({inputs:{x:e},backend:s,attrs:{shape:[1,v,re(e.shape)/v]}});I.push(S);const T=new _me(x,n),E=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],$=s.runWebGLProgram(T,[t],"float32",E),D=ye({inputs:{x:$},backend:s,attrs:{shape:x}});I.push($),I.push(D);const P=i!=null,z=r!=null,H=a==="leakyrelu",Q=a?Fd(a,!0):null,Z=new oB(g?D.shape:S.shape,g?S.shape:D.shape,g?[n.batchSize,_,n.outChannels]:[n.batchSize,n.outChannels,_],w,C,P,Q,z,H),J=g?[D,S]:[S,D];if(i&&J.push(i),z&&J.push(r),H){const O=s.makeTensorInfo([],"float32",ya(o,"float32"));J.push(O),I.push(O)}const Y=s.runWebGLProgram(Z,J,"float32"),oe=ye({inputs:{x:Y},backend:s,attrs:{shape:n.outShape}});I.push(Y);for(const O of I)s.disposeIntermediateTensorInfo(O);return oe}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:h}=s,d=go(l),f=Pn(i.shape,r.shape,o,c,a,h,!1,d);let m;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))m=mB({x:i,filter:r,convInfo:f,backend:n});else if(f.strideWidth<=2&&d==="channelsLast"&&ee().getBool("WEBGL_EXP_CONV")){const v=new pB(f),_=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];m=n.runWebGLProgram(v,[i,r],"float32",_)}else if(ee().getBool("WEBGL_CONV_IM2COL"))m=gB({x:i,filter:r,convInfo:f,backend:n});else{const v=new fB(f);m=n.runWebGLProgram(v,[i,r],"float32")}const g=ye({inputs:{x:m},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(m),g}const bme={kernelName:sv,backendName:"webgl",kernelFunc:wme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cme{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Ime{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,r=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o?1:2,h=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class kme{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,i=e.strideWidth,r=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${r};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Sme{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,i=e.filterWidth,r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,h=i-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${r}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:h}=s,d=go(l),f=Pn(i.shape,h,o,1,a,c,!1,d),m=new Cme(f);return n.runWebGLProgram(m,[i,r],"float32")}const Eme={kernelName:nC,backendName:"webgl",kernelFunc:Tme};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nme{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=qn(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,i=n-1-e.padInfo.top,r=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:h}=s,d=go(c),f=Pn(o,r.shape,a,1,l,h,!1,d);if(ee().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const m=[[f.strideHeight,f.strideWidth]],g=new Nme(f);return n.runWebGLProgram(g,[i,r],"float32",m)}else{const m=new Ime(f);return n.runWebGLProgram(m,[i,r],"float32")}}const Rme={kernelName:iv,backendName:"webgl",kernelFunc:$me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l}=s,c=xa(i.shape,r.shape,o,l,a),h=new xme(c);return n.runWebGLProgram(h,[i,r],"float32")}const Dme={kernelName:rv,backendName:"webgl",kernelFunc:Ame};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,filterShape:l}=s,c=xa(i.shape,l,o,1,a),h=new kme(c);return n.runWebGLProgram(h,[i,r],"float32")}const Ome={kernelName:sC,backendName:"webgl",kernelFunc:Pme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{pad:o,strides:a,inputShape:l}=s,c=xa(l,r.shape,a,1,o),h=new Sme(c);return n.runWebGLProgram(h,[i,r],"float32")}const Fme={kernelName:iC,backendName:"webgl",kernelFunc:Lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mme=Gu+`
  return cos(x);
`,zme=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ec}
  return result;
`,Bme=tt({opSnippet:Mme,packedOpSnippet:zme}),Ume={kernelName:mf,backendName:"webgl",kernelFunc:Bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wme=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Vme=tt({opSnippet:Wme}),Gme={kernelName:gf,backendName:"webgl",kernelFunc:Vme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jme{constructor(e,n,s,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[h]=n,[d,f]=s;this.outputShape=[h,d,f,c];const m=i==="bilinear"?1:0,[g,v]=[`${a-1}.0`,`${l-1}.0`],[_,x,w]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[C,I,S]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${_});
      const float width_ratio = float(${C});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${I};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${r}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${r}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hme=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:r,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,h=new jme(i.shape,r.shape,a,l,c);return n.runWebGLProgram(h,[i,r,o],"float32")},qme={kernelName:oC,backendName:"webgl",kernelFunc:Hme};var zd;(function(t){t.Prod="*",t.Sum="+"})(zd||(zd={}));class e${constructor(e,n,s,i){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,o=this.op===zd.Prod?"1.0":"0.0",a=s?o:`getX(${t$(r,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",h="";s?(c=i?`end != ${l-1}`:"end != 0",h=i?"end + 1":"end - 1"):(c=i?`end + pow2 < ${l}`:"end >= pow2",h=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${yt(r)} coords = getOutputCoords();
        int end = ${n$(r,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${h};
          ${n$(r,"coords",this.op)} = idx;
          val ${this.op}= getX(${t$(r,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function t$(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function n$(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(t,e,n,s,i,r){const o=e.shape.length,a=Bt([s],o);let l=e;a!=null&&(l=is({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Zt(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const h=l.shape[c];let d=Os({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(h))-1;f++){const m=new e$(t,l.shape,!1,r),g=[[f]],v=d;d=n.runWebGLProgram(m,[d],d.dtype,g),n.disposeIntermediateTensorInfo(v)}if(i){const f=new e$(t,l.shape,i,r),m=d;d=n.runWebGLProgram(f,[d],d.dtype),n.disposeIntermediateTensorInfo(m)}if(a!=null){const f=_a(a),m=is({inputs:{x:d},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),m}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;return yB(zd.Prod,i,n,r,o,a)}const Xme={kernelName:rC,backendName:"webgl",kernelFunc:Kme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;return yB(zd.Sum,i,n,r,o,a)}const Yme={kernelName:ov,backendName:"webgl",kernelFunc:Zme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o,binaryOutput:a}=s;if(i.shape.length===1){const l=n.readSync(i.dataId),c=n.readSync(r.dataId),h=Yz(l,c,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,h)}else if(i.shape.length===2){const l=n.bufferSync(i),c=n.bufferSync(r),h=nde(l,c,o,a);return n.makeTensorInfo(h.shape,r.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Jme={kernelName:aC,backendName:"webgl",kernelFunc:Qme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ege{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:r,dataFormat:o}=s,a=i.shape[0],l=o==="NHWC"?i.shape[1]:i.shape[2],c=o==="NHWC"?i.shape[2]:i.shape[3],h=o==="NHWC"?i.shape[3]:i.shape[1],d=l*r,f=c*r,m=h/(r*r),g=o==="NHWC"?[a,d,f,m]:[a,m,d,f],v=new ege(g,r,o);return n.runWebGLProgram(v,[i],i.dtype)}const nge={kernelName:lC,backendName:"webgl",kernelFunc:tge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=qn(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",h="";s&&(i?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=qn(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,f=d;let m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)m+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;m+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let x=0;x<d;x++)m+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(f+1)/2;x++){const w=x*2;if(m+=`
          xC = xCCorner + ${w*c};
          `,l===1){if(w<d&&(a%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,c===1&&w>0?m+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<d)){const C=a%2===0?W1(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${C};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,c>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:m+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):C===1?m+=`
                    xC${w+1} = xTexelC${w};
                    `:m+=`
                    xCOffset = xC + ${C};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<d&&(a%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<d&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<d&&(m+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<d&&(m+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<d&&(m+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let g="",v="";s&&(i?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:g=`vec4 activation(vec4 x) {
          ${s}
        }`,v="result = activation(result);");const _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${_}
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;let h=l;h==null&&(h=[1,1]),R(jn(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Pn(i.shape,r.shape,o,h,a,c,!0);let f;ee().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new xB(d):f=new vB(d);const m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(f,[i,r],"float32",m)}const ige={kernelName:av,backendName:"webgl",kernelFunc:sge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rge{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class oge{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,r=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function age(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:h}=s,d=Pn(i.shape,h,o,a,l,c,!0),f=new rge(d);return n.runWebGLProgram(f,[i,r],"float32")}const lge={kernelName:cC,backendName:"webgl",kernelFunc:age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cge(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:h}=s,d=Pn(h,r.shape,o,a,l,c,!0),f=new oge(d);return n.runWebGLProgram(f,[i,r],"float32")}const uge={kernelName:uC,backendName:"webgl",kernelFunc:cge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hge{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dge(t){const{inputs:e,backend:n}=t,{x:s}=e,i=[...s.shape,...s.shape],r=re(s.shape),o=ye({inputs:{x:s},backend:n,attrs:{shape:[r]}}),a=new hge(r),l=n.runWebGLProgram(a,[o],o.dtype),c=ye({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const fge={kernelName:nO,backendName:"webgl",kernelFunc:dge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pge{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:i,strideHeight:r,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:h}=e,{top:d,left:f}=i;this.userCode=`
      const ivec2 strides = ivec2(${r}, ${o});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l}=s,c=np(i.shape,r.shape,o,a,"NHWC",l);let h;const d=new pge(c);h=n.runWebGLProgram(d,[i,r],"float32");const f=ye({inputs:{x:h},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(h),f}const gge={kernelName:lv,backendName:"webgl",kernelFunc:mge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yge(t){const{inputs:e,backend:n,attrs:s}=t,{equation:i}=s,r=e,{allDims:o,summedDims:a,idDims:l}=BI(i,r.length);WI(o.length,l,r);const{path:c,steps:h}=VI(a,l),d=h.length;let f=null,m=o.length;const g=[];for(let v=0;v<d;++v){for(const _ of h[v]){const{permutationIndices:x,expandDims:w}=UI(m,l[_]);let C;GI(x)?C=r[_]:(C=is({inputs:{x:r[_]},backend:n,attrs:{perm:x}}),g.push(C));const I=C.shape.slice();for(let S=0;S<w.length;++S)I.splice(w[S],0,1);ct(C.shape,I)||(C=ye({inputs:{x:C},backend:n,attrs:{shape:I}}),g.push(C)),f===null?f=C:(f=Ak({inputs:{a:C,b:f},backend:n}),g.push(f))}v<d-1&&(c[v]>=0&&(f=wx({inputs:{x:f},backend:n,attrs:{axis:c[v]-(o.length-m),keepDims:!1}}),g.push(f)),m--)}for(const v of g)v!==f&&n.disposeIntermediateTensorInfo(v);return f}const vge={kernelName:hC,backendName:"webgl",kernelFunc:yge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xge="return (x >= 0.0) ? x : (exp(x) - 1.0);",_ge=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,wge=tt({opSnippet:xge,packedOpSnippet:_ge}),bge={kernelName:vf,backendName:"webgl",kernelFunc:wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cge="return (b >= 0.0) ? a : a * (b + 1.0);",Ige=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,kge=t=>{const{inputs:e,backend:n}=t,{dy:s,y:i}=e,r=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(Ige,s.shape,i.shape):new Al(Cge,s.shape,i.shape);return n.runWebGLProgram(r,[s,i],s.dtype)},Sge={kernelName:dC,backendName:"webgl",kernelFunc:kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tge=`
  return vec4(equal(a, b));
`,Ege="return float(a == b);",Nge=Ln({opSnippet:Ege,packedOpSnippet:Tge,dtype:"bool",cpuKernelImpl:ade}),$ge={kernelName:cv,backendName:"webgl",kernelFunc:Nge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rge=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${DI};
  float a1 = ${PI};
  float a2 = ${OI};
  float a3 = ${LI};
  float a4 = ${FI};
  float a5 = ${MI};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Age=tt({opSnippet:Rge}),Dge={kernelName:xf,backendName:"webgl",kernelFunc:Age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pge=Gu+`
  return exp(x);
`,Oge=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_B=tt({opSnippet:Pge,packedOpSnippet:Oge,cpuKernelImpl:lde,dtype:"float32"}),Lge={kernelName:_f,backendName:"webgl",kernelFunc:_B};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lb(t){const{inputs:e,attrs:n,backend:s}=t,{dim:i}=n,{input:r}=e,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(R(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),ye({inputs:{x:r},backend:s,attrs:{shape:a}})}const Fge={kernelName:uv,backendName:"webgl",kernelFunc:lb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s$="return exp(x) - 1.0;",Mge=tt({opSnippet:s$,packedOpSnippet:s$,cpuKernelImpl:cde}),zge={kernelName:wf,backendName:"webgl",kernelFunc:Mge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i${constructor(e,n,s){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const r=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${i}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${r};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(t,e,n){const s=n.texData.get(t.dataId),i=re(t.shape),r=t.shape[t.shape.length-1],o=i/r,a=ye({inputs:{x:t},backend:n,attrs:{shape:[o,r]}}),l=a.shape,c=new i$("real",l,e),h=new i$("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],f=n.runWebGLProgram(c,d,"float32"),m=n.runWebGLProgram(h,d,"float32"),g=Sa({inputs:{real:f,imag:m},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m);const v=ye({inputs:{x:g},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(g),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bge(t){const{inputs:e,backend:n}=t,{input:s}=e;return wB(s,!1,n)}const Uge={kernelName:fC,backendName:"webgl",kernelFunc:Bge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wge{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bp(t){const{backend:e,attrs:n}=t,{shape:s,value:i}=n;let{dtype:r}=n;if(r=r||Nu(i),r==="string"){const o=qt(r,re(s));return o.fill(i),e.makeTensorInfo(s,r,o)}else{const o=new Wge(s,i),a=[[i]];return e.runWebGLProgram(o,[],r,a)}}const Vge={kernelName:pC,backendName:"webgl",kernelFunc:bp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gge{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jge={kernelName:mC,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,i=new Gge(n.shape);return s.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r$="return floor(x);",Hge=tt({opSnippet:r$,packedOpSnippet:r$,cpuKernelImpl:ude}),qge={kernelName:bf,backendName:"webgl",kernelFunc:Hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kge=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Xge=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Zge=Ln({opSnippet:Kge,packedOpSnippet:Xge,dtype:"int32"}),Yge={kernelName:Cf,backendName:"webgl",kernelFunc:Zge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qge{constructor(e){this.variableNames=["A"];const n=rs(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jge{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=rs(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eye={kernelName:$0,backendName:"webgl",kernelFunc:tye};let gc,aw=ee().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function tye(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:i}=e;const{numChannels:r}=s,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[l,c]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=[c,l],d=[c,l,r];if(a||o){const v=ee().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(gc==null||v!==aw)&&(aw=v,gc=document.createElement("canvas").getContext("2d",{willReadFrequently:aw})),gc.canvas.width=l,gc.canvas.height=c,gc.drawImage(i,0,0,l,c),i=gc.canvas}const f=n.makeTensorInfo(h,"int32");n.texData.get(f.dataId).usage=Ws.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),i);const m=ee().getBool("WEBGL_PACK")?new Jge(d):new Qge(d),g=n.runWebGLProgram(m,[f],"int32");return n.disposeData(f.dataId),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s,v=go(h),_=Pn(i.shape,r.shape,l,d,c,f,!1,v);let x;const w=[],C=o!=null,I=a!=null,S=m==="leakyrelu",T=()=>{const $=[i,r],D=(P,z)=>{if(z==="NCHW"&&P.shape.length===1&&P.shape[0]!==1){const H=ye({inputs:{x:P},backend:n,attrs:{shape:[P.shape[0],1,1]}});return w.push(H),H}return P};if(C&&$.push(D(o,h)),I&&$.push(D(a,h)),S){const P=n.makeTensorInfo([],"float32",ya(g,"float32"));$.push(P),w.push(P)}return $};if(_.filterHeight===1&&_.filterWidth===1&&_.dilationHeight===1&&_.dilationWidth===1&&_.strideHeight===1&&_.strideWidth===1&&(_.padInfo.type==="SAME"||_.padInfo.type==="VALID"))x=mB({x:i,filter:r,convInfo:_,backend:n,bias:o,activation:m,preluActivationWeights:a,leakyreluAlpha:g});else if(_.strideWidth<=2&&v==="channelsLast"&&ee().getBool("WEBGL_EXP_CONV")){const $=m?Fd(m,!0):null,D=new pB(_,C,$,I,S),P=[[_.padInfo.top,_.padInfo.left],[_.strideHeight,_.strideWidth],[_.dilationHeight,_.dilationWidth],[_.inHeight,_.inWidth]],z=T();x=n.runWebGLProgram(D,z,"float32",P)}else if(ee().getBool("WEBGL_CONV_IM2COL"))x=gB({x:i,filter:r,convInfo:_,backend:n,bias:o,activation:m,preluActivationWeights:a,leakyreluAlpha:g});else{const $=m?Fd(m,!1):null,D=new fB(_,C,$,I,S),P=T();x=n.runWebGLProgram(D,P,"float32")}const E=ye({inputs:{x},backend:n,attrs:{shape:_.outShape}});return w.push(x),w.forEach($=>n.disposeIntermediateTensorInfo($)),E}const sye={kernelName:Dg,backendName:"webgl",kernelFunc:nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:m}=s,g=[];let v=h;v==null&&(v=[1,1]),R(jn(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);const _=Pn(i.shape,r.shape,l,v,c,d,!0),x=ee().getBool("WEBGL_PACK_DEPTHWISECONV")&&_.strideWidth<=2&&_.outChannels/_.inChannels===1,w=f?Fd(f,x):null,C=[i,r],I=o!=null,S=a!=null,T=f==="leakyrelu";if(I&&C.push(o),S&&C.push(a),T){const P=n.makeTensorInfo([],"float32",ya(m,"float32"));C.push(P),g.push(P)}let E;x?E=new xB(_,I,w,S,T):E=new vB(_,I,w,S,T);const $=[[_.padInfo.top,_.padInfo.left],[_.strideHeight,_.strideWidth],[_.dilationHeight,_.dilationWidth],[_.inHeight,_.inWidth]],D=n.runWebGLProgram(E,C,"float32",$);return g.forEach(P=>n.disposeIntermediateTensorInfo(P)),D}const rye={kernelName:wO,backendName:"webgl",kernelFunc:iye};class oye{constructor(e,n,s,i){this.sliceDim=e,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=s;const r=yt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${r} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aye(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,r=i.shape,o=r[r.length-1],a=re(s.shape),[l,c,h,d]=bI(s,i),f=ye({inputs:{x:i},backend:n,attrs:{shape:[c,o]}}),m=ye({inputs:{x:s},backend:n,attrs:{shape:[re(s.shape)/h,h]}});if(n.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const x=n.readSync(i.dataId),w=n.bufferSync(s),C=hde(x,w,s.dtype,c,o,h,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,C.values)}const g=new oye(o,d,[c,h],s.shape),v=n.runWebGLProgram(g,[m,f],m.dtype),_=ye({inputs:{x:v},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),_}const lye={kernelName:sO,backendName:"webgl",kernelFunc:aye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cye{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=yt(this.rank),i=uye(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function uye(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<t.length;i++)i===2?s.push("index"):s.push(`${n[i]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:r}=e,{axis:o,batchDims:a}=s,l=je(o,i.shape)[0];if(ee().get("DEBUG")){const w=n.readSync(r.dataId),C=i.shape[l];for(let I=0;I<w.length;++I){const S=w[I];R(S<=C-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${C-1}]`)}}const c=HI(i,r,l,a),h=re(r.shape),d=[],f=ye({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),m=ye({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,h/c.batchSize]}});d.push(f),d.push(m);const g=[c.batchSize,c.outerSize,h/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([i,r])||i.dtype==="string"){const w=n.bufferSync(m),C=n.bufferSync(f),I=dde(C,w,g);return d.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.makeTensorInfo(c.outputShape,I.dtype,I.values)}const v=new cye(f.shape,g),_=n.runWebGLProgram(v,[f,m],f.dtype);d.push(_);const x=ye({inputs:{x:_},backend:n,attrs:{shape:c.outputShape}});return d.forEach(w=>n.disposeIntermediateTensorInfo(w)),x}const hye={kernelName:dv,backendName:"webgl",kernelFunc:bB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dye="return float(a > b);",fye=`
  return vec4(greaterThan(a, b));
`,pye=Ln({opSnippet:dye,packedOpSnippet:fye,cpuKernelImpl:fde,dtype:"bool"}),mye={kernelName:fv,backendName:"webgl",kernelFunc:pye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gye="return float(a >= b);",yye=`
  return vec4(greaterThanEqual(a, b));
`,vye=Ln({opSnippet:gye,packedOpSnippet:yye,dtype:"bool",cpuKernelImpl:pde}),xye={kernelName:If,backendName:"webgl",kernelFunc:vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ye(t){const{inputs:e,backend:n}=t,{input:s}=e;return wB(s,!0,n)}const wye={kernelName:gC,backendName:"webgl",kernelFunc:_ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bye="return float(!isnan(x) && !isinf(x));",Cye=tt({opSnippet:bye,dtype:"bool"}),Iye={kernelName:Sf,backendName:"webgl",kernelFunc:Cye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kye="return float(isinf(x));",Sye=tt({opSnippet:kye,dtype:"bool"}),Tye={kernelName:Tf,backendName:"webgl",kernelFunc:Sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eye="return float(isnan(x));",Nye=tt({opSnippet:Eye,dtype:"bool"}),$ye={kernelName:Ef,backendName:"webgl",kernelFunc:Nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rye="return float(a < b);",Aye=`
  return vec4(lessThan(a, b));
`,Dye=Ln({opSnippet:Rye,packedOpSnippet:Aye,cpuKernelImpl:mde,dtype:"bool"}),Pye={kernelName:mv,backendName:"webgl",kernelFunc:Dye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oye="return float(a <= b);",Lye=`
  return vec4(lessThanEqual(a, b));
`,Fye=Ln({opSnippet:Oye,packedOpSnippet:Lye,cpuKernelImpl:gde,dtype:"bool"}),Mye={kernelName:gv,backendName:"webgl",kernelFunc:Fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:r}=n,o=yde(s,i,r);return e.makeTensorInfo([o.length],"float32",o)}const Bye={kernelName:iO,backendName:"webgl",kernelFunc:zye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uye=Gu+`
  return x < 0.0 ? 0./0. : log(x);
`,Wye=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Vye=tt({opSnippet:Uye,packedOpSnippet:Wye,cpuKernelImpl:vde}),Gye={kernelName:Nf,backendName:"webgl",kernelFunc:Vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jye=Gu+`
  return log(1.0 + x);
`,Hye=tt({opSnippet:jye}),qye={kernelName:$f,backendName:"webgl",kernelFunc:Hye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kye="return float(a >= 1.0 && b >= 1.0);",Xye=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Zye=Ln({opSnippet:Kye,packedOpSnippet:Xye,dtype:"bool"}),Yye={kernelName:yv,backendName:"webgl",kernelFunc:Zye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qye="return float(!(x >= 1.0));",Jye=tt({opSnippet:Qye}),eve={kernelName:vv,backendName:"webgl",kernelFunc:Jye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tve="return float(a >= 1.0 || b >= 1.0);",nve=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,sve=Ln({opSnippet:tve,packedOpSnippet:nve,dtype:"bool"}),ive={kernelName:xv,backendName:"webgl",kernelFunc:sve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rve{constructor(e,n,s,i,r){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${i}) * sum`;r===.5?l=`inversesqrt(${c})`:r===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ove{constructor(e,n,s,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${i}) * sum`;r===.5?l=`inversesqrt(${c})`:r===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ave=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:r,bias:o,alpha:a,beta:l}=s,c=ee().getBool("WEBGL_PACK_NORMALIZATION")?new ove(i.shape,r,o,a,l):new rve(i.shape,r,o,a,l);return n.runWebGLProgram(c,[i],i.dtype)},lve={kernelName:_v,backendName:"webgl",kernelFunc:ave};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cve{constructor(e,n,s,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=i,this.beta=r,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${r})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${r});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uve=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i,y:r,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:h}=s,d=new cve(i.shape,a,l,c,h);return n.runWebGLProgram(d,[i,r,o],i.dtype)},hve={kernelName:vC,backendName:"webgl",kernelFunc:uve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dve(t,e,n,s){const i=re(e),o=re(t.shape)/i,a=ye({inputs:{x:t},attrs:{shape:[o,i]},backend:s}),l=tc(a,t.dtype,"max",s),c=ye({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:r,keepDims:o}=s,a=i.shape.length,l=je(r,i.shape);let c=l;const h=Bt(c,a),d=h!=null,f=n.shouldExecuteOnCPU([i]);let m=i;if(d){if(f){const C=n.texData.get(m.dataId).values,I=new Array(a);for(let E=0;E<I.length;E++)I[E]=i.shape[h[E]];const S=$k(C,i.shape,i.dtype,h,I);m=n.makeTensorInfo(I,i.dtype);const T=n.texData.get(m.dataId);T.values=S}else m=_x(i,h,n);c=Zt(c.length,a)}On("max",c,a);const[g,v]=In(m.shape,c);let _=g;o&&(_=sn(g,l));let x;if(f){const C=n.texData.get(m.dataId).values,I=xde(C,re(v),_,i.dtype);x=n.makeTensorInfo(_,i.dtype);const S=n.texData.get(x.dataId);S.values=I}else x=dve(m,v,_,n);return d&&n.disposeIntermediateTensorInfo(m),x}const fve={kernelName:wv,backendName:"webgl",kernelFunc:CB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pve=Rk+`
  return max(a, b);
`,mve=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ec+`
  return result;
`,gve=Ln({opSnippet:pve,packedOpSnippet:mve,cpuKernelImpl:_de}),yve={kernelName:Rf,backendName:"webgl",kernelFunc:gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;xp(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(jn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=wi(i.shape,r,o,c,a,l);if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))return Os({inputs:{x:i},backend:n});const d=new Md(h,"max",!1);return n.runWebGLProgram(d,[i],i.dtype)}const xve={kernelName:bv,backendName:"webgl",kernelFunc:vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,h=[1,1,1],d=mo(i.shape,r,o,h,a,c,l),f=new Dk(d,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const wve={kernelName:Cv,backendName:"webgl",kernelFunc:_ve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bve{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,r=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=r-1-e.padInfo.top,l=o-1-e.padInfo.left,c=r*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Cve{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,i=e.strideWidth,r=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=l-1-e.padInfo.front,f=c-1-e.padInfo.top,m=h-1-e.padInfo.left,g=l*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${r}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r,{filterSize:a,strides:l,pad:c,dimRoundingMode:h}=s,d=[1,1,1],f=mo(o.shape,a,l,d,c,h),m=new Dk(f,"max",!0),g=n.runWebGLProgram(m,[o],o.dtype),v=new Cve(f),_=n.runWebGLProgram(v,[i,g],o.dtype);return n.disposeIntermediateTensorInfo(g),_}const kve={kernelName:_C,backendName:"webgl",kernelFunc:Ive};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r,output:o}=e,a=r;xp([r,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:d}=s,f=wi(a.shape,l,c,1,h,d),m=!0,g=new Md(f,"max",m),v=n.runWebGLProgram(g,[a],a.dtype),_=new bve(f),x=n.runWebGLProgram(_,[i,v],a.dtype);return n.disposeIntermediateTensorInfo(v),x}const Tve={kernelName:xC,backendName:"webgl",kernelFunc:Sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eve(t,e,n,s){let i=new Md(n,"max",!1);const r=s.runWebGLProgram(i,[t],"float32");i=new Md(n,"max",!0,!0,e);const o=s.runWebGLProgram(i,[t],"float32");return[r,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nve={kernelName:rO,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=e,l=n;R(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];R(jn(r,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const h=wi(s.shape,i,r,c,o),[d,f]=Eve(s,a,h,l);return[d,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ve(t,e,n,s){const i=re(e),o=re(t.shape)/i,a=ye({inputs:{x:t},attrs:{shape:[o,i]},backend:s}),l=tc(a,"float32","mean",s),c=ye({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rve={kernelName:Iv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:i,axis:r}=e,o=n,a=s.shape.length,l=je(r,s.shape);let c=l;const h=Bt(c,a),d=h!=null,f=o.shouldExecuteOnCPU([s]),m=[];let g=s;if(d){if(f){const I=o.texData.get(g.dataId).values,S=new Array(a);for(let $=0;$<S.length;$++)S[$]=s.shape[h[$]];const T=$k(I,s.shape,s.dtype,h,S);g=o.makeTensorInfo(S,s.dtype);const E=o.texData.get(g.dataId);E.values=T}else g=_x(s,h,o);m.push(g),c=Zt(c.length,a)}On("sum",c,a);const[v,_]=In(g.shape,c);let x=v;i&&(x=sn(v,l));const w=$ve(g,_,x,o);for(const C of m)o.disposeIntermediateTensorInfo(C);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ave(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=je(r,i.shape);let c=l;const h=Bt(c,a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Zt(c.length,i.shape.length)),On("min",c,a);const[f,m]=In(d.shape,c),g=re(m),v=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),_=tc(v,v.dtype,"min",n);let x;if(o){const w=sn(f,l);x=ye({inputs:{x:_},backend:n,attrs:{shape:w}})}else x=ye({inputs:{x:_},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(_),h!=null&&n.disposeIntermediateTensorInfo(d),x}const Dve={kernelName:kv,backendName:"webgl",kernelFunc:Ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pve=Rk+`
  return min(a, b);
`,Ove=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ec+`
  return result;
`,Lve=Ln({opSnippet:Pve,packedOpSnippet:Ove,cpuKernelImpl:wde}),Fve={kernelName:Af,backendName:"webgl",kernelFunc:Lve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mve{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((h,d)=>h[0]+e[d]+h[1]);const i=e.length,r=yt(i),o=n.map(h=>h[0]).join(","),a=n.map((h,d)=>h[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),c=s==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${o});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${r} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zve{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((g,v)=>g[0]+e[v]+g[1]);const i=e.length,r=yt(i),o=n.map(g=>g[0]).join(","),a=n.map((g,v)=>g[0]+e[v]).join(","),l=ts("rc",i),c=ts("source",i),h=`${l[i-1]} < ${this.outputShape[i-1]}`,d=i===1?"source":`vec2(${c.slice(-2).join()})`,f=s==="reflect"?0:1;let m="";if(i===1){const g=`
        ${r} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;m=`
        ${r} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[i-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const g=`
        ${r} source = rc;
        ${r} lt = ${r}(lessThan(source, start));
        ${r} gte = ${r}(greaterThanEqual(source, end));
        ${r} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;m=`
        ${r} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[i-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[i-2]} += 1;
        if(${l[i-2]} < ${this.outputShape[i-2]}) {
          ${g}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[i-1]} += 1;
          if(${h}) {
            ${g}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${r} start = ${r}(${o});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bve=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:i,mode:r}=n,o=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zve(s.shape,i,r):new Mve(s.shape,i,r);return e.runWebGLProgram(o,[s],s.dtype)},Uve={kernelName:Sv,backendName:"webgl",kernelFunc:Bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wve=`if (b == 0.0) return NAN;
  return mod(a, b);`,Vve=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ec+`
  return result;
`,Gve=Ln({opSnippet:Wve,packedOpSnippet:Vve}),jve={kernelName:Df,backendName:"webgl",kernelFunc:Gve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hve{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qve=`
if (a == b) {
  return 1.0;
};
return a / b;`,Kve=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,IB=Ln({opSnippet:qve,packedOpSnippet:Kve,checkOutOfBounds:!0}),Xve={kernelName:yf,backendName:"webgl",kernelFunc:IB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o$="return a - b;",kB=Ln({opSnippet:o$,packedOpSnippet:o$,supportsComplex:!0,cpuKernelImpl:Wde}),Zve={kernelName:Xf,backendName:"webgl",kernelFunc:kB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:r}=s,o=je([r],i.shape),a=CB({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=sn(a.shape,o),c=ye({inputs:{x:a},backend:n,attrs:{shape:l}}),h=kB({inputs:{a:i,b:c},backend:n}),d=_B({inputs:{x:h},backend:n}),f=wx({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),m=ye({inputs:{x:f},backend:n,attrs:{shape:l}}),g=IB({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const Yve={kernelName:Gv,backendName:"webgl",kernelFunc:SB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qve(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:r,seed:o,normalized:a}=s,l=a?i:SB({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=l.shape[0],h=l.shape[1],d=new Hve(c,h,r),f=[[o]],m=n.runWebGLProgram(d,[l],"int32",f);return a||n.disposeIntermediateTensorInfo(l),m}const Jve={kernelName:oO,backendName:"webgl",kernelFunc:Qve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const exe=Ci+`
  return -x;
`,txe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function nxe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const r=n.texData.get(s.dataId),[o,a]=Cde(r.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let i;return ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Lo(s.shape,txe):i=new gr(s.shape,exe),n.runWebGLProgram(i,[s],s.dtype)}const sxe={kernelName:Tv,backendName:"webgl",kernelFunc:nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ixe=gI;function rxe(t){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(i.dataId),h=n.readSync(r.dataId),{selectedIndices:d}=ixe(c,h,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const oxe={kernelName:wC,backendName:"webgl",kernelFunc:rxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const axe=yI;function lxe(t){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,h=n.readSync(i.dataId),d=n.readSync(r.dataId),{selectedIndices:f,validOutputs:m}=axe(h,d,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}const cxe={kernelName:bC,backendName:"webgl",kernelFunc:lxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uxe=vI;function hxe(t){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,h=n.readSync(i.dataId),d=n.readSync(r.dataId),f=o,m=a,g=l,v=c,{selectedIndices:_,selectedScores:x}=uxe(h,d,f,m,g,v);return[n.makeTensorInfo([_.length],"int32",new Int32Array(_)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const dxe={kernelName:CC,backendName:"webgl",kernelFunc:hxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fxe{constructor(e,n,s,i){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pxe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{dtype:r,depth:o,onValue:a,offValue:l}=s,c=re(i.shape),h=new fxe(c,o,a,l),d=ye({inputs:{x:i},backend:n,attrs:{shape:[c]}}),f=n.runWebGLProgram(h,[d],r);n.disposeIntermediateTensorInfo(d);const m=[...i.shape,o],g=ye({inputs:{x:f},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(f),g},mxe={kernelName:$v,backendName:"webgl",kernelFunc:pxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ay(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const i=wp({inputs:{input:s},backend:n}),r=ay({inputs:{x:i},backend:n}),o=bx({inputs:{input:s},backend:n}),a=ay({inputs:{x:o},backend:n}),l=Sa({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return bp({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const gxe={kernelName:qv,backendName:"webgl",kernelFunc:ay};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const i=wp({inputs:{input:s},backend:n}),r=TB({inputs:{x:i},backend:n}),o=bx({inputs:{input:s},backend:n}),a=ay({inputs:{x:o},backend:n}),l=Sa({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return bp({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const yxe={kernelName:Nv,backendName:"webgl",kernelFunc:TB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vxe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(e.length===1)return lb({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const r=e[0].shape,o=e[0].dtype;e.forEach(h=>{V1(r,h.shape,"All tensors passed to stack must have matching shapes"),R(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const d=lb({inputs:{input:h},backend:n,attrs:{dim:i}});return a.push(d),d}),c=dB({inputs:l,backend:n,attrs:{axis:i}});return a.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const xxe={kernelName:Rv,backendName:"webgl",kernelFunc:vxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _xe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,h)=>c[0]+e[h]+c[1]);const i=e.length,r=yt(i),o=n.map(c=>c[0]).join(","),a=n.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${o});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${r} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wxe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((v,_)=>v[0]+e[_]+v[1]);const i=e.length,r=yt(i),o=n.map(v=>v[0]).join(","),a=n.map((v,_)=>v[0]+e[_]).join(","),l=ts("rc",i),c=ts("source",i),h=`${l[i-1]} < ${this.outputShape[i-1]}`,d=i===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${r} rc = outputLoc;`,`${l[i-1]} += 1;
       if(${h}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${l[i-2]} += 1;
       if(${l[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${l[i-1]} += 1;
         if(${h}) {`],m=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let g="";for(let v=0,_=i===1?2:4;v<_;v++)g+=`
        ${f[v]}
        if (${m}) {
          result[${v}] = float(value);
        } else {
          ${r} source = rc - start;
          result[${v}] = getChannel(getX(${c.join()}), ${d});
        }
      `;g+=i===1?"} ":"}}",this.userCode=`
      const ${r} start = ${r}(${o});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EB=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,constantValue:o}=s;if(re(i.shape)===0){const c=r.map((h,d)=>h[0]+i.shape[d]+h[1]);return bp({backend:n,attrs:{shape:c,value:o,dtype:i.dtype}})}const a=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wxe(i.shape,r,o):new _xe(i.shape,r,o),l=[[o]];return n.runWebGLProgram(a,[i],i.dtype,l)},bxe={kernelName:Av,backendName:"webgl",kernelFunc:EB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cxe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Ixe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ec+`
  return result;
`,kxe=Ln({opSnippet:Cxe,packedOpSnippet:Ixe}),Sxe={kernelName:Of,backendName:"webgl",kernelFunc:kxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Txe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=[],c=je(r,i.shape);let h=c;const d=Bt(h,a);let f=i;d!=null&&(f=is({inputs:{x:i},backend:n,attrs:{perm:d}}),h=Zt(h.length,a),l.push(f)),On("prod",h,a);let m;if(n.shouldExecuteOnCPU([f])){const g=n.texData.get(f.dataId).values,{outVals:v,outShape:_,outDtype:x}=kde(f.shape,f.dtype,g,h);m=n.makeTensorInfo(_,x,v)}else{const[g,v]=In(f.shape,h),_=re(v),x=ye({inputs:{x:f},backend:n,attrs:{shape:[-1,_]}}),w=LC(i.dtype),C=tc(x,w,"prod",n);m=ye({inputs:{x:C},backend:n,attrs:{shape:g}}),l.push(x),l.push(C)}if(o){l.push(m);const g=sn(m.shape,c);m=ye({inputs:{x:m},backend:n,attrs:{shape:g}})}return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const Exe={kernelName:Pv,backendName:"webgl",kernelFunc:Txe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nxe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:i,paramsDenseValues:r,indices:o}=e,{outputRaggedRank:a}=s,l=i.map(x=>n.readSync(x.dataId)),c=i.map(x=>x.shape),h=n.readSync(r.dataId),d=n.readSync(o.dataId),[f,m,g]=Sde(l,c,h,r.shape,r.dtype,d,o.shape,a),v=f.map(x=>n.makeTensorInfo([x.length],"int32",x)),_=n.makeTensorInfo(g,r.dtype,m);return v.concat([_])}const $xe={kernelName:aO,backendName:"webgl",kernelFunc:Nxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(t){const{inputs:e,backend:n}=t,{starts:s,limits:i,deltas:r}=e,o=n.readSync(s.dataId),a=n.readSync(i.dataId),l=n.readSync(r.dataId),[c,h]=Tde(o,s.shape,s.dtype,a,i.shape,l,r.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([h.length],s.dtype,h);return[d,f]}const Axe={kernelName:lO,backendName:"webgl",kernelFunc:Rxe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:i,values:r,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(i.dataId),h=n.readSync(r.dataId),d=n.readSync(o.dataId),f=a.map(_=>n.readSync(_.dataId)),m=a.map(_=>_.shape),[g,v]=Ede(c,i.shape,h,r.shape,r.dtype,d,o.shape,f,m,l);return n.makeTensorInfo(g,r.dtype,v)}const Pxe={kernelName:cO,backendName:"webgl",kernelFunc:Dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NB=t=>{const{backend:e,attrs:n}=t,{start:s,stop:i,step:r,dtype:o}=n,a=Nde(s,i,r,o);return e.makeTensorInfo([a.length],o,a)},Oxe={kernelName:IC,backendName:"webgl",kernelFunc:NB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lxe="return 1.0 / x;",Fxe=tt({opSnippet:Lxe}),Mxe={kernelName:Lf,backendName:"webgl",kernelFunc:Fxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zxe=Ci+`
  return (x < 0.0) ? 0.0 : x;
`,Bxe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Uxe=tt({opSnippet:zxe,packedOpSnippet:Bxe}),Wxe={kernelName:Ff,backendName:"webgl",kernelFunc:Uxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vxe=Ci+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Gxe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jxe=tt({opSnippet:Vxe,packedOpSnippet:Gxe}),Hxe={kernelName:Mf,backendName:"webgl",kernelFunc:jxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qxe{constructor(e,n,s,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s];let f;r?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kxe{constructor(e,n,s,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s];let f;r?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xxe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s,[l,c]=a,h=ee().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Kxe(i.shape,l,c,r,o):new qxe(i.shape,l,c,r,o);return n.runWebGLProgram(h,[i],"float32")}const Zxe={kernelName:Fv,backendName:"webgl",kernelFunc:Xxe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yxe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,r]=n,[,o,a]=e,l=[s&&o>1?i-1:i,s&&a>1?r-1:r],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/c[0],d=l[1]/c[1],f=1/h,m=1/d,g=Math.ceil(f)*2+2,v=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qxe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s,a=new Yxe(r.shape,i.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const Jxe={kernelName:TC,backendName:"webgl",kernelFunc:Qxe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e_e{constructor(e,n,s,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s],f=i?"0.5":"0.0";let m;r?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t_e{constructor(e,n,s,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s],f=i?"0.5":"0.0";let m;r?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_e(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s,[l,c]=a,h=ee().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new t_e(i.shape,l,c,r,o):new e_e(i.shape,l,c,r,o);return n.runWebGLProgram(h,[i],i.dtype)}const s_e={kernelName:Lv,backendName:"webgl",kernelFunc:n_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i_e{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,r]=n,[,o,a]=e,l=[s&&o>1?i-1:i,s&&a>1?r-1:r],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/c[0],d=l[1]/c[1],f=1/h,m=1/d,g=Math.ceil(f)*2+2,v=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_e(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s,a=new i_e(r.shape,i.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const o_e={kernelName:SC,backendName:"webgl",kernelFunc:r_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a_e{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,r=e.map((a,l)=>i(l)).join(","),o=yt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${r}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l_e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const i=ts("rc",s),r=`${i[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${i[s-2]} + 1 < ${this.outputShape[s-2]}`,a=yt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${r}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(i.slice())};
          if(${r}){
            result.g = ${c(i.slice())};
          }
          if(${o}) {
            result.b = ${h(i.slice())};
            if(${r}) {
              result.a = ${d(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(g){return f(g)}function c(g){return g[s-1]="("+g[s-1]+" + 1)",f(g)}function h(g){return g[s-2]="("+g[s-2]+" + 1)",f(g)}function d(g){return g[s-1]="("+g[s-1]+" + 1)",g[s-2]="("+g[s-2]+" + 1)",f(g)}function f(g){const v=e.map((w,C)=>m(C,g)),_=v.join(","),x=v.slice(-2).join(",");return`getChannel(getX(${_}), vec2(${x}))`}function m(g,v){return n.indexOf(g)!==-1&&e[g]!==1?`${e[g]} - ${v[g]} - 1`:`${v[g]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:r}=s,o=i.shape.length,a=je(r,i.shape);if(o===0)return Os({inputs:{x:i},backend:n});const l=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l_e(i.shape,a):new a_e(i.shape,a);return n.runWebGLProgram(l,[i],i.dtype)}const u_e={kernelName:Mv,backendName:"webgl",kernelFunc:c_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h_e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],i=e[2];this.outputShape=e;let r="";typeof n=="number"?r=`float outputValue = ${n.toFixed(2)};`:r=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${r}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_e={kernelName:PC,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:r,center:o}=e,a=n,l=new h_e(s.shape,r),[c,h]=$I(o,s.shape[1],s.shape[2]),d=[[c,h,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,p_e=tt({opSnippet:f_e}),m_e={kernelName:zf,backendName:"webgl",kernelFunc:p_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_e="return inversesqrt(x);",y_e=tt({opSnippet:g_e,cpuKernelImpl:$de}),v_e={kernelName:Bf,backendName:"webgl",kernelFunc:y_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pk{constructor(e,n,s,i,r,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=yt(r.length),h=yt(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";i===1?m="i":i===2&&(m="i, coords[1]");const g=`getUpdates(${m})`;let v="";l&&(v="coords[0], coords[1]");const _=`getDefaultValue(${v})`,x=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${r});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${x};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(${_}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x_e{constructor(e,n,s,i,r,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=yt(r.length),h=yt(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";i===1?m="i":i===2&&(m="i, coords[1]");const g=`getUpdates(${m})`;let v="";l&&(v="coords[0], coords[1]");const _=`getDefaultValue(${v})`,x=n>1?"strides[j]":"strides",w=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${r});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${x};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${g};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${_}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:r}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=Xl(r,i,o),f=[d/c,c];if(d===0)return n.makeTensorInfo(o,i.dtype);const m=ye({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),g=ye({inputs:{x:r},backend:n,attrs:{shape:[l,c]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0]));let _;ee().getBool("WEBGL_PACK")?_=new x_e(l,a,m.shape.length,g.shape.length,h,f):_=new Pk(l,a,m.shape.length,g.shape.length,h,f);const x=n.runWebGLProgram(_,[g,m,v],g.dtype),w=ye({inputs:{x},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v),w}const w_e={kernelName:uO,backendName:"webgl",kernelFunc:__e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b_e{constructor(e,n,s,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const r="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ee().getNumber("WEBGL_VERSION")===2?r:o,l=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:i,values:r}=e,{side:o}=s,a=new b_e(i.shape[0],i.shape[1],r.shape[1],o),l=[[i.shape[1]]];return n.runWebGLProgram(a,[i,r],"int32",l)}const I_e={kernelName:dO,backendName:"webgl",kernelFunc:C_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k_e{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let i,r;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)r="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let h=0;h<n.length;h++)c.push(`${a[h]}`),h<e&&l.push(`${a[h]}`);i=l.join(),r=c.join()}const o=yt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${r}));
        } else {
          setOutput(getB(${r}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_e(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:r}=e,o=new k_e(s.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[s,i,r],Ds(i.dtype,r.dtype))}const T_e={kernelName:zv,backendName:"webgl",kernelFunc:S_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${sx};
  float scale = ${ix};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,N_e=tt({opSnippet:E_e}),$_e={kernelName:Uf,backendName:"webgl",kernelFunc:N_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_e=Gu+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,A_e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,D_e=tt({opSnippet:R_e,packedOpSnippet:A_e,cpuKernelImpl:Ade}),P_e={kernelName:jf,backendName:"webgl",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,L_e=tt({opSnippet:O_e}),F_e={kernelName:Gf,backendName:"webgl",kernelFunc:L_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_e=Gu+`
  return sin(x);
`,z_e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ec}
  return result;
`,B_e=tt({opSnippet:M_e,packedOpSnippet:z_e}),U_e={kernelName:Wf,backendName:"webgl",kernelFunc:B_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W_e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,V_e=tt({opSnippet:W_e}),G_e={kernelName:Vf,backendName:"webgl",kernelFunc:V_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j_e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,H_e=tt({opSnippet:j_e}),q_e={kernelName:Hf,backendName:"webgl",kernelFunc:H_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,paddings:o}=s;R(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((x,w)=>x*w),l=[[0,0]];l.push(...o);for(let x=1+r.length;x<i.shape.length;++x)l.push([0,0]);const c=[],h=EB({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),d=ap(h.shape,r,a,!1),f=lp(d.length,r.length,!1),m=cp(h.shape,r,a,!1),g=ye({inputs:{x:h},backend:n,attrs:{shape:d}}),v=is({inputs:{x:g},backend:n,attrs:{perm:f}}),_=ye({inputs:{x:v},backend:n,attrs:{shape:m}});return c.push(h),c.push(g),c.push(v),c.forEach(x=>n.disposeIntermediateTensorInfo(x)),_},X_e={kernelName:Wv,backendName:"webgl",kernelFunc:K_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_e(t){const{inputs:e,backend:n}=t,{indices:s,values:i,denseShape:r,defaultValue:o}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(i.dataId),c=n.readSync(r.dataId),h=n.readSync(o.dataId)[0],[d,f,m,g,v]=Pde(a,s.shape,s.dtype,l,i.dtype,c,h);return[n.makeTensorInfo(f,s.dtype,d),n.makeTensorInfo([f[0]],i.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(_=>Number(_)))),n.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const Y_e={kernelName:fO,backendName:"webgl",kernelFunc:Z_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_e(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:i,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(r.dataId)),[c,h,d]=Ode(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(h,s.dtype,c),n.makeTensorInfo([d.length],r.dtype,new Int32Array(d))]}const J_e={kernelName:pO,backendName:"webgl",kernelFunc:Q_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ewe(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${r.shape}`);const o=n.readSync(s.dataId),a=n.readSync(i.dataId),l=n.readSync(r.dataId),[c,h]=Jz(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(h,s.dtype,c)}const twe={kernelName:mO,backendName:"webgl",kernelFunc:ewe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nwe(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${r.shape}`);const o=n.readSync(s.dataId),a=n.readSync(i.dataId),l=n.readSync(r.dataId),[c,h]=Jz(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(h,s.dtype,c)}const swe={kernelName:gO,backendName:"webgl",kernelFunc:nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iwe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:r,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:d,outputSize:f}=Xl(r,i,a),m=!1;if(r.dtype==="string"){const x=n.bufferSync(i),w=n.bufferSync(r),C=ta(n.readSync(o.dataId)[0]),I=Rde(x,w,a,f,h,c,l,d,C,m);return n.makeTensorInfo(a,I.dtype,I.values)}const g=new Pk(c,l,i.shape.length,r.shape.length,d,[f,1],m),v=n.runWebGLProgram(g,[r,i,o],r.dtype),_=ye({inputs:{x:v},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(v),_}const rwe={kernelName:yO,backendName:"webgl",kernelFunc:iwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function owe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:r,axis:o}=s,a=je(o,i.shape)[0],l=jI(i,r,a),c=i.shape.length,h=new Array(c).fill(0),d=i.shape.slice();return l.map(f=>{const m=[...d];m[a]=f;const g=ju({inputs:{x:i},backend:n,attrs:{begin:h,size:m}});return h[a]+=f,g})}const awe={kernelName:Vv,backendName:"webgl",kernelFunc:owe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a$="return sqrt(x);",lwe=tt({opSnippet:a$,packedOpSnippet:a$,cpuKernelImpl:Lde}),cwe={kernelName:qf,backendName:"webgl",kernelFunc:lwe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uwe="return x * x;",hwe=tt({opSnippet:uwe}),dwe={kernelName:EC,backendName:"webgl",kernelFunc:hwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l$="return (a - b) * (a - b);",fwe=Ln({opSnippet:l$,packedOpSnippet:l$}),pwe={kernelName:Kf,backendName:"webgl",kernelFunc:fwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const r=n.readSync(i.dataId),o=co(r),a=Fde(o,"string",s);return n.makeTensorInfo(i.shape,"string",a)}const gwe={kernelName:NC,backendName:"webgl",kernelFunc:mwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ywe({inputs:t,attrs:e,backend:n}){const{x:s}=t,i=Ci+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,r=new gr(s.shape,i);return n.runWebGLProgram(r,[s],s.dtype)}const vwe={kernelName:Jf,backendName:"webgl",kernelFunc:ywe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xwe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const i=s.length,r=yt(s.length),o=yt(s.length);let a="";if(i===1)a="coords * strides + begin";else{let l=0;a=s.map((c,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${r} begin = ${r}(${e});
      ${r} strides = ${r}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _we(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:f}=s,{finalShapeSparse:m,finalShape:g,isIdentity:v,sliceDim0:_,isSimpleSlice:x,begin:w,end:C,strides:I}=TI(i.shape,r,o,a,l,c,h,d,f);let S;if(v)S=ye({inputs:{x:i},backend:n,attrs:{shape:g}});else if(_||x){R(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const E=II(w,C,I),$=ju({inputs:{x:i},backend:n,attrs:{begin:w,size:E}});S=ye({inputs:{x:$},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo($)}else if(n.shouldExecuteOnCPU([i])){const $=n.readSync(i.dataId),D=Ge(i.shape,i.dtype,$),P=Mde(m,D,I,w);S=n.makeTensorInfo(g,i.dtype,P.values)}else{const $=new xwe(w,I,m);S=n.runWebGLProgram($,[i],i.dtype)}const T=ye({inputs:{x:S},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(S),T}const wwe={kernelName:$C,backendName:"webgl",kernelFunc:_we};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bwe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:i,nGramWidths:r,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:d}=e,f=n.readSync(h.dataId),m=n.readSync(d.dataId),[g,v]=zde(f,m,i,r,o,a,l,c);return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(d.shape,"int32",v)]}const Cwe={kernelName:vO,backendName:"webgl",kernelFunc:bwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iwe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:i}=s,{input:r,delimiter:o}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(r.dataId),l=n.readSync(o.dataId)[0],[c,h,d]=Bde(a,l,i),f=h.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const kwe={kernelName:xO,backendName:"webgl",kernelFunc:Iwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Swe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:i}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(r.dataId),a=Ude(o,i);return n.makeTensorInfo(r.shape,"int32",a)}const Twe={kernelName:_O,backendName:"webgl",kernelFunc:Swe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ewe="return tan(x);",Nwe=tt({opSnippet:Ewe}),$we={kernelName:Zf,backendName:"webgl",kernelFunc:Nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rwe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Awe=tt({opSnippet:Rwe}),Dwe={kernelName:Yf,backendName:"webgl",kernelFunc:Awe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pwe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:i,indices:r,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=Xl(o,r,i.shape),f=[d/c,c];if(d===0)return n.makeTensorInfo(i.shape,r.dtype);const m=ye({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),g=ye({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),v=ye({inputs:{x:i},backend:n,attrs:{shape:f}}),_=new Pk(l,a,m.shape.length,g.shape.length,h,f,!1,!0),x=n.runWebGLProgram(_,[g,m,v],v.dtype),w=ye({inputs:{x},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),w}const Owe={kernelName:hO,backendName:"webgl",kernelFunc:Pwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lwe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const i=yt(this.rank),r=Fwe(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${r}));
      }
    `}}function Fwe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<t.length;i++)s.push(`imod(${n[i]}, ${t[i]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:r}=s;if(i.dtype==="string"||i.shape.length>5){const l=n.readSync(i.dataId),c=i.dtype==="string"?l.map(f=>ta(f)):l,h=Ge(i.shape,i.dtype,c),d=Vde(h,r);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const o=new Lwe(i.shape,r);return n.runWebGLProgram(o,[i],i.dtype)}const Mwe={kernelName:Qf,backendName:"webgl",kernelFunc:$B};class zwe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Bwe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fa(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function c$(t){let e=1;for(;e<t;)e*=2;return e}function Uwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:r,sorted:o}=s,a=ee().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ee().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,h=c[c.length-1];if(n.shouldExecuteOnCPU([i])||h<a||r>l){const P=n.readSync(i.dataId),[z,H]=Gde(P,c,i.dtype,r,o);return[n.makeTensorInfo(z.shape,z.dtype,z.values),n.makeTensorInfo(H.shape,H.dtype,H.values)]}if(r===0)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(h===1)return[i,bp({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(i.dataId),f=d!==null&&d.isPacked,m=f?n.unpackTensor(i):i,v=re(c)/h,_=ye({inputs:{x:m},attrs:{shape:[v,h]},backend:n});f&&Fa(n,m);const x=c$(r),w=c$(h);let C=null;const I=()=>C===null?[_,_]:[_,C],S=(P,z,H)=>{const Q=I(),Z=new zwe(H),Y=[[h],[C===null?1:0],[Number.NEGATIVE_INFINITY],[P],[z]],oe=C;C=n.runWebGLProgram(Z,Q,"int32",Y),Fa(n,oe)};for(let P=1;P<x;P*=2){const z=P*2;for(let H=P;H>=1;H/=2)S(z,H,[v,w])}for(let P=w;P>x;P/=2){const z=I(),H=new Bwe([v,P/2]),Z=[[h],[C===null?1:0],[x]],J=C;C=n.runWebGLProgram(H,z,"int32",Z),Fa(n,J);const Y=x/2,oe=Y*2;for(let O=Y;O>=1;O/=2)S(oe,O,C.shape)}let T=C;C=ju({inputs:{x:C},backend:n,attrs:{begin:0,size:[v,r]}}),Fa(n,T);let E=bB({inputs:{x:_,indices:C},backend:n,attrs:{axis:1,batchDims:1}});Fa(n,_);const $=c.slice(0,-1);$.push(r),T=C,C=ye({inputs:{x:C},attrs:{shape:$},backend:n}),Fa(n,T);const D=E;return E=ye({inputs:{x:E},attrs:{shape:$},backend:n}),Fa(n,D),[E,C]}const Wwe={kernelName:RC,backendName:"webgl",kernelFunc:Uwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vwe{constructor(e,n,s,i,r,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(i){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${r});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${r});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gwe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,transforms:r}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[h,d,f,m]=i.shape,[g,v]=c??[d,f],_=[h,g,v,m],x=new Vwe(d,f,o,a,l,_);return n.runWebGLProgram(x,[i,r],"float32")}const jwe={kernelName:AC,backendName:"webgl",kernelFunc:Gwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hwe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:r}=e;xp(r,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(r.dataId),{outputValues:a,outputShape:l,indices:c}=jde(o,i,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const qwe={kernelName:DC,backendName:"webgl",kernelFunc:Hwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kwe(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i,a=o.shape.length,l=i.shape[r],c=new Array(a-1);let h=0;for(let v=0;v<a;v++)v!==r&&(c[h++]=o.shape[v]);const d=[],f=new Array(a).fill(0),m=o.shape.slice();m[r]=1;const g=new Array(l);for(let v=0;v<g.length;v++){f[r]=v;const _=ju({inputs:{x:o},backend:n,attrs:{begin:f,size:m}}),x=ye({inputs:{x:_},backend:n,attrs:{shape:c}});g[v]=x,d.push(_)}return d.forEach(v=>n.disposeIntermediateTensorInfo(v)),g}const Xwe={kernelName:jv,backendName:"webgl",kernelFunc:Kwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zwe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,i=e.batchSize,r=e.inSize,o=e.numSegments,a=o*Math.ceil(r/s);this.outputShape=[i,a];const l="0.0",c="sumValue",h=Math.floor(s/4)*4,d=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let m="";r%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `);let g="";r%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ywe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:r}=e,{numSegments:o}=s,a=i.shape.length,l=[];let c=0;const h=Bt([c],a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),l.push(d),c=Zt(1,a)[0]);const f=pF(d.shape,c,o),m=re([d.shape[c]]),g=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,m]}});l.push(g);const v=LC(i.dtype),_=(I,S,T,E,$)=>{const D=I.shape[0],P=I.shape[1],z=fF(P,$),H={windowSize:z,inSize:P,batchSize:D,numSegments:$},Q=new Zwe(H,S),Z=n.compileAndRun(Q,[I,T],E);if(l.push(Z),Z.shape[1]===$)return Z;const J=NB({backend:n,attrs:{start:0,stop:$,step:1,dtype:"float32"}}),Y=$B({inputs:{x:J},backend:n,attrs:{reps:[P/z]}});return l.push(J),l.push(Y),_(Z,S,Y,E,$)},x=_(g,"unsortedSegmentSum",r,v,o),w=ye({inputs:{x},backend:n,attrs:{shape:f}});let C=w;if(h!=null){l.push(w);const I=_a(h);C=is({inputs:{x:C},backend:n,attrs:{perm:I}})}return l.forEach(I=>n.disposeIntermediateTensorInfo(I)),C}const Qwe={kernelName:Hv,backendName:"webgl",kernelFunc:Ywe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jwe=[Lfe,Mfe,Ufe,Gfe,Hfe,Xfe,Yfe,Jfe,spe,rpe,lpe,hpe,ppe,vpe,wpe,Cpe,kpe,Npe,Rpe,Dpe,Fpe,Gpe,Hpe,Zpe,Qpe,ime,ome,ume,xfe,fme,vme,bme,Eme,Rme,Dme,Ome,Fme,Ume,Gme,qme,Xme,Yme,Jme,nge,ige,lge,uge,fge,gge,vge,bge,Sge,$ge,Dge,Lge,Fge,zge,Uge,Vge,jge,qge,Yge,eye,sye,rye,lye,hye,mye,xye,vfe,wye,gme,Iye,Tye,$ye,wfe,Pye,Mye,Bye,Gye,qye,Yye,eve,ive,lve,hve,fve,yve,xve,wve,kve,Tve,Nve,Rve,Dve,Fve,Uve,jve,Jve,Ife,sxe,oxe,cxe,dxe,eme,mxe,yxe,xxe,bxe,Sxe,Cfe,Exe,$xe,Axe,Pxe,Oxe,tme,Xve,Mxe,Wxe,Hxe,Sfe,Zxe,Jxe,s_e,o_e,u_e,d_e,m_e,v_e,w_e,I_e,T_e,$_e,P_e,F_e,U_e,G_e,Wpe,Yve,q_e,X_e,Y_e,J_e,twe,swe,rwe,awe,cwe,dwe,pwe,gwe,vwe,wwe,Cwe,kwe,Twe,Zve,Dfe,$we,Dwe,Owe,Mwe,Wwe,jwe,Pfe,qwe,Xwe,Qwe,gxe];for(const t of Jwe)bO(t);const e0e=t=>{try{return X(()=>xJ(t).resizeNearestNeighbor([224,224]).toFloat().div(rt(255)).expandDims())}catch(e){return console.error("Image preprocessing error:",e),null}},t0e=(t,e)=>{e||(e=document.createElement("canvas")),e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0);const s=new Image;return s.src=e.toDataURL("image/jpeg"),new Promise((i,r)=>{s.onload=()=>i({src:s.src,element:s}),s.onerror=r})},n0e=()=>{const[t,e]=ie.useState(null),[n,s]=ie.useState(!0),[i,r]=ie.useState(null);return ie.useEffect(()=>{async function a(){try{s(!0);try{const c=await dse("indexeddb://injury-detection-model");e(c),s(!1);return}catch{console.log("No saved model found, creating new model")}const l=mse();l.add(k2({inputShape:[224,224,3],filters:32,kernelSize:3,activation:"relu",padding:"same"})),l.add(T2({poolSize:2})),l.add(k2({filters:64,kernelSize:3,activation:"relu",padding:"same"})),l.add(T2({poolSize:2})),l.add(Pse()),l.add(S2({units:64,activation:"relu"})),l.add(Dse({rate:.5})),l.add(S2({units:4,activation:"softmax"})),l.compile({optimizer:Va.adam(.001),loss:"categoricalCrossentropy",metrics:["accuracy"]}),await l.save("indexeddb://injury-detection-model"),e(l),r(null)}catch(l){console.error("Error loading model:",l),r(l.message)}finally{s(!1)}}return a(),()=>{t&&t.dispose()}},[]),{model:t,isLoading:n,error:i,classifyImage:async a=>{if(!t)throw new Error("Model not loaded");try{const l=e0e(a),c=await t.predict(l).data();return l.dispose(),Array.from(c)}catch(l){throw console.error("Error classifying image:",l),l}}}},RB=ie.createContext(),lw={0:{id:0,label:"No Injury",severity:"low",color:"green",precautions:["No immediate action required","Monitor for any changes"],description:"No visible signs of injury detected."},1:{id:1,label:"Minor Wound",severity:"low",color:"yellow",precautions:["Clean wound with mild antiseptic","Apply sterile bandage","Keep wound dry","Change bandage daily"],description:"Small superficial injury requiring basic first aid."},2:{id:2,label:"Moderate Injury",severity:"medium",color:"orange",precautions:["Clean thoroughly with antiseptic","Control bleeding","Apply pressure bandage","Seek medical consultation","Consider tetanus shot"],description:"Significant wound that may require professional medical assessment."},3:{id:3,label:"Severe Injury",severity:"high",color:"red",precautions:["Call emergency services immediately","Do not move if serious injury suspected","Apply direct pressure to wound","Prevent patient from going into shock","Keep patient warm and still"],description:"Critical injury requiring immediate professional medical intervention."}},s0e=({children:t})=>{const e=n=>lw[n]||lw[0];return A.jsx(RB.Provider,{value:{getInjuryClassification:e,INJURY_CLASSIFICATIONS:lw},children:t})},i0e=()=>{const t=ie.useContext(RB);if(!t)throw new Error("useInjuryClassification must be used within an InjuryClassificationProvider");return t};function r0e(){const[t,e]=ie.useState(null),[n,s]=ie.useState(null),[i,r]=ie.useState(!1),[o,a]=ie.useState(!1),[l,c]=ie.useState(null),h=ie.useRef(null),d=ie.useRef(null),f=ie.useRef(null),{model:m,isLoading:g,classifyImage:v}=n0e(),{getInjuryClassification:_}=i0e(),x=E=>{const $=E.target.files[0];if($){const D=new FileReader;D.onload=P=>{e(P.target.result),s(null),c(null)},D.readAsDataURL($)}},w=async()=>{c(null);try{const E=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"}});d.current.srcObject=E,d.current.onloadedmetadata=()=>{d.current.play()},a(!0)}catch(E){C(E)}},C=E=>{console.error("Camera access error:",E),c({NotAllowedError:"Camera permission denied",NotFoundError:"No camera found",OverconstrainedError:"Camera settings incompatible"}[E.name]||"Camera access failed"),a(!1),S()},I=async()=>{try{const E=await t0e(d.current,f.current);e(E.src),S()}catch(E){console.error("Image capture error:",E),c("Failed to capture image")}},S=()=>{var $,D;(((D=($=d.current)==null?void 0:$.srcObject)==null?void 0:D.getTracks())||[]).forEach(P=>P.stop()),a(!1)},T=async()=>{if(!(!m||!t)){r(!0);try{const E=new Image;E.src=t,await new Promise(z=>{E.onload=z});const $=await v(E),D=$.indexOf(Math.max(...$)),P=_(D);s(P)}catch(E){console.error("Image analysis error:",E),c("Image analysis failed")}finally{r(!1)}}};return ie.useEffect(()=>()=>S(),[]),A.jsx("div",{className:"container mx-auto px-4 py-8",children:A.jsxs("div",{className:"max-w-3xl mx-auto",children:[A.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Injury Detection"}),A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[l&&A.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:l}),A.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[A.jsxs("button",{onClick:()=>h.current.click(),className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:[A.jsx(sH,{size:20})," Upload Image"]}),A.jsxs("button",{onClick:o?I:w,disabled:g,className:"flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 disabled:opacity-50",children:[A.jsx(_g,{size:20})," ",o?"Capture":"Use Camera"]})]}),A.jsx("input",{type:"file",ref:h,onChange:x,accept:"image/*",className:"hidden"}),A.jsx("canvas",{ref:f,className:"hidden"}),A.jsx("div",{className:"relative aspect-video mb-6",children:o?A.jsx("video",{ref:d,className:"w-full h-full object-cover rounded-lg",playsInline:!0}):t?A.jsx("img",{src:t,alt:"Uploaded injury",className:"w-full h-full object-cover rounded-lg"}):A.jsx("div",{className:"w-full h-full bg-gray-100 rounded-lg flex items-center justify-center",children:A.jsx("p",{className:"text-gray-500",children:"No image selected"})})}),t&&!o&&A.jsx("button",{onClick:T,disabled:i||g,className:"w-full bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 disabled:opacity-50",children:i?"Analyzing...":"Analyze Image"}),n&&A.jsxs("div",{className:`mt-6 p-4 bg-${n.color}-50 rounded-lg`,children:[A.jsxs("h3",{className:"font-semibold mb-2 flex items-center",children:[n.severity==="high"?A.jsx(ID,{className:"mr-2 text-red-600"}):A.jsx(qj,{className:"mr-2 text-green-600"}),"Analysis Results"]}),A.jsxs("p",{className:"mb-2",children:[A.jsx("strong",{children:"Detected:"})," ",n.label]}),A.jsxs("div",{className:"mt-4 font-medium",children:[A.jsx("h4",{children:"Recommended Precautions:"}),A.jsx("ul",{className:"list-disc list-inside",children:n.precautions.map((E,$)=>A.jsx("li",{children:E},$))})]})]})]})]})})}function AB(t,e){const n=ie.useRef(e);ie.useEffect(function(){e!==n.current&&t.attributionControl!=null&&(n.current!=null&&t.attributionControl.removeAttribution(n.current),e!=null&&t.attributionControl.addAttribution(e)),n.current=e},[t,e])}const o0e=1;function a0e(t){return Object.freeze({__version:o0e,map:t})}function l0e(t,e){return Object.freeze({...t,...e})}const DB=ie.createContext(null),PB=DB.Provider;function Ok(){const t=ie.useContext(DB);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function c0e(t){function e(n,s){const{instance:i,context:r}=t(n).current;return ie.useImperativeHandle(s,()=>i),n.children==null?null:qm.createElement(PB,{value:r},n.children)}return ie.forwardRef(e)}function u0e(t){function e(n,s){const[i,r]=ie.useState(!1),{instance:o}=t(n,r).current;ie.useImperativeHandle(s,()=>o),ie.useEffect(function(){i&&o.update()},[o,i,n.children]);const a=o._contentNode;return a?uD.createPortal(n.children,a):null}return ie.forwardRef(e)}function h0e(t){function e(n,s){const{instance:i}=t(n).current;return ie.useImperativeHandle(s,()=>i),null}return ie.forwardRef(e)}function OB(t,e){const n=ie.useRef();ie.useEffect(function(){return e!=null&&t.instance.on(e),n.current=e,function(){n.current!=null&&t.instance.off(n.current),n.current=null}},[t,e])}function Lk(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function d0e(t,e){return function(s,i){const r=Ok(),o=t(Lk(s,r),r);return AB(r.map,s.attribution),OB(o.current,s.eventHandlers),e(o.current,r,s,i),o}}var cb={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(n,s){s(e)})(ua,function(n){var s="1.9.4";function i(u){var p,y,b,k;for(y=1,b=arguments.length;y<b;y++){k=arguments[y];for(p in k)u[p]=k[p]}return u}var r=Object.create||function(){function u(){}return function(p){return u.prototype=p,new u}}();function o(u,p){var y=Array.prototype.slice;if(u.bind)return u.bind.apply(u,y.call(arguments,1));var b=y.call(arguments,2);return function(){return u.apply(p,b.length?b.concat(y.call(arguments)):arguments)}}var a=0;function l(u){return"_leaflet_id"in u||(u._leaflet_id=++a),u._leaflet_id}function c(u,p,y){var b,k,N,M;return M=function(){b=!1,k&&(N.apply(y,k),k=!1)},N=function(){b?k=arguments:(u.apply(y,arguments),setTimeout(M,p),b=!0)},N}function h(u,p,y){var b=p[1],k=p[0],N=b-k;return u===b&&y?u:((u-k)%N+N)%N+k}function d(){return!1}function f(u,p){if(p===!1)return u;var y=Math.pow(10,p===void 0?6:p);return Math.round(u*y)/y}function m(u){return u.trim?u.trim():u.replace(/^\s+|\s+$/g,"")}function g(u){return m(u).split(/\s+/)}function v(u,p){Object.prototype.hasOwnProperty.call(u,"options")||(u.options=u.options?r(u.options):{});for(var y in p)u.options[y]=p[y];return u.options}function _(u,p,y){var b=[];for(var k in u)b.push(encodeURIComponent(y?k.toUpperCase():k)+"="+encodeURIComponent(u[k]));return(!p||p.indexOf("?")===-1?"?":"&")+b.join("&")}var x=/\{ *([\w_ -]+) *\}/g;function w(u,p){return u.replace(x,function(y,b){var k=p[b];if(k===void 0)throw new Error("No value provided for variable "+y);return typeof k=="function"&&(k=k(p)),k})}var C=Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"};function I(u,p){for(var y=0;y<u.length;y++)if(u[y]===p)return y;return-1}var S="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function T(u){return window["webkit"+u]||window["moz"+u]||window["ms"+u]}var E=0;function $(u){var p=+new Date,y=Math.max(0,16-(p-E));return E=p+y,window.setTimeout(u,y)}var D=window.requestAnimationFrame||T("RequestAnimationFrame")||$,P=window.cancelAnimationFrame||T("CancelAnimationFrame")||T("CancelRequestAnimationFrame")||function(u){window.clearTimeout(u)};function z(u,p,y){if(y&&D===$)u.call(p);else return D.call(window,o(u,p))}function H(u){u&&P.call(window,u)}var Q={__proto__:null,extend:i,create:r,bind:o,get lastId(){return a},stamp:l,throttle:c,wrapNum:h,falseFn:d,formatNum:f,trim:m,splitWords:g,setOptions:v,getParamString:_,template:w,isArray:C,indexOf:I,emptyImageUrl:S,requestFn:D,cancelFn:P,requestAnimFrame:z,cancelAnimFrame:H};function Z(){}Z.extend=function(u){var p=function(){v(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},y=p.__super__=this.prototype,b=r(y);b.constructor=p,p.prototype=b;for(var k in this)Object.prototype.hasOwnProperty.call(this,k)&&k!=="prototype"&&k!=="__super__"&&(p[k]=this[k]);return u.statics&&i(p,u.statics),u.includes&&(J(u.includes),i.apply(null,[b].concat(u.includes))),i(b,u),delete b.statics,delete b.includes,b.options&&(b.options=y.options?r(y.options):{},i(b.options,u.options)),b._initHooks=[],b.callInitHooks=function(){if(!this._initHooksCalled){y.callInitHooks&&y.callInitHooks.call(this),this._initHooksCalled=!0;for(var N=0,M=b._initHooks.length;N<M;N++)b._initHooks[N].call(this)}},p},Z.include=function(u){var p=this.prototype.options;return i(this.prototype,u),u.options&&(this.prototype.options=p,this.mergeOptions(u.options)),this},Z.mergeOptions=function(u){return i(this.prototype.options,u),this},Z.addInitHook=function(u){var p=Array.prototype.slice.call(arguments,1),y=typeof u=="function"?u:function(){this[u].apply(this,p)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(y),this};function J(u){if(!(typeof L>"u"||!L||!L.Mixin)){u=C(u)?u:[u];for(var p=0;p<u.length;p++)u[p]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Y={on:function(u,p,y){if(typeof u=="object")for(var b in u)this._on(b,u[b],p);else{u=g(u);for(var k=0,N=u.length;k<N;k++)this._on(u[k],p,y)}return this},off:function(u,p,y){if(!arguments.length)delete this._events;else if(typeof u=="object")for(var b in u)this._off(b,u[b],p);else{u=g(u);for(var k=arguments.length===1,N=0,M=u.length;N<M;N++)k?this._off(u[N]):this._off(u[N],p,y)}return this},_on:function(u,p,y,b){if(typeof p!="function"){console.warn("wrong listener type: "+typeof p);return}if(this._listens(u,p,y)===!1){y===this&&(y=void 0);var k={fn:p,ctx:y};b&&(k.once=!0),this._events=this._events||{},this._events[u]=this._events[u]||[],this._events[u].push(k)}},_off:function(u,p,y){var b,k,N;if(this._events&&(b=this._events[u],!!b)){if(arguments.length===1){if(this._firingCount)for(k=0,N=b.length;k<N;k++)b[k].fn=d;delete this._events[u];return}if(typeof p!="function"){console.warn("wrong listener type: "+typeof p);return}var M=this._listens(u,p,y);if(M!==!1){var K=b[M];this._firingCount&&(K.fn=d,this._events[u]=b=b.slice()),b.splice(M,1)}}},fire:function(u,p,y){if(!this.listens(u,y))return this;var b=i({},p,{type:u,target:this,sourceTarget:p&&p.sourceTarget||this});if(this._events){var k=this._events[u];if(k){this._firingCount=this._firingCount+1||1;for(var N=0,M=k.length;N<M;N++){var K=k[N],ne=K.fn;K.once&&this.off(u,ne,K.ctx),ne.call(K.ctx||this,b)}this._firingCount--}}return y&&this._propagateEvent(b),this},listens:function(u,p,y,b){typeof u!="string"&&console.warn('"string" type argument expected');var k=p;typeof p!="function"&&(b=!!p,k=void 0,y=void 0);var N=this._events&&this._events[u];if(N&&N.length&&this._listens(u,k,y)!==!1)return!0;if(b){for(var M in this._eventParents)if(this._eventParents[M].listens(u,p,y,b))return!0}return!1},_listens:function(u,p,y){if(!this._events)return!1;var b=this._events[u]||[];if(!p)return!!b.length;y===this&&(y=void 0);for(var k=0,N=b.length;k<N;k++)if(b[k].fn===p&&b[k].ctx===y)return k;return!1},once:function(u,p,y){if(typeof u=="object")for(var b in u)this._on(b,u[b],p,!0);else{u=g(u);for(var k=0,N=u.length;k<N;k++)this._on(u[k],p,y,!0)}return this},addEventParent:function(u){return this._eventParents=this._eventParents||{},this._eventParents[l(u)]=u,this},removeEventParent:function(u){return this._eventParents&&delete this._eventParents[l(u)],this},_propagateEvent:function(u){for(var p in this._eventParents)this._eventParents[p].fire(u.type,i({layer:u.target,propagatedFrom:u.target},u),!0)}};Y.addEventListener=Y.on,Y.removeEventListener=Y.clearAllEventListeners=Y.off,Y.addOneTimeEventListener=Y.once,Y.fireEvent=Y.fire,Y.hasEventListeners=Y.listens;var oe=Z.extend(Y);function O(u,p,y){this.x=y?Math.round(u):u,this.y=y?Math.round(p):p}var q=Math.trunc||function(u){return u>0?Math.floor(u):Math.ceil(u)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(u){return this.clone()._add(V(u))},_add:function(u){return this.x+=u.x,this.y+=u.y,this},subtract:function(u){return this.clone()._subtract(V(u))},_subtract:function(u){return this.x-=u.x,this.y-=u.y,this},divideBy:function(u){return this.clone()._divideBy(u)},_divideBy:function(u){return this.x/=u,this.y/=u,this},multiplyBy:function(u){return this.clone()._multiplyBy(u)},_multiplyBy:function(u){return this.x*=u,this.y*=u,this},scaleBy:function(u){return new O(this.x*u.x,this.y*u.y)},unscaleBy:function(u){return new O(this.x/u.x,this.y/u.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=q(this.x),this.y=q(this.y),this},distanceTo:function(u){u=V(u);var p=u.x-this.x,y=u.y-this.y;return Math.sqrt(p*p+y*y)},equals:function(u){return u=V(u),u.x===this.x&&u.y===this.y},contains:function(u){return u=V(u),Math.abs(u.x)<=Math.abs(this.x)&&Math.abs(u.y)<=Math.abs(this.y)},toString:function(){return"Point("+f(this.x)+", "+f(this.y)+")"}};function V(u,p,y){return u instanceof O?u:C(u)?new O(u[0],u[1]):u==null?u:typeof u=="object"&&"x"in u&&"y"in u?new O(u.x,u.y):new O(u,p,y)}function te(u,p){if(u)for(var y=p?[u,p]:u,b=0,k=y.length;b<k;b++)this.extend(y[b])}te.prototype={extend:function(u){var p,y;if(!u)return this;if(u instanceof O||typeof u[0]=="number"||"x"in u)p=y=V(u);else if(u=ae(u),p=u.min,y=u.max,!p||!y)return this;return!this.min&&!this.max?(this.min=p.clone(),this.max=y.clone()):(this.min.x=Math.min(p.x,this.min.x),this.max.x=Math.max(y.x,this.max.x),this.min.y=Math.min(p.y,this.min.y),this.max.y=Math.max(y.y,this.max.y)),this},getCenter:function(u){return V((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,u)},getBottomLeft:function(){return V(this.min.x,this.max.y)},getTopRight:function(){return V(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(u){var p,y;return typeof u[0]=="number"||u instanceof O?u=V(u):u=ae(u),u instanceof te?(p=u.min,y=u.max):p=y=u,p.x>=this.min.x&&y.x<=this.max.x&&p.y>=this.min.y&&y.y<=this.max.y},intersects:function(u){u=ae(u);var p=this.min,y=this.max,b=u.min,k=u.max,N=k.x>=p.x&&b.x<=y.x,M=k.y>=p.y&&b.y<=y.y;return N&&M},overlaps:function(u){u=ae(u);var p=this.min,y=this.max,b=u.min,k=u.max,N=k.x>p.x&&b.x<y.x,M=k.y>p.y&&b.y<y.y;return N&&M},isValid:function(){return!!(this.min&&this.max)},pad:function(u){var p=this.min,y=this.max,b=Math.abs(p.x-y.x)*u,k=Math.abs(p.y-y.y)*u;return ae(V(p.x-b,p.y-k),V(y.x+b,y.y+k))},equals:function(u){return u?(u=ae(u),this.min.equals(u.getTopLeft())&&this.max.equals(u.getBottomRight())):!1}};function ae(u,p){return!u||u instanceof te?u:new te(u,p)}function ue(u,p){if(u)for(var y=p?[u,p]:u,b=0,k=y.length;b<k;b++)this.extend(y[b])}ue.prototype={extend:function(u){var p=this._southWest,y=this._northEast,b,k;if(u instanceof le)b=u,k=u;else if(u instanceof ue){if(b=u._southWest,k=u._northEast,!b||!k)return this}else return u?this.extend(ce(u)||he(u)):this;return!p&&!y?(this._southWest=new le(b.lat,b.lng),this._northEast=new le(k.lat,k.lng)):(p.lat=Math.min(b.lat,p.lat),p.lng=Math.min(b.lng,p.lng),y.lat=Math.max(k.lat,y.lat),y.lng=Math.max(k.lng,y.lng)),this},pad:function(u){var p=this._southWest,y=this._northEast,b=Math.abs(p.lat-y.lat)*u,k=Math.abs(p.lng-y.lng)*u;return new ue(new le(p.lat-b,p.lng-k),new le(y.lat+b,y.lng+k))},getCenter:function(){return new le((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new le(this.getNorth(),this.getWest())},getSouthEast:function(){return new le(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(u){typeof u[0]=="number"||u instanceof le||"lat"in u?u=ce(u):u=he(u);var p=this._southWest,y=this._northEast,b,k;return u instanceof ue?(b=u.getSouthWest(),k=u.getNorthEast()):b=k=u,b.lat>=p.lat&&k.lat<=y.lat&&b.lng>=p.lng&&k.lng<=y.lng},intersects:function(u){u=he(u);var p=this._southWest,y=this._northEast,b=u.getSouthWest(),k=u.getNorthEast(),N=k.lat>=p.lat&&b.lat<=y.lat,M=k.lng>=p.lng&&b.lng<=y.lng;return N&&M},overlaps:function(u){u=he(u);var p=this._southWest,y=this._northEast,b=u.getSouthWest(),k=u.getNorthEast(),N=k.lat>p.lat&&b.lat<y.lat,M=k.lng>p.lng&&b.lng<y.lng;return N&&M},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(u,p){return u?(u=he(u),this._southWest.equals(u.getSouthWest(),p)&&this._northEast.equals(u.getNorthEast(),p)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function he(u,p){return u instanceof ue?u:new ue(u,p)}function le(u,p,y){if(isNaN(u)||isNaN(p))throw new Error("Invalid LatLng object: ("+u+", "+p+")");this.lat=+u,this.lng=+p,y!==void 0&&(this.alt=+y)}le.prototype={equals:function(u,p){if(!u)return!1;u=ce(u);var y=Math.max(Math.abs(this.lat-u.lat),Math.abs(this.lng-u.lng));return y<=(p===void 0?1e-9:p)},toString:function(u){return"LatLng("+f(this.lat,u)+", "+f(this.lng,u)+")"},distanceTo:function(u){return Se.distance(this,ce(u))},wrap:function(){return Se.wrapLatLng(this)},toBounds:function(u){var p=180*u/40075017,y=p/Math.cos(Math.PI/180*this.lat);return he([this.lat-p,this.lng-y],[this.lat+p,this.lng+y])},clone:function(){return new le(this.lat,this.lng,this.alt)}};function ce(u,p,y){return u instanceof le?u:C(u)&&typeof u[0]!="object"?u.length===3?new le(u[0],u[1],u[2]):u.length===2?new le(u[0],u[1]):null:u==null?u:typeof u=="object"&&"lat"in u?new le(u.lat,"lng"in u?u.lng:u.lon,u.alt):p===void 0?null:new le(u,p,y)}var we={latLngToPoint:function(u,p){var y=this.projection.project(u),b=this.scale(p);return this.transformation._transform(y,b)},pointToLatLng:function(u,p){var y=this.scale(p),b=this.transformation.untransform(u,y);return this.projection.unproject(b)},project:function(u){return this.projection.project(u)},unproject:function(u){return this.projection.unproject(u)},scale:function(u){return 256*Math.pow(2,u)},zoom:function(u){return Math.log(u/256)/Math.LN2},getProjectedBounds:function(u){if(this.infinite)return null;var p=this.projection.bounds,y=this.scale(u),b=this.transformation.transform(p.min,y),k=this.transformation.transform(p.max,y);return new te(b,k)},infinite:!1,wrapLatLng:function(u){var p=this.wrapLng?h(u.lng,this.wrapLng,!0):u.lng,y=this.wrapLat?h(u.lat,this.wrapLat,!0):u.lat,b=u.alt;return new le(y,p,b)},wrapLatLngBounds:function(u){var p=u.getCenter(),y=this.wrapLatLng(p),b=p.lat-y.lat,k=p.lng-y.lng;if(b===0&&k===0)return u;var N=u.getSouthWest(),M=u.getNorthEast(),K=new le(N.lat-b,N.lng-k),ne=new le(M.lat-b,M.lng-k);return new ue(K,ne)}},Se=i({},we,{wrapLng:[-180,180],R:6371e3,distance:function(u,p){var y=Math.PI/180,b=u.lat*y,k=p.lat*y,N=Math.sin((p.lat-u.lat)*y/2),M=Math.sin((p.lng-u.lng)*y/2),K=N*N+Math.cos(b)*Math.cos(k)*M*M,ne=2*Math.atan2(Math.sqrt(K),Math.sqrt(1-K));return this.R*ne}}),Ee=6378137,Fe={R:Ee,MAX_LATITUDE:85.0511287798,project:function(u){var p=Math.PI/180,y=this.MAX_LATITUDE,b=Math.max(Math.min(y,u.lat),-y),k=Math.sin(b*p);return new O(this.R*u.lng*p,this.R*Math.log((1+k)/(1-k))/2)},unproject:function(u){var p=180/Math.PI;return new le((2*Math.atan(Math.exp(u.y/this.R))-Math.PI/2)*p,u.x*p/this.R)},bounds:function(){var u=Ee*Math.PI;return new te([-u,-u],[u,u])}()};function Me(u,p,y,b){if(C(u)){this._a=u[0],this._b=u[1],this._c=u[2],this._d=u[3];return}this._a=u,this._b=p,this._c=y,this._d=b}Me.prototype={transform:function(u,p){return this._transform(u.clone(),p)},_transform:function(u,p){return p=p||1,u.x=p*(this._a*u.x+this._b),u.y=p*(this._c*u.y+this._d),u},untransform:function(u,p){return p=p||1,new O((u.x/p-this._b)/this._a,(u.y/p-this._d)/this._c)}};function Qe(u,p,y,b){return new Me(u,p,y,b)}var ut=i({},Se,{code:"EPSG:3857",projection:Fe,transformation:function(){var u=.5/(Math.PI*Fe.R);return Qe(u,.5,-u,.5)}()}),Rt=i({},ut,{code:"EPSG:900913"});function dt(u){return document.createElementNS("http://www.w3.org/2000/svg",u)}function ot(u,p){var y="",b,k,N,M,K,ne;for(b=0,N=u.length;b<N;b++){for(K=u[b],k=0,M=K.length;k<M;k++)ne=K[k],y+=(k?"L":"M")+ne.x+" "+ne.y;y+=p?Ne.svg?"z":"x":""}return y||"M0 0"}var vt=document.documentElement.style,ft="ActiveXObject"in window,Ii=ft&&!document.addEventListener,Jt="msLaunchUri"in navigator&&!("documentMode"in document),Qs=sr("webkit"),Kn=sr("android"),nr=sr("android 2")||sr("android 3"),Ms=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ki=Kn&&sr("Google")&&Ms<537&&!("AudioNode"in window),Js=!!window.opera,Si=!Jt&&sr("chrome"),Ti=sr("gecko")&&!Qs&&!Js&&!ft,Ea=!Si&&sr("safari"),sc=sr("phantom"),ic="OTransition"in vt,Dx=navigator.platform.indexOf("Win")===0,Na=ft&&"transition"in vt,Xu="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!nr,Np="MozPerspective"in vt,J4=!window.L_DISABLE_3D&&(Na||Xu||Np)&&!ic&&!sc,Zu=typeof orientation<"u"||sr("mobile"),eU=Zu&&Qs,tU=Zu&&Xu,_S=!window.PointerEvent&&window.MSPointerEvent,wS=!!(window.PointerEvent||_S),bS="ontouchstart"in window||!!window.TouchEvent,nU=!window.L_NO_TOUCH&&(bS||wS),sU=Zu&&Js,iU=Zu&&Ti,rU=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,oU=function(){var u=!1;try{var p=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("testPassiveEventSupport",d,p),window.removeEventListener("testPassiveEventSupport",d,p)}catch{}return u}(),aU=function(){return!!document.createElement("canvas").getContext}(),Px=!!(document.createElementNS&&dt("svg").createSVGRect),lU=!!Px&&function(){var u=document.createElement("div");return u.innerHTML="<svg/>",(u.firstChild&&u.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),cU=!Px&&function(){try{var u=document.createElement("div");u.innerHTML='<v:shape adj="1"/>';var p=u.firstChild;return p.style.behavior="url(#default#VML)",p&&typeof p.adj=="object"}catch{return!1}}(),uU=navigator.platform.indexOf("Mac")===0,hU=navigator.platform.indexOf("Linux")===0;function sr(u){return navigator.userAgent.toLowerCase().indexOf(u)>=0}var Ne={ie:ft,ielt9:Ii,edge:Jt,webkit:Qs,android:Kn,android23:nr,androidStock:ki,opera:Js,chrome:Si,gecko:Ti,safari:Ea,phantom:sc,opera12:ic,win:Dx,ie3d:Na,webkit3d:Xu,gecko3d:Np,any3d:J4,mobile:Zu,mobileWebkit:eU,mobileWebkit3d:tU,msPointer:_S,pointer:wS,touch:nU,touchNative:bS,mobileOpera:sU,mobileGecko:iU,retina:rU,passiveEvents:oU,canvas:aU,svg:Px,vml:cU,inlineSvg:lU,mac:uU,linux:hU},CS=Ne.msPointer?"MSPointerDown":"pointerdown",IS=Ne.msPointer?"MSPointerMove":"pointermove",kS=Ne.msPointer?"MSPointerUp":"pointerup",SS=Ne.msPointer?"MSPointerCancel":"pointercancel",Ox={touchstart:CS,touchmove:IS,touchend:kS,touchcancel:SS},TS={touchstart:yU,touchmove:$p,touchend:$p,touchcancel:$p},rc={},ES=!1;function dU(u,p,y){return p==="touchstart"&&gU(),TS[p]?(y=TS[p].bind(this,y),u.addEventListener(Ox[p],y,!1),y):(console.warn("wrong event specified:",p),d)}function fU(u,p,y){if(!Ox[p]){console.warn("wrong event specified:",p);return}u.removeEventListener(Ox[p],y,!1)}function pU(u){rc[u.pointerId]=u}function mU(u){rc[u.pointerId]&&(rc[u.pointerId]=u)}function NS(u){delete rc[u.pointerId]}function gU(){ES||(document.addEventListener(CS,pU,!0),document.addEventListener(IS,mU,!0),document.addEventListener(kS,NS,!0),document.addEventListener(SS,NS,!0),ES=!0)}function $p(u,p){if(p.pointerType!==(p.MSPOINTER_TYPE_MOUSE||"mouse")){p.touches=[];for(var y in rc)p.touches.push(rc[y]);p.changedTouches=[p],u(p)}}function yU(u,p){p.MSPOINTER_TYPE_TOUCH&&p.pointerType===p.MSPOINTER_TYPE_TOUCH&&Fn(p),$p(u,p)}function vU(u){var p={},y,b;for(b in u)y=u[b],p[b]=y&&y.bind?y.bind(u):y;return u=p,p.type="dblclick",p.detail=2,p.isTrusted=!1,p._simulated=!0,p}var xU=200;function _U(u,p){u.addEventListener("dblclick",p);var y=0,b;function k(N){if(N.detail!==1){b=N.detail;return}if(!(N.pointerType==="mouse"||N.sourceCapabilities&&!N.sourceCapabilities.firesTouchEvents)){var M=PS(N);if(!(M.some(function(ne){return ne instanceof HTMLLabelElement&&ne.attributes.for})&&!M.some(function(ne){return ne instanceof HTMLInputElement||ne instanceof HTMLSelectElement}))){var K=Date.now();K-y<=xU?(b++,b===2&&p(vU(N))):b=1,y=K}}}return u.addEventListener("click",k),{dblclick:p,simDblclick:k}}function wU(u,p){u.removeEventListener("dblclick",p.dblclick),u.removeEventListener("click",p.simDblclick)}var Lx=Dp(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Yu=Dp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),$S=Yu==="webkitTransition"||Yu==="OTransition"?Yu+"End":"transitionend";function RS(u){return typeof u=="string"?document.getElementById(u):u}function Qu(u,p){var y=u.style[p]||u.currentStyle&&u.currentStyle[p];if((!y||y==="auto")&&document.defaultView){var b=document.defaultView.getComputedStyle(u,null);y=b?b[p]:null}return y==="auto"?null:y}function at(u,p,y){var b=document.createElement(u);return b.className=p||"",y&&y.appendChild(b),b}function Ut(u){var p=u.parentNode;p&&p.removeChild(u)}function Rp(u){for(;u.firstChild;)u.removeChild(u.firstChild)}function oc(u){var p=u.parentNode;p&&p.lastChild!==u&&p.appendChild(u)}function ac(u){var p=u.parentNode;p&&p.firstChild!==u&&p.insertBefore(u,p.firstChild)}function Fx(u,p){if(u.classList!==void 0)return u.classList.contains(p);var y=Ap(u);return y.length>0&&new RegExp("(^|\\s)"+p+"(\\s|$)").test(y)}function Ve(u,p){if(u.classList!==void 0)for(var y=g(p),b=0,k=y.length;b<k;b++)u.classList.add(y[b]);else if(!Fx(u,p)){var N=Ap(u);Mx(u,(N?N+" ":"")+p)}}function en(u,p){u.classList!==void 0?u.classList.remove(p):Mx(u,m((" "+Ap(u)+" ").replace(" "+p+" "," ")))}function Mx(u,p){u.className.baseVal===void 0?u.className=p:u.className.baseVal=p}function Ap(u){return u.correspondingElement&&(u=u.correspondingElement),u.className.baseVal===void 0?u.className:u.className.baseVal}function ei(u,p){"opacity"in u.style?u.style.opacity=p:"filter"in u.style&&bU(u,p)}function bU(u,p){var y=!1,b="DXImageTransform.Microsoft.Alpha";try{y=u.filters.item(b)}catch{if(p===1)return}p=Math.round(p*100),y?(y.Enabled=p!==100,y.Opacity=p):u.style.filter+=" progid:"+b+"(opacity="+p+")"}function Dp(u){for(var p=document.documentElement.style,y=0;y<u.length;y++)if(u[y]in p)return u[y];return!1}function $a(u,p,y){var b=p||new O(0,0);u.style[Lx]=(Ne.ie3d?"translate("+b.x+"px,"+b.y+"px)":"translate3d("+b.x+"px,"+b.y+"px,0)")+(y?" scale("+y+")":"")}function rn(u,p){u._leaflet_pos=p,Ne.any3d?$a(u,p):(u.style.left=p.x+"px",u.style.top=p.y+"px")}function Ra(u){return u._leaflet_pos||new O(0,0)}var Ju,eh,zx;if("onselectstart"in document)Ju=function(){Be(window,"selectstart",Fn)},eh=function(){kt(window,"selectstart",Fn)};else{var th=Dp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ju=function(){if(th){var u=document.documentElement.style;zx=u[th],u[th]="none"}},eh=function(){th&&(document.documentElement.style[th]=zx,zx=void 0)}}function Bx(){Be(window,"dragstart",Fn)}function Ux(){kt(window,"dragstart",Fn)}var Pp,Wx;function Vx(u){for(;u.tabIndex===-1;)u=u.parentNode;u.style&&(Op(),Pp=u,Wx=u.style.outlineStyle,u.style.outlineStyle="none",Be(window,"keydown",Op))}function Op(){Pp&&(Pp.style.outlineStyle=Wx,Pp=void 0,Wx=void 0,kt(window,"keydown",Op))}function AS(u){do u=u.parentNode;while((!u.offsetWidth||!u.offsetHeight)&&u!==document.body);return u}function Gx(u){var p=u.getBoundingClientRect();return{x:p.width/u.offsetWidth||1,y:p.height/u.offsetHeight||1,boundingClientRect:p}}var CU={__proto__:null,TRANSFORM:Lx,TRANSITION:Yu,TRANSITION_END:$S,get:RS,getStyle:Qu,create:at,remove:Ut,empty:Rp,toFront:oc,toBack:ac,hasClass:Fx,addClass:Ve,removeClass:en,setClass:Mx,getClass:Ap,setOpacity:ei,testProp:Dp,setTransform:$a,setPosition:rn,getPosition:Ra,get disableTextSelection(){return Ju},get enableTextSelection(){return eh},disableImageDrag:Bx,enableImageDrag:Ux,preventOutline:Vx,restoreOutline:Op,getSizedParentNode:AS,getScale:Gx};function Be(u,p,y,b){if(p&&typeof p=="object")for(var k in p)Hx(u,k,p[k],y);else{p=g(p);for(var N=0,M=p.length;N<M;N++)Hx(u,p[N],y,b)}return this}var ir="_leaflet_events";function kt(u,p,y,b){if(arguments.length===1)DS(u),delete u[ir];else if(p&&typeof p=="object")for(var k in p)qx(u,k,p[k],y);else if(p=g(p),arguments.length===2)DS(u,function(K){return I(p,K)!==-1});else for(var N=0,M=p.length;N<M;N++)qx(u,p[N],y,b);return this}function DS(u,p){for(var y in u[ir]){var b=y.split(/\d/)[0];(!p||p(b))&&qx(u,b,null,null,y)}}var jx={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Hx(u,p,y,b){var k=p+l(y)+(b?"_"+l(b):"");if(u[ir]&&u[ir][k])return this;var N=function(K){return y.call(b||u,K||window.event)},M=N;!Ne.touchNative&&Ne.pointer&&p.indexOf("touch")===0?N=dU(u,p,N):Ne.touch&&p==="dblclick"?N=_U(u,N):"addEventListener"in u?p==="touchstart"||p==="touchmove"||p==="wheel"||p==="mousewheel"?u.addEventListener(jx[p]||p,N,Ne.passiveEvents?{passive:!1}:!1):p==="mouseenter"||p==="mouseleave"?(N=function(K){K=K||window.event,Xx(u,K)&&M(K)},u.addEventListener(jx[p],N,!1)):u.addEventListener(p,M,!1):u.attachEvent("on"+p,N),u[ir]=u[ir]||{},u[ir][k]=N}function qx(u,p,y,b,k){k=k||p+l(y)+(b?"_"+l(b):"");var N=u[ir]&&u[ir][k];if(!N)return this;!Ne.touchNative&&Ne.pointer&&p.indexOf("touch")===0?fU(u,p,N):Ne.touch&&p==="dblclick"?wU(u,N):"removeEventListener"in u?u.removeEventListener(jx[p]||p,N,!1):u.detachEvent("on"+p,N),u[ir][k]=null}function Aa(u){return u.stopPropagation?u.stopPropagation():u.originalEvent?u.originalEvent._stopped=!0:u.cancelBubble=!0,this}function Kx(u){return Hx(u,"wheel",Aa),this}function nh(u){return Be(u,"mousedown touchstart dblclick contextmenu",Aa),u._leaflet_disable_click=!0,this}function Fn(u){return u.preventDefault?u.preventDefault():u.returnValue=!1,this}function Da(u){return Fn(u),Aa(u),this}function PS(u){if(u.composedPath)return u.composedPath();for(var p=[],y=u.target;y;)p.push(y),y=y.parentNode;return p}function OS(u,p){if(!p)return new O(u.clientX,u.clientY);var y=Gx(p),b=y.boundingClientRect;return new O((u.clientX-b.left)/y.x-p.clientLeft,(u.clientY-b.top)/y.y-p.clientTop)}var IU=Ne.linux&&Ne.chrome?window.devicePixelRatio:Ne.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function LS(u){return Ne.edge?u.wheelDeltaY/2:u.deltaY&&u.deltaMode===0?-u.deltaY/IU:u.deltaY&&u.deltaMode===1?-u.deltaY*20:u.deltaY&&u.deltaMode===2?-u.deltaY*60:u.deltaX||u.deltaZ?0:u.wheelDelta?(u.wheelDeltaY||u.wheelDelta)/2:u.detail&&Math.abs(u.detail)<32765?-u.detail*20:u.detail?u.detail/-32765*60:0}function Xx(u,p){var y=p.relatedTarget;if(!y)return!0;try{for(;y&&y!==u;)y=y.parentNode}catch{return!1}return y!==u}var kU={__proto__:null,on:Be,off:kt,stopPropagation:Aa,disableScrollPropagation:Kx,disableClickPropagation:nh,preventDefault:Fn,stop:Da,getPropagationPath:PS,getMousePosition:OS,getWheelDelta:LS,isExternalTarget:Xx,addListener:Be,removeListener:kt},FS=oe.extend({run:function(u,p,y,b){this.stop(),this._el=u,this._inProgress=!0,this._duration=y||.25,this._easeOutPower=1/Math.max(b||.5,.2),this._startPos=Ra(u),this._offset=p.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=z(this._animate,this),this._step()},_step:function(u){var p=+new Date-this._startTime,y=this._duration*1e3;p<y?this._runFrame(this._easeOut(p/y),u):(this._runFrame(1),this._complete())},_runFrame:function(u,p){var y=this._startPos.add(this._offset.multiplyBy(u));p&&y._round(),rn(this._el,y),this.fire("step")},_complete:function(){H(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(u){return 1-Math.pow(1-u,this._easeOutPower)}}),nt=oe.extend({options:{crs:ut,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(u,p){p=v(this,p),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(u),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),p.maxBounds&&this.setMaxBounds(p.maxBounds),p.zoom!==void 0&&(this._zoom=this._limitZoom(p.zoom)),p.center&&p.zoom!==void 0&&this.setView(ce(p.center),p.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Yu&&Ne.any3d&&!Ne.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Be(this._proxy,$S,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(u,p,y){if(p=p===void 0?this._zoom:this._limitZoom(p),u=this._limitCenter(ce(u),p,this.options.maxBounds),y=y||{},this._stop(),this._loaded&&!y.reset&&y!==!0){y.animate!==void 0&&(y.zoom=i({animate:y.animate},y.zoom),y.pan=i({animate:y.animate,duration:y.duration},y.pan));var b=this._zoom!==p?this._tryAnimatedZoom&&this._tryAnimatedZoom(u,p,y.zoom):this._tryAnimatedPan(u,y.pan);if(b)return clearTimeout(this._sizeTimer),this}return this._resetView(u,p,y.pan&&y.pan.noMoveStart),this},setZoom:function(u,p){return this._loaded?this.setView(this.getCenter(),u,{zoom:p}):(this._zoom=u,this)},zoomIn:function(u,p){return u=u||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+u,p)},zoomOut:function(u,p){return u=u||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-u,p)},setZoomAround:function(u,p,y){var b=this.getZoomScale(p),k=this.getSize().divideBy(2),N=u instanceof O?u:this.latLngToContainerPoint(u),M=N.subtract(k).multiplyBy(1-1/b),K=this.containerPointToLatLng(k.add(M));return this.setView(K,p,{zoom:y})},_getBoundsCenterZoom:function(u,p){p=p||{},u=u.getBounds?u.getBounds():he(u);var y=V(p.paddingTopLeft||p.padding||[0,0]),b=V(p.paddingBottomRight||p.padding||[0,0]),k=this.getBoundsZoom(u,!1,y.add(b));if(k=typeof p.maxZoom=="number"?Math.min(p.maxZoom,k):k,k===1/0)return{center:u.getCenter(),zoom:k};var N=b.subtract(y).divideBy(2),M=this.project(u.getSouthWest(),k),K=this.project(u.getNorthEast(),k),ne=this.unproject(M.add(K).divideBy(2).add(N),k);return{center:ne,zoom:k}},fitBounds:function(u,p){if(u=he(u),!u.isValid())throw new Error("Bounds are not valid.");var y=this._getBoundsCenterZoom(u,p);return this.setView(y.center,y.zoom,p)},fitWorld:function(u){return this.fitBounds([[-90,-180],[90,180]],u)},panTo:function(u,p){return this.setView(u,this._zoom,{pan:p})},panBy:function(u,p){if(u=V(u).round(),p=p||{},!u.x&&!u.y)return this.fire("moveend");if(p.animate!==!0&&!this.getSize().contains(u))return this._resetView(this.unproject(this.project(this.getCenter()).add(u)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new FS,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),p.noMoveStart||this.fire("movestart"),p.animate!==!1){Ve(this._mapPane,"leaflet-pan-anim");var y=this._getMapPanePos().subtract(u).round();this._panAnim.run(this._mapPane,y,p.duration||.25,p.easeLinearity)}else this._rawPanBy(u),this.fire("move").fire("moveend");return this},flyTo:function(u,p,y){if(y=y||{},y.animate===!1||!Ne.any3d)return this.setView(u,p,y);this._stop();var b=this.project(this.getCenter()),k=this.project(u),N=this.getSize(),M=this._zoom;u=ce(u),p=p===void 0?M:p;var K=Math.max(N.x,N.y),ne=K*this.getZoomScale(M,p),fe=k.distanceTo(b)||1,be=1.42,Pe=be*be;function qe(on){var qp=on?-1:1,fW=on?ne:K,pW=ne*ne-K*K+qp*Pe*Pe*fe*fe,mW=2*fW*Pe*fe,o_=pW/mW,yT=Math.sqrt(o_*o_+1)-o_,gW=yT<1e-9?-18:Math.log(yT);return gW}function os(on){return(Math.exp(on)-Math.exp(-on))/2}function kn(on){return(Math.exp(on)+Math.exp(-on))/2}function ni(on){return os(on)/kn(on)}var xs=qe(0);function fc(on){return K*(kn(xs)/kn(xs+be*on))}function cW(on){return K*(kn(xs)*ni(xs+be*on)-os(xs))/Pe}function uW(on){return 1-Math.pow(1-on,1.5)}var hW=Date.now(),mT=(qe(1)-xs)/be,dW=y.duration?1e3*y.duration:1e3*mT*.8;function gT(){var on=(Date.now()-hW)/dW,qp=uW(on)*mT;on<=1?(this._flyToFrame=z(gT,this),this._move(this.unproject(b.add(k.subtract(b).multiplyBy(cW(qp)/fe)),M),this.getScaleZoom(K/fc(qp),M),{flyTo:!0})):this._move(u,p)._moveEnd(!0)}return this._moveStart(!0,y.noMoveStart),gT.call(this),this},flyToBounds:function(u,p){var y=this._getBoundsCenterZoom(u,p);return this.flyTo(y.center,y.zoom,p)},setMaxBounds:function(u){return u=he(u),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),u.isValid()?(this.options.maxBounds=u,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(u){var p=this.options.minZoom;return this.options.minZoom=u,this._loaded&&p!==u&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(u):this},setMaxZoom:function(u){var p=this.options.maxZoom;return this.options.maxZoom=u,this._loaded&&p!==u&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(u):this},panInsideBounds:function(u,p){this._enforcingBounds=!0;var y=this.getCenter(),b=this._limitCenter(y,this._zoom,he(u));return y.equals(b)||this.panTo(b,p),this._enforcingBounds=!1,this},panInside:function(u,p){p=p||{};var y=V(p.paddingTopLeft||p.padding||[0,0]),b=V(p.paddingBottomRight||p.padding||[0,0]),k=this.project(this.getCenter()),N=this.project(u),M=this.getPixelBounds(),K=ae([M.min.add(y),M.max.subtract(b)]),ne=K.getSize();if(!K.contains(N)){this._enforcingBounds=!0;var fe=N.subtract(K.getCenter()),be=K.extend(N).getSize().subtract(ne);k.x+=fe.x<0?-be.x:be.x,k.y+=fe.y<0?-be.y:be.y,this.panTo(this.unproject(k),p),this._enforcingBounds=!1}return this},invalidateSize:function(u){if(!this._loaded)return this;u=i({animate:!1,pan:!0},u===!0?{animate:!0}:u);var p=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var y=this.getSize(),b=p.divideBy(2).round(),k=y.divideBy(2).round(),N=b.subtract(k);return!N.x&&!N.y?this:(u.animate&&u.pan?this.panBy(N):(u.pan&&this._rawPanBy(N),this.fire("move"),u.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:p,newSize:y}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(u){if(u=this._locateOptions=i({timeout:1e4,watch:!1},u),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var p=o(this._handleGeolocationResponse,this),y=o(this._handleGeolocationError,this);return u.watch?this._locationWatchId=navigator.geolocation.watchPosition(p,y,u):navigator.geolocation.getCurrentPosition(p,y,u),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(u){if(this._container._leaflet_id){var p=u.code,y=u.message||(p===1?"permission denied":p===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:p,message:"Geolocation error: "+y+"."})}},_handleGeolocationResponse:function(u){if(this._container._leaflet_id){var p=u.coords.latitude,y=u.coords.longitude,b=new le(p,y),k=b.toBounds(u.coords.accuracy*2),N=this._locateOptions;if(N.setView){var M=this.getBoundsZoom(k);this.setView(b,N.maxZoom?Math.min(M,N.maxZoom):M)}var K={latlng:b,bounds:k,timestamp:u.timestamp};for(var ne in u.coords)typeof u.coords[ne]=="number"&&(K[ne]=u.coords[ne]);this.fire("locationfound",K)}},addHandler:function(u,p){if(!p)return this;var y=this[u]=new p(this);return this._handlers.push(y),this.options[u]&&y.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ut(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(H(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var u;for(u in this._layers)this._layers[u].remove();for(u in this._panes)Ut(this._panes[u]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(u,p){var y="leaflet-pane"+(u?" leaflet-"+u.replace("Pane","")+"-pane":""),b=at("div",y,p||this._mapPane);return u&&(this._panes[u]=b),b},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var u=this.getPixelBounds(),p=this.unproject(u.getBottomLeft()),y=this.unproject(u.getTopRight());return new ue(p,y)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(u,p,y){u=he(u),y=V(y||[0,0]);var b=this.getZoom()||0,k=this.getMinZoom(),N=this.getMaxZoom(),M=u.getNorthWest(),K=u.getSouthEast(),ne=this.getSize().subtract(y),fe=ae(this.project(K,b),this.project(M,b)).getSize(),be=Ne.any3d?this.options.zoomSnap:1,Pe=ne.x/fe.x,qe=ne.y/fe.y,os=p?Math.max(Pe,qe):Math.min(Pe,qe);return b=this.getScaleZoom(os,b),be&&(b=Math.round(b/(be/100))*(be/100),b=p?Math.ceil(b/be)*be:Math.floor(b/be)*be),Math.max(k,Math.min(N,b))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(u,p){var y=this._getTopLeftPoint(u,p);return new te(y,y.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(u){return this.options.crs.getProjectedBounds(u===void 0?this.getZoom():u)},getPane:function(u){return typeof u=="string"?this._panes[u]:u},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(u,p){var y=this.options.crs;return p=p===void 0?this._zoom:p,y.scale(u)/y.scale(p)},getScaleZoom:function(u,p){var y=this.options.crs;p=p===void 0?this._zoom:p;var b=y.zoom(u*y.scale(p));return isNaN(b)?1/0:b},project:function(u,p){return p=p===void 0?this._zoom:p,this.options.crs.latLngToPoint(ce(u),p)},unproject:function(u,p){return p=p===void 0?this._zoom:p,this.options.crs.pointToLatLng(V(u),p)},layerPointToLatLng:function(u){var p=V(u).add(this.getPixelOrigin());return this.unproject(p)},latLngToLayerPoint:function(u){var p=this.project(ce(u))._round();return p._subtract(this.getPixelOrigin())},wrapLatLng:function(u){return this.options.crs.wrapLatLng(ce(u))},wrapLatLngBounds:function(u){return this.options.crs.wrapLatLngBounds(he(u))},distance:function(u,p){return this.options.crs.distance(ce(u),ce(p))},containerPointToLayerPoint:function(u){return V(u).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(u){return V(u).add(this._getMapPanePos())},containerPointToLatLng:function(u){var p=this.containerPointToLayerPoint(V(u));return this.layerPointToLatLng(p)},latLngToContainerPoint:function(u){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ce(u)))},mouseEventToContainerPoint:function(u){return OS(u,this._container)},mouseEventToLayerPoint:function(u){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(u))},mouseEventToLatLng:function(u){return this.layerPointToLatLng(this.mouseEventToLayerPoint(u))},_initContainer:function(u){var p=this._container=RS(u);if(p){if(p._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Be(p,"scroll",this._onScroll,this),this._containerId=l(p)},_initLayout:function(){var u=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ne.any3d,Ve(u,"leaflet-container"+(Ne.touch?" leaflet-touch":"")+(Ne.retina?" leaflet-retina":"")+(Ne.ielt9?" leaflet-oldie":"")+(Ne.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var p=Qu(u,"position");p!=="absolute"&&p!=="relative"&&p!=="fixed"&&p!=="sticky"&&(u.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var u=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),rn(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ve(u.markerPane,"leaflet-zoom-hide"),Ve(u.shadowPane,"leaflet-zoom-hide"))},_resetView:function(u,p,y){rn(this._mapPane,new O(0,0));var b=!this._loaded;this._loaded=!0,p=this._limitZoom(p),this.fire("viewprereset");var k=this._zoom!==p;this._moveStart(k,y)._move(u,p)._moveEnd(k),this.fire("viewreset"),b&&this.fire("load")},_moveStart:function(u,p){return u&&this.fire("zoomstart"),p||this.fire("movestart"),this},_move:function(u,p,y,b){p===void 0&&(p=this._zoom);var k=this._zoom!==p;return this._zoom=p,this._lastCenter=u,this._pixelOrigin=this._getNewPixelOrigin(u),b?y&&y.pinch&&this.fire("zoom",y):((k||y&&y.pinch)&&this.fire("zoom",y),this.fire("move",y)),this},_moveEnd:function(u){return u&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return H(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(u){rn(this._mapPane,this._getMapPanePos().subtract(u))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(u){this._targets={},this._targets[l(this._container)]=this;var p=u?kt:Be;p(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&p(window,"resize",this._onResize,this),Ne.any3d&&this.options.transform3DLimit&&(u?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){H(this._resizeRequest),this._resizeRequest=z(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var u=this._getMapPanePos();Math.max(Math.abs(u.x),Math.abs(u.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(u,p){for(var y=[],b,k=p==="mouseout"||p==="mouseover",N=u.target||u.srcElement,M=!1;N;){if(b=this._targets[l(N)],b&&(p==="click"||p==="preclick")&&this._draggableMoved(b)){M=!0;break}if(b&&b.listens(p,!0)&&(k&&!Xx(N,u)||(y.push(b),k))||N===this._container)break;N=N.parentNode}return!y.length&&!M&&!k&&this.listens(p,!0)&&(y=[this]),y},_isClickDisabled:function(u){for(;u&&u!==this._container;){if(u._leaflet_disable_click)return!0;u=u.parentNode}},_handleDOMEvent:function(u){var p=u.target||u.srcElement;if(!(!this._loaded||p._leaflet_disable_events||u.type==="click"&&this._isClickDisabled(p))){var y=u.type;y==="mousedown"&&Vx(p),this._fireDOMEvent(u,y)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(u,p,y){if(u.type==="click"){var b=i({},u);b.type="preclick",this._fireDOMEvent(b,b.type,y)}var k=this._findEventTargets(u,p);if(y){for(var N=[],M=0;M<y.length;M++)y[M].listens(p,!0)&&N.push(y[M]);k=N.concat(k)}if(k.length){p==="contextmenu"&&Fn(u);var K=k[0],ne={originalEvent:u};if(u.type!=="keypress"&&u.type!=="keydown"&&u.type!=="keyup"){var fe=K.getLatLng&&(!K._radius||K._radius<=10);ne.containerPoint=fe?this.latLngToContainerPoint(K.getLatLng()):this.mouseEventToContainerPoint(u),ne.layerPoint=this.containerPointToLayerPoint(ne.containerPoint),ne.latlng=fe?K.getLatLng():this.layerPointToLatLng(ne.layerPoint)}for(M=0;M<k.length;M++)if(k[M].fire(p,ne,!0),ne.originalEvent._stopped||k[M].options.bubblingMouseEvents===!1&&I(this._mouseEvents,p)!==-1)return}},_draggableMoved:function(u){return u=u.dragging&&u.dragging.enabled()?u:this,u.dragging&&u.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var u=0,p=this._handlers.length;u<p;u++)this._handlers[u].disable()},whenReady:function(u,p){return this._loaded?u.call(p||this,{target:this}):this.on("load",u,p),this},_getMapPanePos:function(){return Ra(this._mapPane)||new O(0,0)},_moved:function(){var u=this._getMapPanePos();return u&&!u.equals([0,0])},_getTopLeftPoint:function(u,p){var y=u&&p!==void 0?this._getNewPixelOrigin(u,p):this.getPixelOrigin();return y.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(u,p){var y=this.getSize()._divideBy(2);return this.project(u,p)._subtract(y)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(u,p,y){var b=this._getNewPixelOrigin(y,p);return this.project(u,p)._subtract(b)},_latLngBoundsToNewLayerBounds:function(u,p,y){var b=this._getNewPixelOrigin(y,p);return ae([this.project(u.getSouthWest(),p)._subtract(b),this.project(u.getNorthWest(),p)._subtract(b),this.project(u.getSouthEast(),p)._subtract(b),this.project(u.getNorthEast(),p)._subtract(b)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(u){return this.latLngToLayerPoint(u).subtract(this._getCenterLayerPoint())},_limitCenter:function(u,p,y){if(!y)return u;var b=this.project(u,p),k=this.getSize().divideBy(2),N=new te(b.subtract(k),b.add(k)),M=this._getBoundsOffset(N,y,p);return Math.abs(M.x)<=1&&Math.abs(M.y)<=1?u:this.unproject(b.add(M),p)},_limitOffset:function(u,p){if(!p)return u;var y=this.getPixelBounds(),b=new te(y.min.add(u),y.max.add(u));return u.add(this._getBoundsOffset(b,p))},_getBoundsOffset:function(u,p,y){var b=ae(this.project(p.getNorthEast(),y),this.project(p.getSouthWest(),y)),k=b.min.subtract(u.min),N=b.max.subtract(u.max),M=this._rebound(k.x,-N.x),K=this._rebound(k.y,-N.y);return new O(M,K)},_rebound:function(u,p){return u+p>0?Math.round(u-p)/2:Math.max(0,Math.ceil(u))-Math.max(0,Math.floor(p))},_limitZoom:function(u){var p=this.getMinZoom(),y=this.getMaxZoom(),b=Ne.any3d?this.options.zoomSnap:1;return b&&(u=Math.round(u/b)*b),Math.max(p,Math.min(y,u))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){en(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(u,p){var y=this._getCenterOffset(u)._trunc();return(p&&p.animate)!==!0&&!this.getSize().contains(y)?!1:(this.panBy(y,p),!0)},_createAnimProxy:function(){var u=this._proxy=at("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(u),this.on("zoomanim",function(p){var y=Lx,b=this._proxy.style[y];$a(this._proxy,this.project(p.center,p.zoom),this.getZoomScale(p.zoom,1)),b===this._proxy.style[y]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ut(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var u=this.getCenter(),p=this.getZoom();$a(this._proxy,this.project(u,p),this.getZoomScale(p,1))},_catchTransitionEnd:function(u){this._animatingZoom&&u.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(u,p,y){if(this._animatingZoom)return!0;if(y=y||{},!this._zoomAnimated||y.animate===!1||this._nothingToAnimate()||Math.abs(p-this._zoom)>this.options.zoomAnimationThreshold)return!1;var b=this.getZoomScale(p),k=this._getCenterOffset(u)._divideBy(1-1/b);return y.animate!==!0&&!this.getSize().contains(k)?!1:(z(function(){this._moveStart(!0,y.noMoveStart||!1)._animateZoom(u,p,!0)},this),!0)},_animateZoom:function(u,p,y,b){this._mapPane&&(y&&(this._animatingZoom=!0,this._animateToCenter=u,this._animateToZoom=p,Ve(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:u,zoom:p,noUpdate:b}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&en(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function SU(u,p){return new nt(u,p)}var Ei=Z.extend({options:{position:"topright"},initialize:function(u){v(this,u)},getPosition:function(){return this.options.position},setPosition:function(u){var p=this._map;return p&&p.removeControl(this),this.options.position=u,p&&p.addControl(this),this},getContainer:function(){return this._container},addTo:function(u){this.remove(),this._map=u;var p=this._container=this.onAdd(u),y=this.getPosition(),b=u._controlCorners[y];return Ve(p,"leaflet-control"),y.indexOf("bottom")!==-1?b.insertBefore(p,b.firstChild):b.appendChild(p),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ut(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(u){this._map&&u&&u.screenX>0&&u.screenY>0&&this._map.getContainer().focus()}}),sh=function(u){return new Ei(u)};nt.include({addControl:function(u){return u.addTo(this),this},removeControl:function(u){return u.remove(),this},_initControlPos:function(){var u=this._controlCorners={},p="leaflet-",y=this._controlContainer=at("div",p+"control-container",this._container);function b(k,N){var M=p+k+" "+p+N;u[k+N]=at("div",M,y)}b("top","left"),b("top","right"),b("bottom","left"),b("bottom","right")},_clearControlPos:function(){for(var u in this._controlCorners)Ut(this._controlCorners[u]);Ut(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var MS=Ei.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(u,p,y,b){return y<b?-1:b<y?1:0}},initialize:function(u,p,y){v(this,y),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var b in u)this._addLayer(u[b],b);for(b in p)this._addLayer(p[b],b,!0)},onAdd:function(u){this._initLayout(),this._update(),this._map=u,u.on("zoomend",this._checkDisabledLayers,this);for(var p=0;p<this._layers.length;p++)this._layers[p].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(u){return Ei.prototype.addTo.call(this,u),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var u=0;u<this._layers.length;u++)this._layers[u].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(u,p){return this._addLayer(u,p),this._map?this._update():this},addOverlay:function(u,p){return this._addLayer(u,p,!0),this._map?this._update():this},removeLayer:function(u){u.off("add remove",this._onLayerChange,this);var p=this._getLayer(l(u));return p&&this._layers.splice(this._layers.indexOf(p),1),this._map?this._update():this},expand:function(){Ve(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var u=this._map.getSize().y-(this._container.offsetTop+50);return u<this._section.clientHeight?(Ve(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=u+"px"):en(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return en(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var u="leaflet-control-layers",p=this._container=at("div",u),y=this.options.collapsed;p.setAttribute("aria-haspopup",!0),nh(p),Kx(p);var b=this._section=at("section",u+"-list");y&&(this._map.on("click",this.collapse,this),Be(p,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var k=this._layersLink=at("a",u+"-toggle",p);k.href="#",k.title="Layers",k.setAttribute("role","button"),Be(k,{keydown:function(N){N.keyCode===13&&this._expandSafely()},click:function(N){Fn(N),this._expandSafely()}},this),y||this.expand(),this._baseLayersList=at("div",u+"-base",b),this._separator=at("div",u+"-separator",b),this._overlaysList=at("div",u+"-overlays",b),p.appendChild(b)},_getLayer:function(u){for(var p=0;p<this._layers.length;p++)if(this._layers[p]&&l(this._layers[p].layer)===u)return this._layers[p]},_addLayer:function(u,p,y){this._map&&u.on("add remove",this._onLayerChange,this),this._layers.push({layer:u,name:p,overlay:y}),this.options.sortLayers&&this._layers.sort(o(function(b,k){return this.options.sortFunction(b.layer,k.layer,b.name,k.name)},this)),this.options.autoZIndex&&u.setZIndex&&(this._lastZIndex++,u.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Rp(this._baseLayersList),Rp(this._overlaysList),this._layerControlInputs=[];var u,p,y,b,k=0;for(y=0;y<this._layers.length;y++)b=this._layers[y],this._addItem(b),p=p||b.overlay,u=u||!b.overlay,k+=b.overlay?0:1;return this.options.hideSingleBase&&(u=u&&k>1,this._baseLayersList.style.display=u?"":"none"),this._separator.style.display=p&&u?"":"none",this},_onLayerChange:function(u){this._handlingClick||this._update();var p=this._getLayer(l(u.target)),y=p.overlay?u.type==="add"?"overlayadd":"overlayremove":u.type==="add"?"baselayerchange":null;y&&this._map.fire(y,p)},_createRadioElement:function(u,p){var y='<input type="radio" class="leaflet-control-layers-selector" name="'+u+'"'+(p?' checked="checked"':"")+"/>",b=document.createElement("div");return b.innerHTML=y,b.firstChild},_addItem:function(u){var p=document.createElement("label"),y=this._map.hasLayer(u.layer),b;u.overlay?(b=document.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=y):b=this._createRadioElement("leaflet-base-layers_"+l(this),y),this._layerControlInputs.push(b),b.layerId=l(u.layer),Be(b,"click",this._onInputClick,this);var k=document.createElement("span");k.innerHTML=" "+u.name;var N=document.createElement("span");p.appendChild(N),N.appendChild(b),N.appendChild(k);var M=u.overlay?this._overlaysList:this._baseLayersList;return M.appendChild(p),this._checkDisabledLayers(),p},_onInputClick:function(){if(!this._preventClick){var u=this._layerControlInputs,p,y,b=[],k=[];this._handlingClick=!0;for(var N=u.length-1;N>=0;N--)p=u[N],y=this._getLayer(p.layerId).layer,p.checked?b.push(y):p.checked||k.push(y);for(N=0;N<k.length;N++)this._map.hasLayer(k[N])&&this._map.removeLayer(k[N]);for(N=0;N<b.length;N++)this._map.hasLayer(b[N])||this._map.addLayer(b[N]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var u=this._layerControlInputs,p,y,b=this._map.getZoom(),k=u.length-1;k>=0;k--)p=u[k],y=this._getLayer(p.layerId).layer,p.disabled=y.options.minZoom!==void 0&&b<y.options.minZoom||y.options.maxZoom!==void 0&&b>y.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var u=this._section;this._preventClick=!0,Be(u,"click",Fn),this.expand();var p=this;setTimeout(function(){kt(u,"click",Fn),p._preventClick=!1})}}),TU=function(u,p,y){return new MS(u,p,y)},Zx=Ei.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(u){var p="leaflet-control-zoom",y=at("div",p+" leaflet-bar"),b=this.options;return this._zoomInButton=this._createButton(b.zoomInText,b.zoomInTitle,p+"-in",y,this._zoomIn),this._zoomOutButton=this._createButton(b.zoomOutText,b.zoomOutTitle,p+"-out",y,this._zoomOut),this._updateDisabled(),u.on("zoomend zoomlevelschange",this._updateDisabled,this),y},onRemove:function(u){u.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(u){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(u.shiftKey?3:1))},_zoomOut:function(u){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(u.shiftKey?3:1))},_createButton:function(u,p,y,b,k){var N=at("a",y,b);return N.innerHTML=u,N.href="#",N.title=p,N.setAttribute("role","button"),N.setAttribute("aria-label",p),nh(N),Be(N,"click",Da),Be(N,"click",k,this),Be(N,"click",this._refocusOnMap,this),N},_updateDisabled:function(){var u=this._map,p="leaflet-disabled";en(this._zoomInButton,p),en(this._zoomOutButton,p),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||u._zoom===u.getMinZoom())&&(Ve(this._zoomOutButton,p),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||u._zoom===u.getMaxZoom())&&(Ve(this._zoomInButton,p),this._zoomInButton.setAttribute("aria-disabled","true"))}});nt.mergeOptions({zoomControl:!0}),nt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Zx,this.addControl(this.zoomControl))});var EU=function(u){return new Zx(u)},zS=Ei.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(u){var p="leaflet-control-scale",y=at("div",p),b=this.options;return this._addScales(b,p+"-line",y),u.on(b.updateWhenIdle?"moveend":"move",this._update,this),u.whenReady(this._update,this),y},onRemove:function(u){u.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(u,p,y){u.metric&&(this._mScale=at("div",p,y)),u.imperial&&(this._iScale=at("div",p,y))},_update:function(){var u=this._map,p=u.getSize().y/2,y=u.distance(u.containerPointToLatLng([0,p]),u.containerPointToLatLng([this.options.maxWidth,p]));this._updateScales(y)},_updateScales:function(u){this.options.metric&&u&&this._updateMetric(u),this.options.imperial&&u&&this._updateImperial(u)},_updateMetric:function(u){var p=this._getRoundNum(u),y=p<1e3?p+" m":p/1e3+" km";this._updateScale(this._mScale,y,p/u)},_updateImperial:function(u){var p=u*3.2808399,y,b,k;p>5280?(y=p/5280,b=this._getRoundNum(y),this._updateScale(this._iScale,b+" mi",b/y)):(k=this._getRoundNum(p),this._updateScale(this._iScale,k+" ft",k/p))},_updateScale:function(u,p,y){u.style.width=Math.round(this.options.maxWidth*y)+"px",u.innerHTML=p},_getRoundNum:function(u){var p=Math.pow(10,(Math.floor(u)+"").length-1),y=u/p;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,p*y}}),NU=function(u){return new zS(u)},$U='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Yx=Ei.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ne.inlineSvg?$U+" ":"")+"Leaflet</a>"},initialize:function(u){v(this,u),this._attributions={}},onAdd:function(u){u.attributionControl=this,this._container=at("div","leaflet-control-attribution"),nh(this._container);for(var p in u._layers)u._layers[p].getAttribution&&this.addAttribution(u._layers[p].getAttribution());return this._update(),u.on("layeradd",this._addAttribution,this),this._container},onRemove:function(u){u.off("layeradd",this._addAttribution,this)},_addAttribution:function(u){u.layer.getAttribution&&(this.addAttribution(u.layer.getAttribution()),u.layer.once("remove",function(){this.removeAttribution(u.layer.getAttribution())},this))},setPrefix:function(u){return this.options.prefix=u,this._update(),this},addAttribution:function(u){return u?(this._attributions[u]||(this._attributions[u]=0),this._attributions[u]++,this._update(),this):this},removeAttribution:function(u){return u?(this._attributions[u]&&(this._attributions[u]--,this._update()),this):this},_update:function(){if(this._map){var u=[];for(var p in this._attributions)this._attributions[p]&&u.push(p);var y=[];this.options.prefix&&y.push(this.options.prefix),u.length&&y.push(u.join(", ")),this._container.innerHTML=y.join(' <span aria-hidden="true">|</span> ')}}});nt.mergeOptions({attributionControl:!0}),nt.addInitHook(function(){this.options.attributionControl&&new Yx().addTo(this)});var RU=function(u){return new Yx(u)};Ei.Layers=MS,Ei.Zoom=Zx,Ei.Scale=zS,Ei.Attribution=Yx,sh.layers=TU,sh.zoom=EU,sh.scale=NU,sh.attribution=RU;var rr=Z.extend({initialize:function(u){this._map=u},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});rr.addTo=function(u,p){return u.addHandler(p,this),this};var AU={Events:Y},BS=Ne.touch?"touchstart mousedown":"mousedown",vo=oe.extend({options:{clickTolerance:3},initialize:function(u,p,y,b){v(this,b),this._element=u,this._dragStartTarget=p||u,this._preventOutline=y},enable:function(){this._enabled||(Be(this._dragStartTarget,BS,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(vo._dragging===this&&this.finishDrag(!0),kt(this._dragStartTarget,BS,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(u){if(this._enabled&&(this._moved=!1,!Fx(this._element,"leaflet-zoom-anim"))){if(u.touches&&u.touches.length!==1){vo._dragging===this&&this.finishDrag();return}if(!(vo._dragging||u.shiftKey||u.which!==1&&u.button!==1&&!u.touches)&&(vo._dragging=this,this._preventOutline&&Vx(this._element),Bx(),Ju(),!this._moving)){this.fire("down");var p=u.touches?u.touches[0]:u,y=AS(this._element);this._startPoint=new O(p.clientX,p.clientY),this._startPos=Ra(this._element),this._parentScale=Gx(y);var b=u.type==="mousedown";Be(document,b?"mousemove":"touchmove",this._onMove,this),Be(document,b?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(u){if(this._enabled){if(u.touches&&u.touches.length>1){this._moved=!0;return}var p=u.touches&&u.touches.length===1?u.touches[0]:u,y=new O(p.clientX,p.clientY)._subtract(this._startPoint);!y.x&&!y.y||Math.abs(y.x)+Math.abs(y.y)<this.options.clickTolerance||(y.x/=this._parentScale.x,y.y/=this._parentScale.y,Fn(u),this._moved||(this.fire("dragstart"),this._moved=!0,Ve(document.body,"leaflet-dragging"),this._lastTarget=u.target||u.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ve(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(y),this._moving=!0,this._lastEvent=u,this._updatePosition())}},_updatePosition:function(){var u={originalEvent:this._lastEvent};this.fire("predrag",u),rn(this._element,this._newPos),this.fire("drag",u)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(u){en(document.body,"leaflet-dragging"),this._lastTarget&&(en(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),kt(document,"mousemove touchmove",this._onMove,this),kt(document,"mouseup touchend touchcancel",this._onUp,this),Ux(),eh();var p=this._moved&&this._moving;this._moving=!1,vo._dragging=!1,p&&this.fire("dragend",{noInertia:u,distance:this._newPos.distanceTo(this._startPos)})}});function US(u,p,y){var b,k=[1,4,2,8],N,M,K,ne,fe,be,Pe,qe;for(N=0,be=u.length;N<be;N++)u[N]._code=Pa(u[N],p);for(K=0;K<4;K++){for(Pe=k[K],b=[],N=0,be=u.length,M=be-1;N<be;M=N++)ne=u[N],fe=u[M],ne._code&Pe?fe._code&Pe||(qe=Lp(fe,ne,Pe,p,y),qe._code=Pa(qe,p),b.push(qe)):(fe._code&Pe&&(qe=Lp(fe,ne,Pe,p,y),qe._code=Pa(qe,p),b.push(qe)),b.push(ne));u=b}return u}function WS(u,p){var y,b,k,N,M,K,ne,fe,be;if(!u||u.length===0)throw new Error("latlngs not passed");ti(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var Pe=ce([0,0]),qe=he(u),os=qe.getNorthWest().distanceTo(qe.getSouthWest())*qe.getNorthEast().distanceTo(qe.getNorthWest());os<1700&&(Pe=Qx(u));var kn=u.length,ni=[];for(y=0;y<kn;y++){var xs=ce(u[y]);ni.push(p.project(ce([xs.lat-Pe.lat,xs.lng-Pe.lng])))}for(K=ne=fe=0,y=0,b=kn-1;y<kn;b=y++)k=ni[y],N=ni[b],M=k.y*N.x-N.y*k.x,ne+=(k.x+N.x)*M,fe+=(k.y+N.y)*M,K+=M*3;K===0?be=ni[0]:be=[ne/K,fe/K];var fc=p.unproject(V(be));return ce([fc.lat+Pe.lat,fc.lng+Pe.lng])}function Qx(u){for(var p=0,y=0,b=0,k=0;k<u.length;k++){var N=ce(u[k]);p+=N.lat,y+=N.lng,b++}return ce([p/b,y/b])}var DU={__proto__:null,clipPolygon:US,polygonCenter:WS,centroid:Qx};function VS(u,p){if(!p||!u.length)return u.slice();var y=p*p;return u=LU(u,y),u=OU(u,y),u}function GS(u,p,y){return Math.sqrt(ih(u,p,y,!0))}function PU(u,p,y){return ih(u,p,y)}function OU(u,p){var y=u.length,b=typeof Uint8Array<"u"?Uint8Array:Array,k=new b(y);k[0]=k[y-1]=1,Jx(u,k,p,0,y-1);var N,M=[];for(N=0;N<y;N++)k[N]&&M.push(u[N]);return M}function Jx(u,p,y,b,k){var N=0,M,K,ne;for(K=b+1;K<=k-1;K++)ne=ih(u[K],u[b],u[k],!0),ne>N&&(M=K,N=ne);N>y&&(p[M]=1,Jx(u,p,y,b,M),Jx(u,p,y,M,k))}function LU(u,p){for(var y=[u[0]],b=1,k=0,N=u.length;b<N;b++)FU(u[b],u[k])>p&&(y.push(u[b]),k=b);return k<N-1&&y.push(u[N-1]),y}var jS;function HS(u,p,y,b,k){var N=b?jS:Pa(u,y),M=Pa(p,y),K,ne,fe;for(jS=M;;){if(!(N|M))return[u,p];if(N&M)return!1;K=N||M,ne=Lp(u,p,K,y,k),fe=Pa(ne,y),K===N?(u=ne,N=fe):(p=ne,M=fe)}}function Lp(u,p,y,b,k){var N=p.x-u.x,M=p.y-u.y,K=b.min,ne=b.max,fe,be;return y&8?(fe=u.x+N*(ne.y-u.y)/M,be=ne.y):y&4?(fe=u.x+N*(K.y-u.y)/M,be=K.y):y&2?(fe=ne.x,be=u.y+M*(ne.x-u.x)/N):y&1&&(fe=K.x,be=u.y+M*(K.x-u.x)/N),new O(fe,be,k)}function Pa(u,p){var y=0;return u.x<p.min.x?y|=1:u.x>p.max.x&&(y|=2),u.y<p.min.y?y|=4:u.y>p.max.y&&(y|=8),y}function FU(u,p){var y=p.x-u.x,b=p.y-u.y;return y*y+b*b}function ih(u,p,y,b){var k=p.x,N=p.y,M=y.x-k,K=y.y-N,ne=M*M+K*K,fe;return ne>0&&(fe=((u.x-k)*M+(u.y-N)*K)/ne,fe>1?(k=y.x,N=y.y):fe>0&&(k+=M*fe,N+=K*fe)),M=u.x-k,K=u.y-N,b?M*M+K*K:new O(k,N)}function ti(u){return!C(u[0])||typeof u[0][0]!="object"&&typeof u[0][0]<"u"}function qS(u){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ti(u)}function KS(u,p){var y,b,k,N,M,K,ne,fe;if(!u||u.length===0)throw new Error("latlngs not passed");ti(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var be=ce([0,0]),Pe=he(u),qe=Pe.getNorthWest().distanceTo(Pe.getSouthWest())*Pe.getNorthEast().distanceTo(Pe.getNorthWest());qe<1700&&(be=Qx(u));var os=u.length,kn=[];for(y=0;y<os;y++){var ni=ce(u[y]);kn.push(p.project(ce([ni.lat-be.lat,ni.lng-be.lng])))}for(y=0,b=0;y<os-1;y++)b+=kn[y].distanceTo(kn[y+1])/2;if(b===0)fe=kn[0];else for(y=0,N=0;y<os-1;y++)if(M=kn[y],K=kn[y+1],k=M.distanceTo(K),N+=k,N>b){ne=(N-b)/k,fe=[K.x-ne*(K.x-M.x),K.y-ne*(K.y-M.y)];break}var xs=p.unproject(V(fe));return ce([xs.lat+be.lat,xs.lng+be.lng])}var MU={__proto__:null,simplify:VS,pointToSegmentDistance:GS,closestPointOnSegment:PU,clipSegment:HS,_getEdgeIntersection:Lp,_getBitCode:Pa,_sqClosestPointOnSegment:ih,isFlat:ti,_flat:qS,polylineCenter:KS},e_={project:function(u){return new O(u.lng,u.lat)},unproject:function(u){return new le(u.y,u.x)},bounds:new te([-180,-90],[180,90])},t_={R:6378137,R_MINOR:6356752314245179e-9,bounds:new te([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(u){var p=Math.PI/180,y=this.R,b=u.lat*p,k=this.R_MINOR/y,N=Math.sqrt(1-k*k),M=N*Math.sin(b),K=Math.tan(Math.PI/4-b/2)/Math.pow((1-M)/(1+M),N/2);return b=-y*Math.log(Math.max(K,1e-10)),new O(u.lng*p*y,b)},unproject:function(u){for(var p=180/Math.PI,y=this.R,b=this.R_MINOR/y,k=Math.sqrt(1-b*b),N=Math.exp(-u.y/y),M=Math.PI/2-2*Math.atan(N),K=0,ne=.1,fe;K<15&&Math.abs(ne)>1e-7;K++)fe=k*Math.sin(M),fe=Math.pow((1-fe)/(1+fe),k/2),ne=Math.PI/2-2*Math.atan(N*fe)-M,M+=ne;return new le(M*p,u.x*p/y)}},zU={__proto__:null,LonLat:e_,Mercator:t_,SphericalMercator:Fe},BU=i({},Se,{code:"EPSG:3395",projection:t_,transformation:function(){var u=.5/(Math.PI*t_.R);return Qe(u,.5,-u,.5)}()}),XS=i({},Se,{code:"EPSG:4326",projection:e_,transformation:Qe(1/180,1,-1/180,.5)}),UU=i({},we,{projection:e_,transformation:Qe(1,0,-1,0),scale:function(u){return Math.pow(2,u)},zoom:function(u){return Math.log(u)/Math.LN2},distance:function(u,p){var y=p.lng-u.lng,b=p.lat-u.lat;return Math.sqrt(y*y+b*b)},infinite:!0});we.Earth=Se,we.EPSG3395=BU,we.EPSG3857=ut,we.EPSG900913=Rt,we.EPSG4326=XS,we.Simple=UU;var Ni=oe.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(u){return u.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(u){return u&&u.removeLayer(this),this},getPane:function(u){return this._map.getPane(u?this.options[u]||u:this.options.pane)},addInteractiveTarget:function(u){return this._map._targets[l(u)]=this,this},removeInteractiveTarget:function(u){return delete this._map._targets[l(u)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(u){var p=u.target;if(p.hasLayer(this)){if(this._map=p,this._zoomAnimated=p._zoomAnimated,this.getEvents){var y=this.getEvents();p.on(y,this),this.once("remove",function(){p.off(y,this)},this)}this.onAdd(p),this.fire("add"),p.fire("layeradd",{layer:this})}}});nt.include({addLayer:function(u){if(!u._layerAdd)throw new Error("The provided object is not a Layer.");var p=l(u);return this._layers[p]?this:(this._layers[p]=u,u._mapToAdd=this,u.beforeAdd&&u.beforeAdd(this),this.whenReady(u._layerAdd,u),this)},removeLayer:function(u){var p=l(u);return this._layers[p]?(this._loaded&&u.onRemove(this),delete this._layers[p],this._loaded&&(this.fire("layerremove",{layer:u}),u.fire("remove")),u._map=u._mapToAdd=null,this):this},hasLayer:function(u){return l(u)in this._layers},eachLayer:function(u,p){for(var y in this._layers)u.call(p,this._layers[y]);return this},_addLayers:function(u){u=u?C(u)?u:[u]:[];for(var p=0,y=u.length;p<y;p++)this.addLayer(u[p])},_addZoomLimit:function(u){(!isNaN(u.options.maxZoom)||!isNaN(u.options.minZoom))&&(this._zoomBoundLayers[l(u)]=u,this._updateZoomLevels())},_removeZoomLimit:function(u){var p=l(u);this._zoomBoundLayers[p]&&(delete this._zoomBoundLayers[p],this._updateZoomLevels())},_updateZoomLevels:function(){var u=1/0,p=-1/0,y=this._getZoomSpan();for(var b in this._zoomBoundLayers){var k=this._zoomBoundLayers[b].options;u=k.minZoom===void 0?u:Math.min(u,k.minZoom),p=k.maxZoom===void 0?p:Math.max(p,k.maxZoom)}this._layersMaxZoom=p===-1/0?void 0:p,this._layersMinZoom=u===1/0?void 0:u,y!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var lc=Ni.extend({initialize:function(u,p){v(this,p),this._layers={};var y,b;if(u)for(y=0,b=u.length;y<b;y++)this.addLayer(u[y])},addLayer:function(u){var p=this.getLayerId(u);return this._layers[p]=u,this._map&&this._map.addLayer(u),this},removeLayer:function(u){var p=u in this._layers?u:this.getLayerId(u);return this._map&&this._layers[p]&&this._map.removeLayer(this._layers[p]),delete this._layers[p],this},hasLayer:function(u){var p=typeof u=="number"?u:this.getLayerId(u);return p in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(u){var p=Array.prototype.slice.call(arguments,1),y,b;for(y in this._layers)b=this._layers[y],b[u]&&b[u].apply(b,p);return this},onAdd:function(u){this.eachLayer(u.addLayer,u)},onRemove:function(u){this.eachLayer(u.removeLayer,u)},eachLayer:function(u,p){for(var y in this._layers)u.call(p,this._layers[y]);return this},getLayer:function(u){return this._layers[u]},getLayers:function(){var u=[];return this.eachLayer(u.push,u),u},setZIndex:function(u){return this.invoke("setZIndex",u)},getLayerId:function(u){return l(u)}}),WU=function(u,p){return new lc(u,p)},Lr=lc.extend({addLayer:function(u){return this.hasLayer(u)?this:(u.addEventParent(this),lc.prototype.addLayer.call(this,u),this.fire("layeradd",{layer:u}))},removeLayer:function(u){return this.hasLayer(u)?(u in this._layers&&(u=this._layers[u]),u.removeEventParent(this),lc.prototype.removeLayer.call(this,u),this.fire("layerremove",{layer:u})):this},setStyle:function(u){return this.invoke("setStyle",u)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var u=new ue;for(var p in this._layers){var y=this._layers[p];u.extend(y.getBounds?y.getBounds():y.getLatLng())}return u}}),VU=function(u,p){return new Lr(u,p)},cc=Z.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(u){v(this,u)},createIcon:function(u){return this._createIcon("icon",u)},createShadow:function(u){return this._createIcon("shadow",u)},_createIcon:function(u,p){var y=this._getIconUrl(u);if(!y){if(u==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var b=this._createImg(y,p&&p.tagName==="IMG"?p:null);return this._setIconStyles(b,u),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),b},_setIconStyles:function(u,p){var y=this.options,b=y[p+"Size"];typeof b=="number"&&(b=[b,b]);var k=V(b),N=V(p==="shadow"&&y.shadowAnchor||y.iconAnchor||k&&k.divideBy(2,!0));u.className="leaflet-marker-"+p+" "+(y.className||""),N&&(u.style.marginLeft=-N.x+"px",u.style.marginTop=-N.y+"px"),k&&(u.style.width=k.x+"px",u.style.height=k.y+"px")},_createImg:function(u,p){return p=p||document.createElement("img"),p.src=u,p},_getIconUrl:function(u){return Ne.retina&&this.options[u+"RetinaUrl"]||this.options[u+"Url"]}});function GU(u){return new cc(u)}var rh=cc.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(u){return typeof rh.imagePath!="string"&&(rh.imagePath=this._detectIconPath()),(this.options.imagePath||rh.imagePath)+cc.prototype._getIconUrl.call(this,u)},_stripUrl:function(u){var p=function(y,b,k){var N=b.exec(y);return N&&N[k]};return u=p(u,/^url\((['"])?(.+)\1\)$/,2),u&&p(u,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var u=at("div","leaflet-default-icon-path",document.body),p=Qu(u,"background-image")||Qu(u,"backgroundImage");if(document.body.removeChild(u),p=this._stripUrl(p),p)return p;var y=document.querySelector('link[href$="leaflet.css"]');return y?y.href.substring(0,y.href.length-11-1):""}}),ZS=rr.extend({initialize:function(u){this._marker=u},addHooks:function(){var u=this._marker._icon;this._draggable||(this._draggable=new vo(u,u,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ve(u,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&en(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(u){var p=this._marker,y=p._map,b=this._marker.options.autoPanSpeed,k=this._marker.options.autoPanPadding,N=Ra(p._icon),M=y.getPixelBounds(),K=y.getPixelOrigin(),ne=ae(M.min._subtract(K).add(k),M.max._subtract(K).subtract(k));if(!ne.contains(N)){var fe=V((Math.max(ne.max.x,N.x)-ne.max.x)/(M.max.x-ne.max.x)-(Math.min(ne.min.x,N.x)-ne.min.x)/(M.min.x-ne.min.x),(Math.max(ne.max.y,N.y)-ne.max.y)/(M.max.y-ne.max.y)-(Math.min(ne.min.y,N.y)-ne.min.y)/(M.min.y-ne.min.y)).multiplyBy(b);y.panBy(fe,{animate:!1}),this._draggable._newPos._add(fe),this._draggable._startPos._add(fe),rn(p._icon,this._draggable._newPos),this._onDrag(u),this._panRequest=z(this._adjustPan.bind(this,u))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(u){this._marker.options.autoPan&&(H(this._panRequest),this._panRequest=z(this._adjustPan.bind(this,u)))},_onDrag:function(u){var p=this._marker,y=p._shadow,b=Ra(p._icon),k=p._map.layerPointToLatLng(b);y&&rn(y,b),p._latlng=k,u.latlng=k,u.oldLatLng=this._oldLatLng,p.fire("move",u).fire("drag",u)},_onDragEnd:function(u){H(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",u)}}),Fp=Ni.extend({options:{icon:new rh,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(u,p){v(this,p),this._latlng=ce(u)},onAdd:function(u){this._zoomAnimated=this._zoomAnimated&&u.options.markerZoomAnimation,this._zoomAnimated&&u.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(u){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&u.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(u){var p=this._latlng;return this._latlng=ce(u),this.update(),this.fire("move",{oldLatLng:p,latlng:this._latlng})},setZIndexOffset:function(u){return this.options.zIndexOffset=u,this.update()},getIcon:function(){return this.options.icon},setIcon:function(u){return this.options.icon=u,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var u=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(u)}return this},_initIcon:function(){var u=this.options,p="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),y=u.icon.createIcon(this._icon),b=!1;y!==this._icon&&(this._icon&&this._removeIcon(),b=!0,u.title&&(y.title=u.title),y.tagName==="IMG"&&(y.alt=u.alt||"")),Ve(y,p),u.keyboard&&(y.tabIndex="0",y.setAttribute("role","button")),this._icon=y,u.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Be(y,"focus",this._panOnFocus,this);var k=u.icon.createShadow(this._shadow),N=!1;k!==this._shadow&&(this._removeShadow(),N=!0),k&&(Ve(k,p),k.alt=""),this._shadow=k,u.opacity<1&&this._updateOpacity(),b&&this.getPane().appendChild(this._icon),this._initInteraction(),k&&N&&this.getPane(u.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&kt(this._icon,"focus",this._panOnFocus,this),Ut(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ut(this._shadow),this._shadow=null},_setPos:function(u){this._icon&&rn(this._icon,u),this._shadow&&rn(this._shadow,u),this._zIndex=u.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(u){this._icon&&(this._icon.style.zIndex=this._zIndex+u)},_animateZoom:function(u){var p=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center).round();this._setPos(p)},_initInteraction:function(){if(this.options.interactive&&(Ve(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ZS)){var u=this.options.draggable;this.dragging&&(u=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ZS(this),u&&this.dragging.enable()}},setOpacity:function(u){return this.options.opacity=u,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var u=this.options.opacity;this._icon&&ei(this._icon,u),this._shadow&&ei(this._shadow,u)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var u=this._map;if(u){var p=this.options.icon.options,y=p.iconSize?V(p.iconSize):V(0,0),b=p.iconAnchor?V(p.iconAnchor):V(0,0);u.panInside(this._latlng,{paddingTopLeft:b,paddingBottomRight:y.subtract(b)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function jU(u,p){return new Fp(u,p)}var xo=Ni.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(u){this._renderer=u.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(u){return v(this,u),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&u&&Object.prototype.hasOwnProperty.call(u,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Mp=xo.extend({options:{fill:!0,radius:10},initialize:function(u,p){v(this,p),this._latlng=ce(u),this._radius=this.options.radius},setLatLng:function(u){var p=this._latlng;return this._latlng=ce(u),this.redraw(),this.fire("move",{oldLatLng:p,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(u){return this.options.radius=this._radius=u,this.redraw()},getRadius:function(){return this._radius},setStyle:function(u){var p=u&&u.radius||this._radius;return xo.prototype.setStyle.call(this,u),this.setRadius(p),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var u=this._radius,p=this._radiusY||u,y=this._clickTolerance(),b=[u+y,p+y];this._pxBounds=new te(this._point.subtract(b),this._point.add(b))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(u){return u.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function HU(u,p){return new Mp(u,p)}var n_=Mp.extend({initialize:function(u,p,y){if(typeof p=="number"&&(p=i({},y,{radius:p})),v(this,p),this._latlng=ce(u),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(u){return this._mRadius=u,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var u=[this._radius,this._radiusY||this._radius];return new ue(this._map.layerPointToLatLng(this._point.subtract(u)),this._map.layerPointToLatLng(this._point.add(u)))},setStyle:xo.prototype.setStyle,_project:function(){var u=this._latlng.lng,p=this._latlng.lat,y=this._map,b=y.options.crs;if(b.distance===Se.distance){var k=Math.PI/180,N=this._mRadius/Se.R/k,M=y.project([p+N,u]),K=y.project([p-N,u]),ne=M.add(K).divideBy(2),fe=y.unproject(ne).lat,be=Math.acos((Math.cos(N*k)-Math.sin(p*k)*Math.sin(fe*k))/(Math.cos(p*k)*Math.cos(fe*k)))/k;(isNaN(be)||be===0)&&(be=N/Math.cos(Math.PI/180*p)),this._point=ne.subtract(y.getPixelOrigin()),this._radius=isNaN(be)?0:ne.x-y.project([fe,u-be]).x,this._radiusY=ne.y-M.y}else{var Pe=b.unproject(b.project(this._latlng).subtract([this._mRadius,0]));this._point=y.latLngToLayerPoint(this._latlng),this._radius=this._point.x-y.latLngToLayerPoint(Pe).x}this._updateBounds()}});function qU(u,p,y){return new n_(u,p,y)}var Fr=xo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(u,p){v(this,p),this._setLatLngs(u)},getLatLngs:function(){return this._latlngs},setLatLngs:function(u){return this._setLatLngs(u),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(u){for(var p=1/0,y=null,b=ih,k,N,M=0,K=this._parts.length;M<K;M++)for(var ne=this._parts[M],fe=1,be=ne.length;fe<be;fe++){k=ne[fe-1],N=ne[fe];var Pe=b(u,k,N,!0);Pe<p&&(p=Pe,y=b(u,k,N))}return y&&(y.distance=Math.sqrt(p)),y},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return KS(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(u,p){return p=p||this._defaultShape(),u=ce(u),p.push(u),this._bounds.extend(u),this.redraw()},_setLatLngs:function(u){this._bounds=new ue,this._latlngs=this._convertLatLngs(u)},_defaultShape:function(){return ti(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(u){for(var p=[],y=ti(u),b=0,k=u.length;b<k;b++)y?(p[b]=ce(u[b]),this._bounds.extend(p[b])):p[b]=this._convertLatLngs(u[b]);return p},_project:function(){var u=new te;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,u),this._bounds.isValid()&&u.isValid()&&(this._rawPxBounds=u,this._updateBounds())},_updateBounds:function(){var u=this._clickTolerance(),p=new O(u,u);this._rawPxBounds&&(this._pxBounds=new te([this._rawPxBounds.min.subtract(p),this._rawPxBounds.max.add(p)]))},_projectLatlngs:function(u,p,y){var b=u[0]instanceof le,k=u.length,N,M;if(b){for(M=[],N=0;N<k;N++)M[N]=this._map.latLngToLayerPoint(u[N]),y.extend(M[N]);p.push(M)}else for(N=0;N<k;N++)this._projectLatlngs(u[N],p,y)},_clipPoints:function(){var u=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}var p=this._parts,y,b,k,N,M,K,ne;for(y=0,k=0,N=this._rings.length;y<N;y++)for(ne=this._rings[y],b=0,M=ne.length;b<M-1;b++)K=HS(ne[b],ne[b+1],u,b,!0),K&&(p[k]=p[k]||[],p[k].push(K[0]),(K[1]!==ne[b+1]||b===M-2)&&(p[k].push(K[1]),k++))}},_simplifyPoints:function(){for(var u=this._parts,p=this.options.smoothFactor,y=0,b=u.length;y<b;y++)u[y]=VS(u[y],p)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(u,p){var y,b,k,N,M,K,ne=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(y=0,N=this._parts.length;y<N;y++)for(K=this._parts[y],b=0,M=K.length,k=M-1;b<M;k=b++)if(!(!p&&b===0)&&GS(u,K[k],K[b])<=ne)return!0;return!1}});function KU(u,p){return new Fr(u,p)}Fr._flat=qS;var uc=Fr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return WS(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(u){var p=Fr.prototype._convertLatLngs.call(this,u),y=p.length;return y>=2&&p[0]instanceof le&&p[0].equals(p[y-1])&&p.pop(),p},_setLatLngs:function(u){Fr.prototype._setLatLngs.call(this,u),ti(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ti(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var u=this._renderer._bounds,p=this.options.weight,y=new O(p,p);if(u=new te(u.min.subtract(y),u.max.add(y)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}for(var b=0,k=this._rings.length,N;b<k;b++)N=US(this._rings[b],u,!0),N.length&&this._parts.push(N)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(u){var p=!1,y,b,k,N,M,K,ne,fe;if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(N=0,ne=this._parts.length;N<ne;N++)for(y=this._parts[N],M=0,fe=y.length,K=fe-1;M<fe;K=M++)b=y[M],k=y[K],b.y>u.y!=k.y>u.y&&u.x<(k.x-b.x)*(u.y-b.y)/(k.y-b.y)+b.x&&(p=!p);return p||Fr.prototype._containsPoint.call(this,u,!0)}});function XU(u,p){return new uc(u,p)}var Mr=Lr.extend({initialize:function(u,p){v(this,p),this._layers={},u&&this.addData(u)},addData:function(u){var p=C(u)?u:u.features,y,b,k;if(p){for(y=0,b=p.length;y<b;y++)k=p[y],(k.geometries||k.geometry||k.features||k.coordinates)&&this.addData(k);return this}var N=this.options;if(N.filter&&!N.filter(u))return this;var M=zp(u,N);return M?(M.feature=Wp(u),M.defaultOptions=M.options,this.resetStyle(M),N.onEachFeature&&N.onEachFeature(u,M),this.addLayer(M)):this},resetStyle:function(u){return u===void 0?this.eachLayer(this.resetStyle,this):(u.options=i({},u.defaultOptions),this._setLayerStyle(u,this.options.style),this)},setStyle:function(u){return this.eachLayer(function(p){this._setLayerStyle(p,u)},this)},_setLayerStyle:function(u,p){u.setStyle&&(typeof p=="function"&&(p=p(u.feature)),u.setStyle(p))}});function zp(u,p){var y=u.type==="Feature"?u.geometry:u,b=y?y.coordinates:null,k=[],N=p&&p.pointToLayer,M=p&&p.coordsToLatLng||s_,K,ne,fe,be;if(!b&&!y)return null;switch(y.type){case"Point":return K=M(b),YS(N,u,K,p);case"MultiPoint":for(fe=0,be=b.length;fe<be;fe++)K=M(b[fe]),k.push(YS(N,u,K,p));return new Lr(k);case"LineString":case"MultiLineString":return ne=Bp(b,y.type==="LineString"?0:1,M),new Fr(ne,p);case"Polygon":case"MultiPolygon":return ne=Bp(b,y.type==="Polygon"?1:2,M),new uc(ne,p);case"GeometryCollection":for(fe=0,be=y.geometries.length;fe<be;fe++){var Pe=zp({geometry:y.geometries[fe],type:"Feature",properties:u.properties},p);Pe&&k.push(Pe)}return new Lr(k);case"FeatureCollection":for(fe=0,be=y.features.length;fe<be;fe++){var qe=zp(y.features[fe],p);qe&&k.push(qe)}return new Lr(k);default:throw new Error("Invalid GeoJSON object.")}}function YS(u,p,y,b){return u?u(p,y):new Fp(y,b&&b.markersInheritOptions&&b)}function s_(u){return new le(u[1],u[0],u[2])}function Bp(u,p,y){for(var b=[],k=0,N=u.length,M;k<N;k++)M=p?Bp(u[k],p-1,y):(y||s_)(u[k]),b.push(M);return b}function i_(u,p){return u=ce(u),u.alt!==void 0?[f(u.lng,p),f(u.lat,p),f(u.alt,p)]:[f(u.lng,p),f(u.lat,p)]}function Up(u,p,y,b){for(var k=[],N=0,M=u.length;N<M;N++)k.push(p?Up(u[N],ti(u[N])?0:p-1,y,b):i_(u[N],b));return!p&&y&&k.length>0&&k.push(k[0].slice()),k}function hc(u,p){return u.feature?i({},u.feature,{geometry:p}):Wp(p)}function Wp(u){return u.type==="Feature"||u.type==="FeatureCollection"?u:{type:"Feature",properties:{},geometry:u}}var r_={toGeoJSON:function(u){return hc(this,{type:"Point",coordinates:i_(this.getLatLng(),u)})}};Fp.include(r_),n_.include(r_),Mp.include(r_),Fr.include({toGeoJSON:function(u){var p=!ti(this._latlngs),y=Up(this._latlngs,p?1:0,!1,u);return hc(this,{type:(p?"Multi":"")+"LineString",coordinates:y})}}),uc.include({toGeoJSON:function(u){var p=!ti(this._latlngs),y=p&&!ti(this._latlngs[0]),b=Up(this._latlngs,y?2:p?1:0,!0,u);return p||(b=[b]),hc(this,{type:(y?"Multi":"")+"Polygon",coordinates:b})}}),lc.include({toMultiPoint:function(u){var p=[];return this.eachLayer(function(y){p.push(y.toGeoJSON(u).geometry.coordinates)}),hc(this,{type:"MultiPoint",coordinates:p})},toGeoJSON:function(u){var p=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(p==="MultiPoint")return this.toMultiPoint(u);var y=p==="GeometryCollection",b=[];return this.eachLayer(function(k){if(k.toGeoJSON){var N=k.toGeoJSON(u);if(y)b.push(N.geometry);else{var M=Wp(N);M.type==="FeatureCollection"?b.push.apply(b,M.features):b.push(M)}}}),y?hc(this,{geometries:b,type:"GeometryCollection"}):{type:"FeatureCollection",features:b}}});function QS(u,p){return new Mr(u,p)}var ZU=QS,Vp=Ni.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(u,p,y){this._url=u,this._bounds=he(p),v(this,y)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ve(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ut(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(u){return this.options.opacity=u,this._image&&this._updateOpacity(),this},setStyle:function(u){return u.opacity&&this.setOpacity(u.opacity),this},bringToFront:function(){return this._map&&oc(this._image),this},bringToBack:function(){return this._map&&ac(this._image),this},setUrl:function(u){return this._url=u,this._image&&(this._image.src=u),this},setBounds:function(u){return this._bounds=he(u),this._map&&this._reset(),this},getEvents:function(){var u={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var u=this._url.tagName==="IMG",p=this._image=u?this._url:at("img");if(Ve(p,"leaflet-image-layer"),this._zoomAnimated&&Ve(p,"leaflet-zoom-animated"),this.options.className&&Ve(p,this.options.className),p.onselectstart=d,p.onmousemove=d,p.onload=o(this.fire,this,"load"),p.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(p.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),u){this._url=p.src;return}p.src=this._url,p.alt=this.options.alt},_animateZoom:function(u){var p=this._map.getZoomScale(u.zoom),y=this._map._latLngBoundsToNewLayerBounds(this._bounds,u.zoom,u.center).min;$a(this._image,y,p)},_reset:function(){var u=this._image,p=new te(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),y=p.getSize();rn(u,p.min),u.style.width=y.x+"px",u.style.height=y.y+"px"},_updateOpacity:function(){ei(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var u=this.options.errorOverlayUrl;u&&this._url!==u&&(this._url=u,this._image.src=u)},getCenter:function(){return this._bounds.getCenter()}}),YU=function(u,p,y){return new Vp(u,p,y)},JS=Vp.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var u=this._url.tagName==="VIDEO",p=this._image=u?this._url:at("video");if(Ve(p,"leaflet-image-layer"),this._zoomAnimated&&Ve(p,"leaflet-zoom-animated"),this.options.className&&Ve(p,this.options.className),p.onselectstart=d,p.onmousemove=d,p.onloadeddata=o(this.fire,this,"load"),u){for(var y=p.getElementsByTagName("source"),b=[],k=0;k<y.length;k++)b.push(y[k].src);this._url=y.length>0?b:[p.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(p.style,"objectFit")&&(p.style.objectFit="fill"),p.autoplay=!!this.options.autoplay,p.loop=!!this.options.loop,p.muted=!!this.options.muted,p.playsInline=!!this.options.playsInline;for(var N=0;N<this._url.length;N++){var M=at("source");M.src=this._url[N],p.appendChild(M)}}});function QU(u,p,y){return new JS(u,p,y)}var eT=Vp.extend({_initImage:function(){var u=this._image=this._url;Ve(u,"leaflet-image-layer"),this._zoomAnimated&&Ve(u,"leaflet-zoom-animated"),this.options.className&&Ve(u,this.options.className),u.onselectstart=d,u.onmousemove=d}});function JU(u,p,y){return new eT(u,p,y)}var or=Ni.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(u,p){u&&(u instanceof le||C(u))?(this._latlng=ce(u),v(this,p)):(v(this,u),this._source=p),this.options.content&&(this._content=this.options.content)},openOn:function(u){return u=arguments.length?u:this._source._map,u.hasLayer(this)||u.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(u){return this._map?this.close():(arguments.length?this._source=u:u=this._source,this._prepareOpen(),this.openOn(u._map)),this},onAdd:function(u){this._zoomAnimated=u._zoomAnimated,this._container||this._initLayout(),u._fadeAnimated&&ei(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),u._fadeAnimated&&ei(this._container,1),this.bringToFront(),this.options.interactive&&(Ve(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(u){u._fadeAnimated?(ei(this._container,0),this._removeTimeout=setTimeout(o(Ut,void 0,this._container),200)):Ut(this._container),this.options.interactive&&(en(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(u){return this._latlng=ce(u),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(u){return this._content=u,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var u={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&oc(this._container),this},bringToBack:function(){return this._map&&ac(this._container),this},_prepareOpen:function(u){var p=this._source;if(!p._map)return!1;if(p instanceof Lr){p=null;var y=this._source._layers;for(var b in y)if(y[b]._map){p=y[b];break}if(!p)return!1;this._source=p}if(!u)if(p.getCenter)u=p.getCenter();else if(p.getLatLng)u=p.getLatLng();else if(p.getBounds)u=p.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(u),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var u=this._contentNode,p=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof p=="string")u.innerHTML=p;else{for(;u.hasChildNodes();)u.removeChild(u.firstChild);u.appendChild(p)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var u=this._map.latLngToLayerPoint(this._latlng),p=V(this.options.offset),y=this._getAnchor();this._zoomAnimated?rn(this._container,u.add(y)):p=p.add(u).add(y);var b=this._containerBottom=-p.y,k=this._containerLeft=-Math.round(this._containerWidth/2)+p.x;this._container.style.bottom=b+"px",this._container.style.left=k+"px"}},_getAnchor:function(){return[0,0]}});nt.include({_initOverlay:function(u,p,y,b){var k=p;return k instanceof u||(k=new u(b).setContent(p)),y&&k.setLatLng(y),k}}),Ni.include({_initOverlay:function(u,p,y,b){var k=y;return k instanceof u?(v(k,b),k._source=this):(k=p&&!b?p:new u(b,this),k.setContent(y)),k}});var Gp=or.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(u){return u=arguments.length?u:this._source._map,!u.hasLayer(this)&&u._popup&&u._popup.options.autoClose&&u.removeLayer(u._popup),u._popup=this,or.prototype.openOn.call(this,u)},onAdd:function(u){or.prototype.onAdd.call(this,u),u.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof xo||this._source.on("preclick",Aa))},onRemove:function(u){or.prototype.onRemove.call(this,u),u.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof xo||this._source.off("preclick",Aa))},getEvents:function(){var u=or.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(u.preclick=this.close),this.options.keepInView&&(u.moveend=this._adjustPan),u},_initLayout:function(){var u="leaflet-popup",p=this._container=at("div",u+" "+(this.options.className||"")+" leaflet-zoom-animated"),y=this._wrapper=at("div",u+"-content-wrapper",p);if(this._contentNode=at("div",u+"-content",y),nh(p),Kx(this._contentNode),Be(p,"contextmenu",Aa),this._tipContainer=at("div",u+"-tip-container",p),this._tip=at("div",u+"-tip",this._tipContainer),this.options.closeButton){var b=this._closeButton=at("a",u+"-close-button",p);b.setAttribute("role","button"),b.setAttribute("aria-label","Close popup"),b.href="#close",b.innerHTML='<span aria-hidden="true">&#215;</span>',Be(b,"click",function(k){Fn(k),this.close()},this)}},_updateLayout:function(){var u=this._contentNode,p=u.style;p.width="",p.whiteSpace="nowrap";var y=u.offsetWidth;y=Math.min(y,this.options.maxWidth),y=Math.max(y,this.options.minWidth),p.width=y+1+"px",p.whiteSpace="",p.height="";var b=u.offsetHeight,k=this.options.maxHeight,N="leaflet-popup-scrolled";k&&b>k?(p.height=k+"px",Ve(u,N)):en(u,N),this._containerWidth=this._container.offsetWidth},_animateZoom:function(u){var p=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center),y=this._getAnchor();rn(this._container,p.add(y))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var u=this._map,p=parseInt(Qu(this._container,"marginBottom"),10)||0,y=this._container.offsetHeight+p,b=this._containerWidth,k=new O(this._containerLeft,-y-this._containerBottom);k._add(Ra(this._container));var N=u.layerPointToContainerPoint(k),M=V(this.options.autoPanPadding),K=V(this.options.autoPanPaddingTopLeft||M),ne=V(this.options.autoPanPaddingBottomRight||M),fe=u.getSize(),be=0,Pe=0;N.x+b+ne.x>fe.x&&(be=N.x+b-fe.x+ne.x),N.x-be-K.x<0&&(be=N.x-K.x),N.y+y+ne.y>fe.y&&(Pe=N.y+y-fe.y+ne.y),N.y-Pe-K.y<0&&(Pe=N.y-K.y),(be||Pe)&&(this.options.keepInView&&(this._autopanning=!0),u.fire("autopanstart").panBy([be,Pe]))}},_getAnchor:function(){return V(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),eW=function(u,p){return new Gp(u,p)};nt.mergeOptions({closePopupOnClick:!0}),nt.include({openPopup:function(u,p,y){return this._initOverlay(Gp,u,p,y).openOn(this),this},closePopup:function(u){return u=arguments.length?u:this._popup,u&&u.close(),this}}),Ni.include({bindPopup:function(u,p){return this._popup=this._initOverlay(Gp,this._popup,u,p),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(u){return this._popup&&(this instanceof Lr||(this._popup._source=this),this._popup._prepareOpen(u||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(u){return this._popup&&this._popup.setContent(u),this},getPopup:function(){return this._popup},_openPopup:function(u){if(!(!this._popup||!this._map)){Da(u);var p=u.layer||u.target;if(this._popup._source===p&&!(p instanceof xo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(u.latlng);return}this._popup._source=p,this.openPopup(u.latlng)}},_movePopup:function(u){this._popup.setLatLng(u.latlng)},_onKeyPress:function(u){u.originalEvent.keyCode===13&&this._openPopup(u)}});var jp=or.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(u){or.prototype.onAdd.call(this,u),this.setOpacity(this.options.opacity),u.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(u){or.prototype.onRemove.call(this,u),u.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var u=or.prototype.getEvents.call(this);return this.options.permanent||(u.preclick=this.close),u},_initLayout:function(){var u="leaflet-tooltip",p=u+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=at("div",p),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(u){var p,y,b=this._map,k=this._container,N=b.latLngToContainerPoint(b.getCenter()),M=b.layerPointToContainerPoint(u),K=this.options.direction,ne=k.offsetWidth,fe=k.offsetHeight,be=V(this.options.offset),Pe=this._getAnchor();K==="top"?(p=ne/2,y=fe):K==="bottom"?(p=ne/2,y=0):K==="center"?(p=ne/2,y=fe/2):K==="right"?(p=0,y=fe/2):K==="left"?(p=ne,y=fe/2):M.x<N.x?(K="right",p=0,y=fe/2):(K="left",p=ne+(be.x+Pe.x)*2,y=fe/2),u=u.subtract(V(p,y,!0)).add(be).add(Pe),en(k,"leaflet-tooltip-right"),en(k,"leaflet-tooltip-left"),en(k,"leaflet-tooltip-top"),en(k,"leaflet-tooltip-bottom"),Ve(k,"leaflet-tooltip-"+K),rn(k,u)},_updatePosition:function(){var u=this._map.latLngToLayerPoint(this._latlng);this._setPosition(u)},setOpacity:function(u){this.options.opacity=u,this._container&&ei(this._container,u)},_animateZoom:function(u){var p=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center);this._setPosition(p)},_getAnchor:function(){return V(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),tW=function(u,p){return new jp(u,p)};nt.include({openTooltip:function(u,p,y){return this._initOverlay(jp,u,p,y).openOn(this),this},closeTooltip:function(u){return u.close(),this}}),Ni.include({bindTooltip:function(u,p){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(jp,this._tooltip,u,p),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(u){if(!(!u&&this._tooltipHandlersAdded)){var p=u?"off":"on",y={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?y.add=this._openTooltip:(y.mouseover=this._openTooltip,y.mouseout=this.closeTooltip,y.click=this._openTooltip,this._map?this._addFocusListeners():y.add=this._addFocusListeners),this._tooltip.options.sticky&&(y.mousemove=this._moveTooltip),this[p](y),this._tooltipHandlersAdded=!u}},openTooltip:function(u){return this._tooltip&&(this instanceof Lr||(this._tooltip._source=this),this._tooltip._prepareOpen(u)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(u){return this._tooltip&&this._tooltip.setContent(u),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(u){var p=typeof u.getElement=="function"&&u.getElement();p&&(Be(p,"focus",function(){this._tooltip._source=u,this.openTooltip()},this),Be(p,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(u){var p=typeof u.getElement=="function"&&u.getElement();p&&p.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(u){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var p=this;this._map.once("moveend",function(){p._openOnceFlag=!1,p._openTooltip(u)});return}this._tooltip._source=u.layer||u.target,this.openTooltip(this._tooltip.options.sticky?u.latlng:void 0)}},_moveTooltip:function(u){var p=u.latlng,y,b;this._tooltip.options.sticky&&u.originalEvent&&(y=this._map.mouseEventToContainerPoint(u.originalEvent),b=this._map.containerPointToLayerPoint(y),p=this._map.layerPointToLatLng(b)),this._tooltip.setLatLng(p)}});var tT=cc.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(u){var p=u&&u.tagName==="DIV"?u:document.createElement("div"),y=this.options;if(y.html instanceof Element?(Rp(p),p.appendChild(y.html)):p.innerHTML=y.html!==!1?y.html:"",y.bgPos){var b=V(y.bgPos);p.style.backgroundPosition=-b.x+"px "+-b.y+"px"}return this._setIconStyles(p,"icon"),p},createShadow:function(){return null}});function nW(u){return new tT(u)}cc.Default=rh;var oh=Ni.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ne.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(u){v(this,u)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(u){u._addZoomLimit(this)},onRemove:function(u){this._removeAllTiles(),Ut(this._container),u._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(oc(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ac(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(u){return this.options.opacity=u,this._updateOpacity(),this},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var u=this._clampZoom(this._map.getZoom());u!==this._tileZoom&&(this._tileZoom=u,this._updateLevels()),this._update()}return this},getEvents:function(){var u={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),u.move=this._onMove),this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},createTile:function(){return document.createElement("div")},getTileSize:function(){var u=this.options.tileSize;return u instanceof O?u:new O(u,u)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(u){for(var p=this.getPane().children,y=-u(-1/0,1/0),b=0,k=p.length,N;b<k;b++)N=p[b].style.zIndex,p[b]!==this._container&&N&&(y=u(y,+N));isFinite(y)&&(this.options.zIndex=y+u(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ne.ielt9){ei(this._container,this.options.opacity);var u=+new Date,p=!1,y=!1;for(var b in this._tiles){var k=this._tiles[b];if(!(!k.current||!k.loaded)){var N=Math.min(1,(u-k.loaded)/200);ei(k.el,N),N<1?p=!0:(k.active?y=!0:this._onOpaqueTile(k),k.active=!0)}}y&&!this._noPrune&&this._pruneTiles(),p&&(H(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=at("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var u=this._tileZoom,p=this.options.maxZoom;if(u!==void 0){for(var y in this._levels)y=Number(y),this._levels[y].el.children.length||y===u?(this._levels[y].el.style.zIndex=p-Math.abs(u-y),this._onUpdateLevel(y)):(Ut(this._levels[y].el),this._removeTilesAtZoom(y),this._onRemoveLevel(y),delete this._levels[y]);var b=this._levels[u],k=this._map;return b||(b=this._levels[u]={},b.el=at("div","leaflet-tile-container leaflet-zoom-animated",this._container),b.el.style.zIndex=p,b.origin=k.project(k.unproject(k.getPixelOrigin()),u).round(),b.zoom=u,this._setZoomTransform(b,k.getCenter(),k.getZoom()),d(b.el.offsetWidth),this._onCreateLevel(b)),this._level=b,b}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var u,p,y=this._map.getZoom();if(y>this.options.maxZoom||y<this.options.minZoom){this._removeAllTiles();return}for(u in this._tiles)p=this._tiles[u],p.retain=p.current;for(u in this._tiles)if(p=this._tiles[u],p.current&&!p.active){var b=p.coords;this._retainParent(b.x,b.y,b.z,b.z-5)||this._retainChildren(b.x,b.y,b.z,b.z+2)}for(u in this._tiles)this._tiles[u].retain||this._removeTile(u)}},_removeTilesAtZoom:function(u){for(var p in this._tiles)this._tiles[p].coords.z===u&&this._removeTile(p)},_removeAllTiles:function(){for(var u in this._tiles)this._removeTile(u)},_invalidateAll:function(){for(var u in this._levels)Ut(this._levels[u].el),this._onRemoveLevel(Number(u)),delete this._levels[u];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(u,p,y,b){var k=Math.floor(u/2),N=Math.floor(p/2),M=y-1,K=new O(+k,+N);K.z=+M;var ne=this._tileCoordsToKey(K),fe=this._tiles[ne];return fe&&fe.active?(fe.retain=!0,!0):(fe&&fe.loaded&&(fe.retain=!0),M>b?this._retainParent(k,N,M,b):!1)},_retainChildren:function(u,p,y,b){for(var k=2*u;k<2*u+2;k++)for(var N=2*p;N<2*p+2;N++){var M=new O(k,N);M.z=y+1;var K=this._tileCoordsToKey(M),ne=this._tiles[K];if(ne&&ne.active){ne.retain=!0;continue}else ne&&ne.loaded&&(ne.retain=!0);y+1<b&&this._retainChildren(k,N,y+1,b)}},_resetView:function(u){var p=u&&(u.pinch||u.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),p,p)},_animateZoom:function(u){this._setView(u.center,u.zoom,!0,u.noUpdate)},_clampZoom:function(u){var p=this.options;return p.minNativeZoom!==void 0&&u<p.minNativeZoom?p.minNativeZoom:p.maxNativeZoom!==void 0&&p.maxNativeZoom<u?p.maxNativeZoom:u},_setView:function(u,p,y,b){var k=Math.round(p);this.options.maxZoom!==void 0&&k>this.options.maxZoom||this.options.minZoom!==void 0&&k<this.options.minZoom?k=void 0:k=this._clampZoom(k);var N=this.options.updateWhenZooming&&k!==this._tileZoom;(!b||N)&&(this._tileZoom=k,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),k!==void 0&&this._update(u),y||this._pruneTiles(),this._noPrune=!!y),this._setZoomTransforms(u,p)},_setZoomTransforms:function(u,p){for(var y in this._levels)this._setZoomTransform(this._levels[y],u,p)},_setZoomTransform:function(u,p,y){var b=this._map.getZoomScale(y,u.zoom),k=u.origin.multiplyBy(b).subtract(this._map._getNewPixelOrigin(p,y)).round();Ne.any3d?$a(u.el,k,b):rn(u.el,k)},_resetGrid:function(){var u=this._map,p=u.options.crs,y=this._tileSize=this.getTileSize(),b=this._tileZoom,k=this._map.getPixelWorldBounds(this._tileZoom);k&&(this._globalTileRange=this._pxBoundsToTileRange(k)),this._wrapX=p.wrapLng&&!this.options.noWrap&&[Math.floor(u.project([0,p.wrapLng[0]],b).x/y.x),Math.ceil(u.project([0,p.wrapLng[1]],b).x/y.y)],this._wrapY=p.wrapLat&&!this.options.noWrap&&[Math.floor(u.project([p.wrapLat[0],0],b).y/y.x),Math.ceil(u.project([p.wrapLat[1],0],b).y/y.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(u){var p=this._map,y=p._animatingZoom?Math.max(p._animateToZoom,p.getZoom()):p.getZoom(),b=p.getZoomScale(y,this._tileZoom),k=p.project(u,this._tileZoom).floor(),N=p.getSize().divideBy(b*2);return new te(k.subtract(N),k.add(N))},_update:function(u){var p=this._map;if(p){var y=this._clampZoom(p.getZoom());if(u===void 0&&(u=p.getCenter()),this._tileZoom!==void 0){var b=this._getTiledPixelBounds(u),k=this._pxBoundsToTileRange(b),N=k.getCenter(),M=[],K=this.options.keepBuffer,ne=new te(k.getBottomLeft().subtract([K,-K]),k.getTopRight().add([K,-K]));if(!(isFinite(k.min.x)&&isFinite(k.min.y)&&isFinite(k.max.x)&&isFinite(k.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var fe in this._tiles){var be=this._tiles[fe].coords;(be.z!==this._tileZoom||!ne.contains(new O(be.x,be.y)))&&(this._tiles[fe].current=!1)}if(Math.abs(y-this._tileZoom)>1){this._setView(u,y);return}for(var Pe=k.min.y;Pe<=k.max.y;Pe++)for(var qe=k.min.x;qe<=k.max.x;qe++){var os=new O(qe,Pe);if(os.z=this._tileZoom,!!this._isValidTile(os)){var kn=this._tiles[this._tileCoordsToKey(os)];kn?kn.current=!0:M.push(os)}}if(M.sort(function(xs,fc){return xs.distanceTo(N)-fc.distanceTo(N)}),M.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ni=document.createDocumentFragment();for(qe=0;qe<M.length;qe++)this._addTile(M[qe],ni);this._level.el.appendChild(ni)}}}},_isValidTile:function(u){var p=this._map.options.crs;if(!p.infinite){var y=this._globalTileRange;if(!p.wrapLng&&(u.x<y.min.x||u.x>y.max.x)||!p.wrapLat&&(u.y<y.min.y||u.y>y.max.y))return!1}if(!this.options.bounds)return!0;var b=this._tileCoordsToBounds(u);return he(this.options.bounds).overlaps(b)},_keyToBounds:function(u){return this._tileCoordsToBounds(this._keyToTileCoords(u))},_tileCoordsToNwSe:function(u){var p=this._map,y=this.getTileSize(),b=u.scaleBy(y),k=b.add(y),N=p.unproject(b,u.z),M=p.unproject(k,u.z);return[N,M]},_tileCoordsToBounds:function(u){var p=this._tileCoordsToNwSe(u),y=new ue(p[0],p[1]);return this.options.noWrap||(y=this._map.wrapLatLngBounds(y)),y},_tileCoordsToKey:function(u){return u.x+":"+u.y+":"+u.z},_keyToTileCoords:function(u){var p=u.split(":"),y=new O(+p[0],+p[1]);return y.z=+p[2],y},_removeTile:function(u){var p=this._tiles[u];p&&(Ut(p.el),delete this._tiles[u],this.fire("tileunload",{tile:p.el,coords:this._keyToTileCoords(u)}))},_initTile:function(u){Ve(u,"leaflet-tile");var p=this.getTileSize();u.style.width=p.x+"px",u.style.height=p.y+"px",u.onselectstart=d,u.onmousemove=d,Ne.ielt9&&this.options.opacity<1&&ei(u,this.options.opacity)},_addTile:function(u,p){var y=this._getTilePos(u),b=this._tileCoordsToKey(u),k=this.createTile(this._wrapCoords(u),o(this._tileReady,this,u));this._initTile(k),this.createTile.length<2&&z(o(this._tileReady,this,u,null,k)),rn(k,y),this._tiles[b]={el:k,coords:u,current:!0},p.appendChild(k),this.fire("tileloadstart",{tile:k,coords:u})},_tileReady:function(u,p,y){p&&this.fire("tileerror",{error:p,tile:y,coords:u});var b=this._tileCoordsToKey(u);y=this._tiles[b],y&&(y.loaded=+new Date,this._map._fadeAnimated?(ei(y.el,0),H(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this)):(y.active=!0,this._pruneTiles()),p||(Ve(y.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:y.el,coords:u})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ne.ielt9||!this._map._fadeAnimated?z(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(u){return u.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(u){var p=new O(this._wrapX?h(u.x,this._wrapX):u.x,this._wrapY?h(u.y,this._wrapY):u.y);return p.z=u.z,p},_pxBoundsToTileRange:function(u){var p=this.getTileSize();return new te(u.min.unscaleBy(p).floor(),u.max.unscaleBy(p).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var u in this._tiles)if(!this._tiles[u].loaded)return!1;return!0}});function sW(u){return new oh(u)}var dc=oh.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(u,p){this._url=u,p=v(this,p),p.detectRetina&&Ne.retina&&p.maxZoom>0?(p.tileSize=Math.floor(p.tileSize/2),p.zoomReverse?(p.zoomOffset--,p.minZoom=Math.min(p.maxZoom,p.minZoom+1)):(p.zoomOffset++,p.maxZoom=Math.max(p.minZoom,p.maxZoom-1)),p.minZoom=Math.max(0,p.minZoom)):p.zoomReverse?p.minZoom=Math.min(p.maxZoom,p.minZoom):p.maxZoom=Math.max(p.minZoom,p.maxZoom),typeof p.subdomains=="string"&&(p.subdomains=p.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(u,p){return this._url===u&&p===void 0&&(p=!0),this._url=u,p||this.redraw(),this},createTile:function(u,p){var y=document.createElement("img");return Be(y,"load",o(this._tileOnLoad,this,p,y)),Be(y,"error",o(this._tileOnError,this,p,y)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(y.referrerPolicy=this.options.referrerPolicy),y.alt="",y.src=this.getTileUrl(u),y},getTileUrl:function(u){var p={r:Ne.retina?"@2x":"",s:this._getSubdomain(u),x:u.x,y:u.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var y=this._globalTileRange.max.y-u.y;this.options.tms&&(p.y=y),p["-y"]=y}return w(this._url,i(p,this.options))},_tileOnLoad:function(u,p){Ne.ielt9?setTimeout(o(u,this,null,p),0):u(null,p)},_tileOnError:function(u,p,y){var b=this.options.errorTileUrl;b&&p.getAttribute("src")!==b&&(p.src=b),u(y,p)},_onTileRemove:function(u){u.tile.onload=null},_getZoomForUrl:function(){var u=this._tileZoom,p=this.options.maxZoom,y=this.options.zoomReverse,b=this.options.zoomOffset;return y&&(u=p-u),u+b},_getSubdomain:function(u){var p=Math.abs(u.x+u.y)%this.options.subdomains.length;return this.options.subdomains[p]},_abortLoading:function(){var u,p;for(u in this._tiles)if(this._tiles[u].coords.z!==this._tileZoom&&(p=this._tiles[u].el,p.onload=d,p.onerror=d,!p.complete)){p.src=S;var y=this._tiles[u].coords;Ut(p),delete this._tiles[u],this.fire("tileabort",{tile:p,coords:y})}},_removeTile:function(u){var p=this._tiles[u];if(p)return p.el.setAttribute("src",S),oh.prototype._removeTile.call(this,u)},_tileReady:function(u,p,y){if(!(!this._map||y&&y.getAttribute("src")===S))return oh.prototype._tileReady.call(this,u,p,y)}});function nT(u,p){return new dc(u,p)}var sT=dc.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(u,p){this._url=u;var y=i({},this.defaultWmsParams);for(var b in p)b in this.options||(y[b]=p[b]);p=v(this,p);var k=p.detectRetina&&Ne.retina?2:1,N=this.getTileSize();y.width=N.x*k,y.height=N.y*k,this.wmsParams=y},onAdd:function(u){this._crs=this.options.crs||u.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var p=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[p]=this._crs.code,dc.prototype.onAdd.call(this,u)},getTileUrl:function(u){var p=this._tileCoordsToNwSe(u),y=this._crs,b=ae(y.project(p[0]),y.project(p[1])),k=b.min,N=b.max,M=(this._wmsVersion>=1.3&&this._crs===XS?[k.y,k.x,N.y,N.x]:[k.x,k.y,N.x,N.y]).join(","),K=dc.prototype.getTileUrl.call(this,u);return K+_(this.wmsParams,K,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+M},setParams:function(u,p){return i(this.wmsParams,u),p||this.redraw(),this}});function iW(u,p){return new sT(u,p)}dc.WMS=sT,nT.wms=iW;var zr=Ni.extend({options:{padding:.1},initialize:function(u){v(this,u),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ve(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var u={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(u.zoomanim=this._onAnimZoom),u},_onAnimZoom:function(u){this._updateTransform(u.center,u.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(u,p){var y=this._map.getZoomScale(p,this._zoom),b=this._map.getSize().multiplyBy(.5+this.options.padding),k=this._map.project(this._center,p),N=b.multiplyBy(-y).add(k).subtract(this._map._getNewPixelOrigin(u,p));Ne.any3d?$a(this._container,N,y):rn(this._container,N)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var u in this._layers)this._layers[u]._reset()},_onZoomEnd:function(){for(var u in this._layers)this._layers[u]._project()},_updatePaths:function(){for(var u in this._layers)this._layers[u]._update()},_update:function(){var u=this.options.padding,p=this._map.getSize(),y=this._map.containerPointToLayerPoint(p.multiplyBy(-u)).round();this._bounds=new te(y,y.add(p.multiplyBy(1+u*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),iT=zr.extend({options:{tolerance:0},getEvents:function(){var u=zr.prototype.getEvents.call(this);return u.viewprereset=this._onViewPreReset,u},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var u=this._container=document.createElement("canvas");Be(u,"mousemove",this._onMouseMove,this),Be(u,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Be(u,"mouseout",this._handleMouseOut,this),u._leaflet_disable_events=!0,this._ctx=u.getContext("2d")},_destroyContainer:function(){H(this._redrawRequest),delete this._ctx,Ut(this._container),kt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var u;this._redrawBounds=null;for(var p in this._layers)u=this._layers[p],u._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zr.prototype._update.call(this);var u=this._bounds,p=this._container,y=u.getSize(),b=Ne.retina?2:1;rn(p,u.min),p.width=b*y.x,p.height=b*y.y,p.style.width=y.x+"px",p.style.height=y.y+"px",Ne.retina&&this._ctx.scale(2,2),this._ctx.translate(-u.min.x,-u.min.y),this.fire("update")}},_reset:function(){zr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(u){this._updateDashArray(u),this._layers[l(u)]=u;var p=u._order={layer:u,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=p),this._drawLast=p,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(u){this._requestRedraw(u)},_removePath:function(u){var p=u._order,y=p.next,b=p.prev;y?y.prev=b:this._drawLast=b,b?b.next=y:this._drawFirst=y,delete u._order,delete this._layers[l(u)],this._requestRedraw(u)},_updatePath:function(u){this._extendRedrawBounds(u),u._project(),u._update(),this._requestRedraw(u)},_updateStyle:function(u){this._updateDashArray(u),this._requestRedraw(u)},_updateDashArray:function(u){if(typeof u.options.dashArray=="string"){var p=u.options.dashArray.split(/[, ]+/),y=[],b,k;for(k=0;k<p.length;k++){if(b=Number(p[k]),isNaN(b))return;y.push(b)}u.options._dashArray=y}else u.options._dashArray=u.options.dashArray},_requestRedraw:function(u){this._map&&(this._extendRedrawBounds(u),this._redrawRequest=this._redrawRequest||z(this._redraw,this))},_extendRedrawBounds:function(u){if(u._pxBounds){var p=(u.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new te,this._redrawBounds.extend(u._pxBounds.min.subtract([p,p])),this._redrawBounds.extend(u._pxBounds.max.add([p,p]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var u=this._redrawBounds;if(u){var p=u.getSize();this._ctx.clearRect(u.min.x,u.min.y,p.x,p.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var u,p=this._redrawBounds;if(this._ctx.save(),p){var y=p.getSize();this._ctx.beginPath(),this._ctx.rect(p.min.x,p.min.y,y.x,y.y),this._ctx.clip()}this._drawing=!0;for(var b=this._drawFirst;b;b=b.next)u=b.layer,(!p||u._pxBounds&&u._pxBounds.intersects(p))&&u._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(u,p){if(this._drawing){var y,b,k,N,M=u._parts,K=M.length,ne=this._ctx;if(K){for(ne.beginPath(),y=0;y<K;y++){for(b=0,k=M[y].length;b<k;b++)N=M[y][b],ne[b?"lineTo":"moveTo"](N.x,N.y);p&&ne.closePath()}this._fillStroke(ne,u)}}},_updateCircle:function(u){if(!(!this._drawing||u._empty())){var p=u._point,y=this._ctx,b=Math.max(Math.round(u._radius),1),k=(Math.max(Math.round(u._radiusY),1)||b)/b;k!==1&&(y.save(),y.scale(1,k)),y.beginPath(),y.arc(p.x,p.y/k,b,0,Math.PI*2,!1),k!==1&&y.restore(),this._fillStroke(y,u)}},_fillStroke:function(u,p){var y=p.options;y.fill&&(u.globalAlpha=y.fillOpacity,u.fillStyle=y.fillColor||y.color,u.fill(y.fillRule||"evenodd")),y.stroke&&y.weight!==0&&(u.setLineDash&&u.setLineDash(p.options&&p.options._dashArray||[]),u.globalAlpha=y.opacity,u.lineWidth=y.weight,u.strokeStyle=y.color,u.lineCap=y.lineCap,u.lineJoin=y.lineJoin,u.stroke())},_onClick:function(u){for(var p=this._map.mouseEventToLayerPoint(u),y,b,k=this._drawFirst;k;k=k.next)y=k.layer,y.options.interactive&&y._containsPoint(p)&&(!(u.type==="click"||u.type==="preclick")||!this._map._draggableMoved(y))&&(b=y);this._fireEvent(b?[b]:!1,u)},_onMouseMove:function(u){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var p=this._map.mouseEventToLayerPoint(u);this._handleMouseHover(u,p)}},_handleMouseOut:function(u){var p=this._hoveredLayer;p&&(en(this._container,"leaflet-interactive"),this._fireEvent([p],u,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(u,p){if(!this._mouseHoverThrottled){for(var y,b,k=this._drawFirst;k;k=k.next)y=k.layer,y.options.interactive&&y._containsPoint(p)&&(b=y);b!==this._hoveredLayer&&(this._handleMouseOut(u),b&&(Ve(this._container,"leaflet-interactive"),this._fireEvent([b],u,"mouseover"),this._hoveredLayer=b)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,u),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(u,p,y){this._map._fireDOMEvent(p,y||p.type,u)},_bringToFront:function(u){var p=u._order;if(p){var y=p.next,b=p.prev;if(y)y.prev=b;else return;b?b.next=y:y&&(this._drawFirst=y),p.prev=this._drawLast,this._drawLast.next=p,p.next=null,this._drawLast=p,this._requestRedraw(u)}},_bringToBack:function(u){var p=u._order;if(p){var y=p.next,b=p.prev;if(b)b.next=y;else return;y?y.prev=b:b&&(this._drawLast=b),p.prev=null,p.next=this._drawFirst,this._drawFirst.prev=p,this._drawFirst=p,this._requestRedraw(u)}}});function rT(u){return Ne.canvas?new iT(u):null}var ah=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(u){return document.createElement("<lvml:"+u+' class="lvml">')}}catch{}return function(u){return document.createElement("<"+u+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),rW={_initContainer:function(){this._container=at("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zr.prototype._update.call(this),this.fire("update"))},_initPath:function(u){var p=u._container=ah("shape");Ve(p,"leaflet-vml-shape "+(this.options.className||"")),p.coordsize="1 1",u._path=ah("path"),p.appendChild(u._path),this._updateStyle(u),this._layers[l(u)]=u},_addPath:function(u){var p=u._container;this._container.appendChild(p),u.options.interactive&&u.addInteractiveTarget(p)},_removePath:function(u){var p=u._container;Ut(p),u.removeInteractiveTarget(p),delete this._layers[l(u)]},_updateStyle:function(u){var p=u._stroke,y=u._fill,b=u.options,k=u._container;k.stroked=!!b.stroke,k.filled=!!b.fill,b.stroke?(p||(p=u._stroke=ah("stroke")),k.appendChild(p),p.weight=b.weight+"px",p.color=b.color,p.opacity=b.opacity,b.dashArray?p.dashStyle=C(b.dashArray)?b.dashArray.join(" "):b.dashArray.replace(/( *, *)/g," "):p.dashStyle="",p.endcap=b.lineCap.replace("butt","flat"),p.joinstyle=b.lineJoin):p&&(k.removeChild(p),u._stroke=null),b.fill?(y||(y=u._fill=ah("fill")),k.appendChild(y),y.color=b.fillColor||b.color,y.opacity=b.fillOpacity):y&&(k.removeChild(y),u._fill=null)},_updateCircle:function(u){var p=u._point.round(),y=Math.round(u._radius),b=Math.round(u._radiusY||y);this._setPath(u,u._empty()?"M0 0":"AL "+p.x+","+p.y+" "+y+","+b+" 0,"+65535*360)},_setPath:function(u,p){u._path.v=p},_bringToFront:function(u){oc(u._container)},_bringToBack:function(u){ac(u._container)}},Hp=Ne.vml?ah:dt,lh=zr.extend({_initContainer:function(){this._container=Hp("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Hp("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ut(this._container),kt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zr.prototype._update.call(this);var u=this._bounds,p=u.getSize(),y=this._container;(!this._svgSize||!this._svgSize.equals(p))&&(this._svgSize=p,y.setAttribute("width",p.x),y.setAttribute("height",p.y)),rn(y,u.min),y.setAttribute("viewBox",[u.min.x,u.min.y,p.x,p.y].join(" ")),this.fire("update")}},_initPath:function(u){var p=u._path=Hp("path");u.options.className&&Ve(p,u.options.className),u.options.interactive&&Ve(p,"leaflet-interactive"),this._updateStyle(u),this._layers[l(u)]=u},_addPath:function(u){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(u._path),u.addInteractiveTarget(u._path)},_removePath:function(u){Ut(u._path),u.removeInteractiveTarget(u._path),delete this._layers[l(u)]},_updatePath:function(u){u._project(),u._update()},_updateStyle:function(u){var p=u._path,y=u.options;p&&(y.stroke?(p.setAttribute("stroke",y.color),p.setAttribute("stroke-opacity",y.opacity),p.setAttribute("stroke-width",y.weight),p.setAttribute("stroke-linecap",y.lineCap),p.setAttribute("stroke-linejoin",y.lineJoin),y.dashArray?p.setAttribute("stroke-dasharray",y.dashArray):p.removeAttribute("stroke-dasharray"),y.dashOffset?p.setAttribute("stroke-dashoffset",y.dashOffset):p.removeAttribute("stroke-dashoffset")):p.setAttribute("stroke","none"),y.fill?(p.setAttribute("fill",y.fillColor||y.color),p.setAttribute("fill-opacity",y.fillOpacity),p.setAttribute("fill-rule",y.fillRule||"evenodd")):p.setAttribute("fill","none"))},_updatePoly:function(u,p){this._setPath(u,ot(u._parts,p))},_updateCircle:function(u){var p=u._point,y=Math.max(Math.round(u._radius),1),b=Math.max(Math.round(u._radiusY),1)||y,k="a"+y+","+b+" 0 1,0 ",N=u._empty()?"M0 0":"M"+(p.x-y)+","+p.y+k+y*2+",0 "+k+-y*2+",0 ";this._setPath(u,N)},_setPath:function(u,p){u._path.setAttribute("d",p)},_bringToFront:function(u){oc(u._path)},_bringToBack:function(u){ac(u._path)}});Ne.vml&&lh.include(rW);function oT(u){return Ne.svg||Ne.vml?new lh(u):null}nt.include({getRenderer:function(u){var p=u.options.renderer||this._getPaneRenderer(u.options.pane)||this.options.renderer||this._renderer;return p||(p=this._renderer=this._createRenderer()),this.hasLayer(p)||this.addLayer(p),p},_getPaneRenderer:function(u){if(u==="overlayPane"||u===void 0)return!1;var p=this._paneRenderers[u];return p===void 0&&(p=this._createRenderer({pane:u}),this._paneRenderers[u]=p),p},_createRenderer:function(u){return this.options.preferCanvas&&rT(u)||oT(u)}});var aT=uc.extend({initialize:function(u,p){uc.prototype.initialize.call(this,this._boundsToLatLngs(u),p)},setBounds:function(u){return this.setLatLngs(this._boundsToLatLngs(u))},_boundsToLatLngs:function(u){return u=he(u),[u.getSouthWest(),u.getNorthWest(),u.getNorthEast(),u.getSouthEast()]}});function oW(u,p){return new aT(u,p)}lh.create=Hp,lh.pointsToPath=ot,Mr.geometryToLayer=zp,Mr.coordsToLatLng=s_,Mr.coordsToLatLngs=Bp,Mr.latLngToCoords=i_,Mr.latLngsToCoords=Up,Mr.getFeature=hc,Mr.asFeature=Wp,nt.mergeOptions({boxZoom:!0});var lT=rr.extend({initialize:function(u){this._map=u,this._container=u._container,this._pane=u._panes.overlayPane,this._resetStateTimeout=0,u.on("unload",this._destroy,this)},addHooks:function(){Be(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){kt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ut(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(u){if(!u.shiftKey||u.which!==1&&u.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Ju(),Bx(),this._startPoint=this._map.mouseEventToContainerPoint(u),Be(document,{contextmenu:Da,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(u){this._moved||(this._moved=!0,this._box=at("div","leaflet-zoom-box",this._container),Ve(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(u);var p=new te(this._point,this._startPoint),y=p.getSize();rn(this._box,p.min),this._box.style.width=y.x+"px",this._box.style.height=y.y+"px"},_finish:function(){this._moved&&(Ut(this._box),en(this._container,"leaflet-crosshair")),eh(),Ux(),kt(document,{contextmenu:Da,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(u){if(!(u.which!==1&&u.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var p=new ue(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(p).fire("boxzoomend",{boxZoomBounds:p})}},_onKeyDown:function(u){u.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nt.addInitHook("addHandler","boxZoom",lT),nt.mergeOptions({doubleClickZoom:!0});var cT=rr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(u){var p=this._map,y=p.getZoom(),b=p.options.zoomDelta,k=u.originalEvent.shiftKey?y-b:y+b;p.options.doubleClickZoom==="center"?p.setZoom(k):p.setZoomAround(u.containerPoint,k)}});nt.addInitHook("addHandler","doubleClickZoom",cT),nt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var uT=rr.extend({addHooks:function(){if(!this._draggable){var u=this._map;this._draggable=new vo(u._mapPane,u._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),u.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),u.on("zoomend",this._onZoomEnd,this),u.whenReady(this._onZoomEnd,this))}Ve(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){en(this._map._container,"leaflet-grab"),en(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var u=this._map;if(u._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var p=he(this._map.options.maxBounds);this._offsetLimit=ae(this._map.latLngToContainerPoint(p.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(p.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;u.fire("movestart").fire("dragstart"),u.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(u){if(this._map.options.inertia){var p=this._lastTime=+new Date,y=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(y),this._times.push(p),this._prunePositions(p)}this._map.fire("move",u).fire("drag",u)},_prunePositions:function(u){for(;this._positions.length>1&&u-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var u=this._map.getSize().divideBy(2),p=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=p.subtract(u).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(u,p){return u-(u-p)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var u=this._draggable._newPos.subtract(this._draggable._startPos),p=this._offsetLimit;u.x<p.min.x&&(u.x=this._viscousLimit(u.x,p.min.x)),u.y<p.min.y&&(u.y=this._viscousLimit(u.y,p.min.y)),u.x>p.max.x&&(u.x=this._viscousLimit(u.x,p.max.x)),u.y>p.max.y&&(u.y=this._viscousLimit(u.y,p.max.y)),this._draggable._newPos=this._draggable._startPos.add(u)}},_onPreDragWrap:function(){var u=this._worldWidth,p=Math.round(u/2),y=this._initialWorldOffset,b=this._draggable._newPos.x,k=(b-p+y)%u+p-y,N=(b+p+y)%u-p-y,M=Math.abs(k+y)<Math.abs(N+y)?k:N;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=M},_onDragEnd:function(u){var p=this._map,y=p.options,b=!y.inertia||u.noInertia||this._times.length<2;if(p.fire("dragend",u),b)p.fire("moveend");else{this._prunePositions(+new Date);var k=this._lastPos.subtract(this._positions[0]),N=(this._lastTime-this._times[0])/1e3,M=y.easeLinearity,K=k.multiplyBy(M/N),ne=K.distanceTo([0,0]),fe=Math.min(y.inertiaMaxSpeed,ne),be=K.multiplyBy(fe/ne),Pe=fe/(y.inertiaDeceleration*M),qe=be.multiplyBy(-Pe/2).round();!qe.x&&!qe.y?p.fire("moveend"):(qe=p._limitOffset(qe,p.options.maxBounds),z(function(){p.panBy(qe,{duration:Pe,easeLinearity:M,noMoveStart:!0,animate:!0})}))}}});nt.addInitHook("addHandler","dragging",uT),nt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var hT=rr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(u){this._map=u,this._setPanDelta(u.options.keyboardPanDelta),this._setZoomDelta(u.options.zoomDelta)},addHooks:function(){var u=this._map._container;u.tabIndex<=0&&(u.tabIndex="0"),Be(u,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),kt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var u=document.body,p=document.documentElement,y=u.scrollTop||p.scrollTop,b=u.scrollLeft||p.scrollLeft;this._map._container.focus(),window.scrollTo(b,y)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(u){var p=this._panKeys={},y=this.keyCodes,b,k;for(b=0,k=y.left.length;b<k;b++)p[y.left[b]]=[-1*u,0];for(b=0,k=y.right.length;b<k;b++)p[y.right[b]]=[u,0];for(b=0,k=y.down.length;b<k;b++)p[y.down[b]]=[0,u];for(b=0,k=y.up.length;b<k;b++)p[y.up[b]]=[0,-1*u]},_setZoomDelta:function(u){var p=this._zoomKeys={},y=this.keyCodes,b,k;for(b=0,k=y.zoomIn.length;b<k;b++)p[y.zoomIn[b]]=u;for(b=0,k=y.zoomOut.length;b<k;b++)p[y.zoomOut[b]]=-u},_addHooks:function(){Be(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){kt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(u){if(!(u.altKey||u.ctrlKey||u.metaKey)){var p=u.keyCode,y=this._map,b;if(p in this._panKeys){if(!y._panAnim||!y._panAnim._inProgress)if(b=this._panKeys[p],u.shiftKey&&(b=V(b).multiplyBy(3)),y.options.maxBounds&&(b=y._limitOffset(V(b),y.options.maxBounds)),y.options.worldCopyJump){var k=y.wrapLatLng(y.unproject(y.project(y.getCenter()).add(b)));y.panTo(k)}else y.panBy(b)}else if(p in this._zoomKeys)y.setZoom(y.getZoom()+(u.shiftKey?3:1)*this._zoomKeys[p]);else if(p===27&&y._popup&&y._popup.options.closeOnEscapeKey)y.closePopup();else return;Da(u)}}});nt.addInitHook("addHandler","keyboard",hT),nt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var dT=rr.extend({addHooks:function(){Be(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){kt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(u){var p=LS(u),y=this._map.options.wheelDebounceTime;this._delta+=p,this._lastMousePos=this._map.mouseEventToContainerPoint(u),this._startTime||(this._startTime=+new Date);var b=Math.max(y-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),b),Da(u)},_performZoom:function(){var u=this._map,p=u.getZoom(),y=this._map.options.zoomSnap||0;u._stop();var b=this._delta/(this._map.options.wheelPxPerZoomLevel*4),k=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,N=y?Math.ceil(k/y)*y:k,M=u._limitZoom(p+(this._delta>0?N:-N))-p;this._delta=0,this._startTime=null,M&&(u.options.scrollWheelZoom==="center"?u.setZoom(p+M):u.setZoomAround(this._lastMousePos,p+M))}});nt.addInitHook("addHandler","scrollWheelZoom",dT);var aW=600;nt.mergeOptions({tapHold:Ne.touchNative&&Ne.safari&&Ne.mobile,tapTolerance:15});var fT=rr.extend({addHooks:function(){Be(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){kt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(u){if(clearTimeout(this._holdTimeout),u.touches.length===1){var p=u.touches[0];this._startPos=this._newPos=new O(p.clientX,p.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(Be(document,"touchend",Fn),Be(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",p))},this),aW),Be(document,"touchend touchcancel contextmenu",this._cancel,this),Be(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function u(){kt(document,"touchend",Fn),kt(document,"touchend touchcancel",u)},_cancel:function(){clearTimeout(this._holdTimeout),kt(document,"touchend touchcancel contextmenu",this._cancel,this),kt(document,"touchmove",this._onMove,this)},_onMove:function(u){var p=u.touches[0];this._newPos=new O(p.clientX,p.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(u,p){var y=new MouseEvent(u,{bubbles:!0,cancelable:!0,view:window,screenX:p.screenX,screenY:p.screenY,clientX:p.clientX,clientY:p.clientY});y._simulated=!0,p.target.dispatchEvent(y)}});nt.addInitHook("addHandler","tapHold",fT),nt.mergeOptions({touchZoom:Ne.touch,bounceAtZoomLimits:!0});var pT=rr.extend({addHooks:function(){Ve(this._map._container,"leaflet-touch-zoom"),Be(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){en(this._map._container,"leaflet-touch-zoom"),kt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(u){var p=this._map;if(!(!u.touches||u.touches.length!==2||p._animatingZoom||this._zooming)){var y=p.mouseEventToContainerPoint(u.touches[0]),b=p.mouseEventToContainerPoint(u.touches[1]);this._centerPoint=p.getSize()._divideBy(2),this._startLatLng=p.containerPointToLatLng(this._centerPoint),p.options.touchZoom!=="center"&&(this._pinchStartLatLng=p.containerPointToLatLng(y.add(b)._divideBy(2))),this._startDist=y.distanceTo(b),this._startZoom=p.getZoom(),this._moved=!1,this._zooming=!0,p._stop(),Be(document,"touchmove",this._onTouchMove,this),Be(document,"touchend touchcancel",this._onTouchEnd,this),Fn(u)}},_onTouchMove:function(u){if(!(!u.touches||u.touches.length!==2||!this._zooming)){var p=this._map,y=p.mouseEventToContainerPoint(u.touches[0]),b=p.mouseEventToContainerPoint(u.touches[1]),k=y.distanceTo(b)/this._startDist;if(this._zoom=p.getScaleZoom(k,this._startZoom),!p.options.bounceAtZoomLimits&&(this._zoom<p.getMinZoom()&&k<1||this._zoom>p.getMaxZoom()&&k>1)&&(this._zoom=p._limitZoom(this._zoom)),p.options.touchZoom==="center"){if(this._center=this._startLatLng,k===1)return}else{var N=y._add(b)._divideBy(2)._subtract(this._centerPoint);if(k===1&&N.x===0&&N.y===0)return;this._center=p.unproject(p.project(this._pinchStartLatLng,this._zoom).subtract(N),this._zoom)}this._moved||(p._moveStart(!0,!1),this._moved=!0),H(this._animRequest);var M=o(p._move,p,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=z(M,this,!0),Fn(u)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,H(this._animRequest),kt(document,"touchmove",this._onTouchMove,this),kt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});nt.addInitHook("addHandler","touchZoom",pT),nt.BoxZoom=lT,nt.DoubleClickZoom=cT,nt.Drag=uT,nt.Keyboard=hT,nt.ScrollWheelZoom=dT,nt.TapHold=fT,nt.TouchZoom=pT,n.Bounds=te,n.Browser=Ne,n.CRS=we,n.Canvas=iT,n.Circle=n_,n.CircleMarker=Mp,n.Class=Z,n.Control=Ei,n.DivIcon=tT,n.DivOverlay=or,n.DomEvent=kU,n.DomUtil=CU,n.Draggable=vo,n.Evented=oe,n.FeatureGroup=Lr,n.GeoJSON=Mr,n.GridLayer=oh,n.Handler=rr,n.Icon=cc,n.ImageOverlay=Vp,n.LatLng=le,n.LatLngBounds=ue,n.Layer=Ni,n.LayerGroup=lc,n.LineUtil=MU,n.Map=nt,n.Marker=Fp,n.Mixin=AU,n.Path=xo,n.Point=O,n.PolyUtil=DU,n.Polygon=uc,n.Polyline=Fr,n.Popup=Gp,n.PosAnimation=FS,n.Projection=zU,n.Rectangle=aT,n.Renderer=zr,n.SVG=lh,n.SVGOverlay=eT,n.TileLayer=dc,n.Tooltip=jp,n.Transformation=Me,n.Util=Q,n.VideoOverlay=JS,n.bind=o,n.bounds=ae,n.canvas=rT,n.circle=qU,n.circleMarker=HU,n.control=sh,n.divIcon=nW,n.extend=i,n.featureGroup=VU,n.geoJSON=QS,n.geoJson=ZU,n.gridLayer=sW,n.icon=GU,n.imageOverlay=YU,n.latLng=ce,n.latLngBounds=he,n.layerGroup=WU,n.map=SU,n.marker=jU,n.point=V,n.polygon=XU,n.polyline=KU,n.popup=eW,n.rectangle=oW,n.setOptions=v,n.stamp=l,n.svg=oT,n.svgOverlay=JU,n.tileLayer=nT,n.tooltip=tW,n.transformation=Qe,n.version=s,n.videoOverlay=QU;var lW=window.L;n.noConflict=function(){return window.L=lW,this},window.L=n})})(cb,cb.exports);var Cp=cb.exports;const Cx=Cb(Cp);function Fk(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function Mk(t,e){return e==null?function(s,i){const r=ie.useRef();return r.current||(r.current=t(s,i)),r}:function(s,i){const r=ie.useRef();r.current||(r.current=t(s,i));const o=ie.useRef(s),{instance:a}=r.current;return ie.useEffect(function(){o.current!==s&&(e(a,s,o.current),o.current=s)},[a,s,i]),r}}function f0e(t,e){ie.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var r;(r=e.layerContainer)==null||r.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function LB(t){return function(n){const s=Ok(),i=t(Lk(n,s),s);return AB(s.map,n.attribution),OB(i.current,n.eventHandlers),f0e(i.current,s),i}}function p0e(t,e){const n=Mk(t,e),s=LB(n);return c0e(s)}function m0e(t,e){const n=Mk(t),s=d0e(n,e);return u0e(s)}function g0e(t,e){const n=Mk(t,e),s=LB(n);return h0e(s)}function y0e(t,e,n){const{opacity:s,zIndex:i}=e;s!=null&&s!==n.opacity&&t.setOpacity(s),i!=null&&i!==n.zIndex&&t.setZIndex(i)}function v0e(){return Ok().map}function ub(){return ub=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},ub.apply(this,arguments)}function x0e({bounds:t,boundsOptions:e,center:n,children:s,className:i,id:r,placeholder:o,style:a,whenReady:l,zoom:c,...h},d){const[f]=ie.useState({className:i,id:r,style:a}),[m,g]=ie.useState(null);ie.useImperativeHandle(d,()=>(m==null?void 0:m.map)??null,[m]);const v=ie.useCallback(x=>{if(x!==null&&m===null){const w=new Cp.Map(x,h);n!=null&&c!=null?w.setView(n,c):t!=null&&w.fitBounds(t,e),l!=null&&w.whenReady(l),g(a0e(w))}},[]);ie.useEffect(()=>()=>{m==null||m.map.remove()},[m]);const _=m?qm.createElement(PB,{value:m},s):o??null;return qm.createElement("div",ub({},f,{ref:v}),_)}const _0e=ie.forwardRef(x0e),u$=p0e(function({position:e,...n},s){const i=new Cp.Marker(e,n);return Fk(i,l0e(s,{overlayContainer:i}))},function(e,n,s){n.position!==s.position&&e.setLatLng(n.position),n.icon!=null&&n.icon!==s.icon&&e.setIcon(n.icon),n.zIndexOffset!=null&&n.zIndexOffset!==s.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),n.opacity!=null&&n.opacity!==s.opacity&&e.setOpacity(n.opacity),e.dragging!=null&&n.draggable!==s.draggable&&(n.draggable===!0?e.dragging.enable():e.dragging.disable())}),h$=m0e(function(e,n){const s=new Cp.Popup(e,n.overlayContainer);return Fk(s,n)},function(e,n,{position:s},i){ie.useEffect(function(){const{instance:o}=e;function a(c){c.popup===o&&(o.update(),i(!0))}function l(c){c.popup===o&&i(!1)}return n.map.on({popupopen:a,popupclose:l}),n.overlayContainer==null?(s!=null&&o.setLatLng(s),o.openOn(n.map)):n.overlayContainer.bindPopup(o),function(){var h;n.map.off({popupopen:a,popupclose:l}),(h=n.overlayContainer)==null||h.unbindPopup(),n.map.removeLayer(o)}},[e,n,i,s])}),w0e=g0e(function({url:e,...n},s){const i=new Cp.TileLayer(e,Lk(n,s));return Fk(i,s)},function(e,n,s){y0e(e,n,s);const{url:i}=n;i!=null&&i!==s.url&&e.setUrl(i)});delete Cx.Icon.Default.prototype._getIconUrl;Cx.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const b0e=new Cx.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),C0e=new Cx.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function I0e({position:t}){const e=v0e();return ie.useEffect(()=>{t&&e.setView(t,14)},[t,e]),null}function k0e(){const[t,e]=ie.useState(null),[n,s]=ie.useState([]),[i,r]=ie.useState(!0);ie.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(l=>{const c={lat:l.coords.latitude,lng:l.coords.longitude};e(c),o(c)},l=>{console.error("Error getting location:",l),r(!1)})},[]);const o=async l=>{try{const c=`
        [out:json][timeout:25];
        (
          node["amenity"="hospital"](around:5000,${l.lat},${l.lng});
          way["amenity"="hospital"](around:5000,${l.lat},${l.lng});
          relation["amenity"="hospital"](around:5000,${l.lat},${l.lng});
        );
        out body;
        >;
        out skel qt;
      `,f=(await(await fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:c})).json()).elements.map(m=>({id:m.id,name:m.tags.name||"Unnamed Hospital",lat:m.lat,lng:m.lon,address:m.tags["addr:street"]?`${m.tags["addr:street"]} ${m.tags["addr:housenumber"]||""}`:"Address not available",phone:m.tags.phone||null}));s(f),r(!1)}catch(c){console.error("Error fetching hospitals:",c),r(!1)}},a=l=>{if(t){const c=`https://www.openstreetmap.org/directions?engine=osrm_car&route=${t.lat},${t.lng};${l.lat},${l.lng}`;window.open(c,"_blank")}};return A.jsxs("div",{className:"container mx-auto px-4 py-8",children:[A.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Nearby Hospitals"}),i?A.jsx("div",{className:"flex justify-center items-center h-64",children:A.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):A.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[A.jsx("div",{className:"md:col-span-2 h-[600px] relative",children:t&&A.jsxs(_0e,{center:[t.lat,t.lng],zoom:14,style:{height:"100%",width:"100%"},className:"rounded-lg shadow-md",children:[A.jsx(w0e,{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),A.jsx(I0e,{position:[t.lat,t.lng]}),A.jsx(u$,{position:[t.lat,t.lng],icon:b0e,children:A.jsx(h$,{children:"You are here"})}),n.map(l=>A.jsx(u$,{position:[l.lat,l.lng],icon:C0e,children:A.jsx(h$,{children:A.jsxs("div",{className:"min-w-[200px]",children:[A.jsx("h3",{className:"font-semibold",children:l.name}),A.jsx("p",{className:"text-sm text-gray-600",children:l.address})]})})},l.id))]})}),A.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:n.map(l=>A.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow",children:[A.jsx("h3",{className:"font-semibold mb-2",children:l.name}),A.jsxs("p",{className:"text-sm text-gray-600 mb-2 flex items-center gap-2",children:[A.jsx(Yj,{size:16}),l.address]}),A.jsxs("div",{className:"flex gap-2 mt-4",children:[l.phone&&A.jsxs("a",{href:`tel:${l.phone}`,className:"flex items-center gap-1 bg-green-500 text-white px-3 py-1 rounded-md text-sm hover:bg-green-600 transition-colors",children:[A.jsx(eH,{size:16}),"Call"]}),A.jsxs("button",{onClick:()=>a(l),className:"flex items-center gap-1 bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors",children:[A.jsx(Jj,{size:16}),"Directions"]})]})]},l.id))})]})]})}var d$={};const f$="@firebase/database",p$="1.0.11";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FB="";function S0e(t){FB=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0e{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Nn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:bd(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0e{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Pr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MB=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new T0e(e)}}catch{}return new E0e},tl=MB("localStorage"),N0e=MB("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new Uy("@firebase/database"),$0e=function(){let t=1;return function(){return t++}}(),zB=function(t){const e=NH(t),n=new kH;n.update(e);const s=n.digest();return _1.encodeByteArray(s)},Ip=function(...t){let e="";for(let n=0;n<t.length;n++){const s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Ip.apply(null,s):typeof s=="object"?e+=Nn(s):e+=s,e+=" "}return e};let Qh=null,m$=!0;const R0e=function(t,e){ge(!0,"Can't turn on custom loggers persistently."),Zc.logLevel=xt.VERBOSE,Qh=Zc.log.bind(Zc)},es=function(...t){if(m$===!0&&(m$=!1,Qh===null&&N0e.get("logging_enabled")===!0&&R0e()),Qh){const e=Ip.apply(null,t);Qh(e)}},kp=function(t){return function(...e){es(t,...e)}},hb=function(...t){const e="FIREBASE INTERNAL ERROR: "+Ip(...t);Zc.error(e)},uo=function(...t){const e=`FIREBASE FATAL ERROR: ${Ip(...t)}`;throw Zc.error(e),new Error(e)},As=function(...t){const e="FIREBASE WARNING: "+Ip(...t);Zc.warn(e)},A0e=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&As("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},zk=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},D0e=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Dl="[MIN_NAME]",aa="[MAX_NAME]",Hu=function(t,e){if(t===e)return 0;if(t===Dl||e===aa)return-1;if(e===Dl||t===aa)return 1;{const n=g$(t),s=g$(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},P0e=function(t,e){return t===e?0:t<e?-1:1},bh=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Nn(e))},Bk=function(t){if(typeof t!="object"||t===null)return Nn(t);const e=[];for(const s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=Nn(e[s]),n+=":",n+=Bk(t[e[s]]);return n+="}",n},BB=function(t,e){const n=t.length;if(n<=e)return[t];const s=[];for(let i=0;i<n;i+=e)i+e>n?s.push(t.substring(i,n)):s.push(t.substring(i,i+e));return s};function Ls(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const UB=function(t){ge(!zk(t),"Invalid JSON number");const e=11,n=52,s=(1<<e-1)-1;let i,r,o,a,l;t===0?(r=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),r=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-s-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();const h=c.join("");let d="";for(l=0;l<64;l+=8){let f=parseInt(h.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},O0e=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},L0e=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function F0e(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}const M0e=new RegExp("^-?(0*)\\d{1,10}$"),z0e=-2147483648,B0e=2147483647,g$=function(t){if(M0e.test(t)){const e=Number(t);if(e>=z0e&&e<=B0e)return e}return null},qu=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw As("Exception was thrown by user callback.",n),e},Math.floor(0))}},U0e=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Jh=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0e{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){As(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0e{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(es("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',As(e)}}class Hm{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Hm.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk="5",WB="v",VB="s",GB="r",jB="f",HB=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,qB="ls",KB="p",db="ac",XB="websocket",ZB="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YB{constructor(e,n,s,i,r=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=tl.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&tl.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function G0e(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function QB(t,e,n){ge(typeof e=="string","typeof type must == string"),ge(typeof n=="object","typeof params must == object");let s;if(e===XB)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===ZB)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);G0e(t)&&(n.ns=t.namespace);const i=[];return Ls(n,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0e{constructor(){this.counters_={}}incrementCounter(e,n=1){Pr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return lH(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw={},uw={};function Wk(t){const e=t.toString();return cw[e]||(cw[e]=new j0e),cw[e]}function H0e(t,e){const n=t.toString();return uw[n]||(uw[n]=e()),uw[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0e{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&qu(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y$="start",K0e="close",X0e="pLPCommand",Z0e="pRTLPCB",JB="id",e4="pw",t4="ser",Y0e="cb",Q0e="seg",J0e="ts",ebe="d",tbe="dframe",n4=1870,s4=30,nbe=n4-s4,sbe=25e3,ibe=3e4;class Oc{constructor(e,n,s,i,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=kp(e),this.stats_=Wk(n),this.urlFn=l=>(this.appCheckToken&&(l[db]=this.appCheckToken),QB(n,ZB,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new q0e(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ibe)),D0e(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Vk((...r)=>{const[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===y$)this.id=a,this.password=l;else if(o===K0e)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[y$]="t",s[t4]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[Y0e]=this.scriptTagHolder.uniqueCallbackIdentifier),s[WB]=Uk,this.transportSessionId&&(s[VB]=this.transportSessionId),this.lastSessionId&&(s[qB]=this.lastSessionId),this.applicationId&&(s[KB]=this.applicationId),this.appCheckToken&&(s[db]=this.appCheckToken),typeof location<"u"&&location.hostname&&HB.test(location.hostname)&&(s[GB]=jB);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Oc.forceAllow_=!0}static forceDisallow(){Oc.forceDisallow_=!0}static isAvailable(){return Oc.forceAllow_?!0:!Oc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!O0e()&&!L0e()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Nn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=ED(n),i=BB(s,nbe);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const s={};s[tbe]="t",s[JB]=e,s[e4]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Nn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Vk{constructor(e,n,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=$0e(),window[X0e+this.uniqueCallbackIdentifier]=e,window[Z0e+this.uniqueCallbackIdentifier]=n,this.myIFrame=Vk.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){es("frame writing exception"),a.stack&&es(a.stack),es(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||es("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[JB]=this.myID,e[e4]=this.myPW,e[t4]=this.currentSerial;let n=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+s4+s.length<=n4;){const o=this.pendingSegs.shift();s=s+"&"+Q0e+i+"="+o.seg+"&"+J0e+i+"="+o.ts+"&"+ebe+i+"="+o.d,i++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(s,Math.floor(sbe)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{es("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rbe=16384,obe=45e3;let ly=null;typeof MozWebSocket<"u"?ly=MozWebSocket:typeof WebSocket<"u"&&(ly=WebSocket);class Mi{constructor(e,n,s,i,r,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=kp(this.connId),this.stats_=Wk(n),this.connURL=Mi.connectionURL_(n,o,a,i,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,s,i,r){const o={};return o[WB]=Uk,typeof location<"u"&&location.hostname&&HB.test(location.hostname)&&(o[GB]=jB),n&&(o[VB]=n),s&&(o[qB]=s),i&&(o[db]=i),r&&(o[KB]=r),QB(e,XB,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tl.set("previous_websocket_failure",!0);try{let s;vH(),this.mySock=new ly(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Mi.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&ly!==null&&!Mi.forceDisallow_}static previouslyFailed(){return tl.isInMemoryStorage||tl.get("previous_websocket_failure")===!0}markConnectionHealthy(){tl.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const s=bd(n);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ge(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const n=Nn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=BB(n,rbe);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(obe))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Mi.responsesRequiredToBeHealthy=2;Mi.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{static get ALL_TRANSPORTS(){return[Oc,Mi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Mi&&Mi.isAvailable();let s=n&&!Mi.previouslyFailed();if(e.webSocketOnly&&(n||As("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Mi];else{const i=this.transports_=[];for(const r of Bd.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Bd.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Bd.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const abe=6e4,lbe=5e3,cbe=10*1024,ube=100*1024,hw="t",v$="d",hbe="s",x$="r",dbe="e",_$="o",w$="a",b$="n",C$="p",fbe="h";class pbe{constructor(e,n,s,i,r,o,a,l,c,h){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=kp("c:"+this.id+":"),this.transportManager_=new Bd(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Jh(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ube?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>cbe?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(hw in e){const n=e[hw];n===w$?this.upgradeIfSecondaryHealthy_():n===x$?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===_$&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=bh("t",e),s=bh("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:C$,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:w$,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:b$,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=bh("t",e),s=bh("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=bh(hw,e);if(v$ in e){const s=e[v$];if(n===fbe){const i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===b$){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===hbe?this.onConnectionShutdown_(s):n===x$?this.onReset_(s):n===dbe?hb("Server Error: "+s):n===_$?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):hb("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Uk!==s&&As("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),Jh(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(abe))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Jh(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(lbe))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:C$,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tl.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{put(e,n,s,i){}merge(e,n,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e){this.allowedEvents_=e,this.listeners_={},ge(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});const i=this.getInitialEvent(e);i&&n.apply(s,i)}off(e,n,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===n&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){ge(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy extends r4{static getInstance(){return new cy}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!b1()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ge(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I$=32,k$=768;class wt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function ht(){return new wt("")}function Ke(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function la(t){return t.pieces_.length-t.pieceNum_}function St(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new wt(t.pieces_,e)}function o4(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function mbe(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function a4(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function l4(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new wt(e,0)}function wn(t,e){const n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof wt)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&n.push(s[i])}return new wt(n,0)}function Xe(t){return t.pieceNum_>=t.pieces_.length}function Ss(t,e){const n=Ke(t),s=Ke(e);if(n===null)return e;if(n===s)return Ss(St(t),St(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Gk(t,e){if(la(t)!==la(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function Bi(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(la(t)>la(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}class gbe{constructor(e,n){this.errorPrefix_=n,this.parts_=a4(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=By(this.parts_[s]);c4(this)}}function ybe(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=By(e),c4(t)}function vbe(t){const e=t.parts_.pop();t.byteLength_-=By(e),t.parts_.length>0&&(t.byteLength_-=1)}function c4(t){if(t.byteLength_>k$)throw new Error(t.errorPrefix_+"has a key path longer than "+k$+" bytes ("+t.byteLength_+").");if(t.parts_.length>I$)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+I$+") or object contains a cycle "+Ga(t))}function Ga(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk extends r4{static getInstance(){return new jk}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return ge(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch=1e3,xbe=60*5*1e3,S$=30*1e3,_be=1.3,wbe=3e4,bbe="server_kill",T$=3;class Jr extends i4{constructor(e,n,s,i,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Jr.nextPersistentConnectionId_++,this.log_=kp("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ch,this.maxReconnectDelay_=xbe,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");jk.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&cy.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,s){const i=++this.requestNumber_,r={r:i,a:e,b:n};this.log_(Nn(r)),ge(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const n=new zy,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ge(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:e,tag:s};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(e){const n=e.query,s=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;Jr.warnOnListenWarnings_(l,n),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Pr(e,"w")){const s=ru(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();As(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||IH(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=S$)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=CH(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,s=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(e,n){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,n)}sendUnlisten_(e,n,s,i){this.log_("Unlisten on "+e+" for "+n);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:s})}onDisconnectMerge(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:s})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,s,i){const r={p:n,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,n,s,i){this.putInternal("p",e,n,s,i)}merge(e,n,s,i){this.putInternal("m",e,n,s,i)}putInternal(e,n,s,i,r){this.initConnection_();const o={p:n,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,s,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Nn(e));const n=e.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):hb("Unrecognized action received from server: "+Nn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ge(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ch,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ch,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>wbe&&(this.reconnectDelay_=Ch),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*_be)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Jr.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},c=function(d){ge(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?es("getToken() completed but was canceled"):(es("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new pbe(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,s,m=>{As(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(bbe)},r))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&As(d),l())}}}interrupt(e){es("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){es("Resuming connection for reason: "+e),delete this.interruptReasons_[e],f0(this.interruptReasons_)&&(this.reconnectDelay_=Ch,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let s;n?s=n.map(r=>Bk(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const s=new wt(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(n),r.delete(n),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,n){es("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=T$&&(this.reconnectDelay_=S$,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){es("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=T$&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+FB.replace(/\./g,"-")]=1,b1()?e["framework.cordova"]=1:PD()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=cy.getInstance().currentlyOnline();return f0(this.interruptReasons_)&&e}}Jr.nextPersistentConnectionId_=0;Jr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Ze(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const s=new Ze(Dl,e),i=new Ze(Dl,n);return this.compare(s,i)!==0}minPost(){return Ze.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sm;class u4 extends Ix{static get __EMPTY_NODE(){return Sm}static set __EMPTY_NODE(e){Sm=e}compare(e,n){return Hu(e.name,n.name)}isDefinedOn(e){throw ku("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Ze.MIN}maxPost(){return new Ze(aa,Sm)}makePost(e,n){return ge(typeof e=="string","KeyIndex indexValue must always be a string."),new Ze(e,Sm)}toString(){return".key"}}const ll=new u4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(e,n,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class En{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s??En.RED,this.left=i??Ts.EMPTY_NODE,this.right=r??Ts.EMPTY_NODE}copy(e,n,s,i,r){return new En(e??this.key,n??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ts.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let s,i;if(s=this,n(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(e,s.key)===0){if(s.right.isEmpty())return Ts.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,En.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,En.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}En.RED=!0;En.BLACK=!1;class Cbe{copy(e,n,s,i,r){return this}insert(e,n,s){return new En(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ts{constructor(e,n=Ts.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Ts(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,En.BLACK,null,null))}remove(e){return new Ts(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,En.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,i=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Tm(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Tm(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Tm(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Tm(this.root_,null,this.comparator_,!0,e)}}Ts.EMPTY_NODE=new Cbe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ibe(t,e){return Hu(t.name,e.name)}function Hk(t,e){return Hu(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fb;function kbe(t){fb=t}const h4=function(t){return typeof t=="number"?"number:"+UB(t):"string:"+t},d4=function(t){if(t.isLeafNode()){const e=t.val();ge(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Pr(e,".sv"),"Priority must be a string or number.")}else ge(t===fb||t.isEmpty(),"priority of unexpected type.");ge(t===fb||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let E$;class Sn{static set __childrenNodeConstructor(e){E$=e}static get __childrenNodeConstructor(){return E$}constructor(e,n=Sn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ge(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),d4(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Sn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Sn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Xe(e)?this:Ke(e)===".priority"?this.priorityNode_:Sn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Sn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const s=Ke(e);return s===null?n:n.isEmpty()&&s!==".priority"?this:(ge(s!==".priority"||la(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Sn.__childrenNodeConstructor.EMPTY_NODE.updateChild(St(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+h4(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=UB(this.value_):e+=this.value_,this.lazyHash_=zB(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Sn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Sn.__childrenNodeConstructor?-1:(ge(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,s=typeof this.value_,i=Sn.VALUE_TYPE_ORDER.indexOf(n),r=Sn.VALUE_TYPE_ORDER.indexOf(s);return ge(i>=0,"Unknown leaf type: "+n),ge(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Sn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f4,p4;function Sbe(t){f4=t}function Tbe(t){p4=t}class Ebe extends Ix{compare(e,n){const s=e.node.getPriority(),i=n.node.getPriority(),r=s.compareTo(i);return r===0?Hu(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Ze.MIN}maxPost(){return new Ze(aa,new Sn("[PRIORITY-POST]",p4))}makePost(e,n){const s=f4(e);return new Ze(n,new Sn("[PRIORITY-POST]",s))}toString(){return".priority"}}const Vt=new Ebe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nbe=Math.log(2);class $be{constructor(e){const n=r=>parseInt(Math.log(r)/Nbe,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const uy=function(t,e,n,s){t.sort(e);const i=function(l,c){const h=c-l;let d,f;if(h===0)return null;if(h===1)return d=t[l],f=n?n(d):d,new En(f,d.node,En.BLACK,null,null);{const m=parseInt(h/2,10)+l,g=i(l,m),v=i(m+1,c);return d=t[m],f=n?n(d):d,new En(f,d.node,En.BLACK,g,v)}},r=function(l){let c=null,h=null,d=t.length;const f=function(g,v){const _=d-g,x=d;d-=g;const w=i(_+1,x),C=t[_],I=n?n(C):C;m(new En(I,C.node,v,null,w))},m=function(g){c?(c.left=g,c=g):(h=g,c=g)};for(let g=0;g<l.count;++g){const v=l.nextBitIsOne(),_=Math.pow(2,l.count-(g+1));v?f(_,En.BLACK):(f(_,En.BLACK),f(_,En.RED))}return h},o=new $be(t.length),a=r(o);return new Ts(s||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dw;const yc={};class Zr{static get Default(){return ge(yc&&Vt,"ChildrenNode.ts has not been loaded"),dw=dw||new Zr({".priority":yc},{".priority":Vt}),dw}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ru(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Ts?n:null}hasIndex(e){return Pr(this.indexSet_,e.toString())}addIndex(e,n){ge(e!==ll,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=n.getIterator(Ze.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=uy(s,e.getCompare()):a=yc;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Zr(h,c)}addToIndexes(e,n){const s=Cg(this.indexes_,(i,r)=>{const o=ru(this.indexSet_,r);if(ge(o,"Missing index implementation for "+r),i===yc)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(Ze.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),uy(a,o.getCompare())}else return yc;else{const a=n.get(e.name);let l=i;return a&&(l=l.remove(new Ze(e.name,a))),l.insert(e,e.node)}});return new Zr(s,this.indexSet_)}removeFromIndexes(e,n){const s=Cg(this.indexes_,i=>{if(i===yc)return i;{const r=n.get(e.name);return r?i.remove(new Ze(e.name,r)):i}});return new Zr(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ih;class Le{static get EMPTY_NODE(){return Ih||(Ih=new Le(new Ts(Hk),null,Zr.Default))}constructor(e,n,s){this.children_=e,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&d4(this.priorityNode_),this.children_.isEmpty()&&ge(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ih}updatePriority(e){return this.children_.isEmpty()?this:new Le(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Ih:n}}getChild(e){const n=Ke(e);return n===null?this:this.getImmediateChild(n).getChild(St(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ge(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const s=new Ze(e,n);let i,r;n.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Ih:this.priorityNode_;return new Le(i,o,r)}}updateChild(e,n){const s=Ke(e);if(s===null)return n;{ge(Ke(e)!==".priority"||la(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(St(e),n);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let s=0,i=0,r=!0;if(this.forEachChild(Vt,(o,a)=>{n[o]=a.val(e),s++,r&&Le.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+h4(this.getPriority().val())+":"),this.forEachChild(Vt,(n,s)=>{const i=s.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":zB(e)}return this.lazyHash_}getPredecessorChildName(e,n,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new Ze(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Ze(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Ze(n,this.children_.get(n)):null}forEachChild(e,n){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ze.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ze.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Sp?-1:0}withIndex(e){if(e===ll||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Le(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===ll||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const s=this.getIterator(Vt),i=n.getIterator(Vt);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ll?null:this.indexMap_.get(e.toString())}}Le.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Rbe extends Le{constructor(){super(new Ts(Hk),Le.EMPTY_NODE,Zr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Le.EMPTY_NODE}isEmpty(){return!1}}const Sp=new Rbe;Object.defineProperties(Ze,{MIN:{value:new Ze(Dl,Le.EMPTY_NODE)},MAX:{value:new Ze(aa,Sp)}});u4.__EMPTY_NODE=Le.EMPTY_NODE;Sn.__childrenNodeConstructor=Le;kbe(Sp);Tbe(Sp);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Abe=!0;function zn(t,e=null){if(t===null)return Le.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ge(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Sn(n,zn(e))}if(!(t instanceof Array)&&Abe){const n=[];let s=!1;if(Ls(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=zn(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new Ze(o,l)))}}),n.length===0)return Le.EMPTY_NODE;const r=uy(n,Ibe,o=>o.name,Hk);if(s){const o=uy(n,Vt.getCompare());return new Le(r,zn(e),new Zr({".priority":o},{".priority":Vt}))}else return new Le(r,zn(e),Zr.Default)}else{let n=Le.EMPTY_NODE;return Ls(t,(s,i)=>{if(Pr(t,s)&&s.substring(0,1)!=="."){const r=zn(i);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(s,r))}}),n.updatePriority(zn(e))}}Sbe(zn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk extends Ix{constructor(e){super(),this.indexPath_=e,ge(!Xe(e)&&Ke(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const s=this.extractChild(e.node),i=this.extractChild(n.node),r=s.compareTo(i);return r===0?Hu(e.name,n.name):r}makePost(e,n){const s=zn(e),i=Le.EMPTY_NODE.updateChild(this.indexPath_,s);return new Ze(n,i)}maxPost(){const e=Le.EMPTY_NODE.updateChild(this.indexPath_,Sp);return new Ze(aa,e)}toString(){return a4(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dbe extends Ix{compare(e,n){const s=e.node.compareTo(n.node);return s===0?Hu(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Ze.MIN}maxPost(){return Ze.MAX}makePost(e,n){const s=zn(e);return new Ze(n,s)}toString(){return".value"}}const m4=new Dbe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g4(t){return{type:"value",snapshotNode:t}}function xu(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Ud(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Wd(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Pbe(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(e){this.index_=e}updateChild(e,n,s,i,r,o){ge(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(Ud(n,a)):ge(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(xu(n,s)):o.trackChildChange(Wd(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Vt,(i,r)=>{n.hasChild(i)||s.trackChildChange(Ud(i,r))}),n.isLeafNode()||n.forEachChild(Vt,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Wd(i,r,o))}else s.trackChildChange(xu(i,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Le.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd{constructor(e){this.indexedFilter_=new Kk(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Vd.getStartPost_(e),this.endPost_=Vd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,i,r,o){return this.matches(new Ze(n,s))||(s=Le.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,i,r,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=Le.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(Le.EMPTY_NODE);const r=this;return n.forEachChild(Vt,(o,a)=>{r.matches(new Ze(o,a))||(i=i.updateImmediateChild(o,Le.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Obe{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{const s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Vd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,i,r,o){return this.rangedFilter_.matches(new Ze(n,s))||(s=Le.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,i,r,o):this.fullLimitUpdateChild_(e,n,s,r,o)}updateFullNode(e,n,s){let i;if(n.isLeafNode()||n.isEmpty())i=Le.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=Le.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(Le.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,Le.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,i,r){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,m)=>d(m,f)}else o=this.index_.getCompare();const a=e;ge(a.numChildren()===this.limit_,"");const l=new Ze(n,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(n)){const d=a.getImmediateChild(n);let f=i.getChildAfterChild(this.index_,c,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=i.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,l);if(h&&!s.isEmpty()&&m>=0)return r!=null&&r.trackChildChange(Wd(n,s,d)),a.updateImmediateChild(n,s);{r!=null&&r.trackChildChange(Ud(n,d));const v=a.updateImmediateChild(n,Le.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r!=null&&r.trackChildChange(xu(f.name,f.node)),v.updateImmediateChild(f.name,f.node)):v}}else return s.isEmpty()?e:h&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Ud(c.name,c.node)),r.trackChildChange(xu(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(c.name,Le.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Vt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ge(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ge(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Dl}hasEnd(){return this.endSet_}getIndexEndValue(){return ge(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ge(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:aa}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ge(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Vt}copy(){const e=new Xk;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Lbe(t){return t.loadsAllData()?new Kk(t.getIndex()):t.hasLimit()?new Obe(t):new Vd(t)}function Fbe(t,e){const n=t.copy();return n.index_=e,n}function N$(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Vt?n="$priority":t.index_===m4?n="$value":t.index_===ll?n="$key":(ge(t.index_ instanceof qk,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Nn(n),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=Nn(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+Nn(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=Nn(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+Nn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function $$(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Vt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy extends i4{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ge(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=kp("p:rest:"),this.listens_={}}listen(e,n,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=hy.getListenId_(e,s),a={};this.listens_[o]=a;const l=N$(e._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let d=h;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(r,d,!1,s),ru(this.listens_,o)===a){let f;c?c===401?f="permission_denied":f="rest_error:"+c:f="ok",i(f,null)}})}unlisten(e,n){const s=hy.getListenId_(e,n);delete this.listens_[s]}get(e){const n=N$(e._queryParams),s=e._path.toString(),i=new zy;return this.restRequest_(s+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(n.auth=i.accessToken),r&&r.token&&(n.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Su(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=bd(a.responseText)}catch{As("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&As("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mbe{constructor(){this.rootNode_=Le.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dy(){return{value:null,children:new Map}}function y4(t,e,n){if(Xe(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const s=Ke(e);t.children.has(s)||t.children.set(s,dy());const i=t.children.get(s);e=St(e),y4(i,e,n)}}function pb(t,e,n){t.value!==null?n(e,t.value):zbe(t,(s,i)=>{const r=new wt(e.toString()+"/"+s);pb(i,r,n)})}function zbe(t,e){t.children.forEach((n,s)=>{e(s,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bbe{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Ls(this.last_,(s,i)=>{n[s]=n[s]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R$=10*1e3,Ube=30*1e3,Wbe=5*60*1e3;class Vbe{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Bbe(e);const s=R$+(Ube-R$)*Math.random();Jh(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),n={};let s=!1;Ls(e,(i,r)=>{r>0&&Pr(this.statsToReport_,i)&&(n[i]=r,s=!0)}),s&&this.server_.reportStats(n),Jh(this.reportStats_.bind(this),Math.floor(Math.random()*2*Wbe))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ui;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ui||(Ui={}));function v4(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Zk(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Yk(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=Ui.ACK_USER_WRITE,this.source=v4()}operationForChild(e){if(Xe(this.path)){if(this.affectedTree.value!=null)return ge(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new wt(e));return new fy(ht(),n,this.revert)}}else return ge(Ke(this.path)===e,"operationForChild called for unrelated child."),new fy(St(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,n){this.source=e,this.path=n,this.type=Ui.LISTEN_COMPLETE}operationForChild(e){return Xe(this.path)?new Gd(this.source,ht()):new Gd(this.source,St(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=Ui.OVERWRITE}operationForChild(e){return Xe(this.path)?new Pl(this.source,ht(),this.snap.getImmediateChild(e)):new Pl(this.source,St(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=Ui.MERGE}operationForChild(e){if(Xe(this.path)){const n=this.children.subtree(new wt(e));return n.isEmpty()?null:n.value?new Pl(this.source,ht(),n.value):new jd(this.source,ht(),n)}else return ge(Ke(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new jd(this.source,St(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Xe(e))return this.isFullyInitialized()&&!this.filtered_;const n=Ke(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gbe{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function jbe(t,e,n,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Pbe(o.childName,o.snapshotNode))}),kh(t,i,"child_removed",e,s,n),kh(t,i,"child_added",e,s,n),kh(t,i,"child_moved",r,s,n),kh(t,i,"child_changed",e,s,n),kh(t,i,"value",e,s,n),i}function kh(t,e,n,s,i,r){const o=s.filter(a=>a.type===n);o.sort((a,l)=>qbe(t,a,l)),o.forEach(a=>{const l=Hbe(t,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function Hbe(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function qbe(t,e,n){if(e.childName==null||n.childName==null)throw ku("Should only compare child_ events.");const s=new Ze(e.childName,e.snapshotNode),i=new Ze(n.childName,n.snapshotNode);return t.index_.compare(s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kx(t,e){return{eventCache:t,serverCache:e}}function ed(t,e,n,s){return kx(new Ol(e,n,s),t.serverCache)}function x4(t,e,n,s){return kx(t.eventCache,new Ol(e,n,s))}function mb(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ll(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fw;const Kbe=()=>(fw||(fw=new Ts(P0e)),fw);class Dt{static fromObject(e){let n=new Dt(null);return Ls(e,(s,i)=>{n=n.set(new wt(s),i)}),n}constructor(e,n=Kbe()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:ht(),value:this.value};if(Xe(e))return null;{const s=Ke(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(St(e),n);return r!=null?{path:wn(new wt(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Xe(e))return this;{const n=Ke(e),s=this.children.get(n);return s!==null?s.subtree(St(e)):new Dt(null)}}set(e,n){if(Xe(e))return new Dt(n,this.children);{const s=Ke(e),r=(this.children.get(s)||new Dt(null)).set(St(e),n),o=this.children.insert(s,r);return new Dt(this.value,o)}}remove(e){if(Xe(e))return this.children.isEmpty()?new Dt(null):new Dt(null,this.children);{const n=Ke(e),s=this.children.get(n);if(s){const i=s.remove(St(e));let r;return i.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,i),this.value===null&&r.isEmpty()?new Dt(null):new Dt(this.value,r)}else return this}}get(e){if(Xe(e))return this.value;{const n=Ke(e),s=this.children.get(n);return s?s.get(St(e)):null}}setTree(e,n){if(Xe(e))return n;{const s=Ke(e),r=(this.children.get(s)||new Dt(null)).setTree(St(e),n);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new Dt(this.value,o)}}fold(e){return this.fold_(ht(),e)}fold_(e,n){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(wn(e,i),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,ht(),n)}findOnPath_(e,n,s){const i=this.value?s(n,this.value):!1;if(i)return i;if(Xe(e))return null;{const r=Ke(e),o=this.children.get(r);return o?o.findOnPath_(St(e),wn(n,r),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,ht(),n)}foreachOnPath_(e,n,s){if(Xe(e))return this;{this.value&&s(n,this.value);const i=Ke(e),r=this.children.get(i);return r?r.foreachOnPath_(St(e),wn(n,i),s):new Dt(null)}}foreach(e){this.foreach_(ht(),e)}foreach_(e,n){this.children.inorderTraversal((s,i)=>{i.foreach_(wn(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e){this.writeTree_=e}static empty(){return new qi(new Dt(null))}}function td(t,e,n){if(Xe(e))return new qi(new Dt(n));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=Ss(i,e);return r=r.updateChild(o,n),new qi(t.writeTree_.set(i,r))}else{const i=new Dt(n),r=t.writeTree_.setTree(e,i);return new qi(r)}}}function A$(t,e,n){let s=t;return Ls(n,(i,r)=>{s=td(s,wn(e,i),r)}),s}function D$(t,e){if(Xe(e))return qi.empty();{const n=t.writeTree_.setTree(e,new Dt(null));return new qi(n)}}function gb(t,e){return nc(t,e)!=null}function nc(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Ss(n.path,e)):null}function P$(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Vt,(s,i)=>{e.push(new Ze(s,i))}):t.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new Ze(s,i.value))}),e}function Qo(t,e){if(Xe(e))return t;{const n=nc(t,e);return n!=null?new qi(new Dt(n)):new qi(t.writeTree_.subtree(e))}}function yb(t){return t.writeTree_.isEmpty()}function _u(t,e){return _4(ht(),t.writeTree_,e)}function _4(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(ge(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):n=_4(wn(t,i),r,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(wn(t,".priority"),s)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(t,e){return I4(e,t)}function Xbe(t,e,n,s,i){ge(s>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:i}),i&&(t.visibleWrites=td(t.visibleWrites,e,n)),t.lastWriteId=s}function Zbe(t,e){for(let n=0;n<t.allWrites.length;n++){const s=t.allWrites[n];if(s.writeId===e)return s}return null}function Ybe(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ge(n>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[n];t.allWrites.splice(n,1);let i=s.visible,r=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&Qbe(a,s.path)?i=!1:Bi(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return Jbe(t),!0;if(s.snap)t.visibleWrites=D$(t.visibleWrites,s.path);else{const a=s.children;Ls(a,l=>{t.visibleWrites=D$(t.visibleWrites,wn(s.path,l))})}return!0}else return!1}function Qbe(t,e){if(t.snap)return Bi(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Bi(wn(t.path,n),e))return!0;return!1}function Jbe(t){t.visibleWrites=w4(t.allWrites,e1e,ht()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function e1e(t){return t.visible}function w4(t,e,n){let s=qi.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const o=r.path;let a;if(r.snap)Bi(n,o)?(a=Ss(n,o),s=td(s,a,r.snap)):Bi(o,n)&&(a=Ss(o,n),s=td(s,ht(),r.snap.getChild(a)));else if(r.children){if(Bi(n,o))a=Ss(n,o),s=A$(s,a,r.children);else if(Bi(o,n))if(a=Ss(o,n),Xe(a))s=A$(s,ht(),r.children);else{const l=ru(r.children,Ke(a));if(l){const c=l.getChild(St(a));s=td(s,ht(),c)}}}else throw ku("WriteRecord should have .snap or .children")}}return s}function b4(t,e,n,s,i){if(!s&&!i){const r=nc(t.visibleWrites,e);if(r!=null)return r;{const o=Qo(t.visibleWrites,e);if(yb(o))return n;if(n==null&&!gb(o,ht()))return null;{const a=n||Le.EMPTY_NODE;return _u(o,a)}}}else{const r=Qo(t.visibleWrites,e);if(!i&&yb(r))return n;if(!i&&n==null&&!gb(r,ht()))return null;{const o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(Bi(c.path,e)||Bi(e,c.path))},a=w4(t.allWrites,o,e),l=n||Le.EMPTY_NODE;return _u(a,l)}}}function t1e(t,e,n){let s=Le.EMPTY_NODE;const i=nc(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Vt,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(n){const r=Qo(t.visibleWrites,e);return n.forEachChild(Vt,(o,a)=>{const l=_u(Qo(r,new wt(o)),a);s=s.updateImmediateChild(o,l)}),P$(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=Qo(t.visibleWrites,e);return P$(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function n1e(t,e,n,s,i){ge(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=wn(e,n);if(gb(t.visibleWrites,r))return null;{const o=Qo(t.visibleWrites,r);return yb(o)?i.getChild(n):_u(o,i.getChild(n))}}function s1e(t,e,n,s){const i=wn(e,n),r=nc(t.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(n)){const o=Qo(t.visibleWrites,i);return _u(o,s.getNode().getImmediateChild(n))}else return null}function i1e(t,e){return nc(t.visibleWrites,e)}function r1e(t,e,n,s,i,r,o){let a;const l=Qo(t.visibleWrites,e),c=nc(l,ht());if(c!=null)a=c;else if(n!=null)a=_u(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),f=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let m=f.getNext();for(;m&&h.length<i;)d(m,s)!==0&&h.push(m),m=f.getNext();return h}else return[]}function o1e(){return{visibleWrites:qi.empty(),allWrites:[],lastWriteId:-1}}function py(t,e,n,s){return b4(t.writeTree,t.treePath,e,n,s)}function Jk(t,e){return t1e(t.writeTree,t.treePath,e)}function O$(t,e,n,s){return n1e(t.writeTree,t.treePath,e,n,s)}function my(t,e){return i1e(t.writeTree,wn(t.treePath,e))}function a1e(t,e,n,s,i,r){return r1e(t.writeTree,t.treePath,e,n,s,i,r)}function eS(t,e,n){return s1e(t.writeTree,t.treePath,e,n)}function C4(t,e){return I4(wn(t.treePath,e),t.writeTree)}function I4(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1e{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,s=e.childName;ge(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ge(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(s,Wd(s,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(s,Ud(s,i.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(s,xu(s,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(s,Wd(s,e.snapshotNode,i.oldSnap));else throw ku("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1e{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}}const k4=new c1e;class tS{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Ol(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return eS(this.writes_,e,s)}}getChildAfterChild(e,n,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ll(this.viewCache_),r=a1e(this.writes_,i,n,1,s,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u1e(t){return{filter:t}}function h1e(t,e){ge(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ge(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function d1e(t,e,n,s,i){const r=new l1e;let o,a;if(n.type===Ui.OVERWRITE){const c=n;c.source.fromUser?o=vb(t,e,c.path,c.snap,s,i,r):(ge(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!Xe(c.path),o=gy(t,e,c.path,c.snap,s,i,a,r))}else if(n.type===Ui.MERGE){const c=n;c.source.fromUser?o=p1e(t,e,c.path,c.children,s,i,r):(ge(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=xb(t,e,c.path,c.children,s,i,a,r))}else if(n.type===Ui.ACK_USER_WRITE){const c=n;c.revert?o=y1e(t,e,c.path,s,i,r):o=m1e(t,e,c.path,c.affectedTree,s,i,r)}else if(n.type===Ui.LISTEN_COMPLETE)o=g1e(t,e,n.path,s,r);else throw ku("Unknown operation type: "+n.type);const l=r.getChanges();return f1e(e,o,l),{viewCache:o,changes:l}}function f1e(t,e,n){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=mb(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&n.push(g4(mb(e)))}}function S4(t,e,n,s,i,r){const o=e.eventCache;if(my(s,n)!=null)return e;{let a,l;if(Xe(n))if(ge(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Ll(e),h=c instanceof Le?c:Le.EMPTY_NODE,d=Jk(s,h);a=t.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{const c=py(s,Ll(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=Ke(n);if(c===".priority"){ge(la(n)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=O$(s,n,h,l);d!=null?a=t.filter.updatePriority(h,d):a=o.getNode()}else{const h=St(n);let d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const f=O$(s,n,o.getNode(),l);f!=null?d=o.getNode().getImmediateChild(c).updateChild(h,f):d=o.getNode().getImmediateChild(c)}else d=eS(s,c,e.serverCache);d!=null?a=t.filter.updateChild(o.getNode(),c,d,h,i,r):a=o.getNode()}}return ed(e,a,o.isFullyInitialized()||Xe(n),t.filter.filtersNodes())}}function gy(t,e,n,s,i,r,o,a){const l=e.serverCache;let c;const h=o?t.filter:t.filter.getIndexedFilter();if(Xe(n))c=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const m=l.getNode().updateChild(n,s);c=h.updateFullNode(l.getNode(),m,null)}else{const m=Ke(n);if(!l.isCompleteForPath(n)&&la(n)>1)return e;const g=St(n),_=l.getNode().getImmediateChild(m).updateChild(g,s);m===".priority"?c=h.updatePriority(l.getNode(),_):c=h.updateChild(l.getNode(),m,_,g,k4,null)}const d=x4(e,c,l.isFullyInitialized()||Xe(n),h.filtersNodes()),f=new tS(i,d,r);return S4(t,d,n,i,f,a)}function vb(t,e,n,s,i,r,o){const a=e.eventCache;let l,c;const h=new tS(i,e,r);if(Xe(n))c=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=ed(e,c,!0,t.filter.filtersNodes());else{const d=Ke(n);if(d===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),s),l=ed(e,c,a.isFullyInitialized(),a.isFiltered());else{const f=St(n),m=a.getNode().getImmediateChild(d);let g;if(Xe(f))g=s;else{const v=h.getCompleteChild(d);v!=null?o4(f)===".priority"&&v.getChild(l4(f)).isEmpty()?g=v:g=v.updateChild(f,s):g=Le.EMPTY_NODE}if(m.equals(g))l=e;else{const v=t.filter.updateChild(a.getNode(),d,g,f,h,o);l=ed(e,v,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function L$(t,e){return t.eventCache.isCompleteForChild(e)}function p1e(t,e,n,s,i,r,o){let a=e;return s.foreach((l,c)=>{const h=wn(n,l);L$(e,Ke(h))&&(a=vb(t,a,h,c,i,r,o))}),s.foreach((l,c)=>{const h=wn(n,l);L$(e,Ke(h))||(a=vb(t,a,h,c,i,r,o))}),a}function F$(t,e,n){return n.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function xb(t,e,n,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;Xe(n)?c=s:c=new Dt(null).setTree(n,s);const h=e.serverCache.getNode();return c.children.inorderTraversal((d,f)=>{if(h.hasChild(d)){const m=e.serverCache.getNode().getImmediateChild(d),g=F$(t,m,f);l=gy(t,l,new wt(d),g,i,r,o,a)}}),c.children.inorderTraversal((d,f)=>{const m=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!h.hasChild(d)&&!m){const g=e.serverCache.getNode().getImmediateChild(d),v=F$(t,g,f);l=gy(t,l,new wt(d),v,i,r,o,a)}}),l}function m1e(t,e,n,s,i,r,o){if(my(i,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Xe(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return gy(t,e,n,l.getNode().getChild(n),i,r,a,o);if(Xe(n)){let c=new Dt(null);return l.getNode().forEachChild(ll,(h,d)=>{c=c.set(new wt(h),d)}),xb(t,e,n,c,i,r,a,o)}else return e}else{let c=new Dt(null);return s.foreach((h,d)=>{const f=wn(n,h);l.isCompleteForPath(f)&&(c=c.set(h,l.getNode().getChild(f)))}),xb(t,e,n,c,i,r,a,o)}}function g1e(t,e,n,s,i){const r=e.serverCache,o=x4(e,r.getNode(),r.isFullyInitialized()||Xe(n),r.isFiltered());return S4(t,o,n,s,k4,i)}function y1e(t,e,n,s,i,r){let o;if(my(s,n)!=null)return e;{const a=new tS(s,e,i),l=e.eventCache.getNode();let c;if(Xe(n)||Ke(n)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=py(s,Ll(e));else{const d=e.serverCache.getNode();ge(d instanceof Le,"serverChildren would be complete if leaf node"),h=Jk(s,d)}h=h,c=t.filter.updateFullNode(l,h,r)}else{const h=Ke(n);let d=eS(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?c=t.filter.updateChild(l,h,d,St(n),a,r):e.eventCache.getNode().hasChild(h)?c=t.filter.updateChild(l,h,Le.EMPTY_NODE,St(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=py(s,Ll(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||my(s,ht())!=null,ed(e,c,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1e{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new Kk(s.getIndex()),r=Lbe(s);this.processor_=u1e(r);const o=n.serverCache,a=n.eventCache,l=i.updateFullNode(Le.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(Le.EMPTY_NODE,a.getNode(),null),h=new Ol(l,o.isFullyInitialized(),i.filtersNodes()),d=new Ol(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=kx(d,h),this.eventGenerator_=new Gbe(this.query_)}get query(){return this.query_}}function x1e(t){return t.viewCache_.serverCache.getNode()}function _1e(t,e){const n=Ll(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Xe(e)&&!n.getImmediateChild(Ke(e)).isEmpty())?n.getChild(e):null}function M$(t){return t.eventRegistrations_.length===0}function w1e(t,e){t.eventRegistrations_.push(e)}function z$(t,e,n){const s=[];if(n){ge(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(n,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){const o=t.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return s}function B$(t,e,n,s){e.type===Ui.MERGE&&e.source.queryId!==null&&(ge(Ll(t.viewCache_),"We should always have a full cache before handling merges"),ge(mb(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=d1e(t.processor_,i,e,n,s);return h1e(t.processor_,r.viewCache),ge(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,T4(t,r.changes,r.viewCache.eventCache.getNode(),null)}function b1e(t,e){const n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Vt,(r,o)=>{s.push(xu(r,o))}),n.isFullyInitialized()&&s.push(g4(n.getNode())),T4(t,s,n.getNode(),e)}function T4(t,e,n,s){const i=s?[s]:t.eventRegistrations_;return jbe(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yy;class C1e{constructor(){this.views=new Map}}function I1e(t){ge(!yy,"__referenceConstructor has already been defined"),yy=t}function k1e(){return ge(yy,"Reference.ts has not been loaded"),yy}function S1e(t){return t.views.size===0}function nS(t,e,n,s){const i=e.source.queryId;if(i!==null){const r=t.views.get(i);return ge(r!=null,"SyncTree gave us an op for an invalid query."),B$(r,e,n,s)}else{let r=[];for(const o of t.views.values())r=r.concat(B$(o,e,n,s));return r}}function T1e(t,e,n,s,i){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=py(n,i?s:null),l=!1;a?l=!0:s instanceof Le?(a=Jk(n,s),l=!1):(a=Le.EMPTY_NODE,l=!1);const c=kx(new Ol(a,l,!1),new Ol(s,i,!1));return new v1e(e,c)}return o}function E1e(t,e,n,s,i,r){const o=T1e(t,e,s,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),w1e(o,n),b1e(o,n)}function N1e(t,e,n,s){const i=e._queryIdentifier,r=[];let o=[];const a=ca(t);if(i==="default")for(const[l,c]of t.views.entries())o=o.concat(z$(c,n,s)),M$(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=t.views.get(i);l&&(o=o.concat(z$(l,n,s)),M$(l)&&(t.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ca(t)&&r.push(new(k1e())(e._repo,e._path)),{removed:r,events:o}}function E4(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Yc(t,e){let n=null;for(const s of t.views.values())n=n||_1e(s,e);return n}function N4(t,e){if(e._queryParams.loadsAllData())return Sx(t);{const s=e._queryIdentifier;return t.views.get(s)}}function $4(t,e){return N4(t,e)!=null}function ca(t){return Sx(t)!=null}function Sx(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vy;function $1e(t){ge(!vy,"__referenceConstructor has already been defined"),vy=t}function R1e(){return ge(vy,"Reference.ts has not been loaded"),vy}let A1e=1;class U${constructor(e){this.listenProvider_=e,this.syncPointTree_=new Dt(null),this.pendingWriteTree_=o1e(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function R4(t,e,n,s,i){return Xbe(t.pendingWriteTree_,e,n,s,i),i?Tp(t,new Pl(v4(),e,n)):[]}function nl(t,e,n=!1){const s=Zbe(t.pendingWriteTree_,e);if(Ybe(t.pendingWriteTree_,e)){let r=new Dt(null);return s.snap!=null?r=r.set(ht(),!0):Ls(s.children,o=>{r=r.set(new wt(o),!0)}),Tp(t,new fy(s.path,r,n))}else return[]}function Tx(t,e,n){return Tp(t,new Pl(Zk(),e,n))}function D1e(t,e,n){const s=Dt.fromObject(n);return Tp(t,new jd(Zk(),e,s))}function P1e(t,e){return Tp(t,new Gd(Zk(),e))}function O1e(t,e,n){const s=iS(t,n);if(s){const i=rS(s),r=i.path,o=i.queryId,a=Ss(r,e),l=new Gd(Yk(o),a);return oS(t,r,l)}else return[]}function _b(t,e,n,s,i=!1){const r=e._path,o=t.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||$4(o,e))){const l=N1e(o,e,n,s);S1e(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!i){const h=c.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=t.syncPointTree_.findOnPath(r,(f,m)=>ca(m));if(h&&!d){const f=t.syncPointTree_.subtree(r);if(!f.isEmpty()){const m=M1e(f);for(let g=0;g<m.length;++g){const v=m[g],_=v.query,x=P4(t,v);t.listenProvider_.startListening(nd(_),xy(t,_),x.hashFn,x.onComplete)}}}!d&&c.length>0&&!s&&(h?t.listenProvider_.stopListening(nd(e),null):c.forEach(f=>{const m=t.queryToTagMap.get(Ex(f));t.listenProvider_.stopListening(nd(f),m)}))}z1e(t,c)}return a}function L1e(t,e,n,s){const i=iS(t,s);if(i!=null){const r=rS(i),o=r.path,a=r.queryId,l=Ss(o,e),c=new Pl(Yk(a),l,n);return oS(t,o,c)}else return[]}function F1e(t,e,n,s){const i=iS(t,s);if(i){const r=rS(i),o=r.path,a=r.queryId,l=Ss(o,e),c=Dt.fromObject(n),h=new jd(Yk(a),l,c);return oS(t,o,h)}else return[]}function W$(t,e,n,s=!1){const i=e._path;let r=null,o=!1;t.syncPointTree_.foreachOnPath(i,(f,m)=>{const g=Ss(f,i);r=r||Yc(m,g),o=o||ca(m)});let a=t.syncPointTree_.get(i);a?(o=o||ca(a),r=r||Yc(a,ht())):(a=new C1e,t.syncPointTree_=t.syncPointTree_.set(i,a));let l;r!=null?l=!0:(l=!1,r=Le.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((m,g)=>{const v=Yc(g,ht());v&&(r=r.updateImmediateChild(m,v))}));const c=$4(a,e);if(!c&&!e._queryParams.loadsAllData()){const f=Ex(e);ge(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=B1e();t.queryToTagMap.set(f,m),t.tagToQueryMap.set(m,f)}const h=Qk(t.pendingWriteTree_,i);let d=E1e(a,e,n,h,r,l);if(!c&&!o&&!s){const f=N4(a,e);d=d.concat(U1e(t,e,f))}return d}function sS(t,e,n){const i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=Ss(o,e),c=Yc(a,l);if(c)return c});return b4(i,e,r,n,!0)}function Tp(t,e){return A4(e,t.syncPointTree_,null,Qk(t.pendingWriteTree_,ht()))}function A4(t,e,n,s){if(Xe(t.path))return D4(t,e,n,s);{const i=e.get(ht());n==null&&i!=null&&(n=Yc(i,ht()));let r=[];const o=Ke(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,h=C4(s,o);r=r.concat(A4(a,l,c,h))}return i&&(r=r.concat(nS(i,t,s,n))),r}}function D4(t,e,n,s){const i=e.get(ht());n==null&&i!=null&&(n=Yc(i,ht()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=C4(s,o),h=t.operationForChild(o);h&&(r=r.concat(D4(h,a,l,c)))}),i&&(r=r.concat(nS(i,t,s,n))),r}function P4(t,e){const n=e.query,s=xy(t,n);return{hashFn:()=>(x1e(e)||Le.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?O1e(t,n._path,s):P1e(t,n._path);{const r=F0e(i,n);return _b(t,n,null,r)}}}}function xy(t,e){const n=Ex(e);return t.queryToTagMap.get(n)}function Ex(t){return t._path.toString()+"$"+t._queryIdentifier}function iS(t,e){return t.tagToQueryMap.get(e)}function rS(t){const e=t.indexOf("$");return ge(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new wt(t.substr(0,e))}}function oS(t,e,n){const s=t.syncPointTree_.get(e);ge(s,"Missing sync point for query tag that we're tracking");const i=Qk(t.pendingWriteTree_,e);return nS(s,n,i,null)}function M1e(t){return t.fold((e,n,s)=>{if(n&&ca(n))return[Sx(n)];{let i=[];return n&&(i=E4(n)),Ls(s,(r,o)=>{i=i.concat(o)}),i}})}function nd(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(R1e())(t._repo,t._path):t}function z1e(t,e){for(let n=0;n<e.length;++n){const s=e[n];if(!s._queryParams.loadsAllData()){const i=Ex(s),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function B1e(){return A1e++}function U1e(t,e,n){const s=e._path,i=xy(t,e),r=P4(t,n),o=t.listenProvider_.startListening(nd(e),i,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(s);if(i)ge(!ca(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,d)=>{if(!Xe(c)&&h&&ca(h))return[Sx(h).query];{let f=[];return h&&(f=f.concat(E4(h).map(m=>m.query))),Ls(d,(m,g)=>{f=f.concat(g)}),f}});for(let c=0;c<l.length;++c){const h=l[c];t.listenProvider_.stopListening(nd(h),xy(t,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new aS(n)}node(){return this.node_}}class lS{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=wn(this.path_,e);return new lS(this.syncTree_,n)}node(){return sS(this.syncTree_,this.path_)}}const W1e=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},V$=function(t,e,n){if(!t||typeof t!="object")return t;if(ge(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return V1e(t[".sv"],e,n);if(typeof t[".sv"]=="object")return G1e(t[".sv"],e);ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},V1e=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ge(!1,"Unexpected server value: "+t)}},G1e=function(t,e,n){t.hasOwnProperty("increment")||ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&ge(!1,"Unexpected increment value: "+s);const i=e.node();if(ge(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},j1e=function(t,e,n,s){return cS(e,new lS(n,t),s)},O4=function(t,e,n){return cS(t,new aS(e),n)};function cS(t,e,n){const s=t.getPriority().val(),i=V$(s,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const o=t,a=V$(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new Sn(a,zn(i)):t}else{const o=t;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new Sn(i))),o.forEachChild(Vt,(a,l)=>{const c=cS(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uS{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}}function hS(t,e){let n=e instanceof wt?e:new wt(e),s=t,i=Ke(n);for(;i!==null;){const r=ru(s.node.children,i)||{children:{},childCount:0};s=new uS(i,s,r),n=St(n),i=Ke(n)}return s}function Ku(t){return t.node.value}function L4(t,e){t.node.value=e,wb(t)}function F4(t){return t.node.childCount>0}function H1e(t){return Ku(t)===void 0&&!F4(t)}function Nx(t,e){Ls(t.node.children,(n,s)=>{e(new uS(n,t,s))})}function M4(t,e,n,s){n&&e(t),Nx(t,i=>{M4(i,e,!0)})}function q1e(t,e,n){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Ep(t){return new wt(t.parent===null?t.name:Ep(t.parent)+"/"+t.name)}function wb(t){t.parent!==null&&K1e(t.parent,t.name,t)}function K1e(t,e,n){const s=H1e(n),i=Pr(t.node.children,e);s&&i?(delete t.node.children[e],t.node.childCount--,wb(t)):!s&&!i&&(t.node.children[e]=n.node,t.node.childCount++,wb(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1e=/[\[\].#$\/\u0000-\u001F\u007F]/,Z1e=/[\[\].#$\u0000-\u001F\u007F]/,pw=10*1024*1024,z4=function(t){return typeof t=="string"&&t.length!==0&&!X1e.test(t)},B4=function(t){return typeof t=="string"&&t.length!==0&&!Z1e.test(t)},Y1e=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),B4(t)},G$=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!zk(t)||t&&typeof t=="object"&&Pr(t,".sv")},U4=function(t,e,n,s){s&&e===void 0||dS(C1(t,"value"),e,n)},dS=function(t,e,n){const s=n instanceof wt?new gbe(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Ga(s));if(typeof e=="function")throw new Error(t+"contains a function "+Ga(s)+" with contents = "+e.toString());if(zk(e))throw new Error(t+"contains "+e.toString()+" "+Ga(s));if(typeof e=="string"&&e.length>pw/3&&By(e)>pw)throw new Error(t+"contains a string greater than "+pw+" utf8 bytes "+Ga(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(Ls(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!z4(o)))throw new Error(t+" contains an invalid key ("+o+") "+Ga(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);ybe(s,o),dS(t,a,s),vbe(s)}),i&&r)throw new Error(t+' contains ".value" child '+Ga(s)+" in addition to actual children.")}},fS=function(t,e,n,s){if(!B4(n))throw new Error(C1(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Q1e=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),fS(t,e,n)},W4=function(t,e){if(Ke(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},J1e=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!z4(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Y1e(n))throw new Error(C1(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eCe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function pS(t,e){let n=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();n!==null&&!Gk(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(i)}n&&t.eventLists_.push(n)}function V4(t,e,n){pS(t,n),G4(t,s=>Gk(s,e))}function ho(t,e,n){pS(t,n),G4(t,s=>Bi(s,e)||Bi(e,s))}function G4(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){const i=t.eventLists_[s];if(i){const r=i.path;e(r)?(tCe(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function tCe(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const s=n.getEventRunner();Qh&&es("event: "+n.toString()),qu(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nCe="repo_interrupt",sCe=25;class iCe{constructor(e,n,s,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new eCe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=dy(),this.transactionQueueTree_=new uS,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rCe(t,e,n){if(t.stats_=Wk(t.repoInfo_),t.forceRestClient_||U0e())t.server_=new hy(t.repoInfo_,(s,i,r,o)=>{j$(t,s,i,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>H$(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Nn(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Jr(t.repoInfo_,e,(s,i,r,o)=>{j$(t,s,i,r,o)},s=>{H$(t,s)},s=>{oCe(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=H0e(t.repoInfo_,()=>new Vbe(t.stats_,t.server_)),t.infoData_=new Mbe,t.infoSyncTree_=new U$({startListening:(s,i,r,o)=>{let a=[];const l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=Tx(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),gS(t,"connected",!1),t.serverSyncTree_=new U$({startListening:(s,i,r,o)=>(t.server_.listen(s,r,i,(a,l)=>{const c=o(a,l);ho(t.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{t.server_.unlisten(s,i)}})}function j4(t){const n=t.infoData_.getNode(new wt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function mS(t){return W1e({timestamp:j4(t)})}function j$(t,e,n,s,i){t.dataUpdateCount++;const r=new wt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(s){const l=Cg(n,c=>zn(c));o=F1e(t.serverSyncTree_,r,l,i)}else{const l=zn(n);o=L1e(t.serverSyncTree_,r,l,i)}else if(s){const l=Cg(n,c=>zn(c));o=D1e(t.serverSyncTree_,r,l)}else{const l=zn(n);o=Tx(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=$x(t,r)),ho(t.eventQueue_,a,o)}function H$(t,e){gS(t,"connected",e),e===!1&&lCe(t)}function oCe(t,e){Ls(e,(n,s)=>{gS(t,n,s)})}function gS(t,e,n){const s=new wt("/.info/"+e),i=zn(n);t.infoData_.updateSnapshot(s,i);const r=Tx(t.infoSyncTree_,s,i);ho(t.eventQueue_,s,r)}function H4(t){return t.nextWriteId_++}function aCe(t,e,n,s,i){yS(t,"set",{path:e.toString(),value:n,priority:s});const r=mS(t),o=zn(n,s),a=sS(t.serverSyncTree_,e),l=O4(o,a,r),c=H4(t),h=R4(t.serverSyncTree_,e,l,c,!0);pS(t.eventQueue_,h),t.server_.put(e.toString(),o.val(!0),(f,m)=>{const g=f==="ok";g||As("set at "+e+" failed: "+f);const v=nl(t.serverSyncTree_,c,!g);ho(t.eventQueue_,e,v),dCe(t,i,f,m)});const d=Y4(t,e);$x(t,d),ho(t.eventQueue_,d,[])}function lCe(t){yS(t,"onDisconnectEvents");const e=mS(t),n=dy();pb(t.onDisconnect_,ht(),(i,r)=>{const o=j1e(i,r,t.serverSyncTree_,e);y4(n,i,o)});let s=[];pb(n,ht(),(i,r)=>{s=s.concat(Tx(t.serverSyncTree_,i,r));const o=Y4(t,i);$x(t,o)}),t.onDisconnect_=dy(),ho(t.eventQueue_,ht(),s)}function cCe(t,e,n){let s;Ke(e._path)===".info"?s=W$(t.infoSyncTree_,e,n):s=W$(t.serverSyncTree_,e,n),V4(t.eventQueue_,e._path,s)}function uCe(t,e,n){let s;Ke(e._path)===".info"?s=_b(t.infoSyncTree_,e,n):s=_b(t.serverSyncTree_,e,n),V4(t.eventQueue_,e._path,s)}function hCe(t){t.persistentConnection_&&t.persistentConnection_.interrupt(nCe)}function yS(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),es(n,...e)}function dCe(t,e,n,s){e&&qu(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function q4(t,e,n){return sS(t.serverSyncTree_,e,n)||Le.EMPTY_NODE}function vS(t,e=t.transactionQueueTree_){if(e||Rx(t,e),Ku(e)){const n=X4(t,e);ge(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&fCe(t,Ep(e),n)}else F4(e)&&Nx(e,n=>{vS(t,n)})}function fCe(t,e,n){const s=n.map(c=>c.currentWriteId),i=q4(t,e,s);let r=i;const o=i.hash();for(let c=0;c<n.length;c++){const h=n[c];ge(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=Ss(e,h.path);r=r.updateChild(d,h.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{yS(t,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const d=[];for(let f=0;f<n.length;f++)n[f].status=2,h=h.concat(nl(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&d.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Rx(t,hS(t.transactionQueueTree_,e)),vS(t,t.transactionQueueTree_),ho(t.eventQueue_,e,h);for(let f=0;f<d.length;f++)qu(d[f])}else{if(c==="datastale")for(let d=0;d<n.length;d++)n[d].status===3?n[d].status=4:n[d].status=0;else{As("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<n.length;d++)n[d].status=4,n[d].abortReason=c}$x(t,e)}},o)}function $x(t,e){const n=K4(t,e),s=Ep(n),i=X4(t,n);return pCe(t,i,s),s}function pCe(t,e,n){if(e.length===0)return;const s=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=Ss(n,l.path);let h=!1,d;if(ge(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,i=i.concat(nl(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=sCe)h=!0,d="maxretry",i=i.concat(nl(t.serverSyncTree_,l.currentWriteId,!0));else{const f=q4(t,l.path,o);l.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){dS("transaction failed: Data returned ",m,l.path);let g=zn(m);typeof m=="object"&&m!=null&&Pr(m,".priority")||(g=g.updatePriority(f.getPriority()));const _=l.currentWriteId,x=mS(t),w=O4(g,f,x);l.currentOutputSnapshotRaw=g,l.currentOutputSnapshotResolved=w,l.currentWriteId=H4(t),o.splice(o.indexOf(_),1),i=i.concat(R4(t.serverSyncTree_,l.path,w,l.currentWriteId,l.applyLocally)),i=i.concat(nl(t.serverSyncTree_,_,!0))}else h=!0,d="nodata",i=i.concat(nl(t.serverSyncTree_,l.currentWriteId,!0))}ho(t.eventQueue_,n,i),i=[],h&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}Rx(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)qu(s[a]);vS(t,t.transactionQueueTree_)}function K4(t,e){let n,s=t.transactionQueueTree_;for(n=Ke(e);n!==null&&Ku(s)===void 0;)s=hS(s,n),e=St(e),n=Ke(e);return s}function X4(t,e){const n=[];return Z4(t,e,n),n.sort((s,i)=>s.order-i.order),n}function Z4(t,e,n){const s=Ku(e);if(s)for(let i=0;i<s.length;i++)n.push(s[i]);Nx(e,i=>{Z4(t,i,n)})}function Rx(t,e){const n=Ku(e);if(n){let s=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[s]=n[i],s++);n.length=s,L4(e,n.length>0?n:void 0)}Nx(e,s=>{Rx(t,s)})}function Y4(t,e){const n=Ep(K4(t,e)),s=hS(t.transactionQueueTree_,e);return q1e(s,i=>{mw(t,i)}),mw(t,s),M4(s,i=>{mw(t,i)}),n}function mw(t,e){const n=Ku(e);if(n){const s=[];let i=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ge(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(ge(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(nl(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?L4(e,void 0):n.length=r+1,ho(t.eventQueue_,Ep(e),i);for(let o=0;o<s.length;o++)qu(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mCe(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let i=n[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function gCe(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):As(`Invalid query segment '${n}' in query '${t}'`)}return e}const q$=function(t,e){const n=yCe(t),s=n.namespace;n.domain==="firebase.com"&&uo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&uo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||A0e();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new YB(n.host,n.secure,s,i,e,"",s!==n.subdomain),path:new wt(n.pathString)}},yCe=function(t){let e="",n="",s="",i="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let h=t.indexOf("/");h===-1&&(h=t.length);let d=t.indexOf("?");d===-1&&(d=t.length),e=t.substring(0,Math.min(h,d)),h<d&&(i=mCe(t.substring(h,d)));const f=gCe(t.substring(Math.min(t.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const m=e.slice(0,c);if(m.toLowerCase()==="localhost")n="localhost";else if(m.split(".").length<=2)n=m;else{const g=e.indexOf(".");s=e.substring(0,g).toLowerCase(),n=e.substring(g+1),r=s}"ns"in f&&(r=f.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K$="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",vCe=function(){let t=0;const e=[];return function(n){const s=n===t;t=n;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=K$.charAt(n%64),n=Math.floor(n/64);ge(n===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=K$.charAt(e[i]);return ge(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xCe{constructor(e,n,s,i){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Nn(this.snapshot.exportVal())}}class _Ce{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wCe{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ge(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(e,n,s,i){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=i}get key(){return Xe(this._path)?null:o4(this._path)}get ref(){return new Ta(this._repo,this._path)}get _queryIdentifier(){const e=$$(this._queryParams),n=Bk(e);return n==="{}"?"default":n}get _queryObject(){return $$(this._queryParams)}isEqual(e){if(e=Dn(e),!(e instanceof Ax))return!1;const n=this._repo===e._repo,s=Gk(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+mbe(this._path)}}function bCe(t,e){if(t._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function CCe(t){let e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ll){const s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==Dl)throw new Error(s);if(typeof e!="string")throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==aa)throw new Error(s);if(typeof n!="string")throw new Error(i)}}else if(t.getIndex()===Vt){if(e!=null&&!G$(e)||n!=null&&!G$(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ge(t.getIndex()instanceof qk||t.getIndex()===m4,"unknown index type."),e!=null&&typeof e=="object"||n!=null&&typeof n=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}class Ta extends Ax{constructor(e,n){super(e,n,new Xk,!1)}get parent(){const e=l4(this._path);return e===null?null:new Ta(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class _y{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new wt(e),s=Hd(this.ref,e);return new _y(this._node.getChild(n),s,Vt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new _y(i,Hd(this.ref,s),Vt)))}hasChild(e){const n=new wt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function X$(t,e){return t=Dn(t),t._checkNotDeleted("ref"),Hd(t._root,e)}function Hd(t,e){return t=Dn(t),Ke(t._path)===null?Q1e("child","path",e):fS("child","path",e),new Ta(t._repo,wn(t._path,e))}function ICe(t,e){t=Dn(t),W4("push",t._path),U4("push",e,t._path,!0);const n=j4(t._repo),s=vCe(n),i=Hd(t,s),r=Hd(t,s);let o;return e!=null?o=kCe(r,e).then(()=>r):o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function kCe(t,e){t=Dn(t),W4("set",t._path),U4("set",e,t._path,!1);const n=new zy;return aCe(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}class xS{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const s=n._queryParams.getIndex();return new xCe("value",this,new _y(e.snapshotNode,new Ta(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new _Ce(this,e,n):null}matches(e){return e instanceof xS?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function SCe(t,e,n,s,i){const r=new wCe(n,void 0),o=new xS(r);return cCe(t._repo,t,o),()=>uCe(t._repo,t,o)}function TCe(t,e,n,s){return SCe(t,"value",e)}class ECe{}class NCe extends ECe{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){bCe(e,"orderByChild");const n=new wt(this._path);if(Xe(n))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const s=new qk(n),i=Fbe(e._queryParams,s);return CCe(i),new Ax(e._repo,e._path,i,!0)}}function $Ce(t){return fS("orderByChild","path",t),new NCe(t)}function RCe(t,...e){let n=Dn(t);for(const s of e)n=s._apply(n);return n}I1e(Ta);$1e(Ta);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ACe="FIREBASE_DATABASE_EMULATOR_HOST",bb={};let DCe=!1;function PCe(t,e,n,s){t.repoInfo_=new YB(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function OCe(t,e,n,s,i){let r=s||t.options.databaseURL;r===void 0&&(t.options.projectId||uo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),es("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=q$(r,i),a=o.repoInfo,l;typeof process<"u"&&d$&&(l=d$[ACe]),l?(r=`http://${l}?ns=${a.namespace}`,o=q$(r,i),a=o.repoInfo):o.repoInfo.secure;const c=new V0e(t.name,t.options,e);J1e("Invalid Firebase Database URL",o),Xe(o.path)||uo("Database URL must point to the root of a Firebase Database (not including a child path).");const h=FCe(a,t,c,new W0e(t.name,n));return new MCe(h,t)}function LCe(t,e){const n=bb[e];(!n||n[t.key]!==t)&&uo(`Database ${e}(${t.repoInfo_}) has already been deleted.`),hCe(t),delete n[t.key]}function FCe(t,e,n,s){let i=bb[e.name];i||(i={},bb[e.name]=i);let r=i[t.toURLString()];return r&&uo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new iCe(t,DCe,n,s),i[t.toURLString()]=r,r}class MCe{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(rCe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ta(this._repo,ht())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LCe(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&uo("Cannot call "+e+" on a deleted database.")}}function zCe(t=Wy(),e){const n=Wl(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const s=pH("database");s&&BCe(n,...s)}return n}function BCe(t,e,n,s={}){t=Dn(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&uo("Cannot call useEmulator() after instance has already been initialized.");const i=t._repoInternal;let r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&uo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Hm(Hm.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:mH(s.mockUserToken,t.app.options.projectId);r=new Hm(o)}PCe(i,e,n,r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UCe(t){S0e(Tu),Tr(new Xi("database",(e,{instanceIdentifier:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return OCe(s,i,r,n)},"PUBLIC").setMultipleInstances(!0)),gi(f$,p$,t),gi(f$,p$,"esm2017")}Jr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Jr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};UCe();const WCe={apiKey:"AIzaSyAsKLxAzdt_Wf3CyoUCE4izrSdNh50SLto",authDomain:"firstaid-ai-4a1fd.firebaseapp.com",projectId:"firstaid-ai-4a1fd",storageBucket:"firstaid-ai-4a1fd.firebasestorage.app",messagingSenderId:"407902398252",appId:"1:407902398252:web:a51757f1b013738eb2ae89",measurementId:"G-G8DVPBMB94"},VCe=R6().length?Wy():k1(WCe),Z$=zCe(VCe),Q4=ie.createContext(null);function GCe({children:t}){const e=async({text:s,type:i})=>{try{console.log(" Sending message:",{text:s,type:i});const r=X$(Z$,"chats"),o=await ICe(r,{text:s,type:i,timestamp:Date.now()});return console.log(" Message sent successfully!",o.key),o.key}catch(r){throw console.error(" Error sending message:",r),r}},n=s=>{const i=X$(Z$,"chats"),r=RCe(i,$Ce("timestamp"));return TCe(r,o=>{const a=[];o.forEach(l=>{a.push({id:l.key,...l.val()})}),console.log(" Received messages from Firebase:",a),s(a)})};return A.jsx(Q4.Provider,{value:{sendMessage:e,subscribeToMessages:n},children:t})}function jCe(){const t=ie.useContext(Q4);if(!t)throw new Error("useFirebase must be used within a FirebaseProvider");return t}const HCe={bleeding:{steps:["Apply direct pressure to the wound with a clean cloth","Keep the injured area elevated above the heart if possible","Apply a sterile bandage","Seek medical attention if bleeding is severe or doesn't stop"],warning:"For severe bleeding, call emergency services immediately"},burn:{steps:["Cool the burn under cool (not cold) running water for 10-20 minutes","Remove any jewelry or tight items from the burned area","Cover with a sterile gauze bandage","Do not apply ice, butter, or oils to the burn"],warning:"Seek medical attention for severe or chemical burns"},choking:{steps:["Encourage coughing if the person can breathe","Perform back blows if coughing doesn't help","Perform abdominal thrusts (Heimlich maneuver) if back blows don't work","Call emergency services if the person loses consciousness"],warning:"This is a medical emergency - call for help if the person cannot breathe"},fracture:{steps:["Keep the injured area still and immobilized","Apply a cold compress to reduce swelling","Do not attempt to realign the bone or joint","Seek immediate medical attention","If possible, support the injured area during transport"],warning:"Do not move the person if you suspect a serious injury to the head, neck, or spine"},heatExhaustion:{steps:["Move the person to a cool, shaded area","Loosen tight clothing","Apply cool, wet cloths to the skin","Provide small sips of cool water if the person is conscious","Use fans to help lower body temperature"],warning:"If symptoms worsen or the person becomes unresponsive, call emergency services immediately"},anaphylaxis:{steps:["Call emergency services immediately","Help the person use their epinephrine auto-injector if available","Have the person lie down with legs elevated","Loosen tight clothing","Monitor breathing and perform CPR if necessary"],warning:"Anaphylaxis is a life-threatening emergency that requires immediate medical attention"},shock:{steps:["Call emergency services immediately","Lay the person down on their back","Elevate legs about 12 inches if no head, neck, or back injuries are suspected","Keep the person warm with a blanket","Do not give anything to drink"],warning:"Shock can be life-threatening - professional medical help is crucial"},noseBleed:{steps:["Sit upright and lean slightly forward","Pinch the soft part of the nose just below the bony bridge","Breathe through the mouth and hold pressure for 10-15 minutes","Apply a cold compress to the bridge of the nose","Avoid lying down or tilting the head back"],warning:"Seek medical attention if bleeding is severe or doesn't stop after 30 minutes"},poisoning:{steps:["Call poison control or emergency services immediately","Do not induce vomiting unless instructed by a professional","If the person is unconscious, check for breathing and prepare to perform CPR","Collect information about the poison for medical professionals"],warning:"Poisoning can be extremely dangerous - always seek professional medical advice"},seizure:{steps:["Keep the person safe from further injury","Do not restrain the person","Remove any nearby objects that could cause harm","Place the person on their side if possible","Time the seizure if you can"],warning:"Call emergency services if the seizure lasts longer than 5 minutes or the person doesn't regain consciousness"},heartAttack:{steps:["Call emergency services immediately","Help the person sit in a comfortable position","Loosen any tight clothing","If the person is not allergic and emergency services agree, give one adult aspirin","Prepare to perform CPR if the person becomes unresponsive"],warning:"Every minute counts during a heart attack - immediate medical attention is critical"},stroke:{steps:["Remember FAST: Face drooping, Arm weakness, Speech difficulty, Time to call emergency services","Note the time symptoms started","Help the person sit or lie down","Do not give them anything to eat or drink","Monitor breathing and consciousness"],warning:"Stroke is a medical emergency - rapid response can minimize brain damage"},hypothermia:{steps:["Move the person to a warm area","Remove wet clothing","Warm the core of the body first (chest, neck, head)","Use warm blankets or body heat","Provide warm (not hot) beverages if the person is conscious"],warning:"Severe hypothermia is life-threatening - seek immediate medical attention"},heatStroke:{steps:["Call emergency services immediately","Move the person to a cool area","Remove excess clothing","Apply cool, wet cloths or ice packs to skin","Do not give liquids if the person is not fully conscious"],warning:"Heat stroke can cause permanent organ damage or death if not treated quickly"},snakeBite:{steps:["Keep the person calm and still","Remove any tight clothing or jewelry near the bite","Position the bite below the level of the heart","Clean the wound gently","Do not attempt to suck out venom or apply a tourniquet"],warning:"Identify the snake if possible without risking further injury - seek immediate medical help"},concussion:{steps:["Remove the person from activity","Check for signs of serious brain injury","Apply a cold compress to reduce swelling","Monitor for confusion, dizziness, or memory problems","Avoid sleep for the first few hours if possible"],warning:"Some concussion symptoms may not appear immediately - medical evaluation is crucial"},electricShock:{steps:["Ensure personal safety first - do not touch the person if they are still in contact with electrical source","Turn off power source if possible","Call emergency services","Check for breathing and pulse","Treat for burns and prepare to perform CPR if necessary"],warning:"Electrical injuries can cause internal damage not visible externally"},diabeticEmergency:{steps:["If the person is conscious and can swallow, give them sugary food or drink","If they are unconscious, do not try to give anything by mouth","Place the person on their side","Call emergency services","Monitor breathing and be prepared to perform CPR"],warning:"Diabetic emergencies can quickly become life-threatening"},waterRescue:{steps:["Do not enter the water unless you are trained in water rescue","Call emergency services","Try to reach the person with a long object","If possible, throw a flotation device","Keep visual contact with the person"],warning:"Drowning can occur quickly and silently - immediate professional help is critical"},severeAllergicReaction:{steps:["Identify and remove the allergen if possible","Help the person use their epinephrine auto-injector","Lay the person flat with legs elevated","Loosen tight clothing","Monitor breathing and be prepared to perform CPR"],warning:"Severe allergic reactions can rapidly lead to anaphylactic shock"}};function qCe(t){if(t=t.toLowerCase(),t.includes("emergency")||t.includes("dying")||t.includes("unconscious")||t.includes("not breathing"))return" EMERGENCY: Call emergency services immediately (911 or your local emergency number). This situation requires immediate professional medical attention.";const e=[{keywords:["bleeding","blood","cut"],topic:"bleeding"},{keywords:["burn","scalded","hot"],topic:"burn"},{keywords:["choking","can't breathe","heimlich"],topic:"choking"},{keywords:["fracture","broken","bone"],topic:"fracture"},{keywords:["heat","exhaustion","overheated"],topic:"heatExhaustion"},{keywords:["allergic","reaction","swelling","breathing"],topic:"anaphylaxis"},{keywords:["shock","pale","weak"],topic:"shock"},{keywords:["nosebleed","nose bleed"],topic:"noseBleed"},{keywords:["poison","ingested"],topic:"poisoning"},{keywords:["seizure","convulsing"],topic:"seizure"},{keywords:["heart attack","chest pain","heart pain"],topic:"heartAttack"},{keywords:["stroke","drooping","speech"],topic:"stroke"},{keywords:["cold","freezing","hypothermia"],topic:"hypothermia"},{keywords:["heat stroke","overheating"],topic:"heatStroke"},{keywords:["snake bite","snake"],topic:"snakeBite"},{keywords:["concussion","head injury"],topic:"concussion"},{keywords:["electric shock","electrocution"],topic:"electricShock"},{keywords:["diabetes","sugar","diabetic"],topic:"diabeticEmergency"},{keywords:["drowning","water rescue"],topic:"waterRescue"},{keywords:["severe allergy","anaphylaxis"],topic:"severeAllergicReaction"}];for(const n of e)if(n.keywords.some(s=>t.includes(s)))return KCe(HCe[n.topic]);return t.includes("help")||t.includes("hi")||t.includes("hello")?"Hello! I'm FirstAid.AI, your first aid assistant. I can provide guidance for common first aid situations. What kind of help do you need?":"I'm not sure about that specific situation. Please try to describe the emergency or injury more specifically, or in case of serious emergency, contact professional medical services immediately."}function KCe(t){let e=`Here's what you should do:

`;return t.steps.forEach((n,s)=>{e+=`${s+1}. ${n}
`}),e+=`
 IMPORTANT: ${t.warning}`,e}function XCe(){const[t,e]=ie.useState(""),[n,s]=ie.useState([]),[i,r]=ie.useState(!1),[o,a]=ie.useState(null),{sendMessage:l,subscribeToMessages:c}=jCe(),{user:h}=B1(),d=ie.useRef(null);ie.useEffect(()=>{if(!h)return;console.log(" Subscribing to messages...");const m=c(g=>{s(g)});return()=>{console.log(" Unsubscribing from messages..."),m&&m()}},[h,c]),ie.useEffect(()=>{var m;(m=d.current)==null||m.scrollIntoView({behavior:"smooth"})},[n]);const f=async m=>{if(m.preventDefault(),!(!t.trim()||!h)){a(null),r(!0);try{await l({text:t.trim(),type:"user"});const g=qCe(t.trim());e(""),await new Promise(v=>setTimeout(v,1e3)),await l({text:g,type:"ai"})}catch(g){console.error("Error in chat:",g),a("Failed to send message. Please try again.")}finally{r(!1)}}};return h?A.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:A.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[A.jsxs("div",{className:"p-4 bg-red-500 text-white",children:[A.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[A.jsx(ID,{}),"FirstAid.AI Emergency Assistant"]}),A.jsx("p",{className:"text-sm mt-1 opacity-90",children:"For life-threatening emergencies, always call emergency services first!"})]}),A.jsxs("div",{className:"h-[60vh] overflow-y-auto p-4 space-y-4 bg-gray-50",children:[o&&A.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:o}),n.map(m=>A.jsx("div",{className:`flex ${m.type==="user"?"justify-end":"justify-start"}`,children:A.jsxs("div",{className:`max-w-[80%] rounded-lg p-4 ${m.type==="user"?"bg-blue-500 text-white":"bg-white shadow-md text-gray-800"}`,children:[A.jsx("div",{className:"text-sm opacity-75 mb-1",children:m.type==="user"?"You":"FirstAid.AI"}),A.jsx("div",{className:"whitespace-pre-line",children:m.text})]})},m.id)),i&&A.jsx("div",{className:"flex justify-start",children:A.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 max-w-[80%]",children:[A.jsx("div",{className:"text-sm opacity-75 mb-1",children:"FirstAid.AI"}),A.jsxs("div",{className:"flex gap-1",children:[A.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),A.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:0.2s]"}),A.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:0.4s]"})]})]})}),A.jsx("div",{ref:d})]}),A.jsx("form",{onSubmit:f,className:"p-4 border-t bg-white",children:A.jsxs("div",{className:"flex gap-2",children:[A.jsx("input",{type:"text",value:t,onChange:m=>e(m.target.value),placeholder:"Describe the emergency or ask for first aid advice...",className:"flex-1 rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:i}),A.jsx("button",{type:"submit",disabled:i||!t.trim(),className:"bg-red-500 text-white rounded-lg px-4 py-2 hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:A.jsx(nH,{size:20})})]})})]})}):A.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-4rem)]",children:A.jsxs("div",{className:"text-center",children:[A.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Please Login"}),A.jsx("p",{className:"text-gray-600",children:"You need to be logged in to use the chat."})]})})}function ZCe(){const[t,e]=ie.useState(""),[n,s]=ie.useState(""),[i,r]=ie.useState(!1),[o,a]=ie.useState(""),[l,c]=ie.useState(!1),h=_D(),{signIn:d,signUp:f}=B1(),m=async g=>{g.preventDefault(),a(""),c(!0);try{i?await f(t,n):await d(t,n),h("/")}catch(v){a(v.message)}finally{c(!1)}};return A.jsx("div",{className:"min-h-[calc(100vh-4rem)] flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:A.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-xl shadow-lg",children:[A.jsx("div",{children:A.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:i?"Create your account":"Sign in to your account"})}),o&&A.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:A.jsxs("div",{className:"flex",children:[A.jsx(h0,{className:"text-red-500 mr-2 flex-shrink-0"}),A.jsx("p",{className:"text-sm text-red-700",children:o})]})}),A.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[A.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),A.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:g=>e(g.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-red-500 focus:border-red-500 focus:z-10 sm:text-sm",placeholder:"Email address"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),A.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:n,onChange:g=>s(g.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-red-500 focus:border-red-500 focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),A.jsx("div",{children:A.jsxs("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-red-300",children:[l?A.jsx("span",{className:"absolute left-0 inset-y-0 flex items-center pl-3",children:A.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"})}):i?A.jsx(iH,{className:"absolute left-0 inset-y-0 flex items-center pl-3 h-5 w-5"}):A.jsx(Zj,{className:"absolute left-0 inset-y-0 flex items-center pl-3 h-5 w-5"}),i?"Sign up":"Sign in"]})}),A.jsx("div",{className:"text-center",children:A.jsx("button",{type:"button",onClick:()=>r(!i),className:"text-sm text-red-600 hover:text-red-500",children:i?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})})}function YCe(){return A.jsx(GCe,{children:A.jsx(C8,{children:A.jsxs(s0e,{children:[" ",A.jsx(Uj,{children:A.jsxs("div",{className:"min-h-screen bg-gray-50",children:[A.jsx(I8,{}),A.jsxs(Pj,{children:[A.jsx(Ba,{path:"/",element:A.jsx(S8,{})}),A.jsx(Ba,{path:"/first-aid",element:A.jsx(T8,{})}),A.jsx(Ba,{path:"/injury-detection",element:A.jsx(r0e,{})}),A.jsx(Ba,{path:"/nearby-hospitals",element:A.jsx(k0e,{})}),A.jsx(Ba,{path:"/chat",element:A.jsx(XCe,{})}),A.jsx(Ba,{path:"/login",element:A.jsx(ZCe,{})})]})]})})]})})})}hD(document.getElementById("root")).render(A.jsx(ie.StrictMode,{children:A.jsx(YCe,{})}));
