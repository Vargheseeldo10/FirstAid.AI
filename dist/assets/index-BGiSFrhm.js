function tR(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var ua=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _W(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}),n}var nR={exports:{}},by={},sR={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kd=Symbol.for("react.element"),wW=Symbol.for("react.portal"),bW=Symbol.for("react.fragment"),CW=Symbol.for("react.strict_mode"),IW=Symbol.for("react.profiler"),kW=Symbol.for("react.provider"),SW=Symbol.for("react.context"),TW=Symbol.for("react.forward_ref"),EW=Symbol.for("react.suspense"),NW=Symbol.for("react.memo"),$W=Symbol.for("react.lazy"),CT=Symbol.iterator;function RW(t){return t===null||typeof t!="object"?null:(t=CT&&t[CT]||t["@@iterator"],typeof t=="function"?t:null)}var iR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rR=Object.assign,oR={};function wu(t,e,n){this.props=t,this.context=e,this.refs=oR,this.updater=n||iR}wu.prototype.isReactComponent={};wu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};wu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function aR(){}aR.prototype=wu.prototype;function Eb(t,e,n){this.props=t,this.context=e,this.refs=oR,this.updater=n||iR}var Nb=Eb.prototype=new aR;Nb.constructor=Eb;rR(Nb,wu.prototype);Nb.isPureReactComponent=!0;var IT=Array.isArray,lR=Object.prototype.hasOwnProperty,$b={current:null},cR={key:!0,ref:!0,__self:!0,__source:!0};function uR(t,e,n){var s,i={},r=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)lR.call(e,s)&&!cR.hasOwnProperty(s)&&(i[s]=e[s]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)i[s]===void 0&&(i[s]=a[s]);return{$$typeof:Kd,type:t,key:r,ref:o,props:i,_owner:$b.current}}function AW(t,e){return{$$typeof:Kd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Rb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Kd}function DW(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var kT=/\/+/g;function a_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?DW(""+t.key):e.toString(36)}function Nm(t,e,n,s,i){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Kd:case wW:o=!0}}if(o)return o=t,i=i(o),t=s===""?"."+a_(o,0):s,IT(i)?(n="",t!=null&&(n=t.replace(kT,"$&/")+"/"),Nm(i,e,n,"",function(c){return c})):i!=null&&(Rb(i)&&(i=AW(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(kT,"$&/")+"/")+t)),e.push(i)),1;if(o=0,s=s===""?".":s+":",IT(t))for(var a=0;a<t.length;a++){r=t[a];var l=s+a_(r,a);o+=Nm(r,e,n,l,i)}else if(l=RW(t),typeof l=="function")for(t=l.call(t),a=0;!(r=t.next()).done;)r=r.value,l=s+a_(r,a++),o+=Nm(r,e,n,l,i);else if(r==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Xp(t,e,n){if(t==null)return t;var s=[],i=0;return Nm(t,s,"","",function(r){return e.call(n,r,i++)}),s}function PW(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var gs={current:null},$m={transition:null},OW={ReactCurrentDispatcher:gs,ReactCurrentBatchConfig:$m,ReactCurrentOwner:$b};function hR(){throw Error("act(...) is not supported in production builds of React.")}Ye.Children={map:Xp,forEach:function(t,e,n){Xp(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Xp(t,function(){e++}),e},toArray:function(t){return Xp(t,function(e){return e})||[]},only:function(t){if(!Rb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ye.Component=wu;Ye.Fragment=bW;Ye.Profiler=IW;Ye.PureComponent=Eb;Ye.StrictMode=CW;Ye.Suspense=EW;Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OW;Ye.act=hR;Ye.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=rR({},t.props),i=t.key,r=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=$b.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)lR.call(e,l)&&!cR.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:Kd,type:t.type,key:i,ref:r,props:s,_owner:o}};Ye.createContext=function(t){return t={$$typeof:SW,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kW,_context:t},t.Consumer=t};Ye.createElement=uR;Ye.createFactory=function(t){var e=uR.bind(null,t);return e.type=t,e};Ye.createRef=function(){return{current:null}};Ye.forwardRef=function(t){return{$$typeof:TW,render:t}};Ye.isValidElement=Rb;Ye.lazy=function(t){return{$$typeof:$W,_payload:{_status:-1,_result:t},_init:PW}};Ye.memo=function(t,e){return{$$typeof:NW,type:t,compare:e===void 0?null:e}};Ye.startTransition=function(t){var e=$m.transition;$m.transition={};try{t()}finally{$m.transition=e}};Ye.unstable_act=hR;Ye.useCallback=function(t,e){return gs.current.useCallback(t,e)};Ye.useContext=function(t){return gs.current.useContext(t)};Ye.useDebugValue=function(){};Ye.useDeferredValue=function(t){return gs.current.useDeferredValue(t)};Ye.useEffect=function(t,e){return gs.current.useEffect(t,e)};Ye.useId=function(){return gs.current.useId()};Ye.useImperativeHandle=function(t,e,n){return gs.current.useImperativeHandle(t,e,n)};Ye.useInsertionEffect=function(t,e){return gs.current.useInsertionEffect(t,e)};Ye.useLayoutEffect=function(t,e){return gs.current.useLayoutEffect(t,e)};Ye.useMemo=function(t,e){return gs.current.useMemo(t,e)};Ye.useReducer=function(t,e,n){return gs.current.useReducer(t,e,n)};Ye.useRef=function(t){return gs.current.useRef(t)};Ye.useState=function(t){return gs.current.useState(t)};Ye.useSyncExternalStore=function(t,e,n){return gs.current.useSyncExternalStore(t,e,n)};Ye.useTransition=function(){return gs.current.useTransition()};Ye.version="18.3.1";sR.exports=Ye;var ne=sR.exports;const Km=Tb(ne),LW=tR({__proto__:null,default:Km},[ne]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FW=ne,MW=Symbol.for("react.element"),zW=Symbol.for("react.fragment"),BW=Object.prototype.hasOwnProperty,UW=FW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,WW={key:!0,ref:!0,__self:!0,__source:!0};function dR(t,e,n){var s,i={},r=null,o=null;n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)BW.call(e,s)&&!WW.hasOwnProperty(s)&&(i[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:MW,type:t,key:r,ref:o,props:i,_owner:UW.current}}by.Fragment=zW;by.jsx=dR;by.jsxs=dR;nR.exports=by;var A=nR.exports,fR={exports:{}},Ks={},pR={exports:{}},mR={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(O,Z){var j=O.length;O.push(Z);e:for(;0<j;){var te=j-1>>>1,ae=O[te];if(0<i(ae,Z))O[te]=Z,O[j]=ae,j=te;else break e}}function n(O){return O.length===0?null:O[0]}function s(O){if(O.length===0)return null;var Z=O[0],j=O.pop();if(j!==Z){O[0]=j;e:for(var te=0,ae=O.length,ue=ae>>>1;te<ue;){var he=2*(te+1)-1,le=O[he],ce=he+1,we=O[ce];if(0>i(le,j))ce<ae&&0>i(we,le)?(O[te]=we,O[ce]=j,te=ce):(O[te]=le,O[he]=j,te=he);else if(ce<ae&&0>i(we,j))O[te]=we,O[ce]=j,te=ce;else break e}}return Z}function i(O,Z){var j=O.sortIndex-Z.sortIndex;return j!==0?j:O.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,d=null,f=3,m=!1,g=!1,x=!1,_=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(O){for(var Z=n(c);Z!==null;){if(Z.callback===null)s(c);else if(Z.startTime<=O)s(c),Z.sortIndex=Z.expirationTime,e(l,Z);else break;Z=n(c)}}function I(O){if(x=!1,b(O),!g)if(n(l)!==null)g=!0,X(S);else{var Z=n(c);Z!==null&&oe(I,Z.startTime-O)}}function S(O,Z){g=!1,x&&(x=!1,v(E),E=-1),m=!0;var j=f;try{for(b(Z),d=n(l);d!==null&&(!(d.expirationTime>Z)||O&&!z());){var te=d.callback;if(typeof te=="function"){d.callback=null,f=d.priorityLevel;var ae=te(d.expirationTime<=Z);Z=t.unstable_now(),typeof ae=="function"?d.callback=ae:d===n(l)&&s(l),b(Z)}else s(l);d=n(l)}if(d!==null)var ue=!0;else{var he=n(c);he!==null&&oe(I,he.startTime-Z),ue=!1}return ue}finally{d=null,f=j,m=!1}}var T=!1,$=null,E=-1,D=5,P=-1;function z(){return!(t.unstable_now()-P<D)}function V(){if($!==null){var O=t.unstable_now();P=O;var Z=!0;try{Z=$(!0,O)}finally{Z?q():(T=!1,$=null)}}else T=!1}var q;if(typeof w=="function")q=function(){w(V)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,J=K.port2;K.port1.onmessage=V,q=function(){J.postMessage(null)}}else q=function(){_(V,0)};function X(O){$=O,T||(T=!0,q())}function oe(O,Z){E=_(function(){O(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,X(S))},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<O?Math.floor(1e3/O):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(O){switch(f){case 1:case 2:case 3:var Z=3;break;default:Z=f}var j=f;f=Z;try{return O()}finally{f=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(O,Z){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var j=f;f=O;try{return Z()}finally{f=j}},t.unstable_scheduleCallback=function(O,Z,j){var te=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?te+j:te):j=te,O){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=j+ae,O={id:h++,callback:Z,priorityLevel:O,startTime:j,expirationTime:ae,sortIndex:-1},j>te?(O.sortIndex=j,e(c,O),n(l)===null&&O===n(c)&&(x?(v(E),E=-1):x=!0,oe(I,j-te))):(O.sortIndex=ae,e(l,O),g||m||(g=!0,X(S))),O},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(O){var Z=f;return function(){var j=f;f=Z;try{return O.apply(this,arguments)}finally{f=j}}}})(mR);pR.exports=mR;var VW=pR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jW=ne,Hs=VW;function me(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gR=new Set,id={};function Fl(t,e){Qc(t,e),Qc(t+"Capture",e)}function Qc(t,e){for(id[t]=e,t=0;t<e.length;t++)gR.add(e[t])}var eo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_0=Object.prototype.hasOwnProperty,GW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ST={},TT={};function HW(t){return _0.call(TT,t)?!0:_0.call(ST,t)?!1:GW.test(t)?TT[t]=!0:(ST[t]=!0,!1)}function qW(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function KW(t,e,n,s){if(e===null||typeof e>"u"||qW(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ys(t,e,n,s,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Un={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Un[t]=new ys(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Un[e]=new ys(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Un[t]=new ys(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Un[t]=new ys(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Un[t]=new ys(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Un[t]=new ys(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Un[t]=new ys(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Un[t]=new ys(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Un[t]=new ys(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ab=/[\-:]([a-z])/g;function Db(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ab,Db);Un[e]=new ys(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ab,Db);Un[e]=new ys(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ab,Db);Un[e]=new ys(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Un[t]=new ys(t,1,!1,t.toLowerCase(),null,!1,!1)});Un.xlinkHref=new ys("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Un[t]=new ys(t,1,!1,t.toLowerCase(),null,!0,!0)});function Pb(t,e,n,s){var i=Un.hasOwnProperty(e)?Un[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(KW(e,n,i,s)&&(n=null),s||i===null?HW(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,s=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var fo=jW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zp=Symbol.for("react.element"),wc=Symbol.for("react.portal"),bc=Symbol.for("react.fragment"),Ob=Symbol.for("react.strict_mode"),w0=Symbol.for("react.profiler"),yR=Symbol.for("react.provider"),vR=Symbol.for("react.context"),Lb=Symbol.for("react.forward_ref"),b0=Symbol.for("react.suspense"),C0=Symbol.for("react.suspense_list"),Fb=Symbol.for("react.memo"),bo=Symbol.for("react.lazy"),xR=Symbol.for("react.offscreen"),ET=Symbol.iterator;function uh(t){return t===null||typeof t!="object"?null:(t=ET&&t[ET]||t["@@iterator"],typeof t=="function"?t:null)}var Gt=Object.assign,l_;function Th(t){if(l_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);l_=e&&e[1]||""}return`
`+l_+t}var c_=!1;function u_(t,e){if(!t||c_)return"";c_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){s=c}t.call(e.prototype)}else{try{throw Error()}catch(c){s=c}t()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),r=s.stack.split(`
`),o=i.length-1,a=r.length-1;1<=o&&0<=a&&i[o]!==r[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==r[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==r[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{c_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Th(t):""}function XW(t){switch(t.tag){case 5:return Th(t.type);case 16:return Th("Lazy");case 13:return Th("Suspense");case 19:return Th("SuspenseList");case 0:case 2:case 15:return t=u_(t.type,!1),t;case 11:return t=u_(t.type.render,!1),t;case 1:return t=u_(t.type,!0),t;default:return""}}function I0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case bc:return"Fragment";case wc:return"Portal";case w0:return"Profiler";case Ob:return"StrictMode";case b0:return"Suspense";case C0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case vR:return(t.displayName||"Context")+".Consumer";case yR:return(t._context.displayName||"Context")+".Provider";case Lb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Fb:return e=t.displayName||null,e!==null?e:I0(t.type)||"Memo";case bo:e=t._payload,t=t._init;try{return I0(t(e))}catch{}}return null}function ZW(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return I0(e);case 8:return e===Ob?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Jo(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _R(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function YW(t){var e=_R(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,r.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Yp(t){t._valueTracker||(t._valueTracker=YW(t))}function wR(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=_R(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function Xm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function k0(t,e){var n=e.checked;return Gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function NT(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Jo(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bR(t,e){e=e.checked,e!=null&&Pb(t,"checked",e,!1)}function S0(t,e){bR(t,e);var n=Jo(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?T0(t,e.type,n):e.hasOwnProperty("defaultValue")&&T0(t,e.type,Jo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function $T(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function T0(t,e,n){(e!=="number"||Xm(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Eh=Array.isArray;function Lc(t,e,n,s){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Jo(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,s&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function E0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return Gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function RT(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(me(92));if(Eh(n)){if(1<n.length)throw Error(me(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Jo(n)}}function CR(t,e){var n=Jo(e.value),s=Jo(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function AT(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function IR(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function N0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?IR(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Qp,kR=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Qp=Qp||document.createElement("div"),Qp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qp.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function rd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var zh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},QW=["Webkit","ms","Moz","O"];Object.keys(zh).forEach(function(t){QW.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),zh[e]=zh[t]})});function SR(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||zh.hasOwnProperty(t)&&zh[t]?(""+e).trim():e+"px"}function TR(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,i=SR(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,i):t[n]=i}}var JW=Gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $0(t,e){if(e){if(JW[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function R0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var A0=null;function Mb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var D0=null,Fc=null,Mc=null;function DT(t){if(t=Yd(t)){if(typeof D0!="function")throw Error(me(280));var e=t.stateNode;e&&(e=Ty(e),D0(t.stateNode,t.type,e))}}function ER(t){Fc?Mc?Mc.push(t):Mc=[t]:Fc=t}function NR(){if(Fc){var t=Fc,e=Mc;if(Mc=Fc=null,DT(t),e)for(t=0;t<e.length;t++)DT(e[t])}}function $R(t,e){return t(e)}function RR(){}var h_=!1;function AR(t,e,n){if(h_)return t(e,n);h_=!0;try{return $R(t,e,n)}finally{h_=!1,(Fc!==null||Mc!==null)&&(RR(),NR())}}function od(t,e){var n=t.stateNode;if(n===null)return null;var s=Ty(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(me(231,e,typeof n));return n}var P0=!1;if(eo)try{var hh={};Object.defineProperty(hh,"passive",{get:function(){P0=!0}}),window.addEventListener("test",hh,hh),window.removeEventListener("test",hh,hh)}catch{P0=!1}function eV(t,e,n,s,i,r,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(h){this.onError(h)}}var Bh=!1,Zm=null,Ym=!1,O0=null,tV={onError:function(t){Bh=!0,Zm=t}};function nV(t,e,n,s,i,r,o,a,l){Bh=!1,Zm=null,eV.apply(tV,arguments)}function sV(t,e,n,s,i,r,o,a,l){if(nV.apply(this,arguments),Bh){if(Bh){var c=Zm;Bh=!1,Zm=null}else throw Error(me(198));Ym||(Ym=!0,O0=c)}}function Ml(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function DR(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function PT(t){if(Ml(t)!==t)throw Error(me(188))}function iV(t){var e=t.alternate;if(!e){if(e=Ml(t),e===null)throw Error(me(188));return e!==t?null:t}for(var n=t,s=e;;){var i=n.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){n=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===n)return PT(i),t;if(r===s)return PT(i),e;r=r.sibling}throw Error(me(188))}if(n.return!==s.return)n=i,s=r;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o){for(a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o)throw Error(me(189))}}if(n.alternate!==s)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?t:e}function PR(t){return t=iV(t),t!==null?OR(t):null}function OR(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=OR(t);if(e!==null)return e;t=t.sibling}return null}var LR=Hs.unstable_scheduleCallback,OT=Hs.unstable_cancelCallback,rV=Hs.unstable_shouldYield,oV=Hs.unstable_requestPaint,tn=Hs.unstable_now,aV=Hs.unstable_getCurrentPriorityLevel,zb=Hs.unstable_ImmediatePriority,FR=Hs.unstable_UserBlockingPriority,Qm=Hs.unstable_NormalPriority,lV=Hs.unstable_LowPriority,MR=Hs.unstable_IdlePriority,Cy=null,yr=null;function cV(t){if(yr&&typeof yr.onCommitFiberRoot=="function")try{yr.onCommitFiberRoot(Cy,t,void 0,(t.current.flags&128)===128)}catch{}}var Vi=Math.clz32?Math.clz32:dV,uV=Math.log,hV=Math.LN2;function dV(t){return t>>>=0,t===0?32:31-(uV(t)/hV|0)|0}var Jp=64,em=4194304;function Nh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Jm(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,i=t.suspendedLanes,r=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?s=Nh(a):(r&=o,r!==0&&(s=Nh(r)))}else o=n&~i,o!==0?s=Nh(o):r!==0&&(s=Nh(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Vi(e),i=1<<n,s|=t[n],e&=~i;return s}function fV(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pV(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,i=t.expirationTimes,r=t.pendingLanes;0<r;){var o=31-Vi(r),a=1<<o,l=i[o];l===-1?(!(a&n)||a&s)&&(i[o]=fV(a,e)):l<=e&&(t.expiredLanes|=a),r&=~a}}function L0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function zR(){var t=Jp;return Jp<<=1,!(Jp&4194240)&&(Jp=64),t}function d_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Xd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Vi(e),t[e]=n}function mV(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Vi(n),r=1<<i;e[i]=0,s[i]=-1,t[i]=-1,n&=~r}}function Bb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Vi(n),i=1<<s;i&e|t[s]&e&&(t[s]|=e),n&=~i}}var gt=0;function BR(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var UR,Ub,WR,VR,jR,F0=!1,tm=[],Fo=null,Mo=null,zo=null,ad=new Map,ld=new Map,ko=[],gV="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function LT(t,e){switch(t){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Mo=null;break;case"mouseover":case"mouseout":zo=null;break;case"pointerover":case"pointerout":ad.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ld.delete(e.pointerId)}}function dh(t,e,n,s,i,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=Yd(e),e!==null&&Ub(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function yV(t,e,n,s,i){switch(e){case"focusin":return Fo=dh(Fo,t,e,n,s,i),!0;case"dragenter":return Mo=dh(Mo,t,e,n,s,i),!0;case"mouseover":return zo=dh(zo,t,e,n,s,i),!0;case"pointerover":var r=i.pointerId;return ad.set(r,dh(ad.get(r)||null,t,e,n,s,i)),!0;case"gotpointercapture":return r=i.pointerId,ld.set(r,dh(ld.get(r)||null,t,e,n,s,i)),!0}return!1}function GR(t){var e=Ka(t.target);if(e!==null){var n=Ml(e);if(n!==null){if(e=n.tag,e===13){if(e=DR(n),e!==null){t.blockedOn=e,jR(t.priority,function(){WR(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Rm(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=M0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);A0=s,n.target.dispatchEvent(s),A0=null}else return e=Yd(n),e!==null&&Ub(e),t.blockedOn=n,!1;e.shift()}return!0}function FT(t,e,n){Rm(t)&&n.delete(e)}function vV(){F0=!1,Fo!==null&&Rm(Fo)&&(Fo=null),Mo!==null&&Rm(Mo)&&(Mo=null),zo!==null&&Rm(zo)&&(zo=null),ad.forEach(FT),ld.forEach(FT)}function fh(t,e){t.blockedOn===e&&(t.blockedOn=null,F0||(F0=!0,Hs.unstable_scheduleCallback(Hs.unstable_NormalPriority,vV)))}function cd(t){function e(i){return fh(i,t)}if(0<tm.length){fh(tm[0],t);for(var n=1;n<tm.length;n++){var s=tm[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Fo!==null&&fh(Fo,t),Mo!==null&&fh(Mo,t),zo!==null&&fh(zo,t),ad.forEach(e),ld.forEach(e),n=0;n<ko.length;n++)s=ko[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<ko.length&&(n=ko[0],n.blockedOn===null);)GR(n),n.blockedOn===null&&ko.shift()}var zc=fo.ReactCurrentBatchConfig,eg=!0;function xV(t,e,n,s){var i=gt,r=zc.transition;zc.transition=null;try{gt=1,Wb(t,e,n,s)}finally{gt=i,zc.transition=r}}function _V(t,e,n,s){var i=gt,r=zc.transition;zc.transition=null;try{gt=4,Wb(t,e,n,s)}finally{gt=i,zc.transition=r}}function Wb(t,e,n,s){if(eg){var i=M0(t,e,n,s);if(i===null)b_(t,e,s,tg,n),LT(t,s);else if(yV(i,t,e,n,s))s.stopPropagation();else if(LT(t,s),e&4&&-1<gV.indexOf(t)){for(;i!==null;){var r=Yd(i);if(r!==null&&UR(r),r=M0(t,e,n,s),r===null&&b_(t,e,s,tg,n),r===i)break;i=r}i!==null&&s.stopPropagation()}else b_(t,e,s,null,n)}}var tg=null;function M0(t,e,n,s){if(tg=null,t=Mb(s),t=Ka(t),t!==null)if(e=Ml(t),e===null)t=null;else if(n=e.tag,n===13){if(t=DR(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return tg=t,null}function HR(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(aV()){case zb:return 1;case FR:return 4;case Qm:case lV:return 16;case MR:return 536870912;default:return 16}default:return 16}}var Ro=null,Vb=null,Am=null;function qR(){if(Am)return Am;var t,e=Vb,n=e.length,s,i="value"in Ro?Ro.value:Ro.textContent,r=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===i[r-s];s++);return Am=i.slice(t,1<s?1-s:void 0)}function Dm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function nm(){return!0}function MT(){return!1}function Xs(t){function e(n,s,i,r,o){this._reactName=n,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(r):r[a]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?nm:MT,this.isPropagationStopped=MT,this}return Gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=nm)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=nm)},persist:function(){},isPersistent:nm}),e}var bu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jb=Xs(bu),Zd=Gt({},bu,{view:0,detail:0}),wV=Xs(Zd),f_,p_,ph,Iy=Gt({},Zd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ph&&(ph&&t.type==="mousemove"?(f_=t.screenX-ph.screenX,p_=t.screenY-ph.screenY):p_=f_=0,ph=t),f_)},movementY:function(t){return"movementY"in t?t.movementY:p_}}),zT=Xs(Iy),bV=Gt({},Iy,{dataTransfer:0}),CV=Xs(bV),IV=Gt({},Zd,{relatedTarget:0}),m_=Xs(IV),kV=Gt({},bu,{animationName:0,elapsedTime:0,pseudoElement:0}),SV=Xs(kV),TV=Gt({},bu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),EV=Xs(TV),NV=Gt({},bu,{data:0}),BT=Xs(NV),$V={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DV(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=AV[t])?!!e[t]:!1}function Gb(){return DV}var PV=Gt({},Zd,{key:function(t){if(t.key){var e=$V[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Dm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?RV[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gb,charCode:function(t){return t.type==="keypress"?Dm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Dm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),OV=Xs(PV),LV=Gt({},Iy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),UT=Xs(LV),FV=Gt({},Zd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gb}),MV=Xs(FV),zV=Gt({},bu,{propertyName:0,elapsedTime:0,pseudoElement:0}),BV=Xs(zV),UV=Gt({},Iy,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),WV=Xs(UV),VV=[9,13,27,32],Hb=eo&&"CompositionEvent"in window,Uh=null;eo&&"documentMode"in document&&(Uh=document.documentMode);var jV=eo&&"TextEvent"in window&&!Uh,KR=eo&&(!Hb||Uh&&8<Uh&&11>=Uh),WT=" ",VT=!1;function XR(t,e){switch(t){case"keyup":return VV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ZR(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Cc=!1;function GV(t,e){switch(t){case"compositionend":return ZR(e);case"keypress":return e.which!==32?null:(VT=!0,WT);case"textInput":return t=e.data,t===WT&&VT?null:t;default:return null}}function HV(t,e){if(Cc)return t==="compositionend"||!Hb&&XR(t,e)?(t=qR(),Am=Vb=Ro=null,Cc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return KR&&e.locale!=="ko"?null:e.data;default:return null}}var qV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qV[t.type]:e==="textarea"}function YR(t,e,n,s){ER(s),e=ng(e,"onChange"),0<e.length&&(n=new jb("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Wh=null,ud=null;function KV(t){lA(t,0)}function ky(t){var e=Sc(t);if(wR(e))return t}function XV(t,e){if(t==="change")return e}var QR=!1;if(eo){var g_;if(eo){var y_="oninput"in document;if(!y_){var GT=document.createElement("div");GT.setAttribute("oninput","return;"),y_=typeof GT.oninput=="function"}g_=y_}else g_=!1;QR=g_&&(!document.documentMode||9<document.documentMode)}function HT(){Wh&&(Wh.detachEvent("onpropertychange",JR),ud=Wh=null)}function JR(t){if(t.propertyName==="value"&&ky(ud)){var e=[];YR(e,ud,t,Mb(t)),AR(KV,e)}}function ZV(t,e,n){t==="focusin"?(HT(),Wh=e,ud=n,Wh.attachEvent("onpropertychange",JR)):t==="focusout"&&HT()}function YV(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ky(ud)}function QV(t,e){if(t==="click")return ky(e)}function JV(t,e){if(t==="input"||t==="change")return ky(e)}function ej(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Xi=typeof Object.is=="function"?Object.is:ej;function hd(t,e){if(Xi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var i=n[s];if(!_0.call(e,i)||!Xi(t[i],e[i]))return!1}return!0}function qT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function KT(t,e){var n=qT(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=qT(n)}}function eA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?eA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function tA(){for(var t=window,e=Xm();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Xm(t.document)}return e}function qb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function tj(t){var e=tA(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&eA(n.ownerDocument.documentElement,n)){if(s!==null&&qb(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!t.extend&&r>s&&(i=s,s=r,r=i),i=KT(n,r);var o=KT(n,s);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),r>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var nj=eo&&"documentMode"in document&&11>=document.documentMode,Ic=null,z0=null,Vh=null,B0=!1;function XT(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;B0||Ic==null||Ic!==Xm(s)||(s=Ic,"selectionStart"in s&&qb(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Vh&&hd(Vh,s)||(Vh=s,s=ng(z0,"onSelect"),0<s.length&&(e=new jb("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Ic)))}function sm(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var kc={animationend:sm("Animation","AnimationEnd"),animationiteration:sm("Animation","AnimationIteration"),animationstart:sm("Animation","AnimationStart"),transitionend:sm("Transition","TransitionEnd")},v_={},nA={};eo&&(nA=document.createElement("div").style,"AnimationEvent"in window||(delete kc.animationend.animation,delete kc.animationiteration.animation,delete kc.animationstart.animation),"TransitionEvent"in window||delete kc.transitionend.transition);function Sy(t){if(v_[t])return v_[t];if(!kc[t])return t;var e=kc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in nA)return v_[t]=e[n];return t}var sA=Sy("animationend"),iA=Sy("animationiteration"),rA=Sy("animationstart"),oA=Sy("transitionend"),aA=new Map,ZT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ha(t,e){aA.set(t,e),Fl(e,[t])}for(var x_=0;x_<ZT.length;x_++){var __=ZT[x_],sj=__.toLowerCase(),ij=__[0].toUpperCase()+__.slice(1);ha(sj,"on"+ij)}ha(sA,"onAnimationEnd");ha(iA,"onAnimationIteration");ha(rA,"onAnimationStart");ha("dblclick","onDoubleClick");ha("focusin","onFocus");ha("focusout","onBlur");ha(oA,"onTransitionEnd");Qc("onMouseEnter",["mouseout","mouseover"]);Qc("onMouseLeave",["mouseout","mouseover"]);Qc("onPointerEnter",["pointerout","pointerover"]);Qc("onPointerLeave",["pointerout","pointerover"]);Fl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Fl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Fl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Fl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Fl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Fl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $h="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rj=new Set("cancel close invalid load scroll toggle".split(" ").concat($h));function YT(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,sV(s,e,void 0,t),t.currentTarget=null}function lA(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==r&&i.isPropagationStopped())break e;YT(i,a,c),r=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==r&&i.isPropagationStopped())break e;YT(i,a,c),r=l}}}if(Ym)throw t=O0,Ym=!1,O0=null,t}function At(t,e){var n=e[G0];n===void 0&&(n=e[G0]=new Set);var s=t+"__bubble";n.has(s)||(cA(e,t,2,!1),n.add(s))}function w_(t,e,n){var s=0;e&&(s|=4),cA(n,t,s,e)}var im="_reactListening"+Math.random().toString(36).slice(2);function dd(t){if(!t[im]){t[im]=!0,gR.forEach(function(n){n!=="selectionchange"&&(rj.has(n)||w_(n,!1,t),w_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[im]||(e[im]=!0,w_("selectionchange",!1,e))}}function cA(t,e,n,s){switch(HR(e)){case 1:var i=xV;break;case 4:i=_V;break;default:i=Wb}n=i.bind(null,e,n,t),i=void 0,!P0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function b_(t,e,n,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Ka(a),o===null)return;if(l=o.tag,l===5||l===6){s=r=o;continue e}a=a.parentNode}}s=s.return}AR(function(){var c=r,h=Mb(n),d=[];e:{var f=aA.get(t);if(f!==void 0){var m=jb,g=t;switch(t){case"keypress":if(Dm(n)===0)break e;case"keydown":case"keyup":m=OV;break;case"focusin":g="focus",m=m_;break;case"focusout":g="blur",m=m_;break;case"beforeblur":case"afterblur":m=m_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=zT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=CV;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=MV;break;case sA:case iA:case rA:m=SV;break;case oA:m=BV;break;case"scroll":m=wV;break;case"wheel":m=WV;break;case"copy":case"cut":case"paste":m=EV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=UT}var x=(e&4)!==0,_=!x&&t==="scroll",v=x?f!==null?f+"Capture":null:f;x=[];for(var w=c,b;w!==null;){b=w;var I=b.stateNode;if(b.tag===5&&I!==null&&(b=I,v!==null&&(I=od(w,v),I!=null&&x.push(fd(w,I,b)))),_)break;w=w.return}0<x.length&&(f=new m(f,g,null,n,h),d.push({event:f,listeners:x}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==A0&&(g=n.relatedTarget||n.fromElement)&&(Ka(g)||g[to]))break e;if((m||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=n.relatedTarget||n.toElement,m=c,g=g?Ka(g):null,g!==null&&(_=Ml(g),g!==_||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(x=zT,I="onMouseLeave",v="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(x=UT,I="onPointerLeave",v="onPointerEnter",w="pointer"),_=m==null?f:Sc(m),b=g==null?f:Sc(g),f=new x(I,w+"leave",m,n,h),f.target=_,f.relatedTarget=b,I=null,Ka(h)===c&&(x=new x(v,w+"enter",g,n,h),x.target=b,x.relatedTarget=_,I=x),_=I,m&&g)t:{for(x=m,v=g,w=0,b=x;b;b=pc(b))w++;for(b=0,I=v;I;I=pc(I))b++;for(;0<w-b;)x=pc(x),w--;for(;0<b-w;)v=pc(v),b--;for(;w--;){if(x===v||v!==null&&x===v.alternate)break t;x=pc(x),v=pc(v)}x=null}else x=null;m!==null&&QT(d,f,m,x,!1),g!==null&&_!==null&&QT(d,_,g,x,!0)}}e:{if(f=c?Sc(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var S=XV;else if(jT(f))if(QR)S=JV;else{S=YV;var T=ZV}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=QV);if(S&&(S=S(t,c))){YR(d,S,n,h);break e}T&&T(t,f,c),t==="focusout"&&(T=f._wrapperState)&&T.controlled&&f.type==="number"&&T0(f,"number",f.value)}switch(T=c?Sc(c):window,t){case"focusin":(jT(T)||T.contentEditable==="true")&&(Ic=T,z0=c,Vh=null);break;case"focusout":Vh=z0=Ic=null;break;case"mousedown":B0=!0;break;case"contextmenu":case"mouseup":case"dragend":B0=!1,XT(d,n,h);break;case"selectionchange":if(nj)break;case"keydown":case"keyup":XT(d,n,h)}var $;if(Hb)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Cc?XR(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(KR&&n.locale!=="ko"&&(Cc||E!=="onCompositionStart"?E==="onCompositionEnd"&&Cc&&($=qR()):(Ro=h,Vb="value"in Ro?Ro.value:Ro.textContent,Cc=!0)),T=ng(c,E),0<T.length&&(E=new BT(E,t,null,n,h),d.push({event:E,listeners:T}),$?E.data=$:($=ZR(n),$!==null&&(E.data=$)))),($=jV?GV(t,n):HV(t,n))&&(c=ng(c,"onBeforeInput"),0<c.length&&(h=new BT("onBeforeInput","beforeinput",null,n,h),d.push({event:h,listeners:c}),h.data=$))}lA(d,e)})}function fd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ng(t,e){for(var n=e+"Capture",s=[];t!==null;){var i=t,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=od(t,n),r!=null&&s.unshift(fd(t,r,i)),r=od(t,e),r!=null&&s.push(fd(t,r,i))),t=t.return}return s}function pc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function QT(t,e,n,s,i){for(var r=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,i?(l=od(n,r),l!=null&&o.unshift(fd(n,l,a))):i||(l=od(n,r),l!=null&&o.push(fd(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var oj=/\r\n?/g,aj=/\u0000|\uFFFD/g;function JT(t){return(typeof t=="string"?t:""+t).replace(oj,`
`).replace(aj,"")}function rm(t,e,n){if(e=JT(e),JT(t)!==e&&n)throw Error(me(425))}function sg(){}var U0=null,W0=null;function V0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var j0=typeof setTimeout=="function"?setTimeout:void 0,lj=typeof clearTimeout=="function"?clearTimeout:void 0,eE=typeof Promise=="function"?Promise:void 0,cj=typeof queueMicrotask=="function"?queueMicrotask:typeof eE<"u"?function(t){return eE.resolve(null).then(t).catch(uj)}:j0;function uj(t){setTimeout(function(){throw t})}function C_(t,e){var n=e,s=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(s===0){t.removeChild(i),cd(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=i}while(n);cd(e)}function Bo(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function tE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Cu=Math.random().toString(36).slice(2),mr="__reactFiber$"+Cu,pd="__reactProps$"+Cu,to="__reactContainer$"+Cu,G0="__reactEvents$"+Cu,hj="__reactListeners$"+Cu,dj="__reactHandles$"+Cu;function Ka(t){var e=t[mr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[to]||n[mr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=tE(t);t!==null;){if(n=t[mr])return n;t=tE(t)}return e}t=n,n=t.parentNode}return null}function Yd(t){return t=t[mr]||t[to],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Sc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(me(33))}function Ty(t){return t[pd]||null}var H0=[],Tc=-1;function da(t){return{current:t}}function Pt(t){0>Tc||(t.current=H0[Tc],H0[Tc]=null,Tc--)}function Tt(t,e){Tc++,H0[Tc]=t.current,t.current=e}var ea={},ss=da(ea),Es=da(!1),cl=ea;function Jc(t,e){var n=t.type.contextTypes;if(!n)return ea;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in n)i[r]=e[r];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Ns(t){return t=t.childContextTypes,t!=null}function ig(){Pt(Es),Pt(ss)}function nE(t,e,n){if(ss.current!==ea)throw Error(me(168));Tt(ss,e),Tt(Es,n)}function uA(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(me(108,ZW(t)||"Unknown",i));return Gt({},n,s)}function rg(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ea,cl=ss.current,Tt(ss,t),Tt(Es,Es.current),!0}function sE(t,e,n){var s=t.stateNode;if(!s)throw Error(me(169));n?(t=uA(t,e,cl),s.__reactInternalMemoizedMergedChildContext=t,Pt(Es),Pt(ss),Tt(ss,t)):Pt(Es),Tt(Es,n)}var Ur=null,Ey=!1,I_=!1;function hA(t){Ur===null?Ur=[t]:Ur.push(t)}function fj(t){Ey=!0,hA(t)}function fa(){if(!I_&&Ur!==null){I_=!0;var t=0,e=gt;try{var n=Ur;for(gt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Ur=null,Ey=!1}catch(i){throw Ur!==null&&(Ur=Ur.slice(t+1)),LR(zb,fa),i}finally{gt=e,I_=!1}}return null}var Ec=[],Nc=0,og=null,ag=0,oi=[],ai=0,ul=null,jr=1,Gr="";function Ma(t,e){Ec[Nc++]=ag,Ec[Nc++]=og,og=t,ag=e}function dA(t,e,n){oi[ai++]=jr,oi[ai++]=Gr,oi[ai++]=ul,ul=t;var s=jr;t=Gr;var i=32-Vi(s)-1;s&=~(1<<i),n+=1;var r=32-Vi(e)+i;if(30<r){var o=i-i%5;r=(s&(1<<o)-1).toString(32),s>>=o,i-=o,jr=1<<32-Vi(e)+i|n<<i|s,Gr=r+t}else jr=1<<r|n<<i|s,Gr=t}function Kb(t){t.return!==null&&(Ma(t,1),dA(t,1,0))}function Xb(t){for(;t===og;)og=Ec[--Nc],Ec[Nc]=null,ag=Ec[--Nc],Ec[Nc]=null;for(;t===ul;)ul=oi[--ai],oi[ai]=null,Gr=oi[--ai],oi[ai]=null,jr=oi[--ai],oi[ai]=null}var Vs=null,Us=null,Ft=!1,Li=null;function fA(t,e){var n=ui(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function iE(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Vs=t,Us=Bo(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Vs=t,Us=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ul!==null?{id:jr,overflow:Gr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ui(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Vs=t,Us=null,!0):!1;default:return!1}}function q0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function K0(t){if(Ft){var e=Us;if(e){var n=e;if(!iE(t,e)){if(q0(t))throw Error(me(418));e=Bo(n.nextSibling);var s=Vs;e&&iE(t,e)?fA(s,n):(t.flags=t.flags&-4097|2,Ft=!1,Vs=t)}}else{if(q0(t))throw Error(me(418));t.flags=t.flags&-4097|2,Ft=!1,Vs=t}}}function rE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Vs=t}function om(t){if(t!==Vs)return!1;if(!Ft)return rE(t),Ft=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!V0(t.type,t.memoizedProps)),e&&(e=Us)){if(q0(t))throw pA(),Error(me(418));for(;e;)fA(t,e),e=Bo(e.nextSibling)}if(rE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(me(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Us=Bo(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Us=null}}else Us=Vs?Bo(t.stateNode.nextSibling):null;return!0}function pA(){for(var t=Us;t;)t=Bo(t.nextSibling)}function eu(){Us=Vs=null,Ft=!1}function Zb(t){Li===null?Li=[t]:Li.push(t)}var pj=fo.ReactCurrentBatchConfig;function mh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var s=n.stateNode}if(!s)throw Error(me(147,t));var i=s,r=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var a=i.refs;o===null?delete a[r]:a[r]=o},e._stringRef=r,e)}if(typeof t!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,t))}return t}function am(t,e){throw t=Object.prototype.toString.call(e),Error(me(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function oE(t){var e=t._init;return e(t._payload)}function mA(t){function e(v,w){if(t){var b=v.deletions;b===null?(v.deletions=[w],v.flags|=16):b.push(w)}}function n(v,w){if(!t)return null;for(;w!==null;)e(v,w),w=w.sibling;return null}function s(v,w){for(v=new Map;w!==null;)w.key!==null?v.set(w.key,w):v.set(w.index,w),w=w.sibling;return v}function i(v,w){return v=jo(v,w),v.index=0,v.sibling=null,v}function r(v,w,b){return v.index=b,t?(b=v.alternate,b!==null?(b=b.index,b<w?(v.flags|=2,w):b):(v.flags|=2,w)):(v.flags|=1048576,w)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function a(v,w,b,I){return w===null||w.tag!==6?(w=R_(b,v.mode,I),w.return=v,w):(w=i(w,b),w.return=v,w)}function l(v,w,b,I){var S=b.type;return S===bc?h(v,w,b.props.children,I,b.key):w!==null&&(w.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===bo&&oE(S)===w.type)?(I=i(w,b.props),I.ref=mh(v,w,b),I.return=v,I):(I=Bm(b.type,b.key,b.props,null,v.mode,I),I.ref=mh(v,w,b),I.return=v,I)}function c(v,w,b,I){return w===null||w.tag!==4||w.stateNode.containerInfo!==b.containerInfo||w.stateNode.implementation!==b.implementation?(w=A_(b,v.mode,I),w.return=v,w):(w=i(w,b.children||[]),w.return=v,w)}function h(v,w,b,I,S){return w===null||w.tag!==7?(w=il(b,v.mode,I,S),w.return=v,w):(w=i(w,b),w.return=v,w)}function d(v,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return w=R_(""+w,v.mode,b),w.return=v,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Zp:return b=Bm(w.type,w.key,w.props,null,v.mode,b),b.ref=mh(v,null,w),b.return=v,b;case wc:return w=A_(w,v.mode,b),w.return=v,w;case bo:var I=w._init;return d(v,I(w._payload),b)}if(Eh(w)||uh(w))return w=il(w,v.mode,b,null),w.return=v,w;am(v,w)}return null}function f(v,w,b,I){var S=w!==null?w.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return S!==null?null:a(v,w,""+b,I);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Zp:return b.key===S?l(v,w,b,I):null;case wc:return b.key===S?c(v,w,b,I):null;case bo:return S=b._init,f(v,w,S(b._payload),I)}if(Eh(b)||uh(b))return S!==null?null:h(v,w,b,I,null);am(v,b)}return null}function m(v,w,b,I,S){if(typeof I=="string"&&I!==""||typeof I=="number")return v=v.get(b)||null,a(w,v,""+I,S);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Zp:return v=v.get(I.key===null?b:I.key)||null,l(w,v,I,S);case wc:return v=v.get(I.key===null?b:I.key)||null,c(w,v,I,S);case bo:var T=I._init;return m(v,w,b,T(I._payload),S)}if(Eh(I)||uh(I))return v=v.get(b)||null,h(w,v,I,S,null);am(w,I)}return null}function g(v,w,b,I){for(var S=null,T=null,$=w,E=w=0,D=null;$!==null&&E<b.length;E++){$.index>E?(D=$,$=null):D=$.sibling;var P=f(v,$,b[E],I);if(P===null){$===null&&($=D);break}t&&$&&P.alternate===null&&e(v,$),w=r(P,w,E),T===null?S=P:T.sibling=P,T=P,$=D}if(E===b.length)return n(v,$),Ft&&Ma(v,E),S;if($===null){for(;E<b.length;E++)$=d(v,b[E],I),$!==null&&(w=r($,w,E),T===null?S=$:T.sibling=$,T=$);return Ft&&Ma(v,E),S}for($=s(v,$);E<b.length;E++)D=m($,v,E,b[E],I),D!==null&&(t&&D.alternate!==null&&$.delete(D.key===null?E:D.key),w=r(D,w,E),T===null?S=D:T.sibling=D,T=D);return t&&$.forEach(function(z){return e(v,z)}),Ft&&Ma(v,E),S}function x(v,w,b,I){var S=uh(b);if(typeof S!="function")throw Error(me(150));if(b=S.call(b),b==null)throw Error(me(151));for(var T=S=null,$=w,E=w=0,D=null,P=b.next();$!==null&&!P.done;E++,P=b.next()){$.index>E?(D=$,$=null):D=$.sibling;var z=f(v,$,P.value,I);if(z===null){$===null&&($=D);break}t&&$&&z.alternate===null&&e(v,$),w=r(z,w,E),T===null?S=z:T.sibling=z,T=z,$=D}if(P.done)return n(v,$),Ft&&Ma(v,E),S;if($===null){for(;!P.done;E++,P=b.next())P=d(v,P.value,I),P!==null&&(w=r(P,w,E),T===null?S=P:T.sibling=P,T=P);return Ft&&Ma(v,E),S}for($=s(v,$);!P.done;E++,P=b.next())P=m($,v,E,P.value,I),P!==null&&(t&&P.alternate!==null&&$.delete(P.key===null?E:P.key),w=r(P,w,E),T===null?S=P:T.sibling=P,T=P);return t&&$.forEach(function(V){return e(v,V)}),Ft&&Ma(v,E),S}function _(v,w,b,I){if(typeof b=="object"&&b!==null&&b.type===bc&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Zp:e:{for(var S=b.key,T=w;T!==null;){if(T.key===S){if(S=b.type,S===bc){if(T.tag===7){n(v,T.sibling),w=i(T,b.props.children),w.return=v,v=w;break e}}else if(T.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===bo&&oE(S)===T.type){n(v,T.sibling),w=i(T,b.props),w.ref=mh(v,T,b),w.return=v,v=w;break e}n(v,T);break}else e(v,T);T=T.sibling}b.type===bc?(w=il(b.props.children,v.mode,I,b.key),w.return=v,v=w):(I=Bm(b.type,b.key,b.props,null,v.mode,I),I.ref=mh(v,w,b),I.return=v,v=I)}return o(v);case wc:e:{for(T=b.key;w!==null;){if(w.key===T)if(w.tag===4&&w.stateNode.containerInfo===b.containerInfo&&w.stateNode.implementation===b.implementation){n(v,w.sibling),w=i(w,b.children||[]),w.return=v,v=w;break e}else{n(v,w);break}else e(v,w);w=w.sibling}w=A_(b,v.mode,I),w.return=v,v=w}return o(v);case bo:return T=b._init,_(v,w,T(b._payload),I)}if(Eh(b))return g(v,w,b,I);if(uh(b))return x(v,w,b,I);am(v,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,w!==null&&w.tag===6?(n(v,w.sibling),w=i(w,b),w.return=v,v=w):(n(v,w),w=R_(b,v.mode,I),w.return=v,v=w),o(v)):n(v,w)}return _}var tu=mA(!0),gA=mA(!1),lg=da(null),cg=null,$c=null,Yb=null;function Qb(){Yb=$c=cg=null}function Jb(t){var e=lg.current;Pt(lg),t._currentValue=e}function X0(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Bc(t,e){cg=t,Yb=$c=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Cs=!0),t.firstContext=null)}function vi(t){var e=t._currentValue;if(Yb!==t)if(t={context:t,memoizedValue:e,next:null},$c===null){if(cg===null)throw Error(me(308));$c=t,cg.dependencies={lanes:0,firstContext:t}}else $c=$c.next=t;return e}var Xa=null;function e1(t){Xa===null?Xa=[t]:Xa.push(t)}function yA(t,e,n,s){var i=e.interleaved;return i===null?(n.next=n,e1(e)):(n.next=i.next,i.next=n),e.interleaved=n,no(t,s)}function no(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Co=!1;function t1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vA(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Yr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Uo(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,it&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,no(t,n)}return i=s.interleaved,i===null?(e.next=e,e1(s)):(e.next=i.next,i.next=e),s.interleaved=e,no(t,n)}function Pm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,Bb(t,n)}}function aE(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var i=null,r=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};r===null?i=r=o:r=r.next=o,n=n.next}while(n!==null);r===null?i=r=e:r=r.next=e}else i=r=e;n={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ug(t,e,n,s){var i=t.updateQueue;Co=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?r=c:o.next=c,o=l;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(r!==null){var d=i.baseState;o=0,h=c=l=null,a=r;do{var f=a.lane,m=a.eventTime;if((s&f)===f){h!==null&&(h=h.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,x=a;switch(f=e,m=n,x.tag){case 1:if(g=x.payload,typeof g=="function"){d=g.call(m,d,f);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=x.payload,f=typeof g=="function"?g.call(m,d,f):g,f==null)break e;d=Gt({},d,f);break e;case 2:Co=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=m,l=d):h=h.next=m,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(h===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);dl|=o,t.lanes=o,t.memoizedState=d}}function lE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],i=s.callback;if(i!==null){if(s.callback=null,s=n,typeof i!="function")throw Error(me(191,i));i.call(s)}}}var Qd={},vr=da(Qd),md=da(Qd),gd=da(Qd);function Za(t){if(t===Qd)throw Error(me(174));return t}function n1(t,e){switch(Tt(gd,e),Tt(md,t),Tt(vr,Qd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:N0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=N0(e,t)}Pt(vr),Tt(vr,e)}function nu(){Pt(vr),Pt(md),Pt(gd)}function xA(t){Za(gd.current);var e=Za(vr.current),n=N0(e,t.type);e!==n&&(Tt(md,t),Tt(vr,n))}function s1(t){md.current===t&&(Pt(vr),Pt(md))}var Wt=da(0);function hg(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var k_=[];function i1(){for(var t=0;t<k_.length;t++)k_[t]._workInProgressVersionPrimary=null;k_.length=0}var Om=fo.ReactCurrentDispatcher,S_=fo.ReactCurrentBatchConfig,hl=0,jt=null,vn=null,Tn=null,dg=!1,jh=!1,yd=0,mj=0;function Xn(){throw Error(me(321))}function r1(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Xi(t[n],e[n]))return!1;return!0}function o1(t,e,n,s,i,r){if(hl=r,jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Om.current=t===null||t.memoizedState===null?xj:_j,t=n(s,i),jh){r=0;do{if(jh=!1,yd=0,25<=r)throw Error(me(301));r+=1,Tn=vn=null,e.updateQueue=null,Om.current=wj,t=n(s,i)}while(jh)}if(Om.current=fg,e=vn!==null&&vn.next!==null,hl=0,Tn=vn=jt=null,dg=!1,e)throw Error(me(300));return t}function a1(){var t=yd!==0;return yd=0,t}function cr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tn===null?jt.memoizedState=Tn=t:Tn=Tn.next=t,Tn}function xi(){if(vn===null){var t=jt.alternate;t=t!==null?t.memoizedState:null}else t=vn.next;var e=Tn===null?jt.memoizedState:Tn.next;if(e!==null)Tn=e,vn=t;else{if(t===null)throw Error(me(310));vn=t,t={memoizedState:vn.memoizedState,baseState:vn.baseState,baseQueue:vn.baseQueue,queue:vn.queue,next:null},Tn===null?jt.memoizedState=Tn=t:Tn=Tn.next=t}return Tn}function vd(t,e){return typeof e=="function"?e(t):e}function T_(t){var e=xi(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var s=vn,i=s.baseQueue,r=n.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}s.baseQueue=i=r,n.pending=null}if(i!==null){r=i.next,s=s.baseState;var a=o=null,l=null,c=r;do{var h=c.lane;if((hl&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:t(s,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=s):l=l.next=d,jt.lanes|=h,dl|=h}c=c.next}while(c!==null&&c!==r);l===null?o=s:l.next=a,Xi(s,e.memoizedState)||(Cs=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){i=t;do r=i.lane,jt.lanes|=r,dl|=r,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function E_(t){var e=xi(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var s=n.dispatch,i=n.pending,r=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do r=t(r,o.action),o=o.next;while(o!==i);Xi(r,e.memoizedState)||(Cs=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),n.lastRenderedState=r}return[r,s]}function _A(){}function wA(t,e){var n=jt,s=xi(),i=e(),r=!Xi(s.memoizedState,i);if(r&&(s.memoizedState=i,Cs=!0),s=s.queue,l1(IA.bind(null,n,s,t),[t]),s.getSnapshot!==e||r||Tn!==null&&Tn.memoizedState.tag&1){if(n.flags|=2048,xd(9,CA.bind(null,n,s,i,e),void 0,null),Rn===null)throw Error(me(349));hl&30||bA(n,e,i)}return i}function bA(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function CA(t,e,n,s){e.value=n,e.getSnapshot=s,kA(e)&&SA(t)}function IA(t,e,n){return n(function(){kA(e)&&SA(t)})}function kA(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Xi(t,n)}catch{return!0}}function SA(t){var e=no(t,1);e!==null&&ji(e,t,1,-1)}function cE(t){var e=cr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vd,lastRenderedState:t},e.queue=t,t=t.dispatch=vj.bind(null,jt,t),[e.memoizedState,t]}function xd(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function TA(){return xi().memoizedState}function Lm(t,e,n,s){var i=cr();jt.flags|=t,i.memoizedState=xd(1|e,n,void 0,s===void 0?null:s)}function Ny(t,e,n,s){var i=xi();s=s===void 0?null:s;var r=void 0;if(vn!==null){var o=vn.memoizedState;if(r=o.destroy,s!==null&&r1(s,o.deps)){i.memoizedState=xd(e,n,r,s);return}}jt.flags|=t,i.memoizedState=xd(1|e,n,r,s)}function uE(t,e){return Lm(8390656,8,t,e)}function l1(t,e){return Ny(2048,8,t,e)}function EA(t,e){return Ny(4,2,t,e)}function NA(t,e){return Ny(4,4,t,e)}function $A(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function RA(t,e,n){return n=n!=null?n.concat([t]):null,Ny(4,4,$A.bind(null,e,t),n)}function c1(){}function AA(t,e){var n=xi();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&r1(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function DA(t,e){var n=xi();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&r1(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function PA(t,e,n){return hl&21?(Xi(n,e)||(n=zR(),jt.lanes|=n,dl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Cs=!0),t.memoizedState=n)}function gj(t,e){var n=gt;gt=n!==0&&4>n?n:4,t(!0);var s=S_.transition;S_.transition={};try{t(!1),e()}finally{gt=n,S_.transition=s}}function OA(){return xi().memoizedState}function yj(t,e,n){var s=Vo(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},LA(t))FA(e,n);else if(n=yA(t,e,n,s),n!==null){var i=hs();ji(n,t,s,i),MA(n,e,s)}}function vj(t,e,n){var s=Vo(t),i={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(LA(t))FA(e,i);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,a=r(o,n);if(i.hasEagerState=!0,i.eagerState=a,Xi(a,o)){var l=e.interleaved;l===null?(i.next=i,e1(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=yA(t,e,i,s),n!==null&&(i=hs(),ji(n,t,s,i),MA(n,e,s))}}function LA(t){var e=t.alternate;return t===jt||e!==null&&e===jt}function FA(t,e){jh=dg=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function MA(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,Bb(t,n)}}var fg={readContext:vi,useCallback:Xn,useContext:Xn,useEffect:Xn,useImperativeHandle:Xn,useInsertionEffect:Xn,useLayoutEffect:Xn,useMemo:Xn,useReducer:Xn,useRef:Xn,useState:Xn,useDebugValue:Xn,useDeferredValue:Xn,useTransition:Xn,useMutableSource:Xn,useSyncExternalStore:Xn,useId:Xn,unstable_isNewReconciler:!1},xj={readContext:vi,useCallback:function(t,e){return cr().memoizedState=[t,e===void 0?null:e],t},useContext:vi,useEffect:uE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Lm(4194308,4,$A.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Lm(4194308,4,t,e)},useInsertionEffect:function(t,e){return Lm(4,2,t,e)},useMemo:function(t,e){var n=cr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=cr();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=yj.bind(null,jt,t),[s.memoizedState,t]},useRef:function(t){var e=cr();return t={current:t},e.memoizedState=t},useState:cE,useDebugValue:c1,useDeferredValue:function(t){return cr().memoizedState=t},useTransition:function(){var t=cE(!1),e=t[0];return t=gj.bind(null,t[1]),cr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=jt,i=cr();if(Ft){if(n===void 0)throw Error(me(407));n=n()}else{if(n=e(),Rn===null)throw Error(me(349));hl&30||bA(s,e,n)}i.memoizedState=n;var r={value:n,getSnapshot:e};return i.queue=r,uE(IA.bind(null,s,r,t),[t]),s.flags|=2048,xd(9,CA.bind(null,s,r,n,e),void 0,null),n},useId:function(){var t=cr(),e=Rn.identifierPrefix;if(Ft){var n=Gr,s=jr;n=(s&~(1<<32-Vi(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=yd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=mj++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_j={readContext:vi,useCallback:AA,useContext:vi,useEffect:l1,useImperativeHandle:RA,useInsertionEffect:EA,useLayoutEffect:NA,useMemo:DA,useReducer:T_,useRef:TA,useState:function(){return T_(vd)},useDebugValue:c1,useDeferredValue:function(t){var e=xi();return PA(e,vn.memoizedState,t)},useTransition:function(){var t=T_(vd)[0],e=xi().memoizedState;return[t,e]},useMutableSource:_A,useSyncExternalStore:wA,useId:OA,unstable_isNewReconciler:!1},wj={readContext:vi,useCallback:AA,useContext:vi,useEffect:l1,useImperativeHandle:RA,useInsertionEffect:EA,useLayoutEffect:NA,useMemo:DA,useReducer:E_,useRef:TA,useState:function(){return E_(vd)},useDebugValue:c1,useDeferredValue:function(t){var e=xi();return vn===null?e.memoizedState=t:PA(e,vn.memoizedState,t)},useTransition:function(){var t=E_(vd)[0],e=xi().memoizedState;return[t,e]},useMutableSource:_A,useSyncExternalStore:wA,useId:OA,unstable_isNewReconciler:!1};function Pi(t,e){if(t&&t.defaultProps){e=Gt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Z0(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Gt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $y={isMounted:function(t){return(t=t._reactInternals)?Ml(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=hs(),i=Vo(t),r=Yr(s,i);r.payload=e,n!=null&&(r.callback=n),e=Uo(t,r,i),e!==null&&(ji(e,t,i,s),Pm(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=hs(),i=Vo(t),r=Yr(s,i);r.tag=1,r.payload=e,n!=null&&(r.callback=n),e=Uo(t,r,i),e!==null&&(ji(e,t,i,s),Pm(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=hs(),s=Vo(t),i=Yr(n,s);i.tag=2,e!=null&&(i.callback=e),e=Uo(t,i,s),e!==null&&(ji(e,t,s,n),Pm(e,t,s))}};function hE(t,e,n,s,i,r,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,r,o):e.prototype&&e.prototype.isPureReactComponent?!hd(n,s)||!hd(i,r):!0}function zA(t,e,n){var s=!1,i=ea,r=e.contextType;return typeof r=="object"&&r!==null?r=vi(r):(i=Ns(e)?cl:ss.current,s=e.contextTypes,r=(s=s!=null)?Jc(t,i):ea),e=new e(n,r),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$y,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=r),e}function dE(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&$y.enqueueReplaceState(e,e.state,null)}function Y0(t,e,n,s){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},t1(t);var r=e.contextType;typeof r=="object"&&r!==null?i.context=vi(r):(r=Ns(e)?cl:ss.current,i.context=Jc(t,r)),i.state=t.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(Z0(t,e,r,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&$y.enqueueReplaceState(i,i.state,null),ug(t,n,i,s),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function su(t,e){try{var n="",s=e;do n+=XW(s),s=s.return;while(s);var i=n}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:t,source:e,stack:i,digest:null}}function N_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Q0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var bj=typeof WeakMap=="function"?WeakMap:Map;function BA(t,e,n){n=Yr(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){mg||(mg=!0,lw=s),Q0(t,e)},n}function UA(t,e,n){n=Yr(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;n.payload=function(){return s(i)},n.callback=function(){Q0(t,e)}}var r=t.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(n.callback=function(){Q0(t,e),typeof s!="function"&&(Wo===null?Wo=new Set([this]):Wo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function fE(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new bj;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(n)||(i.add(n),t=Lj.bind(null,t,e,n),e.then(t,t))}function pE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function mE(t,e,n,s,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Yr(-1,1),e.tag=2,Uo(n,e,1))),n.lanes|=1),t)}var Cj=fo.ReactCurrentOwner,Cs=!1;function as(t,e,n,s){e.child=t===null?gA(e,null,n,s):tu(e,t.child,n,s)}function gE(t,e,n,s,i){n=n.render;var r=e.ref;return Bc(e,i),s=o1(t,e,n,s,r,i),n=a1(),t!==null&&!Cs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,so(t,e,i)):(Ft&&n&&Kb(e),e.flags|=1,as(t,e,s,i),e.child)}function yE(t,e,n,s,i){if(t===null){var r=n.type;return typeof r=="function"&&!y1(r)&&r.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=r,WA(t,e,r,s,i)):(t=Bm(n.type,null,s,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!(t.lanes&i)){var o=r.memoizedProps;if(n=n.compare,n=n!==null?n:hd,n(o,s)&&t.ref===e.ref)return so(t,e,i)}return e.flags|=1,t=jo(r,s),t.ref=e.ref,t.return=e,e.child=t}function WA(t,e,n,s,i){if(t!==null){var r=t.memoizedProps;if(hd(r,s)&&t.ref===e.ref)if(Cs=!1,e.pendingProps=s=r,(t.lanes&i)!==0)t.flags&131072&&(Cs=!0);else return e.lanes=t.lanes,so(t,e,i)}return J0(t,e,n,s,i)}function VA(t,e,n){var s=e.pendingProps,i=s.children,r=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tt(Ac,zs),zs|=n;else{if(!(n&1073741824))return t=r!==null?r.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Tt(Ac,zs),zs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:n,Tt(Ac,zs),zs|=s}else r!==null?(s=r.baseLanes|n,e.memoizedState=null):s=n,Tt(Ac,zs),zs|=s;return as(t,e,i,n),e.child}function jA(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function J0(t,e,n,s,i){var r=Ns(n)?cl:ss.current;return r=Jc(e,r),Bc(e,i),n=o1(t,e,n,s,r,i),s=a1(),t!==null&&!Cs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,so(t,e,i)):(Ft&&s&&Kb(e),e.flags|=1,as(t,e,n,i),e.child)}function vE(t,e,n,s,i){if(Ns(n)){var r=!0;rg(e)}else r=!1;if(Bc(e,i),e.stateNode===null)Fm(t,e),zA(e,n,s),Y0(e,n,s,i),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=vi(c):(c=Ns(n)?cl:ss.current,c=Jc(e,c));var h=n.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==c)&&dE(e,o,s,c),Co=!1;var f=e.memoizedState;o.state=f,ug(e,s,o,i),l=e.memoizedState,a!==s||f!==l||Es.current||Co?(typeof h=="function"&&(Z0(e,n,h,s),l=e.memoizedState),(a=Co||hE(e,n,a,s,f,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=c,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,vA(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Pi(e.type,a),o.props=c,d=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=vi(l):(l=Ns(n)?cl:ss.current,l=Jc(e,l));var m=n.getDerivedStateFromProps;(h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&dE(e,o,s,l),Co=!1,f=e.memoizedState,o.state=f,ug(e,s,o,i);var g=e.memoizedState;a!==d||f!==g||Es.current||Co?(typeof m=="function"&&(Z0(e,n,m,s),g=e.memoizedState),(c=Co||hE(e,n,c,s,f,g,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),o.props=s,o.state=g,o.context=l,s=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),s=!1)}return ew(t,e,n,s,r,i)}function ew(t,e,n,s,i,r){jA(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return i&&sE(e,n,!1),so(t,e,r);s=e.stateNode,Cj.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=tu(e,t.child,null,r),e.child=tu(e,null,a,r)):as(t,e,a,r),e.memoizedState=s.state,i&&sE(e,n,!0),e.child}function GA(t){var e=t.stateNode;e.pendingContext?nE(t,e.pendingContext,e.pendingContext!==e.context):e.context&&nE(t,e.context,!1),n1(t,e.containerInfo)}function xE(t,e,n,s,i){return eu(),Zb(i),e.flags|=256,as(t,e,n,s),e.child}var tw={dehydrated:null,treeContext:null,retryLane:0};function nw(t){return{baseLanes:t,cachePool:null,transitions:null}}function HA(t,e,n){var s=e.pendingProps,i=Wt.current,r=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(r=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Tt(Wt,i&1),t===null)return K0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,r?(s=e.mode,r=e.child,o={mode:"hidden",children:o},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=Dy(o,s,0,null),t=il(t,s,n,null),r.return=e,t.return=e,r.sibling=t,e.child=r,e.child.memoizedState=nw(n),e.memoizedState=tw,t):u1(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Ij(t,e,o,s,a,i,n);if(r){r=s.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=jo(i,l),s.subtreeFlags=i.subtreeFlags&14680064),a!==null?r=jo(a,r):(r=il(r,o,n,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,o=t.child.memoizedState,o=o===null?nw(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=t.childLanes&~n,e.memoizedState=tw,s}return r=t.child,t=r.sibling,s=jo(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function u1(t,e){return e=Dy({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function lm(t,e,n,s){return s!==null&&Zb(s),tu(e,t.child,null,n),t=u1(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Ij(t,e,n,s,i,r,o){if(n)return e.flags&256?(e.flags&=-257,s=N_(Error(me(422))),lm(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=Dy({mode:"visible",children:s.children},i,0,null),r=il(r,i,o,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&tu(e,t.child,null,o),e.child.memoizedState=nw(o),e.memoizedState=tw,r);if(!(e.mode&1))return lm(t,e,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var a=s.dgst;return s=a,r=Error(me(419)),s=N_(r,s,void 0),lm(t,e,o,s)}if(a=(o&t.childLanes)!==0,Cs||a){if(s=Rn,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,no(t,i),ji(s,t,i,-1))}return g1(),s=N_(Error(me(421))),lm(t,e,o,s)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Fj.bind(null,t),i._reactRetry=e,null):(t=r.treeContext,Us=Bo(i.nextSibling),Vs=e,Ft=!0,Li=null,t!==null&&(oi[ai++]=jr,oi[ai++]=Gr,oi[ai++]=ul,jr=t.id,Gr=t.overflow,ul=e),e=u1(e,s.children),e.flags|=4096,e)}function _E(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),X0(t.return,e,n)}function $_(t,e,n,s,i){var r=t.memoizedState;r===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=n,r.tailMode=i)}function qA(t,e,n){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(as(t,e,s.children,n),s=Wt.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&_E(t,n,e);else if(t.tag===19)_E(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Tt(Wt,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&hg(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),$_(e,!1,i,n,r);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&hg(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}$_(e,!0,n,null,r);break;case"together":$_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function so(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),dl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(me(153));if(e.child!==null){for(t=e.child,n=jo(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=jo(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function kj(t,e,n){switch(e.tag){case 3:GA(e),eu();break;case 5:xA(e);break;case 1:Ns(e.type)&&rg(e);break;case 4:n1(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;Tt(lg,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Tt(Wt,Wt.current&1),e.flags|=128,null):n&e.child.childLanes?HA(t,e,n):(Tt(Wt,Wt.current&1),t=so(t,e,n),t!==null?t.sibling:null);Tt(Wt,Wt.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return qA(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Tt(Wt,Wt.current),s)break;return null;case 22:case 23:return e.lanes=0,VA(t,e,n)}return so(t,e,n)}var KA,sw,XA,ZA;KA=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};sw=function(){};XA=function(t,e,n,s){var i=t.memoizedProps;if(i!==s){t=e.stateNode,Za(vr.current);var r=null;switch(n){case"input":i=k0(t,i),s=k0(t,s),r=[];break;case"select":i=Gt({},i,{value:void 0}),s=Gt({},s,{value:void 0}),r=[];break;case"textarea":i=E0(t,i),s=E0(t,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=sg)}$0(n,s);var o;n=null;for(c in i)if(!s.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(id.hasOwnProperty(c)?r||(r=[]):(r=r||[]).push(c,null));for(c in s){var l=s[c];if(a=i!=null?i[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(r||(r=[]),r.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(r=r||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(id.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&At("scroll",t),r||a===l||(r=[])):(r=r||[]).push(c,l))}n&&(r=r||[]).push("style",n);var c=r;(e.updateQueue=c)&&(e.flags|=4)}};ZA=function(t,e,n,s){n!==s&&(e.flags|=4)};function gh(t,e){if(!Ft)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Zn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function Sj(t,e,n){var s=e.pendingProps;switch(Xb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zn(e),null;case 1:return Ns(e.type)&&ig(),Zn(e),null;case 3:return s=e.stateNode,nu(),Pt(Es),Pt(ss),i1(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(om(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Li!==null&&(hw(Li),Li=null))),sw(t,e),Zn(e),null;case 5:s1(e);var i=Za(gd.current);if(n=e.type,t!==null&&e.stateNode!=null)XA(t,e,n,s,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(me(166));return Zn(e),null}if(t=Za(vr.current),om(e)){s=e.stateNode,n=e.type;var r=e.memoizedProps;switch(s[mr]=e,s[pd]=r,t=(e.mode&1)!==0,n){case"dialog":At("cancel",s),At("close",s);break;case"iframe":case"object":case"embed":At("load",s);break;case"video":case"audio":for(i=0;i<$h.length;i++)At($h[i],s);break;case"source":At("error",s);break;case"img":case"image":case"link":At("error",s),At("load",s);break;case"details":At("toggle",s);break;case"input":NT(s,r),At("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},At("invalid",s);break;case"textarea":RT(s,r),At("invalid",s)}$0(n,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];o==="children"?typeof a=="string"?s.textContent!==a&&(r.suppressHydrationWarning!==!0&&rm(s.textContent,a,t),i=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(r.suppressHydrationWarning!==!0&&rm(s.textContent,a,t),i=["children",""+a]):id.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&At("scroll",s)}switch(n){case"input":Yp(s),$T(s,r,!0);break;case"textarea":Yp(s),AT(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=sg)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=IR(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[mr]=e,t[pd]=s,KA(t,e,!1,!1),e.stateNode=t;e:{switch(o=R0(n,s),n){case"dialog":At("cancel",t),At("close",t),i=s;break;case"iframe":case"object":case"embed":At("load",t),i=s;break;case"video":case"audio":for(i=0;i<$h.length;i++)At($h[i],t);i=s;break;case"source":At("error",t),i=s;break;case"img":case"image":case"link":At("error",t),At("load",t),i=s;break;case"details":At("toggle",t),i=s;break;case"input":NT(t,s),i=k0(t,s),At("invalid",t);break;case"option":i=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},i=Gt({},s,{value:void 0}),At("invalid",t);break;case"textarea":RT(t,s),i=E0(t,s),At("invalid",t);break;default:i=s}$0(n,i),a=i;for(r in a)if(a.hasOwnProperty(r)){var l=a[r];r==="style"?TR(t,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&kR(t,l)):r==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&rd(t,l):typeof l=="number"&&rd(t,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(id.hasOwnProperty(r)?l!=null&&r==="onScroll"&&At("scroll",t):l!=null&&Pb(t,r,l,o))}switch(n){case"input":Yp(t),$T(t,s,!1);break;case"textarea":Yp(t),AT(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Jo(s.value));break;case"select":t.multiple=!!s.multiple,r=s.value,r!=null?Lc(t,!!s.multiple,r,!1):s.defaultValue!=null&&Lc(t,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=sg)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Zn(e),null;case 6:if(t&&e.stateNode!=null)ZA(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(me(166));if(n=Za(gd.current),Za(vr.current),om(e)){if(s=e.stateNode,n=e.memoizedProps,s[mr]=e,(r=s.nodeValue!==n)&&(t=Vs,t!==null))switch(t.tag){case 3:rm(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&rm(s.nodeValue,n,(t.mode&1)!==0)}r&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[mr]=e,e.stateNode=s}return Zn(e),null;case 13:if(Pt(Wt),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ft&&Us!==null&&e.mode&1&&!(e.flags&128))pA(),eu(),e.flags|=98560,r=!1;else if(r=om(e),s!==null&&s.dehydrated!==null){if(t===null){if(!r)throw Error(me(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(me(317));r[mr]=e}else eu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Zn(e),r=!1}else Li!==null&&(hw(Li),Li=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Wt.current&1?bn===0&&(bn=3):g1())),e.updateQueue!==null&&(e.flags|=4),Zn(e),null);case 4:return nu(),sw(t,e),t===null&&dd(e.stateNode.containerInfo),Zn(e),null;case 10:return Jb(e.type._context),Zn(e),null;case 17:return Ns(e.type)&&ig(),Zn(e),null;case 19:if(Pt(Wt),r=e.memoizedState,r===null)return Zn(e),null;if(s=(e.flags&128)!==0,o=r.rendering,o===null)if(s)gh(r,!1);else{if(bn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=hg(t),o!==null){for(e.flags|=128,gh(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)r=n,t=s,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=t,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,t=o.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Tt(Wt,Wt.current&1|2),e.child}t=t.sibling}r.tail!==null&&tn()>iu&&(e.flags|=128,s=!0,gh(r,!1),e.lanes=4194304)}else{if(!s)if(t=hg(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),gh(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Ft)return Zn(e),null}else 2*tn()-r.renderingStartTime>iu&&n!==1073741824&&(e.flags|=128,s=!0,gh(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(n=r.last,n!==null?n.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=tn(),e.sibling=null,n=Wt.current,Tt(Wt,s?n&1|2:n&1),e):(Zn(e),null);case 22:case 23:return m1(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?zs&1073741824&&(Zn(e),e.subtreeFlags&6&&(e.flags|=8192)):Zn(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function Tj(t,e){switch(Xb(e),e.tag){case 1:return Ns(e.type)&&ig(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return nu(),Pt(Es),Pt(ss),i1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return s1(e),null;case 13:if(Pt(Wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(me(340));eu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Pt(Wt),null;case 4:return nu(),null;case 10:return Jb(e.type._context),null;case 22:case 23:return m1(),null;case 24:return null;default:return null}}var cm=!1,Qn=!1,Ej=typeof WeakSet=="function"?WeakSet:Set,Ce=null;function Rc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Ht(t,e,s)}else n.current=null}function iw(t,e,n){try{n()}catch(s){Ht(t,e,s)}}var wE=!1;function Nj(t,e){if(U0=eg,t=tA(),qb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{n.nodeType,r.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,h=0,d=t,f=null;t:for(;;){for(var m;d!==n||i!==0&&d.nodeType!==3||(a=o+i),d!==r||s!==0&&d.nodeType!==3||(l=o+s),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)f=d,d=m;for(;;){if(d===t)break t;if(f===n&&++c===i&&(a=o),f===r&&++h===s&&(l=o),(m=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=m}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(W0={focusedElem:t,selectionRange:n},eg=!1,Ce=e;Ce!==null;)if(e=Ce,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ce=t;else for(;Ce!==null;){e=Ce;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var x=g.memoizedProps,_=g.memoizedState,v=e.stateNode,w=v.getSnapshotBeforeUpdate(e.elementType===e.type?x:Pi(e.type,x),_);v.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(I){Ht(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,Ce=t;break}Ce=e.return}return g=wE,wE=!1,g}function Gh(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&t)===t){var r=i.destroy;i.destroy=void 0,r!==void 0&&iw(e,n,r)}i=i.next}while(i!==s)}}function Ry(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function rw(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function YA(t){var e=t.alternate;e!==null&&(t.alternate=null,YA(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[mr],delete e[pd],delete e[G0],delete e[hj],delete e[dj])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function QA(t){return t.tag===5||t.tag===3||t.tag===4}function bE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||QA(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ow(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=sg));else if(s!==4&&(t=t.child,t!==null))for(ow(t,e,n),t=t.sibling;t!==null;)ow(t,e,n),t=t.sibling}function aw(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(aw(t,e,n),t=t.sibling;t!==null;)aw(t,e,n),t=t.sibling}var Mn=null,Oi=!1;function _o(t,e,n){for(n=n.child;n!==null;)JA(t,e,n),n=n.sibling}function JA(t,e,n){if(yr&&typeof yr.onCommitFiberUnmount=="function")try{yr.onCommitFiberUnmount(Cy,n)}catch{}switch(n.tag){case 5:Qn||Rc(n,e);case 6:var s=Mn,i=Oi;Mn=null,_o(t,e,n),Mn=s,Oi=i,Mn!==null&&(Oi?(t=Mn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Mn.removeChild(n.stateNode));break;case 18:Mn!==null&&(Oi?(t=Mn,n=n.stateNode,t.nodeType===8?C_(t.parentNode,n):t.nodeType===1&&C_(t,n),cd(t)):C_(Mn,n.stateNode));break;case 4:s=Mn,i=Oi,Mn=n.stateNode.containerInfo,Oi=!0,_o(t,e,n),Mn=s,Oi=i;break;case 0:case 11:case 14:case 15:if(!Qn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&iw(n,e,o),i=i.next}while(i!==s)}_o(t,e,n);break;case 1:if(!Qn&&(Rc(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){Ht(n,e,a)}_o(t,e,n);break;case 21:_o(t,e,n);break;case 22:n.mode&1?(Qn=(s=Qn)||n.memoizedState!==null,_o(t,e,n),Qn=s):_o(t,e,n);break;default:_o(t,e,n)}}function CE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Ej),e.forEach(function(s){var i=Mj.bind(null,t,s);n.has(s)||(n.add(s),s.then(i,i))})}}function Ri(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var i=n[s];try{var r=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Mn=a.stateNode,Oi=!1;break e;case 3:Mn=a.stateNode.containerInfo,Oi=!0;break e;case 4:Mn=a.stateNode.containerInfo,Oi=!0;break e}a=a.return}if(Mn===null)throw Error(me(160));JA(r,o,i),Mn=null,Oi=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Ht(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eD(e,t),e=e.sibling}function eD(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ri(e,t),lr(t),s&4){try{Gh(3,t,t.return),Ry(3,t)}catch(x){Ht(t,t.return,x)}try{Gh(5,t,t.return)}catch(x){Ht(t,t.return,x)}}break;case 1:Ri(e,t),lr(t),s&512&&n!==null&&Rc(n,n.return);break;case 5:if(Ri(e,t),lr(t),s&512&&n!==null&&Rc(n,n.return),t.flags&32){var i=t.stateNode;try{rd(i,"")}catch(x){Ht(t,t.return,x)}}if(s&4&&(i=t.stateNode,i!=null)){var r=t.memoizedProps,o=n!==null?n.memoizedProps:r,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&r.type==="radio"&&r.name!=null&&bR(i,r),R0(a,o);var c=R0(a,r);for(o=0;o<l.length;o+=2){var h=l[o],d=l[o+1];h==="style"?TR(i,d):h==="dangerouslySetInnerHTML"?kR(i,d):h==="children"?rd(i,d):Pb(i,h,d,c)}switch(a){case"input":S0(i,r);break;case"textarea":CR(i,r);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var m=r.value;m!=null?Lc(i,!!r.multiple,m,!1):f!==!!r.multiple&&(r.defaultValue!=null?Lc(i,!!r.multiple,r.defaultValue,!0):Lc(i,!!r.multiple,r.multiple?[]:"",!1))}i[pd]=r}catch(x){Ht(t,t.return,x)}}break;case 6:if(Ri(e,t),lr(t),s&4){if(t.stateNode===null)throw Error(me(162));i=t.stateNode,r=t.memoizedProps;try{i.nodeValue=r}catch(x){Ht(t,t.return,x)}}break;case 3:if(Ri(e,t),lr(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{cd(e.containerInfo)}catch(x){Ht(t,t.return,x)}break;case 4:Ri(e,t),lr(t);break;case 13:Ri(e,t),lr(t),i=t.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(f1=tn())),s&4&&CE(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Qn=(c=Qn)||h,Ri(e,t),Qn=c):Ri(e,t),lr(t),s&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(Ce=t,h=t.child;h!==null;){for(d=Ce=h;Ce!==null;){switch(f=Ce,m=f.child,f.tag){case 0:case 11:case 14:case 15:Gh(4,f,f.return);break;case 1:Rc(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){s=f,n=f.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(x){Ht(s,n,x)}}break;case 5:Rc(f,f.return);break;case 22:if(f.memoizedState!==null){kE(d);continue}}m!==null?(m.return=f,Ce=m):kE(d)}h=h.sibling}e:for(h=null,d=t;;){if(d.tag===5){if(h===null){h=d;try{i=d.stateNode,c?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=SR("display",o))}catch(x){Ht(t,t.return,x)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(x){Ht(t,t.return,x)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ri(e,t),lr(t),s&4&&CE(t);break;case 21:break;default:Ri(e,t),lr(t)}}function lr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(QA(n)){var s=n;break e}n=n.return}throw Error(me(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(rd(i,""),s.flags&=-33);var r=bE(t);aw(t,r,i);break;case 3:case 4:var o=s.stateNode.containerInfo,a=bE(t);ow(t,a,o);break;default:throw Error(me(161))}}catch(l){Ht(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function $j(t,e,n){Ce=t,tD(t)}function tD(t,e,n){for(var s=(t.mode&1)!==0;Ce!==null;){var i=Ce,r=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||cm;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Qn;a=cm;var c=Qn;if(cm=o,(Qn=l)&&!c)for(Ce=i;Ce!==null;)o=Ce,l=o.child,o.tag===22&&o.memoizedState!==null?SE(i):l!==null?(l.return=o,Ce=l):SE(i);for(;r!==null;)Ce=r,tD(r),r=r.sibling;Ce=i,cm=a,Qn=c}IE(t)}else i.subtreeFlags&8772&&r!==null?(r.return=i,Ce=r):IE(t)}}function IE(t){for(;Ce!==null;){var e=Ce;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Qn||Ry(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Qn)if(n===null)s.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Pi(e.type,n.memoizedProps);s.componentDidUpdate(i,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&lE(e,r,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}lE(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&cd(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}Qn||e.flags&512&&rw(e)}catch(f){Ht(e,e.return,f)}}if(e===t){Ce=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ce=n;break}Ce=e.return}}function kE(t){for(;Ce!==null;){var e=Ce;if(e===t){Ce=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ce=n;break}Ce=e.return}}function SE(t){for(;Ce!==null;){var e=Ce;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ry(4,e)}catch(l){Ht(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(l){Ht(e,i,l)}}var r=e.return;try{rw(e)}catch(l){Ht(e,r,l)}break;case 5:var o=e.return;try{rw(e)}catch(l){Ht(e,o,l)}}}catch(l){Ht(e,e.return,l)}if(e===t){Ce=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ce=a;break}Ce=e.return}}var Rj=Math.ceil,pg=fo.ReactCurrentDispatcher,h1=fo.ReactCurrentOwner,gi=fo.ReactCurrentBatchConfig,it=0,Rn=null,ln=null,Bn=0,zs=0,Ac=da(0),bn=0,_d=null,dl=0,Ay=0,d1=0,Hh=null,ws=null,f1=0,iu=1/0,Br=null,mg=!1,lw=null,Wo=null,um=!1,Ao=null,gg=0,qh=0,cw=null,Mm=-1,zm=0;function hs(){return it&6?tn():Mm!==-1?Mm:Mm=tn()}function Vo(t){return t.mode&1?it&2&&Bn!==0?Bn&-Bn:pj.transition!==null?(zm===0&&(zm=zR()),zm):(t=gt,t!==0||(t=window.event,t=t===void 0?16:HR(t.type)),t):1}function ji(t,e,n,s){if(50<qh)throw qh=0,cw=null,Error(me(185));Xd(t,n,s),(!(it&2)||t!==Rn)&&(t===Rn&&(!(it&2)&&(Ay|=n),bn===4&&So(t,Bn)),$s(t,s),n===1&&it===0&&!(e.mode&1)&&(iu=tn()+500,Ey&&fa()))}function $s(t,e){var n=t.callbackNode;pV(t,e);var s=Jm(t,t===Rn?Bn:0);if(s===0)n!==null&&OT(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&OT(n),e===1)t.tag===0?fj(TE.bind(null,t)):hA(TE.bind(null,t)),cj(function(){!(it&6)&&fa()}),n=null;else{switch(BR(s)){case 1:n=zb;break;case 4:n=FR;break;case 16:n=Qm;break;case 536870912:n=MR;break;default:n=Qm}n=cD(n,nD.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function nD(t,e){if(Mm=-1,zm=0,it&6)throw Error(me(327));var n=t.callbackNode;if(Uc()&&t.callbackNode!==n)return null;var s=Jm(t,t===Rn?Bn:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=yg(t,s);else{e=s;var i=it;it|=2;var r=iD();(Rn!==t||Bn!==e)&&(Br=null,iu=tn()+500,sl(t,e));do try{Pj();break}catch(a){sD(t,a)}while(!0);Qb(),pg.current=r,it=i,ln!==null?e=0:(Rn=null,Bn=0,e=bn)}if(e!==0){if(e===2&&(i=L0(t),i!==0&&(s=i,e=uw(t,i))),e===1)throw n=_d,sl(t,0),So(t,s),$s(t,tn()),n;if(e===6)So(t,s);else{if(i=t.current.alternate,!(s&30)&&!Aj(i)&&(e=yg(t,s),e===2&&(r=L0(t),r!==0&&(s=r,e=uw(t,r))),e===1))throw n=_d,sl(t,0),So(t,s),$s(t,tn()),n;switch(t.finishedWork=i,t.finishedLanes=s,e){case 0:case 1:throw Error(me(345));case 2:za(t,ws,Br);break;case 3:if(So(t,s),(s&130023424)===s&&(e=f1+500-tn(),10<e)){if(Jm(t,0)!==0)break;if(i=t.suspendedLanes,(i&s)!==s){hs(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=j0(za.bind(null,t,ws,Br),e);break}za(t,ws,Br);break;case 4:if(So(t,s),(s&4194240)===s)break;for(e=t.eventTimes,i=-1;0<s;){var o=31-Vi(s);r=1<<o,o=e[o],o>i&&(i=o),s&=~r}if(s=i,s=tn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Rj(s/1960))-s,10<s){t.timeoutHandle=j0(za.bind(null,t,ws,Br),s);break}za(t,ws,Br);break;case 5:za(t,ws,Br);break;default:throw Error(me(329))}}}return $s(t,tn()),t.callbackNode===n?nD.bind(null,t):null}function uw(t,e){var n=Hh;return t.current.memoizedState.isDehydrated&&(sl(t,e).flags|=256),t=yg(t,e),t!==2&&(e=ws,ws=n,e!==null&&hw(e)),t}function hw(t){ws===null?ws=t:ws.push.apply(ws,t)}function Aj(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var i=n[s],r=i.getSnapshot;i=i.value;try{if(!Xi(r(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function So(t,e){for(e&=~d1,e&=~Ay,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Vi(e),s=1<<n;t[n]=-1,e&=~s}}function TE(t){if(it&6)throw Error(me(327));Uc();var e=Jm(t,0);if(!(e&1))return $s(t,tn()),null;var n=yg(t,e);if(t.tag!==0&&n===2){var s=L0(t);s!==0&&(e=s,n=uw(t,s))}if(n===1)throw n=_d,sl(t,0),So(t,e),$s(t,tn()),n;if(n===6)throw Error(me(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,za(t,ws,Br),$s(t,tn()),null}function p1(t,e){var n=it;it|=1;try{return t(e)}finally{it=n,it===0&&(iu=tn()+500,Ey&&fa())}}function fl(t){Ao!==null&&Ao.tag===0&&!(it&6)&&Uc();var e=it;it|=1;var n=gi.transition,s=gt;try{if(gi.transition=null,gt=1,t)return t()}finally{gt=s,gi.transition=n,it=e,!(it&6)&&fa()}}function m1(){zs=Ac.current,Pt(Ac)}function sl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,lj(n)),ln!==null)for(n=ln.return;n!==null;){var s=n;switch(Xb(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&ig();break;case 3:nu(),Pt(Es),Pt(ss),i1();break;case 5:s1(s);break;case 4:nu();break;case 13:Pt(Wt);break;case 19:Pt(Wt);break;case 10:Jb(s.type._context);break;case 22:case 23:m1()}n=n.return}if(Rn=t,ln=t=jo(t.current,null),Bn=zs=e,bn=0,_d=null,d1=Ay=dl=0,ws=Hh=null,Xa!==null){for(e=0;e<Xa.length;e++)if(n=Xa[e],s=n.interleaved,s!==null){n.interleaved=null;var i=s.next,r=n.pending;if(r!==null){var o=r.next;r.next=i,s.next=o}n.pending=s}Xa=null}return t}function sD(t,e){do{var n=ln;try{if(Qb(),Om.current=fg,dg){for(var s=jt.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}dg=!1}if(hl=0,Tn=vn=jt=null,jh=!1,yd=0,h1.current=null,n===null||n.return===null){bn=1,_d=e,ln=null;break}e:{var r=t,o=n.return,a=n,l=e;if(e=Bn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=pE(o);if(m!==null){m.flags&=-257,mE(m,o,a,r,e),m.mode&1&&fE(r,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var x=new Set;x.add(l),e.updateQueue=x}else g.add(l);break e}else{if(!(e&1)){fE(r,c,e),g1();break e}l=Error(me(426))}}else if(Ft&&a.mode&1){var _=pE(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),mE(_,o,a,r,e),Zb(su(l,a));break e}}r=l=su(l,a),bn!==4&&(bn=2),Hh===null?Hh=[r]:Hh.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var v=BA(r,l,e);aE(r,v);break e;case 1:a=l;var w=r.type,b=r.stateNode;if(!(r.flags&128)&&(typeof w.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Wo===null||!Wo.has(b)))){r.flags|=65536,e&=-e,r.lanes|=e;var I=UA(r,a,e);aE(r,I);break e}}r=r.return}while(r!==null)}oD(n)}catch(S){e=S,ln===n&&n!==null&&(ln=n=n.return);continue}break}while(!0)}function iD(){var t=pg.current;return pg.current=fg,t===null?fg:t}function g1(){(bn===0||bn===3||bn===2)&&(bn=4),Rn===null||!(dl&268435455)&&!(Ay&268435455)||So(Rn,Bn)}function yg(t,e){var n=it;it|=2;var s=iD();(Rn!==t||Bn!==e)&&(Br=null,sl(t,e));do try{Dj();break}catch(i){sD(t,i)}while(!0);if(Qb(),it=n,pg.current=s,ln!==null)throw Error(me(261));return Rn=null,Bn=0,bn}function Dj(){for(;ln!==null;)rD(ln)}function Pj(){for(;ln!==null&&!rV();)rD(ln)}function rD(t){var e=lD(t.alternate,t,zs);t.memoizedProps=t.pendingProps,e===null?oD(t):ln=e,h1.current=null}function oD(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Tj(n,e),n!==null){n.flags&=32767,ln=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{bn=6,ln=null;return}}else if(n=Sj(n,e,zs),n!==null){ln=n;return}if(e=e.sibling,e!==null){ln=e;return}ln=e=t}while(e!==null);bn===0&&(bn=5)}function za(t,e,n){var s=gt,i=gi.transition;try{gi.transition=null,gt=1,Oj(t,e,n,s)}finally{gi.transition=i,gt=s}return null}function Oj(t,e,n,s){do Uc();while(Ao!==null);if(it&6)throw Error(me(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(me(177));t.callbackNode=null,t.callbackPriority=0;var r=n.lanes|n.childLanes;if(mV(t,r),t===Rn&&(ln=Rn=null,Bn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||um||(um=!0,cD(Qm,function(){return Uc(),null})),r=(n.flags&15990)!==0,n.subtreeFlags&15990||r){r=gi.transition,gi.transition=null;var o=gt;gt=1;var a=it;it|=4,h1.current=null,Nj(t,n),eD(n,t),tj(W0),eg=!!U0,W0=U0=null,t.current=n,$j(n),oV(),it=a,gt=o,gi.transition=r}else t.current=n;if(um&&(um=!1,Ao=t,gg=i),r=t.pendingLanes,r===0&&(Wo=null),cV(n.stateNode),$s(t,tn()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],s(i.value,{componentStack:i.stack,digest:i.digest});if(mg)throw mg=!1,t=lw,lw=null,t;return gg&1&&t.tag!==0&&Uc(),r=t.pendingLanes,r&1?t===cw?qh++:(qh=0,cw=t):qh=0,fa(),null}function Uc(){if(Ao!==null){var t=BR(gg),e=gi.transition,n=gt;try{if(gi.transition=null,gt=16>t?16:t,Ao===null)var s=!1;else{if(t=Ao,Ao=null,gg=0,it&6)throw Error(me(331));var i=it;for(it|=4,Ce=t.current;Ce!==null;){var r=Ce,o=r.child;if(Ce.flags&16){var a=r.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Ce=c;Ce!==null;){var h=Ce;switch(h.tag){case 0:case 11:case 15:Gh(8,h,r)}var d=h.child;if(d!==null)d.return=h,Ce=d;else for(;Ce!==null;){h=Ce;var f=h.sibling,m=h.return;if(YA(h),h===c){Ce=null;break}if(f!==null){f.return=m,Ce=f;break}Ce=m}}}var g=r.alternate;if(g!==null){var x=g.child;if(x!==null){g.child=null;do{var _=x.sibling;x.sibling=null,x=_}while(x!==null)}}Ce=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,Ce=o;else e:for(;Ce!==null;){if(r=Ce,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Gh(9,r,r.return)}var v=r.sibling;if(v!==null){v.return=r.return,Ce=v;break e}Ce=r.return}}var w=t.current;for(Ce=w;Ce!==null;){o=Ce;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Ce=b;else e:for(o=w;Ce!==null;){if(a=Ce,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ry(9,a)}}catch(S){Ht(a,a.return,S)}if(a===o){Ce=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,Ce=I;break e}Ce=a.return}}if(it=i,fa(),yr&&typeof yr.onPostCommitFiberRoot=="function")try{yr.onPostCommitFiberRoot(Cy,t)}catch{}s=!0}return s}finally{gt=n,gi.transition=e}}return!1}function EE(t,e,n){e=su(n,e),e=BA(t,e,1),t=Uo(t,e,1),e=hs(),t!==null&&(Xd(t,1,e),$s(t,e))}function Ht(t,e,n){if(t.tag===3)EE(t,t,n);else for(;e!==null;){if(e.tag===3){EE(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Wo===null||!Wo.has(s))){t=su(n,t),t=UA(e,t,1),e=Uo(e,t,1),t=hs(),e!==null&&(Xd(e,1,t),$s(e,t));break}}e=e.return}}function Lj(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=hs(),t.pingedLanes|=t.suspendedLanes&n,Rn===t&&(Bn&n)===n&&(bn===4||bn===3&&(Bn&130023424)===Bn&&500>tn()-f1?sl(t,0):d1|=n),$s(t,e)}function aD(t,e){e===0&&(t.mode&1?(e=em,em<<=1,!(em&130023424)&&(em=4194304)):e=1);var n=hs();t=no(t,e),t!==null&&(Xd(t,e,n),$s(t,n))}function Fj(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),aD(t,n)}function Mj(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(me(314))}s!==null&&s.delete(e),aD(t,n)}var lD;lD=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Es.current)Cs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Cs=!1,kj(t,e,n);Cs=!!(t.flags&131072)}else Cs=!1,Ft&&e.flags&1048576&&dA(e,ag,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Fm(t,e),t=e.pendingProps;var i=Jc(e,ss.current);Bc(e,n),i=o1(null,e,s,t,i,n);var r=a1();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ns(s)?(r=!0,rg(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,t1(e),i.updater=$y,e.stateNode=i,i._reactInternals=e,Y0(e,s,t,n),e=ew(null,e,s,!0,r,n)):(e.tag=0,Ft&&r&&Kb(e),as(null,e,i,n),e=e.child),e;case 16:s=e.elementType;e:{switch(Fm(t,e),t=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=Bj(s),t=Pi(s,t),i){case 0:e=J0(null,e,s,t,n);break e;case 1:e=vE(null,e,s,t,n);break e;case 11:e=gE(null,e,s,t,n);break e;case 14:e=yE(null,e,s,Pi(s.type,t),n);break e}throw Error(me(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Pi(s,i),J0(t,e,s,i,n);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Pi(s,i),vE(t,e,s,i,n);case 3:e:{if(GA(e),t===null)throw Error(me(387));s=e.pendingProps,r=e.memoizedState,i=r.element,vA(t,e),ug(e,s,null,n);var o=e.memoizedState;if(s=o.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=su(Error(me(423)),e),e=xE(t,e,s,n,i);break e}else if(s!==i){i=su(Error(me(424)),e),e=xE(t,e,s,n,i);break e}else for(Us=Bo(e.stateNode.containerInfo.firstChild),Vs=e,Ft=!0,Li=null,n=gA(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(eu(),s===i){e=so(t,e,n);break e}as(t,e,s,n)}e=e.child}return e;case 5:return xA(e),t===null&&K0(e),s=e.type,i=e.pendingProps,r=t!==null?t.memoizedProps:null,o=i.children,V0(s,i)?o=null:r!==null&&V0(s,r)&&(e.flags|=32),jA(t,e),as(t,e,o,n),e.child;case 6:return t===null&&K0(e),null;case 13:return HA(t,e,n);case 4:return n1(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=tu(e,null,s,n):as(t,e,s,n),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Pi(s,i),gE(t,e,s,i,n);case 7:return as(t,e,e.pendingProps,n),e.child;case 8:return as(t,e,e.pendingProps.children,n),e.child;case 12:return as(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,Tt(lg,s._currentValue),s._currentValue=o,r!==null)if(Xi(r.value,o)){if(r.children===i.children&&!Es.current){e=so(t,e,n);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var a=r.dependencies;if(a!==null){o=r.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(r.tag===1){l=Yr(-1,n&-n),l.tag=2;var c=r.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}r.lanes|=n,l=r.alternate,l!==null&&(l.lanes|=n),X0(r.return,n,e),a.lanes|=n;break}l=l.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(me(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),X0(o,n,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}as(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,Bc(e,n),i=vi(i),s=s(i),e.flags|=1,as(t,e,s,n),e.child;case 14:return s=e.type,i=Pi(s,e.pendingProps),i=Pi(s.type,i),yE(t,e,s,i,n);case 15:return WA(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Pi(s,i),Fm(t,e),e.tag=1,Ns(s)?(t=!0,rg(e)):t=!1,Bc(e,n),zA(e,s,i),Y0(e,s,i,n),ew(null,e,s,!0,t,n);case 19:return qA(t,e,n);case 22:return VA(t,e,n)}throw Error(me(156,e.tag))};function cD(t,e){return LR(t,e)}function zj(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ui(t,e,n,s){return new zj(t,e,n,s)}function y1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Bj(t){if(typeof t=="function")return y1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Lb)return 11;if(t===Fb)return 14}return 2}function jo(t,e){var n=t.alternate;return n===null?(n=ui(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Bm(t,e,n,s,i,r){var o=2;if(s=t,typeof t=="function")y1(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case bc:return il(n.children,i,r,e);case Ob:o=8,i|=8;break;case w0:return t=ui(12,n,e,i|2),t.elementType=w0,t.lanes=r,t;case b0:return t=ui(13,n,e,i),t.elementType=b0,t.lanes=r,t;case C0:return t=ui(19,n,e,i),t.elementType=C0,t.lanes=r,t;case xR:return Dy(n,i,r,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case yR:o=10;break e;case vR:o=9;break e;case Lb:o=11;break e;case Fb:o=14;break e;case bo:o=16,s=null;break e}throw Error(me(130,t==null?t:typeof t,""))}return e=ui(o,n,e,i),e.elementType=t,e.type=s,e.lanes=r,e}function il(t,e,n,s){return t=ui(7,t,s,e),t.lanes=n,t}function Dy(t,e,n,s){return t=ui(22,t,s,e),t.elementType=xR,t.lanes=n,t.stateNode={isHidden:!1},t}function R_(t,e,n){return t=ui(6,t,null,e),t.lanes=n,t}function A_(t,e,n){return e=ui(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Uj(t,e,n,s,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=d_(0),this.expirationTimes=d_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=d_(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function v1(t,e,n,s,i,r,o,a,l){return t=new Uj(t,e,n,a,l),e===1?(e=1,r===!0&&(e|=8)):e=0,r=ui(3,null,null,e),t.current=r,r.stateNode=t,r.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},t1(r),t}function Wj(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wc,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function uD(t){if(!t)return ea;t=t._reactInternals;e:{if(Ml(t)!==t||t.tag!==1)throw Error(me(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ns(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(t.tag===1){var n=t.type;if(Ns(n))return uA(t,n,e)}return e}function hD(t,e,n,s,i,r,o,a,l){return t=v1(n,s,!0,t,i,r,o,a,l),t.context=uD(null),n=t.current,s=hs(),i=Vo(n),r=Yr(s,i),r.callback=e??null,Uo(n,r,i),t.current.lanes=i,Xd(t,i,s),$s(t,s),t}function Py(t,e,n,s){var i=e.current,r=hs(),o=Vo(i);return n=uD(n),e.context===null?e.context=n:e.pendingContext=n,e=Yr(r,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=Uo(i,e,o),t!==null&&(ji(t,i,o,r),Pm(t,i,o)),o}function vg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function NE(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function x1(t,e){NE(t,e),(t=t.alternate)&&NE(t,e)}function Vj(){return null}var dD=typeof reportError=="function"?reportError:function(t){console.error(t)};function _1(t){this._internalRoot=t}Oy.prototype.render=_1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(me(409));Py(t,e,null,null)};Oy.prototype.unmount=_1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;fl(function(){Py(null,t,null,null)}),e[to]=null}};function Oy(t){this._internalRoot=t}Oy.prototype.unstable_scheduleHydration=function(t){if(t){var e=VR();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ko.length&&e!==0&&e<ko[n].priority;n++);ko.splice(n,0,t),n===0&&GR(t)}};function w1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ly(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $E(){}function jj(t,e,n,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var c=vg(o);r.call(c)}}var o=hD(e,s,t,0,null,!1,!1,"",$E);return t._reactRootContainer=o,t[to]=o.current,dd(t.nodeType===8?t.parentNode:t),fl(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof s=="function"){var a=s;s=function(){var c=vg(l);a.call(c)}}var l=v1(t,0,!1,null,null,!1,!1,"",$E);return t._reactRootContainer=l,t[to]=l.current,dd(t.nodeType===8?t.parentNode:t),fl(function(){Py(e,l,n,s)}),l}function Fy(t,e,n,s,i){var r=n._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var a=i;i=function(){var l=vg(o);a.call(l)}}Py(e,o,t,i)}else o=jj(n,e,t,i,s);return vg(o)}UR=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Nh(e.pendingLanes);n!==0&&(Bb(e,n|1),$s(e,tn()),!(it&6)&&(iu=tn()+500,fa()))}break;case 13:fl(function(){var s=no(t,1);if(s!==null){var i=hs();ji(s,t,1,i)}}),x1(t,1)}};Ub=function(t){if(t.tag===13){var e=no(t,134217728);if(e!==null){var n=hs();ji(e,t,134217728,n)}x1(t,134217728)}};WR=function(t){if(t.tag===13){var e=Vo(t),n=no(t,e);if(n!==null){var s=hs();ji(n,t,e,s)}x1(t,e)}};VR=function(){return gt};jR=function(t,e){var n=gt;try{return gt=t,e()}finally{gt=n}};D0=function(t,e,n){switch(e){case"input":if(S0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var i=Ty(s);if(!i)throw Error(me(90));wR(s),S0(s,i)}}}break;case"textarea":CR(t,n);break;case"select":e=n.value,e!=null&&Lc(t,!!n.multiple,e,!1)}};$R=p1;RR=fl;var Gj={usingClientEntryPoint:!1,Events:[Yd,Sc,Ty,ER,NR,p1]},yh={findFiberByHostInstance:Ka,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hj={bundleType:yh.bundleType,version:yh.version,rendererPackageName:yh.rendererPackageName,rendererConfig:yh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=PR(t),t===null?null:t.stateNode},findFiberByHostInstance:yh.findFiberByHostInstance||Vj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hm.isDisabled&&hm.supportsFiber)try{Cy=hm.inject(Hj),yr=hm}catch{}}Ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gj;Ks.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!w1(e))throw Error(me(200));return Wj(t,e,null,n)};Ks.createRoot=function(t,e){if(!w1(t))throw Error(me(299));var n=!1,s="",i=dD;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=v1(t,1,!1,null,null,n,!1,s,i),t[to]=e.current,dd(t.nodeType===8?t.parentNode:t),new _1(e)};Ks.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(me(188)):(t=Object.keys(t).join(","),Error(me(268,t)));return t=PR(e),t=t===null?null:t.stateNode,t};Ks.flushSync=function(t){return fl(t)};Ks.hydrate=function(t,e,n){if(!Ly(e))throw Error(me(200));return Fy(null,t,e,!0,n)};Ks.hydrateRoot=function(t,e,n){if(!w1(t))throw Error(me(405));var s=n!=null&&n.hydratedSources||null,i=!1,r="",o=dD;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=hD(e,null,t,1,n??null,i,!1,r,o),t[to]=e.current,dd(t),s)for(t=0;t<s.length;t++)n=s[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Oy(e)};Ks.render=function(t,e,n){if(!Ly(e))throw Error(me(200));return Fy(null,t,e,!1,n)};Ks.unmountComponentAtNode=function(t){if(!Ly(t))throw Error(me(40));return t._reactRootContainer?(fl(function(){Fy(null,null,t,!1,function(){t._reactRootContainer=null,t[to]=null})}),!0):!1};Ks.unstable_batchedUpdates=p1;Ks.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Ly(n))throw Error(me(200));if(t==null||t._reactInternals===void 0)throw Error(me(38));return Fy(t,e,n,!1,s)};Ks.version="18.3.1-next-f1338f8080-20240426";function fD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fD)}catch(t){console.error(t)}}fD(),fR.exports=Ks;var pD=fR.exports,mD,RE=pD;mD=RE.createRoot,RE.hydrateRoot;/**
 * @remix-run/router v1.22.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wd(){return wd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},wd.apply(this,arguments)}var Do;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Do||(Do={}));const AE="popstate";function qj(t){t===void 0&&(t={});function e(s,i){let{pathname:r,search:o,hash:a}=s.location;return dw("",{pathname:r,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(s,i){return typeof i=="string"?i:xg(i)}return Xj(e,n,null,t)}function hn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function gD(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Kj(){return Math.random().toString(36).substr(2,8)}function DE(t,e){return{usr:t.state,key:t.key,idx:e}}function dw(t,e,n,s){return n===void 0&&(n=null),wd({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Iu(e):e,{state:n,key:e&&e.key||s||Kj()})}function xg(t){let{pathname:e="/",search:n="",hash:s=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Iu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function Xj(t,e,n,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:r=!1}=s,o=i.history,a=Do.Pop,l=null,c=h();c==null&&(c=0,o.replaceState(wd({},o.state,{idx:c}),""));function h(){return(o.state||{idx:null}).idx}function d(){a=Do.Pop;let _=h(),v=_==null?null:_-c;c=_,l&&l({action:a,location:x.location,delta:v})}function f(_,v){a=Do.Push;let w=dw(x.location,_,v);c=h()+1;let b=DE(w,c),I=x.createHref(w);try{o.pushState(b,"",I)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;i.location.assign(I)}r&&l&&l({action:a,location:x.location,delta:1})}function m(_,v){a=Do.Replace;let w=dw(x.location,_,v);c=h();let b=DE(w,c),I=x.createHref(w);o.replaceState(b,"",I),r&&l&&l({action:a,location:x.location,delta:0})}function g(_){let v=i.location.origin!=="null"?i.location.origin:i.location.href,w=typeof _=="string"?_:xg(_);return w=w.replace(/ $/,"%20"),hn(v,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,v)}let x={get action(){return a},get location(){return t(i,o)},listen(_){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(AE,d),l=_,()=>{i.removeEventListener(AE,d),l=null}},createHref(_){return e(i,_)},createURL:g,encodeLocation(_){let v=g(_);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:f,replace:m,go(_){return o.go(_)}};return x}var PE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(PE||(PE={}));function Zj(t,e,n){return n===void 0&&(n="/"),Yj(t,e,n)}function Yj(t,e,n,s){let i=typeof e=="string"?Iu(e):e,r=b1(i.pathname||"/",n);if(r==null)return null;let o=yD(t);Qj(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=uG(r);a=aG(o[l],c)}return a}function yD(t,e,n,s){e===void 0&&(e=[]),n===void 0&&(n=[]),s===void 0&&(s="");let i=(r,o,a)=>{let l={relativePath:a===void 0?r.path||"":a,caseSensitive:r.caseSensitive===!0,childrenIndex:o,route:r};l.relativePath.startsWith("/")&&(hn(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let c=Go([s,l.relativePath]),h=n.concat(l);r.children&&r.children.length>0&&(hn(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),yD(r.children,e,h,c)),!(r.path==null&&!r.index)&&e.push({path:c,score:rG(c,r.index),routesMeta:h})};return t.forEach((r,o)=>{var a;if(r.path===""||!((a=r.path)!=null&&a.includes("?")))i(r,o);else for(let l of vD(r.path))i(r,o,l)}),e}function vD(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,i=n.endsWith("?"),r=n.replace(/\?$/,"");if(s.length===0)return i?[r,""]:[r];let o=vD(s.join("/")),a=[];return a.push(...o.map(l=>l===""?r:[r,l].join("/"))),i&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function Qj(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:oG(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const Jj=/^:[\w-]+$/,eG=3,tG=2,nG=1,sG=10,iG=-2,OE=t=>t==="*";function rG(t,e){let n=t.split("/"),s=n.length;return n.some(OE)&&(s+=iG),e&&(s+=tG),n.filter(i=>!OE(i)).reduce((i,r)=>i+(Jj.test(r)?eG:r===""?nG:sG),s)}function oG(t,e){return t.length===e.length&&t.slice(0,-1).every((s,i)=>s===e[i])?t[t.length-1]-e[e.length-1]:0}function aG(t,e,n){let{routesMeta:s}=t,i={},r="/",o=[];for(let a=0;a<s.length;++a){let l=s[a],c=a===s.length-1,h=r==="/"?e:e.slice(r.length)||"/",d=lG({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},h),f=l.route;if(!d)return null;Object.assign(i,d.params),o.push({params:i,pathname:Go([r,d.pathname]),pathnameBase:pG(Go([r,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(r=Go([r,d.pathnameBase]))}return o}function lG(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=cG(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let r=i[0],o=r.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:s.reduce((c,h,d)=>{let{paramName:f,isOptional:m}=h;if(f==="*"){let x=a[d]||"";o=r.slice(0,r.length-x.length).replace(/(.)\/+$/,"$1")}const g=a[d];return m&&!g?c[f]=void 0:c[f]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:r,pathnameBase:o,pattern:t}}function cG(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),gD(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function uG(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return gD(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function b1(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}function hG(t,e){e===void 0&&(e="/");let{pathname:n,search:s="",hash:i=""}=typeof t=="string"?Iu(t):t;return{pathname:n?n.startsWith("/")?n:dG(n,e):e,search:mG(s),hash:gG(i)}}function dG(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function D_(t,e,n,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function fG(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function xD(t,e){let n=fG(t);return e?n.map((s,i)=>i===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function _D(t,e,n,s){s===void 0&&(s=!1);let i;typeof t=="string"?i=Iu(t):(i=wd({},t),hn(!i.pathname||!i.pathname.includes("?"),D_("?","pathname","search",i)),hn(!i.pathname||!i.pathname.includes("#"),D_("#","pathname","hash",i)),hn(!i.search||!i.search.includes("#"),D_("#","search","hash",i)));let r=t===""||i.pathname==="",o=r?"/":i.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!s&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=hG(i,a),c=o&&o!=="/"&&o.endsWith("/"),h=(r||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}const Go=t=>t.join("/").replace(/\/\/+/g,"/"),pG=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),mG=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,gG=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function yG(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const wD=["post","put","patch","delete"];new Set(wD);const vG=["get",...wD];new Set(vG);/**
 * React Router v6.29.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bd(){return bd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},bd.apply(this,arguments)}const C1=ne.createContext(null),xG=ne.createContext(null),zl=ne.createContext(null),My=ne.createContext(null),Bl=ne.createContext({outlet:null,matches:[],isDataRoute:!1}),bD=ne.createContext(null);function _G(t,e){let{relative:n}=e===void 0?{}:e;Jd()||hn(!1);let{basename:s,navigator:i}=ne.useContext(zl),{hash:r,pathname:o,search:a}=kD(t,{relative:n}),l=o;return s!=="/"&&(l=o==="/"?s:Go([s,o])),i.createHref({pathname:l,search:a,hash:r})}function Jd(){return ne.useContext(My)!=null}function zy(){return Jd()||hn(!1),ne.useContext(My).location}function CD(t){ne.useContext(zl).static||ne.useLayoutEffect(t)}function ID(){let{isDataRoute:t}=ne.useContext(Bl);return t?DG():wG()}function wG(){Jd()||hn(!1);let t=ne.useContext(C1),{basename:e,future:n,navigator:s}=ne.useContext(zl),{matches:i}=ne.useContext(Bl),{pathname:r}=zy(),o=JSON.stringify(xD(i,n.v7_relativeSplatPath)),a=ne.useRef(!1);return CD(()=>{a.current=!0}),ne.useCallback(function(c,h){if(h===void 0&&(h={}),!a.current)return;if(typeof c=="number"){s.go(c);return}let d=_D(c,JSON.parse(o),r,h.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Go([e,d.pathname])),(h.replace?s.replace:s.push)(d,h.state,h)},[e,s,o,r,t])}function kD(t,e){let{relative:n}=e===void 0?{}:e,{future:s}=ne.useContext(zl),{matches:i}=ne.useContext(Bl),{pathname:r}=zy(),o=JSON.stringify(xD(i,s.v7_relativeSplatPath));return ne.useMemo(()=>_D(t,JSON.parse(o),r,n==="path"),[t,o,r,n])}function bG(t,e){return CG(t,e)}function CG(t,e,n,s){Jd()||hn(!1);let{navigator:i,static:r}=ne.useContext(zl),{matches:o}=ne.useContext(Bl),a=o[o.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let h=zy(),d;if(e){var f;let v=typeof e=="string"?Iu(e):e;c==="/"||(f=v.pathname)!=null&&f.startsWith(c)||hn(!1),d=v}else d=h;let m=d.pathname||"/",g=m;if(c!=="/"){let v=c.replace(/^\//,"").split("/");g="/"+m.replace(/^\//,"").split("/").slice(v.length).join("/")}let x=Zj(t,{pathname:g}),_=EG(x&&x.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:Go([c,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:Go([c,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,n,s);return e&&_?ne.createElement(My.Provider,{value:{location:bd({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Do.Pop}},_):_}function IG(){let t=AG(),e=yG(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ne.createElement(ne.Fragment,null,ne.createElement("h2",null,"Unexpected Application Error!"),ne.createElement("h3",{style:{fontStyle:"italic"}},e),n?ne.createElement("pre",{style:i},n):null,null)}const kG=ne.createElement(IG,null);class SG extends ne.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?ne.createElement(Bl.Provider,{value:this.props.routeContext},ne.createElement(bD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function TG(t){let{routeContext:e,match:n,children:s}=t,i=ne.useContext(C1);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),ne.createElement(Bl.Provider,{value:e},s)}function EG(t,e,n,s){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),s===void 0&&(s=null),t==null){var r;if(!n)return null;if(n.errors)t=n.matches;else if((r=s)!=null&&r.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(i=n)==null?void 0:i.errors;if(a!=null){let h=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);h>=0||hn(!1),o=o.slice(0,Math.min(o.length,h+1))}let l=!1,c=-1;if(n&&s&&s.v7_partialHydration)for(let h=0;h<o.length;h++){let d=o[h];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=h),d.route.id){let{loaderData:f,errors:m}=n,g=d.route.loader&&f[d.route.id]===void 0&&(!m||m[d.route.id]===void 0);if(d.route.lazy||g){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((h,d,f)=>{let m,g=!1,x=null,_=null;n&&(m=a&&d.route.id?a[d.route.id]:void 0,x=d.route.errorElement||kG,l&&(c<0&&f===0?(PG("route-fallback"),g=!0,_=null):c===f&&(g=!0,_=d.route.hydrateFallbackElement||null)));let v=e.concat(o.slice(0,f+1)),w=()=>{let b;return m?b=x:g?b=_:d.route.Component?b=ne.createElement(d.route.Component,null):d.route.element?b=d.route.element:b=h,ne.createElement(TG,{match:d,routeContext:{outlet:h,matches:v,isDataRoute:n!=null},children:b})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?ne.createElement(SG,{location:n.location,revalidation:n.revalidation,component:x,error:m,children:w(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):w()},null)}var SD=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(SD||{}),TD=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(TD||{});function NG(t){let e=ne.useContext(C1);return e||hn(!1),e}function $G(t){let e=ne.useContext(xG);return e||hn(!1),e}function RG(t){let e=ne.useContext(Bl);return e||hn(!1),e}function ED(t){let e=RG(),n=e.matches[e.matches.length-1];return n.route.id||hn(!1),n.route.id}function AG(){var t;let e=ne.useContext(bD),n=$G(),s=ED();return e!==void 0?e:(t=n.errors)==null?void 0:t[s]}function DG(){let{router:t}=NG(SD.UseNavigateStable),e=ED(TD.UseNavigateStable),n=ne.useRef(!1);return CD(()=>{n.current=!0}),ne.useCallback(function(i,r){r===void 0&&(r={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,bd({fromRouteId:e},r)))},[t,e])}const LE={};function PG(t,e,n){LE[t]||(LE[t]=!0)}function OG(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Ba(t){hn(!1)}function LG(t){let{basename:e="/",children:n=null,location:s,navigationType:i=Do.Pop,navigator:r,static:o=!1,future:a}=t;Jd()&&hn(!1);let l=e.replace(/^\/*/,"/"),c=ne.useMemo(()=>({basename:l,navigator:r,static:o,future:bd({v7_relativeSplatPath:!1},a)}),[l,a,r,o]);typeof s=="string"&&(s=Iu(s));let{pathname:h="/",search:d="",hash:f="",state:m=null,key:g="default"}=s,x=ne.useMemo(()=>{let _=b1(h,l);return _==null?null:{location:{pathname:_,search:d,hash:f,state:m,key:g},navigationType:i}},[l,h,d,f,m,g,i]);return x==null?null:ne.createElement(zl.Provider,{value:c},ne.createElement(My.Provider,{children:n,value:x}))}function FG(t){let{children:e,location:n}=t;return bG(fw(e),n)}new Promise(()=>{});function fw(t,e){e===void 0&&(e=[]);let n=[];return ne.Children.forEach(t,(s,i)=>{if(!ne.isValidElement(s))return;let r=[...e,i];if(s.type===ne.Fragment){n.push.apply(n,fw(s.props.children,r));return}s.type!==Ba&&hn(!1),!s.props.index||!s.props.children||hn(!1);let o={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=fw(s.props.children,r)),n.push(o)}),n}/**
 * React Router DOM v6.29.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pw(){return pw=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},pw.apply(this,arguments)}function MG(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function zG(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function BG(t,e){return t.button===0&&(!e||e==="_self")&&!zG(t)}const UG=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],WG="6";try{window.__reactRouterVersion=WG}catch{}const VG="startTransition",FE=LW[VG];function jG(t){let{basename:e,children:n,future:s,window:i}=t,r=ne.useRef();r.current==null&&(r.current=qj({window:i,v5Compat:!0}));let o=r.current,[a,l]=ne.useState({action:o.action,location:o.location}),{v7_startTransition:c}=s||{},h=ne.useCallback(d=>{c&&FE?FE(()=>l(d)):l(d)},[l,c]);return ne.useLayoutEffect(()=>o.listen(h),[o,h]),ne.useEffect(()=>OG(s),[s]),ne.createElement(LG,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:s})}const GG=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",HG=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gn=ne.forwardRef(function(e,n){let{onClick:s,relative:i,reloadDocument:r,replace:o,state:a,target:l,to:c,preventScrollReset:h,viewTransition:d}=e,f=MG(e,UG),{basename:m}=ne.useContext(zl),g,x=!1;if(typeof c=="string"&&HG.test(c)&&(g=c,GG))try{let b=new URL(window.location.href),I=c.startsWith("//")?new URL(b.protocol+c):new URL(c),S=b1(I.pathname,m);I.origin===b.origin&&S!=null?c=S+I.search+I.hash:x=!0}catch{}let _=_G(c,{relative:i}),v=qG(c,{replace:o,state:a,target:l,preventScrollReset:h,relative:i,viewTransition:d});function w(b){s&&s(b),b.defaultPrevented||v(b)}return ne.createElement("a",pw({},f,{href:g||_,onClick:x||r?s:w,ref:n,target:l}))});var ME;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(ME||(ME={}));var zE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(zE||(zE={}));function qG(t,e){let{target:n,replace:s,state:i,preventScrollReset:r,relative:o,viewTransition:a}=e===void 0?{}:e,l=ID(),c=zy(),h=kD(t,{relative:o});return ne.useCallback(d=>{if(BG(d,n)){d.preventDefault();let f=s!==void 0?s:xg(c)===xg(h);l(t,{replace:f,state:i,preventScrollReset:r,relative:o,viewTransition:a})}},[c,l,h,s,i,n,t,r,o,a])}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var KG={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XG=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),zt=(t,e)=>{const n=ne.forwardRef(({color:s="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:a="",children:l,...c},h)=>ne.createElement("svg",{ref:h,...KG,width:i,height:i,stroke:s,strokeWidth:o?Number(r)*24/Number(i):r,className:["lucide",`lucide-${XG(t)}`,a].join(" "),...c},[...e.map(([d,f])=>ne.createElement(d,f)),...Array.isArray(l)?l:[l]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=zt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mw=zt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BE=zt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UE=zt("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=zt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZG=zt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YG=zt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QG=zt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ND=zt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JG=zt("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WE=zt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eH=zt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tH=zt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gw=zt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nH=zt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sH=zt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iH=zt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rH=zt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VE=zt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jE=zt("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oH=zt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aH=zt("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=zt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lH=zt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var GE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $D={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge=function(t,e){if(!t)throw ku(e)},ku=function(t){return new Error("Firebase Database ("+$D.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},cH=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},I1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,c=l?t[i+2]:0,h=r>>2,d=(r&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),s.push(n[h],n[d],n[f],n[m])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(RD(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):cH(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const r=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const c=i<t.length?n[t.charAt(i)]:64;++i;const d=i<t.length?n[t.charAt(i)]:64;if(++i,r==null||a==null||c==null||d==null)throw new uH;const f=r<<2|a>>4;if(s.push(f),c!==64){const m=a<<4&240|c>>2;if(s.push(m),d!==64){const g=c<<6&192|d;s.push(g)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class uH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const AD=function(t){const e=RD(t);return I1.encodeByteArray(e,!0)},bg=function(t){return AD(t).replace(/\./g,"")},Cg=function(t){try{return I1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hH(t){return DD(void 0,t)}function DD(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!dH(n)||(t[n]=DD(t[n],e[n]));return t}function dH(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fH(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pH=()=>fH().__FIREBASE_DEFAULTS__,mH=()=>{if(typeof process>"u"||typeof GE>"u")return;const t=GE.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},gH=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Cg(t[1]);return e&&JSON.parse(e)},k1=()=>{try{return pH()||mH()||gH()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},PD=t=>{var e,n;return(n=(e=k1())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},yH=t=>{const e=PD(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},OD=()=>{var t;return(t=k1())===null||t===void 0?void 0:t.config},LD=t=>{var e;return(e=k1())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vH(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[bg(JSON.stringify(n)),bg(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function S1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fs())}function xH(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function FD(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function MD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function _H(){const t=fs();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function wH(){return $D.NODE_ADMIN===!0}function zD(){try{return typeof indexedDB=="object"}catch{return!1}}function BD(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(n){e(n)}})}function bH(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CH="FirebaseError";class Dr extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=CH,Object.setPrototypeOf(this,Dr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ul.prototype.create)}}class Ul{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?IH(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Dr(i,a,s)}}function IH(t,e){return t.replace(kH,(n,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const kH=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(t){return JSON.parse(t)}function Nn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=function(t){let e={},n={},s={},i="";try{const r=t.split(".");e=Cd(Cg(r[0])||""),n=Cd(Cg(r[1])||""),i=r[2],s=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:s,signature:i}},SH=function(t){const e=UD(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},TH=function(t){const e=UD(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ru(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function yw(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ig(t,e,n){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=e.call(n,t[i],i,t));return s}function Id(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const r=t[i],o=e[i];if(HE(r)&&HE(o)){if(!Id(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function HE(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Rh(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function Ah(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EH{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let d=0;d<16;d++)s[d]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let d=16;d<80;d++){const f=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(f<<1|f>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let d=0;d<80;d++){d<40?d<20?(c=a^r&(o^a),h=1518500249):(c=r^o^a,h=1859775393):d<60?(c=r&o|a&(r|o),h=2400959708):(c=r^o^a,h=3395469782);const f=(i<<5|i>>>27)+c+l+h+s[d]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=i,i=f}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const s=n-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<n;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<n;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function NH(t,e){const n=new $H(t,e);return n.subscribe.bind(n)}class $H{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let i;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");RH(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:s},i.next===void 0&&(i.next=P_),i.error===void 0&&(i.error=P_),i.complete===void 0&&(i.complete=P_);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function RH(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function P_(){}function T1(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AH=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,ge(s<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Uy=function(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DH=1e3,PH=2,OH=4*60*60*1e3,LH=.5;function qE(t,e=DH,n=PH){const s=e*Math.pow(n,t),i=Math.round(LH*s*(Math.random()-.5)*2);return Math.min(OH,s+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(t){return t&&t._delegate?t._delegate:t}class Zi{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FH{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new By;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(zH(e))try{this.getOrInitializeService({instanceIdentifier:Ua})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=Ua){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ua){return this.instances.has(e)}getOptions(e=Ua){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,n){var s;const i=this.normalizeInstanceIdentifier(n),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const i of s)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:MH(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ua){return this.component?this.component.multipleInstances?e:Ua:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function MH(t){return t===Ua?void 0:t}function zH(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BH{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new FH(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(xt||(xt={}));const UH={debug:xt.DEBUG,verbose:xt.VERBOSE,info:xt.INFO,warn:xt.WARN,error:xt.ERROR,silent:xt.SILENT},WH=xt.INFO,VH={[xt.DEBUG]:"log",[xt.VERBOSE]:"log",[xt.INFO]:"info",[xt.WARN]:"warn",[xt.ERROR]:"error"},jH=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),i=VH[e];if(i)console[i](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Wy=class{constructor(e){this.name=e,this._logLevel=WH,this._logHandler=jH,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?UH[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xt.DEBUG,...e),this._logHandler(this,xt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xt.VERBOSE,...e),this._logHandler(this,xt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xt.INFO,...e),this._logHandler(this,xt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xt.WARN,...e),this._logHandler(this,xt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xt.ERROR,...e),this._logHandler(this,xt.ERROR,...e)}};const GH=(t,e)=>e.some(n=>t instanceof n);let KE,XE;function HH(){return KE||(KE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qH(){return XE||(XE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WD=new WeakMap,vw=new WeakMap,VD=new WeakMap,O_=new WeakMap,E1=new WeakMap;function KH(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(Ho(t.result)),i()},o=()=>{s(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&WD.set(n,t)}).catch(()=>{}),E1.set(e,t),e}function XH(t){if(vw.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),i()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});vw.set(t,e)}let xw={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return vw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||VD.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ho(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ZH(t){xw=t(xw)}function YH(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(L_(this),e,...n);return VD.set(s,e.sort?e.sort():[e]),Ho(s)}:qH().includes(t)?function(...e){return t.apply(L_(this),e),Ho(WD.get(this))}:function(...e){return Ho(t.apply(L_(this),e))}}function QH(t){return typeof t=="function"?YH(t):(t instanceof IDBTransaction&&XH(t),GH(t,HH())?new Proxy(t,xw):t)}function Ho(t){if(t instanceof IDBRequest)return KH(t);if(O_.has(t))return O_.get(t);const e=QH(t);return e!==t&&(O_.set(t,e),E1.set(e,t)),e}const L_=t=>E1.get(t);function jD(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=Ho(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Ho(o.result),l.oldVersion,l.newVersion,Ho(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const JH=["get","getKey","getAll","getAllKeys","count"],e6=["put","add","delete","clear"],F_=new Map;function ZE(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(F_.get(e))return F_.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=e6.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||JH.includes(n)))return;const r=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return F_.set(e,r),r}ZH(t=>({...t,get:(e,n,s)=>ZE(e,n)||t.get(e,n,s),has:(e,n)=>!!ZE(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t6{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(n6(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function n6(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const _w="@firebase/app",YE="0.11.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const io=new Wy("@firebase/app"),s6="@firebase/app-compat",i6="@firebase/analytics-compat",r6="@firebase/analytics",o6="@firebase/app-check-compat",a6="@firebase/app-check",l6="@firebase/auth",c6="@firebase/auth-compat",u6="@firebase/database",h6="@firebase/data-connect",d6="@firebase/database-compat",f6="@firebase/functions",p6="@firebase/functions-compat",m6="@firebase/installations",g6="@firebase/installations-compat",y6="@firebase/messaging",v6="@firebase/messaging-compat",x6="@firebase/performance",_6="@firebase/performance-compat",w6="@firebase/remote-config",b6="@firebase/remote-config-compat",C6="@firebase/storage",I6="@firebase/storage-compat",k6="@firebase/firestore",S6="@firebase/vertexai",T6="@firebase/firestore-compat",E6="firebase",N6="11.3.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ww="[DEFAULT]",$6={[_w]:"fire-core",[s6]:"fire-core-compat",[r6]:"fire-analytics",[i6]:"fire-analytics-compat",[a6]:"fire-app-check",[o6]:"fire-app-check-compat",[l6]:"fire-auth",[c6]:"fire-auth-compat",[u6]:"fire-rtdb",[h6]:"fire-data-connect",[d6]:"fire-rtdb-compat",[f6]:"fire-fn",[p6]:"fire-fn-compat",[m6]:"fire-iid",[g6]:"fire-iid-compat",[y6]:"fire-fcm",[v6]:"fire-fcm-compat",[x6]:"fire-perf",[_6]:"fire-perf-compat",[w6]:"fire-rc",[b6]:"fire-rc-compat",[C6]:"fire-gcs",[I6]:"fire-gcs-compat",[k6]:"fire-fst",[T6]:"fire-fst-compat",[S6]:"fire-vertex","fire-js":"fire-js",[E6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kd=new Map,R6=new Map,bw=new Map;function QE(t,e){try{t.container.addComponent(e)}catch(n){io.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tr(t){const e=t.name;if(bw.has(e))return io.debug(`There were multiple attempts to register component ${e}.`),!1;bw.set(e,t);for(const n of kd.values())QE(n,t);for(const n of R6.values())QE(n,t);return!0}function Wl(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function li(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A6={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qo=new Ul("app","Firebase",A6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Zi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu=N6;function N1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:ww,automaticDataCollectionEnabled:!1},e),i=s.name;if(typeof i!="string"||!i)throw qo.create("bad-app-name",{appName:String(i)});if(n||(n=OD()),!n)throw qo.create("no-options");const r=kd.get(i);if(r){if(Id(n,r.options)&&Id(s,r.config))return r;throw qo.create("duplicate-app",{appName:i})}const o=new BH(i);for(const l of bw.values())o.addComponent(l);const a=new D6(n,s,o);return kd.set(i,a),a}function Vy(t=ww){const e=kd.get(t);if(!e&&t===ww&&OD())return N1();if(!e)throw qo.create("no-app",{appName:t});return e}function P6(){return Array.from(kd.values())}function yi(t,e,n){var s;let i=(s=$6[t])!==null&&s!==void 0?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),io.warn(a.join(" "));return}Tr(new Zi(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O6="firebase-heartbeat-database",L6=1,Sd="firebase-heartbeat-store";let M_=null;function GD(){return M_||(M_=jD(O6,L6,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Sd)}catch(n){console.warn(n)}}}}).catch(t=>{throw qo.create("idb-open",{originalErrorMessage:t.message})})),M_}async function F6(t){try{const n=(await GD()).transaction(Sd),s=await n.objectStore(Sd).get(HD(t));return await n.done,s}catch(e){if(e instanceof Dr)io.warn(e.message);else{const n=qo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});io.warn(n.message)}}}async function JE(t,e){try{const s=(await GD()).transaction(Sd,"readwrite");await s.objectStore(Sd).put(e,HD(t)),await s.done}catch(n){if(n instanceof Dr)io.warn(n.message);else{const s=qo.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});io.warn(s.message)}}}function HD(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M6=1024,z6=30;class B6{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new W6(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=eN();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>z6){const o=V6(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){io.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=eN(),{heartbeatsToSend:s,unsentEntries:i}=U6(this._heartbeatsCache.heartbeats),r=bg(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(n){return io.warn(n),""}}}function eN(){return new Date().toISOString().substring(0,10)}function U6(t,e=M6){const n=[];let s=t.slice();for(const i of t){const r=n.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),tN(n)>e){r.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),tN(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class W6{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zD()?BD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await F6(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return JE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return JE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function tN(t){return bg(JSON.stringify({version:2,heartbeats:t})).length}function V6(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let s=1;s<t.length;s++)t[s].date<n&&(n=t[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j6(t){Tr(new Zi("platform-logger",e=>new t6(e),"PRIVATE")),Tr(new Zi("heartbeat",e=>new B6(e),"PRIVATE")),yi(_w,YE,t),yi(_w,YE,"esm2017"),yi("fire-js","")}j6("");var G6="firebase",H6="11.3.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yi(G6,H6,"app");const qD="@firebase/installations",$1="0.6.12";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KD=1e4,XD=`w:${$1}`,ZD="FIS_v2",q6="https://firebaseinstallations.googleapis.com/v1",K6=60*60*1e3,X6="installations",Z6="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y6={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},pl=new Ul(X6,Z6,Y6);function YD(t){return t instanceof Dr&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QD({projectId:t}){return`${q6}/projects/${t}/installations`}function JD(t){return{token:t.token,requestStatus:2,expiresIn:J6(t.expiresIn),creationTime:Date.now()}}async function eP(t,e){const s=(await e.json()).error;return pl.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function tP({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function Q6(t,{refreshToken:e}){const n=tP(t);return n.append("Authorization",e5(e)),n}async function nP(t){const e=await t();return e.status>=500&&e.status<600?t():e}function J6(t){return Number(t.replace("s","000"))}function e5(t){return`${ZD} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t5({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const s=QD(t),i=tP(t),r=e.getImmediate({optional:!0});if(r){const c=await r.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={fid:n,authVersion:ZD,appId:t.appId,sdkVersion:XD},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await nP(()=>fetch(s,a));if(l.ok){const c=await l.json();return{fid:c.fid||n,registrationStatus:2,refreshToken:c.refreshToken,authToken:JD(c.authToken)}}else throw await eP("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n5(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s5=/^[cdef][\w-]{21}$/,Cw="";function i5(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=r5(t);return s5.test(n)?n:Cw}catch{return Cw}}function r5(t){return n5(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jy(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP=new Map;function rP(t,e){const n=jy(t);oP(n,e),o5(n,e)}function oP(t,e){const n=iP.get(t);if(n)for(const s of n)s(e)}function o5(t,e){const n=a5();n&&n.postMessage({key:t,fid:e}),l5()}let Ya=null;function a5(){return!Ya&&"BroadcastChannel"in self&&(Ya=new BroadcastChannel("[Firebase] FID Change"),Ya.onmessage=t=>{oP(t.data.key,t.data.fid)}),Ya}function l5(){iP.size===0&&Ya&&(Ya.close(),Ya=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c5="firebase-installations-database",u5=1,ml="firebase-installations-store";let z_=null;function R1(){return z_||(z_=jD(c5,u5,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(ml)}}})),z_}async function kg(t,e){const n=jy(t),i=(await R1()).transaction(ml,"readwrite"),r=i.objectStore(ml),o=await r.get(n);return await r.put(e,n),await i.done,(!o||o.fid!==e.fid)&&rP(t,e.fid),e}async function aP(t){const e=jy(t),s=(await R1()).transaction(ml,"readwrite");await s.objectStore(ml).delete(e),await s.done}async function Gy(t,e){const n=jy(t),i=(await R1()).transaction(ml,"readwrite"),r=i.objectStore(ml),o=await r.get(n),a=e(o);return a===void 0?await r.delete(n):await r.put(a,n),await i.done,a&&(!o||o.fid!==a.fid)&&rP(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A1(t){let e;const n=await Gy(t.appConfig,s=>{const i=h5(s),r=d5(t,i);return e=r.registrationPromise,r.installationEntry});return n.fid===Cw?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function h5(t){const e=t||{fid:i5(),registrationStatus:0};return lP(e)}function d5(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(pl.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=f5(t,n);return{installationEntry:n,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:p5(t)}:{installationEntry:e}}async function f5(t,e){try{const n=await t5(t,e);return kg(t.appConfig,n)}catch(n){throw YD(n)&&n.customData.serverCode===409?await aP(t.appConfig):await kg(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function p5(t){let e=await nN(t.appConfig);for(;e.registrationStatus===1;)await sP(100),e=await nN(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:s}=await A1(t);return s||n}return e}function nN(t){return Gy(t,e=>{if(!e)throw pl.create("installation-not-found");return lP(e)})}function lP(t){return m5(t)?{fid:t.fid,registrationStatus:0}:t}function m5(t){return t.registrationStatus===1&&t.registrationTime+KD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g5({appConfig:t,heartbeatServiceProvider:e},n){const s=y5(t,n),i=Q6(t,n),r=e.getImmediate({optional:!0});if(r){const c=await r.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={installation:{sdkVersion:XD,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await nP(()=>fetch(s,a));if(l.ok){const c=await l.json();return JD(c)}else throw await eP("Generate Auth Token",l)}function y5(t,{fid:e}){return`${QD(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D1(t,e=!1){let n;const s=await Gy(t.appConfig,r=>{if(!cP(r))throw pl.create("not-registered");const o=r.authToken;if(!e&&_5(o))return r;if(o.requestStatus===1)return n=v5(t,e),r;{if(!navigator.onLine)throw pl.create("app-offline");const a=b5(r);return n=x5(t,a),a}});return n?await n:s.authToken}async function v5(t,e){let n=await sN(t.appConfig);for(;n.authToken.requestStatus===1;)await sP(100),n=await sN(t.appConfig);const s=n.authToken;return s.requestStatus===0?D1(t,e):s}function sN(t){return Gy(t,e=>{if(!cP(e))throw pl.create("not-registered");const n=e.authToken;return C5(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function x5(t,e){try{const n=await g5(t,e),s=Object.assign(Object.assign({},e),{authToken:n});return await kg(t.appConfig,s),n}catch(n){if(YD(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await aP(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await kg(t.appConfig,s)}throw n}}function cP(t){return t!==void 0&&t.registrationStatus===2}function _5(t){return t.requestStatus===2&&!w5(t)}function w5(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+K6}function b5(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function C5(t){return t.requestStatus===1&&t.requestTime+KD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I5(t){const e=t,{installationEntry:n,registrationPromise:s}=await A1(e);return s?s.catch(console.error):D1(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k5(t,e=!1){const n=t;return await S5(n),(await D1(n,e)).token}async function S5(t){const{registrationPromise:e}=await A1(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T5(t){if(!t||!t.options)throw B_("App Configuration");if(!t.name)throw B_("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw B_(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function B_(t){return pl.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP="installations",E5="installations-internal",N5=t=>{const e=t.getProvider("app").getImmediate(),n=T5(e),s=Wl(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},$5=t=>{const e=t.getProvider("app").getImmediate(),n=Wl(e,uP).getImmediate();return{getId:()=>I5(n),getToken:i=>k5(n,i)}};function R5(){Tr(new Zi(uP,N5,"PUBLIC")),Tr(new Zi(E5,$5,"PRIVATE"))}R5();yi(qD,$1);yi(qD,$1,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sg="analytics",A5="firebase_id",D5="origin",P5=60*1e3,O5="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",P1="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs=new Wy("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L5={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},js=new Ul("analytics","Analytics",L5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F5(t){if(!t.startsWith(P1)){const e=js.create("invalid-gtag-resource",{gtagURL:t});return Rs.warn(e.message),""}return t}function hP(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function M5(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function z5(t,e){const n=M5("firebase-js-sdk-policy",{createScriptURL:F5}),s=document.createElement("script"),i=`${P1}?l=${t}&id=${e}`;s.src=n?n==null?void 0:n.createScriptURL(i):i,s.async=!0,document.head.appendChild(s)}function B5(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function U5(t,e,n,s,i,r){const o=s[i];try{if(o)await e[o];else{const l=(await hP(n)).find(c=>c.measurementId===i);l&&await e[l.appId]}}catch(a){Rs.error(a)}t("config",i,r)}async function W5(t,e,n,s,i){try{let r=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await hP(n);for(const l of o){const c=a.find(d=>d.measurementId===l),h=c&&e[c.appId];if(h)r.push(h);else{r=[];break}}}r.length===0&&(r=Object.values(e)),await Promise.all(r),t("event",s,i||{})}catch(r){Rs.error(r)}}function V5(t,e,n,s){async function i(r,...o){try{if(r==="event"){const[a,l]=o;await W5(t,e,n,a,l)}else if(r==="config"){const[a,l]=o;await U5(t,e,n,s,a,l)}else if(r==="consent"){const[a,l]=o;t("consent",a,l)}else if(r==="get"){const[a,l,c]=o;t("get",a,l,c)}else if(r==="set"){const[a]=o;t("set",a)}else t(r,...o)}catch(a){Rs.error(a)}}return i}function j5(t,e,n,s,i){let r=function(...o){window[s].push(arguments)};return window[i]&&typeof window[i]=="function"&&(r=window[i]),window[i]=V5(r,t,e,n),{gtagCore:r,wrappedGtag:window[i]}}function G5(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(P1)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H5=30,q5=1e3;class K5{constructor(e={},n=q5){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const dP=new K5;function X5(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Z5(t){var e;const{appId:n,apiKey:s}=t,i={method:"GET",headers:X5(s)},r=O5.replace("{app-id}",n),o=await fetch(r,i);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw js.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function Y5(t,e=dP,n){const{appId:s,apiKey:i,measurementId:r}=t.options;if(!s)throw js.create("no-app-id");if(!i){if(r)return{measurementId:r,appId:s};throw js.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new eq;return setTimeout(async()=>{a.abort()},P5),fP({appId:s,apiKey:i,measurementId:r},o,a,e)}async function fP(t,{throttleEndTimeMillis:e,backoffCount:n},s,i=dP){var r;const{appId:o,measurementId:a}=t;try{await Q5(s,e)}catch(l){if(a)return Rs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw l}try{const l=await Z5(t);return i.deleteThrottleMetadata(o),l}catch(l){const c=l;if(!J5(c)){if(i.deleteThrottleMetadata(o),a)return Rs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:o,measurementId:a};throw l}const h=Number((r=c==null?void 0:c.customData)===null||r===void 0?void 0:r.httpStatus)===503?qE(n,i.intervalMillis,H5):qE(n,i.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return i.setThrottleMetadata(o,d),Rs.debug(`Calling attemptFetch again in ${h} millis`),fP(t,d,s,i)}}function Q5(t,e){return new Promise((n,s)=>{const i=Math.max(e-Date.now(),0),r=setTimeout(n,i);t.addEventListener(()=>{clearTimeout(r),s(js.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function J5(t){if(!(t instanceof Dr)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class eq{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function tq(t,e,n,s,i){if(i&&i.global){t("event",n,s);return}else{const r=await e,o=Object.assign(Object.assign({},s),{send_to:r});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nq(){if(zD())try{await BD()}catch(t){return Rs.warn(js.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Rs.warn(js.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function sq(t,e,n,s,i,r,o){var a;const l=Y5(t);l.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&Rs.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>Rs.error(m)),e.push(l);const c=nq().then(m=>{if(m)return s.getId()}),[h,d]=await Promise.all([l,c]);G5(r)||z5(r,h.measurementId),i("js",new Date);const f=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return f[D5]="firebase",f.update=!0,d!=null&&(f[A5]=d),i("config",h.measurementId,f),h.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iq{constructor(e){this.app=e}_delete(){return delete Kh[this.app.options.appId],Promise.resolve()}}let Kh={},iN=[];const rN={};let U_="dataLayer",rq="gtag",oN,pP,aN=!1;function oq(){const t=[];if(FD()&&t.push("This is a browser extension environment."),bH()||t.push("Cookies are not available."),t.length>0){const e=t.map((s,i)=>`(${i+1}) ${s}`).join(" "),n=js.create("invalid-analytics-context",{errorInfo:e});Rs.warn(n.message)}}function aq(t,e,n){oq();const s=t.options.appId;if(!s)throw js.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Rs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw js.create("no-api-key");if(Kh[s]!=null)throw js.create("already-exists",{id:s});if(!aN){B5(U_);const{wrappedGtag:r,gtagCore:o}=j5(Kh,iN,rN,U_,rq);pP=r,oN=o,aN=!0}return Kh[s]=sq(t,iN,rN,e,oN,U_,n),new iq(t)}function lq(t=Vy()){t=Dn(t);const e=Wl(t,Sg);return e.isInitialized()?e.getImmediate():cq(t)}function cq(t,e={}){const n=Wl(t,Sg);if(n.isInitialized()){const i=n.getImmediate();if(Id(e,n.getOptions()))return i;throw js.create("already-initialized")}return n.initialize({options:e})}function uq(t,e,n,s){t=Dn(t),tq(pP,Kh[t.app.options.appId],e,n,s).catch(i=>Rs.error(i))}const lN="@firebase/analytics",cN="0.10.11";function hq(){Tr(new Zi(Sg,(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return aq(s,i,n)},"PUBLIC")),Tr(new Zi("analytics-internal",t,"PRIVATE")),yi(lN,cN),yi(lN,cN,"esm2017");function t(e){try{const n=e.getProvider(Sg).getImmediate();return{logEvent:(s,i,r)=>uq(n,s,i,r)}}catch(n){throw js.create("interop-component-reg-failed",{reason:n})}}}hq();function O1(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n}function mP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const dq=mP,gP=new Ul("auth","Firebase",mP());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tg=new Wy("@firebase/auth");function fq(t,...e){Tg.logLevel<=xt.WARN&&Tg.warn(`Auth (${Tu}): ${t}`,...e)}function Um(t,...e){Tg.logLevel<=xt.ERROR&&Tg.error(`Auth (${Tu}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yi(t,...e){throw L1(t,...e)}function xr(t,...e){return L1(t,...e)}function yP(t,e,n){const s=Object.assign(Object.assign({},dq()),{[e]:n});return new Ul("auth","Firebase",s).create(e,{appName:t.name})}function Qr(t){return yP(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function L1(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return gP.create(t,...e)}function Oe(t,e,...n){if(!t)throw L1(e,...n)}function Hr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Um(e),new Error(e)}function ro(t,e){t||Hr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iw(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function pq(){return uN()==="http:"||uN()==="https:"}function uN(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mq(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pq()||FD()||"connection"in navigator)?navigator.onLine:!0}function gq(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e,n){this.shortDelay=e,this.longDelay=n,ro(n>e,"Short delay should be less than long delay!"),this.isMobile=S1()||MD()}get(){return mq()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F1(t,e){ro(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Hr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Hr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Hr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yq={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vq=new ef(3e4,6e4);function pa(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function ma(t,e,n,s,i={}){return xP(t,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const a=Su(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const c=Object.assign({method:e,headers:l},r);return xH()||(c.referrerPolicy="no-referrer"),vP.fetch()(_P(t,t.config.apiHost,n,a),c)})}async function xP(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},yq),e);try{const i=new _q(t),r=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw dm(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw dm(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw dm(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw dm(t,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw yP(t,h,c);Yi(t,h)}}catch(i){if(i instanceof Dr)throw i;Yi(t,"network-request-failed",{message:String(i)})}}async function tf(t,e,n,s,i={}){const r=await ma(t,e,n,s,i);return"mfaPendingCredential"in r&&Yi(t,"multi-factor-auth-required",{_serverResponse:r}),r}function _P(t,e,n,s){const i=`${e}${n}?${s}`;return t.config.emulator?F1(t.config,i):`${t.config.apiScheme}://${i}`}function xq(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _q{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(xr(this.auth,"network-request-failed")),vq.get())})}}function dm(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=xr(t,e,s);return i.customData._tokenResponse=n,i}function hN(t){return t!==void 0&&t.enterprise!==void 0}class wq{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return xq(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function bq(t,e){return ma(t,"GET","/v2/recaptchaConfig",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cq(t,e){return ma(t,"POST","/v1/accounts:delete",e)}async function wP(t,e){return ma(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xh(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Iq(t,e=!1){const n=Dn(t),s=await n.getIdToken(e),i=M1(s);Oe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Xh(W_(i.auth_time)),issuedAtTime:Xh(W_(i.iat)),expirationTime:Xh(W_(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function W_(t){return Number(t)*1e3}function M1(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return Um("JWT malformed, contained fewer than 3 sections"),null;try{const i=Cg(n);return i?JSON.parse(i):(Um("Failed to decode base64 JWT payload"),null)}catch(i){return Um("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function dN(t){const e=M1(t);return Oe(e,"internal-error"),Oe(typeof e.exp<"u","internal-error"),Oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Td(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof Dr&&kq(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function kq({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xh(this.lastLoginAt),this.creationTime=Xh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eg(t){var e;const n=t.auth,s=await t.getIdToken(),i=await Td(t,wP(n,{idToken:s}));Oe(i==null?void 0:i.users.length,n,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?bP(r.providerUserInfo):[],a=Eq(t.providerData,o),l=t.isAnonymous,c=!(t.email&&r.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new kw(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(t,d)}async function Tq(t){const e=Dn(t);await Eg(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Eq(t,e){return[...t.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function bP(t){return t.map(e=>{var{providerId:n}=e,s=O1(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nq(t,e){const n=await xP(t,{},async()=>{const s=Su({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,o=_P(t,i,"/v1/token",`key=${r}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",vP.fetch()(o,{method:"POST",headers:a,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function $q(t,e){return ma(t,"POST","/v2/accounts:revokeToken",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oe(e.idToken,"internal-error"),Oe(typeof e.idToken<"u","internal-error"),Oe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Oe(e.length!==0,"internal-error");const n=dN(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:i,expiresIn:r}=await Nq(e,n);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:i,expirationTime:r}=n,o=new Wc;return s&&(Oe(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(Oe(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(Oe(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Wc,this.toJSON())}_performRefresh(){return Hr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wo(t,e){Oe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class qr{constructor(e){var{uid:n,auth:s,stsTokenManager:i}=e,r=O1(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Sq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new kw(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await Td(this,this.stsTokenManager.getToken(this.auth,e));return Oe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Iq(this,e)}reload(){return Tq(this)}_assign(e){this!==e&&(Oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new qr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Eg(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(li(this.auth.app))return Promise.reject(Qr(this.auth));const e=await this.getIdToken();return await Td(this,Cq(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,i,r,o,a,l,c,h;const d=(s=n.displayName)!==null&&s!==void 0?s:void 0,f=(i=n.email)!==null&&i!==void 0?i:void 0,m=(r=n.phoneNumber)!==null&&r!==void 0?r:void 0,g=(o=n.photoURL)!==null&&o!==void 0?o:void 0,x=(a=n.tenantId)!==null&&a!==void 0?a:void 0,_=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,v=(c=n.createdAt)!==null&&c!==void 0?c:void 0,w=(h=n.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:b,emailVerified:I,isAnonymous:S,providerData:T,stsTokenManager:$}=n;Oe(b&&$,e,"internal-error");const E=Wc.fromJSON(this.name,$);Oe(typeof b=="string",e,"internal-error"),wo(d,e.name),wo(f,e.name),Oe(typeof I=="boolean",e,"internal-error"),Oe(typeof S=="boolean",e,"internal-error"),wo(m,e.name),wo(g,e.name),wo(x,e.name),wo(_,e.name),wo(v,e.name),wo(w,e.name);const D=new qr({uid:b,auth:e,email:f,emailVerified:I,displayName:d,isAnonymous:S,photoURL:g,phoneNumber:m,tenantId:x,stsTokenManager:E,createdAt:v,lastLoginAt:w});return T&&Array.isArray(T)&&(D.providerData=T.map(P=>Object.assign({},P))),_&&(D._redirectEventId=_),D}static async _fromIdTokenResponse(e,n,s=!1){const i=new Wc;i.updateFromServerResponse(n);const r=new qr({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Eg(r),r}static async _fromGetAccountInfoResponse(e,n,s){const i=n.users[0];Oe(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?bP(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),a=new Wc;a.updateFromIdToken(s);const l=new qr({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new kw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fN=new Map;function Kr(t){ro(t instanceof Function,"Expected a class definition");let e=fN.get(t);return e?(ro(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,fN.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}CP.type="NONE";const pN=CP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wm(t,e,n){return`firebase:${t}:${e}:${n}`}class Vc{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=Wm(this.userKey,i.apiKey,r),this.fullPersistenceKey=Wm("persistence",i.apiKey,r),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?qr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Vc(Kr(pN),e,s);const i=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let r=i[0]||Kr(pN);const o=Wm(s,e.config.apiKey,e.name);let a=null;for(const c of n)try{const h=await c._get(o);if(h){const d=qr._fromJSON(e,h);c!==r&&(a=d),r=c;break}}catch{}const l=i.filter(c=>c._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new Vc(r,e,s):(r=l[0],a&&await r._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==r)try{await c._remove(o)}catch{}})),new Vc(r,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mN(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(TP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(IP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(NP(e))return"Blackberry";if($P(e))return"Webos";if(kP(e))return"Safari";if((e.includes("chrome/")||SP(e))&&!e.includes("edge/"))return"Chrome";if(EP(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function IP(t=fs()){return/firefox\//i.test(t)}function kP(t=fs()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function SP(t=fs()){return/crios\//i.test(t)}function TP(t=fs()){return/iemobile/i.test(t)}function EP(t=fs()){return/android/i.test(t)}function NP(t=fs()){return/blackberry/i.test(t)}function $P(t=fs()){return/webos/i.test(t)}function z1(t=fs()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Rq(t=fs()){var e;return z1(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Aq(){return _H()&&document.documentMode===10}function RP(t=fs()){return z1(t)||EP(t)||$P(t)||NP(t)||/windows phone/i.test(t)||TP(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AP(t,e=[]){let n;switch(t){case"Browser":n=mN(fs());break;case"Worker":n=`${mN(fs())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Tu}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dq{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=r=>new Promise((o,a)=>{try{const l=e(r);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pq(t,e={}){return ma(t,"GET","/v2/passwordPolicy",pa(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oq=6;class Lq{constructor(e){var n,s,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:Oq,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,i,r,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(r=l.containsUppercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fq{constructor(e,n,s,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gN(this),this.idTokenSubscription=new gN(this),this.beforeStateQueue=new Dq(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=gP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Kr(n)),this._initializationPromise=this.queue(async()=>{var s,i;if(!this._deleted&&(this.persistenceManager=await Vc.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await wP(this,{idToken:e}),s=await qr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(li(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let i=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Eg(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=gq()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(li(this.app))return Promise.reject(Qr(this));const n=e?Dn(e):null;return n&&Oe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return li(this.app)?Promise.reject(Qr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return li(this.app)?Promise.reject(Qr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Kr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Pq(this),n=new Lq(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ul("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await $q(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Kr(e)||this._popupRedirectResolver;Oe(n,this,"argument-error"),this.redirectPersistenceManager=await Vc.create(this,[Kr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,i){if(this._deleted)return()=>{};const r=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oe(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,s,i);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=AP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;if(li(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&fq(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Vl(t){return Dn(t)}class gN{constructor(e){this.auth=e,this.observer=null,this.addObserver=NH(n=>this.observer=n)}get next(){return Oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Mq(t){Hy=t}function DP(t){return Hy.loadJS(t)}function zq(){return Hy.recaptchaEnterpriseScript}function Bq(){return Hy.gapiScript}function Uq(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Wq{constructor(){this.enterprise=new Vq}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Vq{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const jq="recaptcha-enterprise",PP="NO_RECAPTCHA";class Gq{constructor(e){this.type=jq,this.auth=Vl(e)}async verify(e="verify",n=!1){async function s(r){if(!n){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,a)=>{bq(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new wq(l);return r.tenantId==null?r._agentRecaptchaConfig=c:r._tenantRecaptchaConfigs[r.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function i(r,o,a){const l=window.grecaptcha;hN(l)?l.enterprise.ready(()=>{l.enterprise.execute(r,{action:e}).then(c=>{o(c)}).catch(()=>{o(PP)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Wq().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(a=>{if(!n&&hN(window.grecaptcha))i(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=zq();l.length!==0&&(l+=a),DP(l).then(()=>{i(a,r,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function yN(t,e,n,s=!1,i=!1){const r=new Gq(t);let o;if(i)o=PP;else try{o=await r.verify(n)}catch{o=await r.verify(n,!0)}const a=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Sw(t,e,n,s,i){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await yN(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await yN(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hq(t,e){const n=Wl(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),r=n.getOptions();if(Id(r,e??{}))return i;Yi(i,"already-initialized")}return n.initialize({options:e})}function qq(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Kr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Kq(t,e,n){const s=Vl(t);Oe(s._canInitEmulator,s,"emulator-config-failed"),Oe(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=OP(e),{host:o,port:a}=Xq(e),l=a===null?"":`:${a}`;s.config.emulator={url:`${r}//${o}${l}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})}),Zq()}function OP(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Xq(t){const e=OP(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:vN(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:vN(o)}}}function vN(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Zq(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Hr("not implemented")}_getIdTokenResponse(e){return Hr("not implemented")}_linkToIdToken(e,n){return Hr("not implemented")}_getReauthenticationResolver(e){return Hr("not implemented")}}async function Yq(t,e){return ma(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qq(t,e){return tf(t,"POST","/v1/accounts:signInWithPassword",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jq(t,e){return tf(t,"POST","/v1/accounts:signInWithEmailLink",pa(t,e))}async function eK(t,e){return tf(t,"POST","/v1/accounts:signInWithEmailLink",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed extends B1{constructor(e,n,s,i=null){super("password",s),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Ed(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Ed(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Sw(e,n,"signInWithPassword",Qq);case"emailLink":return Jq(e,{email:this._email,oobCode:this._password});default:Yi(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Sw(e,s,"signUpPassword",Yq);case"emailLink":return eK(e,{idToken:n,email:this._email,oobCode:this._password});default:Yi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jc(t,e){return tf(t,"POST","/v1/accounts:signInWithIdp",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tK="http://localhost";class gl extends B1{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new gl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Yi("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i}=n,r=O1(n,["providerId","signInMethod"]);if(!s||!i)return null;const o=new gl(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return jc(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,jc(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,jc(e,n)}buildRequest(){const e={requestUri:tK,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Su(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nK(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function sK(t){const e=Rh(Ah(t)).link,n=e?Rh(Ah(e)).deep_link_id:null,s=Rh(Ah(t)).deep_link_id;return(s?Rh(Ah(s)).link:null)||s||n||e||t}class U1{constructor(e){var n,s,i,r,o,a;const l=Rh(Ah(e)),c=(n=l.apiKey)!==null&&n!==void 0?n:null,h=(s=l.oobCode)!==null&&s!==void 0?s:null,d=nK((i=l.mode)!==null&&i!==void 0?i:null);Oe(c&&h&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=h,this.continueUrl=(r=l.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=sK(e);try{return new U1(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(){this.providerId=Eu.PROVIDER_ID}static credential(e,n){return Ed._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=U1.parseLink(n);return Oe(s,"argument-error"),Ed._fromEmailAndCode(e,s.code,s.tenantId)}}Eu.PROVIDER_ID="password";Eu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Eu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf extends LP{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To extends nf{constructor(){super("facebook.com")}static credential(e){return gl._fromParams({providerId:To.PROVIDER_ID,signInMethod:To.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return To.credentialFromTaggedObject(e)}static credentialFromError(e){return To.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return To.credential(e.oauthAccessToken)}catch{return null}}}To.FACEBOOK_SIGN_IN_METHOD="facebook.com";To.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo extends nf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return gl._fromParams({providerId:Eo.PROVIDER_ID,signInMethod:Eo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Eo.credentialFromTaggedObject(e)}static credentialFromError(e){return Eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return Eo.credential(n,s)}catch{return null}}}Eo.GOOGLE_SIGN_IN_METHOD="google.com";Eo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No extends nf{constructor(){super("github.com")}static credential(e){return gl._fromParams({providerId:No.PROVIDER_ID,signInMethod:No.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return No.credentialFromTaggedObject(e)}static credentialFromError(e){return No.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return No.credential(e.oauthAccessToken)}catch{return null}}}No.GITHUB_SIGN_IN_METHOD="github.com";No.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends nf{constructor(){super("twitter.com")}static credential(e,n){return gl._fromParams({providerId:$o.PROVIDER_ID,signInMethod:$o.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return $o.credentialFromTaggedObject(e)}static credentialFromError(e){return $o.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return $o.credential(n,s)}catch{return null}}}$o.TWITTER_SIGN_IN_METHOD="twitter.com";$o.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iK(t,e){return tf(t,"POST","/v1/accounts:signUp",pa(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,i=!1){const r=await qr._fromIdTokenResponse(e,s,i),o=xN(s);return new yl({user:r,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const i=xN(s);return new yl({user:e,providerId:i,_tokenResponse:s,operationType:n})}}function xN(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng extends Dr{constructor(e,n,s,i){var r;super(n.code,n.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,Ng.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,i){return new Ng(e,n,s,i)}}function FP(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Ng._fromErrorAndOperation(t,r,e,s):r})}async function rK(t,e,n=!1){const s=await Td(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return yl._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oK(t,e,n=!1){const{auth:s}=t;if(li(s.app))return Promise.reject(Qr(s));const i="reauthenticate";try{const r=await Td(t,FP(s,i,e,t),n);Oe(r.idToken,s,"internal-error");const o=M1(r.idToken);Oe(o,s,"internal-error");const{sub:a}=o;return Oe(t.uid===a,s,"user-mismatch"),yl._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Yi(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MP(t,e,n=!1){if(li(t.app))return Promise.reject(Qr(t));const s="signIn",i=await FP(t,s,e),r=await yl._fromIdTokenResponse(t,s,i);return n||await t._updateCurrentUser(r.user),r}async function aK(t,e){return MP(Vl(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zP(t){const e=Vl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function lK(t,e,n){if(li(t.app))return Promise.reject(Qr(t));const s=Vl(t),o=await Sw(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",iK).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&zP(t),l}),a=await yl._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function cK(t,e,n){return li(t.app)?Promise.reject(Qr(t)):aK(Dn(t),Eu.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&zP(t),s})}function uK(t,e,n,s){return Dn(t).onIdTokenChanged(e,n,s)}function hK(t,e,n){return Dn(t).beforeAuthStateChanged(e,n)}function dK(t,e,n,s){return Dn(t).onAuthStateChanged(e,n,s)}function fK(t){return Dn(t).signOut()}const $g="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem($g,"1"),this.storage.removeItem($g),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pK=1e3,mK=10;class UP extends BP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=RP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),i=this.localCache[n];s!==i&&e(n,i,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);Aq()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,mK):i()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},pK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}UP.type="LOCAL";const gK=UP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP extends BP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}WP.type="SESSION";const VP=WP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yK(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const s=new qy(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:i,data:r}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const a=Array.from(o).map(async c=>c(n.origin,r)),l=await yK(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W1(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vK{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((a,l)=>{const c=W1("",20);i.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(d){const f=d;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(f.data.response);break;default:clearTimeout(h),clearTimeout(r),l(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(){return window}function xK(t){_r().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(){return typeof _r().WorkerGlobalScope<"u"&&typeof _r().importScripts=="function"}async function _K(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function wK(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function bK(){return jP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP="firebaseLocalStorageDb",CK=1,Rg="firebaseLocalStorage",HP="fbase_key";class sf{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Ky(t,e){return t.transaction([Rg],e?"readwrite":"readonly").objectStore(Rg)}function IK(){const t=indexedDB.deleteDatabase(GP);return new sf(t).toPromise()}function Tw(){const t=indexedDB.open(GP,CK);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(Rg,{keyPath:HP})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(Rg)?e(s):(s.close(),await IK(),e(await Tw()))})})}async function _N(t,e,n){const s=Ky(t,!0).put({[HP]:e,value:n});return new sf(s).toPromise()}async function kK(t,e){const n=Ky(t,!1).get(e),s=await new sf(n).toPromise();return s===void 0?null:s.value}function wN(t,e){const n=Ky(t,!0).delete(e);return new sf(n).toPromise()}const SK=800,TK=3;class qP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Tw(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>TK)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qy._getInstance(bK()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await _K(),!this.activeServiceWorker)return;this.sender=new vK(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||wK()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Tw();return await _N(e,$g,"1"),await wN(e,$g),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>_N(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>kK(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>wN(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=Ky(i,!1).getAll();return new sf(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),SK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}qP.type="LOCAL";const EK=qP;new ef(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NK(t,e){return e?Kr(e):(Oe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V1 extends B1{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return jc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return jc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function $K(t){return MP(t.auth,new V1(t),t.bypassAuthState)}function RK(t){const{auth:e,user:n}=t;return Oe(n,e,"internal-error"),oK(n,new V1(t),t.bypassAuthState)}async function AK(t){const{auth:e,user:n}=t;return Oe(n,e,"internal-error"),rK(n,new V1(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,n,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:i,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $K;case"linkViaPopup":case"linkViaRedirect":return AK;case"reauthViaPopup":case"reauthViaRedirect":return RK;default:Yi(this.auth,"internal-error")}}resolve(e){ro(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ro(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DK=new ef(2e3,1e4);class Dc extends KP{constructor(e,n,s,i,r){super(e,n,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Dc.currentPopupAction&&Dc.currentPopupAction.cancel(),Dc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oe(e,this.auth,"internal-error"),e}async onExecution(){ro(this.filter.length===1,"Popup operations only handle one event");const e=W1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Dc.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,DK.get())};e()}}Dc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PK="pendingRedirect",Vm=new Map;class OK extends KP{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=Vm.get(this.auth._key());if(!e){try{const s=await LK(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}Vm.set(this.auth._key(),e)}return this.bypassAuthState||Vm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function LK(t,e){const n=zK(e),s=MK(t);if(!await s._isAvailable())return!1;const i=await s._get(n)==="true";return await s._remove(n),i}function FK(t,e){Vm.set(t._key(),e)}function MK(t){return Kr(t._redirectPersistence)}function zK(t){return Wm(PK,t.config.apiKey,t.name)}async function BK(t,e,n=!1){if(li(t.app))return Promise.reject(Qr(t));const s=Vl(t),i=NK(s,e),o=await new OK(s,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UK=10*60*1e3;class WK{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!VK(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!XP(e)){const i=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(xr(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=UK&&this.cachedEventUids.clear(),this.cachedEventUids.has(bN(e))}saveEventToCache(e){this.cachedEventUids.add(bN(e)),this.lastProcessedEventTime=Date.now()}}function bN(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function XP({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function VK(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return XP(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jK(t,e={}){return ma(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GK=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HK=/^https?/;async function qK(t){if(t.config.emulator)return;const{authorizedDomains:e}=await jK(t);for(const n of e)try{if(KK(n))return}catch{}Yi(t,"unauthorized-domain")}function KK(t){const e=Iw(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!HK.test(n))return!1;if(GK.test(t))return s===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XK=new ef(3e4,6e4);function CN(){const t=_r().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function ZK(t){return new Promise((e,n)=>{var s,i,r;function o(){CN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{CN(),n(xr(t,"network-request-failed"))},timeout:XK.get()})}if(!((i=(s=_r().gapi)===null||s===void 0?void 0:s.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=_r().gapi)===null||r===void 0)&&r.load)o();else{const a=Uq("iframefcb");return _r()[a]=()=>{gapi.load?o():n(xr(t,"network-request-failed"))},DP(`${Bq()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw jm=null,e})}let jm=null;function YK(t){return jm=jm||ZK(t),jm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QK=new ef(5e3,15e3),JK="__/auth/iframe",e8="emulator/auth/iframe",t8={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},n8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function s8(t){const e=t.config;Oe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?F1(e,e8):`https://${t.config.authDomain}/${JK}`,s={apiKey:e.apiKey,appName:t.name,v:Tu},i=n8.get(t.config.apiHost);i&&(s.eid=i);const r=t._getFrameworks();return r.length&&(s.fw=r.join(",")),`${n}?${Su(s).slice(1)}`}async function i8(t){const e=await YK(t),n=_r().gapi;return Oe(n,t,"internal-error"),e.open({where:document.body,url:s8(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:t8,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=xr(t,"network-request-failed"),a=_r().setTimeout(()=>{r(o)},QK.get());function l(){_r().clearTimeout(a),i(s)}s.ping(l).then(l,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},o8=500,a8=600,l8="_blank",c8="http://localhost";class IN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function u8(t,e,n,s=o8,i=a8){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l=Object.assign(Object.assign({},r8),{width:s.toString(),height:i.toString(),top:r,left:o}),c=fs().toLowerCase();n&&(a=SP(c)?l8:n),IP(c)&&(e=e||c8,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[m,g])=>`${f}${m}=${g},`,"");if(Rq(c)&&a!=="_self")return h8(e||"",a),new IN(null);const d=window.open(e||"",a,h);Oe(d,t,"popup-blocked");try{d.focus()}catch{}return new IN(d)}function h8(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d8="__/auth/handler",f8="emulator/auth/handler",p8=encodeURIComponent("fac");async function kN(t,e,n,s,i,r){Oe(t.config.authDomain,t,"auth-domain-config-required"),Oe(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:Tu,eventId:i};if(e instanceof LP){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",yw(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof nf){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await t._getAppCheckToken(),c=l?`#${p8}=${encodeURIComponent(l)}`:"";return`${m8(t)}?${Su(a).slice(1)}${c}`}function m8({config:t}){return t.emulator?F1(t,f8):`https://${t.authDomain}/${d8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_="webStorageSupport";class g8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=VP,this._completeRedirectFn=BK,this._overrideRedirectResult=FK}async _openPopup(e,n,s,i){var r;ro((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await kN(e,n,s,Iw(),i);return u8(e,o,W1())}async _openRedirect(e,n,s,i){await this._originValidation(e);const r=await kN(e,n,s,Iw(),i);return xK(r),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:r}=this.eventManagers[n];return i?Promise.resolve(i):(ro(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await i8(e),s=new WK(e);return n.register("authEvent",i=>(Oe(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(V_,{type:V_},i=>{var r;const o=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[V_];o!==void 0&&n(!!o),Yi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=qK(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return RP()||kP()||z1()}}const y8=g8;var SN="@firebase/auth",TN="1.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x8(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _8(t){Tr(new Zi("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Oe(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:AP(t)},c=new Fq(s,i,r,l);return qq(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),Tr(new Zi("auth-internal",e=>{const n=Vl(e.getProvider("auth").getImmediate());return(s=>new v8(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),yi(SN,TN,x8(t)),yi(SN,TN,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w8=5*60,b8=LD("authIdTokenMaxAge")||w8;let EN=null;const C8=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>b8)return;const i=n==null?void 0:n.token;EN!==i&&(EN=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function I8(t=Vy()){const e=Wl(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Hq(t,{popupRedirectResolver:y8,persistence:[EK,gK,VP]}),s=LD("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=C8(r.toString());hK(n,o,()=>o(n.currentUser)),uK(n,a=>o(a))}}const i=PD("auth");return i&&Kq(n,`http://${i}`),n}function k8(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Mq({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=i=>{const r=xr("internal-error");r.customData=i,n(r)},s.type="text/javascript",s.charset="UTF-8",k8().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_8("Browser");const S8={apiKey:"AIzaSyAsKLxAzdt_Wf3CyoUCE4izrSdNh50SLto",authDomain:"firstaid-ai-4a1fd.firebaseapp.com",projectId:"firstaid-ai-4a1fd",storageBucket:"firstaid-ai-4a1fd.firebasestorage.app",messagingSenderId:"407902398252",appId:"1:407902398252:web:a51757f1b013738eb2ae89",measurementId:"G-G8DVPBMB94"},ZP=N1(S8),fm=I8(ZP);lq(ZP);const YP=ne.createContext(null);function T8({children:t}){const[e,n]=ne.useState(null);ne.useEffect(()=>dK(fm,a=>{n(a)}),[]);const s=async(o,a)=>{await cK(fm,o,a)},i=async(o,a)=>{await lK(fm,o,a)},r=async()=>{await fK(fm)};return A.jsx(YP.Provider,{value:{user:e,signIn:s,signUp:i,signOut:r},children:t})}function j1(){const t=ne.useContext(YP);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}function E8(){const{user:t,signOut:e}=j1(),[n,s]=ne.useState(!1),[i,r]=ne.useState(!1),o=ne.useRef(null);return ne.useEffect(()=>{const a=l=>{o.current&&!o.current.contains(l.target)&&r(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),A.jsx("nav",{className:"bg-gradient-to-r from-blue-500 to-blue-600 shadow-lg",children:A.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[A.jsxs("div",{className:"flex justify-between items-center h-16",children:[A.jsxs(gn,{to:"/",className:"flex items-center group",children:[A.jsx("div",{className:"bg-white p-2 rounded-full transition-transform group-hover:scale-110",children:A.jsx(ND,{className:"h-6 w-6 text-red-500"})}),A.jsx("span",{className:"ml-2 text-xl font-bold text-white hidden md:inline",children:"FirstAid.AI"})]}),A.jsx("button",{onClick:()=>s(!n),className:"md:hidden text-white hover:text-gray-200",children:n?A.jsx(lH,{size:24}):A.jsx(tH,{size:24})}),A.jsxs("div",{className:"hidden md:flex items-center space-x-6",children:[A.jsxs(gn,{to:"/first-aid",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(UE,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Guide"})]}),A.jsxs(gn,{to:"/injury-detection",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(wg,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Detection"})]}),A.jsxs(gn,{to:"/nearby-hospitals",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(jE,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Hospitals"})]}),A.jsxs(gn,{to:"/chat",className:"text-white hover:text-gray-200 flex flex-col items-center group",children:[A.jsx(gw,{className:"h-5 w-5 mb-1 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"text-xs",children:"Chat"})]}),A.jsxs("button",{className:"text-white hover:text-gray-200 relative group",children:[A.jsx(BE,{className:"h-5 w-5 transition-transform group-hover:scale-110"}),A.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:"2"})]}),t?A.jsxs("div",{className:"relative",ref:o,children:[A.jsx("button",{onClick:()=>r(!i),className:"text-white hover:text-gray-200 flex items-center group",children:A.jsx("div",{className:"bg-blue-700 p-2 rounded-full transition-transform group-hover:scale-110",children:A.jsx(vh,{className:"h-5 w-5"})})}),i&&A.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl z-50",children:[A.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center",children:[A.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3",children:t.displayName?t.displayName.charAt(0).toUpperCase():A.jsx(vh,{})}),A.jsxs("div",{className:"overflow-hidden",children:[A.jsx("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:t.displayName||"User"}),A.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.email})]})]}),A.jsxs("div",{className:"py-1",children:[A.jsxs(gn,{to:"/profile",className:"block px-4 py-2 text-gray-700 hover:bg-blue-50 flex items-center",children:[A.jsx(vh,{className:"h-4 w-4 mr-2"})," Profile"]}),A.jsxs(gn,{to:"/settings",className:"block px-4 py-2 text-gray-700 hover:bg-blue-50 flex items-center",children:[A.jsx(VE,{className:"h-4 w-4 mr-2"})," Settings"]}),A.jsxs("button",{onClick:e,className:"block w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 flex items-center",children:[A.jsx(WE,{className:"h-4 w-4 mr-2"})," Logout"]})]})]})]}):A.jsx(gn,{to:"/login",className:"bg-white text-blue-600 px-4 py-2 rounded-full font-medium hover:bg-blue-50 transition-colors",children:"Login"})]})]}),n&&A.jsx("div",{className:"md:hidden bg-white rounded-lg shadow-xl mt-2",children:A.jsxs("div",{className:"p-4 space-y-4",children:[A.jsxs(gn,{to:"/first-aid",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(UE,{className:"h-5 w-5 mr-3"}),"First Aid Guide"]}),A.jsxs(gn,{to:"/injury-detection",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(wg,{className:"h-5 w-5 mr-3"}),"Injury Detection"]}),A.jsxs(gn,{to:"/nearby-hospitals",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(jE,{className:"h-5 w-5 mr-3"}),"Nearby Hospitals"]}),A.jsxs(gn,{to:"/chat",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(gw,{className:"h-5 w-5 mr-3"}),"Chat"]}),A.jsxs("div",{className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",children:[A.jsx(BE,{className:"h-5 w-5 mr-3"}),"Notifications",A.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:"2"})]}),t?A.jsxs("div",{children:[A.jsxs("div",{className:"flex items-center border-b pb-3 mb-3",children:[A.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3",children:t.displayName?t.displayName.charAt(0).toUpperCase():A.jsx(vh,{})}),A.jsxs("div",{className:"overflow-hidden",children:[A.jsx("h3",{className:"text-sm font-semibold text-gray-800 truncate",children:t.displayName||"User"}),A.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.email})]})]}),A.jsxs(gn,{to:"/profile",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(vh,{className:"h-5 w-5 mr-3"})," Profile"]}),A.jsxs(gn,{to:"/settings",className:"flex items-center text-gray-800 hover:bg-blue-50 p-2 rounded-lg",onClick:()=>s(!1),children:[A.jsx(VE,{className:"h-5 w-5 mr-3"})," Settings"]}),A.jsxs("button",{onClick:()=>{e(),s(!1)},className:"w-full text-left flex items-center text-red-600 hover:bg-red-50 p-2 rounded-lg",children:[A.jsx(WE,{className:"h-5 w-5 mr-3"})," Logout"]})]}):A.jsx(gn,{to:"/login",className:"block w-full text-center bg-blue-500 text-white px-4 py-2 rounded-full font-medium hover:bg-blue-600 transition-colors",onClick:()=>s(!1),children:"Login"})]})})]})})}const N8=()=>A.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-green-500",children:[A.jsx("path",{d:"M12 6v4"}),A.jsx("path",{d:"M14 14h-4"}),A.jsx("path",{d:"M14 18h-4"}),A.jsx("path",{d:"M14 8h-4"}),A.jsx("path",{d:"M18 12h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2"}),A.jsx("path",{d:"M18 22V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18"})]});function $8(){return A.jsxs("div",{className:"container mx-auto px-4 py-12",children:[A.jsxs("div",{className:"text-center mb-12",children:[A.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Welcome to FirstAid.AI"}),A.jsx("p",{className:"text-xl text-gray-600",children:"Your intelligent first aid assistant for emergency situations"})]}),A.jsxs("div",{className:"grid md:grid-cols-4 gap-8 max-w-6xl mx-auto",children:[A.jsx(gn,{to:"/first-aid",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(ND,{size:48,className:"text-red-500"})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"First Aid Guide"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"Get instant first aid instructions for various injuries"})]})}),A.jsx(gn,{to:"/injury-detection",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(wg,{size:48,className:"text-blue-500"})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"Injury Detection"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"AI-powered injury assessment through image analysis"})]})}),A.jsx(gn,{to:"/nearby-hospitals",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(N8,{})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"Nearby Hospitals"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"Find emergency medical facilities in your area"})]})}),A.jsx(gn,{to:"/chat",className:"transform hover:scale-105 transition-transform",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-full flex flex-col",children:[A.jsx("div",{className:"flex justify-center mb-4 h-12",children:A.jsx(gw,{size:48,className:"text-purple-500"})}),A.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"AI Chat Assistant"}),A.jsx("p",{className:"text-gray-600 text-center flex-grow",children:"Get instant first aid advice from our AI assistant"})]})})]}),A.jsxs("div",{className:"mt-16 bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto",children:[A.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Why Choose FirstAid.AI?"}),A.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[A.jsxs("div",{children:[A.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Instant AI Analysis"}),A.jsx("p",{className:"text-gray-600",children:"Our advanced AI technology helps assess injuries and provides appropriate first aid recommendations"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Emergency Location Services"}),A.jsx("p",{className:"text-gray-600",children:"Quickly locate nearby hospitals and emergency services when you need them most"})]})]})]})]})}function R8(){const[t,e]=ne.useState(""),[n,s]=ne.useState(null),r=Object.entries({"Cuts and Wounds":[{title:"Minor Cuts",steps:["Clean your hands thoroughly with soap and water","Clean the cut with mild soap and water","Apply antibiotic ointment","Cover with a sterile bandage"],warning:"Seek medical attention if the wound is deep, gaping, or shows signs of infection"},{title:"Severe Bleeding",steps:["Apply direct pressure with a clean cloth","Keep the injured area elevated","Apply a pressure bandage","Call emergency services immediately"],warning:"This is a medical emergency - call for help right away"}],Burns:[{title:"First-Degree Burns",steps:["Cool the burn under cool (not cold) running water for 10-20 minutes","Apply aloe vera gel or moisturizer","Take pain reliever if needed","Cover with a sterile gauze bandage"],warning:"Do not apply ice directly to a burn"},{title:"Second-Degree Burns",steps:["Run under cool water for 15-20 minutes","Do not break blisters","Cover loosely with sterile gauze","Seek medical attention"],warning:"Never apply butter or oil to burns"}],"CPR and Breathing":[{title:"Adult CPR",steps:["Check the scene is safe and call for emergency help","Check for responsiveness and breathing","Begin chest compressions (30 compressions at 100-120 bpm)","Give 2 rescue breaths","Continue cycles of 30 compressions and 2 breaths"],warning:"Proper CPR training is strongly recommended. This is only a basic guide."},{title:"Recovery Position",steps:["Kneel beside the person and straighten their legs","Place the arm nearest to you at a right angle to their body","Place their other arm across their chest","Roll them onto their side","Tilt their head back to keep airway open"],warning:"Only use recovery position if the person is breathing normally"}],Choking:[{title:"Conscious Adult/Child",steps:["Give 5 back blows between shoulder blades","Perform abdominal thrusts (Heimlich maneuver)","Alternate between back blows and abdominal thrusts","Continue until object is expelled or person becomes unconscious"],warning:"If person becomes unconscious, start CPR immediately and call emergency services"},{title:"Infant Choking",steps:["Support infant face down on your forearm","Give 5 back blows between shoulder blades","Turn infant face up and give 5 chest thrusts","Continue alternating until object is expelled"],warning:"Seek immediate medical attention after any choking incident"}],"Fractures and Sprains":[{title:"Suspected Fracture",steps:["Keep the injured area still","Apply ice wrapped in cloth to reduce swelling","Immobilize the area if possible","Seek immediate medical attention"],warning:"Do not attempt to realign broken bones"},{title:"Sprain Treatment",steps:["Remember RICE: Rest, Ice, Compression, Elevation","Apply ice for 20 minutes every 2-3 hours","Use an elastic bandage for compression","Keep the injured area elevated above heart level"],warning:"Seek medical attention if unable to bear weight or severe pain persists"}],"Head Injuries":[{title:"Concussion",steps:["Stop any activity immediately","Rest in a quiet, dark place","Apply cold pack to swelling","Monitor for worsening symptoms"],warning:"Seek immediate medical attention if unconscious or vomiting"},{title:"Severe Head Trauma",steps:["Call emergency services immediately","Keep person still - do not move them","Monitor breathing and consciousness","Stop any bleeding with gentle pressure"],warning:"Do not remove any object penetrating the head"}],Poisoning:[{title:"Swallowed Poison",steps:["Call poison control center immediately","Do not induce vomiting unless told to do so","Save the container or substance","Follow professional guidance exactly"],warning:"Never give anything by mouth unless instructed by professionals"},{title:"Inhaled Poison",steps:["Get to fresh air immediately","Open windows and doors if inside","Call emergency services","Begin CPR if needed and you are trained"],warning:"Do not enter a contaminated area without proper protection"}],"Heat-Related":[{title:"Heat Exhaustion",steps:["Move to a cool place","Lie down and elevate feet slightly","Remove excess clothing","Sip cool water","Apply cool, wet cloths to body"],warning:"If symptoms worsen, seek immediate medical attention"},{title:"Heat Stroke",steps:["Call emergency services immediately","Move to a cool area","Remove excess clothing","Cool body with water or ice packs","Monitor breathing and consciousness"],warning:"This is a life-threatening emergency requiring immediate medical attention"}],"Cold-Related":[{title:"Frostbite",steps:["Get to a warm area","Remove wet clothing","Gradually warm affected areas","Do not rub or massage frozen areas"],warning:"Do not use direct heat (fire, heating pad) on frostbitten areas"},{title:"Hypothermia",steps:["Call emergency services","Move to warm area","Remove wet clothing","Warm core body first","Give warm beverages if conscious"],warning:"Severe hypothermia requires immediate professional medical care"}],"Allergic Reactions":[{title:"Mild Allergic Reaction",steps:["Remove exposure to allergen if possible","Take antihistamine if available","Apply cool compress to itchy areas","Monitor for worsening symptoms"],warning:"Watch for signs of severe reaction (difficulty breathing, swelling)"},{title:"Severe Allergic Reaction",steps:["Use epinephrine auto-injector if available","Call emergency services immediately","Help person lie flat","Monitor breathing and pulse"],warning:"Anaphylaxis is life-threatening - seek immediate medical care"}],"Eye Injuries":[{title:"Foreign Object",steps:["Do not rub the eye","Blink repeatedly to remove loose object","Flush with clean water if needed","Seek medical attention if object persists"],warning:"Do not attempt to remove embedded objects"},{title:"Chemical Splash",steps:["Flush eye immediately with clean water","Continue flushing for 15-20 minutes","Remove contact lenses if present","Seek immediate medical attention"],warning:"Chemical eye injuries require immediate professional care"}],Seizures:[{title:"During a Seizure",steps:["Clear the area of harmful objects","Protect head with something soft","Turn person on their side if possible","Time the seizure","Never put anything in their mouth"],warning:"Call emergency services if seizure lasts more than 5 minutes"}],"Dental Emergencies":[{title:"Knocked Out Tooth",steps:["Handle tooth by crown, not root","Rinse tooth gently if dirty","Try to reinsert in socket if possible","If not possible, keep tooth in milk","See dentist immediately"],warning:"Time is critical - seek dental care within 30 minutes if possible"}],"Stings and Bites":[{title:"Insect Stings",steps:["Remove stinger if present","Clean area with soap and water","Apply cold compress","Take antihistamine if needed"],warning:"Watch for signs of severe allergic reaction"},{title:"Snake Bite",steps:["Keep victim calm and still","Remove constricting items","Mark time of bite and symptoms","Seek immediate medical attention"],warning:"Do not attempt to suck out venom or apply tourniquet"}],Drowning:[{title:"Near-Drowning",steps:["Remove from water if safe to do so","Check breathing and circulation","Begin CPR if necessary","Call emergency services"],warning:"All near-drowning victims need medical evaluation"}],"Electrical Injuries":[{title:"Electrical Shock",steps:["Do not touch person until power source is off","Check breathing and pulse","Cover burns with sterile dressing","Seek immediate medical attention"],warning:"Always assume power lines are live"}]}).reduce((o,[a,l])=>{const c=l.filter(h=>h.title.toLowerCase().includes(t.toLowerCase())||a.toLowerCase().includes(t.toLowerCase()));return c.length>0&&(o[a]=c),o},{});return A.jsx("div",{className:"container mx-auto px-4 py-8",children:A.jsxs("div",{className:"max-w-4xl mx-auto",children:[A.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"First Aid Guide"}),A.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-8",children:A.jsxs("div",{className:"flex items-start",children:[A.jsx(_g,{className:"text-red-500 mr-2 flex-shrink-0 mt-1"}),A.jsxs("div",{children:[A.jsx("p",{className:"font-semibold text-red-700",children:"Emergency Warning"}),A.jsx("p",{className:"text-red-600",children:"This guide is for informational purposes only. In case of a medical emergency, immediately call your local emergency services or visit the nearest hospital."})]})]})}),A.jsxs("div",{className:"relative mb-8",children:[A.jsx("input",{type:"text",placeholder:"Search first aid guides...",value:t,onChange:o=>e(o.target.value),className:"w-full px-4 py-3 pl-12 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),A.jsx(iH,{className:"absolute left-4 top-3.5 text-gray-400",size:20})]}),A.jsx("div",{className:"space-y-4",children:Object.entries(r).map(([o,a])=>A.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[A.jsxs("button",{onClick:()=>s(n===o?null:o),className:"w-full px-6 py-4 flex justify-between items-center bg-gray-50 hover:bg-gray-100 transition-colors",children:[A.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:o}),n===o?A.jsx(QG,{className:"text-gray-600"}):A.jsx(YG,{className:"text-gray-600"})]}),n===o&&A.jsx("div",{className:"p-6 space-y-6",children:a.map((l,c)=>A.jsxs("div",{className:"border-b border-gray-200 last:border-0 pb-6 last:pb-0",children:[A.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:l.title}),A.jsx("ol",{className:"list-decimal pl-6 space-y-2 mb-4",children:l.steps.map((h,d)=>A.jsx("li",{className:"text-gray-700",children:h},d))}),l.warning&&A.jsx("div",{className:"mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4",children:A.jsxs("div",{className:"flex",children:[A.jsx(_g,{className:"text-yellow-400 mr-2 flex-shrink-0"}),A.jsx("p",{className:"text-sm text-yellow-700",children:l.warning})]})})]},c))})]},o))})]})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8=1e-7,D8=1e-4;class QP{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class G1{refCount(e){return _s("refCount")}incRef(e){return _s("incRef")}timerAvailable(){return!0}time(e){return _s("time")}read(e){return _s("read")}readSync(e){return _s("readSync")}readToGPU(e,n){return _s("readToGPU")}numDataIds(){return _s("numDataIds")}disposeData(e,n){return _s("disposeData")}write(e,n,s){return _s("write")}move(e,n,s,i,r){return _s("move")}createTensorFromGPUData(e,n,s){return _s("createTensorFromGPUData")}memory(){return _s("memory")}floatPrecision(){return _s("floatPrecision")}epsilon(){return this.floatPrecision()===32?A8:D8}dispose(){return _s("dispose")}}function _s(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P8(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,vc(t,e,n)}function vl(t,e,n){return Math.max(t,Math.min(e,n))}function H1(t){return t%2===0?t:t+1}function vc(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function O8(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function R(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function q1(t,e,n=""){R(ct(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function K1(t){R(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function re(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function ct(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ou(t){return t%1===0}function Ew(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Gc(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function NN(t,e=i=>0,n,s){return new Promise((i,r)=>{let o=0;const a=()=>{if(t()){i();return}o++;const l=e(o);if(n!=null&&o>=n){r();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function JP(t,e){let n=1,s=-1;for(let r=0;r<t.length;++r)if(t[r]>=0)n*=t[r];else if(t[r]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${r}`);s=r}else if(t[r]<0)throw Error(`Shapes can not be < 0. Found ${t[r]} at dim ${r}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[s]=e/n,i}function Ge(t,e){const n=e.length;return t=t==null?e.map((s,i)=>i):[].concat(t),R(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),R(t.every(s=>ou(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function ga(t,e){const n=[],s=[],i=e!=null&&Array.isArray(e)&&e.length===0,r=e==null||i?null:Ge(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(r!=null){if(r[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(r[o]==null||r[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),r[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function Wn(t,e){return qt(t,e)}function qt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function L8(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function F8(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function eO(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Ag(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function M8(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function rf(t){return typeof t=="string"||t instanceof String}function z8(t){return typeof t=="boolean"}function Nw(t){return typeof t=="number"}function Nu(t){return Array.isArray(t)?Nu(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Nw(t)?"float32":rf(t)?"string":z8(t)?"bool":"float32"}function $w(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Rw(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Te(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function tO(t,e,n,s=!1){const i=new Array;if(e.length===1){const r=e[0]*(s?2:1);for(let o=0;o<r;o++)i[o]=n[t+o]}else{const r=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<r;l++)i[l]=tO(t+l*a,o,n,s)}return i}function Gi(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((i,r)=>i*r)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return tO(0,t,e,n)}function B8(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function X1(t,e){const n=Vn(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function Vn(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function nO(t,e){const n=t.reduce((s,i)=>s*i,1);if(e==null||e==="float32")return Gi(t,new Float32Array(n));if(e==="int32")return Gi(t,new Int32Array(n));if(e==="bool")return Gi(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function po(t){t.forEach(e=>{R(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function wr(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let i=0;i<t.length-1;++i)s+=n[i]*t[i];return s}function $u(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(t/n[i]),t-=s[i]*n[i];return s[s.length-1]=t,s}function Z1(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $N="tfjsflags";class U8{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=W8,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const i=this.urlFlags[e];ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Z1(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);$N in e&&e[$N].split(",").forEach(s=>{const[i,r]=s.split(":");this.urlFlags[i]=j8(i,r)})}}function W8(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(V8(e,s[0],s[1]),s.join("="))),e}function V8(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function j8(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function ee(){return sO}let sO=null;function G8(t){sO=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let j_;function iO(){if(j_==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");j_=t}return j_}function H8(){const t=iO();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Y1(t,e){const n=H8();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Xy="Abs",of="Acos",af="Acosh",Ru="Add",Q1="AddN",J1="All",eC="Any",Zy="ArgMax",Yy="ArgMin",lf="Asin",cf="Asinh",uf="Atan",hf="Atanh",df="Atan2",Qy="AvgPool",tC="AvgPoolGrad",Jy="AvgPool3D",nC="AvgPool3DGrad",ev="BatchMatMul",tv="BatchToSpaceND",sC="Bincount",iC="BitwiseAnd",q8="BroadcastTo",rO="BroadcastArgs",ff="Cast",pf="Ceil",mf="ClipByValue",rC="Complex",nv="ComplexAbs",sv="Concat",iv="Conv2D",oC="Conv2DBackpropFilter",rv="Conv2DBackpropInput",ov="Conv3D",aC="Conv3DBackpropFilterV2",lC="Conv3DBackpropInputV2",gf="Cos",yf="Cosh",cC="Cumprod",av="Cumsum",uC="CropAndResize",hC="DenseBincount",dC="DepthToSpace",lv="DepthwiseConv2dNative",fC="DepthwiseConv2dNativeBackpropFilter",pC="DepthwiseConv2dNativeBackpropInput",oO="Diag",cv="Dilation2D",Aw="Dilation2DBackpropInput",Dw="Dilation2DBackpropFilter",K8="Draw",vf="RealDiv",mC="Einsum",xf="Elu",gC="EluGrad",_f="Erf",uv="Equal",wf="Exp",hv="ExpandDims",bf="Expm1",yC="FFT",vC="Fill",xC="FlipLeftRight",Cf="Floor",If="FloorDiv",dv="FusedBatchNorm",fv="GatherV2",aO="GatherNd",pv="Greater",kf="GreaterEqual",Sf="Identity",_C="IFFT",wC="Imag",Tf="IsFinite",Ef="IsInf",Nf="IsNan",mv="LeakyRelu",gv="Less",yv="LessEqual",lO="LinSpace",$f="Log",Rf="Log1p",vv="LogicalAnd",xv="LogicalNot",_v="LogicalOr",X8="LogSoftmax",wv="LRN",bC="LRNGrad",bv="Max",Af="Maximum",Cv="MaxPool",CC="MaxPoolGrad",Iv="MaxPool3D",IC="MaxPool3DGrad",cO="MaxPoolWithArgmax",kv="Mean",Sv="Min",Df="Minimum",Tv="MirrorPad",Pf="Mod",uO="Multinomial",Of="Multiply",Ev="Neg",Nv="NotEqual",kC="NonMaxSuppressionV3",SC="NonMaxSuppressionV4",TC="NonMaxSuppressionV5",$v="OnesLike",Rv="OneHot",Av="Pack",Dv="PadV2",Lf="Pow",Pv="Prelu",Ov="Prod",hO="RaggedGather",dO="RaggedRange",fO="RaggedTensorToTensor",EC="Range",NC="Real",Ff="Reciprocal",Mf="Relu",Lv="Reshape",Fv="ResizeNearestNeighbor",$C="ResizeNearestNeighborGrad",Mv="ResizeBilinear",RC="ResizeBilinearGrad",zf="Relu6",zv="Reverse",Bf="Round",Uf="Rsqrt",pO="ScatterNd",mO="TensorScatterUpdate",gO="SearchSorted",Bv="Select",Wf="Selu",Uv="Slice",Vf="Sin",jf="Sinh",Gf="Sign",Hf="Sigmoid",qf="Softplus",Kf="Sqrt",Wv="Sum",Vv="SpaceToBatchND",jv="SplitV",Gv="Softmax",yO="SparseFillEmptyRows",vO="SparseReshape",xO="SparseSegmentMean",_O="SparseSegmentSum",wO="SparseToDense",Xf="SquaredDifference",AC="Square",DC="StaticRegexReplace",PC="StridedSlice",bO="StringNGrams",CO="StringSplit",IO="StringToHashBucketFast",Zf="Sub",Yf="Tan",Qf="Tanh",Jf="Tile",OC="TopK",LC="Transform",Hc="Transpose",FC="Unique",Hv="Unpack",qv="UnsortedSegmentSum",Kv="ZerosLike",ep="Step",Pw="FromPixels",MC="RotateWithOffset",Dg="_FusedMatMul",Pg="FusedConv2D",kO="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bs(...t){ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(...t)}function Z8(...t){ee().getBool("IS_TEST")||ee().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Og=Y1("kernelRegistry",()=>new Map),Ow=Y1("gradRegistry",()=>new Map);function Lw(t,e){const n=TO(t,e);return Og.get(n)}function RN(t){return Ow.get(t)}function AN(t){const e=Og.entries(),n=[];for(;;){const{done:s,value:i}=e.next();if(s)break;const[r,o]=i,[a]=r.split("_");a===t&&n.push(o)}return n}function SO(t){const{kernelName:e,backendName:n}=t,s=TO(e,n);Og.has(s)&&Bs(`The kernel '${e}' for backend '${n}' is already registered`),Og.set(s,t)}function Y8(t){const{kernelName:e}=t;Ow.has(e)&&ee().getBool("DEBUG")&&Bs(`Overriding the gradient for '${e}'`),Ow.set(e,t)}function TO(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EO(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var NO=Nt,hi=null;try{hi=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Nt(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Nt.prototype.__isLong__;Object.defineProperty(Nt.prototype,"__isLong__",{value:!0});function Fs(t){return(t&&t.__isLong__)===!0}Nt.isLong=Fs;var DN={},PN={};function jl(t,e){var n,s,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(s=PN[t],s)?s:(n=$t(t,(t|0)<0?-1:0,!0),i&&(PN[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(s=DN[t],s)?s:(n=$t(t,t<0?-1:0,!1),i&&(DN[t]=n),n))}Nt.fromInt=jl;function di(t,e){if(isNaN(t))return e?Qa:fi;if(e){if(t<0)return Qa;if(t>=$O)return DO}else{if(t<=-9223372036854776e3)return Is;if(t+1>=J8)return AO}return t<0?di(-t,e).neg():$t(t%au|0,t/au|0,e)}Nt.fromNumber=di;function $t(t,e,n){return new Nt(t,e,n)}Nt.fromBits=$t;var Lg=Math.pow;function zC(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return fi;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return zC(t.substring(1),e,n).neg();for(var i=di(Lg(n,8)),r=fi,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=di(Lg(n,a));r=r.mul(c).add(di(l))}else r=r.mul(i),r=r.add(di(l))}return r.unsigned=e,r}Nt.fromString=zC;function tr(t,e){return typeof t=="number"?di(t,e):typeof t=="string"?zC(t,e):$t(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Nt.fromValue=tr;var ON=65536,Q8=1<<24,au=ON*ON,$O=au*au,J8=$O/2,LN=jl(Q8),fi=jl(0);Nt.ZERO=fi;var Qa=jl(0,!0);Nt.UZERO=Qa;var Pc=jl(1);Nt.ONE=Pc;var RO=jl(1,!0);Nt.UONE=RO;var Fw=jl(-1);Nt.NEG_ONE=Fw;var AO=$t(-1,2147483647,!1);Nt.MAX_VALUE=AO;var DO=$t(-1,-1,!0);Nt.MAX_UNSIGNED_VALUE=DO;var Is=$t(0,-2147483648,!1);Nt.MIN_VALUE=Is;var ve=Nt.prototype;ve.toInt=function(){return this.unsigned?this.low>>>0:this.low};ve.toNumber=function(){return this.unsigned?(this.high>>>0)*au+(this.low>>>0):this.high*au+(this.low>>>0)};ve.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Is)){var n=di(e),s=this.div(n),i=s.mul(n).sub(this);return s.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=di(Lg(e,6),this.unsigned),o=this,a="";;){var l=o.div(r),c=o.sub(l.mul(r)).toInt()>>>0,h=c.toString(e);if(o=l,o.isZero())return h+a;for(;h.length<6;)h="0"+h;a=""+h+a}};ve.getHighBits=function(){return this.high};ve.getHighBitsUnsigned=function(){return this.high>>>0};ve.getLowBits=function(){return this.low};ve.getLowBitsUnsigned=function(){return this.low>>>0};ve.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Is)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ve.isZero=function(){return this.high===0&&this.low===0};ve.eqz=ve.isZero;ve.isNegative=function(){return!this.unsigned&&this.high<0};ve.isPositive=function(){return this.unsigned||this.high>=0};ve.isOdd=function(){return(this.low&1)===1};ve.isEven=function(){return(this.low&1)===0};ve.equals=function(e){return Fs(e)||(e=tr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ve.eq=ve.equals;ve.notEquals=function(e){return!this.eq(e)};ve.neq=ve.notEquals;ve.ne=ve.notEquals;ve.lessThan=function(e){return this.comp(e)<0};ve.lt=ve.lessThan;ve.lessThanOrEqual=function(e){return this.comp(e)<=0};ve.lte=ve.lessThanOrEqual;ve.le=ve.lessThanOrEqual;ve.greaterThan=function(e){return this.comp(e)>0};ve.gt=ve.greaterThan;ve.greaterThanOrEqual=function(e){return this.comp(e)>=0};ve.gte=ve.greaterThanOrEqual;ve.ge=ve.greaterThanOrEqual;ve.compare=function(e){if(Fs(e)||(e=tr(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ve.comp=ve.compare;ve.negate=function(){return!this.unsigned&&this.eq(Is)?Is:this.not().add(Pc)};ve.neg=ve.negate;ve.add=function(e){Fs(e)||(e=tr(e));var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,r=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,h=0,d=0,f=0,m=0;return m+=r+c,f+=m>>>16,m&=65535,f+=i+l,d+=f>>>16,f&=65535,d+=s+a,h+=d>>>16,d&=65535,h+=n+o,h&=65535,$t(f<<16|m,h<<16|d,this.unsigned)};ve.subtract=function(e){return Fs(e)||(e=tr(e)),this.add(e.neg())};ve.sub=ve.subtract;ve.multiply=function(e){if(this.isZero())return fi;if(Fs(e)||(e=tr(e)),hi){var n=hi.mul(this.low,this.high,e.low,e.high);return $t(n,hi.get_high(),this.unsigned)}if(e.isZero())return fi;if(this.eq(Is))return e.isOdd()?Is:fi;if(e.eq(Is))return this.isOdd()?Is:fi;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(LN)&&e.lt(LN))return di(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,h=e.low&65535,d=0,f=0,m=0,g=0;return g+=o*h,m+=g>>>16,g&=65535,m+=r*h,f+=m>>>16,m&=65535,m+=o*c,f+=m>>>16,m&=65535,f+=i*h,d+=f>>>16,f&=65535,f+=r*c,d+=f>>>16,f&=65535,f+=o*l,d+=f>>>16,f&=65535,d+=s*h+i*c+r*l+o*a,d&=65535,$t(m<<16|g,d<<16|f,this.unsigned)};ve.mul=ve.multiply;ve.divide=function(e){if(Fs(e)||(e=tr(e)),e.isZero())throw Error("division by zero");if(hi){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?hi.div_u:hi.div_s)(this.low,this.high,e.low,e.high);return $t(n,hi.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qa:fi;var s,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qa;if(e.gt(this.shru(1)))return RO;r=Qa}else{if(this.eq(Is)){if(e.eq(Pc)||e.eq(Fw))return Is;if(e.eq(Is))return Pc;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(fi)?e.isNegative()?Pc:Fw:(i=this.sub(e.mul(s)),r=s.add(i.div(e)),r)}else if(e.eq(Is))return this.unsigned?Qa:fi;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=fi}for(i=this;i.gte(e);){s=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Lg(2,a-48),c=di(s),h=c.mul(e);h.isNegative()||h.gt(i);)s-=l,c=di(s,this.unsigned),h=c.mul(e);c.isZero()&&(c=Pc),r=r.add(c),i=i.sub(h)}return r};ve.div=ve.divide;ve.modulo=function(e){if(Fs(e)||(e=tr(e)),hi){var n=(this.unsigned?hi.rem_u:hi.rem_s)(this.low,this.high,e.low,e.high);return $t(n,hi.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ve.mod=ve.modulo;ve.rem=ve.modulo;ve.not=function(){return $t(~this.low,~this.high,this.unsigned)};ve.and=function(e){return Fs(e)||(e=tr(e)),$t(this.low&e.low,this.high&e.high,this.unsigned)};ve.or=function(e){return Fs(e)||(e=tr(e)),$t(this.low|e.low,this.high|e.high,this.unsigned)};ve.xor=function(e){return Fs(e)||(e=tr(e)),$t(this.low^e.low,this.high^e.high,this.unsigned)};ve.shiftLeft=function(e){return Fs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$t(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):$t(0,this.low<<e-32,this.unsigned)};ve.shl=ve.shiftLeft;ve.shiftRight=function(e){return Fs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$t(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):$t(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ve.shr=ve.shiftRight;ve.shiftRightUnsigned=function(e){if(Fs(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return $t(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?$t(n,0,this.unsigned):$t(n>>>e-32,0,this.unsigned)};ve.shru=ve.shiftRightUnsigned;ve.shr_u=ve.shiftRightUnsigned;ve.toSigned=function(){return this.unsigned?$t(this.low,this.high,!1):this};ve.toUnsigned=function(){return this.unsigned?this:$t(this.low,this.high,!0)};ve.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ve.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ve.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Nt.fromBytes=function(e,n,s){return s?Nt.fromBytesLE(e,n):Nt.fromBytesBE(e,n)};Nt.fromBytesLE=function(e,n){return new Nt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Nt.fromBytesBE=function(e,n){return new Nt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const PO=Tb(NO),eX=tR({__proto__:null,default:PO},[NO]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ga=PO||eX;function Xv(t){return Ga.fromString(t,!0,16)}const OO=Xv("c3a5c85c97cb3127"),Wa=Xv("b492b66fbe98f273"),Jn=Xv("9ae16a3b2f90404f");function Mw(t){return t.xor(t.shru(47))}function LO(t,e,n){const s=t.slice(e,e+n);return Ga.fromBytes(Array.from(s),!0,!0)}function bt(t,e){return LO(t,e,8)}function FN(t,e){return LO(t,e,4)}function xn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Ko(t,e,n=Xv("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let i=e.xor(s).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function tX(t,e,n,s,i,r){i=i.add(t),r=xn(r.add(i).add(s),21);const o=i;return i=i.add(e),i=i.add(n),r=r.add(xn(i,44)),[i.add(s),r.add(o)]}function pm(t,e,n,s){return tX(bt(t,e),bt(t,e+8),bt(t,e+16),bt(t,e+24),n,s)}function nX(t,e=t.length){if(e>=8){const n=Jn.add(e*2),s=bt(t,0).add(Jn),i=bt(t,e-8),r=xn(i,37).mul(n).add(s),o=xn(s,25).add(i).mul(n);return Ko(r,o,n)}if(e>=4){const n=Jn.add(e*2),s=FN(t,0);return Ko(s.shl(3).add(e),FN(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],i=t[e-1],r=n+(s<<8),o=e+(i<<2);return Mw(Jn.mul(r).xor(OO.mul(o))).mul(Jn)}return Jn}function sX(t,e=t.length){const n=Jn.add(e*2),s=bt(t,0).mul(Wa),i=bt(t,8),r=bt(t,e-8).mul(n),o=bt(t,e-16).mul(Jn);return Ko(xn(s.add(i),43).add(xn(r,30)).add(o),s.add(xn(i.add(Jn),18)).add(r),n)}function iX(t,e=t.length){const n=Jn.add(e*2),s=bt(t,0).mul(Jn),i=bt(t,8),r=bt(t,e-8).mul(n),o=bt(t,e-16).mul(Jn),a=xn(s.add(i),43).add(xn(r,30)).add(o),l=Ko(a,s.add(xn(i.add(Jn),18)).add(r),n),c=bt(t,16).mul(n),h=bt(t,24),d=a.add(bt(t,e-32)).mul(n),f=l.add(bt(t,e-24)).mul(n);return Ko(xn(c.add(h),43).add(xn(d,30)).add(f),c.add(xn(h.add(s),18)).add(d),n)}function rX(t,e=t.length){const n=Ga.fromNumber(81,!0);if(e<=32)return e<=16?nX(t,e):sX(t,e);if(e<=64)return iX(t,e);let s=n,i=n.mul(Wa).add(113),r=Mw(i.mul(Jn).add(113)).mul(Jn),o=[Ga.UZERO,Ga.UZERO],a=[Ga.UZERO,Ga.UZERO];s=s.mul(Jn).add(bt(t,0));let l=0;const c=(e-1>>6)*64,h=c+(e-1&63)-63;do s=xn(s.add(i).add(o[0]).add(bt(t,l+8)),37).mul(Wa),i=xn(i.add(o[1]).add(bt(t,l+48)),42).mul(Wa),s=s.xor(a[1]),i=i.add(o[0]).add(bt(t,l+40)),r=xn(r.add(a[0]),33).mul(Wa),o=pm(t,l,o[1].mul(Wa),s.add(a[0])),a=pm(t,l+32,r.add(a[1]),i.add(bt(t,l+16))),[r,s]=[s,r],l+=64;while(l!==c);const d=Wa.add(r.and(255).shl(1));return l=h,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=xn(s.add(i).add(o[0]).add(bt(t,l+8)),37).mul(d),i=xn(i.add(o[1]).add(bt(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(bt(t,l+40))),r=xn(r.add(a[0]),33).mul(d),o=pm(t,l,o[1].mul(d),s.add(a[0])),a=pm(t,l+32,r.add(a[1]),i.add(bt(t,l+16))),[r,s]=[s,r],Ko(Ko(o[0],a[0],d).add(Mw(i).mul(OO)).add(r),Ko(o[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ya(t,e){return e==="string"?Xo(t):Gl([t],e)}function oX(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Gl(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=xl(t)),ee().getBool("DEBUG")&&L8(t,e),oX(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function ls(){return ee().platform.now()}function Xo(t,e="utf-8"){return e=e||"utf-8",ee().platform.encode(t,e)}function ta(t,e="utf-8"){return e=e||"utf-8",ee().platform.decode(t,e)}function _i(t){return ee().platform.isTypedArray!=null?ee().platform.isTypedArray(t):EO(t)}function xl(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Z1(t)||t==null||_i(t)&&n)e.push(t);else if(Array.isArray(t)||_i(t))for(let s=0;s<t.length;++s)xl(t[s],e,n);else{let s=-1;for(const i of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(i)&&(s=Math.max(s,Number(i)));for(let i=0;i<=s;i++)xl(t[i],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aX{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new cX)}profileKernel(e,n,s){let i;const r=()=>{i=s()};let o;const a=ls();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(r);else{r();for(const c of i)c.dataSync();o=Promise.resolve({kernelMs:ls()-a})}if(ee().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<i.length;c++){const h=i[c];h.data().then(d=>{lX(d,h.dtype,e)})}return{kernelName:e,outputs:i,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:i,inputs:r,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),i,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],r,l[2])})})}}function lX(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const i=t[s];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class cX{logKernelProfile(e,n,s,i,r,o){const a=typeof i=="number"?Gc(`${i}ms`,9):i.error,l=Gc(e,25),c=n.rank,h=n.size,d=Gc(n.shape.toString(),14);let f="";for(const m in r){const g=r[m];if(g!=null){const x=g.shape||n.shape,_=x.length;f+=`${m}: ${_}D ${_>0?x:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${h}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(t,e,n){const s={},i={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],h=c.inputs;for(const d in h){const f=h[d];let m=!1;for(let g=0;g<e.length;g++)if(s[f.id]){c.outputs.forEach(x=>s[x.id]=!0),m=!0,i[c.id]=!0;break}if(m)break}}const r={};r[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],h=c.inputs;for(let d=0;d<c.outputs.length;d++)if(r[c.outputs[d].id]){for(const f in h)r[h[f].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(i[c.id]&&o[c.id]){const h={};for(const f in c.inputs){const m=c.inputs[f];s[m.id]&&(h[f]=m)}const d=Object.assign({},c);d.inputs=h,d.outputs=c.outputs,a.push(d)}}return a}function hX(t,e,n,s){for(let i=e.length-1;i>=0;i--){const r=e[i],o=[];if(r.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),r.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${r.kernelName}.`);const a=r.gradient(o);for(const l in r.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const h=r.inputs[l];if(!ct(c.shape,h.shape))throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${h.shape}'`);if(t[h.id]==null)t[h.id]=c;else{const d=t[h.id];t[h.id]=s(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN=20,xh=3,G_=7;function dX(t,e,n,s){const i=Te(e),r=fX(t,e,n,i),o=e.length,a=Gm(t,e,n,i,r),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function fX(t,e,n,s){const i=re(e),r=s[s.length-1],o=new Array(r).fill(0),a=e.length,l=n==="complex64"?Ph(t):t;if(a>1)for(let c=0;c<i/r;c++){const h=c*r;for(let d=0;d<r;d++)o[d]=Math.max(o[d],Dh(l[h+d],0,n).length)}return o}function Dh(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(G_))} + ${parseFloat(t[1].toFixed(G_))}j`:rf(t)?s=`'${t}'`:n==="bool"?s=FO(t):s=parseFloat(t.toFixed(G_)).toString(),Gc(s,e)}function FO(t){return t===0?"false":"true"}function Gm(t,e,n,s,i,r=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const x=Ph(t);return[Dh(x[0],0,n)]}return n==="bool"?[FO(t[0])]:[t[0].toString()]}if(l===1){if(a>MN){const _=xh*o;let v=Array.from(t.slice(0,_)),w=Array.from(t.slice((a-xh)*o,a*o));return n==="complex64"&&(v=Ph(v),w=Ph(w)),["["+v.map((b,I)=>Dh(b,i[I],n)).join(", ")+", ..., "+w.map((b,I)=>Dh(b,i[a-xh+I],n)).join(", ")+"]"]}return["["+(n==="complex64"?Ph(t):Array.from(t)).map((_,v)=>Dh(_,i[v],n)).join(", ")+"]"]}const c=e.slice(1),h=s.slice(1),d=s[0]*o,f=[];if(a>MN){for(let x=0;x<xh;x++){const _=x*d,v=_+d;f.push(...Gm(t.slice(_,v),c,n,h,i,!1))}f.push("...");for(let x=a-xh;x<a;x++){const _=x*d,v=_+d;f.push(...Gm(t.slice(_,v),c,n,h,i,x===a-1))}}else for(let x=0;x<a;x++){const _=x*d,v=_+d;f.push(...Gm(t.slice(_,v),c,n,h,i,x===a-1))}const m=l===2?",":"";f[0]="["+(a>0?f[0]+m:"");for(let x=1;x<f.length-1;x++)f[x]=" "+f[x]+m;let g=`,
`;for(let x=2;x<l;x++)g+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(r?"":g),f}function Ph(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class An{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=re(e),s!=null){const i=s.length;R(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||qt(n,this.size),this.strides=Te(e)}set(e,...n){n.length===0&&(n=[0]),R(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const i of e){if(i<0||i>=this.shape[n]){const r=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(r)}n++}let s=e[e.length-1];for(let i=0;i<e.length-1;++i)s+=this.strides[i]*e[i];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Fi().makeTensor(this.values,this.shape,this.dtype)}}let Fi=null,xc=null;function pX(t){Fi=t}function mX(t){xc=t}class an{constructor(e,n,s,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=re(e),this.strides=Te(e),this.dataId=s,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return xc.buffer(this.shape,this.dtype,e)}bufferSync(){return xc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Gi(this.shape,e,this.dtype==="complex64")}arraySync(){return Gi(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Fi().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ta(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Fi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Fi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ta(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Fi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Fi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return xc.print(this,e)}clone(){return this.throwIfDisposed(),xc.clone(this)}toString(e=!1){const n=this.dataSync();return dX(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),xc.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Fi().makeVariable(this,e,n,s)}}Object.defineProperty(an,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function ie(){return Y1("Tensor",()=>an)}ie();class Fg extends an{constructor(e,n,s,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ct(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Fi().disposeTensor(this),this.dataId=e.dataId,Fi().incRef(this,null)}dispose(){Fi().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Fg,Symbol.hasInstance,{value:t=>t instanceof an&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zN;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(zN||(zN={}));var zw;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(zw||(zw={}));var Bw;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(Bw||(Bw={}));var Uw;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(Uw||(Uw={}));var Ww;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(Ww||(Ww={}));const gX={float32:Uw,int32:zw,bool:Bw,complex64:Ww};function Ds(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return gX[t][e]}function BC(t){return Ds(t,"int32")}function MO(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function zO(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(t,e){if(t.dtype===e.dtype)return[t,e];const n=Ds(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function BO(t){const e=[];return UO(t,e,new Set),e}function UO(t,e,n){if(t==null)return;if(t instanceof an){e.push(t);return}if(!yX(t))return;const s=t;for(const i in s){const r=s[i];n.has(r)||(n.add(r),UO(r,e,n))}}function yX(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(t){return t.kernelName!=null}class BN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class lu{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new BN}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Bs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new aX(this.backendInstance),!0}setupRegisteredKernels(){AN(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){AN(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof G1)&&typeof s.then=="function"){const i=++this.pendingBackendInitId,r=s.then(o=>i<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Bs(`Initialization of backend ${e} failed`),Bs(o.stack||o.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Bs(`Initialization of backend ${e} failed`),Bs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:i,asyncInit:r}=this.initializeBackend(s);if(r||i)return{name:s,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),i=s.backend,r=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),s.backend=e,e.move(n,r,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let i;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,n,s){e();try{const i=s();return n(),i}catch(i){throw n(),i}}nextTensorId(){return lu.nextTensorId++}nextVariableId(){return lu.nextVariableId++}clone(e){const n=W.runKernel(Sf,{x:e}),s={x:e},i=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return W.runKernel(ff,l,c)}}),r=[];return this.addTapeNode(this.state.activeScope.name,s,[n],i,r,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(Lw(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const i=this.backend.numDataIds();let r=0;s.forEach(l=>{r+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-r-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const i=this.isTapeOn(),r=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=H_(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(H_(e)){const{kernelName:g,inputs:x,attrs:_}=e;this.backendName==null&&this.backend;const v=Lw(g,this.backendName);R(v!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=v.kernelFunc({inputs:x,attrs:_,backend:this.backend});const b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,w,b);const I=b.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(i){const S=this.getTensorsForGradient(g,x,I);s=this.saveTensorsForBackwardMode(S)}return I}}else{const{forwardFunc:g}=e,x=_=>{i&&(s=_.map(v=>this.keep(this.clone(v))))};a=()=>{const _=this.backend.numDataIds();l=this.tidy(()=>g(this.backend,x));const v=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,_,v),v}}const{inputs:h,attrs:d}=e,f=H_(e)?null:e.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(m=this.profiler.profileKernel(c,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),n=m.outputs)}),i&&this.addTapeNode(c,h,n,f,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(g=>h[g]!=null?h[g].shape:null),outputShapes:n.map(g=>g.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const i=RN(e);if(i!=null){const r=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(R(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=r.map(c=>n[c]);const l=s.filter((c,h)=>o[h]);return a.concat(l)}return[]}makeTensor(e,n,s,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",i=i||this.backend;let r=e;s==="string"&&rf(e[0])&&(r=e.map(l=>Xo(l)));const o=i.write(r,n,s),a=new an(n,s,o,this.nextTensorId());if(this.trackTensor(a,i),s==="string"){const l=this.state.tensorInfo.get(o),c=M8(r);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,i){s=s||"float32";const r={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(r,i)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:i,dtype:r}=e,o=new an(i,r,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,i){s=s||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const r=new Fg(e,n,s,this.nextTensorId());if(this.state.registeredVariables[r.name]!=null)throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Ag(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Fg||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Ag(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,i,r,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:r},l=RN(e);l!=null&&(i=l.gradFunc),i!=null&&(a.gradient=c=>(c=c.map((h,d)=>{if(h==null){const f=s[d],m=Vn(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return h}),i(c.length>1?c:c[0],r,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=BO(e),s=new Set(n.map(r=>r.id));for(let r=0;r<this.state.activeScope.track.length;r++){const o=this.state.activeScope.track[r];!o.kept&&!s.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(r=>{!r.kept&&r.scopeId===i.id&&this.track(r)})}gradients(e,n,s,i=!1){if(R(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));R(r instanceof an,()=>"The result y returned by f() must be a tensor.");const o=uX(this.state.activeTape,n,r);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[r.id]=s??vX(r.shape),hX(a,o,c=>this.tidy(c),xX);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const h of c.saved)h.dispose()}),this.state.activeTape=null),{value:r,grads:l}})}customGrad(e){return R($w(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{R(n.every(a=>a instanceof an),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const i={};n.forEach((a,l)=>{i[l]=a});const r=(a,l)=>(s=e(...n,l),R(s.value instanceof an,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),R($w(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const c=s.gradFunc(a,l),h=Array.isArray(c)?c:[c];R(h.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),R(h.every(f=>f instanceof an),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return h.forEach((f,m)=>{d[m]=()=>f}),d};return this.runKernelFunc({forwardFunc:r,backwardsFunc:o,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=ls(),s=await this.backend.time(e);return s.wallMs=ls()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new BN;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}lu.nextTensorId=0;lu.nextVariableId=0;function vX(t){const e=X1(re(t),"float32");return W.makeTensor(e,t,"float32")}function WO(){const t=iO();if(t._tfengine==null){const e=new U8(t);t._tfengine=new lu(e)}return G8(t._tfengine.ENV),pX(()=>t._tfengine),t._tfengine}const W=WO();function xX(t,e){const n={a:t,b:e};return W.runKernel(Ru,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(){return typeof navigator<"u"&&navigator!=null}function VO(t){if(t||_X()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function jO(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ps=ee();ps.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ps.registerFlag("IS_BROWSER",()=>jO());ps.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ps.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ps.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ps.registerFlag("PROD",()=>!1);ps.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ps.getBool("DEBUG"));ps.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ps.registerFlag("IS_TEST",()=>!1);ps.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ps.getBool("DEBUG"));ps.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ps.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ps.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tp(t,e){let n=t;if(_i(t))return e==="string"?[]:[t.length];if(MO(t)){const i=t.channels||"RGBA";return[t.height,t.width*i.length]}else if(zO(t))return[t.buffer.size/(e==null?4:Ag(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||_i(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&ee().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&GO(t,s,[]),s}function GO(t,e,n){if(n=n||[],!Array.isArray(t)&&!_i(t)){R(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}R(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),R(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let i=0;i<t.length;++i)GO(t[i],s,n.concat(i))}function UN(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function F(t,e,n,s="numeric"){if(t instanceof ie())return UN(s,t.dtype,e,n),t;let i=Nu(t);if(i!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),UN(s,i,e,n),t==null||!_i(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const r=tp(t,i);!_i(t)&&!Array.isArray(t)&&(t=[t]);const a=i!=="string"?Gl(t,i):xl(t,[],!0);return W.makeTensor(a,r,i)}function HO(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((r,o)=>F(r,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX="__op";function H(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+wX;const i=(...r)=>{W.startScope(n);try{const o=s(...r);return Z1(o)&&console.error("Cannot return a Promise inside of tidy."),W.endScope(o),o}catch(o){throw W.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(t,e){const n=F(t,"real","complex"),s=F(e,"imag","complex");q1(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:n,imag:s};return W.runKernel(rC,i)}const _l=H({complex_:bX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function np(t,e,n,s){if(s==null)s=Nu(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(zO(t)||MO(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return W.backend.createTensorFromGPUData(t,e||n,s)}if(!_i(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){po(e);const i=re(e),r=re(n);R(i===r,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${r}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==re(e.slice(o)):!0;R(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!_i(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Gl(t,s):xl(t,[],!0),W.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zh(t,e,n){const s=tp(t,n);return np(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class va{static join(e){return new va(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>_i(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const i=e[s];s!==e.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const r=n+i.byteLength;this.shards.push({buffer:i,start:n,end:r}),n=r}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const i=n-e,r=new ArrayBuffer(i),o=new Uint8Array(r);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,f=a,g=Math.min(n,c.end)-c.start,x=new Uint8Array(c.buffer,d,g-d);if(o.set(x,f),a+=x.length,n<c.end)break}return r}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(i){return e<i.start?-1:e>=i.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=CX(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function CX(t,e){let n=0,s=t.length;for(;n<=s;){const i=Math.floor((s-n)/2)+n,r=e(t[i]);if(r===0)return i;r<0?s=i:n=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ur(){return W}function WN(){return W.memory()}function Q(t,e){return W.tidy(t,e)}function We(t){BO(t).forEach(n=>n.dispose())}function br(t){return W.keep(t)}function IX(){return W.ready()}function qO(t,e,n=1){return W.registerBackend(t,e,n)}function kX(){return W.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cu=4;async function VN(t,e){const n=[],s=[],i=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<i.length;++o){const a=i[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async d=>{const f=await l.bytes(),m=f.reduce((_,v)=>_+v.length,0)+cu*f.length,g=new Uint8Array(m);let x=0;for(let _=0;_<f.length;_++){const v=f[_],w=new Uint8Array(new Uint32Array([v.length]).buffer);g.set(w,x),x+=cu,g.set(v,x),x+=v.length}d(g)});s.push(h)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const r=await Promise.all(s);return{data:NX(r),specs:n}}function SX(t,e){const n=new va(t),s={};let i=0;for(const r of e){const o=TX(r,(a,l)=>n.slice(i+a,i+l));s[r.name]=EX(r,n.slice(i,i+o)),i+=o}return s}function TX(t,e){const n=re(t.shape);let s;if("quantization"in t){const i=t.quantization;s=Mg[i.dtype]}else if(t.dtype==="string"){let i=0;for(let r=0;r<n;r++)i+=cu+new Uint32Array(e(i,i+cu))[0];return i}else s=Mg[t.dtype];return n*s}function EX(t,e){const n=t.name,s=t.dtype,i=t.shape,r=re(i);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=Mg[l.dtype],h=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(h.length);for(let d=0;d<h.length;d++){const f=h[d];o[d]=f*l.scale+l.min}}else if(l.dtype==="float16")o=zX()(h);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(h.length);for(let d=0;d<h.length;d++){const f=h[d];o[d]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=r*c}else if(s==="string"){const l=re(t.shape);o=[];for(let c=0;c<l;c++){const h=new Uint32Array(e.slice(a,a+cu))[0];a+=cu;const d=new Uint8Array(e.slice(a,a+h));o.push(d),a+=h}}else{const l=Mg[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const c=new Float32Array(o.length/2),h=new Float32Array(o.length/2);for(let g=0;g<c.length;g++)c[g]=o[g*2],h[g]=o[g*2+1];const d=Zh(c,i,"float32"),f=Zh(h,i,"float32"),m=_l(d,f);return d.dispose(),f.dispose(),m}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=r*l}return Zh(o,i,s)}function NX(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(r=>{if(e+=r.byteLength,n.push(r.byteLength===r.buffer.byteLength?r:new r.constructor(r)),!(r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${r.constructor.name}`)});const s=new Uint8Array(e);let i=0;return n.forEach(r=>{s.set(new Uint8Array(r.buffer),i),i+=r.byteLength}),s.buffer}const UC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function jN(t){return UC?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function $X(t){if(UC)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,i=e.length;s<i;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function RX(t){if(UC){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function AX(t){return va.join(t)}function DX(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function PX(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function OX(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),PX(t,n,s)}function WC(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:jN(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:jN(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new va(t.weightData).byteLength}}function GN(t){const e=[];for(const n of t)e.push(...n.weights);return e}function LX(){const t=n=>{let s=n<<13,i=0;for(;!(s&8388608);)i-=8388608,s<<=1;return s&=-8388609,i+=947912704,s|i},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function FX(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function MX(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function zX(){const t=LX(),e=FX(),n=MX();return s=>{const i=new ArrayBuffer(4*s.length),r=new Uint32Array(i);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];r[o]=l}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return yn.instance==null&&(yn.instance=new yn),yn.instance}static registerSaveRouter(e){yn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){yn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return yn.getHandlers(e,"save")}static getLoadHandlers(e,n){return yn.getHandlers(e,"load",n)}static getHandlers(e,n,s){const i=[];return(n==="load"?yn.getInstance().loadRouters:yn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&i.push(a)}),i}}const BX=t=>yn.getSaveHandlers(t),UX=(t,e)=>yn.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vw="tensorflowjs",jw=1,Ja="models_store",Po="model_info_store";function KO(){if(!ee().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Gw(t){const e=t.result;e.createObjectStore(Ja,{keyPath:"modelPath"}),e.createObjectStore(Po,{keyPath:"modelPath"})}class wl{constructor(e){if(this.indexedDB=KO(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,i)=>{const r=this.indexedDB.open(Vw,jw);r.onupgradeneeded=()=>Gw(r),r.onsuccess=()=>{const o=r.result;if(n==null){const a=o.transaction(Ja,"readonly"),c=a.objectStore(Ja).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=h=>(o.close(),i(c.error)),a.oncomplete=()=>o.close()}else{n.weightData=va.join(n.weightData);const a=WC(n),l=o.transaction(Po,"readwrite");let c=l.objectStore(Po),h;try{h=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return i(f)}let d;h.onsuccess=()=>{d=o.transaction(Ja,"readwrite");const f=d.objectStore(Ja);let m;try{m=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(g){return i(g)}m.onsuccess=()=>s({modelArtifactsInfo:a}),m.onerror=g=>{c=l.objectStore(Po);const x=c.delete(this.modelPath);x.onsuccess=()=>(o.close(),i(m.error)),x.onerror=_=>(o.close(),i(m.error))}},h.onerror=f=>(o.close(),i(h.error)),l.oncomplete=()=>{d==null?o.close():d.oncomplete=()=>o.close()}}},r.onerror=o=>i(r.error)})}}wl.URL_SCHEME="indexeddb://";const XO=t=>ee().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(wl.URL_SCHEME)?WX(t.slice(wl.URL_SCHEME.length)):null;yn.registerSaveRouter(XO);yn.registerLoadRouter(XO);function WX(t){return new wl(t)}function VX(t){return t.startsWith(wl.URL_SCHEME)?t.slice(wl.URL_SCHEME.length):t}class jX{constructor(){this.indexedDB=KO()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(Vw,jw);s.onupgradeneeded=()=>Gw(s),s.onsuccess=()=>{const i=s.result,r=i.transaction(Po,"readonly"),a=r.objectStore(Po).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(i.close(),n(a.error)),r.oncomplete=()=>i.close()},s.onerror=i=>n(s.error)})}async removeModel(e){return e=VX(e),new Promise((n,s)=>{const i=this.indexedDB.open(Vw,jw);i.onupgradeneeded=()=>Gw(i),i.onsuccess=()=>{const r=i.result,o=r.transaction(Po,"readwrite"),a=o.objectStore(Po),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return r.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=a.delete(e),d=()=>{c=r.transaction(Ja,"readwrite");const m=c.objectStore(Ja).delete(e);m.onsuccess=()=>n(l.result.modelArtifactsInfo),m.onerror=g=>s(l.error)};h.onsuccess=d,h.onerror=f=>(d(),r.close(),s(l.error))}},l.onerror=h=>(r.close(),s(l.error)),o.oncomplete=()=>{c==null?r.close():c.oncomplete=()=>r.close()}},i.onerror=r=>s(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vr="/",_c="tensorflowjs_models",ZO="info",GX="model_topology",HX="weight_specs",qX="weight_data",KX="model_metadata";function YO(t){return{info:[_c,t,ZO].join(Vr),topology:[_c,t,GX].join(Vr),weightSpecs:[_c,t,HX].join(Vr),weightData:[_c,t,qX].join(Vr),modelMetadata:[_c,t,KX].join(Vr)}}function QO(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function XX(t){const e=t.split(Vr);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Vr)}function ZX(t){return t.startsWith(bl.URL_SCHEME)?t.slice(bl.URL_SCHEME.length):t}class bl{constructor(e){if(!ee().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=YO(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),i=WC(e),r=va.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,$X(r));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}}catch{throw QO(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const r=this.LS.getItem(this.keys.modelMetadata);if(r!=null){const a=JSON.parse(r);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=RX(o),n}}bl.URL_SCHEME="localstorage://";const JO=t=>ee().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(bl.URL_SCHEME)?YX(t.slice(bl.URL_SCHEME.length)):null;yn.registerSaveRouter(JO);yn.registerLoadRouter(JO);function YX(t){return new bl(t)}class QX{constructor(){R(ee().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),R(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=_c+Vr,s=Vr+ZO;for(let i=0;i<this.LS.length;++i){const r=this.LS.key(i);if(r.startsWith(n)&&r.endsWith(s)){const o=XX(r);e[o]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){e=ZX(e);const n=YO(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return QO(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HN="://";class hr{constructor(){this.managers={}}static getInstance(){return hr.instance==null&&(hr.instance=new hr),hr.instance}static registerManager(e,n){R(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(HN)&&(e=e.slice(0,e.indexOf(HN))),R(e.length>0,()=>"scheme must not be an empty string.");const s=hr.getInstance();R(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=hr.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(hr.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JX{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!ee().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const i=this.functionRefs[s.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return EO(e)}}if(ee().get("IS_BROWSER")){ee().setPlatform("browser",new JX);try{hr.registerManager(bl.URL_SCHEME,new QX)}catch{}try{hr.registerManager(wl.URL_SCHEME,new jX)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eZ={importFetch:()=>require("node-fetch")};let q_;class tZ{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return ee().global.fetch!=null?ee().global.fetch(e,n):(q_==null&&(q_=eZ.importFetch()),q_(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ee().get("IS_NODE")&&!ee().get("IS_BROWSER")&&ee().setPlatform("node",new tZ);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function je(t,e="float32",n){return e=e||"float32",po(t),new An(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(t,e){const n=F(t,"x","cast");if(!F8(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},i={dtype:e};return W.runKernel(ff,s,i)}const _e=H({cast_:nZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(t){const n={x:F(t,"x","clone","string_or_numeric")};return W.runKernel(Sf,n)}const rl=H({clone_:sZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iZ(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */WO();const rZ={buffer:je,cast:_e,clone:rl,print:iZ};mX(rZ);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oZ(t,e){let n=F(t,"a","add"),s=F(e,"b","add");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Ru,i)}const pe=H({add_:oZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aZ(t,e){let n=F(t,"a","floorDiv"),s=F(e,"b","floorDiv");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(If,i)}const eL=H({floorDiv_:aZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(t,e){let n=F(t,"a","div"),s=F(e,"b","div");if([n,s]=Xt(n,s),n.dtype==="int32"&&s.dtype==="int32")return eL(n,s);const i={a:n,b:s},r={};return W.runKernel(vf,i,r)}const Re=H({div_:lZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cZ(t,e){let n=F(t,"a","mul"),s=F(e,"b","mul");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Of,i)}const U=H({mul_:cZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(t){const e=F(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return W.runKernel(nv,n)}else{const n={x:e};return W.runKernel(Xy,n)}}const Yn=H({abs_:uZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(t){const n={x:F(t,"x","acos")};return W.runKernel(of,n)}const dZ=H({acos_:hZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(t){const n={x:F(t,"x","acosh")};return W.runKernel(af,n)}const pZ=H({acosh_:fZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(t,e=null,n=!1){const i={x:F(t,"x","all","bool")},r={axis:e,keepDims:n};return W.runKernel(J1,i,r)}const tL=H({all_:mZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(t,e=null,n=!1){const i={x:F(t,"x","any","bool")},r={axis:e,keepDims:n};return W.runKernel(eC,i,r)}const Hw=H({any_:gZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(t,e=0){const s={x:F(t,"x","argMax")},i={axis:e};return W.runKernel(Zy,s,i)}const Nd=H({argMax_:yZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vZ(t,e=0){const s={x:F(t,"x","argMin")},i={axis:e};return W.runKernel(Yy,s,i)}const xZ=H({argMin_:vZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(t){const n={x:F(t,"x","asin")};return W.runKernel(lf,n)}const wZ=H({asin_:_Z});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(t){const n={x:F(t,"x","asinh")};return W.runKernel(cf,n)}const CZ=H({asinh_:bZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IZ(t){const n={x:F(t,"x","atan")};return W.runKernel(uf,n)}const kZ=H({atan_:IZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(t,e){let n=F(t,"a","atan2"),s=F(e,"b","atan2");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(df,i)}const TZ=H({atan2_:SZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZ(t){const n={x:F(t,"x","atanh")};return W.runKernel(hf,n)}const NZ=H({atanh_:EZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sp(t,e,n,s,i="NHWC",r){const o=t[3],a=[...e,o],l=go(i);return Pn(t,a,n,r,s,null,null,l)}function bi(t,e,n,s,i,r,o="channelsLast"){const[a,l]=$d(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Pn(t,c,n,s,i,r,!1,o)}function mo(t,e,n,s,i,r,o="NDHWC"){const[a,l,c]=qw(e);let h,d;if(o==="NDHWC")d="channelsLast",h=[a,l,c,t[4],t[4]];else if(o==="NCDHW")d="channelsFirst",h=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return xa(t,h,n,s,i,!1,d,r)}function Pn(t,e,n,s,i,r,o=!1,a="channelsLast"){let[l,c,h,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,h,d]=t;else if(a==="channelsFirst")[l,d,c,h]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,m,,g]=e,[x,_]=$d(n),[v,w]=$d(s),b=qc(f,v),I=qc(m,w),{padInfo:S,outHeight:T,outWidth:$}=AZ(i,c,h,x,_,b,I,r,a),E=o?g*d:g;let D;return a==="channelsFirst"?D=[l,E,T,$]:a==="channelsLast"&&(D=[l,T,$,E]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:h,inChannels:d,outHeight:T,outWidth:$,outChannels:E,padInfo:S,strideHeight:x,strideWidth:_,filterHeight:f,filterWidth:m,effectiveFilterHeight:b,effectiveFilterWidth:I,dilationHeight:v,dilationWidth:w,inShape:t,outShape:D,filterShape:e}}function xa(t,e,n,s,i,r=!1,o="channelsLast",a){let[l,c,h,d,f]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,h,d,f]=t;else if(o==="channelsFirst")[l,f,c,h,d]=t;else throw new Error(`Unknown dataFormat ${o}`);const[m,g,x,,_]=e,[v,w,b]=qw(n),[I,S,T]=qw(s),$=qc(m,I),E=qc(g,S),D=qc(x,T),{padInfo:P,outDepth:z,outHeight:V,outWidth:q}=DZ(i,c,h,d,v,w,b,$,E,D,a),K=r?_*f:_;let J;return o==="channelsFirst"?J=[l,K,z,V,q]:o==="channelsLast"&&(J=[l,z,V,q,K]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:h,inWidth:d,inChannels:f,outDepth:z,outHeight:V,outWidth:q,outChannels:K,padInfo:P,strideDepth:v,strideHeight:w,strideWidth:b,filterDepth:m,filterHeight:g,filterWidth:x,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:D,dilationDepth:I,dilationHeight:S,dilationWidth:T,inShape:t,outShape:J,filterShape:e}}function $Z(t,e,n,s,i){s==null&&(s=VC(t,e,n));const r=t[0],o=t[1],a=Rd((r-e+2*s)/n+1,i),l=Rd((o-e+2*s)/n+1,i);return[a,l]}function RZ(t,e,n,s,i,r){i==null&&(i=VC(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*i>=e[a]&&(o[a]=Rd((t[a]-e[a]+2*i)/s[a]+1,r));return o}function VC(t,e,n,s=1){const i=qc(e,s);return Math.floor((t[0]*(n-1)-n+i)/2)}function $d(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function qw(t){return typeof t=="number"?[t,t,t]:t}function qc(t,e){return e<=1?t:t+(t-1)*(e-1)}function AZ(t,e,n,s,i,r,o,a,l){let c,h,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const m=$Z([e,n],r,s,t,a);h=m[0],d=m[1]}else if(t==="same"){h=Math.ceil(e/s),d=Math.ceil(n/i);const f=Math.max(0,(h-1)*s+r-e),m=Math.max(0,(d-1)*i+o-n),g=Math.floor(f/2),x=f-g,_=Math.floor(m/2),v=m-_;c={top:g,bottom:x,left:_,right:v,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-r+1)/s),d=Math.ceil((n-o+1)/i);else if(typeof t=="object"){const f=l==="channelsLast"?t[1][0]:t[2][0],m=l==="channelsLast"?t[1][1]:t[2][1],g=l==="channelsLast"?t[2][0]:t[3][0],x=l==="channelsLast"?t[2][1]:t[3][1];c={top:f,bottom:m,left:g,right:x,type:f===0&&m===0&&g===0&&x===0?"VALID":"EXPLICIT"},h=Rd((e-r+f+m)/s+1,a),d=Rd((n-o+g+x)/i+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:h,outWidth:d}}function DZ(t,e,n,s,i,r,o,a,l,c,h){let d,f,m,g;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const _=RZ([e,n,s,1],[a,l,c],1,[i,r,o],t,h);f=_[0],m=_[1],g=_[2]}else if(t==="same"){f=Math.ceil(e/i),m=Math.ceil(n/r),g=Math.ceil(s/o);const x=(f-1)*i+a-e,_=(m-1)*r+l-n,v=(g-1)*o+c-s,w=Math.floor(x/2),b=x-w,I=Math.floor(_/2),S=_-I,T=Math.floor(v/2),$=v-T;d={top:I,bottom:S,left:T,right:$,front:w,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:f,outHeight:m,outWidth:g}}function Rd(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Cl(t){const[e,n,s]=$d(t);return e===1&&n===1&&s===1}function Gn(t,e){return Cl(t)||Cl(e)}function Il(t){return $d(t).every(e=>e>0)}function go(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function vs(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")R(ou(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(i=>{R(ou(i),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(t,e){const s={x:F(t,"x","reshape","string_or_numeric")},i={shape:e};return W.runKernel(Lv,s,i)}const G=H({reshape_:PZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(t,e,n,s,i){const r=F(t,"x","avgPool","float32"),o=1;R(Gn(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=r,l=!1;r.rank===3&&(l=!0,a=G(r,[1,r.shape[0],r.shape[1],r.shape[2]])),R(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),vs("avgPool",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i};let d=W.runKernel(Qy,c,h);return d=_e(d,r.dtype),l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const jC=H({avgPool_:OZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LZ(t,e,n,s,i,r="NDHWC"){const o=F(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),R(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),R(r==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),R(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),vs("avgPool3d",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:r};let d=W.runKernel(Jy,c,h);return d=_e(d,a.dtype),l?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const FZ=H({avgPool3d_:LZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(t,e=0){R(t.length>=1,()=>"Pass at least one tensor to concat");const n=HO(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(r=>{if(r.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${r.dtype}. `)}),n.length===1)return rl(n[0]);const s=n,i={axis:e};return W.runKernel(sv,s,i)}const ds=H({concat_:MZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t,e,n=!1,s=!1){let i=F(t,"a","matMul"),r=F(e,"b","matMul");[i,r]=Xt(i,r);const o={a:i,b:r},a={transposeA:n,transposeB:s};return W.runKernel(ev,o,a)}const lt=H({matMul_:zZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(t){const n={x:F(t,"x","sigmoid","float32")};return W.runKernel(Hf,n)}const Au=H({sigmoid_:BZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(t,e,n){const s=F(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const i={x:s},r={begin:e,size:n};return W.runKernel(Uv,i,r)}const Ct=H({slice_:UZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(t){const n={x:F(t,"x","tanh","float32")};return W.runKernel(Qf,n)}const Zv=H({tanh_:WZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(t,e,n){const s=F(t,"x","batchToSpaceND"),i=e.reduce((a,l)=>a*l);R(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),R(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),R(s.shape[0]%i===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`);const r={x:s},o={blockShape:e,crops:n};return W.runKernel(tv,r,o)}const GC=H({batchToSpaceND_:VZ});function jZ(t){let e;return t.rank===0||t.rank===1?e=G(t,[1,1,1,t.size]):t.rank===2?e=G(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(t,e,n,s,i,r){r==null&&(r=.001);const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;s!=null&&(h=F(s,"offset","batchNorm")),R(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:jZ(o),scale:c,offset:h,mean:a,variance:l},m={varianceEpsilon:r},g=W.runKernel(dv,f,m);return G(g,o.shape)}const Yv=H({batchNorm_:GZ});function HZ(t,e,n,s,i,r){const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;return s!=null&&(h=F(s,"offset","batchNorm")),R(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),R(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),R(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&R(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&R(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Yv(o,a,l,h,c,r)}const qZ=H({batchNorm2d_:HZ});function KZ(t,e,n,s,i,r){const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;return s!=null&&(h=F(s,"offset","batchNorm")),R(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),R(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),R(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&R(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&R(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Yv(o,a,l,h,c,r)}const XZ=H({batchNorm3d_:KZ});function ZZ(t,e,n,s,i,r){const o=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let c;i!=null&&(c=F(i,"scale","batchNorm"));let h;return s!=null&&(h=F(s,"offset","batchNorm")),R(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),R(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),R(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&R(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&R(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Yv(o,a,l,h,c,r)}const YZ=H({batchNorm4d_:ZZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(t,e,n){const s=F(t,"x","bincount"),i=F(e,"weights","bincount");R(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),R(n>=0,()=>`size must be non-negative, but got ${n}.`),R(i.size===s.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${i.shape}.`);const r={x:s,weights:i},o={size:n};return W.runKernel(sC,r,o)}const JZ=H({bincount_:QZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(t,e){let n=F(t,"broadcastTo","x");const s=n.shape;if(po(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=G(n,c)}const i=n.shape,r=Array.from(e);for(let c=e.length-1;c>=0;c--)if(i[c]===e[c])r[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(r.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return rl(n);const a={x:n},l={reps:r};return W.runKernel(Jf,a,l)}const Yh=H({broadcastTo_:e7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t7(t){const n={x:F(t,"x","ceil","float32")};return W.runKernel(pf,n)}const n7=H({ceil_:t7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qv(t,e,n){po(t),n=n||Nu(e);const s={shape:t,value:e,dtype:n};return W.runKernel(vC,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(t,e,n){const s=F(t,"x","clipByValue");if(R(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Qv(s.shape,e,s.dtype);const i={x:s},r={clipValueMin:e,clipValueMax:n};return W.runKernel(mf,i,r)}const qs=H({clipByValue_:s7});function i7(t){return ds(t,0)}const r7=H({concat1d_:i7});function o7(t,e){return ds(t,e)}const a7=H({concat2d_:o7});function l7(t,e){return ds(t,e)}const c7=H({concat3d_:l7});function u7(t,e){return ds(t,e)}const h7=H({concat4d_:u7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(t,e,n,s,i="NHWC",r=[1,1],o){const a=F(t,"x","conv2d","float32"),l=F(e,"filter","conv2d","float32");let c=a,h=!1;a.rank===3&&(h=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),vs("conv2d",s,o);const d=i==="NHWC"?c.shape[3]:c.shape[1];R(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),R(Gn(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),R(Il(r),()=>"Error in conv2D: Dilated rates should be larger than 0."),R(Il(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},m={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},g=W.runKernel(iv,f,m);return h?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const kl=H({conv2d_:d7});function f7(t,e,n,s,i="NWC",r=1,o){const a=F(t,"x","conv1d"),l=F(e,"filter","conv1d");let c=a,h=!1;a.rank===2&&(h=!0,c=G(a,[1,a.shape[0],a.shape[1]])),R(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),R(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),vs("conv1d",s,o),R(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),R(Gn(n,r),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${r}'`),R(Il(r),()=>"Error in conv1D: Dilated rates should be larger than 0."),R(Il(n),()=>"Error in conv1D: Stride should be larger than 0."),R(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const d=G(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=G(c,[c.shape[0],1,c.shape[1],c.shape[2]]),_=kl(f,d,[1,n],s,"NHWC",[1,r],o);return h?G(_,[_.shape[2],_.shape[3]]):G(_,[_.shape[0],_.shape[2],_.shape[3]])}const nL=H({conv1d_:f7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(t,e,n,s,i,r="NHWC",o){R(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),R(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),R(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),R(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const h=r==="NHWC"?a[3]:a[1],d=r==="NHWC"?l.shape[3]:l.shape[1];R(h===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[2]}.`),R(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),vs("conv2dDerInput",i,o);const f={dy:l,filter:n},m={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,inputShape:a},g=W.runKernel(rv,f,m);return c?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const HC=H({conv2DBackpropInput_:p7});function m7(t,e,n,s,i,r){const o=F(t,"x","conv2dTranspose"),a=F(e,"filter","conv2dTranspose");return HC(n,o,a,s,i,"NHWC",r)}const sL=H({conv2dTranspose_:m7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(t,e,n,s,i="NDHWC",r=[1,1,1]){const o=F(t,"x","conv3d"),a=F(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),R(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),R(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),R(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),R(Gn(n,r),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),R(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),R(Il(r),()=>"Error in conv3D: Dilated rates should be larger than 0."),R(Il(n),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},d={strides:n,pad:s,dataFormat:i,dilations:r},f=W.runKernel(ov,h,d);return c?G(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const y7=H({conv3d_:g7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v7(t,e,n,s,i){R(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let r=t,o=e,a=!1;e.rank===4&&(a=!0,o=G(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),r=[1,t[0],t[1],t[2],t[3]]);const l=r[4],c=o.shape[4];R(r.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${r.length}.`),R(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),R(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),R(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),R(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const h={dy:o,filter:n},d={pad:i,strides:s,inputShape:r},f=W.runKernel(lC,h,d);return a?G(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const iL=H({conv3DBackpropInput_:v7});function x7(t,e,n,s,i){const r=F(t,"x","conv3dTranspose"),o=F(e,"filter","conv3dTranspose");return iL(n,r,o,s,i)}const _7=H({conv3dTranspose_:x7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(t){const n={x:F(t,"x","cos","float32")};return W.runKernel(gf,n)}const qC=H({cos_:w7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(t){const n={x:F(t,"x","cosh","float32")};return W.runKernel(yf,n)}const rL=H({cosh_:b7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7(t,e=0,n=!1,s=!1){const r={x:F(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return W.runKernel(cC,r,o)}const Kw=H({cumprod_:C7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(t,e=0,n=!1,s=!1){const r={x:F(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return W.runKernel(av,r,o)}const oL=H({cumsum_:I7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(t,e,n,s=!1){const i=F(t,"x","denseBincount"),r=F(e,"weights","denseBincount");R(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),R(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),R(n>=0,()=>`size must be non-negative, but got ${n}.`),R(r.size===i.size||r.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${r.shape}.`);const o={x:i,weights:r},a={size:n,binaryOutput:s};return W.runKernel(hC,o,a)}const qN=H({denseBincount_:k7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(t,e,n="NHWC"){const s=F(t,"x","depthToSpace","float32"),i=n==="NHWC"?s.shape[1]:s.shape[2],r=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];R(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),R(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e}  for depthToSpace with input shape
    ${s.shape}`),R(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e} for depthToSpace with input shape
        ${s.shape}`),R(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return W.runKernel(dC,a,l)}const T7=H({depthToSpace_:S7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(t,e,n,s,i="NHWC",r=[1,1],o){const a=F(t,"x","depthwiseConv2d","float32"),l=F(e,"filter","depthwiseConv2d","float32");let c=a,h=!1;a.rank===3&&(h=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=i==="NHWC"?c.shape[3]:c.shape[1];R(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),vs("depthwiseConv2d",s,o);const f={x:c,filter:l},m={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},g=W.runKernel(lv,f,m);return h?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const KC=H({depthwiseConv2d_:E7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7(t,e,n,s,i=[1,1],r="NHWC"){const o=F(t,"x","dilation2d"),a=F(e,"filter","dilation2d");R(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),R(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),R(r==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${r}`);let l=o,c=!1;o.rank===3&&(l=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),R(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},d={strides:n,pad:s,dilations:i},f=W.runKernel(cv,h,d);return c?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const $7=H({dilation2d_:N7});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uu(t,e){const n=t.length,s=[];for(let i=0;i<n;i++){const r=n-1-i,o=t[r]||1;(e[e.length-1-i]||1)>1&&o===1&&s.unshift(r)}return s}function pn(t,e){const n=[];for(let s=0;s<e.length;s++){const i=t[t.length-s-1],r=e.length-s-1,o=e[r];(i==null||i===1&&o>1)&&n.unshift(r)}return n}function ze(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let i=0;i<n;i++){let r=t[t.length-i-1];r==null&&(r=1);let o=e[e.length-i-1];if(o==null&&(o=1),r===1)s[n-i-1]=o;else if(o===1)s[n-i-1]=r;else if(r!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-i-1]=r}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(t,e){let n=F(t,"a","equal","string_or_numeric"),s=F(e,"b","equal","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(uv,i)}const Er=H({equal_:R7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7(t,e,n){const s=F(e,"a","where"),i=F(n,"b","where"),r=F(t,"condition","where","bool"),o=ze(ze(r.shape,s.shape),i.shape),a=Yh(r,o),l=Yh(s,o),c=Yh(i,o),h={condition:a,t:l,e:c};return W.runKernel(Bv,h)}const ns=H({where_:A7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(t){const n={x:F(t,"x","zerosLike")};return W.runKernel(Kv,n)}const et=H({zerosLike_:D7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(t,e){let n=F(t,"a","div"),s=F(e,"b","div");[n,s]=Xt(n,s);const i=Re(n,s),r=et(i),o=Er(s,r);return ns(o,r,i)}const O7=H({divNoNan_:P7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(t,e){const n=F(t,"t1","dot"),s=F(e,"t2","dot");R((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const i=n.rank===1?n.size:n.shape[1],r=s.rank===1?s.size:s.shape[0];if(R(i===r,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${r}.`),n.rank===1&&s.rank===1){const o=G(n,[1,-1]),a=G(s,[-1,1]),l=lt(o,a);return G(l,[])}else if(n.rank===1&&s.rank===2){const o=G(n,[1,-1]),a=G(s,[s.shape[0],s.shape[1]]),l=lt(o,a);return G(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=G(s,[-1,1]),a=lt(n,o);return G(a,[a.size])}else{const o=G(s,[s.shape[0],s.shape[1]]);return lt(n,o)}}const F7=H({dot_:L7});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(t,...e){const n=e.map((i,r)=>F(i,`tensors${r}`,"einsum")),s={equation:t};return W.runKernel(mC,n,s)}const _h=H({einsum_:M7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(t){const n={x:F(t,"x","elu","float32")};return W.runKernel(xf,n)}const Jv=H({elu_:z7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7(t){let e=F(t,"x","erf");R(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=_e(e,"float32"));const n={x:e};return W.runKernel(_f,n)}const aL=H({erf_:B7});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XC(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function lL(t,e,n){const s=t.length+e.length,i=[];let r=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?i.push(t[r++]):i.push(e[o++]);return i}function In(t,e){const n=[],s=t.length;for(let r=0;r<s;r++)e.indexOf(r)===-1&&n.push(t[r]);const i=e.map(r=>t[r]);return[n,i]}function sn(t,e){const n=e.map(s=>1);return lL(t,n,e)}function On(t,e,n){R(XC(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Bt(t,e){if(XC(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function _a(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Zt(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(t,e=null,n=!1){const i={x:F(t,"x","max")},r={reductionIndices:e,keepDims:n};return W.runKernel(bv,i,r)}const Hi=H({max_:U7});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(t,e=null,n=!1){const i={x:F(t,"x","min")},r={axis:e,keepDims:n};return W.runKernel(Sv,i,r)}const zg=H({min_:W7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(t,e){let n=F(t,"base","pow"),s=F(e,"exp","pow");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Lf,i)}const Sl=H({pow_:V7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rt(t,e){if((_i(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&_i(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return np(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(t){const n={x:F(t,"x","sqrt","float32")};return W.runKernel(Kf,n)}const jn=H({sqrt_:j7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G7(t){const e=F(t,"x","square"),n={};return W.runKernel("Square",{x:e},n)}const Et=H({square_:G7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H7(t,e=null,n=!1){let s=F(t,"x","sum");s.dtype==="bool"&&(s=_e(s,"int32"));const i={x:s},r={axis:e,keepDims:n};return W.runKernel(Wv,i,r)}const $e=H({sum_:H7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(t,e="euclidean",n=null,s=!1){t=F(t,"x","norm");const i=cL(t,e,n);let r=i.shape;if(s){const o=Ge(n,t.shape);r=sn(i.shape,o)}return G(i,r)}function cL(t,e,n=null){if(t.rank===0)return Yn(t);if(t.rank!==1&&n===null)return cL(G(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return $e(Yn(t),n);if(e===1/0)return Hi(Yn(t),n);if(e===-1/0)return zg(Yn(t),n);if(e==="euclidean"||e===2)return jn($e(Sl(Yn(t),rt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Hi($e(Yn(t),n[0]),n[1]-1);if(e===1/0)return Hi($e(Yn(t),n[1]),n[0]);if(e===-1/0)return zg($e(Yn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return jn($e(Et(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ex=H({norm_:q7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K7(t,e=null,n=!1){return ex(t,"euclidean",e,n)}const X7=H({euclideanNorm_:K7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(t){const n={x:F(t,"x","exp")};return W.runKernel(wf,n)}const Nr=H({exp_:Z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(t,e=0){const n=F(t,"x","expandDims","string_or_numeric");R(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},i={dim:e};return W.runKernel(hv,s,i)}const cs=H({expandDims_:Y7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(t){const n={x:F(t,"x","expm1")};return W.runKernel(bf,n)}const J7=H({expm1_:Q7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(t,e){const n=F(t,"x","tile","string_or_numeric");R(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},i={reps:e};return W.runKernel(Jf,s,i)}const Bi=H({tile_:e9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9(t,e,n,s="float32"){e==null&&(e=t);const i=je([t,e],s),r=t<=e?t:e;for(let a=0;a<r;++a)i.set(1,a,a);const o=G(i.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return Bi(cs(o,0),[n[0],1,1]);if(n.length===2)return Bi(cs(cs(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Bi(cs(cs(cs(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const uL=H({eye_:t9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n9(t){const n={x:F(t,"x","floor","float32")};return W.runKernel(Cf,n)}const tx=H({floor_:n9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9(t,e,n=0,s=0){const i=F(t,"x","gather"),r=F(e,"indices","gather","int32"),o={x:i,indices:r},a={axis:n,batchDims:s};return W.runKernel(fv,o,a)}const ZC=H({gather_:s9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(t,e){let n=F(t,"a","greater","string_or_numeric"),s=F(e,"b","greater","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(pv,i)}const Zs=H({greater_:i9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r9(t,e){let n=F(t,"a","greaterEqual","string_or_numeric"),s=F(e,"b","greaterEqual","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(kf,i)}const Hl=H({greaterEqual_:r9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o9(t){const n={input:F(t,"input","imag")};return W.runKernel(wC,n)}const YC=H({imag_:o9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a9(t){const n={x:F(t,"x","isFinite")};return W.runKernel(Tf,n)}const l9=H({isFinite_:a9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(t){const n={x:F(t,"x","isInf")};return W.runKernel(Ef,n)}const u9=H({isInf_:c9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h9(t){const n={x:F(t,"x","isNaN")};return W.runKernel(Nf,n)}const d9=H({isNaN_:h9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(t,e=.2){const s={x:F(t,"x","leakyRelu")},i={alpha:e};return W.runKernel(mv,s,i)}const QC=H({leakyRelu_:f9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9(t,e){let n=F(t,"a","less","string_or_numeric"),s=F(e,"b","less","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(gv,i)}const Bg=H({less_:p9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(t,e){let n=F(t,"a","lessEqual","string_or_numeric"),s=F(e,"b","lessEqual","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(yv,i)}const Du=H({lessEqual_:m9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(t,e=5,n=1,s=1,i=.5){const r=F(t,"x","localResponseNormalization");R(r.rank===4||r.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${r.rank}.`),R(ou(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=r,a=!1;r.rank===3&&(a=!0,o=G(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:s,beta:i},h=W.runKernel(wv,l,c);return a?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const y9=H({localResponseNormalization_:g9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(t){const n={x:F(t,"x","log","float32")};return W.runKernel($f,n)}const $r=H({log_:v9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x9(t){const n={x:F(t,"x","log1p")};return W.runKernel(Rf,n)}const hL=H({log1p_:x9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _9(t,e){R($w(t),()=>"The f passed in variableGrads(f) must be a function"),R(e==null||Array.isArray(e)&&e.every(c=>c instanceof Fg),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in W.registeredVariables)e.push(W.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,i=e.length;e=e.filter(c=>c.trainable),R(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const r=!0,{value:o,grads:a}=W.gradients(t,e,null,r);R(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),R(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,h)=>{a[h]!=null&&(l[c.name]=a[h])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:o,grads:l}}function hu(t){return W.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(t){const n={x:F(t,"x","neg")};return W.runKernel(Ev,n)}const Kt=H({neg_:w9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9(t){const n={x:F(t,"x","softplus")};return W.runKernel(qf,n)}const ip=H({softplus_:b9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(t){const e=F(t,"x","logSigmoid");return hu(s=>({value:Kt(ip(Kt(s))),gradFunc:o=>U(o,Au(Kt(s)))}))(e)}const I9=H({logSigmoid_:C9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(t,e){let n=F(t,"a","sub"),s=F(e,"b","sub");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Zf,i)}const Ae=H({sub_:k9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(t,e=-1){const n=F(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return hu((i,r)=>{const a=Hi(i,e,!0),l=Ae(i,a),c=Ae(_e(l,"float32"),$r($e(Nr(l),e,!0)));return r([c]),{value:c,gradFunc:(d,f)=>{const[m]=f,g=!0,x=Nr(m);return Ae(d,U($e(d,e,g),x))}}})(n)}const dL=H({logSoftmax_:S9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9(t,e=null,n=!1){const s=F(t,"x","logSumExp"),i=Ge(e,s.shape),r=Hi(s,i,!0),o=Ae(s,r),a=Nr(o),l=$e(a,i),c=$r(l),h=pe(G(r,c.shape),c);if(n){const d=sn(h.shape,i);return G(h,d)}return h}const fL=H({logSumExp_:T9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(t,e){const n=F(t,"a","logicalAnd","bool"),s=F(e,"b","logicalAnd","bool");ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(vv,i)}const oo=H({logicalAnd_:E9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(t){const n={x:F(t,"x","logicalNot","bool")};return W.runKernel(xv,n)}const JC=H({logicalNot_:N9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(t,e){const n=F(t,"a","logicalOr","bool"),s=F(e,"b","logicalOr","bool");ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(_v,i)}const pL=H({logicalOr_:$9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(t,e){const n=F(t,"a","logicalXor","bool"),s=F(e,"b","logicalXor","bool");return ze(n.shape,s.shape),oo(pL(t,e),JC(oo(t,e)))}const A9=H({logicalXor_:R9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(t,e,n,s,i){const r=F(t,"x","maxPool"),o=1;let a=r,l=!1;r.rank===3&&(l=!0,a=G(r,[1,r.shape[0],r.shape[1],r.shape[2]])),R(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),R(Gn(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),vs("maxPool",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i},d=W.runKernel(Cv,c,h);return l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const eI=H({maxPool_:D9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(t,e=[1,1,1],n,s,i,r="NDHWC"){const o=F(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),R(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),R(r==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),vs("maxPool3d",s,i);const c={x:a},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:r},d=W.runKernel(Iv,c,h);return l?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const O9=H({maxPool3d_:P9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L9(t,e){let n=F(t,"a","maximum"),s=F(e,"b","maximum");[n,s]=Xt(n,s),n.dtype==="bool"&&(n=_e(n,"int32"),s=_e(s,"int32")),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(Af,i)}const wa=H({maximum_:L9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F9(t,e=null,n=!1){const i={x:F(t,"x","mean")},r={axis:e,keepDims:n};return W.runKernel(kv,i,r)}const nn=H({mean_:F9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _n(t,e="float32"){if(po(t),e==="complex64"){const s=_n(t,"float32"),i=_n(t,"float32");return _l(s,i)}const n=Vn(re(t),e);return W.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ba(t,e="float32"){if(po(t),e==="complex64"){const s=ba(t,"float32"),i=_n(t,"float32");return _l(s,i)}const n=X1(re(t),e);return W.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M9(t,e){let n=F(t,"a","minimum"),s=F(e,"b","minimum");[n,s]=Xt(n,s),n.dtype==="bool"&&(n=_e(n,"int32"),s=_e(s,"int32")),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(Df,i)}const Ad=H({minimum_:M9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(t,e,n){R(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=F(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");R(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)R(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),R(e[a][0]>=0&&e[a][0]<=s.shape[a]-i&&e[a][1]>=0&&e[a][1]<=s.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-i} or less than 0 for input of shape ${s.shape}`);const r={paddings:e,mode:n},o={x:s};return W.runKernel(Tv,o,r)}const B9=H({mirrorPad_:z9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(t,e){let n=F(t,"a","mod"),s=F(e,"b","mod");[n,s]=Xt(n,s);const i={a:n,b:s};return W.runKernel(Pf,i)}const W9=H({mod_:U9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(t,e=null,n=!1){t=F(t,"x","moments");const s=Ge(e,t.shape),i=nn(t,s,n);let r=i.shape;n||(r=sn(i.shape,s));const o=Et(Ae(_e(t,"float32"),G(i,r))),a=nn(o,s,n);return{mean:i,variance:a}}const tI=H({moments_:V9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j9(t,e){let n=F(t,"a","notEqual","string_or_numeric"),s=F(e,"b","notEqual","string_or_numeric");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s};return W.runKernel(Nv,i)}const Ug=H({notEqual_:j9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(t,e,n=1,s=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:F(t,"indices","oneHot","int32")},a={dtype:i,depth:e,onValue:n,offValue:s};return W.runKernel(Rv,o,a)}const mL=H({oneHot_:G9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H9(t){const n={x:F(t,"x","onesLike")};return W.runKernel($v,n)}const wi=H({onesLike_:H9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9(t,e,n=0){const s=F(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},r={x:s};return W.runKernel(Dv,r,i)}const nI=H({pad_:q9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(t,e,n){const s=F(t,"x","spaceToBatchND");R(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),R(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),R(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const i={x:s},r={blockShape:e,paddings:n};return W.runKernel(Vv,i,r)}const sI=H({spaceToBatchND_:K9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(t,e,n,s,i,r,o){i==null&&(i=[1,1]),r==null&&(r=1),s===0&&(s="valid");const a=F(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(Gn(r,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`);const h=bi(l.shape,e,r,i,s),d=[h.dilationHeight,h.dilationWidth];let f;s==="same"?f=Y9([h.filterHeight,h.filterWidth],d):f=[[0,0],[0,0]];const m=d[0]===1&&d[1]===1,[g,x]=Z9([h.inHeight,h.inWidth],d,f),_=m?s:"valid",v=m?l:sI(l,d,g),b=(n==="avg"?()=>jC(v,e,r,_,o):()=>eI(v,e,r,_,o))(),I=m?b:GC(b,d,x);return c?G(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function Z9(t,e,n){const s=n.map(h=>h[0]),i=n.map(h=>h[1]),r=t.concat(s,i),o=e.map((h,d)=>(h-r[d]%h)%h),a=i.map((h,d)=>h+o[d]),l=e.map((h,d)=>[s[d],a[d]]),c=e.map((h,d)=>[0,o[d]]);return[l,c]}function Y9(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),i=s.map(o=>Math.floor(o/2)),r=s.map((o,a)=>o-i[a]);return s.map((o,a)=>[i[a],r[a]])}const Q9=H({pool_:X9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9(t,e){const n=F(t,"x","prelu"),s=F(e,"alpha","prelu"),i={x:n,alpha:s};return W.runKernel(Pv,i)}const iI=H({prelu_:J9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(t,e=null,n=!1){let s=F(t,"x","prod");s.dtype==="bool"&&(s=_e(s,"int32"));const i={x:s},r={axis:e,keepDims:n};return W.runKernel(Ov,i,r)}const tY=H({prod_:eY});var rI={exports:{}};rI.exports;(function(t){(function(e,n,s){function i(l){var c=this,h=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(l),c.s0<0&&(c.s0+=1),c.s1-=h(l),c.s1<0&&(c.s1+=1),c.s2-=h(l),c.s2<0&&(c.s2+=1),h=null}function r(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var h=new i(l),d=c&&c.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&r(d,h),f.state=function(){return r(h,{})}),f}function a(){var l=4022871197,c=function(h){h=String(h);for(var d=0;d<h.length;d++){l+=h.charCodeAt(d);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:this.alea=o})(ua,t)})(rI);var nY=rI.exports,oI={exports:{}};oI.exports;(function(t){(function(e,n,s){function i(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(typeof h=="object"&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xor128=o})(ua,t)})(oI);var sY=oI.exports,aI={exports:{}};aI.exports;(function(t){(function(e,n,s){function i(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,h==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(typeof h=="object"&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xorwow=o})(ua,t)})(aI);var iY=aI.exports,lI={exports:{}};lI.exports;(function(t){(function(e,n,s){function i(a){var l=this;l.next=function(){var h=l.x,d=l.i,f,m;return f=h[d],f^=f>>>7,m=f^f<<24,f=h[d+1&7],m^=f^f>>>10,f=h[d+3&7],m^=f^f>>>3,f=h[d+4&7],m^=f^f<<7,f=h[d+7&7],f=f^f<<13,m^=f^f<<9,h[d]=m,l.i=d+1&7,m};function c(h,d){var f,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,f=0;f<d.length;++f)m[f&7]=m[f&7]<<15^d.charCodeAt(f)+m[f+1&7]<<13;for(;m.length<8;)m.push(0);for(f=0;f<8&&m[f]===0;++f);for(f==8?m[7]=-1:m[f],h.x=m,h.i=0,f=256;f>0;--f)h.next()}c(l,a)}function r(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(h.x&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xorshift7=o})(ua,t)})(lI);var rY=lI.exports,cI={exports:{}};cI.exports;(function(t){(function(e,n,s){function i(a){var l=this;l.next=function(){var h=l.w,d=l.X,f=l.i,m,g;return l.w=h=h+1640531527|0,g=d[f+34&127],m=d[f=f+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,g=d[f]=g^m,l.i=f,g+(h^h>>>16)|0};function c(h,d){var f,m,g,x,_,v=[],w=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,w=Math.max(w,d.length)),g=0,x=-32;x<w;++x)d&&(m^=d.charCodeAt((x+32)%d.length)),x===0&&(_=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,x>=0&&(_=_+1640531527|0,f=v[x&127]^=m+_,g=f==0?g+1:0);for(g>=128&&(v[(d&&d.length||0)&127]=-1),g=127,x=4*128;x>0;--x)m=v[g+34&127],f=v[g=g+1&127],m^=m<<13,f^=f<<17,m^=m>>>15,f^=f>>>12,v[g]=m^f;h.w=_,h.X=v,h.i=g}c(l,a)}function r(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(h.X&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.xor4096=o})(ua,t)})(cI);var oY=cI.exports,uI={exports:{}};uI.exports;(function(t){(function(e,n,s){function i(a){var l=this,c="";l.next=function(){var d=l.b,f=l.c,m=l.d,g=l.a;return d=d<<25^d>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-m|0,l.d=m<<16^f>>>16^g,l.a=g-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var h=0;h<c.length+20;h++)l.b^=c.charCodeAt(h)|0,l.next()}function r(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new i(a),h=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,m=(c.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,h&&(typeof h=="object"&&r(h,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=o:this.tychei=o})(ua,t)})(uI);var aY=uI.exports,gL={exports:{}};const lY={},cY=Object.freeze(Object.defineProperty({__proto__:null,default:lY},Symbol.toStringTag,{value:"Module"})),uY=_W(cY);(function(t){(function(e,n,s){var i=256,r=6,o=52,a="random",l=s.pow(i,r),c=s.pow(2,o),h=c*2,d=i-1,f;function m(I,S,T){var $=[];S=S==!0?{entropy:!0}:S||{};var E=v(_(S.entropy?[I,b(n)]:I??w(),3),$),D=new g($),P=function(){for(var z=D.g(r),V=l,q=0;z<c;)z=(z+q)*i,V*=i,q=D.g(1);for(;z>=h;)z/=2,V/=2,q>>>=1;return(z+q)/V};return P.int32=function(){return D.g(4)|0},P.quick=function(){return D.g(4)/4294967296},P.double=P,v(b(D.S),n),(S.pass||T||function(z,V,q,K){return K&&(K.S&&x(K,D),z.state=function(){return x(D,{})}),q?(s[a]=z,V):z})(P,E,"global"in S?S.global:this==s,S.state)}function g(I){var S,T=I.length,$=this,E=0,D=$.i=$.j=0,P=$.S=[];for(T||(I=[T++]);E<i;)P[E]=E++;for(E=0;E<i;E++)P[E]=P[D=d&D+I[E%T]+(S=P[E])],P[D]=S;($.g=function(z){for(var V,q=0,K=$.i,J=$.j,X=$.S;z--;)V=X[K=d&K+1],q=q*i+X[d&(X[K]=X[J=d&J+V])+(X[J]=V)];return $.i=K,$.j=J,q})(i)}function x(I,S){return S.i=I.i,S.j=I.j,S.S=I.S.slice(),S}function _(I,S){var T=[],$=typeof I,E;if(S&&$=="object")for(E in I)try{T.push(_(I[E],S-1))}catch{}return T.length?T:$=="string"?I:I+"\0"}function v(I,S){for(var T=I+"",$,E=0;E<T.length;)S[d&E]=d&($^=S[d&E]*19)+T.charCodeAt(E++);return b(S)}function w(){try{var I;return f&&(I=f.randomBytes)?I=I(i):(I=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var S=e.navigator,T=S&&S.plugins;return[+new Date,e,T,e.screen,b(n)]}}function b(I){return String.fromCharCode.apply(0,I)}if(v(s.random(),n),t.exports){t.exports=m;try{f=uY}catch{}}else s["seed"+a]=m})(typeof self<"u"?self:ua,[],Math)})(gL);var hY=gL.exports,dY=nY,fY=sY,pY=iY,mY=rY,gY=oY,yY=aY,ql=hY;ql.alea=dY;ql.xor128=fY;ql.xorwow=pY;ql.xorshift7=mY;ql.xor4096=gY;ql.tychei=yY;var hI=ql;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yL{constructor(e,n,s,i,r){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=r||Math.random();this.random=hI.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let e,n,s=!1;for(;!s;){let i,r,o;do i=2*this.random()-1,r=2*this.random()-1,o=i*i+r*r;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*r*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class vY{constructor(e=0,n=1,s,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=hI.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(t,e=0,n=1,s,i){if(po(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const r=new yL(e,n,s,!1,i),o=je(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const _Y=H({randomNormal_:xY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(t,e=0,n=1,s="float32",i){po(t);const r=je(t,s),o=new vY(e,n,null,i);for(let a=0;a<r.values.length;a++)r.values[a]=o.nextValue();return r.toTensor()}const rp=H({randomUniform_:wY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dd(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:s};return W.runKernel(EC,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(t){const n={input:F(t,"input","real")};return W.runKernel(NC,n)}const Wg=H({real_:bY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(t){const n={x:F(t,"x","reciprocal")};return W.runKernel(Ff,n)}const IY=H({reciprocal_:CY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(t){const n={x:F(t,"x","relu")};return W.runKernel(Mf,n)}const Kl=H({relu_:kY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(t){const n={x:F(t,"x","relu6")};return W.runKernel(zf,n)}const vL=H({relu6_:SY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(t,e){const s={x:F(t,"x","reverse")},i={dims:e};return W.runKernel(zv,s,i)}const Tl=H({reverse_:TY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(t){const n={x:F(t,"x","round")};return W.runKernel(Bf,n)}const xL=H({round_:EY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(t){const n={x:F(t,"x","rsqrt","float32")};return W.runKernel(Uf,n)}const _L=H({rsqrt_:NY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(t){const n={x:F(t,"x","selu")};return W.runKernel(Wf,n)}const wL=H({selu_:$Y});function RY(t,e,n,s,i,r=[1,1],o="NHWC"){const a=F(t,"x","separableConv2d"),l=F(e,"depthwiseFilter","separableConv2d"),c=F(n,"pointwiseFilter","separableConv2d");let h=a,d=!1;if(a.rank===3&&(d=!0,h=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");R(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),R(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),R(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),R(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],m=l.shape[3];R(c.shape[2]===f*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*m}, but got ${c.shape[2]}.`);const g=KC(h,l,s,i,o,r),_=kl(g,c,1,"valid",o);return d?G(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const bL=H({separableConv2d_:RY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(t){const n={x:F(t,"x","sign")};return W.runKernel(Gf,n)}const DY=H({sign_:AY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(t){const n={x:F(t,"x","sin","float32")};return W.runKernel(Vf,n)}const CL=H({sin_:PY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(t){const n={x:F(t,"x","sinh")};return W.runKernel(jf,n)}const IL=H({sinh_:OY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(t,e,n){const s=F(t,"x","slice1d");return R(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ct(s,[e],[n])}const dI=H({slice1d_:LY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(t,e,n){const s=F(t,"x","slice2d");return R(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ct(s,e,n)}const kL=H({slice2d_:FY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MY(t,e,n){const s=F(t,"x","slice3d");return R(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ct(s,e,n)}const fI=H({slice3d_:MY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zY(t,e,n){const s=F(t,"x","slice4d");return R(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ct(s,e,n)}const Vg=H({slice4d_:zY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BY(t,e=-1){const n=F(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},i={dim:e};return W.runKernel(Gv,s,i)}const pI=H({softmax_:BY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(t){R(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(yC,e)}const SL=H({fft_:UY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WY(t){R(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(_C,e)}const Xw=H({ifft_:WY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VY(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const i=G(t,[n,e]);s=Xw(i)}else{const i=[n,2*(e-1)],r=G(Wg(t),[n,e]),o=G(YC(t),[n,e]),a=Tl(Ct(r,[0,1],[n,e-2]),1),l=U(Tl(Ct(o,[0,1],[n,e-2]),1),rt(-1)),c=ds([r,a],1),h=ds([o,l],1),d=G(_l(c,h),[i[0],i[1]]);s=Xw(d)}if(s=Wg(s),t.rank===3&&t.shape[0]!==0){const i=s,r=t.shape[0];s=G(s,[r,s.shape[0]/r,s.shape[1]]),i.dispose()}return s}const jY=H({irfft_:VY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GY(t,e,n=0){const i={x:F(t,"x","split")},r={numOrSizeSplits:e,axis:n};return W.runKernel(jv,i,r)}const Gs=H({split_:GY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HY(t,e){R(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let i;if(e!=null&&e<n){const g=t.shape.map(_=>0),x=t.shape.map(_=>_);x[t.shape.length-1]=e,i=Ct(t,g,x),n=e}else if(e!=null&&e>n){const g=t.shape.map(x=>x);g[t.shape.length-1]=e-n,i=ds([t,_n(g)],t.shape.length-1),n=e}else i=t;const r=et(i),o=G(_l(i,r),[s,n]),a=SL(o),l=Math.floor(n/2)+1,c=Wg(a),h=YC(a),d=Gs(c,[l,n-l],c.shape.length-1),f=Gs(h,[l,n-l],h.shape.length-1),m=i.shape.slice();return m[i.shape.length-1]=l,G(_l(d[0],f[0]),m)}const qY=H({rfft_:HY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(t,e){let n=F(t,"a","squaredDifference"),s=F(e,"b","squaredDifference");[n,s]=Xt(n,s),ze(n.shape,s.shape);const i={a:n,b:s},r={};return W.runKernel(Xf,i,r)}const XY=H({squaredDifference_:KY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(t,e){const n=F(t,"x","squeeze","string_or_numeric");return G(n,ga(n.shape,e).newShape)}const op=H({squeeze_:ZY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YY(t,e=0){const n=HO(t,"tensors","stack","string_or_numeric");R(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&R(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,i={axis:e};return W.runKernel(Av,s,i)}const ao=H({stack_:YY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(t,e=0){const s={x:F(t,"x","step")},i={alpha:e};return W.runKernel(ep,s,i)}const ap=H({step_:QY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(t,e,n,s,i=0,r=0,o=0,a=0,l=0){const h={x:F(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return W.runKernel(PC,h,d)}const eQ=H({stridedSlice_:JY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(t){const n={x:F(t,"x","tan","float32")};return W.runKernel(Yf,n)}const nQ=H({tan_:tQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(t,e){K1(t);const n=tp(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return np(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_(t,e,n){if(K1(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=tp(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return np(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(t,e,n){if(K1(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=tp(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return np(t,e,s,n)}function TL(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,r=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(r+` update.rank < ${i}. `);if(t.length<s+(n.rank-i))throw new Error(r+` Output shape length < ${s+(n.rank-i)}`);if(n.rank!==i+t.length-s)throw new Error(r+` update.rank != ${i+t.length-s}`);for(let o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(r+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+s])throw new Error(r+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${t[o+i]})`)}function iQ(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}TL(n,e,t)}function Xl(t,e,n){const s=e.shape.length,i=s>1?e.shape[s-1]:1,r=n.length;let o=1;for(let d=i;d<r;++d)o*=n[d];const a=i<1?1:i,l=re(e.shape)/a,c=[...Te(n.slice(0,i)),1],h=re(n);return{sliceRank:i,numUpdates:l,sliceSize:o,strides:c,outputSize:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(t,e=1,n=!0){const s=F(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const r={x:s},o={k:e,sorted:n},[a,l]=W.runKernel(OC,r,o);return{values:a,indices:l}}const oQ=H({topk_:rQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(t,e=0,n=1,s,i){if(po(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const r=new yL(e,n,s,!0,i),o=je(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const EL=H({truncatedNormal_:aQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(t,e=0){const n=F(t,"x","unique","string_or_numeric");R(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},i={axis:e},[r,o]=W.runKernel(FC,s,i);return{values:r,indices:o}}const cQ=H({unique_:lQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(t,e,n){const s=F(t,"x","unsortedSegmentSum"),i=F(e,"segmentIds","unsortedSegmentSum","int32");R(ou(n),()=>"numSegments must be of dtype int");const r={x:s,segmentIds:i},o={numSegments:n};return W.runKernel(qv,r,o)}const NL=H({unsortedSegmentSum_:uQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(t,e=0){const n=F(t,"x","unstack","string_or_numeric");R(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},i={axis:e};return W.runKernel(Hv,s,i)}const El=H({unstack_:hQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(t,e=!0,n,s){return W.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $L(t,e){const n=[];for(let r=0;r<e.length;r++)e[r]&&n.push(r);const s=je(t,"int32"),i=je([n.length,t.length],"int32");for(let r=0;r<n.length;r++){const o=s.indexToLoc(n[r]),a=r*t.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(t,e,n){const s=F(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),R(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{R(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const i={x:s},r={perm:e};return s.dtype==="complex64"?Q(()=>{let o=Wg(s),a=YC(s);return o=W.runKernel(Hc,{x:o},r),a=W.runKernel(Hc,{x:a},r),n&&(a=Kt(a)),_l(o,a)}):W.runKernel(Hc,i,r)}const Je=H({transpose_:fQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(t,e){if(e==null)return t.shape.slice();if(ct(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(t,e,n,s){const i=F(t,"x","dropout");if(R(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),R(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof an?i.clone():i;const r=pQ(i,n),o=1-e,a=Re(tx(pe(rp(r,0,1,"float32",s),o)),o);return U(i,a)}const gQ=H({dropout_:mQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(t,e,n,s,i,r="NHWC",o){let a=t;t.rank===3&&(a=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]])),R(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),R(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),R(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=r==="NHWC"?a.shape[3]:a.shape[1],h=r==="NHWC"?l.shape[3]:l.shape[1];R(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),R(h===n[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${n[3]}).`),vs("conv2dDerFilter",i,o);const d={x:a,dy:l},f={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,filterShape:n};return W.runKernel(oC,d,f)}const mI=H({conv2DBackpropFilter_:yQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gI(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return U(t,ap(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function yI(t,e){let n=e;const s=pn(t.shape,e.shape);return s.length>0&&(n=$e(n,s)),G(n,t.shape)}function vI(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Kl(t);if(e==="elu")return Jv(t);if(e==="relu6")return vL(t);if(e==="prelu")return iI(t,n);if(e==="leakyrelu")return QC(t,s);if(e==="sigmoid")return Au(t);throw new Error(`Unknown fused activation ${e}.`)}const xI=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vQ({x:t,filter:e,strides:n,pad:s,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(l=l||"linear",xI(W.state.gradientDepth,l)===!1){R(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let T=kl(t,e,n,s,i,r,o);return a!=null&&(T=pe(T,a)),vI(T,l,c,h)}const d=F(t,"x","conv2d","float32"),f=F(e,"filter","conv2d","float32");let m=d,g=!1;d.rank===3&&(g=!0,m=G(d,[1,d.shape[0],d.shape[1],d.shape[2]])),R(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),R(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),vs("fused conv2d",s,o);const x=i==="NHWC"?m.shape[3]:m.shape[1];R(f.shape[2]===x,()=>`Error in conv2d: depth of input (${x}) must match input depth for filter ${f.shape[2]}.`),R(Gn(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`);const _=Pn(m.shape,f.shape,n,r,s,o);let v;a!=null&&(v=F(a,"bias","fused conv2d"),[v]=Xt(v,d),i==="NHWC"?ze(_.outShape,v.shape):(R(v.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${v.shape.length}.`),R(v.shape.length===0||v.shape[0]===_.outChannels||v.shape[0]===1,()=>`Error in fused conv2d: bias shape (${v.shape}) is not compatible with the number of output channels (${_.outChannels})`)));let w;if(c!=null){const T=c.shape;if(R(T.length<=1||T.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${T.length}.`),T.length===1)R(T[0]===1||T[0]===_.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the number of output channels (${_.outChannels}).`);else if(T.length===3)try{ze(T,_.outShape)}catch{const E=`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the output shape of the conv2d (${_.outShape}).`;throw Error(E)}w=F(c,"prelu weights","fused conv2d")}const b=(T,$)=>{R(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[E,D,P,z]=$,V=gI(T,P,l);R(Cl(r),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const q=HC(D.shape,V,E,n,s),K=mI(D,V,E.shape,n,s),J=[q,K];if(z!=null){const X=yI(z,V);J.push(X)}return J},I={x:m,filter:f,bias:v,preluActivationWeights:w},S={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?hu(($,E,D)=>{let P=W.runKernel(Pg,I,S);return D([E,$,P]),g&&(P=G(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:b}})(m,f):hu(($,E,D,P)=>{let z=W.runKernel(Pg,I,S);return P([E,$,z,D]),g&&(z=G(z,[z.shape[1],z.shape[2],z.shape[3]])),{value:z,gradFunc:b}})(m,f,v)}const xQ=H({fusedConv2d_:vQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(t,e,n,s,i,r=[1,1],o){let a=t;t.rank===3&&(a=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},h={strides:s,pad:i,dimRoundingMode:o,dilations:r,filterShape:n};return W.runKernel(fC,c,h)}const wQ=H({depthwiseConv2dNativeBackpropFilter_:_Q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(t,e,n,s,i,r=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},h={strides:s,pad:i,dimRoundingMode:o,dilations:r,inputShape:t},d=W.runKernel(pC,c,h);return l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const CQ=H({depthwiseConv2dNativeBackpropInput_:bQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:i,activation:r="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(xI(W.state.gradientDepth,r)===!1){let z=lt(t,e,n,s);return i!=null&&(z=pe(z,i)),vI(z,r,o,a)}let l=F(t,"a","fused matMul"),c=F(e,"b","fused matMul");[l,c]=Xt(l,c);const h=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],m=s?c.shape[c.rank-2]:c.shape[c.rank-1],g=l.shape.slice(0,-2),x=c.shape.slice(0,-2),_=re(g),v=re(x);R(h===d,()=>`Error in fused matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const b=ze(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,m]),I=n?G(l,[_,h,f]):G(l,[_,f,h]),S=s?G(c,[v,m,d]):G(c,[v,d,m]);let T;i!=null&&(T=F(i,"bias","fused matMul"),[T]=Xt(T,l),ze(b,T.shape));let $;o!=null&&($=F(o,"prelu weights","fused matMul"));const E=(z,V)=>{const[q,K,J,X]=V,oe=gI(G(z,J.shape),J,r);let O,Z;if(!n&&!s?(O=lt(oe,K,!1,!0),Z=lt(q,oe,!0,!1)):!n&&s?(O=lt(oe,K,!1,!1),Z=lt(oe,q,!0,!1)):n&&!s?(O=lt(K,oe,!1,!0),Z=lt(q,oe,!1,!1)):(O=lt(K,oe,!0,!0),Z=lt(oe,q,!0,!0)),i!=null){const j=yI(X,oe);return[O,Z,j]}else return[O,Z]},D={a:I,b:S,bias:T,preluActivationWeights:$},P={transposeA:n,transposeB:s,activation:r,leakyreluAlpha:a};return i==null?hu((V,q,K)=>{const J=W.runKernel(Dg,D,P);return K([V,q,J]),{value:G(J,b),gradFunc:E}})(I,S):hu((V,q,K,J)=>{const X=W.runKernel(Dg,D,P);return J([V,q,X,K]),{value:G(X,b),gradFunc:E}})(I,S,T)}const KN=H({fusedMatMul_:IQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(t,e,n,s,i="bilinear",r=0){const o=F(t,"image","cropAndResize"),a=F(e,"boxes","cropAndResize","float32"),l=F(n,"boxInd","cropAndResize","int32"),c=a.shape[0];R(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),R(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),R(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),R(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),R(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),R(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const h={image:o,boxes:a,boxInd:l},d={method:i,extrapolationValue:r,cropSize:s};return W.runKernel(uC,h,d)}const SQ=H({cropAndResize_:kQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(t){const e=F(t,"image","flipLeftRight","float32");R(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return W.runKernel(xC,n,{})}const EQ=H({flipLeftRight_:TQ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(t){const e=F(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];R(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),R(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,Bi(e,i)}const $Q=H({grayscaleToRGB_:NQ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(t){const e=F(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];R(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),R(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const i=e.dtype,r=_e(e,"float32"),o=ks([.2989,.587,.114]);let a;switch(e.rank){case 2:a=_h("ij,j->i",r,o);break;case 3:a=_h("ijk,k->ij",r,o);break;case 4:a=_h("ijkl,l->ijk",r,o);break;case 5:a=_h("ijklm,m->ijkl",r,o);break;case 6:a=_h("ijklmn,n->ijklm",r,o);break;default:throw new Error("Not a valid tensor rank.")}return a=cs(a,-1),_e(a,i)}const AQ=H({rgbToGrayscale_:RQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(t,e,n=0,s=.5){const i=F(t,"image","rotateWithOffset","float32");R(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const r={image:i},o={radians:e,fillValue:n,center:s};return W.runKernel(MC,r,o)}const PQ=H({rotateWithOffset_:DQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pu(t,e,n,s,i,r){s==null&&(s=.5),i==null&&(i=Number.NEGATIVE_INFINITY),r==null&&(r=0);const o=t.shape[0];return n=Math.min(n,o),R(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),R(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),R(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),R(e.rank===1,()=>"scores must be a 1D tensor"),R(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),R(0<=r&&r<=1,()=>`softNmsSigma must be in [0, 1], but was '${r}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const r=F(t,"boxes","nonMaxSuppression","float32"),o=F(e,"scores","nonMaxSuppression","float32"),a=Pu(r,o,n,s,i);n=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:i};return W.runKernel(kC,{boxes:r,scores:o},l)}const LQ=H({nonMaxSuppression_:OQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(t,e,n){const s=MQ(t,e,n),i=s<0?-(s+1):s;t.splice(i,0,e)}function MQ(t,e,n){return BQ(t,e,n||zQ)}function zQ(t,e){return t>e?1:t<e?-1:0}function BQ(t,e,n){let s=0,i=t.length,r=0,o=!1;for(;s<i;){r=s+(i-s>>>1);const a=n(e,t[r]);a>0?s=r+1:(i=r,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _I(t,e,n,s,i){return CI(t,e,n,s,i,0)}function wI(t,e,n,s,i,r){return CI(t,e,n,s,i,0,!1,r,!0)}function bI(t,e,n,s,i,r){return CI(t,e,n,s,i,r,!0)}function CI(t,e,n,s,i,r,o=!1,a=!1,l=!1){const c=[];for(let _=0;_<e.length;_++)e[_]>i&&c.push({score:e[_],boxIndex:_,suppressBeginIndex:0});c.sort(XN);const h=r>0?-.5/r:0,d=[],f=[];for(;d.length<n&&c.length>0;){const _=c.pop(),{score:v,boxIndex:w,suppressBeginIndex:b}=_;if(v<i)break;let I=!1;for(let S=d.length-1;S>=b;--S){const T=UQ(t,w,d[S]);if(T>=s){I=!0;break}if(_.score=_.score*WQ(s,h,T),_.score<=i)break}_.suppressBeginIndex=d.length,I||(_.score===v?(d.push(w),f.push(_.score)):_.score>i&&FQ(c,_,XN))}const m=d.length,g=n-m;a&&g>0&&(d.push(...new Array(g).fill(0)),f.push(...new Array(g).fill(0)));const x={selectedIndices:d};return o&&(x.selectedScores=f),l&&(x.validOutputs=m),x}function UQ(t,e,n){const s=t.subarray(e*4,e*4+4),i=t.subarray(n*4,n*4+4),r=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(i[0],i[2]),h=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),m=(a-r)*(l-o),g=(d-c)*(f-h);if(m<=0||g<=0)return 0;const x=Math.max(r,c),_=Math.max(o,h),v=Math.min(a,d),w=Math.min(l,f),b=Math.max(v-x,0)*Math.max(w-_,0);return b/(m+g-b)}function WQ(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function XN(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function VQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const r=F(t,"boxes","nonMaxSuppressionAsync"),o=F(e,"scores","nonMaxSuppressionAsync"),a=Pu(r,o,n,s,i);n=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const l=await Promise.all([r.data(),o.data()]),c=l[0],h=l[1],{selectedIndices:d}=_I(c,h,n,s,i);return r!==t&&r.dispose(),o!==e&&o.dispose(),ks(d,"int32")}const jQ=VQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Pu(o,a,n,s,i,r);n=l.maxOutputSize,s=l.iouThreshold,i=l.scoreThreshold,r=l.softNmsSigma;const c={boxes:o,scores:a},h={maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:r},d=W.runKernel(TC,c,h);return{selectedIndices:d[0],selectedScores:d[1]}}const HQ=H({nonMaxSuppressionWithScore_:GQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Pu(o,a,n,s,i,r);n=l.maxOutputSize,s=l.iouThreshold,i=l.scoreThreshold,r=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),h=c[0],d=c[1],{selectedIndices:f,selectedScores:m}=bI(h,d,n,s,i,r);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ks(f,"int32"),selectedScores:ks(m)}}const KQ=qQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Pu(o,a,n,s,i,null),c=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,f={boxes:o,scores:a},m={maxOutputSize:c,iouThreshold:h,scoreThreshold:d,padToMaxOutputSize:r},g=W.runKernel(SC,f,m);return{selectedIndices:g[0],validOutputs:g[1]}}const ZQ=H({nonMaxSuppressionPadded_:XQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function YQ(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Pu(o,a,n,s,i,null),c=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,[f,m]=await Promise.all([o.data(),a.data()]),{selectedIndices:g,validOutputs:x}=wI(f,m,c,h,d,r);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ks(g,"int32"),validOutputs:rt(x,"int32")}}const QQ=YQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(t,e,n=!1,s=!1){const i=F(t,"images","resizeBilinear");R(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),R(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),R(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let r=i,o=!1;i.rank===3&&(o=!0,r=G(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},c=W.runKernel(Mv,a,l);return o?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const RL=H({resizeBilinear_:JQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eJ(t,e,n=!1,s=!1){const i=F(t,"images","resizeNearestNeighbor");R(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),R(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),R(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),R(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let r=i,o=!1;i.rank===3&&(o=!0,r=G(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},c=W.runKernel(Fv,a,l);return o?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const AL=H({resizeNearestNeighbor_:eJ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tJ(t,e="binary",n=!1,s=.5){const i=F(t,"image","threshold"),r=.2989,o=.587,a=.114,l=i.shape[0]*i.shape[1];let c=U(ks([s]),255),h,d,f,m;if(R(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),R(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),R(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),R(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),i.shape[2]===3){[h,d,f]=Gs(i,[1,1,1],-1);const _=U(h,r),v=U(d,o),w=U(f,a);m=pe(pe(_,v),w)}else m=t;if(e==="otsu"){const _=JZ(_e(xL(m),"int32"),Zh([]),256);c=nJ(_,l)}const g=n?Du(m,c):Zs(m,c);return _e(U(g,255),"int32")}function nJ(t,e){let n=ks([-1]),s=ks([0]),i=ks([0]),r,o,a,l,c,h;for(let d=0;d<t.size-1;d++){r=Ct(t,0,d+1),o=Ct(t,d+1),c=Re($e(r),e),h=Re($e(o),e);const f=$e(U(r,Dd(0,r.size)));a=Re(f,$e(r));const m=Qv(o.shape,r.size),g=pe(Dd(0,o.size),m),x=U(o,g);l=Re($e(x),$e(o));const _=Ae(a,l),v=Ae(a,l),w=U(c,h);i=U(U(w,_),v);const b=Zs(i,s);s=ns(b,i,s),n=ns(b,ks([d]),n)}return n}const sJ=H({threshold_:tJ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iJ(t,e,n="nearest",s="constant",i=0,r){const o=F(t,"image","transform","float32"),a=F(e,"transforms","transform","float32");R(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),R(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),R(r==null||r.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${r}.`);const l={image:o,transforms:a},c={interpolation:n,fillMode:s,fillValue:i,outputShape:r};return W.runKernel(LC,l,c)}const rJ=H({transform_:iJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(t,e,n){const s=F(t,"a","bandPart");R(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const i=s.shape,[r,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(R(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),R(e<=r,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${r}).`),a=F(e<0?r:e,"numLower","bandPart")):(R(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ns(Bg(e,0),r,Ad(e,r))),typeof n=="number"?(R(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),R(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=F(n<0?o:n,"numUpper","bandPart")):(R(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ns(Bg(n,0),o,Ad(n,o)));const c=G(Dd(0,r,1,"int32"),[-1,1]),h=Dd(0,o,1,"int32"),d=Ae(c,h),f=oo(Du(d,a),Hl(d,Kt(l))),m=_n([r,o],s.dtype);return G(ao(El(G(s,[-1,r,o])).map(g=>ns(f,g,m))),i)}const aJ=H({bandPart_:oJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(t){let e;if(Array.isArray(t)){e=!1,R(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=t[0].shape[0];for(let r=1;r<t.length;++r)R(t[r].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[r].shape[0]} vs. ${i})`)}else e=!0,t=Gs(t,t.shape[0],0).map(i=>op(i,[0]));R(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let i=0;i<t.length;++i)n.push(W.tidy(()=>{let r=s[i];if(i>0)for(let o=0;o<i;++o){const a=U($e(U(n[o],r)),n[o]);r=Ae(r,a)}return Re(r,ex(r,"euclidean"))}));return e?ao(n,0):n}const cJ=H({gramSchmidt_:lJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uJ(t,e=!1){if(R(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return ZN(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=El(G(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],r=[];s.forEach(l=>{const[c,h]=ZN(l,e);i.push(c),r.push(h)});const o=G(ao(i,0),t.shape),a=G(ao(r,0),t.shape);return[o,a]}}function ZN(t,e=!1){return W.tidy(()=>{R(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let i=uL(n),r=rl(t);const o=K_([[1]],[1,1]);let a=rl(o);const l=n>=s?s:n;for(let c=0;c<l;++c){const h=r,d=a,f=i;[a,r,i]=W.tidy(()=>{const m=Ct(r,[c,c],[n-c,1]),g=ex(m),x=Ct(r,[c,c],[1,1]),_=ns(Zs(x,0),K_([[-1]]),K_([[1]])),v=Ae(x,U(_,g)),w=Re(m,v);w.shape[0]===1?a=rl(o):a=ds([o,Ct(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const b=Kt(Re(lt(_,v),g)),I=Ct(r,[c,0],[n-c,s]),S=U(b,a),T=Je(a);if(c===0)r=Ae(I,lt(S,lt(T,I)));else{const D=Ae(I,lt(S,lt(T,I)));r=ds([Ct(r,[0,0],[c,s]),D],0)}const $=Je(S),E=Ct(i,[0,c],[n,i.shape[1]-c]);if(c===0)i=Ae(E,lt(lt(E,a),$));else{const D=Ae(E,lt(lt(E,a),$));i=ds([Ct(i,[0,0],[n,c]),D],1)}return[a,r,i]}),We([h,d,f])}return!e&&n>s&&(i=Ct(i,[0,0],[n,s]),r=Ct(r,[0,0],[s,s])),[i,r]})}const hJ=H({qr_:uJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xr={flipLeftRight:EQ,grayscaleToRGB:$Q,resizeNearestNeighbor:AL,resizeBilinear:RL,rgbToGrayscale:AQ,rotateWithOffset:PQ,cropAndResize:SQ,nonMaxSuppression:LQ,nonMaxSuppressionAsync:jQ,nonMaxSuppressionWithScore:HQ,nonMaxSuppressionWithScoreAsync:KQ,nonMaxSuppressionPadded:ZQ,nonMaxSuppressionPaddedAsync:QQ,threshold:sJ,transform:rJ},dJ={bandPart:aJ,gramSchmidt:cJ,qr:hJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ=new Map,pJ=new Map;class Ou{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class ci{constructor(){this.classNameMap={}}static getMap(){return ci.instance==null&&(ci.instance=new ci),ci.instance}static register(e){ci.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function de(t,e,n){R(t.className!=null,()=>"Class being registered does not have the static className property defined."),R(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),R(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,i=e+">"+s;return ci.register(t),fJ.set(i,t),pJ.set(t,i),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ca extends Ou{minimize(e,n=!1,s){const{value:i,grads:r}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:r[a.name]}));this.applyGradients(o)}else this.applyGradients(r);return We(r),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return _9(e,n)}dispose(){this.iterations_!=null&&We(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:rt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ca,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DL extends Ca{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accum_grad`,variable:Q(()=>et(r).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${s}/accum_var`,variable:Q(()=>et(r).variable(o))});const a=Array.isArray(e)?e[i].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[i].variable,c=this.accumulatedUpdates[i].variable;Q(()=>{const h=pe(U(l,this.rho),U(Et(a),1-this.rho)),d=U(Re(jn(pe(c,this.epsilon)),jn(pe(l,this.epsilon))),a),f=pe(U(c,this.rho),U(Et(d),1-this.rho));l.assign(h),c.assign(f);const m=pe(U(d,-this.learningRate),r);r.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(We(this.accumulatedGrads.map(e=>e.variable)),We(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PL extends Ca{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${s}/accumulator`,variable:Q(()=>Qv(r.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[i].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[i].variable;Q(()=>{const l=pe(a,Et(o));a.assign(l);const c=pe(U(Re(o,jn(pe(l,W.backend.epsilon()))),-this.learningRate),r);r.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&We(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OL extends Ca{static get className(){return"Adam"}constructor(e,n,s,i=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Q(()=>{this.accBeta1=rt(n).variable(),this.accBeta2=rt(s).variable()}),i==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Q(()=>{const s=Ae(1,this.accBeta1),i=Ae(1,this.accBeta2);n.forEach((r,o)=>{const a=W.registeredVariables[r],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${r}/m`,variable:Q(()=>et(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${r}/v`,variable:Q(()=>et(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[r];if(c==null)return;const h=this.accumulatedFirstMoment[o].variable,d=this.accumulatedSecondMoment[o].variable,f=pe(U(h,this.beta1),U(c,1-this.beta1)),m=pe(U(d,this.beta2),U(Et(c),1-this.beta2)),g=Re(f,s),x=Re(m,i);h.assign(f),d.assign(m);const _=pe(U(Re(g,pe(jn(x),this.epsilon)),-this.learningRate),a);a.assign(_)}),this.accBeta1.assign(U(this.accBeta1,this.beta1)),this.accBeta2.assign(U(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&We(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&We(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),Q(()=>{this.accBeta1.assign(Sl(this.beta1,this.iterations_+1)),this.accBeta2.assign(Sl(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LL extends Ca{static get className(){return"Adamax"}constructor(e,n,s,i=null,r=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=i,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Q(()=>{this.iteration=rt(0).variable(),this.accBeta1=rt(n).variable()}),i==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Q(()=>{const s=Ae(1,this.accBeta1),i=Re(-this.learningRate,pe(U(this.iteration,this.decay),1));n.forEach((r,o)=>{const a=W.registeredVariables[r],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${r}/m`,variable:et(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${r}/v`,variable:et(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[r];if(c==null)return;const h=this.accumulatedFirstMoment[o].variable,d=this.accumulatedWeightedInfNorm[o].variable,f=pe(U(h,this.beta1),U(c,1-this.beta1)),m=U(d,this.beta2),g=Yn(c),x=wa(m,g);h.assign(f),d.assign(x);const _=pe(U(Re(i,s),Re(f,pe(x,this.epsilon))),a);a.assign(_)}),this.iteration.assign(pe(this.iteration,1)),this.accBeta1.assign(U(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&We(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&We(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class II extends Ca{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=Array.isArray(e)?e[i].tensor:e[s];if(r==null)return;const o=W.registeredVariables[s];Q(()=>{const a=pe(U(this.c,r),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=br(rt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FL extends II{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=rt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${s}/momentum`,variable:Q(()=>et(r).variable(!1))});const o=this.accumulations[i].variable,a=Array.isArray(e)?e[i].tensor:e[s];a!=null&&Q(()=>{let l;const c=pe(U(this.m,o),a);this.useNesterov?l=pe(U(this.c,pe(a,U(c,this.m))),r):l=pe(U(this.c,c),r),o.assign(c),r.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&We(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ML extends Ca{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,i=null,r=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,i==null&&(this.epsilon=W.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,i)=>{const r=W.registeredVariables[s],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${s}/rms`,variable:Q(()=>et(r).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${s}/momentum`,variable:Q(()=>et(r).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${s}/mg`,variable:Q(()=>et(r).variable(o))});const a=Array.isArray(e)?e[i].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[i].variable,c=this.accumulatedMoments[i].variable;Q(()=>{const h=pe(U(l,this.decay),U(Et(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[i].variable,f=pe(U(d,this.decay),U(a,1-this.decay)),m=Re(U(a,this.learningRate),jn(Ae(h,pe(Et(f),this.epsilon)))),g=pe(U(c,this.momentum),m);l.assign(h),d.assign(f),c.assign(g);const x=Ae(r,g);r.assign(x)}else{const d=pe(U(l,this.decay),U(Et(a),1-this.decay)),f=pe(U(c,this.momentum),Re(U(a,this.learningRate),jn(pe(d,this.epsilon))));l.assign(d),c.assign(f);const m=Ae(r,f);r.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&We(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&We(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&We(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mJ=[DL,PL,OL,LL,FL,ML,II];function gJ(){for(const t of mJ)de(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YN(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let i=0;const r=l=>(l.then(c=>{const h=n+ ++i/t.length*(s-n);return e(h),c}),l);function o(l){R(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){R(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),R(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),R(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function yJ(t,e){e==null&&(e={});const n=e.fetchFunc==null?ee().platform.fetch:e.fetchFunc,s=t.map(d=>n(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await YN(s,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await YN(a,e.onProgress,.5,1)}function vJ(t,e){var n;const s=e.fetchFunc==null?ee().platform.fetch:e.fetchFunc;let i=0,r;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;i<t.length;){r||(r=(await s(t[i],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await r.read();if(l){i++,r=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,i/t.length);continue}o.enqueue(c);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ="application/octet-stream",_J="application/json";class kI{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(R(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ee().platform.fetch,R(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&R(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=DX(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(i)],{type:_J}),"model.json"),e.weightData!=null){const o=va.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:xJ}),"model.weights.bin")}const r=await this.fetch(this.path,n);if(r.ok)return{modelArtifactsInfo:WC(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,i=n.weightsManifest;if(s==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return OX(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=GN(e.weightsManifest),i=()=>vJ(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:i})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,i]=wJ(n),r=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):o.push(r+c+i);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=GN(e),i=await yJ(n,this.loadOptions);return[s,i]}}kI.URL_SCHEME_REGEX=/^https?:\/\//;function wJ(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),i=n>e?t.substring(n):"";return[s+"/",i]}function QN(t){return t.match(kI.URL_SCHEME_REGEX)!=null}const zL=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>QN(s)):n=QN(t),n)return BL(t,e)}return null};yn.registerSaveRouter(zL);yn.registerLoadRouter(zL);function BL(t,e){return new kI(t,e)}function bJ(t,e){return BL(t,e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Oa;function CJ(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,i=!1,r=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)r=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(Lw(Pw,W.backendName)!=null){const g={pixels:t},x={numChannels:e};return W.runKernel(Pw,g,x)}const[c,h]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let d;if(o)d=t.getContext("2d").getImageData(0,0,c,h).data;else if(s||n)d=t.data;else if(r||i||a){if(Oa==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Oa=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Oa=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Oa.canvas.width=c,Oa.canvas.height=h,Oa.drawImage(t,0,0,c,h),d=Oa.getImageData(0,0,c,h).data}let f;if(e===4)f=new Int32Array(d);else{const g=c*h;f=new Int32Array(g*e);for(let x=0;x<g;x++)for(let _=0;_<e;++_)f[x*e+_]=d[x*4+_]}return sQ(f,[h,c,e],"int32")}const IJ=H({fromPixels_:CJ});function SI(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(re(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,r=i[i.length-1];let o=1;for(let d=0;d<i.length-1;++d)o*=i[d];const a=t.shape,l=i.slice();l.pop();let c=1;for(let d=r;d<n;++d)c*=a[d],l.push(a[d]);const h=[...Te(t.shape).map(d=>d/c),1].slice(0,r);return[l,o,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zw=-2,kJ=-1;function TI(t,e,n){const s=t.shape.length;R(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),R(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let i=0;i<s;++i)R(e[i]+n[i]<=t.shape[i],()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`)}function SJ(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function EI(t,e,n){const s=[];for(let i=0;i<t.length;i++)s[i]=Math.ceil((e[i]-t[i])/n[i]);return s}function UL(t,e,n,s){const i=[...t];for(let r=i.length;r<s.length;r++)i.push(1);for(let r=0;r<n;r++)r===0?i[e]=1:(i.splice(e,0,1),i.pop());return i}function WL(t,e,n){return n<=t?n:n-(e-1)}function VL(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function TJ(t,e,n,s,i,r,o,a,l){const c=t.length;let h=new Array(c),d=new Array(c),f=new Array(c);if(e.length&&n>0){const m=e[0],g=n+1;h=jL(o,m,g,s,t),d=GL(a,m,g,i,t),f=UL(r,m,g,t)}else for(let m=0;m<c;m++)h[m]=qL(o,s,r,t,m,l),d[m]=KL(a,i,r,t,m,l),f[m]=HL(r,m,l);return{begin:h,end:d,strides:f}}function jL(t,e,n,s,i){const r=[...i],o=VL(n,e);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=0;else{const l=WL(e,n,a);let c=s[l];t&1<<l&&(c=0),r[a]=c}return r}function GL(t,e,n,s,i){const r=[...i],o=VL(n,e);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=Number.MAX_SAFE_INTEGER;else{const l=WL(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),r[a]=c}for(let a=0;a<r.length;a++){const l=i[a];r[a]<0&&(r[a]+=l),r[a]=vl(0,r[a],i[a])}return r}function HL(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function qL(t,e,n,s,i,r){let o=e[i];const a=n[i]||1;(t&1<<i||r&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[i];return o<0&&(o+=l),o=vl(0,o,l-1),o}function KL(t,e,n,s,i,r){let o=e[i];const a=n[i]||1;(t&1<<i||r&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[i];return o<0&&(o+=l),a>0?o=vl(0,o,l):o=vl(-1,o,l-1),o}function NI(t,e,n){let s=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){s=i;break}for(let i=s+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function $I(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function nx(t,e,n){let s;const i=t.shape.length;typeof e=="number"?s=[e,...new Array(i-1).fill(0)]:e.length<i?s=e.concat(new Array(i-e.length).fill(0)):s=e.slice(),s.forEach(o=>{R(o!==-1,()=>"slice() does not support negative begin indexing.")});let r;return n==null?r=new Array(i).fill(-1):typeof n=="number"?r=[n,...new Array(i-1).fill(-1)]:n.length<i?r=n.concat(new Array(i-n.length).fill(-1)):r=n,r=r.map((o,a)=>o>=0?o:(R(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,r]}function RI(t,e,n,s,i,r,o,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<d.dims;b++)h&&1<<b&a&&d.numAddAxisAfterEllipsis++,1<<b&o&&(h=!0);h||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};EJ(d,f);let m=!0,g=!0,x=!0;const _=[],v=[];for(let b=0;b<t.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const I=!!(f.shrinkAxisMask&1<<b),S=t[b];if(S===-1){_.push(I?1:-1);continue}const T=[f.beginMask&1<<b,f.endMask&1<<b],$=[f.strides[b]>0?0:-1,f.strides[b]>0?S:S-1];if(I&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");x=x&&f.strides[b]===1;const E=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(I){const V=f.begin[b]<0?S+f.begin[b]:f.begin[b];if(f.begin[b]=V,f.end[b]=f.begin[b]+1,V<0||V>=S)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=JN(f.begin[b],0,f.strides[b],S,T,$),f.end[b]=JN(f.end[b],1,f.strides[b],S,T,$);const z=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===S;m=m&&z,g=g&&(b===0&&f.strides[b]===1||z)}else m=m&&f.strides[b]===1&&E,g=g&&(b===0&&f.strides[b]===1||E);let D,P=!1;if(f.beginValid&&f.endValid?(D=f.end[b]-f.begin[b],P=!0):I?(D=1,P=!0):E&&S>=0&&(f.strides[b]<0?D=-S:D=S,P=!0),P){let z;D===0||D<0!=f.strides[b]<0?z=0:z=Math.trunc(D/f.strides[b])+(D%f.strides[b]!==0?1:0),_.push(z)}else _.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){const I=f.finalShapeGatherIndices[b];I>=0?v.push(_[I]):I===Zw&&v.push(1)}return{finalShapeSparse:v.filter((b,I)=>f.finalShapeGatherIndices[I]!==Zw),finalShape:v,isIdentity:m,sliceDim0:g,isSimpleSlice:x,begin:f.begin,end:f.end,strides:f.strides}}function EJ(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(Zw),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(kJ),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function JN(t,e,n,s,i,r){if(i[e])return n>0?r[e]:r[e+1&1];{const o=t<0?s+t:t;return o<r[0]?r[0]:o>r[1]?r[1]:o}}const NJ=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:TI,computeFlatOffset:$I,computeOutShape:EI,getNormalizedAxes:TJ,isSliceContinous:NI,maskToAxes:SJ,parseSliceParams:nx,sliceInfo:RI,startForAxis:qL,startIndicesWithElidedDims:jL,stopForAxis:KL,stopIndicesWithElidedDims:GL,stridesForAxis:HL,stridesWithElidedDims:UL},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $J{static sgd(e){return new II(e)}static momentum(e,n,s=!1){return new FL(e,n,s)}static rmsprop(e,n=.9,s=0,i=null,r=!1){return new ML(e,n,s,i,r)}static adam(e=.001,n=.9,s=.999,i=null){return new OL(e,n,s,i)}static adadelta(e=.001,n=.95,s=null){return new DL(e,n,s)}static adamax(e=.002,n=.9,s=.999,i=null,r=0){return new LL(e,n,s,i,r)}static adagrad(e,n=.1){return new PL(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=$J;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function XL(){return new Promise(t=>RJ(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AI(t,e){const n=t[0].length;t.forEach((i,r)=>{R(i.length===n,()=>`Error in concat${n}D: rank of tensors[${r}] must be the same as the rank of the rest (${n})`)}),R(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((i,r)=>{for(let o=0;o<n;o++)R(o===e||i[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${r}] (${i}) does not match the shape of the rest (${s}) along the non-concatenated axis ${r}.`)})}function Cr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Mi;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Mi||(Mi={}));function ZL(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let i=1;i<n.length;++i){const r=n[i],o=s[s.length-n.length+i],a=s[o];if(r>=0)if(a>=0){if(a!==r)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${r} but shape[${i+t}] = ${a}`)}else s[o]=r}return s}function YL(t){const e={FIRST_DIM_SIZE:Mi.FIRST_DIM_SIZE,VALUE_ROWIDS:Mi.VALUE_ROWIDS,ROW_LENGTHS:Mi.ROW_LENGTHS,ROW_SPLITS:Mi.ROW_SPLITS,ROW_LIMITS:Mi.ROW_LIMITS,ROW_STARTS:Mi.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function QL(t){return t.length===0?0:t[0]===Mi.FIRST_DIM_SIZE?t.length-1:t.length}function JL(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let i=0;i<Math.min(n,s-1);++i){const r=t[i],o=e[i+1];if(r>=0&&o>=0&&r!==1&&r!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${r} but ragged tensor input.flatValues.shape[${i-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DI=30;function sx(t){return t<=DI?t:Rw(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PI(t,e,n){const s=n*(typeof t=="number"?t:t[0]),i=e*(typeof t=="number"?t:t[1]);return[s,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lp(t,e,n,s=!0){let i=[];if(s)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const r=e.length;for(let o=0;o<r;++o)i=i.concat([t[o+1]/e[o],e[o]]);i=i.concat(t.slice(r+1))}return i}function cp(t,e,n=!0){const s=[];if(n){s.push(e);for(let i=e+1;i<t;++i)i<=2*e?(s.push(i),s.push(i-(e+1))):s.push(i)}else{const i=[],r=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?r.push(o):i.push(o);s.push(...i),s.push(0),s.push(...r)}return s}function up(t,e,n,s=!0){const i=[];s?i.push(t[0]/n):i.push(t[0]*n);for(let r=1;r<t.length;++r)r<=e.length?s?i.push(e[r-1]*t[r]):i.push(t[r]/e[r-1]):i.push(t[r]);return i}function OI(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function LI(t,e,n){const s=t.slice(0,1);for(let i=0;i<n;++i)s.push(t[i+1]-e[i][0]-e[i][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ix=1.7580993408473768,rx=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FI=.3275911,MI=.254829592,zI=-.284496736,BI=1.421413741,UI=-1.453152027,WI=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lo(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function eF(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function tF(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function nF(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function VI(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function sF(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function iF(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const r=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(r),s[i]=Math.sin(r)}return{real:n,imag:s}}function rF(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),i=Math.cos(s),r=Math.sin(s);return{real:i,imag:r}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_="->",AJ=/->/g,e2=",",t2="...";function jI(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(AJ,"").length)/X_.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${X_}").`);const[s,i]=t.split(X_);R(s.indexOf(t2)===-1,()=>`The ellipsis notation ("${t2}") is not supported yet.`);const r=s.split(e2),o=r.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<i.length;++f){const m=i[f];if(!r.some(g=>g.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);a.indexOf(m)===-1&&a.push(m)}for(let f=0;f<s.length;++f){const m=s[f];a.indexOf(m)===-1&&m!==e2&&a.push(m)}const l=new Array(r.length);for(let f=0;f<o;++f){if(new Set(r[f].split("")).size!==r[f].length)throw new Error(`Found duplicate axes in input component ${r[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let m=0;m<r[f].length;++m)l[f].push(a.indexOf(r[f][m]))}const c=a.length,h=i.length,d=[];for(let f=h;f<c;++f)d.push(f);return{allDims:a,summedDims:d,idDims:l}}function GI(t,e){let n=new Array(t);n.fill(-1);for(let i=0;i<e.length;++i)n[e[i]]=i;const s=[];for(let i=0;i<t;++i)n[i]===-1&&s.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:s}}function HI(t,e,n){const s=new Array(t);for(let i=0;i<n.length;++i){const r=n[i].shape;for(let o=0;o<e[i].length;++o)s[e[i][o]]===void 0?s[e[i][o]]=r[o]:R(s[e[i][o]]===r[o],()=>`Expected dimension ${s[e[i][o]]} at axis ${o} of input shaped ${JSON.stringify(r)}, but got dimension ${r[o]}`)}}function qI(t,e){const n=t,s=[];let i=0;t.length===0&&n.push(-1),i=t.length+1;for(let o=0;o<i;++o)s.push([]);const r=[];for(let o=0;o<n.length;++o){const a=n[o],l=DJ(e,a);for(const c of l)r.indexOf(c)===-1&&(s[o].push(c),r.push(c))}return{path:n,steps:s}}function KI(t){return t.every((e,n)=>e===n)}function DJ(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function XI(t,e,n=0){let s=[];if(typeof e=="number")R(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);R(i<=1,()=>"There should be only one negative value in split array.");const r=e.indexOf(-1);if(r!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[r]=t.shape[n]-o}R(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oF(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function aF(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function lF(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function uF(t,e){return`size ${t} must be non-negative, not ${e}`}function hF(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function dF(t,e){const n=re(t),s=re(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function fF(t,e){const n=re(t),s=re(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yw(){return"segment ids must be >= 0"}function pF(){return"segment ids are not increasing"}function mF(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function gF(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yF(t,e){let n=!1,s;for(t<=DI?(s=t,n=!0):s=Rw(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Rw(t,s+1);return s}function vF(t,e,n){const s=[],i=t.length;for(let r=0;r<i;r++)r!==e?s.push(t[r]):s.push(n);return s}function ZI(t,e,n,s){const i=e.shape.length,r=t.shape.length;if(s!==0&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>r)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${r}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const o=t.shape[n],a=[];let l=1,c=1,h=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=s;d<i;d++)a.push(e.shape[d]);for(let d=n+1;d<r;d++)a.push(t.shape[d]),h*=t.shape[d];return{batchSize:l,sliceSize:h,outerSize:c,dimSize:o,outputShape:a}}const PJ=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:ZI,computeOutShape:vF,segOpComputeOptimalWindowSize:yF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function co(t){try{return t.map(e=>ta(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function xF(t){return t.map(e=>Xo(e))}const OJ=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:MI,ERF_A2:zI,ERF_A3:BI,ERF_A4:UI,ERF_A5:WI,ERF_P:FI,PARALLELIZE_THRESHOLD:DI,get RowPartitionType(){return Mi},SELU_SCALE:rx,SELU_SCALEALPHA:ix,applyActivation:vI,assertAndGetBroadcastShape:ze,assertAxesAreInnerMostDims:On,assertParamsConsistent:AI,assignToTypedArray:sF,axesAreInnerMostDims:XC,calculateShapes:Xl,checkEinsumDimSizes:HI,checkPadOnDimRoundingMode:vs,combineLocations:lL,combineRaggedTensorToTensorShapes:ZL,complexWithEvenIndex:tF,complexWithOddIndex:nF,computeConv2DInfo:Pn,computeConv3DInfo:xa,computeDefaultPad:VC,computeDilation2DInfo:sp,computeOptimalWindowSize:sx,computeOutAndReduceShapes:In,computeOutShape:Cr,computePool2DInfo:bi,computePool3DInfo:mo,convertConv2DDataFormat:go,decodeEinsumEquation:jI,eitherStridesOrDilationsAreOne:Gn,expandShapeToKeepDim:sn,exponent:rF,exponents:iF,fromStringArrayToUint8:xF,fromUint8ToStringArray:co,getAxesPermutation:Bt,getBroadcastDims:uu,getComplexWithIndex:VI,getEinsumComputePath:qI,getEinsumPermutation:GI,getFusedBiasGradient:yI,getFusedDyActivation:gI,getImageCenter:PI,getInnerMostAxes:Zt,getPermuted:cp,getRaggedRank:QL,getReductionAxes:pn,getReshaped:lp,getReshapedPermuted:up,getRowPartitionTypesHelper:YL,getSliceBeginCoords:OI,getSliceSize:LI,getSparseFillEmptyRowsIndicesDenseShapeMismatch:oF,getSparseFillEmptyRowsNegativeIndexErrorMessage:aF,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:lF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:hF,getSparseReshapeInputOutputMismatchErrorMessage:fF,getSparseReshapeInputOutputMultipleErrorMessage:dF,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:cF,getSparseReshapeNegativeOutputDimErrorMessage:uF,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:gF,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Yw,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:pF,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:mF,getUndoAxesPermutation:_a,isIdentityPermutation:KI,log:Z8,mergeRealAndImagArrays:lo,prepareAndValidate:SI,prepareSplitSize:XI,segment_util:PJ,shouldFuse:xI,slice_util:NJ,splitRealAndImagArrays:eF,stridesOrDilationsArePositive:Il,tupleValuesAreOne:Cl,upcastType:Ds,validateDefaultValueShape:JL,validateInput:iQ,validateUpdateShape:TL,warn:Bs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */gJ();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _F={kernelName:Xy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,ap(_e(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LJ={kernelName:of,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Et(_e(n,"float32")),i=jn(Ae(rt(1),s));return Kt(Re(t,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ={kernelName:af,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=jn(Ae(Et(_e(n,"float32")),1));return Re(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MJ={kernelName:Ru,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{let a=t;const l=pn(n.shape,i);return l.length>0&&(a=$e(a,l)),G(a,n.shape)},b:()=>{let a=t;const l=pn(s.shape,i);return l.length>0&&(a=$e(a,l)),G(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zJ={kernelName:Q1,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,i)=>{n[i]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BJ={kernelName:Zy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>et(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UJ={kernelName:Yy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>et(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WJ={kernelName:lf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,jn(Ae(rt(1),Et(_e(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VJ={kernelName:cf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=jn(pe(rt(1),Et(_e(n,"float32"))));return Re(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jJ={kernelName:df,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=pe(Et(n),Et(s));let l=U(t,Re(s,a));const c=pn(n.shape,i);return c.length>0&&(l=$e(l,c)),G(l,n.shape)},b:()=>{const a=pe(Et(n),Et(s));let l=Kt(U(t,Re(n,a)));const c=pn(s.shape,i);return c.length>0&&(l=$e(l,c)),G(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GJ={kernelName:uf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,pe(Et(_e(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HJ={kernelName:hf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Ae(rt(1),Et(_e(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qJ(t,e,n,s,i,r){const o=F(t,"dy","avgPool3dGrad"),a=F(e,"input","avgPool3dGrad");let l=o,c=a,h=!1;a.rank===4&&(h=!0,l=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),R(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),R(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),vs("avgPool3dGrad",i,r);const d={dy:l,input:c},f={filterSize:n,strides:s,pad:i,dimRoundingMode:r},m=W.runKernel(nC,d,f);return h?G(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const KJ=H({avgPool3dGrad_:qJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XJ={kernelName:Jy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:i,strides:r,pad:o,dimRoundingMode:a}=n;return{x:()=>KJ(t,s,i,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZJ(t,e,n,s,i){const r=F(t,"dy","avgPoolGrad"),o=F(e,"input","avgPoolGrad");R(o.rank===r.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${r.rank})`);let a=o,l=r,c=!1;o.rank===3&&(c=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=G(r,[1,r.shape[0],r.shape[1],r.shape[2]])),R(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),R(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const h={dy:l,input:a},d={filterSize:n,strides:s,pad:i},f=W.runKernel(tC,h,d);return c?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const YJ=H({avgPoolGrad_:ZJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ={kernelName:Qy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:i,strides:r,pad:o}=n;return{x:()=>YJ(t,s,i,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JJ={kernelName:ev,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,i]=e,{transposeA:r,transposeB:o}=n;return!r&&!o?{a:()=>lt(t,i,!1,!0),b:()=>lt(s,t,!0,!1)}:!r&&o?{a:()=>lt(t,i,!1,!1),b:()=>lt(t,s,!0,!1)}:r&&!o?{a:()=>lt(i,t,!1,!0),b:()=>lt(s,t,!1,!1)}:{a:()=>lt(i,t,!0,!0),b:()=>lt(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eee={kernelName:tv,gradFunc:(t,e,n)=>{const{blockShape:s,crops:i}=n;return{x:()=>sI(t,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tee={kernelName:q8,gradFunc:(t,e,n)=>{const s=n,i=s.inputShape,r=s.shape,o=Array.from(r);for(let l=i.length-1;l>=0;l--)if(i[l]===r[l])o[l]=1;else if(i[l]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${r}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>$e(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nee={kernelName:ff,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const see={kernelName:pf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iee={kernelName:mf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:i,clipValueMax:r}=n;return{x:()=>ns(oo(Hl(s,i),Du(s,r)),t,et(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ree={kernelName:nv,inputsToSave:["x"],gradFunc:_F.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oee={kernelName:sv,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:i}=n,r=Ge(i,e[0].shape)[0],o=s.map(l=>l[r]);return Gs(t,o,r).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aee={kernelName:iv,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,{dilations:r,strides:o,pad:a,dataFormat:l}=n;return R(Cl(r),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`),{x:()=>HC(s.shape,t,i,o,a,l),filter:()=>mI(s,t,i.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lee={kernelName:rv,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,{strides:r,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>kl(t,i,r,o,a,1,l),filter:()=>mI(t,s,i.shape,r,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cee(t,e,n,s,i){let r=t;t.rank===4&&(r=G(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=G(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),R(r.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${r.shape}.`),R(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),R(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),R(r.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${r.shape[4]}) must match input depth in filter (${n[3]}.`),R(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:r,dy:o},l={strides:s,pad:i,filterShape:n};return W.runKernel(aC,a,l)}const uee=H({conv3DBackpropFilter_:cee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hee={kernelName:ov,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:i,pad:r}=n;R(Cl(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>iL(o.shape,t,a,i,r),filter:()=>uee(o,t,a.shape,i,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dee={kernelName:gf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Kt(CL(_e(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fee={kernelName:yf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(IL(_e(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pee={kernelName:av,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i,exclusive:r,reverse:o}=n;return{x:()=>{const a=Bt([i],s.rank);let l=oL(t,i,r,!o);return a!=null&&(l=Je(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mee={kernelName:lv,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:i,pad:r,dimRoundingMode:o}=n,a=s??[1,1];R(Cl(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return R(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),R(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),R(Gn(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),vs("depthwiseConv2d",r,o),{x:()=>CQ(l.shape,t,c,i,r,a,o),filter:()=>wQ(l,t,c.shape,i,r,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gee={kernelName:cv,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,r={x:s,filter:i,dy:t},o={x:s,filter:i,dy:t};return{x:()=>W.runKernel(Aw,r,n),filter:()=>W.runKernel(Dw,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yee={kernelName:xf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>W.runKernel(gC,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vee={kernelName:_f,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=U(Nr(Kt(Et(n))),2/Math.sqrt(Math.PI));return{x:()=>U(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xee={kernelName:wf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ee={kernelName:hv,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>G(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wee={kernelName:bf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Nr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bee={kernelName:Cf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cee={kernelName:If,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=Re(t,_e(s,"float32")),l=pn(n.shape,i);return l.length>0?G($e(a,l),n.shape):a},b:()=>{let a=U(t,_e(n,"float32"));const l=pn(s.shape,i);l.length>0&&(a=G($e(a,l),s.shape));const c=Et(s);return Kt(Re(a,_e(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iee={kernelName:dv,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[i,r,o,a]=e,l=a??rt(1),c=pn(r.shape,i.shape),h=[];if(r.rank===1){for(let I=0;I<i.shape.length-1;++I)h.push(i.shape[I]);h.push(1)}const d=Ae(i,r),f=U(t,l),m=_L(pe(o,rt(s))),g=U(U(U(m,m),m),rt(-.5));return{x:()=>r.rank===1?G(U(U(t,Bi(G(m,[1,1,1,r.shape[0]]),h)),l),i.shape):G(U(U(t,m),l),i.shape),mean:()=>{let I=U(U(m,rt(-1)),f);return r.rank===1&&(I=$e(I,c)),G(I,r.shape)},variance:()=>{let I=U(U(g,d),f);return r.rank===1&&(I=$e(I,c)),G(I,r.shape)},scale:()=>{const I=U(d,m);let S=U(t,I);return r.rank===1&&(S=$e(S,c)),G(S,r.shape)},offset:()=>{let I=t;return r.rank===1&&(I=$e(I,c)),G(I,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kee={kernelName:fv,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,i]=e,{axis:r,batchDims:o}=n,a=Ge(r,s.shape)[0],l=(c,h,d)=>()=>{const f=c.shape,m=h.size,g=f.slice(0,a),x=g.length,_=f.slice(r,f.length).slice(1),v=_.length,w=n2(0,x),b=n2(x+1,x+1+v),I=s2([g,[m],_]),S=G(d,I),T=G(h,[m]),$=s2([[x],w,b]),E=Je(S,$);let D=NL(E,T,c.shape[a]);const P=_a($);return D=Je(D,P),D};if(o===1){const c=s.shape[0],h=s.split(c,0);return{x:()=>ao(h.map((m,g)=>l(m,i.slice(g,1),t.slice(g,1))())).reshape(s.shape),indices:()=>i}}else return{x:l(s,i,t),indices:()=>i}}};function n2(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function s2(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const See={kernelName:kf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>et(n),b:()=>et(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee={kernelName:Sf,gradFunc:t=>({x:()=>_e(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eee={kernelName:Tf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nee={kernelName:Ef,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ee={kernelName:Nf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ree={kernelName:mv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:i}=n,r=Zs(s,0);return{x:()=>ns(r,t,U(t,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aee={kernelName:Rf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,pe(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dee={kernelName:$f,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,_e(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pee={kernelName:X8,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n;return{logits:()=>{const o=Nr(s);return Ae(t,U($e(t,i,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oee(t,e,n,s=5,i=1,r=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:i,alpha:r,beta:o};return W.runKernel(bC,a,l)}const Lee=H({localResponseNormalizationBackprop_:Oee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fee={kernelName:wv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{depthRadius:r,bias:o,alpha:a,beta:l}=n;return{x:()=>Lee(s,i,t,r,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wF(t,e,n,s){return e.rank<n.rank&&(e=G(e,sn(e.shape,s))),t.rank<n.rank&&(t=G(t,sn(t.shape,s))),{x:()=>U(t,_e(Er(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i2={kernelName:bv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:i}=s,r=e[0],o=e[1],a=Ge(i,r.shape),l=wF(t,o,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mee={kernelName:Af,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>U(t,_e(Hl(n,s),"float32")),b:()=>U(t,_e(Bg(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zee(t,e,n,s,i,r,o){const a=F(t,"dy","maxPool3dGrad"),l=F(e,"input","maxPool3dGrad"),c=F(n,"output","maxPool3dGrad");let h=a,d=l,f=c,m=!1;l.rank===4&&(m=!0,h=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=G(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=G(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),R(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),R(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),R(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),vs("maxPool3dGrad",r,o);const g={dy:h,input:d,output:f},x={filterSize:s,strides:i,pad:r,dimRoundingMode:o},_=W.runKernel(IC,g,x);return m?G(_,[_.shape[1],_.shape[2],_.shape[3],_.shape[4]]):_}const Bee=H({maxPool3dGrad_:zee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uee={kernelName:Iv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>Bee(t,s,i,r,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(t,e,n,s,i,r,o){const a=F(t,"dy","maxPoolGrad"),l=F(e,"input","maxPoolGrad"),c=F(n,"output","maxPoolGrad");R(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),R(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),R(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),vs("maxPoolGrad",r,o);const h={dy:a,input:l,output:c},d={filterSize:s,strides:i,pad:r,dimRoundingMode:o};return W.runKernel(CC,h,d)}const Vee=H({maxPoolGrad_:Wee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jee={kernelName:Cv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{filterSize:r,strides:o,pad:a}=n;return{x:()=>Vee(t,s,i,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gee={kernelName:kv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n,r=Ge(i,s.shape),a=In(s.shape,r)[1],l=re(a);return{x:()=>{const h=s.shape.slice();r.forEach(m=>{h[m]=1});const d=G(t,h);return Re(U(d,ba(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hee={kernelName:Sv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:i}=s,[r,o]=e,a=Ge(i,r.shape),l=wF(t,o,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qee={kernelName:Df,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>U(t,_e(Du(n,s),"float32")),b:()=>U(t,_e(Zs(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kee={kernelName:Tv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:i}=n,r=i.map(o=>o[0]);return{x:()=>Ct(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xee={kernelName:Pf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=pn(n.shape,i);return a.length>0?G($e(t,a),n.shape):t},b:()=>{const a=U(t,Kt(tx(Re(n,s)))),l=pn(s.shape,i);return l.length>0?G($e(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee={kernelName:Of,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=U(t,_e(s,"float32")),l=pn(n.shape,i);return l.length>0?G($e(a,l),n.shape):a},b:()=>{const a=U(t,_e(n,"float32")),l=pn(s.shape,i);return l.length>0?G($e(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yee={kernelName:Ev,gradFunc:t=>({x:()=>Kt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qee={kernelName:Rv,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>_n(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jee={kernelName:$v,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ete={kernelName:Av,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return El(t,s).map(r=>()=>r)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r2={kernelName:Dv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:i}=n,r=i.map(o=>o[0]);return{x:()=>Ct(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tte={kernelName:Lf,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,i]=e,r=n,o=s,a=ze(r.shape,o.shape);return{a:()=>{const h=_e(o,"float32");let d=U(t,U(h,Sl(r,Ae(h,rt(1)))));const f=pn(r.shape,a);return f.length>0&&(d=$e(d,f)),G(d,r.shape)},b:()=>{const h=Zs(r,0),d=ns(h,$r(r),et(r));let f=U(t,U(i,d));const m=pn(o.shape,a);return m.length>0&&(f=$e(f,m)),G(f,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nte={kernelName:Pv,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,i=Zs(n,0);return{x:()=>ns(i,t,U(t,s)),alpha:()=>{let r=ns(i,et(t),U(t,n));const o=pn(s.shape,t.shape);return o.length>0&&(r=$e(r,o)),G(r,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ste(t,e,n){const s=t.shape.slice();s[n]=1;const i=G(e,s),r=Kw(t,n,!0,!1),o=Kw(t,n,!0,!0),a=U(r,o);return U(i,a)}function ite(t,e,n){const s=t.shape.length,i=s-n.length,r=Bt(n,s);let o=t;r!=null&&(o=Je(t,r));const a=o.shape.slice(),c=a.splice(s-n.length,n.length).reduce((f,m)=>f*m,1);a.push(c);const h=o.reshape(a);let d=ste(h,e,i);if(d=d.reshape(o.shape),r!=null){const f=_a(r);d=Je(d,f)}return d}const rte={kernelName:Ov,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n;let r=[];return i==null?r=s.shape.map((o,a)=>a):typeof i=="number"?r=[i]:r=i,{x:()=>ite(s,t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ote={kernelName:vf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{const a=Re(t,_e(s,"float32")),l=pn(n.shape,i);return l.length>0?G($e(a,l),n.shape):a},b:()=>{let a=U(t,_e(n,"float32"));const l=pn(s.shape,i);l.length>0&&(a=G($e(a,l),s.shape));const c=Et(s);return Kt(Re(a,_e(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ate={kernelName:Ff,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Kt(Et(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lte={kernelName:zf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=U(Du(n,6),ap(n));return{x:()=>U(t,_e(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cte={kernelName:Mf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,_e(ap(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute={kernelName:Lv,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hte={kernelName:Mv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,i={dy:t,images:s};return{images:()=>W.runKernel(RC,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dte={kernelName:Fv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,i={dy:t,images:s};return{images:()=>W.runKernel($C,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fte={kernelName:zv,gradFunc:(t,e,n)=>{const{dims:s}=n,i=Ge(s,t.shape);return{x:()=>Tl(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pte={kernelName:Bf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte={kernelName:Uf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Kt(Re(t,U(Sl(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gte={kernelName:Bv,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>_e(et(n),"float32"),t:()=>U(t,_e(n,t.dtype)),e:()=>U(t,_e(JC(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yte={kernelName:Wf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Zs(n,rt(0)),i=rt(ix),r=rt(rx),o=U(t,r),a=U(U(t,i),Nr(_e(n,"float32")));return ns(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vte={kernelName:Hf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(n,Ae(rt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte={kernelName:Gf,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _te={kernelName:Vf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(qC(_e(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wte={kernelName:jf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(rL(_e(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bte={kernelName:Uv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:i,size:r}=n,o=s.shape,[a,l]=nx(s,i,r),c=[];for(let h=0;h<t.rank;h++)c.push([a[h],o[h]-a[h]-l[h]]);return{x:()=>nI(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte={kernelName:Gv,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:i}=n,r=!0,o=U(t,s);return{logits:()=>Ae(o,U($e(o,[i],r),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite={kernelName:qf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Au(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o2={kernelName:Vv,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:i}=n;return{x:()=>GC(t,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a2={kernelName:jv,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>ds(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kte={kernelName:Kf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,U(jn(_e(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ste={kernelName:AC,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(_e(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tte={kernelName:Xf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=rt(2);return{a:()=>U(t,U(i,Ae(n,s))),b:()=>U(t,U(i,Ae(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete={kernelName:ep,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte={kernelName:Zf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=ze(n.shape,s.shape);return{a:()=>{let a=t;const l=pn(n.shape,i);return l.length>0&&(a=$e(a,l)),G(a,n.shape)},b:()=>{let a=t;const l=pn(s.shape,i);return l.length>0&&(a=$e(a,l)),G(Kt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te={kernelName:Wv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,i=s.shape.slice(),{axis:r}=n;Ge(r,s.shape).forEach(c=>{i[c]=1});const a=G(t,i),l=U(a,ba(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte={kernelName:Yf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Re(t,Et(qC(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ate={kernelName:Qf,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Ae(rt(1),Et(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dte={kernelName:Jf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:i}=n;return{x:()=>{let o=et(s);if(s.rank===1)for(let a=0;a<i[0];++a)o=pe(o,Ct(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)o=pe(o,Ct(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)o=pe(o,Ct(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<i[0];++a)for(let l=0;l<i[1];++l)for(let c=0;c<i[2];++c)for(let h=0;h<i[3];++h)o=pe(o,Ct(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte={kernelName:Hc,gradFunc:(t,e,n)=>{const s=n,{perm:i}=s,r=_a(i);return{x:()=>Je(t,r)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ote={kernelName:Hv,gradFunc:(t,e,n)=>{const s=n,{axis:i}=s;return{value:()=>ao(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lte={kernelName:qv,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Fte(t,n)}}};function Fte(t,e){const n=wa(e,et(e)),s=ZC(t,n);let i=Hl(e,rt(0,"int32"));const r=s.rank-i.rank;for(let a=0;a<r;++a)i=cs(i,a+1);i=oo(i,ba(s.shape,"bool"));const o=et(s);return ns(i,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mte={kernelName:Kv,gradFunc:t=>({x:()=>et(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zte=[_F,LJ,FJ,MJ,zJ,BJ,UJ,WJ,VJ,jJ,GJ,HJ,XJ,QJ,JJ,eee,tee,nee,see,iee,ree,oee,lee,aee,hee,dee,fee,pee,mee,gee,ote,yee,vee,xee,_ee,wee,Cee,bee,Iee,kee,See,Tee,Eee,Nee,$ee,Ree,Aee,Dee,Pee,Fee,i2,i2,Mee,Uee,jee,Gee,Hee,qee,Kee,Xee,Zee,Yee,Qee,Jee,ete,r2,r2,tte,nte,rte,ate,lte,cte,ute,hte,dte,fte,pte,mte,gte,yte,vte,xte,_te,wte,bte,Cte,Ite,o2,o2,a2,a2,kte,Tte,Ste,Ete,Nte,$te,Rte,Ate,Dte,Pte,Ote,Lte,Mte];for(const t of zte)Y8(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.abs=function(){return this.throwIfDisposed(),Yn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.acos=function(){return this.throwIfDisposed(),dZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.acosh=function(){return this.throwIfDisposed(),pZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.add=function(t){return this.throwIfDisposed(),pe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.all=function(t,e){return this.throwIfDisposed(),tL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.any=function(t,e){return this.throwIfDisposed(),Hw(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.argMax=function(t){return this.throwIfDisposed(),Nd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.argMin=function(t){return this.throwIfDisposed(),xZ(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asScalar=function(){return this.throwIfDisposed(),R(this.size===1,()=>"The array must have only 1 element."),G(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asType=function(t){return this.throwIfDisposed(),_e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as1D=function(){return this.throwIfDisposed(),G(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as2D=function(t,e){return this.throwIfDisposed(),G(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),G(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),G(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.as5D=function(t,e,n,s,i){return this.throwIfDisposed(),G(this,[t,e,n,s,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asin=function(){return this.throwIfDisposed(),wZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.asinh=function(){return this.throwIfDisposed(),CZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.atan=function(){return this.throwIfDisposed(),kZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.atan2=function(t){return this.throwIfDisposed(),TZ(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.atanh=function(){return this.throwIfDisposed(),NZ(this)};ie().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),jC(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),GC(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.batchNorm=function(t,e,n,s,i){return this.throwIfDisposed(),Yv(this,t,e,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Yh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cast=function(t){return this.throwIfDisposed(),_e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.ceil=function(){return this.throwIfDisposed(),n7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof an&&(t=[t]),ds([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.conv1d=function(t,e,n,s,i,r){return this.throwIfDisposed(),nL(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.conv2dTranspose=function(t,e,n,s,i){return this.throwIfDisposed(),sL(this,t,e,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.conv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),kl(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cos=function(){return this.throwIfDisposed(),qC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cosh=function(){return this.throwIfDisposed(),rL(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),Kw(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),oL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),T7(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.depthwiseConv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),KC(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.dilation2d=function(t,e,n,s,i){return this.throwIfDisposed(),$7(this,t,e,n,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.divNoNan=function(t){return this.throwIfDisposed(),O7(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.div=function(t){return this.throwIfDisposed(),Re(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.dot=function(t){return this.throwIfDisposed(),F7(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.elu=function(){return this.throwIfDisposed(),Jv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.equal=function(t){return this.throwIfDisposed(),Er(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.erf=function(){return this.throwIfDisposed(),aL(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),X7(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.exp=function(){return this.throwIfDisposed(),Nr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.expandDims=function(t){return this.throwIfDisposed(),cs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.expm1=function(){return this.throwIfDisposed(),J7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.fft=function(){return this.throwIfDisposed(),SL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.flatten=function(){return this.throwIfDisposed(),G(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.floor=function(){return this.throwIfDisposed(),tx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.floorDiv=function(t){return this.throwIfDisposed(),eL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.gather=function(t,e,n){return this.throwIfDisposed(),ZC(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Hl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.greater=function(t){return this.throwIfDisposed(),Zs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.ifft=function(){return this.throwIfDisposed(),Xw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.irfft=function(){return this.throwIfDisposed(),jY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.isFinite=function(){return this.throwIfDisposed(),l9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.isInf=function(){return this.throwIfDisposed(),u9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.isNaN=function(){return this.throwIfDisposed(),d9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.leakyRelu=function(t){return this.throwIfDisposed(),QC(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.lessEqual=function(t){return this.throwIfDisposed(),Du(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.less=function(t){return this.throwIfDisposed(),Bg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),y9(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logSigmoid=function(){return this.throwIfDisposed(),I9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logSoftmax=function(t){return this.throwIfDisposed(),dL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),fL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.log=function(){return this.throwIfDisposed(),$r(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.log1p=function(){return this.throwIfDisposed(),hL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalAnd=function(t){return this.throwIfDisposed(),oo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalNot=function(){return this.throwIfDisposed(),JC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalOr=function(t){return this.throwIfDisposed(),pL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.logicalXor=function(t){return this.throwIfDisposed(),A9(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),lt(this,t,e,n)};ie().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),eI(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.max=function(t,e){return this.throwIfDisposed(),Hi(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.maximum=function(t){return this.throwIfDisposed(),wa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mean=function(t,e){return this.throwIfDisposed(),nn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.min=function(t,e){return this.throwIfDisposed(),zg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.minimum=function(t){return this.throwIfDisposed(),Ad(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),B9(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mod=function(t){return this.throwIfDisposed(),W9(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.mul=function(t){return this.throwIfDisposed(),U(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.neg=function(){return this.throwIfDisposed(),Kt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.norm=function(t,e,n){return this.throwIfDisposed(),ex(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.notEqual=function(t){return this.throwIfDisposed(),Ug(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),mL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.onesLike=function(){return this.throwIfDisposed(),wi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.pad=function(t,e){return this.throwIfDisposed(),nI(this,t,e)};ie().prototype.pool=function(t,e,n,s,i,r){return this.throwIfDisposed(),Q9(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.pow=function(t){return this.throwIfDisposed(),Sl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.prelu=function(t){return this.throwIfDisposed(),iI(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.prod=function(t,e){return this.throwIfDisposed(),tY(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reciprocal=function(){return this.throwIfDisposed(),IY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.relu=function(){return this.throwIfDisposed(),Kl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.relu6=function(){return this.throwIfDisposed(),vL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reshapeAs=function(t){return this.throwIfDisposed(),G(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reshape=function(t){return this.throwIfDisposed(),G(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),RL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),AL(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.reverse=function(t){return this.throwIfDisposed(),Tl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.rfft=function(){return this.throwIfDisposed(),qY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.round=function(){return this.throwIfDisposed(),xL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.rsqrt=function(){return this.throwIfDisposed(),_L(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.selu=function(){return this.throwIfDisposed(),wL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.separableConv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),bL(this,t,e,n,s,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sigmoid=function(){return this.throwIfDisposed(),Au(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sign=function(){return this.throwIfDisposed(),DY(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sin=function(){return this.throwIfDisposed(),CL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sinh=function(){return this.throwIfDisposed(),IL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.slice=function(t,e){return this.throwIfDisposed(),Ct(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.softmax=function(t){return this.throwIfDisposed(),pI(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.softplus=function(){return this.throwIfDisposed(),ip(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),sI(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.split=function(t,e){return this.throwIfDisposed(),Gs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sqrt=function(){return this.throwIfDisposed(),jn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.square=function(){return this.throwIfDisposed(),Et(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.squaredDifference=function(t){return this.throwIfDisposed(),XY(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.squeeze=function(t){return this.throwIfDisposed(),op(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof an?[this,t]:[this,...t];return ao(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.step=function(t){return this.throwIfDisposed(),ap(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.stridedSlice=function(t,e,n,s,i,r,o,a){return this.throwIfDisposed(),eQ(this,t,e,n,s,i,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sub=function(t){return this.throwIfDisposed(),Ae(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.sum=function(t,e){return this.throwIfDisposed(),$e(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.tan=function(){return this.throwIfDisposed(),nQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.tanh=function(){return this.throwIfDisposed(),Zv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.tile=function(t){return this.throwIfDisposed(),Bi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.toBool=function(){return this.throwIfDisposed(),_e(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.toFloat=function(){return this.throwIfDisposed(),_e(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.toInt=function(){return this.throwIfDisposed(),_e(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.topk=function(t,e){return this.throwIfDisposed(),oQ(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.transpose=function(t){return this.throwIfDisposed(),Je(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.unique=function(t){return this.throwIfDisposed(),cQ(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),NL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.unstack=function(t){return this.throwIfDisposed(),El(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.where=function(t,e){return this.throwIfDisposed(),ns(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ie().prototype.zerosLike=function(){return this.throwIfDisposed(),et(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,dr.prototype)}}class pi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pi.prototype)}}class B extends Error{constructor(e){super(e),Object.setPrototypeOf(this,B.prototype)}}class Ue extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ue.prototype)}}class YI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,YI.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bF{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nl(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function fr(t,e){if(!t)throw new YI(e)}function l2(t,e){let n=0;for(const s of t)s===e&&n++;return n}function us(t){return t.length===1?t[0]:t}function pt(t){return Array.isArray(t)?t:[t]}function Wr(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Ha(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let si={};function QI(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function Qw(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>Qw(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:Qw(s))}}}function hp(t,e={},n={},s="object",i=!1){if(typeof t=="string"){const r=t;let o;if(r in n)o=n[r];else if(r in si)o=si[r];else if(o=e[r],o==null)throw new B(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const r=t;if(r.className==null||r.config==null)throw new B(`${s}: Improper config format: ${JSON.stringify(r)}.
'className' and 'config' must set.`);const o=r.className;let a,l;if(o in n?[a,l]=n[o]:o in si?[a,l]=si.className:o in e&&([a,l]=e[o]),a==null)throw new B(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const m of Object.keys(si))c[m]=si[m];for(const m of Object.keys(n))c[m]=n[m];const h=r.config;h.customObjects=c;const d=Object.assign({},si);for(const m of Object.keys(n))si[m]=n[m];Qw(r.config);const f=l(a,r.config,n,i);return si=Object.assign({},d),f}else{const c=Object.assign({},si);for(const d of Object.keys(n))si[d]=n[d];const h=new a(r.config);return si=Object.assign({},c),h}}}function Bte(t,e){return t<e?-1:t>e?1:0}function mm(t,e){return-1*Bte(t,e)}function Zo(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function Ute(t){if(t==null)throw new B(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Zl(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new B(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function JI(t,e,n=0,s=1/0){return fr(n>=0),fr(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(i=>typeof i===e)}function Cn(t,e){Array.isArray(t)?(R(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Cn(n,`element ${s+1} of ${e}`))):R(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${CF(t)}.`)}function CF(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>CF(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function Wte(t,e,n){let s=n!=null?n():ls(),i;return(...o)=>{const a=n!=null?n():ls();return a-s<e||(s=a,i=t(...o)),i}}function IF(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Vte=0;function kF(){return Vte++}const gm={};function ox(t=""){return t in gm||(gm[t]=0),gm[t]+=1,t+gm[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jte=["channelsFirst","channelsLast"],Gte=["nearest","bilinear"],Hte=["valid","same","causal"],qte=["max","avg"],Kte=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mc=new Map;function Yt(t){Zl(jte,"DataFormat",t)}function Xte(t){Zl(Gte,"InterpolationFormat",t)}function Ys(t){Zl(Hte,"PaddingMode",t)}function SF(t){Zl(qte,"PoolMode",t)}const Qh=[],c2="/";function ol(t,e){Qh.push(t);try{const n=e();return Qh.pop(),n}catch(n){throw Qh.pop(),n}}function Zte(){return Qh.length===0?"":Qh.join(c2)+c2}function TF(t){if(!NF(t))throw new Error("Not a valid tensor name: '"+t+"'");return Zte()+t}function EF(t){if(!NF(t))throw new Error("Not a valid tensor name: '"+t+"'");mc.has(t)||mc.set(t,0);const e=mc.get(t);if(mc.set(t,mc.get(t)+1),e>0){const n=`${t}_${e}`;return mc.set(n,1),n}else return t}const Yte=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function NF(t){return!!t.match(Yte)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qte(t){return t===parseInt(t.toString(),10)}function Yo(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let i=e;i<n;++i)s*=t[i];return s}function du(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function na(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Qi(t,e){if(e<t)throw new B(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Z_;function cn(){return Z_==null&&(Z_=kX().epsilon()),Z_}function Ji(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ir(t,e){return _e(t,e)}function dp(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),G(t,n)}function Jte(t,e){return Q(()=>{if(t.shape.length!==2)throw new B(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=dp(t,1);return Jw(n,[1,e,1])})}function ene(t){const e=[Yo(t.shape)];return G(t,e)}function tne(t){if(t.rank<=1)throw new B(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Yo(t.shape,1)];return G(t,e)}function al(t,e,n){return Q(()=>{switch(t.rank){case 1:return dI(t,e,n);case 2:return kL(t,[e,0],[n,t.shape[1]]);case 3:return fI(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Vg(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Ct(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Ct(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new B(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Y_(t,e,n){return Q(()=>{switch(t.rank){case 1:return dI(t,e,n);case 2:return kL(t,[0,e],[t.shape[0],n]);case 3:return fI(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Vg(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new B(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function ym(t,e,n,s){return Q(()=>{switch(t.rank){case 1:return dI(t,e,n);case 2:switch(s){case 1:return al(t,e,n);case 2:return Y_(t,e,n);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return al(t,e,n);case 2:return fI(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Y_(t,e,n);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return al(t,e,n);case 2:return Vg(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Vg(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Y_(t,e,n);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}default:throw new B(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function ek(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),ds(t,e)}function u2(t,e){switch(t.rank){case 1:return r7([t,e]);case 2:return a7([t,e],0);case 3:return c7([t,e],0);case 4:return h7([t,e],0);default:throw new B(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Jw(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new B(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Bi(t,e)}function ax(t,e=0,n=1,s,i){return _Y(t,e,n,s,i)}function kr(t,e,n,s){if(t.rank<2||e.rank<2)throw new Ue(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const i=t.shape.slice(-1)[0],r=e.shape.slice(-2)[0];if(i!==r)throw new Ue(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return KN({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?eb(t.rank,s,Ji()):null,activation:n});{const i=t.shape.slice(),r=i.pop();t=G(t,[-1,r]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],h=Array.from({length:e.rank},(g,x)=>x===0?e.rank-2:x<=e.rank-2?x-1:x);e=G(Je(e,h),[l,-1]);const d=[...i,...c];return G(KN({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?eb(t.rank,s,Ji()):null,activation:n}),d)}}function $F(t,e,n){return Q(()=>(Array.isArray(e)?e=ks(e,"int32"):e=_e(e,"int32"),ZC(t,e,n)))}function fp(t){return U(t,t)}function eb(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new B(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?G(e,[1,s[0],1,1,1]):G(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?G(e,[1,1,1,1,s[0]]):G(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?G(e,[1,s[0],1,1]):G(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?G(e,[1,1,1,s[0]]):G(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?G(e,[1,s[0],1]):G(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?G(e,[1,1,s[0]]):G(e,[1].concat(s))}else if(t<3)return e;throw new B(`Unsupported input rank by biasAdd: ${e.rank}`)}function nr(t,e,n){return Q(()=>(n==null&&(n=Ji()),Yt(n),pe(t,eb(t.rank,e,n))))}function nne(t,e=1){if(e!==1)throw new Ue(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Jv(t)}function sne(t){return Q(()=>Re(t,pe(Yn(t),1)))}function RF(t,e,n,s){return Q(()=>gQ(t,e,n,s))}function ine(t){return Q(()=>{const e=pe(.5,U(.2,t));return qs(e,0,1)})}function pp(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rne=["fanIn","fanOut","fanAvg"],one=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ane(t){Zl(rne,"FanMode",t)}function lne(t){Zl(one,"Distribution",t)}class Ci extends Ou{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class AF extends Ci{apply(e,n){return _n(e,n)}}AF.className="Zeros";de(AF);class tk extends Ci{apply(e,n){return ba(e,n)}}tk.className="Ones";de(tk);class DF extends Ci{constructor(e){if(super(),typeof e!="object")throw new B(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new B(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return Q(()=>U(rt(this.value),ba(e,n)))}getConfig(){return{value:this.value}}}DF.className="Constant";de(DF);class PF extends Ci{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return rp(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}PF.className="RandomUniform";de(PF);class OF extends Ci{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ue(`randomNormal does not support dType ${n}.`);return ax(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}OF.className="RandomNormal";de(OF);class LF extends Ci{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ue(`truncatedNormal does not support dType ${n}.`);return EL(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}LF.className="TruncatedNormal";de(LF);class FF extends Ci{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return Q(()=>{if(e.length!==2||e[0]!==e[1])throw new B("Identity matrix initializer can only be used for 2D square matrices.");return U(this.gain,uL(e[0]))})}getConfig(){return{gain:this.gain}}}FF.className="Identity";de(FF);function cne(t,e="channelsLast"){let n,s;if(Yt(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const i=Yo(t,2);n=t[1]*i,s=t[0]*i}else if(e==="channelsLast"){const i=Yo(t,0,t.length-2);n=t[t.length-2]*i,s=t[t.length-1]*i}}else{const i=Yo(t);n=Math.sqrt(i),s=Math.sqrt(i)}return[n,s]}class Ps extends Ci{constructor(e){if(super(),e.scale<0)throw new B(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,ane(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,lne(this.distribution),this.seed=e.seed}apply(e,n){const s=cne(e),i=s[0],r=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,r):o/=Math.max(1,(i+r)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ue(`${this.getClassName()} does not support dType ${n}.`);return EL(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return rp(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ps.className="VarianceScaling";de(Ps);class nk extends Ps{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}nk.className="GlorotUniform";de(nk);class sk extends Ps{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}sk.className="GlorotNormal";de(sk);class ik extends Ps{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}ik.className="HeNormal";de(ik);class rk extends Ps{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}rk.className="HeUniform";de(rk);class ok extends Ps{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}ok.className="LeCunNormal";de(ok);class ak extends Ps{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ps.className}}ak.className="LeCunUniform";de(ak);class MF extends Ci{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return Q(()=>{if(e.length<2)throw new Ue("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=re(e.slice(0,-1)),i=e[e.length-1],r=s*i;r>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${r}) elements: Slowness may result.`);const o=[Math.max(i,s),Math.min(i,s)],a=ax(o,0,1,n,this.seed),l=dJ.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(i,s)*Math.min(i,s)],[Math.min(i,s)+1]);return c=U(c,d.sign()),s<i&&(c=c.transpose()),U(rt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}MF.className="Orthogonal";de(MF);const h2={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function d2(t,e={}){return hp(t,ci.getMap().classNameMap,e,"initializer")}function Mt(t){return QI(t)}function Ot(t){if(typeof t=="string"){const e=t in h2?h2[t]:t;if(e==="GlorotNormal")return new sk;if(e==="GlorotUniform")return new nk;if(e==="HeNormal")return new ik;if(e==="HeUniform")return new rk;if(e==="LeCunNormal")return new ok;if(e==="LeCunUniform")return new ak;{const n={};return n.className=e,n.config={},d2(n)}}else return t instanceof Ci?t:d2(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tb(t){return Array.isArray(t)&&Array.isArray(t[0])}function jg(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function De(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new B(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function st(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new B(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gg(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,i)=>s*i);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const f2="Variable";class une{constructor(e,n="float32",s=f2,i=!0,r=null){this.dtype=n??"float32",this.shape=e.shape,this.id=kF(),s=s??f2,this.originalName=TF(s),this.name=EF(this.originalName),this.trainable_=i,this.constraint=r,this.val=dQ(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),hne(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function hne(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function nb(t){return t.map(e=>e.read())}function lk(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class un{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Rr{constructor(e,n,s,i,r,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=kF(),o!=null&&(this.originalName=TF(o),this.name=EF(this.originalName)),this.rank=n.length}}let dne=0;class lx{constructor(e,n){this.callArgs=n,this.id=dne++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let fne=0;class He extends Ou{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=fne++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Wr(s)+"_"+ox(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),s=[r].concat(e.inputShape)}this.batchInputShape=s;let i=e.dtype;i==null&&(i=e.inputDType),i==null&&(i="float32"),this.dtype=i}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new pi(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new B(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return us(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return us(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new dr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new dr(`Layer ${this.name} is not connected, no input to return.`);return us(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new dr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new dr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return us(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=pt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=pt(this.inputSpec);if(n.length!==s.length)throw new B(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let i=0;i<n.length;i++){const r=n[i],o=s[i];if(o==null)continue;const a=r.rank;if(o.ndim!=null&&a!==o.ndim)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&r.dtype!==o.dtype)throw new B(`Input ${i} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${r.dtype}.`);if(o.axes){const l=r.shape;for(const c in o.axes){const h=Number(c),d=o.axes[c],f=h>=0?l[h]:l[l.length+h];if(d!=null&&[d,null].indexOf(f)===-1)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${d} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const c=o.shape[l],h=r.shape[l];if(c!=null&&h!=null&&c!==h)throw new B(`Input ${i} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${r.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=pt(e),i=gne(e),r=yne(e);if(i===r)throw new B("Arguments to apply() must be all SymbolicTensors or all Tensors");return ol(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of pt(e))o.push(a.shape);this.build(us(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=pt(o),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=us(l),this.activityRegularizer!=null)throw new Ue("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=pne(e),a=this.computeOutputShape(o);let l;const c=mne(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((h,d)=>new Rr(c,h,this,pt(e),n,this.name,d)):l=new Rr(c,a,this,pt(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new Ue("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,i)=>{s!=null&&e[i]!=null&&e[i]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new dr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new dr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new pi(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Gg(this.weights)}build(e){this.built=!0}getWeights(e=!1){return nb(e?this.trainableWeights:this.weights)}setWeights(e){Q(()=>{const n=this.weights;if(n.length!==e.length)throw new B(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],i=nb(n);for(let r=0;r<i.length;++r){const o=i[r],a=n[r],l=e[r];if(!ct(o.shape,l.shape))throw new B(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}lk(s)})}addWeight(e,n,s,i,r,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new B(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(i=l!=null?l():Ot("zeros"));const c=i.apply(n,s),h=new une(c,s,e,o,a);return c.dispose(),r!=null&&this.addLoss(()=>r.apply(h.read())),o==null&&(o=!0),o?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=pt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const i=this.computeMask(e,s),r=pt(n),o=pt(i);if(r.length!==o.length)throw new Error(`${this.name} outputs ${r.length} tensors but ${r.length} masks for those tensors`);for(let a=0;a<r.length;a++)r[a].kerasMask=o[a]}addInboundNode(e,n,s,i,r,o,a=null){const l=pt(e);n=pt(n),s=pt(s),i=pt(i),r=jg(r),o=jg(o);const c=[],h=[],d=[];for(const f of l)c.push(f.sourceLayer),h.push(f.nodeIndex),d.push(f.tensorIndex);new lx({outboundLayer:this,inboundLayers:c,nodeIndices:h,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:i,inputShapes:r,outputShapes:o},a);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function pne(t){t=pt(t);const e=[];for(const n of t)e.push(n.shape);return us(e)}function mne(t){return"float32"}function zF(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const i=[];for(let r=0;r<s.inboundLayers.length;r++){const o=s.inputTensors[r],a=s.inboundLayers[r],l=s.nodeIndices[r],c=zF(o,a,l);for(const h of c)i.indexOf(h)===-1&&i.push(h)}return i}}}function gne(t){let e=!0;for(const n of pt(t))if(!(n instanceof Rr)){e=!1;break}return e}function yne(t){let e=!0;for(const n of pt(t))if(n instanceof Rr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mp extends He{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:ox("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new B("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new B("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new B("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const i=new Rr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new lx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new B(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}mp.className="InputLayer";de(mp);function vne(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new B("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new mp({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xne(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return _e(e,t.dtype)}catch{throw new B(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class Oo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Oo)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=xne(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new B(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Rr){if(this.id2Value[e.id]==null)throw new B(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new B(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Rr){if(this.id2Value[e.id]==null)throw new B(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new B(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&We(this.id2Mask)}}const Hg=new bF,qg=new bF;function _ne(t){Hg!=null&&Hg.setMaxEntries(t),qg!=null&&qg.setMaxEntries(t)}function Oh(t,e,n,s){const i=n==null?!1:n.training,r=Array.isArray(t),o=r?t:[t],a=o.map(g=>g.name),l=[],c=e.names();for(const g of a)c.indexOf(g)!==-1?l.push(e.getValue(g)):l.push(null);const h=a.join(",")+"|"+e.names().sort().join(",");let d=Hg.get(h),f;if(d==null){const g=wne(o,e);d=g.sorted,f=g.recipientCounts,Hg.put(h,d),qg.put(h,f)}f={},i||Object.assign(f,qg.get(h));const m=new Oo(e);for(let g=0;g<d.length;++g){const x=d[g],_=x.sourceLayer;if(_ instanceof mp)continue;const v=[],w=[],b=[];let I=!1;for(const D of x.inputs){const P=m.getValue(D),z=m.getMask(D);v.push(P),w.push(z),z!=null&&(I=!0),i||(f[D.name]--,f[D.name]===0&&!e.hasKey(D)&&a.indexOf(D.name)===-1&&!P.isDisposed&&D.sourceLayer.stateful!==!0&&b.push(P))}I&&(n=n||{},n.mask=w[0]);const S=pt(_.apply(v,n));let T=null;_.supportsMasking&&(T=_.computeMask(v,w));const $=Cne(x),E=Array.isArray($)?$:[$];for(let D=0;D<E.length;++D){m.hasKey(E[D])||m.add(E[D],S[D],Array.isArray(T)?T[0]:T);const P=a.indexOf(E[D].name);P!==-1&&(l[P]=S[D])}i||We(b)}return m.disposeMasks(),r?l:l[0]}function wne(t,e){R(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const i=p2(t[0],e);n=i.sorted,s=i.recipientMap}else{const i=new Set;for(const r of t){const{sorted:o,recipientMap:a}=p2(r,e);for(const l of o)i.has(l.name)||(n.push(l),i.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:n,recipientCounts:bne(s)}}function bne(t){const e={};for(const n in t)e[n]=t[n].size;return e}function p2(t,e){const n=new Set,s=[],i={};for(const a of e.names())n.add(a);const r=[],o=[];for(r.push(t);r.length>0;){const a=r[r.length-1];if(n.has(a.name)){r.pop();continue}const l=o[o.length-1]===r.length-1;if(a.inputs.length===0||l)r.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(r.length-1);for(const c of a.inputs)i[c.name]==null&&(i[c.name]=new Set),i[c.name].add(a.name),!n.has(c.name)&&r.push(c)}}return{sorted:s,recipientMap:i}}function Cne(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const i of t.sourceLayer.inboundNodes[s].outputTensors)if(i.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ine=ee();Ine.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,_ne);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ck(t,e){return Q(()=>jn($e(U(t,t),e,!0)))}class gp extends Ou{getConfig(){return{}}}class BF extends gp{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Q(()=>{const n=ck(e,this.axis),s=qs(n,0,this.maxValue);return U(e,Re(s,pe(cn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}BF.className="MaxNorm";de(BF);class UF extends gp{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Q(()=>Re(e,pe(cn(),ck(e,this.axis))))}getConfig(){return{axis:this.axis}}}UF.className="UnitNorm";de(UF);class WF extends gp{apply(e){return Kl(e)}}WF.className="NonNeg";de(WF);class VF extends gp{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Q(()=>{const n=ck(e,this.axis),s=pe(U(this.rate,qs(n,this.minValue,this.maxValue)),U(1-this.rate,n));return U(e,Re(s,pe(cn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}VF.className="MinMaxNorm";de(VF);const m2={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function dn(t){return QI(t)}function g2(t,e={}){return hp(t,ci.getMap().classNameMap,e,"constraint")}function fn(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in m2?m2[t]:t,config:{}};return g2(n)}else return t instanceof gp?t:g2(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function La(t){if(t==null)return;const e=[],n=[],s=[];for(const i in t){const r=t[i];if(typeof r!="number"){const o=r;e.push(o.data()),n.push(i),s.push(o)}}if(e.length>0){const i=await Promise.all(e);for(let r=0;r<i.length;++r)t[n[r]]=i[r][0];We(s)}}function jF(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var y2;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(y2||(y2={}));const kne=125;class Pd{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class Sne{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class Tne extends Pd{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const i in n){const r=n[i];if(typeof r=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+r*s;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=Q(()=>pe(this.totals[i],U(r,s)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:Q(()=>{const i=U(Re(1,this.seen),this.totals[s]);n[s]=i,this.totals[s].dispose(),br(n[s])}))}}class Ene extends Pd{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const r in this.history){const o=this.history[r];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(r),s.push(a)}}const i=await Promise.all(e);for(let r=0;r<i.length;++r)this.history[n[r]][s[r]].dispose(),this.history[n[r]][s[r]]=i[r][0]}}class Nne extends Pd{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||XL,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=kne),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Nw(this.yieldEvery)&&(this.maybeWait=Wte(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const i=[];this.yield!=null&&(await La(s),i.push(this.yield(e,n,s))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await La(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await La(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await La(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await La(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Nw(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await La(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await La(e),await this.trainEnd(e))}}function GF(t,e){return t==null&&(t={}),t instanceof Pd?[t]:Array.isArray(t)&&t[0]instanceof Pd?t:pt(t).map(s=>new Nne(s,e))}class ri{constructor(){}static registerCallbackConstructor(e,n){R(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ri.checkForDuplicate(n),ri.constructors[e]==null&&(ri.constructors[e]=[]),ri.constructors[e].push(n)}static checkForDuplicate(e){for(const n in ri.constructors)ri.constructors[+n].forEach(i=>{if(i===e)throw new B("Duplicate callback constructor.")})}static clear(){ri.constructors={}}static createCallbacks(e){const n=[];for(const s in ri.constructors){const i=+s;e>=i&&n.push(...ri.constructors[i])}return n.map(s=>new s)}}ri.constructors={};function HF(t,e,n,s,i,r,o,a,l){const c=new Ene,h=[new Tne,...ri.createCallbacks(e)];t!=null&&h.push(...t),h.push(c);const d=new Sne(h);return d.setParams({epochs:n,initialEpoch:s,samples:i,steps:r,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sr(t,e={},n=!1){return hp(t,ci.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kg(t,e){return Q(()=>{t.dtype!=="float32"&&(t=_e(t,"float32"));const n=$e(fp(t),e,!0),s=Qv(n.shape,cn()),i=jn(wa(n,s));return Re(t,i)})}function cx(t,e){return Q(()=>nn(fp(Ae(e,t)),-1))}function uk(t,e){return Q(()=>nn(Yn(Ae(e,t)),-1))}function hk(t,e){return Q(()=>{const n=Ae(t,e),s=qs(Yn(t),cn(),Number.MAX_VALUE),i=Yn(Re(n,s));return U(100,nn(i,-1))})}function $ne(t,e){return Q(()=>{const n=qs(e,cn(),Number.MAX_VALUE),s=$r(pe(1,n)),i=qs(t,cn(),Number.MAX_VALUE),r=$r(pe(1,i));return nn(fp(Ae(s,r)),-1)})}function Rne(t,e){return Q(()=>{const n=wa(0,Ae(1,U(t,e)));return nn(fp(n),-1)})}function Ane(t,e){return Q(()=>{const n=wa(0,Ae(1,U(t,e)));return nn(n,-1)})}function Dne(t,e){return Q(()=>{const n=$e(U(t,e),-1),s=Hi(U(Ae(1,t),e),-1);return wa(0,pe(1,Ae(s,n)))})}function Pne(t,e){return Q(()=>{const n=Math.log(2),s=Ae(e,t),i=Ae(pe(s,ip(U(-2,s))),n);return nn(i,-1)})}function Od(t,e,n=!1){return Q(()=>{if(n)e=pI(e);else{const s=$e(e,e.shape.length-1,!0);e=Re(e,s)}return e=qs(e,cn(),1-cn()),Kt($e(U(_e(t,"float32"),$r(e)),e.shape.length-1))})}function Xg(t,e,n=!1){return Q(()=>{const s=_e(tx(ene(t)),"int32");e=qs(e,cn(),1-cn());const i=e.shape,r=G(mL(s,i[i.length-1]),i);return Od(r,e,n)})}function One(t,e){if(!ct(t.shape,e.shape))throw new B(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Q(()=>{const n=Kl(e),s=Kt(Yn(e));return pe(Ae(n,U(e,t)),hL(Nr(s)))})}function ux(t,e){return Q(()=>{let n;return n=qs(e,cn(),1-cn()),n=$r(Re(n,Ae(1,n))),nn(One(t,n),-1)})}function Lne(t,e){return Q(()=>{const n=qs(t,cn(),1),s=qs(e,cn(),1);return $e(U(t,$r(Re(n,s))),-1)})}function Fne(t,e){return Q(()=>{const n=$r(pe(cn(),e));return nn(Ae(e,U(t,n)),-1)})}function qF(t,e){return Q(()=>{const n=Kg(t,-1),s=Kg(e,-1),i=U(n,s);return Kt($e(i,-1))})}const Zg={meanSquaredError:cx,meanAbsoluteError:uk,meanAbsolutePercentageError:hk,meanSquaredLogarithmicError:$ne,squaredHinge:Rne,hinge:Ane,categoricalHinge:Dne,logcosh:Pne,categoricalCrossentropy:Od,sparseCategoricalCrossentropy:Xg,binaryCrossentropy:ux,kullbackLeiblerDivergence:Lne,poisson:Fne,cosineProximity:qF};function Q_(t){if(typeof t=="string"){if(t in Zg)return Zg[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new B(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KF(t,e){return Q(()=>{const n=U(.5,wi(e)),s=Ir(Zs(e,n),t.dtype);return nn(Er(t,s),-1)})}function XF(t,e){return Q(()=>Ir(Er(Nd(t,-1),Nd(e,-1)),"float32"))}function Mne(t,e){return Q(()=>_e($e(oo(Er(t,1),Er(e,1))),"float32"))}function zne(t,e){return Q(()=>_e($e(oo(Er(t,0),Er(e,1))),"float32"))}function Bne(t,e){return Q(()=>{const n=Mne(t,e),s=zne(t,e),i=pe(n,s);return _e(ns(Zs(i,0),Re(n,i),0),"float32")})}function Une(t,e){return ux(t,e)}function Wne(t,e){return t.rank===e.rank&&(t=op(t,[t.rank-1])),e=Nd(e,-1),e.dtype!==t.dtype&&(e=_e(e,t.dtype)),_e(Er(t,e),"float32")}const Vne=cx,jne=cx,Gne=uk,Hne=uk,qne=hk,Kne=hk,ZF=Od,Xne=qF,YF=Xg,Yg={binaryAccuracy:KF,categoricalAccuracy:XF,precision:Bne,categoricalCrossentropy:ZF,sparseCategoricalCrossentropy:YF,mse:Vne,MSE:jne,mae:Gne,MAE:Hne,mape:qne,MAPE:Kne,cosine:Xne};function Zne(t){if(typeof t=="string"&&t in Yg)return Yg[t];if(typeof t!="string"&&t!=null)return t;throw new B(`Unknown metric ${t}`)}function vm(t){if(fr(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Zg))if(Zg[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Yg))if(Yg[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yne(t){const e={Adagrad:()=>Va.adagrad(.01),Adadelta:()=>Va.adadelta(1,.95,cn()),Adam:()=>Va.adam(.001,.9,.999,cn()),Adamax:()=>Va.adamax(.002,.9,.999,cn(),0),RMSProp:()=>Va.rmsprop(.001,.9,0,cn()),SGD:()=>Va.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new B(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const v2=1*1024*1024;function x2(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!sb(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>v2&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${v2}.`)}}function sb(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!sb(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!sb(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qne(t,e,n,s=console.log){const i=ese(t),r=["Layer (type)","Input Shape","Output shape","Param #"];i?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(h=>Math.floor(e*h)));let o;if(!i){r.push("Receives inputs"),o=[];for(const h in t.nodesByDepth)o.push(...t.nodesByDepth[h])}s("_".repeat(e)),Qg(r,n,s),s("=".repeat(e));const a=t.layers;for(let h=0;h<a.length;++h)i?tse(a[h],n,s):nse(a[h],n,o,s),s((h===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=Jne(t),c=Gg(t.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function Jne(t){let e;return t.collectedTrainableWeights!=null?e=Gg(t.collectedTrainableWeights):e=Gg(t.trainableWeights),e}function ese(t){let e=!0;const n=[],s=[];for(const i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){e=!1;break}s.push(...i)}if(e)for(const i of t.layers){let r=!1;for(const o of i.inboundNodes)if(s.indexOf(o)!==-1)if(r){e=!1;break}else r=!0;if(!e)break}return e}function Qg(t,e,n=console.log){let s="";for(let i=0;i<t.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=t[i],s=s.slice(0,e[i]),s+=" ".repeat(e[i]-s.length);n(s)}function tse(t,e,n){let s,i;try{i=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const r=t.name,o=t.getClassName(),a=[`${r} (${o})`,i,s,t.countParams().toString()];Qg(a,e,n)}function nse(t,e,n,s){let i,r;try{r=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{r="multiple"}try{i=JSON.stringify(t.outputShape)}catch{i="multiple"}const o=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let f=0;f<d.inboundLayers.length;++f){const m=d.inboundLayers[f].name,g=d.nodeIndices[f],x=d.tensorIndices[f];o.push(`${m}[${g}][${x}]`)}const a=t.name,l=t.getClassName(),c=o.length===0?"":o[0],h=[`${a} (${l})`,r,i,t.countParams().toString(),c];Qg(h,e,s);for(let d=1;d<o.length;++d)Qg(["","","","",o[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QF(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Jg(t,e){if(t===null)return null;if(typeof t=="string")return Ha(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let i=0;i<s;++i){const r=t[i];QF(e,i,r)?n.push(r):n.push(Jg(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const i=t[s];if(s==="name"&&typeof i=="string")n[s]=i;else{const r=Ha(s);n[r]=Jg(i,r)}}return n}}function ib(t,e){if(t==null)return null;if(typeof t=="string")return Wr(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let i=0;i<s;++i){const r=t[i];QF(e,i,r)?n.push(r):n.push(ib(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const i=t[s],r=Wr(s);(s==="name"||s==="className")&&typeof i=="string"?n[r]=i:n[r]=ib(i,s)}return n}}/** @license See the LICENSE file. */const JF="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const sse=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Di extends He{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=ox(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Zo(this.inputs).length!==this.inputs.length)throw new B(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);Zo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const b=w.sourceLayer,I=w.nodeIndex,S=w.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(I),this.outputLayersTensorIndices.push(S)}for(const w of this.inputs){const b=w.sourceLayer,I=w.nodeIndex,S=w.tensorIndex;fr(I===0,"input layer has >1 nodes"),fr(S===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(I),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const b=this.inputLayers[w];if(!(b instanceof mp))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const n={},s={},i={},r={},o={},a=[],l=(w,b,I,S,T,$)=>{(S==null||T==null||$==null)&&(S=w.sourceLayer,T=w.nodeIndex,$=w.tensorIndex);const E=S.inboundNodes[T];if(I.indexOf(E)!==-1)throw new pi(`The tensor ${w.name} at layer "${S.name}" is part of a cycle.`);if(b.indexOf(E)!==-1)return;this.containerNodes.add(Di.nodeKey(S,T)),S.id in o||(o[S.id]=Object.keys(o).length),I.indexOf(E)===-1&&I.push(E);const D=E.inboundLayers.length;for(let P=0;P<D;P++){const z=E.inputTensors[P],V=E.inboundLayers[P],q=E.nodeIndices[P],K=E.tensorIndices[P];l(z,b,I,V,q,K)}for(b.push(E);I.indexOf(E)>=0;)I.splice(I.indexOf(E),1);a.push(E)},c=[],h=[];for(const w of this.outputs)l(w,c,h);const d=a.slice().reverse();for(const w of d){s[w.id]=w,w.id in n||(n[w.id]=0);let b=n[w.id];const I=i[w.outboundLayer.id]==null?0:i[w.outboundLayer.id];b=Math.max(b,I),i[w.outboundLayer.id]=b,r[w.outboundLayer.id]=w.outboundLayer,n[w.id]=b;for(let S=0;S<w.inboundLayers.length;S++){const T=w.inboundLayers[S],$=w.nodeIndices[S],E=T.inboundNodes[$],D=n[E.id]==null?0:n[E.id];n[E.id]=Math.max(b+1,D),s[E.id]=E}}const f={};for(const w in n){const b=n[w];b in f||(f[b]=[]),f[b].push(s[w])}const m={};for(const w in i){const b=i[w];b in m||(m[b]=[]),m[b].push(r[w])}let g=Object.keys(m).map(w=>parseInt(w,10)).sort(mm);this.layers=[];for(const w of g){const b=m[w];b.sort((I,S)=>{const T=o[I.id],$=o[S.id];return T<$?-1:T>$?1:0});for(const I of b)I instanceof Di&&this.internalContainerRefs.push(I),this.layers.push(I)}this.layersByDepth=m,g=Object.keys(f).map(w=>parseInt(w,10)).sort(mm);const x=this.inputs.slice(),_=[];for(const w of g)for(const b of f[w]){const I=b.outboundLayer;if(I!=null){for(const S of b.inputTensors)if(x.indexOf(S)===-1)throw new pi(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${I.name}". The following previous layers were accessed without issue: ${_}`);for(const S of b.outputTensors)x.push(S);_.push(I.name)}}this.nodesByDepth=f;const v=this.layers.map(w=>w.name);for(const w of v){const b=v.filter(I=>I===w).length;if(b!==1)throw new pi(`The name "${w}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new lx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new B("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let i=0;const r=sse(e);r&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const h=r?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[h]!=null)throw new B(`Duplicate weight name: ${h}`);s[h]=c,i++}const o=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new B(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new B(`${a.length} of ${i} weights are not set: ${a}`)}lk(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),i=["vars","layer_checkpoint_dependencies"],r=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!i.includes(o)).join("/");r!==n&&(e[r]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${JF}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=ib(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return Q(()=>{e=pt(e);const s=new Oo;for(let i=0;i<this.inputs.length;++i)s.add(this.inputs[i],e[i]);return Oh(this.outputs,s,n)})}computeMask(e,n){return Q(()=>{e=pt(e);let s;return n==null?s=Nl(null,e.length):s=pt(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=jg(e);if(n.length!==this.inputLayers.length)throw new B(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],h=l.name+"_0_0";s[h]=c}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(mm);if(i.length>1)for(const a of i){const l=this.nodesByDepth[a];for(const c of l){const h=c.outboundLayer;if(this.inputLayers.map(x=>x.id).indexOf(h.id)!==-1)continue;const d=[];for(let x=0;x<c.inboundLayers.length;x++){const _=c.inboundLayers[x],v=c.nodeIndices[x],w=c.tensorIndices[x],b=`${_.name}_${v}_${w}`,I=s[b];d.push(I)}const f=h.computeOutputShape(us(d)),m=jg(f),g=h.inboundNodes.indexOf(c);for(let x=0;x<m.length;x++){const _=`${h.name}_${g}_${x}`;s[_]=m[x]}}}const r=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${h}`;o.push(d)}for(let a=0;a<o.length;a++){const l=o[a];fr(l in s),r.push(s[l])}return us(r)}runInternalGraph(e,n){n==null&&(n=Nl(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],h=e[l],d=n[l];s[c.id]=[h,d]}const i=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(mm);for(const l of i){const c=this.nodesByDepth[l];for(const h of c){const d=h.outboundLayer,f=h.inputTensors,m=h.outputTensors,g=new Array;for(const x of f)x.id in s&&g.push(s[x.id]);if(g.length===f.length){let x={},_,v,w,b;if(h.callArgs!=null&&(x=h.callArgs),g.length===1){const[I,S]=g[0];x.mask==null&&(x.mask=S),w=pt(d.call(I,x)),b=pt(d.computeMask(I,S)),_=[I],v=[S]}else _=g.map(I=>I[0]),v=g.map(I=>I[1]),x.mask==null&&(x.mask=v),w=pt(d.call(_,x)),b=pt(d.computeMask(_,v));if(d.activityRegularizer)throw new Ue("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let I=0;I<m.length;++I){const S=m[I],T=w[I],$=b[I];s[S.id]=[T,$]}}}}const r=[],o=[],a=[];for(const l of this.outputs){fr(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,h]=s[l.id];a.push(c.shape),r.push(c),o.push(h)}return[r,o,a]}buildNodeConversionMap(e){const n={};let s;for(const i of this.layers){s=i instanceof Di?1:0;for(let r=0;r<i.inboundNodes.length;r++){const o=Di.nodeKey(i,r);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new B("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new B(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new B(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Q(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const i=Di.nodeKey(n,s);this.containerNodes.has(i)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let d=0;d<o.inboundNodes.length;d++){const f=o.inboundNodes[d],m=Di.nodeKey(o,d);let g={};if(this.containerNodes.has(m)){if(f.callArgs)try{JSON.stringify(f.callArgs),g=f.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),g={}}if(f.inboundLayers.length>0){const x=[];for(let _=0;_<f.inboundLayers.length;_++){const v=f.inboundLayers[_],w=f.nodeIndices[_],b=f.tensorIndices[_],I=Di.nodeKey(v,w);let S=n[I];S==null&&(S=0),x.push([v.name,S,b,g])}c.push(x)}}}const h={};h.name=o.name,h.className=a,h.config=l,h.inboundNodes=c,s.push(h)}e.layers=s;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=Di.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let h=n[c];h==null&&(h=0);const d=this.inputLayersTensorIndices[o];i.push([a.name,h,d])}e.inputLayers=i;const r=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=Di.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let h=n[c];h==null&&(h=0);const d=this.outputLayersTensorIndices[o];r.push([a.name,h,d])}return e.outputLayers=r,e}static fromConfig(e,n,s={},i=!1){const r={},o={};function a(_,v){_.name in o?o[_.name].push(v):o[_.name]=[v]}function l(_,v){const w=[];let b;for(const I of v){const S=I[0],T=I[1],$=I[2];if(b=I[3]==null?{}:I[3],!(S in r)){a(_,v);return}const E=r[S];if(E.inboundNodes.length<=T){a(_,v);return}const D=E.inboundNodes[T];w.push(D.outputTensors[$])}w.length>0&&_.apply(us(w),b)}function c(_){const v=_.name,w=Sr(_,n.customObjects!=null?n.customObjects:{});w.setFastWeightInitDuringBuild(i),r[v]=w,_.inboundNodes.forEach(I=>{if(!(I instanceof Array))throw new B(`Corrupted configuration, expected array for nodeData: ${I}`);a(w,I)})}const h=n.name,d=n.layers;for(const _ of d)c(_);for(;!Ute(o);)for(const _ of d){const v=r[_.name];if(v.name in o){const w=o[v.name];delete o[v.name];for(const b of w)l(v,b)}}const f=[],m=[],g=n.inputLayers;for(const _ of g){const v=_[0],w=_[1],b=_[2];fr(v in r);const S=r[v].inboundNodes[w].outputTensors;f.push(S[b])}const x=n.outputLayers;for(const _ of x){const v=_[0],w=_[1],b=_[2];fr(v in r);const S=r[v].inboundNodes[w].outputTensors;m.push(S[b])}return new e({inputs:f,outputs:m,name:h})}get stateful(){if(this._stateful)throw new B("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Q(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ise(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(i=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const i=[];return e.forEach(r=>{r in t?i.push(t[r]):i.push(null)}),i}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function eM(t,e){return ise(t,e,"classWeight")}async function tM(t,e,n,s){if(n!=null){const i=Q(()=>{if(t.shape.length===1)return rl(t);if(t.shape.length===2){if(t.shape[1]>1)return Nd(t,1);if(t.shape[1]===1)return G(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await i.data());We(i);const o=[];return r.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),ks(o,"float32")}else return null}function rse(t,e){return U(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ose=32;function nM(t,e){let n,s;const i=e;n=i.xs,s=i.ys,R(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const r=_2("input",t.inputNames,n),o=_2("output",t.outputNames,s),a=r[0].shape[0];R(r.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${r.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),R(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<r.length;l++)R(r[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${r[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)R(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:r,ys:o}}function _2(t,e,n){if(n instanceof an)return[n];if(Array.isArray(n))return R(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const i of e){if(n[i]==null)throw new B(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);s.push(n[i])}return s}}function ase(t){if(t.length===3)throw new Ue("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function lse(t,e,n){const s=n.batchesPerEpoch!=null;if(R(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),R(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),R(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),R(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),R(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=n.validationData!=null;let r,o;if(i)if(w2(n.validationData))R(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const _=ase(n.validationData);r=_.xs,o=_.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;i?c=l.slice().concat(l.map(_=>"val_"+_)):c=l.slice();const h=GF(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:f,history:m}=HF(h,d,n.epochs,null,null,cse(e,n),null,i,c);f.setModel(t),t.history=m,await f.onTrainBegin(),t.stopTraining_=!1;let g=n.initialEpoch==null?0:n.initialEpoch,x=await e.iterator();for(;g<n.epochs;){const _={};await f.onEpochBegin(g);let v=0,w=0;for(s||(x=await e.iterator());!s||v<n.batchesPerEpoch;){const b=await x.next();if(s&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){const{xs:I,ys:S}=nM(t,b.value),T={};T.batch=w,T.size=I[0].shape[0],await f.onBatchBegin(w,T);const $=[];if(n.classWeight!=null){const P=eM(n.classWeight,t.outputNames);for(let z=0;z<P.length;++z)$.push(await tM(S[z],null,P[z]))}const E=I.concat(S).concat($),D=a(E);We(E);for(let P=0;P<l.length;++P){const z=l[P],V=D[P];T[z]=V,br(V)}await f.onBatchEnd(w,T),jF(T),w++,v++}if(s?v>=n.batchesPerEpoch:b.done){if(i){let I;w2(n.validationData)?I=pt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):I=pt(t.evaluate(r,o,{batchSize:n.validationBatchSize==null?ose:n.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)_[`val_${t.metricsNames[S]}`]=I[S]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(g,_),g++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function cse(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function w2(t){return typeof t.iterator=="function"}function use(t){return typeof t.next=="function"}async function hse(t,e,n){n=n||{};const s=n.batches!=null,i=t.testFunction;let r=[];if(n.verbose>0)throw new Ue("Verbose mode is not implemented yet.");R(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=use(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const c=await o.next();if(r=Q(()=>{if(c.value){const{xs:h,ys:d}=nM(t,c.value),f=h.concat(d),m=Q(()=>i(f));if(We(f),l===0)for(let x=0;x<m.length;++x)r.push(rt(0));const g=f[0].shape[0];for(let x=0;x<m.length;++x){const _=m[x],v=r[x];r[x]=Q(()=>pe(r[x],U(g,_))),l>0&&We(v)}We(m),a+=g,++l}return r}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<r.length;++c){const h=r[c];r[c]=Re(r[c],a),We(h)}return us(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function J_(t){R(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function wh(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>al(s,e,n-e)):al(t,e,n-e)}function rb(t,e){return Q(()=>t==null?null:Array.isArray(t)?t.map(n=>rb(n,e)):$F(t,e.dtype==="int32"?e:_e(e,"int32")))}function e0(t,e){const n=[];let s=0,i=null;for(;s<t;)i=s+e,i>=t&&(i=t),n.push([s,i]),s=i;return n}function sM(t){const e=[];t instanceof an&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(dp(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Ai(t,e){if(t==null)return;const n=[];if(e instanceof an)n.push(e.id);else if(Array.isArray(e))e.forEach(i=>n.push(i.id));else if(e!=null)for(const i in e){const r=e[i];n.push(r.id)}const s=[];if(t instanceof an)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(i=>{n.indexOf(i.id)===-1&&s.push(i)});else if(t!=null)for(const i in t){const r=t[i];n.indexOf(r.id)===-1&&s.push(r)}s.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dse(t){return t instanceof an}function ob(t){return Array.isArray(t)}function b2(t){return!dse(t)&&!ob(t)}function C2(t,e,n,s=!0,i=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(ob(t)&&t.length>0)o=!0;else if(b2(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new B(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let r;if(b2(t)){t=t,r=[];for(const o of e){if(t[o]==null)throw new B(`No data provided for "${o}". Need data for each key in: ${e}`);r.push(t[o])}}else if(ob(t)){if(t=t,t.length!==e.length)throw new B(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);r=t}else{if(t=t,e.length>1)throw new B(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);r=[t]}if(r=sM(r),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=r[o];if(a.shape.length!==n[o].length)throw new B(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],h=n[o][l];if(h!=null&&h>=0&&c!==h)throw new B(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return r}function fse(t,e,n){const s=Zo(t.map(r=>r.shape[0]));s.sort();const i=Zo(e.map(r=>r.shape[0]));if(i.sort(),s.length>1)throw new B(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(r=>r.shape))}`);if(i.length>1)throw new B(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(r=>r.shape))}`);if(s.length>0&&i.length>0&&!ct(s,i))throw new B(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function pse(t,e,n){const s=[cx,ux,Od];for(let i=0;i<t.length;++i){const r=t[i],o=e[i],a=n[i];if(o!=null){if(o===Od&&r.shape[r.shape.length-1]===1)throw new B(`You are passing a target array of shape ${r.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=r.shape.slice(1),c=a.slice(1);for(let h=0;h<l.length;++h){const d=l[h],f=c[h];if(f!=null&&d!==f)throw new B(`A target Tensor with shape ${r.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function I2(t,e,n,s=!0,i=""){let r;if(Array.isArray(t)){if(t.length!==e.length)throw new B(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);r=t}else{if(e.length>1)throw new B(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);r=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=r[o];if(a.shape.length!==n[o].length)throw new B(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],h=n[o][l];if(h!=null&&h!==c)throw new B(`Error when checking ${i}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function mse(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const i of e){let r=n.hasOwnProperty(i)?n[i]:[];Array.isArray(r)||(r=[r]),s.push(r)}return s}}const gse="layers-model";class Kc extends Di{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new B("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Qne(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Yne(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ca))throw new B("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new B(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(Q_(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new B(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>Q_(a))}else{const o=Q_(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ol("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=mse(e.metrics,this.outputNames),r=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};ol("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=i[o];(c=>{const h="";let d,f,m;for(const g of c){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){const _=this.internalOutputShapes[o];_[_.length-1]===1||this.lossFunctions[o]===ux?["accuracy","acc"].indexOf(g)!==-1?f=KF:["crossentropy","ce"].indexOf(g)!==-1&&(f=Une):this.lossFunctions[o]===Xg?["accuracy","acc"].indexOf(g)!==-1?f=Wne:["crossentropy","ce"].indexOf(g)!==-1&&(f=YF):["accuracy","acc"].indexOf(g)!==-1?f=XF:["crossentropy","ce"].indexOf(g)!==-1&&(f=ZF);let v;["accuracy","acc"].indexOf(g)!==-1?v="acc":["crossentropy","ce"].indexOf(g)!==-1&&(v="ce"),m=f,d=h+v}else m=Zne(g),d=h+vm(g);let x;ol(d,()=>{x=m}),r(o,d,x)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const i=s.batchSize==null?32:s.batchSize;J_(i);const o=this.standardizeUserDataXY(e,n,!0,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,i,s.verbose,s.steps);return us(c)}finally{Ai(o[0],e),Ai(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),hse(this,e,n)}checkNumSamples(e,n,s,i="steps"){let r;if(s!=null){if(r=null,n!=null)throw new B(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?r=e[0].shape[0]:r=e.shape[0];else throw new B(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return r}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new B("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),i=s?n:[n],r=this.retrieveSymbolicTensors(i),o=new Oo;if(e instanceof an&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new B(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new B(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=Oh(r,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Nl(null,e.length);let s=e.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],o=r.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=r[l],s--),s===0)break}if(s===0)break}if(s>0){const i=[];throw n.forEach((r,o)=>{r==null&&i.push(e[o])}),new B(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(e,n=32,s=!1){return Q(()=>{const i=this.checkNumSamples(e);if(s)throw new Ue("Verbose predictLoop() is not implemented yet.");const r=e0(i,n),o=this.outputs.map(a=>[]);for(let a=0;a<r.length;++a)Q(()=>{const c=r[a][0],h=r[a][1],d=wh(e,c,h),f=[];if(Array.isArray(d))for(let g=0;g<d.length;++g)f.push({key:this.inputs[g],value:d[g]});else f.push({key:this.inputs[0],value:d});const m=new Oo(f);return Oh(this.outputs,m)}).forEach((c,h)=>o[h].push(c));return us(o.map(a=>ds(a,0)))})}predict(e,n={}){const s=sM(e);I2(s,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return J_(i),this.predictLoop(s,i)}finally{Ai(s,e)}}predictOnBatch(e){I2(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,i){if(this.optimizer_==null)throw new pi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Xg?r.push(a.slice(0,a.length-1).concat([1])):r.push(a)}if(e=C2(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=C2(n,this.feedOutputNames,r,!1,"target"),fse(e,n),pse(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new B(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,i,r=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,r,o);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(i!=null){const h=eM(i,this.outputNames);c=[];for(let d=0;d<h.length;++d)c.push(await tM(l[d],null,h[d]))}return[a,l,c]}testLoop(e,n,s,i=0,r){return Q(()=>{const o=this.checkNumSamples(n,s,r,"steps"),a=[];if(i>0)throw new Ue("Verbose mode is not implemented yet.");if(r!=null)throw new Ue("steps mode in testLoop() is not implemented yet");{const l=e0(o,s),c=ks(Qi(0,o));for(let h=0;h<l.length;++h){const d=l[h][0],f=l[h][1],m=al(c,d,f-d),g=rb(n,m),x=e(g);if(h===0)for(let _=0;_<x.length;++_)a.push(rt(0));for(let _=0;_<x.length;++_){const v=x[_];a[_]=pe(a[_],U(f-d,v))}}for(let h=0;h<a.length;++h)a[h]=Re(a[h],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const i=e[s];let r=i;if(l2(e,i)>1){const o=l2(e.slice(0,s),i);r+=`_${o}`}n.push(r)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const d=[];for(let x=0;x<this.inputs.length;++x)d.push({key:this.inputs[x],value:s[x]});const f=new Oo(d),m=Oh(this.outputs,f,{training:!0});let g;for(let x=0;x<this.lossFunctions.length;++x){const _=this.lossFunctions[x];let v=_(i[x],m[x]);r[x]!=null&&(v=rse(v,r[x]));const w=nn(v);n.push(w),x===0?g=v:g=pe(g,v)}for(let x=0;x<this.metricsTensors.length;++x){let _;if(this.outputs.length>1&&x<this.outputs.length)_=n[x];else{const v=this.metricsTensors[x][0],w=this.metricsTensors[x][1];_=nn(v(i[w],m[w]))}br(_),o.push(_)}return g=nn(g),this.calculateLosses().forEach(x=>{g=pe(g,x)}),g},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>Q(()=>{const n=[];let s;const i=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:i[c]});const a=new Oo(o),l=Oh(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const h=this.lossFunctions[c],d=nn(h(r[c],l[c]));c===0?s=d:s=pe(s,d),n.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const h=this.metricsTensors[c][0],d=this.metricsTensors[c][1],f=nn(h(r[d],l[d]));n.push(f)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,r,o,a,l,c,h,d,f;try{const m=s.batchSize==null?32:s.batchSize;J_(m);const x=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,m);i=x[0],r=x[1],f=x[2];let _=!1,v;if(s.validationData!=null&&s.validationData.length>0){if(_=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new Ue("validationData including sample weights is not supported yet."):new B(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const P=await this.standardizeUserData(l,c,null,null,!0,m);h=P[0],d=P[1],v=h.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){_=!0;const D=Math.floor(i[0].shape[0]*(1-s.validationSplit)),P=i[0].shape[0];h=wh(i,D,P),o=i,i=wh(i,0,D),d=wh(r,D,P),a=r,r=wh(r,0,D),v=h.concat(d)}else s.validationSteps!=null&&(_=!0);const w=i.concat(r).concat(f);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),I=this.getDedupedMetricsNames();let S,T;_?(this.makeTestFunction(),S=this.testFunction,T=I.slice().concat(I.map(D=>"val_"+D))):(S=null,v=[],T=I.slice());const $=GF(s.callbacks,s.yieldEvery);return await this.fitLoop(b,w,I,m,s.epochs,s.verbose,$,S,v,s.shuffle,T,s.initialEpoch,null,null)}finally{this.isTraining=!1,Ai(i,e),Ai(r,n),Ai(o,e),Ai(a,n),Ai(h,l),Ai(d,c),f!=null&&We(f)}}async fitLoop(e,n,s,i,r,o,a,l,c,h,d,f,m,g){i==null&&(i=32),r==null&&(r=1),h==null&&(h=!0),f==null&&(f=0);let x=!1;if(l!=null&&c!=null&&(x=!0),g!=null&&(x=!0,m==null))throw new B("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const _=this.checkNumSamples(n,i,m,"steps_per_epoch");let v;_!=null&&(v=Qi(0,_)),o==null&&(o=1);const{callbackList:w,history:b}=HF(a,o,r,f,_,m,i,x,d);w.setModel(this),this.history=b,await w.onTrainBegin(),this.stopTraining_=!1;for(let I=f;I<r;++I){await w.onEpochBegin(I);const S={};if(m!=null)throw new Ue("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Ue("batch shuffling is not implemneted yet");h&&P8(v);const T=ks(v),$=e0(_,i);for(let E=0;E<$.length;++E){const D={};if(await w.onBatchBegin(E,D),Q(()=>{const P=$[E][0],z=$[E][1],V=al(T,P,z-P);D.batch=E,D.size=z-P;const q=rb(n,V),K=e(q);for(let J=0;J<s.length;++J){const X=s[J],oe=K[J];D[X]=oe,br(oe)}if(E===$.length-1&&x){const J=this.testLoop(l,c,i);for(let X=0;X<s.length;++X){const oe=s[X],O=J[X];br(O),S["val_"+oe]=O}}}),await w.onBatchEnd(E,D),jF(D),this.stopTraining_)break}T.dispose()}if(await w.onEpochEnd(I,S),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return lse(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),i=s[0],r=s[1],a=this.makeTrainFunction()(i.concat(r)),l=[];for(const c of a){const h=await c.data();l.push(h[0])}return We(a),Ai(s[0],e),Ai(s[1],n),us(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,i=s?this.trainableWeights:this.weights,r=this.getWeights(s);for(let o=0;o<i.length;++o)s&&!i[o].trainable||n.push({name:i[o].originalName,tensor:r[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=WN().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-WN().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Wr(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Wr(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const i of n)if(typeof s[i]=="string")e[i]=Wr(s[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Wr(vm(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Wr(vm(e)));{const e={};for(const n in this.metrics)e[n]=Wr(vm(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Jg(e.optimizer_config),s=Sr(n);let i;if(typeof e.loss=="string")i=Ha(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(o=>Ha(o));else if(e.loss!=null){i={};for(const o in e.loss)i[o]=Ha(e.loss[o])}let r;if(Array.isArray(e.metrics))r=e.metrics.map(o=>Ha(o));else if(e.metrics!=null){r={};for(const o in e.metrics)r[o]=Ha(e.metrics[o])}this.compile({loss:i,metrics:r,optimizer:s})}async save(e,n){if(typeof e=="string"){const c=BX(e);if(c.length===0)throw new B(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new B(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new B("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await VN(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:gse,generatedBy:`TensorFlow.js tfjs-layers v${JF}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:h,specs:d}=await VN(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=AX([s.data,h])}return this.userDefinedMetadata!=null&&(x2(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){x2(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Kc.className="Model";de(Kc);class iM extends Kc{}iM.className="Functional";de(iM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function yse(t,e){if(e==null&&(e={}),typeof t=="string"){const n=UX(t,e);if(n.length===0)n.push(bJ(t,e));else if(n.length>1)throw new B(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return vse(t,void 0,e)}async function vse(t,e,n){if(n==null&&(n={}),t.load==null)throw new B("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let i=s.modelTopology;i.model_config!=null&&(i=i.model_config);const r=n.strict==null?!0:n.strict,o=s.weightData!=null&&s.weightSpecs!=null&&r,a=Sr(Jg(i),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new B("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:h}=xse(s.weightData,s.weightSpecs);a.loadWeights(c,r),a.optimizer!=null&&h.length>0&&await a.optimizer.setWeights(h),We(c),We(h.map(d=>d.tensor))}return a}function xse(t,e){const n=SX(t,e),s={},i=[];return e.forEach(r=>{r.group==="optimizer"?i.push({name:r.name,tensor:n[r.name]}):s[r.name]=n[r.name]}),{modelWeights:s,optimizerWeights:i}}class fu extends Kc{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:ox("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new B(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof fu||e instanceof Kc;let s;if(n){if(s=e,s.outputs.length!==1)throw new B("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new B("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new B("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=vne({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new B(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new B("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=zF(this.outputs[0])}this.inboundNodes=[],new lx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Nl(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(st(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Kc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new pi("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},i=!1){let r,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new B("Legacy serialization format not supported yet.");r=n}else R(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof fu))throw new Ue(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of r){const h=Sr(l,void 0,i);i&&h.setFastWeightInitDuringBuild(!0),a.add(h)}return a}set stopTraining(e){if(this.model==null)throw new B("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new B("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}fu.className="Sequential";de(fu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _se(t){return new fu(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Hn=class extends Ou{getConfig(){return{}}};class rM extends Hn{apply(e,n=1){return nne(e,n)}}rM.className="elu";de(rM);class oM extends Hn{apply(e){return wL(e)}}oM.className="selu";de(oM);class aM extends Hn{apply(e){return Kl(e)}}aM.className="relu";de(aM);class lM extends Hn{apply(e){return Q(()=>Ad(6,Kl(e)))}}lM.className="relu6";de(lM);class cM extends Hn{apply(e){return e}}cM.className="linear";de(cM);class uM extends Hn{apply(e){return Au(e)}}uM.className="sigmoid";de(uM);class hM extends Hn{apply(e){return ine(e)}}hM.className="hardSigmoid";de(hM);class dM extends Hn{apply(e){return ip(e)}}dM.className="softplus";de(dM);class fM extends Hn{apply(e){return sne(e)}}fM.className="softsign";de(fM);class pM extends Hn{apply(e){return Zv(e)}}pM.className="tanh";de(pM);let dk=class extends Hn{apply(e,n=-1){return pI(e,n)}};dk.className="softmax";de(dk);class mM extends Hn{apply(e,n=-1){return dL(e,n)}}mM.className="logSoftmax";de(mM);class gM extends Hn{apply(e){return Q(()=>Q(()=>{const n=Math.sqrt(2),s=U(.5,pe(1,aL(Re(e,n))));return U(e,s)}))}}gM.className="gelu";de(gM);class yM extends Hn{apply(e){return Q(()=>U(.5,U(e,pe(1,Zv(U(jn(Re(2,Math.PI)),pe(e,U(.044715,Sl(e,3)))))))))}}yM.className="gelu_new";de(yM);class vM extends Hn{apply(e){return Q(()=>U(e,Zv(ip(e))))}}vM.className="mish";de(vM);class xM extends Hn{apply(e,n=1){return Q(()=>U(Au(U(e,n)),e))}}xM.className="swish";de(xM);function sa(t){return t.getClassName()}function t0(t,e={}){return hp(t,ci.getMap().classNameMap,e,"activation")}function ia(t){if(t==null){const e={};return e.className="linear",e.config={},t0(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},t0(e)}else return t instanceof Hn?t:t0(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wse(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class _M extends Ou{}class wM extends _M{constructor(e){super(),wse(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Q(()=>{let n=_n([1]);return this.hasL1&&(n=pe(n,$e(U(this.l1,Yn(e))))),this.hasL2&&(n=pe(n,$e(U(this.l2,fp(e))))),G(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}wM.className="L1L2";de(wM);const k2={l1l2:"L1L2"};function _t(t){return QI(t)}function S2(t,e={}){return hp(t,ci.getMap().classNameMap,e,"regularizer")}function Lt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in k2?k2[t]:t,config:{}};return S2(n)}else return t instanceof _M?t:S2(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bM extends He{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=De(e);let s=Kl(e);return this.maxValue!=null&&(s=qs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}bM.className="ReLU";de(bM);class CM extends He{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=De(e);return QC(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}CM.className="LeakyReLU";de(CM);class IM extends He{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ot(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Lt(e.alphaRegularizer),this.alphaConstraint=fn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new B(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=st(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)s[i]=e[i];this.inputSpec=[new un({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=De(e),iI(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Mt(this.alphaInitializer),alphaRegularizer:_t(this.alphaRegularizer),alphaConstraint:dn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}IM.className="PReLU";de(IM);let kM=class extends He{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ue(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=De(e);return Jv(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};kM.className="ELU";de(kM);class SM extends He{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=De(e);return U(s,_e(Zs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}SM.className="ThresholdedReLU";de(SM);class TM extends He{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new dk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return Q(()=>{let s=De(e);const i=n.mask;if(i!=null){const r=U(Ae(ba(s.shape),_e(i,s.dtype)),rt(-1e9));s=pe(s,r)}return this.axis instanceof Array?this.axis.length>1?Nr(Ae(s,fL(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}TM.className="Softmax";de(TM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xc(t,e,n){if(typeof t=="number")return Nl(t,e);if(t.length!==e)throw new B(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const i=t[s];if(!Qte(i))throw new B(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${i}`)}return t}function qi(t,e,n,s,i=1){if(t==null)return t;const r=e+(e-1)*(i-1);let o;return n==="same"?o=t:o=t-r+1,Math.floor((o+s-1)/s)}function pr(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+na([n-e,0]);else if(s==="same")t=t*e;else throw new B(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fk(t,e){return Q(()=>(Yt(e),e==="channelsFirst"?Je(t,[0,2,3,1]):t))}function EM(t,e){return Q(()=>(Yt(e),e==="channelsFirst"?Je(t,[0,2,3,4,1]):t))}function bse(t,e,n,s=1,i="valid",r,o=1){return Q(()=>{if(r==null&&(r=Ji()),Yt(r),t.shape.length!==3)throw new B(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new B(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new B(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(r==="channelsFirst"&&(t=Je(t,[0,2,1])),i==="causal")throw new Ue("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=nL(t,e,s,i==="same"?"same":"valid","NWC",o);return n!=null&&(a=nr(a,n)),a})}function T2(t,e,n,s=[1,1],i="valid",r,o,a=null){return Q(()=>{if(r==null&&(r=Ji()),Yt(r),t.rank!==3&&t.rank!==4)throw new B(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new B(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=fk(t,r);if(i==="causal")throw new Ue("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=xQ({x:l,filter:e,strides:s,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),r==="channelsFirst"&&(l=Je(l,[0,3,1,2])),l})}function Cse(t,e,n,s=[1,1,1],i="valid",r,o){return Q(()=>{if(r==null&&(r=Ji()),Yt(r),t.rank!==4&&t.rank!==5)throw new B(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new B(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=EM(t,r);if(i==="causal")throw new Ue("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=y7(a,e,s,i==="same"?"same":"valid","NDHWC",o),n!=null&&(a=nr(a,n)),r==="channelsFirst"&&(a=Je(a,[0,4,1,2,3])),a})}class hx extends He{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",hx.verifyArgs(n),this.rank=e,Cn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ue(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Xc(n.kernelSize,e,"kernelSize"),this.strides=Xc(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Ys(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Yt(this.dataFormat),this.activation=ia(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Ot(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=fn(n.biasConstraint),this.biasRegularizer=Lt(n.biasRegularizer),this.activityRegularizer=Lt(n.activityRegularizer),this.dilationRate=Xc(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new B(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new B(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new B(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(fr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!JI(e.kernelSize,"number",1,3))throw new B(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:sa(this.activation),useBias:this.useBias,biasInitializer:Mt(this.biasInitializer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),biasConstraint:dn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Lu extends hx{constructor(e,n){super(e,n),this.kernel=null,Lu.verifyArgs(n),this.filters=n.filters,Cn(this.filters,"filters"),this.kernelInitializer=Ot(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=fn(n.kernelConstraint),this.kernelRegularizer=Lt(n.kernelRegularizer)}build(e){e=st(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new B(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],i=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return Q(()=>{e=De(e);let s;const i=this.bias==null?null:this.bias.read(),r=IF(this.activation.getClassName());if(r!=null&&this.rank===2)s=T2(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(this.rank===1)s=bse(e,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=T2(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=Cse(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ue("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=st(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let r=0;r<s.length;++r){const o=qi(s[r],this.kernelSize[r],this.padding,this.strides[r],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[r]);n.push(o)}let i=[e[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const e={filters:this.filters,kernelInitializer:Mt(this.kernelInitializer),kernelRegularizer:_t(this.kernelRegularizer),kernelConstraint:dn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new B(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Fu extends Lu{constructor(e){super(2,e),Fu.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!JI(e.kernelSize,"number",1,2))throw new B(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Fu.className="Conv2D";de(Fu);class yp extends Lu{constructor(e){super(3,e),yp.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new B(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}yp.className="Conv3D";de(yp);class NM extends Fu{constructor(e){if(super(e),this.inputSpec=[new un({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new B(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=st(e),e.length!==4)throw new B("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new B("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new un({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return Q(()=>{let s=De(e);if(s.shape.length!==4)throw new B(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,r=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=i[o],c=i[a],h=this.kernelSize[0],d=this.kernelSize[1],f=this.strides[0],m=this.strides[1],g=pr(l,f,h,this.padding),x=pr(c,m,d,this.padding),_=[r,g,x,this.filters];this.dataFormat!=="channelsLast"&&(s=Je(s,[0,2,3,1]));let v=sL(s,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=Je(v,[0,3,1,2])),this.bias!=null&&(v=nr(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=st(e);const n=e.slice();let s,i,r;this.dataFormat==="channelsFirst"?(s=1,i=2,r=3):(s=3,i=1,r=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[s]=this.filters,n[i]=pr(n[i],l,o,this.padding),n[r]=pr(n[r],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}NM.className="Conv2DTranspose";de(NM);class $M extends yp{constructor(e){if(super(e),this.inputSpec=[new un({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new B(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=st(e),e.length!==5)throw new B("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new B("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new un({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return Q(()=>{let s=De(e);if(s.shape.length!==5)throw new B(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,r=i[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=i[l],h=i[o],d=i[a],f=this.kernelSize[0],m=this.kernelSize[1],g=this.kernelSize[2],x=this.strides[0],_=this.strides[1],v=this.strides[2],w=pr(c,x,f,this.padding),b=pr(h,_,m,this.padding),I=pr(d,v,g,this.padding),S=[r,w,b,I,this.filters];this.dataFormat!=="channelsLast"&&(s=Je(s,[0,2,3,4,1]));let T=_7(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(T=Je(T,[0,4,1,2,3])),this.bias!==null&&(T=nr(T,this.bias.read(),this.dataFormat)),this.activation!==null&&(T=this.activation.apply(T)),T})}computeOutputShape(e){e=st(e);const n=e.slice();let s,i,r,o;this.dataFormat==="channelsFirst"?(s=1,i=2,r=3,o=4):(s=4,i=1,r=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],h=this.strides[0],d=this.strides[1],f=this.strides[2];return n[s]=this.filters,n[i]=pr(n[i],h,a,this.padding),n[r]=pr(n[r],d,l,this.padding),n[o]=pr(n[o],f,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}$M.className="Conv3DTranspose";de($M);class RM extends Lu{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new B("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new B("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new B(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Ot(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Lt(n.depthwiseRegularizer),this.depthwiseConstraint=fn(n.depthwiseConstraint),this.pointwiseInitializer=Ot(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Lt(n.pointwiseRegularizer),this.pointwiseConstraint=fn(n.pointwiseConstraint)}build(e){if(e=st(e),e.length<this.rank+2)throw new B(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new B(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],i=this.kernelSize.concat([s,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new un({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return Q(()=>{e=De(e);let s;if(this.rank===1)throw new Ue("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Je(e,[0,2,3,1])),s=bL(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=nr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Je(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Mt(this.depthwiseInitializer),e.pointwiseInitializer=Mt(this.pointwiseInitializer),e.depthwiseRegularizer=_t(this.depthwiseRegularizer),e.pointwiseRegularizer=_t(this.pointwiseRegularizer),e.depthwiseConstraint=dn(this.depthwiseConstraint),e.pointwiseConstraint=dn(this.pointwiseConstraint),e}}RM.className="SeparableConv";class AM extends RM{constructor(e){super(2,e)}}AM.className="SeparableConv2D";de(AM);class dx extends Lu{constructor(e){super(1,e),dx.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!JI(e.kernelSize,"number",1,1))throw new B(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}dx.className="Conv1D";de(dx);class DM extends He{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return Q(()=>{if(e=De(e),this.dataFormat==="channelsLast"){const s=ym(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return ym(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=ym(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return ym(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}DM.className="Cropping2D";de(DM);class PM extends He{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Xte(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return Q(()=>{let s=De(e);const i=s.shape;if(this.dataFormat==="channelsFirst"){s=Je(s,[0,2,3,1]);const r=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?Xr.resizeNearestNeighbor(s,[r,o]):Xr.resizeBilinear(s,[r,o]);return Je(a,[0,3,1,2])}else{const r=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?Xr.resizeNearestNeighbor(s,[r,o]):Xr.resizeBilinear(s,[r,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}PM.className="UpSampling2D";de(PM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ise(t,e,n=[1,1],s="valid",i,r){return Q(()=>{i==null&&(i=Ji()),Yt(i);let o=fk(t,i);if(t.rank!==4)throw new B(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new B(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=KC(o,e,n,s==="same"?"same":"valid","NHWC",r),i==="channelsFirst"&&(o=Je(o,[0,3,1,2])),o})}class OM extends hx{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Ot(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=fn(e.depthwiseConstraint),this.depthwiseRegularizer=Lt(e.depthwiseRegularizer)}build(e){if(e=st(e),e.length<4)throw new B(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new B(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],i=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Q(()=>{e=De(e);let s=Ise(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=nr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=st(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=qi(n,this.kernelSize[0],this.padding,this.strides[0]),o=qi(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,r,o]:[e[0],r,o,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Mt(this.depthwiseInitializer),e.depthwiseRegularizer=_t(this.depthwiseRegularizer),e.depthwiseConstraint=dn(this.depthwiseRegularizer),e}}OM.className="DepthwiseConv2D";de(OM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LM(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new B("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(r){return r==null||Array.isArray(r)?r:[r]}return e=i(e),n=i(n),{inputs:t,initialState:e,constants:n}}function FM(t,e,n,s=!1,i,r,o=!1,a=!1){return Q(()=>{const l=e.shape.length;if(l<3)throw new B(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Qi(2,l));e=Je(e,c),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=_e(_e(i,"bool"),"float32"),i.rank===l-1&&(i=cs(i,-1)),i=Je(i,c)),s&&(e=Tl(e,0),i!=null&&(i=Tl(i,0)));const h=[];let d,f=n;const m=e.shape[0],g=El(e);let x;i!=null&&(x=El(i));for(let v=0;v<m;++v){const w=g[v],b=Q(()=>t(w,f));if(i==null)d=b[0],f=b[1];else{const I=Q(()=>{const S=x[v],T=Ae(wi(S),S),$=pe(U(b[0],S),U(f[0],T)),E=f.map((D,P)=>pe(U(b[1][P],S),U(D,T)));return{output:$,newStates:E}});d=I.output,f=I.newStates}a&&h.push(d)}let _;return a&&(_=ao(h,1)),[d,_,f]})}class Ia extends He{constructor(e){super(e);let n;if(e.cell==null)throw new B("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new gk({cells:e.cell}):n=e.cell,n.stateSize==null)throw new B("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new un({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Qi(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){tb(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let i;if(this.returnSequences?i=[e[0],e[1],s]:i=[e[0],s],this.returnState){const r=[];for(const o of n)r.push([e[0],o]);return[i].concat(r)}else return i}computeMask(e,n){return Q(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(r=>null);return[s].concat(i)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ue("Constants support is not implemented in RNN yet.");tb(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new un({shape:[n,null,...s]});const i=[e[0]].concat(e.slice(2));this.cell.build(i);let r;if(Array.isArray(this.cell.stateSize)?r=this.cell.stateSize:r=[this.cell.stateSize],this.stateSpec!=null){if(!ct(this.stateSpec.map(o=>o.shape[o.shape.length-1]),r))throw new B(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map(o=>new un({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){Q(()=>{if(!this.stateful)throw new dr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new B("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>_n([s,i])):this.states_=[_n([s,this.cell.stateSize])];else if(e==null)We(this.states_),this.keptStates!=null&&(We(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>_n([s,i])):this.states_[0]=_n([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new B(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):We(this.states_);for(let i=0;i<this.states_.length;++i){const r=e[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[s,o];if(!ct(r.shape,a))throw new B(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[i]=r}}this.states_=this.states_.map(i=>br(i.clone()))})}apply(e,n){let s=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const r=LM(e,s,i,this.numConstants);e=r.inputs,s=r.initialState,i=r.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new un({shape:c.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof Rr){const c=[e].concat(o),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const f=super.apply(c,n);return this.inputSpec=d,f}else return super.apply(e,n)}call(e,n){return Q(()=>{const s=n==null?null:n.mask,i=n==null?null:n.training;let r=n==null?null:n.initialState;e=De(e),r==null&&(this.stateful?r=this.states_:r=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==o)throw new B(`RNN Layer has ${o} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},c=FM((g,x)=>{const _=this.cell.call([g].concat(x),a);return[_[0],_.slice(1)]},e,r,this.goBackwards,s,null,this.unroll,this.returnSequences),h=c[0],d=c[1],f=c[2];this.stateful&&this.resetStates(f,i);const m=this.returnSequences?d:h;return this.returnState?[m].concat(f):m})}getInitialState(e){return Q(()=>{let n=_n(e.shape);return n=$e(n,[1,2]),n=dp(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Jw(n,[1,s]):n):this.cell.stateSize>1?[Jw(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ia.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const i=n.cell,r=Sr(i,s);return new e(Object.assign(n,{cell:r}))}}Ia.className="RNN";de(Ia);class fx extends He{}class pk extends fx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Lt(e.kernelRegularizer),this.recurrentRegularizer=Lt(e.recurrentRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.kernelConstraint=fn(e.kernelConstraint),this.recurrentConstraint=fn(e.recurrentConstraint),this.biasConstraint=fn(e.biasConstraint),this.dropout=du([1,na([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=du([1,na([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=st(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Q(()=>{if(e=e,e.length!==2)throw new B(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>wi(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>wi(s),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let r;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?r=kr(U(e,o),this.kernel.read()):r=kr(e,this.kernel.read()),this.bias!=null&&(r=nr(r,this.bias.read())),a!=null&&(s=U(s,a));let l=pe(r,kr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:sa(this.activation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:_t(this.kernelRegularizer),recurrentRegularizer:_t(this.recurrentRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),recurrentConstraint:dn(this.recurrentConstraint),biasConstraint:dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}pk.className="SimpleRNNCell";de(pk);class MM extends Ia{constructor(e){e.cell=new pk(e),super(e)}call(e,n){return Q(()=>{this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}static fromConfig(e,n){return new e(n)}}MM.className="SimpleRNN";de(MM);class mk extends fx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new B("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ia(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Lt(e.kernelRegularizer),this.recurrentRegularizer=Lt(e.recurrentRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.kernelConstraint=fn(e.kernelConstraint),this.recurrentConstraint=fn(e.recurrentConstraint),this.biasConstraint=fn(e.biasConstraint),this.dropout=du([1,na([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=du([1,na([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=st(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Q(()=>{if(e=e,e.length!==2)throw new B(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>wi(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>wi(i),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=U(e,r[0]));let h=kr(e,this.kernel.read());this.useBias&&(h=nr(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=U(i,o[0]));const d=this.recurrentKernel.read(),[f,m]=Gs(d,[2*this.units,this.units],d.rank-1),g=kr(i,f),[x,_,v]=Gs(h,3,h.rank-1),[w,b]=Gs(g,2,g.rank-1);a=this.recurrentActivation.apply(pe(x,w)),l=this.recurrentActivation.apply(pe(_,b));const I=kr(U(l,i),m);c=this.activation.apply(pe(v,I));const S=pe(U(a,i),U(pe(1,Kt(a)),c));return[S,S]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:sa(this.activation),recurrentActivation:sa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:_t(this.kernelRegularizer),recurrentRegularizer:_t(this.recurrentRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),recurrentConstraint:dn(this.recurrentConstraint),biasConstraint:dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}mk.className="GRUCell";de(mk);class zM extends Ia{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new mk(e),super(e)}call(e,n){return Q(()=>{this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}zM.className="GRU";de(zM);class px extends fx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ia(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Lt(e.kernelRegularizer),this.recurrentRegularizer=Lt(e.recurrentRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.kernelConstraint=fn(e.kernelConstraint),this.recurrentConstraint=fn(e.recurrentConstraint),this.biasConstraint=fn(e.biasConstraint),this.dropout=du([1,na([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=du([1,na([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=st(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const r=this.biasInitializer,o=this.units;i=new(n=class extends Ci{apply(l,c){const h=r.apply([o]),d=new tk().apply([o]),f=r.apply([o*2]);return u2(u2(h,d),f)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return Q(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new B(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1];const r=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>wi(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>wi(i),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,h,d;0<this.dropout&&this.dropout<1&&(e=U(e,o[0]));let f=kr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=U(i,a[0])),f=pe(f,kr(i,this.recurrentKernel.read())),this.useBias&&(f=nr(f,this.bias.read()));const[m,g,x,_]=Gs(f,4,f.rank-1);l=this.recurrentActivation.apply(m),c=this.recurrentActivation.apply(g),h=pe(U(c,r),U(l,this.activation.apply(x))),d=this.recurrentActivation.apply(_);const v=U(d,this.activation.apply(h));return[v,v,h]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:sa(this.activation),recurrentActivation:sa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:_t(this.kernelRegularizer),recurrentRegularizer:_t(this.recurrentRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),recurrentConstraint:dn(this.recurrentConstraint),biasConstraint:dn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}px.className="LSTMCell";de(px);class BM extends Ia{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new px(e),super(e)}call(e,n){return Q(()=>{this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}BM.className="LSTM";de(BM);class gk extends fx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return Q(()=>{e=e;let s=e.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(s.splice(0,a.stateSize.length)):i.push(s.splice(0,1));i.reverse();const r=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=i[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),r.push(o.slice(1))}s=[];for(const a of r.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){tb(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,i)=>{ol(`RNNCell_${i}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=r=>({className:r.getClassName(),config:r.getConfig()}),i={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),i)}static fromConfig(e,n,s={}){const i=[];for(const r of n.cells)i.push(Sr(r,s));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return nb(e)}setWeights(e){const n=[];for(const s of this.cells){const i=s.weights.length,r=e.splice(i);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],r[o]])}lk(n)}}gk.className="StackedRNNCells";de(gk);function ra(t){const{ones:e,rate:n,training:s=!1,count:i=1,dropoutFunc:r}=t,o=()=>r!=null?r(e(),n):RF(e(),n),a=()=>pp(o,e,s);return!i||i<=1?br(a().clone()):Array(i).fill(void 0).map(a).map(c=>br(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var kse=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n};class UM extends Ia{constructor(e){if(e.unroll)throw new Ue("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ue("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new un({ndim:5})]}call(e,n){return Q(()=>{if(this.cell.dropoutMask!=null&&(We(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(We(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new B("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,i=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:i,initialState:r})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return Q(()=>{const{stateSize:n}=this.cell,s=e.shape,i=this.computeSingleOutputShape(s),r=[i[0],...i.slice(2)],o=_n(r);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){Q(()=>{if(!this.stateful)throw new dr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,i=this.computeSingleOutputShape(s),r=[i[0],...i.slice(2)];if(s[0]==null)throw new B("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>_n(r)):this.states_=[_n(r)];else if(e==null)We(this.states_),this.keptStates!=null&&(We(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>_n(r)):this.states_[0]=_n(r);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new B(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):We(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=r;if(!ct(l.shape,c))throw new B(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>br(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:i,padding:r,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],h=e[l?4:3],d=qi(c,i[0],r,o[0],a[0]),f=qi(h,i[1],r,o[1],a[1]);return[...e.slice(0,2),...l?[s,d,f]:[d,f,s]]}}UM.className="ConvRNN2D";class yk extends px{constructor(e){const{filters:n,kernelSize:s,strides:i,padding:r,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Cn(this.filters,"filters"),this.kernelSize=Xc(s,2,"kernelSize"),this.kernelSize.forEach(l=>Cn(l,"kernelSize")),this.strides=Xc(i||1,2,"strides"),this.strides.forEach(l=>Cn(l,"strides")),this.padding=r||"valid",Ys(this.padding),this.dataFormat=o||"channelsLast",Yt(this.dataFormat),this.dilationRate=Xc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Cn(l,"dilationRate"))}build(e){var n;e=st(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new B(`The channel dimension of the input should be defined. Found ${e[s]}`);const i=e[s],r=4,o=this.kernelSize.concat([i,this.filters*r]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*r]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,h=this.filters;l=new(n=class extends Ci{apply(f,m){const g=c.apply([h]),x=ba([h]),_=c.apply([h*2]);return ek([g,x,_])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*r],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return Q(()=>{if(e.length!==3)throw new B(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,i=e[0],r=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ra({ones:()=>wi(i),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(j,te,ae)=>!te||!te[ae]?j:U(te[ae],j);let h=c(i,l,0),d=c(i,l,1),f=c(i,l,2),m=c(i,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ra({ones:()=>wi(r),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const g=this.recurrentDropoutMask;let x=c(r,g,0),_=c(r,g,1),v=c(r,g,2),w=c(r,g,3);const b=3,[I,S,T,$]=Gs(this.kernel.read(),a,b),[E,D,P,z]=this.useBias?Gs(this.bias.read(),a):[null,null,null,null];h=this.inputConv(h,I,E,this.padding),d=this.inputConv(d,S,D,this.padding),f=this.inputConv(f,T,P,this.padding),m=this.inputConv(m,$,z,this.padding);const[V,q,K,J]=Gs(this.recurrentKernel.read(),a,b);x=this.recurrentConv(x,V),_=this.recurrentConv(_,q),v=this.recurrentConv(v,K),w=this.recurrentConv(w,J);const X=this.recurrentActivation.apply(pe(h,x)),oe=this.recurrentActivation.apply(pe(d,_)),O=pe(U(oe,o),U(X,this.activation.apply(pe(f,v)))),Z=U(this.recurrentActivation.apply(pe(m,w)),this.activation.apply(O));return[Z,Z,O]})}getConfig(){const e=super.getConfig(),{units:n}=e,s=kse(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),i)}inputConv(e,n,s,i){const r=kl(e,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?nr(r,s,this.dataFormat):r}recurrentConv(e,n){return kl(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}yk.className="ConvLSTM2DCell";de(yk);class WM extends UM{constructor(e){const n=new yk(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}WM.className="ConvLSTM2D";de(WM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mx extends He{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let i=0;i<this.noiseShape.length;++i)s.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return s}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,r=this.getNoiseShape(s);return pp(()=>RF(s,this.rate,r,this.seed),()=>s,i)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}mx.className="Dropout";de(mx);class VM extends mx{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}VM.className="SpatialDropout1D";de(VM);class vk extends He{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Cn(this.units,"units"),this.activation=ia(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=fn(e.kernelConstraint),this.biasConstraint=fn(e.biasConstraint),this.kernelRegularizer=Lt(e.kernelRegularizer),this.biasRegularizer=Lt(e.biasRegularizer),this.activityRegularizer=Lt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=st(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=st(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e),i=IF(this.activation.getClassName());let r;return i!=null?r=kr(s,this.kernel.read(),i,this.bias?this.bias.read():null):(r=kr(s,this.kernel.read()),this.bias!=null&&(r=nr(r,this.bias.read())),this.activation!=null&&(r=this.activation.apply(r))),r})}getConfig(){const e={units:this.units,activation:sa(this.activation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:_t(this.kernelRegularizer),biasRegularizer:_t(this.biasRegularizer),activityRegularizer:_t(this.activityRegularizer),kernelConstraint:dn(this.kernelConstraint),biasConstraint:dn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}vk.className="Dense";de(vk);class xk extends He{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=st(e);for(const n of e.slice(1))if(n==null)throw new B(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Yo(e,1)]}call(e,n){return Q(()=>{this.invokeCallHook(e,n);let s=De(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const i=[0];for(let r=2;r<s.rank;++r)i.push(r);i.push(1),s=Je(s,i)}return tne(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}xk.className="Flatten";de(xk);class jM extends He{constructor(e){super(e),this.supportsMasking=!0,this.activation=ia(e.activation)}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e);return this.activation.apply(s)})}getConfig(){const e={activation:sa(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}jM.className="Activation";de(jM);class GM extends He{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return Q(()=>(e=De(e),Jte(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}GM.className="RepeatVector";de(GM);class HM extends He{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",i=n.slice();let r=1,o=null;for(let l=0;l<i.length;++l){const c=i[l];if(this.isUnknown(c))if(o===null)o=l;else throw new B("Can only specifiy one unknown dimension.");else r*=c}const a=Yo(e);if(o!==null){if(r===0||a%r!==0)throw new B(s);i[o]=a/r}else if(a!==r)throw new B(s);return i}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e),i=s.shape,r=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return G(s,r)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}HM.className="Reshape";de(HM);class qM extends He{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Qi(1,e.dims.length+1);if(!ct(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new un({ndim:this.dims.length+1})]}computeOutputShape(e){e=st(e);const n=e.slice();return this.dims.forEach((s,i)=>{n[i+1]=e[s]}),n}call(e,n){return Je(De(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}qM.className="Permute";de(qM);class KM extends He{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=De(e);return Hw(Ug(s,this.maskValue),-1)}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e),o=Hw(Ug(s,this.maskValue),-1,!0);return U(s,_e(o,s.dtype))})}}KM.className="Masking";de(KM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class XM extends He{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(pt(e.inputLength))}this.inputDim=e.inputDim,Cn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Cn(this.outputDim,"outputDim"),this.embeddingsInitializer=Ot(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Lt(e.embeddingsRegularizer),this.activityRegularizer=Lt(e.activityRegularizer),this.embeddingsConstraint=fn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return Q(()=>this.maskZero?(e=De(e),Ug(e,et(e))):null)}computeOutputShape(e){if(e=st(e),this.inputLength==null)return[...e,this.outputDim];const n=pt(this.inputLength);if(n.length!==e.length-1)throw new B(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let i=0;i<n.length;++i){const r=n[i],o=e[i+1];if(r!=null&&o!=null&&r!==o)throw new B(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);r==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return Q(()=>{this.invokeCallHook(e,n);let s=De(e);s.dtype!=="int32"&&(s=Ir(s,"int32"));const i=$F(this.embeddings.read(),G(s,[s.size]));return G(i,st(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Mt(this.embeddingsInitializer),embeddingsRegularizer:_t(this.embeddingsRegularizer),activityRegularizer:_t(this.activityRegularizer),embeddingsConstraint:dn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}XM.className="Embedding";de(XM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Yl=class extends He{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ue}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let i=0;i<n.length;++i){const r=e[e.length-n.length+i],o=n[i];if(r==null||o==null||r<0||o<0)s.push(null);else if(r===1)s.push(o);else if(o===1)s.push(r);else{if(r!==o)throw new B("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(r)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[st(e)]),e=e,e.length<2)throw new B(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const r of e)r!=null&&r[0]!==null&&n.push(r[0]);if(n=Zo(n),n.length>1)throw new B(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const i=e.map(r=>r.length);e.indexOf(null)===-1&&Zo(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return Q(()=>{if(e=e,this.reshapeRequired){const s=[],i=e.map(r=>r.rank);if(i.indexOf(null)===-1){const r=na(i);for(let o of e){const a=o.rank;for(let l=0;l<r-a;++l)o=dp(o,1);s.push(o)}return this.mergeFunction(s)}else{let r=!1;for(const l of e){const c=l.rank;if(c==null){const h=l.shape,d=h[0],f=h.slice(1).concat([d]);let m=G(l,[d].concat(Yo(h.slice(1))));m=Je(m,[1,0]),m=G(m,f),s.push(m),r=!0}else if(c>1){const h=Qi(1,c).concat([0]);s.push(Je(l,h)),r=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(r){if(a==null){const l=o.shape,c=l.length,h=l[c-1],d=[h].concat(l.slice(0,l.length-1));o=G(Je(G(o,[-1,h]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Qi(0,a-1));o=Je(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let i=1;i<e.length;++i){const r=e[i]==null?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}let s=[];for(const i of e)i!=null&&i[0]!==null&&s.push(i[0]);return s=Zo(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return Q(()=>{if(n==null)return null;if(!Array.isArray(n))throw new B("`mask` should be an Array");if(!Array.isArray(e))throw new B("`inputs` should be an Array");if(n.length!==e.length)throw new B(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:cs(i,0));let s=n[0];for(let i=1;i<n.length-1;++i)s=oo(s,n[i]);return s})}};class ZM extends Yl{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=pe(n,e[s]);return n})}}ZM.className="Add";de(ZM);class YM extends Yl{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=U(n,e[s]);return n})}}YM.className="Multiply";de(YM);class QM extends Yl{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=pe(n,e[s]);return U(1/e.length,n)})}}QM.className="Average";de(QM);class JM extends Yl{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=wa(n,e[s]);return n})}}JM.className="Maximum";de(JM);class e3 extends Yl{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Ad(n,e[s]);return n})}}e3.className="Minimum";de(e3);class t3 extends Yl{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new B("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const i of e)if(i!=null){n=!1;break}if(n)return;const s=[];for(let i=0;i<e.length;++i){const r=e[i].slice();r.splice(this.axis,1);let o=!1;for(const a of s)if(ct(a,r)){o=!0;break}o||s.push(r)}if(s.length>1)throw new B("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Q(()=>ek(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new B("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),i=this.axis<0?s.length+this.axis:this.axis;for(const r of n.slice(1)){if(s[i]==null||r[i]==null){s[i]=null;break}s[i]+=r[i]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new B("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new B("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new B(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return Q(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const i=[];for(let o=0;o<e.length;++o)n[o]==null?i.push(_e(wi(e[o]),"bool")):n[o].rank<e[o].rank?i.push(cs(n[o],-1)):i.push(n[o]);const r=ds(i,this.axis);return tL(r,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}t3.className="Concatenate";de(t3);function bh(t,e){for(;t<0;)t+=e;return t}function Sse(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ue("batchDot is not implemented for tensors of 4D or higher rank yet");if(R(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),R(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Ue("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,i=e.shape.length;n==null&&(n=[s-1,i-2]);const r=n;return Q(()=>{let o;if(s>i){o=s-i;const l=[];for(let c=0;c<o;++c)l.push(1);e=G(e,e.shape.concat(l))}else if(i>s){o=i-s;const l=[];for(let c=0;c<o;++c)l.push(1);t=G(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)r[0]===r[1]?a=$e(U(t,e),r[0]):a=$e(U(Je(t,[1,0]),e),r[1]);else{const l=r[0]!==t.shape.length-1,c=r[1]===e.shape.length-1;a=lt(t,e,l,c)}if(o>0){let l;s>i?l=s+i-3:l=s-1;const c=[];for(let h=l;h<l+o;++h)c.push(h);a=op(a,c)}return a.shape.length===1&&(a=cs(a,1)),a})}class n3 extends Yl{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Ue("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,s);if(n[i[0]]!==s[i[1]])throw new B(`Dimension incompatibility: ${n[i[0]]} !== ${s[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new B(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((r,o)=>bh(r,e[o].shape.length)):i=[bh(this.axes,n.shape.length),bh(this.axes,s.shape.length)],this.normalize&&(n=Kg(n,i[0]),s=Kg(s,i[1])),Sse(n,s,i)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[bh(this.axes,e.length),bh(this.axes,n.length)],s}computeOutputShape(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Ue("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,s);n.splice(i[0],1),s.splice(i[1],1),s.splice(0,1);const r=n.concat(s);return r.length===1&&r.push(1),r}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}n3.className="Dot";de(n3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class s3 extends He{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e);return pp(()=>pe(ax(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}s3.className="GaussianNoise";de(s3);class i3 extends He{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const s=De(e);return this.rate>0&&this.rate<1?pp(()=>{const r=Math.sqrt(this.rate/(1-this.rate));return U(s,ax(s.shape,1,r))},()=>s,n.training||!1):s})}}i3.className="GaussianDropout";de(i3);class r3 extends He{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||De(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Q(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return pp(()=>{const r=De(e),a=-1.6732632423543772*1.0507009873554805;let l=Hl(rp(s),this.rate);l=Ir(l,"float32");const c=((1-this.rate)*(1+this.rate*a**2))**-.5,h=-c*a*this.rate,d=pe(U(r,l),U(pe(l,-1),a));return pe(U(d,c),h)},()=>De(e),n.training||!1)}return e})}}r3.className="AlphaDropout";de(r3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ld(t,e,n,s,i,r=.001){let o;if(t.rank===2)o=qZ(t,e,n,s,i,r);else if(t.rank===3)o=XZ(t,e,n,s,i,r);else if(t.rank===4)o=YZ(t,e,n,s,i,r);else throw new Ue(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function Tse(t,e,n,s,i=.001){return Q(()=>{const r=tI(t,s),o=r.mean,a=r.variance;return[Ld(t,o,a,n,e,i),o,a]})}function Ese(t,e,n,s,i=.001){return Q(()=>{const r=tI(t,s),o=r.mean,a=r.variance,l=[];for(const g of Qi(0,t.rank))s.indexOf(g)!==-1?l.push(1):l.push(t.shape[g]);const c=G(o,l),h=G(a,l),d=e==null?null:G(e,l),f=n==null?null:G(n,l);return[Ld(t,c,h,f,d,i),o,a]})}function Nse(t,e,n,s,i=.001){return ct(s.slice().sort(),Qi(0,t.rank-1))?Tse(t,e,n,s,i):Ese(t,e,n,s,i)}class _k extends He{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ot(e.betaInitializer||"zeros"),this.gammaInitializer=Ot(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ot(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ot(e.movingVarianceInitializer||"ones"),this.betaConstraint=fn(e.betaConstraint),this.gammaConstraint=fn(e.gammaConstraint),this.betaRegularizer=Lt(e.betaRegularizer),this.gammaRegularizer=Lt(e.gammaRegularizer)}build(e){e=st(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new B(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new un({ndim:e.length,axes:{[n]:s}})];const i=[s];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return Q(()=>{const s=n.training==null?!1:n.training,i=De(e),r=i.shape,o=r.length,a=Qi(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=Nl(1,o);c[l]=r[l];const h=a.slice();h.sort();const d=!ct(h,Qi(0,o).slice(0,o-1)),f=()=>{if(d){const w=G(this.movingMean.read(),c),b=G(this.movingVariance.read(),c),I=this.center?G(this.beta.read(),c):null,S=this.scale?G(this.gamma.read(),c):null;return Ld(i,w,b,I,S,this.epsilon)}else return Ld(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[m,g,x]=Nse(i,this.gamma.read(),this.beta.read(),a,this.epsilon),_=(w,b,I)=>{Q(()=>{const S=1-I,T=w.read(),$=U(Ae(T,b),S);w.write(Ae(T,$))})};return(()=>{_(this.movingMean,g,this.momentum),_(this.movingVariance,x,this.momentum)})(),m})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mt(this.betaInitializer),gammaInitializer:Mt(this.gammaInitializer),movingMeanInitializer:Mt(this.movingMeanInitializer),movingVarianceInitializer:Mt(this.movingVarianceInitializer),betaRegularizer:_t(this.betaRegularizer),gammaRegularizer:_t(this.gammaRegularizer),betaConstraint:dn(this.betaConstraint),gammaConstraint:dn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}_k.className="BatchNormalization";de(_k);class o3 extends He{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ot(e.betaInitializer||"zeros"),this.gammaInitializer=Ot(e.gammaInitializer||"ones"),this.betaRegularizer=Lt(e.betaRegularizer),this.gammaRegularizer=Lt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=st(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=n);for(const r of this.axis)if(r<0||r>=n)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==Zo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(r=>e[r]),i=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,n){const s=De(e),i=s.shape,r=i.length;return Q(()=>{let{mean:a,variance:l}=tI(s,this.axis,!0);const c=Nl(1,r);for(const x of this.axis)c[x]=i[x];const h=x=>x!=null&&x.shape.length!==r?G(x,c):x;let d=this.scale?h(this.gamma.read()):null,f=this.center?h(this.beta.read()):null;const m=[],g=[];for(let x=0;x<r;++x)this.axis.indexOf(x)!==-1?(m.push(i[x]),g.push(1)):(m.push(1),g.push(i[x]));return a=Bi(a,m),l=Bi(l,m),d!=null&&(d=Bi(d,g)),f!=null&&(f=Bi(f,g)),Ld(s,a,l,f,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mt(this.betaInitializer),gammaInitializer:Mt(this.gammaInitializer),betaRegularizer:_t(this.betaRegularizer),gammaRegularizer:_t(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}o3.className="LayerNormalization";de(o3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $se(t,e,n){return Q(()=>{if(t.rank!==4)throw new B(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new B("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Ji()),n!=="channelsLast"&&n!=="channelsFirst")throw new B(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],nI(t,s)})}class a3 extends He{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ji():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new B(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new B(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new B(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){e=st(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return Q(()=>$se(De(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}a3.className="ZeroPadding2D";de(a3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gx(t,e,n,s,i,r){return Q(()=>{Yt(i),SF(r),Ys(s),n==null&&(n=[1,1]),s==null&&(s="valid"),i==null&&(i=Ji()),r==null&&(r="max"),t=fk(t,i);let o;const a=s==="same"?"same":"valid";return r==="max"?o=eI(t,e,n,a):o=jC(t,e,n,a),i==="channelsFirst"&&(o=Je(o,[0,3,1,2])),o})}function l3(t,e,n,s,i,r){return Q(()=>{Yt(i),SF(r),Ys(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),i==null&&(i=Ji()),r==null&&(r="max"),t=EM(t,i);let o;const a=s==="same"?"same":"valid";return r==="max"?o=O9(t,e,n,a):o=FZ(t,e,n,a),i==="channelsFirst"&&(o=Je(o,[0,4,1,2,3])),o})}class c3 extends He{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new B(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Cn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new B(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ys(this.padding),this.inputSpec=[new un({ndim:3})]}computeOutputShape(e){e=st(e);const n=qi(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return Q(()=>{this.invokeCallHook(e,n),e=dp(De(e),2);const s=this.poolingFunction(De(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return op(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class u3 extends c3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),gx(e,n,s,i,r,"max")}}u3.className="MaxPooling1D";de(u3);class h3 extends c3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),gx(e,n,s,i,r,"avg")}}h3.className="AveragePooling1D";de(h3);class d3 extends He{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new B(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Cn(this.poolSize,"poolSize"),Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),Ys(this.padding),this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){e=st(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=qi(n,this.poolSize[0],this.padding,this.strides[0]),s=qi(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return Q(()=>(this.invokeCallHook(e,n),this.poolingFunction(De(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class wk extends d3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),gx(e,n,s,i,r,"max")}}wk.className="MaxPooling2D";de(wk);class f3 extends d3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),gx(e,n,s,i,r,"avg")}}f3.className="AveragePooling2D";de(f3);class p3 extends He{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new B(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Cn(this.poolSize,"poolSize"),Cn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),Ys(this.padding),this.inputSpec=[new un({ndim:5})]}computeOutputShape(e){e=st(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=qi(n,this.poolSize[0],this.padding,this.strides[0]),s=qi(s,this.poolSize[1],this.padding,this.strides[1]),i=qi(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,i]:[e[0],n,s,i,e[4]]}call(e,n){return Q(()=>(this.invokeCallHook(e,n),this.poolingFunction(De(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class m3 extends p3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),l3(e,n,s,i,r,"max")}}m3.className="MaxPooling3D";de(m3);class g3 extends p3{constructor(e){super(e)}poolingFunction(e,n,s,i,r){return Yt(r),Ys(i),l3(e,n,s,i,r,"avg")}}g3.className="AveragePooling3D";de(g3);class y3 extends He{constructor(e){super(e),this.inputSpec=[new un({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Ue}}class v3 extends y3{constructor(e){super(e||{})}call(e,n){return Q(()=>{const s=De(e);return nn(s,1)})}}v3.className="GlobalAveragePooling1D";de(v3);class x3 extends y3{constructor(e){super(e||{})}call(e,n){return Q(()=>{const s=De(e);return Hi(s,1)})}}x3.className="GlobalMaxPooling1D";de(x3);class _3 extends He{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Yt(this.dataFormat),this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Ue}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class w3 extends _3{call(e,n){return Q(()=>{const s=De(e);return this.dataFormat==="channelsLast"?nn(s,[1,2]):nn(s,[2,3])})}}w3.className="GlobalAveragePooling2D";de(w3);class b3 extends _3{call(e,n){return Q(()=>{const s=De(e);return this.dataFormat==="channelsLast"?Hi(s,[1,2]):Hi(s,[2,3])})}}b3.className="GlobalMaxPooling2D";de(b3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class C3 extends He{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const i=n.layer,r=Sr(i,s);delete n.layer;const o={layer:r};return Object.assign(o,n),new e(o)}}class I3 extends C3{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=st(e),e.length<3)throw new B(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=st(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),i=e[1];return[s[0],i].concat(s.slice(1))}call(e,n){return Q(()=>(e=De(e),FM((o,a)=>[De(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}I3.className="TimeDistributed";de(I3);function Rse(t){Zl(Kte,"BidirectionalMergeMode",t)}const Ase="concat";class k3 extends C3{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=Sr(s),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=e.layer.getClassName(),i.config=n,this.backwardLayer=Sr(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Ase:e.mergeMode,Rse(this.mergeMode),e.weights)throw new Ue("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,i,r;return this.returnState&&(r=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,i=[s]):this.mergeMode==null?i=[s,s.slice()]:i=[s],this.returnState?this.mergeMode==null?i.concat(r).concat(r.slice()):[s].concat(r).concat(r.slice()):us(i)}apply(e,n){let s=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const r=LM(e,s,i,this.numConstants);if(e=r.inputs,s=r.initialState,i=r.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&i==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new B("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const h=s.map(d=>new un({shape:d.shape}));this.forwardLayer.stateSpec=h.slice(0,c/2),this.backwardLayer.stateSpec=h.slice(c/2),a.push(...h)}if(i!=null)throw new Ue("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Rr;for(const c of o)if(c instanceof Rr!==l)throw new B("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const f=super.apply(c,n);return this.inputSpec=d,f}else return super.apply(e,n)}call(e,n){return Q(()=>{const s=n.initialState;let i,r;if(s==null)i=this.forwardLayer.call(e,n),r=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);i=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),r=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(r.slice(1))),i=i[0],r=r[0]),this.returnSequences&&(r=Tl(r,1));let a;return this.mergeMode==="concat"?a=ek([i,r]):this.mergeMode==="sum"?a=pe(i,r):this.mergeMode==="ave"?a=U(.5,pe(i,r)):this.mergeMode==="mul"?a=U(i,r):this.mergeMode==null&&(a=[i,r]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ol(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ol(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const r=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(r).concat(r):[s].concat(r).concat(r)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=Sr(n.layer);if(delete n.layer,n.numConstants!=null)throw new Ue("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=s,new e(i)}}k3.className="Bidirectional";de(k3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class S3 extends He{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Q(()=>(e=De(e),e.dtype!=="float32"&&(e=Ir(e,"float32")),pe(U(e,this.scale),this.offset)))}}S3.className="Rescaling";de(S3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:Dse,cropAndResize:Pse}=Xr;class T3 extends He{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,i,r,o,a,l){return Q(()=>{let c,h=!1;const d=n/o,f=s/a,m=(i+n)/o,g=(r+s)/a,x=[d,f,m,g],_=[];e.rank===3?(h=!0,c=ao([e])):c=e;for(let S=0;S<c.shape[0];S++)_.push(x);const v=Zh(_,[_.length,4]),w=Dd(0,_.length,1,"int32"),I=Pse(c,v,w,[i,r],"nearest");return Ir(h?De(El(I)):I,l)})}upsize(e,n,s,i){return Q(()=>{const r=Dse(e,[n,s]);return Ir(r,i)})}call(e,n){return Q(()=>{const s=De(e),i=s.dtype,r=s.shape,o=r[r.length-3],a=r[r.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,o,a,i):this.upsize(e,this.height,this.width,i)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=st(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}T3.className="CenterCrop";de(T3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ose(t,e,n,s){let i=De(t);if(i.dtype!=="int32"&&(i=Ir(i,"int32")),e==="int")return i;const r=i.shape;if(i.rank===0&&(i=cs(i,-1)),e==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=cs(i,-1)),i.rank>2)throw new B(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${r} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(e),a=i;let l;if(typeof s<"u"&&e==="count"?l=qN(a,s,n,o):l=qN(a,[],n,o),e!=="tfIdf")return l;if(s)return U(l,s);throw new B("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class E3 extends He{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=st(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return Q(()=>{e=De(e),e.dtype!=="int32"&&(e=Ir(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new B(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=De(n.countWeights)}const i=Hi(e),r=zg(e),o=Zs(this.numTokens,i).bufferSync().get(0),a=Hl(r,0).bufferSync().get(0);if(!(o&&a))throw new B(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Ose(e,this.outputMode,this.numTokens,s)})}}E3.className="CategoryEncoding";de(E3);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Lse=["bilinear","nearest"],E2=new Set(Lse);class N3 extends He{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(E2.has(e.interpolation))this.interpolation=e.interpolation;else throw new B(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=st(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Q(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Xr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...E2]} are supported`)})}}N3.className="Resizing";de(N3);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $3{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}$3.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class R3 extends He{constructor(e){super(e),this.randomGenerator=new $3(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}R3.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Fse=["bilinear","nearest"],N2=new Set(Fse);class A3 extends R3{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new B(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new B(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new B(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(N2.has(s))this.interpolation=s;else throw new B(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=st(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return Q(()=>{const s=De(e);this.imgHeight=s.shape[s.shape.length-3];const i=s.shape[s.shape.length-2];this.widthFactor=rp([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*i;r=Math.round(r);const o=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return Xr.resizeBilinear(e,o);case"nearest":return Xr.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...N2]} are supported`)}})}}A3.className="RandomWidth";de(A3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function n0(t){return new Fu(t)}function s0(t){return new vk(t)}function $2(t){return new mx(t)}function Mse(t){return new xk(t)}function i0(t){return new _k(t)}function r0(t){return new wk(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse=ee();zse.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var R2;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(R2||(R2={}));var A2;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(A2||(A2={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var D2;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(D2||(D2={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ie(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&R(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bse=$L;class yx extends G1{nextDataId(){return yx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new QP(this,ur())}write(e,n,s){this.firstUse&&(this.firstUse=!1,ee().get("IS_NODE")&&Bs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:s,refCount:1}),i}makeTensorInfo(e,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&rf(s[0])){const r=s.map(o=>Xo(o));i=this.write(r,e,n)}else i=this.write(s,e,n);return{dataId:i,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,i,r){this.data.set(e,{values:n,dtype:i,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const i=this.readSync(s.real.dataId),r=this.readSync(s.imag.dataId);return lo(i,r)}return B8(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(i=>ta(i));return je(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return je(e.shape,e.dtype,n)}makeOutput(e,n,s){return ur().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=ls();return e(),{kernelMs:ls()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ie([e],"where");const n=this.readSync(e.dataId);return Bse(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}yx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Use=t=>{const{x:e}=t.inputs,n=t.backend;Ie(e,"abs");let s=new Float32Array(re(e.shape));const i=n.data.get(e.dataId).values;return s=D3(i),n.makeOutput(s,e.shape,e.dtype)},Wse={kernelName:Xy,backendName:"cpu",kernelFunc:Use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qt(t){return(e,n,s,i,r)=>{const o=ze(e,n),a=o.length,l=Te(o),c=re(o),h=Wn(r,c),d=e.length,f=n.length,m=Te(e),g=Te(n),x=uu(e,o),_=uu(n,o);if(x.length+_.length===0)for(let v=0;v<h.length;++v)h[v]=t(s[v%s.length],i[v%i.length]);else for(let v=0;v<h.length;++v){const w=$u(v,a,l),b=w.slice(-d);x.forEach($=>b[$]=0);const I=wr(b,d,m),S=w.slice(-f);_.forEach($=>S[$]=0);const T=wr(S,f,g);h[v]=t(s[I],i[T])}return[h,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bs(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",r),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const Vse={kernelName:rC,backendName:"cpu",kernelFunc:bs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ey(t,e,n="float32"){if(n==="complex64"){const i=ey(t,e,"float32"),r=ey(t,e,"float32");return bs({inputs:{real:i,imag:r},backend:t})}const s=Vn(re(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ar(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const jse={kernelName:Sf,backendName:"cpu",kernelFunc:Ar};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.real,r=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,r)}const Gse={kernelName:NC,backendName:"cpu",kernelFunc:$l};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P3(t,e,n,s){if(s==="int32"){const i=Int32Array.from(t);return[e,"int32",i]}if(s==="bool"){const i=Gl([0],n),[r,o]=Qt((a,l)=>a!==l?1:0)(e,[],t,i,"bool");return[o,"bool",r]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function oa(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:r}=s;if(r==="complex64"){if(i.dtype==="complex64")return Ar({inputs:{x:i},backend:n});const h=ey(n,i.shape,i.dtype),d=oa({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),f=bs({inputs:{real:d,imag:h},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),f}if(i.dtype==="complex64"){const h=$l({inputs:{input:i},backend:n}),d=oa({inputs:{x:h},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(h),d}if(!eO(i.dtype,r)){const h=Ar({inputs:{x:i},backend:n});return{dataId:h.dataId,shape:h.shape,dtype:r}}const o=n.data.get(i.dataId).values,[a,l,c]=P3(o,i.shape,i.dtype,r);return n.makeTensorInfo(a,l,c)}const Hse={kernelName:ff,backendName:"cpu",kernelFunc:oa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mn(t,e,n,s){return n==null?({inputs:i,backend:r})=>{const{a:o,b:a}=i,l=r;Ie([o,a],t);const c=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,d=o.dtype==="string"?co(c):c,f=o.dtype==="string"?co(h):h,m=s||o.dtype,[g,x]=e(o.shape,a.shape,d,f,m);return l.makeTensorInfo(x,m,g)}:({inputs:i,backend:r})=>{const{a:o,b:a}=i,l=r;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=oa({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(c.dataId),d=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,m=l.data.get(d.dataId).values,g=l.data.get(f.dataId).values,x=oa({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),_=l.data.get(x.dataId),v=_.complexTensorInfos.real,w=_.complexTensorInfos.imag,b=l.data.get(v.dataId).values,I=l.data.get(w.dataId).values,[S,T,$]=n(o.shape,a.shape,m,g,b,I),E=l.makeTensorInfo($,"float32",S),D=l.makeTensorInfo($,"float32",T),P=bs({inputs:{real:E,imag:D},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(x),l.disposeIntermediateTensorInfo(E),l.disposeIntermediateTensorInfo(D),P}else{const c=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,d=s||o.dtype,[f,m]=e(o.shape,a.shape,c,h,d);return l.makeTensorInfo(m,d,f)}}}function bk(t){return(e,n,s,i,r,o)=>{const a=ze(e,n),l=re(a),c=a.length,h=Te(a),d=Wn("float32",l),f=Wn("float32",l),m=uu(e,a),g=uu(n,a),x=lo(s,i),_=lo(r,o),v=e.length,w=Te(e),b=n.length,I=Te(n);if(m.length+g.length===0)for(let S=0;S<d.length;S++){const T=S%x.length,$=S%_.length,E=t(x[T*2],x[T*2+1],_[$*2],_[$*2+1]);d[S]=E.real,f[S]=E.imag}else for(let S=0;S<d.length;S++){const T=$u(S,c,h),$=T.slice(-v);m.forEach(V=>$[V]=0);const E=wr($,v,w),D=T.slice(-b);g.forEach(V=>D[V]=0);const P=wr(D,b,I),z=t(x[E*2],x[E*2+1],_[P*2],_[P*2+1]);d[S]=z.real,f[S]=z.imag}return[d,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3=Qt((t,e)=>t+e),qse=bk((t,e,n,s)=>({real:t+n,imag:e+s})),pu=mn(Ru,O3,qse),Kse={kernelName:Ru,backendName:"cpu",kernelFunc:pu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ck(t,e,n,s,i){const r=re(s),o=Vn(i,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=i||(r>0?o[l]+=e[a]:o[l]+=1)}return o}function L3(t,e,n,s=!1){const i=t.shape[0],r=t.shape[1],o=je([i,n],e.dtype);for(let a=0;a<i;a++)for(let l=0;l<r;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3=Qt((t,e)=>t&e),Xse=mn(iC,F3),Zse={kernelName:iC,backendName:"cpu",kernelFunc:Xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Or(t){return(e,n,s)=>{const i=qt(n,e.length);for(let r=0;r<e.length;++r)i[r]=t(e[r],s);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mt(t,e,n){const s=Or(e);return ka(t,s,n)}function ka(t,e,n){return({inputs:s,attrs:i,backend:r})=>{const{x:o}=s;Ie(o,t);const a=r,l=a.data.get(o.dataId).values;let c;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=co(l)}else c=l;const h=n||o.dtype,d=e(c,h,i);return a.makeTensorInfo(o.shape,h,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M3=Or(t=>Math.ceil(t)),Yse=ka(pf,M3),Qse={kernelName:pf,backendName:"cpu",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3(t,e,n,s){const i=qt(n,re(e));if(s&&n!=="string"){let r=0;t.forEach(o=>{const a=re(o.shape);i.set(o.vals,r),r+=a})}else{let r=0;t.forEach(o=>{const a=n==="string"?co(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const h=c*e[1]+r;for(let d=0;d<o.shape[1];++d)i[h+d]=a[l++]}r+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B3=Qt((t,e)=>t===e?1:0),U3=mn(uv,B3,null,"bool"),Jse={kernelName:uv,backendName:"cpu",kernelFunc:U3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W3=Or(t=>Math.exp(t)),V3=ka(wf,W3,"float32"),eie={kernelName:wf,backendName:"cpu",kernelFunc:V3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3=Or(t=>Math.expm1(t)),tie=ka(bf,j3),nie={kernelName:bf,backendName:"cpu",kernelFunc:tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G3=Or(t=>Math.floor(t)),sie=ka(Cf,G3),iie={kernelName:Cf,backendName:"cpu",kernelFunc:sie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3=Qt((t,e)=>Math.floor(t/e)),rie=mn(If,H3,null,"int32"),oie={kernelName:If,backendName:"cpu",kernelFunc:rie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q3(t,e,n,s,i,r,o,a,l){const c=je([s,r],n);for(let h=0;h<s;h++){const d=[];let f=0;for(let m=0;m<i;m++){const g=t[h*i+m];f+=g*o[m],d.push(g)}if(f<0||f>=l/r)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let m=0;m<r;m++)c.values[h*r+m]=e.get(...e.indexToLoc(f*r+m))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K3(t,e,n){const s=je(n,t.dtype);for(let i=0;i<s.size;++i){const o=s.indexToLoc(i).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const h=t.locToIndex(o);0<=h&&h<t.values.length&&(s.values[i]=t.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X3=Qt((t,e)=>t>e?1:0),aie=mn(pv,X3,null,"bool"),lie={kernelName:pv,backendName:"cpu",kernelFunc:aie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z3=Qt((t,e)=>t>=e?1:0),cie=mn(kf,Z3,null,"bool"),uie={kernelName:kf,backendName:"cpu",kernelFunc:cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y3=Qt((t,e)=>t<e?1:0),hie=mn(gv,Y3,null,"bool"),die={kernelName:gv,backendName:"cpu",kernelFunc:hie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3=Qt((t,e)=>t<=e?1:0),fie=mn(yv,Q3,null,"bool"),pie={kernelName:yv,backendName:"cpu",kernelFunc:fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J3(t,e,n){const s=(e-t)/(n-1),i=Vn(n,"float32");i[0]=t;for(let r=1;r<i.length;r++)i[r]=i[r-1]+s;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ez=Or(t=>Math.log(t)),mie=ka($f,ez),gie={kernelName:$f,backendName:"cpu",kernelFunc:mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(t,e,n,s){const i=Wn(s,re(n));for(let r=0;r<i.length;++r){const o=r*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}i[r]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nz=Qt((t,e)=>Math.max(t,e)),yie=mn(Af,nz),vie={kernelName:Af,backendName:"cpu",kernelFunc:yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sz=Qt((t,e)=>Math.min(t,e)),xie=mn(Df,sz),_ie={kernelName:Df,backendName:"cpu",kernelFunc:xie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ik=Qt((t,e)=>t*e),wie=bk((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),vx=mn(Of,Ik,wie),bie={kernelName:Of,backendName:"cpu",kernelFunc:vx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(t,e,n){const s=ya(-1,n);return Ik([],e,s,t,n)}function Cie(t){const{inputs:e,backend:n}=t,{x:s}=e;Ie(s,"neg");const i=n.data.get(s.dataId).values,[r,o]=iz(i,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,r)}const Iie={kernelName:Ev,backendName:"cpu",kernelFunc:Cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rz=Qt((t,e)=>t!==e?1:0),kie=mn(Nv,rz,null,"bool"),Sie={kernelName:Nv,backendName:"cpu",kernelFunc:kie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kk(t,e,n,s,i){const r=e.length,o=re(e),a=Te(e),l=Te(i),c=Wn(n,re(i));for(let h=0;h<o;++h){const d=$u(h,r,a),f=new Array(d.length);for(let g=0;g<f.length;g++)f[g]=d[s[g]];const m=wr(f,r,l);c[m]=t[h]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ms(t){const{inputs:e,attrs:n,backend:s}=t,{x:i}=e,{perm:r}=n;Ie(i,"transpose");const o=i.shape.length,a=new Array(o);for(let d=0;d<a.length;d++)a[d]=i.shape[r[d]];const l=s.data.get(i.dataId).values,c=kk(l,i.shape,i.dtype,r,a);return{dataId:s.write(c,a,i.dtype),shape:a,dtype:i.dtype}}const Tie={kernelName:Hc,backendName:"cpu",kernelFunc:ms};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oz(t,e,n,s){const[i,r]=In(t,s),o=Ds(e,"int32"),a=Vn(re(i),o),l=re(r);for(let c=0;c<a.length;++c){const h=c*l;let d=1;for(let f=0;f<l;++f)d*=n[h+f];a[c]=d}return{outVals:a,outShape:i,outDtype:o}}function Eie(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"prod");const a=i.shape.length,l=Ge(r,i.shape),c=Bt(l,a);let h=l,d=i;const f=[];c!=null&&(d=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),f.push(d),h=Zt(h.length,a));const m=n.data.get(d.dataId).values,{outVals:g,outShape:x,outDtype:_}=oz(d.shape,d.dtype,m,h);let v=x;return o&&(v=sn(x,l)),f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(v,_,g)}const Nie={kernelName:Ov,backendName:"cpu",kernelFunc:Eie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ie(t,e,n){t.forEach((s,i)=>{if(s<0||s>=n){const r=$u(i,e.length,Te(e)).join(",");throw new Error(`indices[${r}] = ${s} is not in [0, ${n})`)}})}function Rie(t,e){for(let n=0;n<t.length;++n){const s=t[n],i=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>i)throw new Error("Ragged splits must not point past values");for(let r=1;r<s.length;++r)if(s[r-1]>s[r])throw new Error("Ragged splits must be sorted in ascending order")}}function Aie(t,e,n,s){const i=[];let r=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);Rie(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const h=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*h)}for(let c=0;c<t.length;++c){let h=t[c],d=t[c]+1;for(let f=0;f<n.length;++f){const m=n[f],g=f+e.length-1;if(g>=0){const x=a[g],_=x[x.length-1]-m[h];for(let v=h;v<d;++v)a[g].push(m[v+1]+_)}h=m[h],d=m[d]}d!==h&&(i.push([h,d]),r+=d-h)}return{outSplits:a,valueSlices:i,numValues:r}}function Die(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,i=qt("int32",s);e.push(i),t[n].forEach((r,o)=>i[o]=r)}return e}function P2(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function Pie(t,e,n,s,i,r){const o=P2(e,2)[1],a=P2(r,2)[1];let l=0;for(const c of n)for(let h=c[0];h<c[1];++h){for(let d=0;d<s;++d)i[l*a+d]=t[h*o+d];++l}}function Oie(t,e,n,s,i){const r=e.slice();r[0]=i;const o=qt(n,re(r)),a=t.length,l=a===0?0:a/e[0];return Pie(t,e,s,l,o,r),[o,r]}function az(t,e,n,s,i,r,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if($ie(r,o,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:h,valueSlices:d,numValues:f}=Aie(r,o,t,c),m=Die(h),g=Oie(n,s,i,d,f);return[m,g[0],g[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O2=2147483647;function lz(t,e,n,s,i,r,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=i.length===0,c=o.length===0,h=[];a||h.push(e[0]),l||h.push(i[0]),c||h.push(o[0]);for(let _=1;_<h.length;++_)if(h[_]!==h[_-1])throw new Error("starts, limits, and deltas must have the same shape");const d=h.length===0?1:h[0],f=qt("int32",d+1);f[0]=0;for(let _=0;_<d;++_){const v=a?t[0]:t[_],w=l?s[0]:s[_],b=c?r[0]:r[_];if(b===0)throw new Error("Requires delta != 0");let I;if(b>0&&w<v||b<0&&w>v)I=0;else if(I=Math.ceil(Math.abs((w-v)/b)),I>O2)throw new Error(`Requires ((limit - start) / delta) <= ${O2}`);f[_+1]=f[_]+I}const m=f[d],g=qt(n,m);let x=0;for(let _=0;_<d;++_){const v=f[_+1]-f[_];let w=a?t[0]:t[_];const b=c?r[0]:r[_];for(let I=0;I<v;++I)g[x++]=w,w+=b}return[f,g]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ii=Mi;class ty{constructor(e,n,s,i,r,o,a,l,c,h){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=i,this.valuesDType=r,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=YL(h),this.raggedRank=QL(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ii.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ii.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ii.VALUE_ROWIDS:return ty.getMaxWidthValueRowID(n);case ii.ROW_SPLITS:return ty.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ii[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let i=0;i<n-1;++i){const r=e[i+1]-e[i];r>s&&(s=r)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,i=e[0],r=0;for(let o=1;o<n;++o){const a=e[o];a!==i&&(i=a,r=Math.max(o-s,r),s=o)}return Math.max(n-s,r)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return F2(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;JL(s,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=ZL(this.raggedRank,i,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const i=Math.min(e,s),r=[];let o=0;for(let a=0;a<i;++a,o+=n)r.push(o);for(let a=i;a<e;++a)r.push(-1);return R(r.length===e,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(e,n,s,i){const r=e.length,o=[];for(let a=0;a<r-1;++a){const l=e[a+1]-e[a];let c=Math.min(i,l),h=n[a];h===-1&&(c=0);for(let d=0;d<c;++d)o.push(h),h+=s;for(let d=0;d<l-c;++d)o.push(-1)}if(r>0&&o.length!==e[r-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,i){const r=e.length,o=[];if(r===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];o.push(c);for(let h=1;h<r;++h){const d=e[h];if(d===l)c>=0&&(++a,a<i?c+=s:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,i){const r=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ii.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,n,s,i);case ii.ROW_SPLITS:if(r.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${r.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(r,n,s,i);default:throw new Error(`Unsupported partition type: ${ii[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case ii.FIRST_DIM_SIZE:return e[0];case ii.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ii.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ii[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let l=i.length-2;l>=0;--l)i[l]=i[l+1]*s[l+1];const r=F2(s,!1),o=qt(this.valuesDType,re(r));if(i[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,i[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,i[c],s[c]);this.setOutput(this.raggedRank,l,o,r)}return[r,o]}setOutput(e,n,s,i){if(s.length===0)return;const r=this.values,o=s;let a=i.slice();a=a.slice(e+1);const l=re(a),c=n.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const g=this.defaultValueShape;Q(()=>{const x=G(h,g);h=Yh(x,a).dataSync()})}let d=0,f=0,m=0;for(let g=0;g<=c;++g){let x=g<c?n[g]:-1;if(x===m){++m;continue}if(f<m){const _=r.subarray(d*l),v=o.subarray(f*l),w=(m-f)*l;L2(v,_,w)}if(g>=c){const _=s.length;x=Math.floor(_/l)}if(x>m)if(this.defaultValue.length===1)o.subarray(m*l,x*l).fill(this.defaultValue[0]),m=x;else for(;x>m;){const _=o.slice(m*l);L2(_,h,l),++m}x<0?(d=g+1,f=m):(d=g,f=m,m=f+1)}}}function L2(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function F2(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function cz(t,e,n,s,i,r,o,a,l,c){return new ty(t,e,n,s,i,r,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(t,e,n,s){const i=t===e,r=t<e&&n<0,o=e<t&&n>1;if(i||r||o)return Vn(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=Vn(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hz=Or(t=>1/Math.sqrt(t)),Lie=ka(Uf,hz),Fie={kernelName:Uf,backendName:"cpu",kernelFunc:Lie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function el(t,e,n,s,i,r,o,a,l,c){const h=[s/i,i],d=t.values,f=e.values;if(s===0)return je(n,e.dtype);const m=l instanceof An?l:je(h,e.dtype);typeof l=="string"||typeof l=="number"?m.values.fill(l):typeof l=="boolean"&&m.values.fill(+l);for(let g=0;g<r;g++){const x=[];let _=0;for(let v=0;v<o;v++){const w=d[g*o+v];x.push(w),_+=w*a[v]}if(_<0||_>=s/i)throw new Error(`Invalid indices: ${x} does not index into ${n}`);for(let v=0;v<i;v++)c?m.values[_*i+v]+=f[g*i+v]:m.values[_*i+v]=e.rank===0?f[0]:f[g*i+v]}return m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mie=Or(t=>1/(1+Math.exp(-t))),dz=mt(Hf,t=>1/(1+Math.exp(-t))),zie={kernelName:Hf,backendName:"cpu",kernelFunc:dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(t,e,n,s,i){const r=NI(s,e,n),o=re(n),a=Te(s);if(r){const d=$I(e,a);return i==="string"?t.slice(d,d+o):t.subarray(d,d+o)}const l=i==="string"?co(t):t,c=je(s,i,l),h=je(n,i);for(let d=0;d<h.size;++d){const f=h.indexToLoc(d),m=f.map((g,x)=>g+e[x]);h.set(c.get(...m),...f)}return i==="string"?xF(h.values):h.values}function Rl(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,size:o}=s;Ie(i,"slice");const[a,l]=nx(i,r,o);TI(i,a,l);const c=n.data.get(i.dataId).values,h=fz(c,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,h)}const Bie={kernelName:Uv,backendName:"cpu",kernelFunc:Rl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pz(t,e,n,s,i,r,o){const a=e[0],l=r[0],c=new Array(l),h=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(oF(a));const _=qt(n,0),v=qt(i,0);return[_,[0,d],v,c,h]}let f=!0,m=0;const g=new Array(l).fill(0);for(let _=0;_<a;++_){const v=t[_*d];if(v<0)throw new Error(aF(_,v));if(v>=l)throw new Error(lF(_,v,l));++g[v],f=f&&v>=m,m=v}let x=!0;for(let _=0;_<l;++_){const v=g[_]===0;c[_]=v,x=x&&!v,g[_]=Math.max(g[_],1),_>0&&(g[_]+=g[_-1])}if(x&&f){const _=t,v=s;for(let w=0;w<a;++w)h[w]=w;return[_,[a,d],v,c,h]}else{const _=g[l-1],v=qt(n,_*d),w=qt(i,_),b=new Array(l).fill(0);for(let I=0;I<a;++I){const S=t[I*d],T=b[S],$=(S===0?0:g[S-1])+T;b[S]++;for(let E=0;E<d;++E)v[$*d+E]=t[I*d+E];w[$]=s[I],h[I]=$}for(let I=0;I<l;++I)if(b[I]===0){const T=I===0?0:g[I-1];v[T*d+0]=I;for(let $=1;$<d;++$)v[T*d+$]=0;w[T]=o}return[v,[_,d],w,c,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mz(t,e,n,s,i){const r=re(s),o=e[0],a=i.length,l=[];let c=1,h=-1;for(let _=0;_<a;++_){const v=i[_];if(v===-1){if(h!==-1)throw new Error(cF(h,_));h=_,l.push(1)}else{if(v<0)throw new Error(uF(_,v));c*=v,l.push(v)}}if(h!==-1){if(c<=0)throw new Error(hF());const _=Math.trunc(r/c);if(c*_!==r)throw new Error(dF(s,l));l[h]=_}if(re(l)!==r)throw new Error(fF(s,l));const f=s.length,m=[];if(f>0){m[f-1]=1;for(let _=f-2;_>=0;--_)m[_]=m[_+1]*s[_+1]}const g=[];if(a>0){g[a-1]=1;for(let _=a-2;_>=0;--_)g[_]=g[_+1]*l[_+1]}const x=qt(n,o*a);for(let _=0;_<o;++_){let v=0;for(let w=0;w<f;++w)v+=t[_*f+w]*m[w];for(let w=0;w<a;++w)x[_*a+w]=Math.trunc(v/g[w]),v%=g[w]}return[x,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sk(t,e,n,s,i,r=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?i[a-1]+1:0;if(d<0)throw new Error(Yw());const f=e.slice();f[0]=d;const m=f.reduce((b,I)=>b*I,1),g=qt(n,m);if(a===0)return d>0&&g.fill(o),[g,f];if(d<=0)throw new Error(Yw());let x=0,_=1,v=0,w=i[x];for(;;){let b=0;if(_<a){if(b=i[_],w===b){++_;continue}if(w>=b)throw new Error(pF())}if(w<0||w>=d)throw new Error(mF(w,d));w>v&&g.fill(o,v*c,w*c);for(let I=x;I<_;++I){const S=s[I];if(S<0||S>=l[0])throw new Error(gF(I,s[I],l[0]));for(let T=0;T<c;T++)g[w*c+T]+=t[S*c+T]}if(r)for(let I=0;I<c;I++)g[w*c+I]/=_-x;if(x=_,++_,v=w+1,w=b,_>a)break}return v<d&&g.fill(o,v*c,d*c),[g,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uie=Or(t=>Math.sqrt(t)),Wie=mt(Kf,t=>Math.sqrt(t)),Vie={kernelName:Kf,backendName:"cpu",kernelFunc:Wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gz=Qt((t,e)=>{const n=t-e;return n*n}),jie=mn(Xf,gz),Gie={kernelName:Xf,backendName:"cpu",kernelFunc:jie};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yz=Or((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:i}=e;return t.replace(new RegExp(n,s?"g":""),i)}),Hie=ka(DC,yz),qie={kernelName:DC,backendName:"cpu",kernelFunc:Hie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(t,e,n,s){const i=je(t,e.dtype);for(let r=0;r<i.size;r++){const o=i.indexToLoc(r),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];i.set(e.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kie{constructor(e,n,s,i,r,o){this.separator=Xo(e),this.nGramWidths=n,this.leftPad=Xo(s),this.rightPad=Xo(i),this.padWidth=r,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,i,r,o){for(let a=0;a<r;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),h=Math.max(0,l-(r-(a+1))),d=o-(c+h),f=n+(c>0?0:a-l);let m=0;m+=c*this.leftPad.length;for(let w=0;w<d;++w)m+=e[f+w].length;m+=h*this.rightPad.length;const g=c+h+d-1;m+=g*this.separator.length,s[i+a]=new Uint8Array(m);const x=s[i+a];let _=0;const v=w=>w.forEach(b=>x[_++]=b);for(let w=0;w<c;++w)v(this.leftPad),v(this.separator);for(let w=0;w<d-1;++w)v(e[f+w]),v(this.separator);if(d>0){v(e[f+d-1]);for(let w=0;w<h;++w)v(this.separator),v(this.rightPad)}else{for(let w=0;w<h-1;++w)v(this.rightPad),v(this.separator);v(this.rightPad)}}}compute(e,n){const s=e.length,i=n.length;if(i>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<i;++c){let h=n[c]>=l;if(h=h&&n[c]<=s,!h)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const r=i-1,o=qt("int32",i);if(s===0||i===0){const l=new Array(s);for(let c=0;c<=r;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=r;++l){const c=n[l]-n[l-1];let h=0;this.nGramWidths.forEach(d=>{h+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&h===0&&(h=1),o[l]=o[l-1]+h}const a=new Array(o[r]);for(let l=0;l<r;++l){const c=n[l];let h=o[l];if(this.nGramWidths.forEach(d=>{const f=n[l+1]-n[l],m=this.getNumNGrams(f,d);this.createNGrams(e,c,a,h,m,d),h+=m}),this.preserveShort&&h===o[l]){const d=n[l+1]-n[l];if(d===0)continue;const f=d+2*this.padWidth;this.createNGrams(e,c,a,h,1,f)}}return[a,o]}}function xz(t,e,n,s,i,r,o,a){return new Kie(n,s,i,r,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xie(t,e,n,s){if(!t.length)return;if(e.length===0){for(let r=0;r<t.length;++r)s.push(t.subarray(r,r+1));return}if(e.length===1){const r=e[0];let o=t.indexOf(r);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(r)}(!n||t.length!==0)&&s.push(t);return}let i=0;for(let r=0;r<t.length+1;r++)if(r===t.length||e.indexOf(t[r])!==-1){const o=t.subarray(i,r);(!n||o.length!==0)&&s.push(o),i=r+1}}function _z(t,e,n){const s=t.length,i=[];let r=0,o=0;const a=new Array(s);for(let f=0;f<s;++f){const m=i.length;Xie(t[f],e,n,i);const g=i.length-m;a[f]=g,r+=g,o=Math.max(o,g)}const l=qt("int32",r*2),c=new Array(r),h=[s,o];let d=0;for(let f=0;f<s;++f)for(let m=0;m<a[f];++m)l[d*2]=f,l[d*2+1]=m,c[d]=i[d],++d;return[l,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(t,e){const n=qt("int32",t.length);for(let s=0;s<t.length;++s)n[s]=rX(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bz=Qt((t,e)=>t-e),Zie=bk((t,e,n,s)=>({real:t-n,imag:e-s})),Tk=mn(Zf,bz,Zie),Yie={kernelName:Zf,backendName:"cpu",kernelFunc:Tk};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const s=je(n,t.dtype);for(let i=0;i<s.values.length;++i){const r=s.indexToLoc(i),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=r[l]%t.shape[l];const a=t.locToIndex(o);s.values[i]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lh=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function Iz(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*Math.sign(l-a/2),f=Math.max(n,Math.floor(e-l*h/a+d)),m=Math.min(s,Math.floor(e+(a-l)*h/a+d));Iz(t,e,f,m)}const i=t[e];let r=n,o=s;for(vc(t,n,e),Lh(t[s],i)>0&&vc(t,n,s);r<o;){for(vc(t,r,o),r++,o--;Lh(t[r],i)<0;)r=r+1;for(;Lh(t[o],i)>0;)o=o-1}Lh(t[n],i)===0?vc(t,n,o):(o=o+1,vc(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function kz(t,e,n,s,i){const r=e[e.length-1],[o,a]=[t.length/r,r],l=Wn(n,o*s),c=Wn("int32",o*s);for(let d=0;d<o;d++){const f=d*a,m=t.subarray(f,f+a);let g=new Array(m.length);m.forEach((w,b)=>g[b]={value:w,index:b}),s<g.length&&(Iz(g,s),g=g.slice(0,s)),i&&g.sort(Lh);const x=d*s,_=l.subarray(x,x+s),v=c.subarray(x,x+s);for(let w=0;w<s;w++)_[w]=g[w].value,v[w]=g[w].index}const h=e.slice();return h[h.length-1]=s,[je(h,n,l),je(h,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(t,e,n,s){const i=Ge(e,n)[0],r=[1,n[0],1];for(let g=0;g<i;g++)r[0]*=n[g];r[1]=n[i];for(let g=i+1;g<n.length;g++)r[2]*=n[g];const o=new Map,a=new Int32Array(n[i]),l=new An(r,s,t),c=[],h=r[0]===1&&r[2]===1;for(let g=0;g<n[i];g++){let x;if(h)x=t[g].toString();else{const v=[];for(let w=0;w<r[0];w++)for(let b=0;b<r[2];b++)v.push(l.get(w,g,b));x=v.join(",")}const _=o.get(x);if(_!=null)a[g]=_;else{const v=o.size;o.set(x,v),a[g]=v,c.push(g)}}const d=r.slice();d[1]=o.size;const f=new An(d,s);c.forEach((g,x)=>{for(let _=0;_<r[0];_++)for(let v=0;v<r[2];v++)f.set(l.get(_,g,v),_,x,v)});const m=n.slice();return m[i]=d[1],{outputValues:f.values,outputShape:m,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qie=Object.freeze(Object.defineProperty({__proto__:null,addImpl:O3,bincountImpl:Ck,bincountReduceImpl:L3,bitwiseAndImpl:F3,castImpl:P3,ceilImpl:M3,concatImpl:z3,equalImpl:B3,expImpl:W3,expm1Impl:j3,floorDivImpl:H3,floorImpl:G3,gatherNdImpl:q3,gatherV2Impl:K3,greaterEqualImpl:Z3,greaterImpl:X3,lessEqualImpl:Q3,lessImpl:Y3,linSpaceImpl:J3,logImpl:ez,maxImpl:tz,maximumImpl:nz,minimumImpl:sz,multiplyImpl:Ik,negImpl:iz,notEqualImpl:rz,prodImpl:oz,raggedGatherImpl:az,raggedRangeImpl:lz,raggedTensorToTensorImpl:cz,rangeImpl:uz,rsqrtImpl:hz,scatterImpl:el,sigmoidImpl:Mie,simpleAbsImpl:D3,sliceImpl:fz,sparseFillEmptyRowsImpl:pz,sparseReshapeImpl:mz,sparseSegmentReductionImpl:Sk,sqrtImpl:Uie,squaredDifferenceImpl:gz,staticRegexReplaceImpl:yz,stridedSliceImpl:vz,stringNGramsImpl:xz,stringSplitImpl:_z,stringToHashBucketFastImpl:wz,subImpl:bz,tileImpl:Cz,topKImpl:kz,transposeImpl:kk,uniqueImpl:Sz},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */qO("cpu",()=>new yx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tz=mt(xf,t=>t>=0?t:Math.exp(t)-1),Jie={kernelName:xf,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ez(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:r}=s;Ie([i],"leakyRelu");const o=re(i.shape),a=n.data.get(i.dataId).values,l=Wn("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?r*a[c]:a[c];return n.makeTensorInfo(i.shape,"float32",l)}const ere={kernelName:mv,backendName:"cpu",kernelFunc:Ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tre=Qt((t,e)=>t<0?e*t:t);function Nz(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e;Ie([s,i],"prelu");const r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,[a,l]=tre(s.shape,i.shape,r,o,"float32");return n.makeTensorInfo(l,"float32",a)}const nre={kernelName:Pv,backendName:"cpu",kernelFunc:Nz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $z=mt(Mf,t=>Math.max(0,t)),sre={kernelName:Mf,backendName:"cpu",kernelFunc:$z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rz=mt(zf,t=>Math.min(Math.max(0,t),6)),ire={kernelName:zf,backendName:"cpu",kernelFunc:Rz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ny(t,e,n,s,i){if(n==="linear")return Ar({inputs:{x:e},backend:t});if(n==="relu")return $z({inputs:{x:e},backend:t});if(n==="elu")return Tz({inputs:{x:e},backend:t});if(n==="relu6")return Rz({inputs:{x:e},backend:t});if(n==="prelu")return Nz({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return Ez({inputs:{x:e},backend:t,attrs:{alpha:i}});if(n==="sigmoid")return dz({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function It(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:r}=s,o=re(i.shape),a=JP(r,o),l=re(a);R(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const c=n.data.get(i.dataId);if(c.complexTensorInfos!=null){const h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;h.shape=a,d.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const rre={kernelName:Lv,backendName:"cpu",kernelFunc:It};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r}=e,{transposeA:o,transposeB:a}=s;Ie([i,r],"matMul");const l=i.shape.length,c=r.shape.length,h=o?i.shape[l-2]:i.shape[l-1],d=a?r.shape[c-1]:r.shape[c-2],f=o?i.shape[l-1]:i.shape[l-2],m=a?r.shape[c-2]:r.shape[c-1],g=i.shape.slice(0,-2),x=r.shape.slice(0,-2),_=re(g),v=re(x),b=ze(i.shape.slice(0,-2),r.shape.slice(0,-2)).concat([f,m]);R(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${i.shape} and ${r.shape} and transposeA=${o} and transposeB=${a} must match.`);const I=o?[_,h,f]:[_,f,h],S=a?[v,m,d]:[v,d,m],T=It({inputs:{x:i},backend:n,attrs:{shape:I}}),$=It({inputs:{x:r},backend:n,attrs:{shape:S}}),E=o?T.shape[1]:T.shape[2],D=o?T.shape[2]:T.shape[1],P=a?$.shape[1]:$.shape[2],z=Math.max(_,v),V=n.data.get(T.dataId).values,q=n.data.get($.dataId).values,K=Te(T.shape),J=Te($.shape),[X,oe,O]=o?[K[0],1,K[1]]:[K[0],K[1],1],[Z,j,te]=a?[1,J[1],J[0]]:[J[1],1,J[0]],ae=D*P,ue=je([z,D,P],T.dtype),he=ue.values,le=n.blockSize;for(let ce=0;ce<z;ce++){const we=ce%_,Se=ce%v;for(let Ee=0;Ee<D;Ee+=le){const Fe=Math.min(Ee+le,D);for(let Me=0;Me<P;Me+=le){const Qe=Math.min(Me+le,P);for(let ut=0;ut<E;ut+=le){const Rt=Math.min(ut+le,E);for(let dt=Ee;dt<Fe;dt++)for(let ot=Me;ot<Qe;ot++){let vt=0;for(let ft=ut;ft<Rt;ft++){const ki=V[we*X+dt*oe+ft*O],Jt=q[ft*Z+ot*j+Se*te];vt+=ki*Jt}he[ce*ae+(dt*P+ot)]+=vt}}}}}return n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo($),n.makeTensorInfo(b,ue.dtype,ue.values)}const ore={kernelName:ev,backendName:"cpu",kernelFunc:Az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function are(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:d}=s;let f,m,g;const x=[];f=Az({inputs:{a:i,b:r},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(m=pu({inputs:{a:f,b:o},backend:n}),x.push(f),f=m),h&&(g=ny(n,f,h,a,d),x.push(f),f=g);for(const v of x)n.disposeIntermediateTensorInfo(v);return f}const lre={kernelName:Dg,backendName:"cpu",kernelFunc:are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cre=mt(of,t=>Math.acos(t)),ure={kernelName:of,backendName:"cpu",kernelFunc:cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hre=mt(af,t=>Math.acosh(t)),dre={kernelName:af,backendName:"cpu",kernelFunc:hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fre(t){const{inputs:e,backend:n}=t,s=e;Ie(e,"addN");const i=s.map(a=>n.data.get(a.dataId).values),r=je(s[0].shape,s[0].dtype),o=r.values;for(let a=0;a<s.length;a++){const l=i[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return n.makeTensorInfo(r.shape,r.dtype,r.values)}const pre={kernelName:Q1,backendName:"cpu",kernelFunc:fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"all");const a=Ge(r,i.shape);let l=a;const c=Bt(l,i.shape.length);let h=i;c!=null&&(h=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Zt(l.length,i.shape.length)),On("all",l,h.shape.length);const[d,f]=In(h.shape,l),m=re(f),g=Vn(re(d),h.dtype),x=n.data.get(h.dataId).values;for(let v=0;v<g.length;++v){const w=v*m;let b=x[w];for(let I=0;I<m;++I){const S=x[w+I];b=b&&S}g[v]=b}c!=null&&n.disposeIntermediateTensorInfo(h);const _=n.makeTensorInfo(d,h.dtype,g);if(o){const v=sn(d,a),w=It({inputs:{x:_},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(_),w}return _}const gre={kernelName:J1,backendName:"cpu",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"any");const a=Ge(r,i.shape);let l=a;const c=Bt(l,i.shape.length);let h=i;c!=null&&(h=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Zt(l.length,i.shape.length)),On("any",l,h.shape.length);const[d,f]=In(h.shape,l),m=re(f),g=Vn(re(d),h.dtype),x=n.data.get(h.dataId).values;for(let v=0;v<g.length;++v){const w=v*m;let b=x[w];for(let I=0;I<m;++I){const S=x[w+I];b=b||S}g[v]=b}c!=null&&n.disposeIntermediateTensorInfo(h);const _=n.makeTensorInfo(d,h.dtype,g);if(o){const v=sn(d,a),w=It({inputs:{x:_},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(_),w}return _}const vre={kernelName:eC,backendName:"cpu",kernelFunc:yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;Ie(i,"argMax");let o=Ge(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=ms({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),o=[o[0]],On("argMax",o,l.shape.length);const[h,d]=In(l.shape,o),f=re(h),m=Vn(f,"int32"),g=re(d),x=n.data.get(l.dataId).values;for(let _=0;_<m.length;++_){const v=_*g;let w=x[v],b=0;for(let I=0;I<g;++I){const S=x[v+I];S>w&&(w=S,b=I)}m[_]=b}return c.forEach(_=>n.disposeIntermediateTensorInfo(_)),n.makeTensorInfo(h,"int32",m)}const _re={kernelName:Zy,backendName:"cpu",kernelFunc:xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;Ie(i,"argMin");let o=Ge(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=ms({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),o=[o[0]],On("argMin",o,l.shape.length);const[h,d]=In(l.shape,o),f=re(h),m=Vn(f,"int32"),g=re(d),x=n.data.get(l.dataId).values;for(let _=0;_<m.length;++_){const v=_*g;let w=x[v],b=0;for(let I=0;I<g;++I){const S=x[v+I];S<w&&(w=S,b=I)}m[_]=b}return c.forEach(_=>n.disposeIntermediateTensorInfo(_)),n.makeTensorInfo(h,"int32",m)}const bre={kernelName:Yy,backendName:"cpu",kernelFunc:wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre=mt(lf,t=>Math.asin(t)),Ire={kernelName:lf,backendName:"cpu",kernelFunc:Cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kre=mt(cf,t=>Math.asinh(t)),Sre={kernelName:cf,backendName:"cpu",kernelFunc:kre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tre=mt(uf,t=>Math.atan(t)),Ere={kernelName:uf,backendName:"cpu",kernelFunc:Tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nre=Qt((t,e)=>Math.atan2(t,e)),$re=mn(df,Nre),Rre={kernelName:df,backendName:"cpu",kernelFunc:$re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Are=mt(hf,t=>Math.atanh(t)),Dre={kernelName:hf,backendName:"cpu",kernelFunc:Are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ek(t,e,n,s,i,r){const o=i.strideHeight,a=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=i.padInfo.top,m=i.padInfo.left,g=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=je(i.outShape,n),_=x.values,v=i.outShape[1]*i.outShape[2]*i.outShape[3],w=i.outShape[2]*i.outShape[3],b=i.outShape[3];for(let I=0;I<i.batchSize;++I){const S=I*v,T=I*s[0];for(let $=0;$<i.inChannels;++$)for(let E=0;E<i.outHeight;++E){const D=E*o-f,P=Math.max(0,D),z=Math.min(i.inHeight,h+D),V=S+E*w;for(let q=0;q<i.outWidth;++q){const K=q*a-m,J=Math.max(0,K),X=Math.min(i.inWidth,d+K);let oe=g,O=0,Z=0;for(let te=P;te<z;te+=l){const ae=T+te*s[1];for(let ue=J;ue<X;ue+=c){const he=ae+ue*s[2],le=t[he+$];r==="max"&&le>oe?oe=le:r==="avg"&&(O+=le,Z++)}if(isNaN(oe))break}const j=V+q*b+$;_[j]=r==="avg"?O/Z:oe}}}return x}function Dz(t,e,n,s,i=!1,r=!1){const o=je(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,h=s.dilationWidth,d=s.effectiveFilterHeight,f=s.effectiveFilterWidth,m=s.padInfo.top,g=s.padInfo.left,x=je(e,n,t);for(let _=0;_<s.batchSize;++_)for(let v=0;v<s.inChannels;++v)for(let w=0;w<s.outHeight;++w){const b=w*a-m;let I=b;for(;I<0;)I+=c;const S=Math.min(s.inHeight,d+b);for(let T=0;T<s.outWidth;++T){const $=T*l-g;let E=$;for(;E<0;)E+=h;const D=Math.min(s.inWidth,f+$);let P=Number.NEGATIVE_INFINITY,z=-1;for(let V=I;V<S;V+=c){const q=V-b;for(let K=E;K<D;K+=h){const J=K-$,X=x.get(_,V,K,v);X>P&&(P=X,i?z=r?((_*s.inHeight+V)*s.inWidth+K)*s.inChannels+v:(V*s.inWidth+K)*s.inChannels+v:z=q*f+J)}}o.set(z,_,w,T,v)}}return o}function Pz(t,e,n,s,i,r){const o=i.strideDepth,a=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,f=i.effectiveFilterDepth,m=i.effectiveFilterHeight,g=i.effectiveFilterWidth,x=i.padInfo.front,_=i.padInfo.top,v=i.padInfo.left,w=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=je(i.outShape,n),I=b.values,S=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],T=i.outShape[2]*i.outShape[3]*i.outShape[4],$=i.outShape[3]*i.outShape[4],E=i.outShape[4];for(let D=0;D<i.batchSize;++D){const P=D*S,z=D*s[0];for(let V=0;V<i.inChannels;++V)for(let q=0;q<i.outDepth;++q){const K=q*o-x;let J=K;for(;J<0;)J+=c;const X=Math.min(i.inDepth,f+K),oe=P+q*T;for(let O=0;O<i.outHeight;++O){const Z=O*a-_;let j=Z;for(;j<0;)j+=h;const te=Math.min(i.inHeight,m+Z),ae=oe+O*$;for(let ue=0;ue<i.outWidth;++ue){const he=ue*l-v;let le=he;for(;le<0;)le+=d;const ce=Math.min(i.inWidth,g+he),we=ae+ue*E;let Se=w,Ee=0,Fe=0;for(let Qe=J;Qe<X;Qe+=c){const ut=z+Qe*s[1];for(let Rt=j;Rt<te;Rt+=h){const dt=ut+Rt*s[2];for(let ot=le;ot<ce;ot+=d){const vt=dt+ot*s[3],ft=t[vt+V];if(r==="max"&&ft>Se?Se=ft:r==="avg"&&(Ee+=ft,Fe++),isNaN(Se))break}if(isNaN(Se))break}if(isNaN(Se))break}const Me=we+V;I[Me]=r==="avg"?Ee/Math.max(Fe,1):Se}}}}return b}function Pre(t,e){const n=je(e.outShape,"int32"),s=e.strideDepth,i=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;for(let x=0;x<e.batchSize;++x)for(let _=0;_<e.inChannels;++_)for(let v=0;v<e.outDepth;++v){const w=v*s-f;let b=w;for(;b<0;)b+=o;const I=Math.min(e.inDepth,c+w);for(let S=0;S<e.outHeight;++S){const T=S*i-m;let $=T;for(;$<0;)$+=a;const E=Math.min(e.inHeight,h+T);for(let D=0;D<e.outWidth;++D){const P=D*r-g;let z=P;for(;z<0;)z+=l;const V=Math.min(e.inWidth,d+P);let q=Number.NEGATIVE_INFINITY,K=-1;for(let J=b;J<I;J+=o){const X=J-w;for(let oe=$;oe<E;oe+=a){const O=oe-T;for(let Z=z;Z<V;Z+=l){const j=Z-P,te=t.get(x,J,oe,Z,_);te>=q&&(q=te,K=X*h*d+O*h+j)}}}n.set(K,x,v,S,D,_)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ore(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;Ie(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(Gn(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=bi(i.shape,r,o,c,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))d=Ar({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,m=Te(i.shape),g=Ek(f,i.shape,i.dtype,m,h,"avg");d=n.makeTensorInfo(h.outShape,i.dtype,g.values)}return d}const Lre={kernelName:Qy,backendName:"cpu",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;Ie(i,"avgPool3d");const h=mo(i.shape,r,o,1,a,l,c),d=n.data.get(i.dataId).values,f=Pz(d,i.shape,i.dtype,Te(i.shape),h,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const Mre={kernelName:Jy,backendName:"cpu",kernelFunc:Fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zre(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;Ie([i,r],"avgPool3DGrad");const h=mo(r.shape,o,a,1,l,c),d=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.filterDepth,x=h.filterHeight,_=h.filterWidth,v=h.dilationDepth,w=h.dilationHeight,b=h.dilationWidth,I=h.effectiveFilterDepth,S=h.effectiveFilterHeight,T=h.effectiveFilterWidth,$=I-1-h.padInfo.front,E=T-1-h.padInfo.left,D=S-1-h.padInfo.top,P=je(r.shape,"float32"),z=1/(g*x*_),V=n.bufferSync(i);for(let q=0;q<h.batchSize;++q)for(let K=0;K<h.inChannels;++K)for(let J=0;J<h.inDepth;++J)for(let X=0;X<h.inHeight;++X)for(let oe=0;oe<h.inWidth;++oe){const O=J-$,Z=X-D,j=oe-E;let te=0;for(let ae=0;ae<I;ae+=v){const ue=(O+ae)/d;if(!(ue<0||ue>=h.outDepth||Math.floor(ue)!==ue))for(let he=0;he<S;he+=w){const le=(Z+he)/f;if(!(le<0||le>=h.outHeight||Math.floor(le)!==le))for(let ce=0;ce<T;ce+=b){const we=(j+ce)/m;if(we<0||we>=h.outWidth||Math.floor(we)!==we)continue;const Se=V.get(q,ue,le,we,K);te+=Se}}}P.set(te*z,q,J,X,oe,K)}return n.makeTensorInfo(P.shape,P.dtype,P.values)}const Bre={kernelName:nC,backendName:"cpu",kernelFunc:zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r;Ie([i,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,h=bi(o.shape,a,l,1,c),d=h.strideHeight,f=h.strideWidth,m=h.filterHeight,g=h.filterWidth,x=h.dilationHeight,_=h.dilationWidth,v=h.effectiveFilterHeight,w=h.effectiveFilterWidth,b=w-1-h.padInfo.left,I=v-1-h.padInfo.top,S=je(o.shape,"float32"),T=1/(m*g),$=n.data.get(i.dataId).values,E=je(i.shape,"float32",$);for(let D=0;D<h.batchSize;++D)for(let P=0;P<h.inChannels;++P)for(let z=0;z<h.inHeight;++z)for(let V=0;V<h.inWidth;++V){const q=z-I,K=V-b;let J=0;for(let X=0;X<v;X+=x){const oe=(q+X)/d;if(!(oe<0||oe>=h.outHeight||Math.floor(oe)!==oe))for(let O=0;O<w;O+=_){const Z=(K+O)/f;if(Z<0||Z>=h.outWidth||Math.floor(Z)!==Z)continue;const j=E.get(D,oe,Z,P);J+=j}}S.set(J*T,D,z,V,P)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const Wre={kernelName:tC,backendName:"cpu",kernelFunc:Ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,scale:r,offset:o,mean:a,variance:l}=e;R(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(r==null||a.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ie([i,a,l,r,o],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const h=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,m=r?n.data.get(r.dataId).values:new Float32Array([1]),g=o?n.data.get(o.dataId).values:new Float32Array([0]),x=new Float32Array(h.length),_=g.length,v=m.length,w=f.length,b=d.length;let I=0,S=0,T=0,$=0;for(let E=0;E<h.length;++E)x[E]=g[I++]+(h[E]-d[S++])*m[T++]/Math.sqrt(f[$++]+c),I>=_&&(I=0),S>=b&&(S=0),T>=v&&(T=0),$>=w&&($=0);return n.makeTensorInfo(i.shape,i.dtype,x)}const jre={kernelName:dv,backendName:"cpu",kernelFunc:Vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,crops:o}=s;Ie([i],"batchToSpaceND");const a=r.reduce((v,w)=>v*w),l=lp(i.shape,r,a),c=cp(l.length,r.length),h=up(i.shape,r,a),d=OI(o,r.length),f=LI(h,o,r.length),m=It({inputs:{x:i},backend:n,attrs:{shape:l}}),g=ms({inputs:{x:m},backend:n,attrs:{perm:c}}),x=It({inputs:{x:g},backend:n,attrs:{shape:h}}),_=Rl({inputs:{x},backend:n,attrs:{begin:d,size:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),_}const Hre={kernelName:tv,backendName:"cpu",kernelFunc:Gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qre(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o}=s,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=Ck(a,l,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,c)}const Kre={kernelName:sC,backendName:"cpu",kernelFunc:qre};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xre(t){const{inputs:e,backend:n}=t,{s0:s,s1:i}=e,r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,a=ze(Array.from(r),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Zre={kernelName:rO,backendName:"cpu",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yre=mt(mf,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),Qre={kernelName:mf,backendName:"cpu",kernelFunc:Yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jre=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(re(e.shape)),i=n.data.get(e.dataId),r=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const h=a[c],d=l[c];s[c]=Math.hypot(h,d)}return n.makeOutput(s,e.shape,"float32")},eoe={kernelName:nv,backendName:"cpu",kernelFunc:Jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mu(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.imag,r=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,r)}const toe={kernelName:wC,backendName:"cpu",kernelFunc:mu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gu(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,r=Ge(i,e[0].shape)[0],o=e.map(x=>x.shape);AI(o,r);let a=Cr(e.map(x=>x.shape),r);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(x=>re(x.shape)>0);if(l.length===1)return Ar({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const x=l.map(I=>$l({inputs:{input:I},backend:n})),_=l.map(I=>mu({inputs:{input:I},backend:n})),v=gu({inputs:x,backend:n,attrs:{axis:r}}),w=gu({inputs:_,backend:n,attrs:{axis:r}}),b=bs({inputs:{real:v,imag:w},backend:n});return x.forEach(I=>n.disposeIntermediateTensorInfo(I)),_.forEach(I=>n.disposeIntermediateTensorInfo(I)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),b}const c=l.map(x=>{const v=[-1,re(x.shape.slice(r))];return It({inputs:{x},backend:n,attrs:{shape:v}})}),h=c.map(x=>({vals:n.data.get(x.dataId).values,shape:x.shape}));a=Cr(c.map(x=>x.shape),1);const d=c[0].shape[0]===1,f=z3(h,a,e[0].dtype,d),m=Cr(l.map(x=>x.shape),r),g=n.makeTensorInfo(m,e[0].dtype,f);return c.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}const noe={kernelName:sv,backendName:"cpu",kernelFunc:gu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:h}=s;Ie([i,r],"conv2d");const d=go(l),f=Pn(i.shape,r.shape,o,c,a,h,!1,d),m=f.filterHeight,g=f.filterWidth,x=f.dilationHeight,_=f.dilationWidth,v=f.padInfo.left,w=f.padInfo.top,b=f.dataFormat==="channelsLast",I=new An(f.outShape,i.dtype),S=Te(i.shape),T=Te(r.shape),$=S[0],E=b?S[1]:S[2],D=b?S[2]:1,P=b?1:S[1],z=I.strides[0],V=b?I.strides[1]:I.strides[2],q=b?I.strides[2]:1,K=b?1:I.strides[1],J=n.data.get(i.dataId).values,X=n.data.get(r.dataId).values,oe=I.values;for(let O=0;O<f.batchSize;++O){const Z=O*$,j=O*z;for(let te=0;te<f.outHeight;++te){const ae=j+te*V,ue=te*f.strideHeight-w;for(let he=0;he<m;++he){const le=ue+he*x;if(le<0||le>=f.inHeight)continue;const ce=he*T[0],we=Z+le*E;for(let Se=0;Se<f.outWidth;++Se){const Ee=ae+Se*q,Fe=Se*f.strideWidth-v;for(let Me=0;Me<g;++Me){const Qe=Fe+Me*_;if(Qe<0||Qe>=f.inWidth)continue;const ut=ce+Me*T[1],Rt=we+Qe*D;let dt=ut;for(let ot=0;ot<f.inChannels;++ot){const vt=J[Rt+ot*P];for(let ft=0;ft<f.outChannels;++ft)oe[Ee+ft*K]+=vt*X[dt+ft];dt+=f.outChannels}}}}}}return n.makeTensorInfo(I.shape,I.dtype,oe)}const soe={kernelName:iv,backendName:"cpu",kernelFunc:Oz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:h}=s;Ie([i,r],"conv2dBackpropFilter");const d=go(l),f=Pn(i.shape,h,o,1,a,c,!1,d),{strideHeight:m,strideWidth:g,filterHeight:x,filterWidth:_}=f,v=f.dataFormat==="channelsLast",w=new An(f.filterShape,"float32"),b=f.padInfo.left,I=f.padInfo.top,S=n.data.get(i.dataId).values,T=n.data.get(r.dataId).values,$=new An(i.shape,i.dtype,S),E=new An(r.shape,r.dtype,T);for(let D=0;D<x;++D){const P=Math.max(0,Math.ceil((I-D)/m)),z=Math.min(f.outHeight,(f.inHeight+I-D)/m);for(let V=0;V<_;++V){const q=Math.max(0,Math.ceil((b-V)/g)),K=Math.min(f.outWidth,(f.inWidth+b-V)/g);for(let J=0;J<f.inChannels;++J)for(let X=0;X<f.outChannels;++X){let oe=0;for(let O=0;O<f.batchSize;++O)for(let Z=P;Z<z;++Z){const j=D+Z*m-I;for(let te=q;te<K;++te){const ae=V+te*g-b;v?oe+=$.get(O,j,ae,J)*E.get(O,Z,te,X):oe+=$.get(O,J,j,ae)*E.get(O,X,Z,te)}}w.set(oe,D,V,J,X)}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const roe={kernelName:oC,backendName:"cpu",kernelFunc:ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:h}=s;Ie([i,r],"conv2dBackpropInput");const d=Te(r.shape),f=Te(i.shape);let m=go(c);const g=Pn(o,r.shape,a,1,l,h,!1,m),x=new An(g.inShape,"float32"),_=x.values,v=n.data.get(i.dataId).values,w=n.data.get(r.dataId).values,[b,I,S]=d,{batchSize:T,filterHeight:$,filterWidth:E,inChannels:D,inHeight:P,inWidth:z,outChannels:V,outHeight:q,outWidth:K,strideHeight:J,strideWidth:X}=g;m=g.dataFormat;const oe=$-1-g.padInfo.top,O=E-1-g.padInfo.left,Z=m==="channelsLast",j=x.strides[0],te=Z?x.strides[1]:x.strides[2],ae=Z?x.strides[2]:1,ue=Z?1:x.strides[1],he=f[0],le=Z?f[1]:f[2],ce=Z?f[2]:1,we=Z?1:f[1];for(let Se=0;Se<T;++Se)for(let Ee=0;Ee<D;++Ee)for(let Fe=0;Fe<P;++Fe){const Me=Fe-oe,Qe=Math.max(0,Math.ceil(Me/J)),ut=Math.min(q,($+Me)/J);for(let Rt=0;Rt<z;++Rt){const dt=Rt-O,ot=Math.max(0,Math.ceil(dt/X)),vt=Math.min(K,(E+dt)/X);let ft=0;for(let Jt=Qe;Jt<ut;++Jt){const Qs=Jt*J-Me;for(let Kn=ot;Kn<vt;++Kn){const sr=Kn*X-dt,Ms=he*Se+le*Jt+ce*Kn,Si=b*($-1-Qs)+I*(E-1-sr)+S*Ee;for(let Js=0;Js<V;++Js){const Ti=v[Ms+we*Js],Ei=w[Si+Js];ft+=Ti*Ei}}}const ki=j*Se+te*Fe+ae*Rt+ue*Ee;_[ki]=ft}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const aoe={kernelName:rv,backendName:"cpu",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l}=s;Ie([i,r],"conv3d");const c=xa(i.shape,r.shape,o,l,a),{filterDepth:h,filterHeight:d,filterWidth:f,dilationDepth:m,dilationHeight:g,dilationWidth:x,padInfo:_}=c,v=_.front,w=_.left,b=_.top,I=new An(c.outShape,i.dtype),S=n.data.get(i.dataId).values,T=n.data.get(r.dataId).values,$=I.values,E=Te(i.shape),D=Te(r.shape);for(let P=0;P<c.batchSize;++P){const z=P*E[0],V=P*I.strides[0];for(let q=0;q<c.outDepth;++q){const K=V+q*I.strides[1],J=q*c.strideDepth-v;for(let X=0;X<h;++X){const oe=J+X*m;if(oe<0||oe>=c.inDepth)continue;const O=X*D[0],Z=z+oe*E[1];for(let j=0;j<c.outHeight;++j){const te=K+j*I.strides[2],ae=j*c.strideHeight-b;for(let ue=0;ue<d;++ue){const he=ae+ue*g;if(he<0||he>=c.inHeight)continue;const le=O+ue*D[1],ce=Z+he*E[2];for(let we=0;we<c.outWidth;++we){const Se=te+we*c.outChannels,Ee=we*c.strideWidth-w;for(let Fe=0;Fe<f;++Fe){const Me=Ee+Fe*x;if(Me<0||Me>=c.inWidth)continue;const Qe=le+Fe*D[2],ut=ce+Me*c.inChannels;let Rt=Qe;for(let dt=0;dt<c.inChannels;++dt){const ot=S[ut+dt];for(let vt=0;vt<c.outChannels;++vt)$[Se+vt]+=ot*T[Rt+vt];Rt+=c.outChannels}}}}}}}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const coe={kernelName:ov,backendName:"cpu",kernelFunc:loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,filterShape:l}=s;Ie([i,r],"conv3dBackpropFilterV2");const c=Te(i.shape),h=Te(r.shape),d=xa(i.shape,l,o,1,a),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,x=d.filterDepth,_=d.filterHeight,v=d.filterWidth,w=new An(d.filterShape,"float32"),b=w.values,[I,S,T,$]=w.strides,E=n.data.get(r.dataId).values,[D,P,z,V]=h,q=n.data.get(i.dataId).values,[K,J,X,oe]=c,O=d.padInfo.front,Z=d.padInfo.left,j=d.padInfo.top;for(let te=0;te<x;++te){const ae=Math.max(0,Math.ceil((O-te)/f)),ue=Math.min(d.outDepth,(d.inDepth+O-te)/f),he=te*I;for(let le=0;le<_;++le){const ce=Math.max(0,Math.ceil((j-le)/m)),we=Math.min(d.outHeight,(d.inHeight+j-le)/m),Se=le*S+he;for(let Ee=0;Ee<v;++Ee){const Fe=Math.max(0,Math.ceil((Z-Ee)/g)),Me=Math.min(d.outWidth,(d.inWidth+Z-Ee)/g),Qe=Ee*T+Se;for(let ut=0;ut<d.inChannels;++ut){const Rt=ut*$+Qe;for(let dt=0;dt<d.outChannels;++dt){let ot=0;for(let vt=0;vt<d.batchSize;++vt){const ft=vt*K,ki=vt*D;for(let Jt=ae;Jt<ue;++Jt){const Kn=(te+Jt*f-O)*J+ft,sr=Jt*P+ki;for(let Ms=ce;Ms<we;++Ms){const Js=(le+Ms*m-j)*X+Kn,Ti=Ms*z+sr;for(let Ei=Fe;Ei<Me;++Ei){const sc=(Ee+Ei*g-Z)*oe+Js,ic=Ei*V+Ti;ot+=q[sc+ut]*E[ic+dt]}}}}b[Rt+dt]=ot}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const hoe={kernelName:aC,backendName:"cpu",kernelFunc:uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{pad:o,strides:a,inputShape:l}=s;Ie([i],"conv3dBackpropInputV2");const c=Te(i.shape),h=Te(r.shape),d=xa(l,r.shape,a,1,o),f=new An(d.inShape,"float32"),m=f.values,[g,x,_,v]=f.strides,w=n.data.get(i.dataId).values,[b,I,S,T]=c,$=n.data.get(r.dataId).values,[E,D,P,z]=h,{batchSize:V,filterDepth:q,filterHeight:K,filterWidth:J,inChannels:X,inDepth:oe,inHeight:O,inWidth:Z,outChannels:j,outDepth:te,outHeight:ae,outWidth:ue,strideDepth:he,strideHeight:le,strideWidth:ce}=d,we=q-1-d.padInfo.front,Se=K-1-d.padInfo.top,Ee=J-1-d.padInfo.left;for(let Fe=0;Fe<V;++Fe)for(let Me=0;Me<X;++Me)for(let Qe=0;Qe<oe;++Qe){const ut=Qe-we,Rt=Math.max(0,Math.ceil(ut/he)),dt=Math.min(te,(q+ut)/he);for(let ot=0;ot<O;++ot){const vt=ot-Se,ft=Math.max(0,Math.ceil(vt/le)),ki=Math.min(ae,(K+vt)/le);for(let Jt=0;Jt<Z;++Jt){const Qs=Jt-Ee,Kn=Math.max(0,Math.ceil(Qs/ce)),sr=Math.min(ue,(J+Qs)/ce);let Ms=0;for(let Si=Rt;Si<dt;++Si){const Js=Si*he-ut;for(let Ti=ft;Ti<ki;++Ti){const Ei=Ti*le-vt;for(let Ea=Kn;Ea<sr;++Ea){const sc=Ea*ce-Qs,ic=b*Fe+I*Si+S*Ti+T*Ea,Dx=E*(q-1-Js)+D*(K-1-Ei)+P*(J-1-sc)+z*Me;for(let Na=0;Na<j;++Na){const Zu=w[ic+Na],$p=$[Dx+Na];Ms+=Zu*$p}}}}m[g*Fe+x*Qe+_*ot+v*Jt+Me]=Ms}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const foe={kernelName:lC,backendName:"cpu",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const poe=mt(gf,t=>Math.cos(t)),moe={kernelName:gf,backendName:"cpu",kernelFunc:poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const goe=mt(yf,t=>Math.cosh(t)),yoe={kernelName:yf,backendName:"cpu",kernelFunc:goe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:r,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[h,d,f,m]=i.shape,g=r.shape[0],[x,_]=a,v=je([g,x,_,m],"float32"),w=n.data.get(r.dataId).values,b=n.data.get(o.dataId).values,I=n.data.get(i.dataId).values,S=Te(i.shape),T=Te(v.shape);for(let $=0;$<g;$++){const E=$*4,D=w[E],P=w[E+1],z=w[E+2],V=w[E+3],q=b[$];if(q>=h)continue;const K=x>1?(z-D)*(d-1)/(x-1):0,J=_>1?(V-P)*(f-1)/(_-1):0;for(let X=0;X<x;X++){const oe=x>1?D*(d-1)+X*K:.5*(D+z)*(d-1);if(oe<0||oe>d-1){for(let O=0;O<_;O++)for(let Z=0;Z<m;Z++){const j=Z+O*T[2]+X*T[1]+$*T[0];v.values[j]=c}continue}if(l==="bilinear"){const O=Math.floor(oe),Z=Math.ceil(oe),j=oe-O;for(let te=0;te<_;te++){const ae=_>1?P*(f-1)+te*J:.5*(P+V)*(f-1);if(ae<0||ae>f-1){for(let ce=0;ce<m;ce++){const we=ce+te*T[2]+X*T[1]+$*T[0];v.values[we]=c}continue}const ue=Math.floor(ae),he=Math.ceil(ae),le=ae-ue;for(let ce=0;ce<m;ce++){let we=ce+ue*S[2]+O*S[1]+q*S[0];const Se=I[we];we=ce+he*S[2]+O*S[1]+q*S[0];const Ee=I[we];we=ce+ue*S[2]+Z*S[1]+q*S[0];const Fe=I[we];we=ce+he*S[2]+Z*S[1]+q*S[0];const Me=I[we],Qe=Se+(Ee-Se)*le,ut=Fe+(Me-Fe)*le;we=ce+te*T[2]+X*T[1]+$*T[0],v.values[we]=Qe+(ut-Qe)*j}}}else for(let O=0;O<_;++O){const Z=_>1?P*(f-1)+O*J:.5*(P+V)*(f-1);if(Z<0||Z>f-1){for(let ae=0;ae<m;ae++){const ue=ae+O*T[2]+X*T[1]+$*T[0];v.values[ue]=c}continue}const j=Math.round(Z),te=Math.round(oe);for(let ae=0;ae<m;ae++){const ue=ae+j*S[2]+te*S[1]+q*S[0],he=ae+O*T[2]+X*T[1]+$*T[0];v.values[he]=I[ue]}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const xoe={kernelName:uC,backendName:"cpu",kernelFunc:voe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;Ie(i,"cumprod");const l=Bt([r],i.shape.length);let c=i;l!=null&&(c=ms({inputs:{x:i},backend:n,attrs:{perm:l}}));const h=Zt(1,i.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const d=Ds(c.dtype,"int32"),f=X1(re(c.shape),d),m=n.data.get(c.dataId).values,g=c.shape[c.shape.length-1],x=a?(v,w)=>v+g-w-1:(v,w)=>v+w;for(let v=0;v<m.length;v+=g)for(let w=0;w<g;w++){const b=x(v,w);if(w===0)f[b]=o?1:m[b];else{const I=x(v,w-1);f[b]=o?m[I]*f[I]:m[b]*f[I]}}const _=n.makeTensorInfo(c.shape,d,f);if(l!=null){const v=_a(l),w=ms({inputs:{x:_},backend:n,attrs:{perm:v}});return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(c),w}return _}const woe={kernelName:cC,backendName:"cpu",kernelFunc:_oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;Ie(i,"cumsum");const l=Bt([r],i.shape.length);let c=i;l!=null&&(c=ms({inputs:{x:i},backend:n,attrs:{perm:l}}));const h=Zt(1,i.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const d=Ds(c.dtype,"int32"),f=Vn(re(c.shape),d),m=n.data.get(c.dataId).values,g=c.shape[c.shape.length-1],x=a?(v,w)=>v+g-w-1:(v,w)=>v+w;for(let v=0;v<m.length;v+=g)for(let w=0;w<g;w++){const b=x(v,w);if(w===0)f[b]=o?0:m[b];else{const I=x(v,w-1);f[b]=o?m[I]+f[I]:m[b]+f[I]}}const _=n.makeTensorInfo(c.shape,d,f);if(l!=null){const v=_a(l),w=ms({inputs:{x:_},backend:n,attrs:{perm:v}});return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(c),w}return _}const Coe={kernelName:av,backendName:"cpu",kernelFunc:boe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o,binaryOutput:a}=s;if(i.shape.length===1){const l=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,h=Ck(l,c,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,h)}else if(i.shape.length===2){const l=n.bufferSync(i),c=n.bufferSync(r),h=L3(l,c,o,a);return n.makeTensorInfo(h.shape,r.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const koe={kernelName:hC,backendName:"cpu",kernelFunc:Ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:r,dataFormat:o}=s;R(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],l=i.shape[1],c=i.shape[2],h=i.shape[3],d=l*r,f=c*r,m=h/(r*r),g=n.data.get(i.dataId).values,x=new Float32Array(a*d*f*m);let _=0;for(let v=0;v<a;++v)for(let w=0;w<d;++w){const b=Math.floor(w/r),I=w%r;for(let S=0;S<f;++S){const T=Math.floor(S/r),$=S%r,E=(I*r+$)*m;for(let D=0;D<m;++D){const z=D+E+h*(T+c*(b+l*v));x[_++]=g[z]}}}return n.makeTensorInfo([a,d,f,m],i.dtype,x)}const Toe={kernelName:dC,backendName:"cpu",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;Ie([i,r],"depthwiseConv2DNative");const h=Te(i.shape),d=Te(r.shape);let f=l;f==null&&(f=[1,1]),R(Gn(o,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`);const m=Pn(i.shape,r.shape,o,f,a,c,!0),{filterHeight:g,filterWidth:x,dilationHeight:_,dilationWidth:v,padInfo:w}=m,b=w.left,I=w.top,S=m.outChannels/m.inChannels,T=new An(m.outShape,i.dtype),$=n.data.get(i.dataId).values,E=n.data.get(r.dataId).values,D=T.values;for(let P=0;P<m.batchSize;++P){const z=P*h[0],V=P*T.strides[0];for(let q=0;q<m.outHeight;++q){const K=V+q*T.strides[1],J=q*m.strideHeight-I;for(let X=0;X<g;++X){const oe=J+X*_;if(oe<0||oe>=m.inHeight)continue;const O=X*d[0],Z=z+oe*h[1];for(let j=0;j<m.outWidth;++j){const te=K+j*T.strides[2],ae=j*m.strideWidth-b;for(let ue=0;ue<x;++ue){const he=ae+ue*v;if(he<0||he>=m.inWidth)continue;const le=O+ue*d[1],ce=Z+he*m.inChannels;let we=te,Se=le;for(let Ee=0;Ee<m.inChannels;++Ee){const Fe=$[ce+Ee];for(let Me=0;Me<S;++Me)D[we+Me]+=Fe*E[Se+Me];we+=S,Se+=S}}}}}}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const Eoe={kernelName:lv,backendName:"cpu",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:h}=s;Ie([i,r],"depthwiseConv2dNativeBackpropFilter");const d=Pn(i.shape,h,o,a,l,c,!0),{strideHeight:f,strideWidth:m,filterHeight:g,filterWidth:x}=d,_=new An(d.filterShape,"float32"),v=d.padInfo.left,w=d.padInfo.top,b=d.outChannels/d.inChannels,I=n.data.get(i.dataId).values,S=new An(i.shape,i.dtype,I),T=n.data.get(r.dataId).values,$=new An(r.shape,r.dtype,T);for(let E=0;E<g;++E){const D=Math.max(0,Math.ceil((w-E)/f)),P=Math.min(d.outHeight,(d.inHeight+w-E)/f);for(let z=0;z<x;++z){const V=Math.max(0,Math.ceil((v-z)/m)),q=Math.min(d.outWidth,(d.inWidth+v-z)/m);for(let K=0;K<d.outChannels;++K){const J=Math.trunc(K/b),X=K%b;let oe=0;for(let O=0;O<d.batchSize;++O)for(let Z=D;Z<P;++Z){const j=E+Z*f-w;for(let te=V;te<q;++te){const ae=z+te*m-v;oe+=S.get(O,j,ae,J)*$.get(O,Z,te,K)}}_.set(oe,E,z,J,X)}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const $oe={kernelName:fC,backendName:"cpu",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:h}=s;Ie([i,r],"depthwiseConv2DNativeBackpropInput");const d=Te(i.shape),f=Te(r.shape),m=Pn(h,r.shape,o,a,l,c,!0),g=new An(m.inShape,"float32"),x=g.values,[_,v,w]=g.strides,b=n.data.get(i.dataId).values,[I,S,T]=d,$=n.data.get(r.dataId).values,[E,D,P]=f,{batchSize:z,filterHeight:V,filterWidth:q,inChannels:K,inHeight:J,inWidth:X,outChannels:oe,outHeight:O,outWidth:Z,strideHeight:j,strideWidth:te}=m,ae=V-1-m.padInfo.top,ue=q-1-m.padInfo.left,he=oe/K;for(let le=0;le<z;++le)for(let ce=0;ce<K;++ce)for(let we=0;we<J;++we){const Se=we-ae,Ee=Math.max(0,Math.ceil(Se/j)),Fe=Math.min(O,(V+Se)/j);for(let Me=0;Me<X;++Me){const Qe=Me-ue,ut=Math.max(0,Math.ceil(Qe/te)),Rt=Math.min(Z,(q+Qe)/te);let dt=0;for(let ot=Ee;ot<Fe;++ot){const vt=ot*j-Se;for(let ft=ut;ft<Rt;++ft){const ki=ft*te-Qe,Jt=I*le+S*ot+T*ft,Qs=E*(V-1-vt)+D*(q-1-ki)+P*ce;for(let Kn=0;Kn<he;++Kn){const sr=ce*he+Kn,Ms=b[Jt+sr],Si=$[Qs+Kn];dt+=Ms*Si}}}x[_*le+v*we+w*Me+ce]=dt}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const Aoe={kernelName:pC,backendName:"cpu",kernelFunc:Roe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(t){const{inputs:e,backend:n}=t,{x:s}=e,i=re(s.shape),r=n.data.get(s.dataId).values,o=je([i,i],s.dtype),a=o.values;for(let c=0;c<r.length;c++)a[c*i+c]=r[c];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const Poe={kernelName:oO,backendName:"cpu",kernelFunc:Doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ooe={kernelName:cv,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i}=t,{strides:r,pad:o,dilations:a}=n,l=e,c=l.data.get(s.dataId).values,h=s.shape.length,d=l.data.get(i.dataId).values,f=i.shape.length,{batchSize:m,inHeight:g,inWidth:x,inChannels:_,outHeight:v,outWidth:w,padInfo:b,strideHeight:I,strideWidth:S,filterHeight:T,filterWidth:$,dilationHeight:E,dilationWidth:D,outShape:P}=sp(s.shape,i.shape,r,o,"NHWC",a),z=re(P),V=P.length,q=qt(s.dtype,z);for(let J=0;J<m;++J)for(let X=0;X<v;++X){const oe=X*I-b.top;for(let O=0;O<w;++O){const Z=O*S-b.left;for(let j=0;j<_;++j){let te=Number.MIN_SAFE_INTEGER;for(let ue=0;ue<T;++ue){const he=oe+ue*E;if(he>=0&&he<g)for(let le=0;le<$;++le){const ce=Z+le*D;if(ce>=0&&ce<x){const we=wr([J,he,ce,j],h,Te(s.shape)),Se=wr([ue,le,j],f,Te(i.shape)),Ee=c[we]+d[Se];Ee>te&&(te=Ee)}}}const ae=wr([J,X,O,j],V,Te(P));q[ae]=te}}}return{dataId:l.write(Gl(q,s.dtype),P,s.dtype),shape:P,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe={kernelName:Dw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:r}=t,{strides:o,pad:a,dilations:l}=n,c=e,h=Gi(s.shape,c.data.get(s.dataId).values),d=Gi(i.shape,c.data.get(i.dataId).values),{batchSize:f,inHeight:m,inWidth:g,inChannels:x,outHeight:_,outWidth:v,padInfo:w,strideHeight:b,strideWidth:I,filterHeight:S,filterWidth:T,dilationHeight:$,dilationWidth:E,outShape:D}=sp(s.shape,i.shape,o,a,"NHWC",l);R(r.rank===D.length,()=>`Error in ${Dw}, dy must have the same rank as output ${D.length}, but got ${r.rank}`);const P=Gi(D,c.data.get(r.dataId).values),z=nO(i.shape,i.dtype);for(let q=0;q<f;++q)for(let K=0;K<_;++K){const J=K*b-w.top;for(let X=0;X<v;++X){const oe=X*I-w.left;for(let O=0;O<x;++O){let Z=Number.MIN_SAFE_INTEGER,j=0,te=0;for(let ae=0;ae<S;++ae){const ue=J+ae*$;if(ue>=0&&ue<m)for(let he=0;he<T;++he){const le=oe+he*E;if(le>=0&&le<g){const ce=h[q][ue][le][O]+d[ae][he][O];ce>Z&&(Z=ce,j=ae,te=he)}}}z[j][te][O]+=P[q][K][X][O]}}}return{dataId:c.write(Gl(z,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Foe={kernelName:Aw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:r}=t,{strides:o,pad:a,dilations:l}=n,c=e,h=Gi(s.shape,c.data.get(s.dataId).values),d=Gi(i.shape,c.data.get(i.dataId).values),{batchSize:f,inHeight:m,inWidth:g,inChannels:x,outHeight:_,outWidth:v,padInfo:w,strideHeight:b,strideWidth:I,filterHeight:S,filterWidth:T,dilationHeight:$,dilationWidth:E,outShape:D}=sp(s.shape,i.shape,o,a,"NHWC",l);R(r.rank===D.length,()=>`Error in ${Aw}, dy must have the same rank as output ${D.length}, but got ${r.rank}`);const P=Gi(D,c.data.get(r.dataId).values),z=nO(s.shape,s.dtype);for(let q=0;q<f;++q)for(let K=0;K<_;++K){const J=K*b-w.top;for(let X=0;X<v;++X){const oe=X*I-w.left;for(let O=0;O<x;++O){let Z=Number.MIN_SAFE_INTEGER,j=J<0?0:J,te=oe<0?0:oe;for(let ae=0;ae<S;++ae){const ue=J+ae*$;if(ue>=0&&ue<m)for(let he=0;he<T;++he){const le=oe+he*E;if(le>=0&&le<g){const ce=h[q][ue][le][O]+d[ae][he][O];ce>Z&&(Z=ce,j=ue,te=le)}}}z[q][j][te][O]+=P[q][K][X][O]}}}return{dataId:c.write(Gl(z,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Moe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i}=e,{canvas:r,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},c=(l==null?void 0:l.alpha)||1,h=(a==null?void 0:a.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=r.getContext(h,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${h} type.`);const[f,m]=i.shape.slice(0,2),g=i.shape.length===2?1:i.shape[2],x=n.data.get(i.dataId).values,_=i.dtype==="float32"?255:1,v=new Uint8ClampedArray(m*f*4);for(let b=0;b<f*m;++b){const I=[0,0,0,255*c];for(let T=0;T<g;T++){const $=x[b*g+T];if(i.dtype==="float32"){if($<0||$>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${$}.`)}else if(i.dtype==="int32"&&($<0||$>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${$}.`);g===1?(I[0]=$*_,I[1]=$*_,I[2]=$*_):I[T]=$*_}const S=b*4;v[S+0]=Math.round(I[0]),v[S+1]=Math.round(I[1]),v[S+2]=Math.round(I[2]),v[S+3]=Math.round(I[3])}r.width=m,r.height=f;const w=new ImageData(v,m,f);return d.putImageData(w,0,0),i}const zoe={kernelName:K8,backendName:"cpu",kernelFunc:Moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vp(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"sum");let a;i.dtype==="bool"?a=oa({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):a=Ar({inputs:{x:i},backend:n});const l=a.shape.length,c=Ge(r,a.shape),h=Bt(c,l);let d=c,f=a;h!=null&&(f=ms({inputs:{x:a},backend:n,attrs:{perm:h}}),d=Zt(d.length,l)),On("sum",d,f.shape.length);const[m,g]=In(f.shape,d),x=Ds(f.dtype,"int32");let _=ey(n,m,x);const v=re(g),w=n.data.get(_.dataId).values,b=n.data.get(f.dataId).values;for(let I=0;I<w.length;++I){const S=I*v;let T=0;for(let $=0;$<v;++$)T+=b[S+$];w[I]=T}if(o){const I=sn(_.shape,c),S=_;_=It({inputs:{x:_},backend:n,attrs:{shape:I}}),n.disposeIntermediateTensorInfo(S)}return n.disposeIntermediateTensorInfo(a),h!=null&&n.disposeIntermediateTensorInfo(f),_}const Boe={kernelName:Wv,backendName:"cpu",kernelFunc:vp};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:i}=s,r=e,{allDims:o,summedDims:a,idDims:l}=jI(i,r.length);HI(o.length,l,r);const{path:c,steps:h}=qI(a,l),d=h.length;let f=null,m=o.length;const g=[];for(let x=0;x<d;++x){for(const _ of h[x]){const{permutationIndices:v,expandDims:w}=GI(m,l[_]);let b;KI(v)?b=r[_]:(b=ms({inputs:{x:r[_]},backend:n,attrs:{perm:v}}),g.push(b));const I=b.shape.slice();for(let S=0;S<w.length;++S)I.splice(w[S],0,1);ct(b.shape,I)||(b=It({inputs:{x:b},backend:n,attrs:{shape:I}}),g.push(b)),f===null?f=b:(f=vx({inputs:{a:b,b:f},backend:n}),g.push(f))}x<d-1&&(c[x]>=0&&(f=vp({inputs:{x:f},backend:n,attrs:{axis:c[x]-(o.length-m),keepDims:!1}}),g.push(f)),m--)}for(const x of g)x!==f&&n.disposeIntermediateTensorInfo(x);return f}const Woe={kernelName:mC,backendName:"cpu",kernelFunc:Uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Voe(t){const{inputs:e,backend:n}=t,{dy:s,y:i}=e;Ie([s,i],"eluGrad");const r=new Float32Array(re(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=0?r[l]=a[l]:r[l]=a[l]*(c+1)}return n.makeTensorInfo(i.shape,"float32",r)}const joe={kernelName:gC,backendName:"cpu",kernelFunc:Voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Goe=FI,Hoe=MI,qoe=zI,Koe=BI,Xoe=UI,Zoe=WI,Yoe=mt(_f,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+Goe*n);return e*(1-((((Zoe*s+Xoe)*s+Koe)*s+qoe)*s+Hoe)*s*Math.exp(-n*n))}),Qoe={kernelName:_f,backendName:"cpu",kernelFunc:Yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(t){const{inputs:e,backend:n,attrs:s}=t,{input:i}=e,{dim:r}=s,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(R(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),It({inputs:{x:i},backend:n,attrs:{shape:a}})}const Joe={kernelName:hv,backendName:"cpu",kernelFunc:sy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eae=Qt((t,e)=>t/e),Nk=mn(vf,eae),ab={kernelName:vf,backendName:"cpu",kernelFunc:Nk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fz(t,e,n){const s=t.shape,i=s[0],r=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[i,r],h=re(c),d=Wn("float32",h),f=Wn("float32",h);for(let _=0;_<i;_++){const v=Rl({inputs:{x:a},backend:n,attrs:{begin:[_,0],size:[1,r]}}),w=Rl({inputs:{x:l},backend:n,attrs:{begin:[_,0],size:[1,r]}}),b=bs({inputs:{real:v,imag:w},backend:n}),{real:I,imag:S}=tae(b,e,n),T=lo(I,S);for(let $=0;$<r;$++){const E=VI(T,$);d[_*r+$]=E.real,f[_*r+$]=E.imag}n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(b)}const m=n.makeTensorInfo(c,"float32",d),g=n.makeTensorInfo(c,"float32",f),x=bs({inputs:{real:m,imag:g},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),x}function tae(t,e,n){const s=re(t.shape),i=n.data.get(t.dataId),r=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(nae(s)){const a=lb(r,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),h=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",ya(s,"float32")),f=Ar({inputs:{x:d},backend:n}),m=ab.kernelFunc({inputs:{a:c,b:d},backend:n}),g=ab.kernelFunc({inputs:{a:h,b:f},backend:n}),x=n.data.get(m.dataId).values,_=n.data.get(g.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),{real:x,imag:_}}return a}else{const a=lo(r,o),l=sae(a,s,e);return eF(l)}}function nae(t){return(t&t-1)===0}function lb(t,e,n,s,i){if(n===1)return{real:t,imag:e};const r=lo(t,e),o=n/2,a=tF(r),l=a.real,c=a.imag,h=[l.length],d=i.makeTensorInfo(h,"float32",l),f=i.makeTensorInfo(h,"float32",c),m=bs({inputs:{real:d,imag:f},backend:i}),g=nF(r),x=g.real,_=g.imag,v=[x.length],w=i.makeTensorInfo(v,"float32",x),b=i.makeTensorInfo(v,"float32",_),I=bs({inputs:{real:w,imag:b},backend:i}),S=lb(l,c,o,s,i),T=S.real,$=S.imag,E=[T.length],D=i.makeTensorInfo(E,"float32",T),P=i.makeTensorInfo(E,"float32",$),z=bs({inputs:{real:D,imag:P},backend:i}),V=lb(x,_,o,s,i),q=V.real,K=V.imag,J=[q.length],X=i.makeTensorInfo(J,"float32",q),oe=i.makeTensorInfo(J,"float32",K),O=bs({inputs:{real:X,imag:oe},backend:i}),Z=iF(n,s),j=[Z.real.length],te=i.makeTensorInfo(j,"float32",Z.real),ae=i.makeTensorInfo(j,"float32",Z.imag),ue=bs({inputs:{real:te,imag:ae},backend:i}),he=vx({inputs:{a:ue,b:O},backend:i}),le=pu({inputs:{a:z,b:he},backend:i}),ce=Tk({inputs:{a:z,b:he},backend:i}),we=$l({inputs:{input:le},backend:i}),Se=$l({inputs:{input:ce},backend:i}),Ee=mu({inputs:{input:le},backend:i}),Fe=mu({inputs:{input:ce},backend:i}),Me=gu({inputs:[we,Se],backend:i,attrs:{axis:0}}),Qe=gu({inputs:[Ee,Fe],backend:i,attrs:{axis:0}}),ut=i.data.get(Me.dataId).values,Rt=i.data.get(Qe.dataId).values;return i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(m),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(oe),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(te),i.disposeIntermediateTensorInfo(ae),i.disposeIntermediateTensorInfo(ue),i.disposeIntermediateTensorInfo(he),i.disposeIntermediateTensorInfo(le),i.disposeIntermediateTensorInfo(ce),i.disposeIntermediateTensorInfo(we),i.disposeIntermediateTensorInfo(Ee),i.disposeIntermediateTensorInfo(Se),i.disposeIntermediateTensorInfo(Fe),i.disposeIntermediateTensorInfo(Me),i.disposeIntermediateTensorInfo(Qe),{real:ut,imag:Rt}}function sae(t,e,n){const s=new Float32Array(e*2);for(let i=0;i<e;i++){let r=0,o=0;for(let a=0;a<e;a++){const l=rF(i*a,e,n),c=VI(t,a);r+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}n&&(r/=e,o/=e),sF(s,r,o,i)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(t){const{inputs:e,backend:n}=t,{input:s}=e,i=re(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=It({inputs:{x:s},backend:n,attrs:{shape:[o,r]}}),l=Fz(a,!1,n),c=It({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const rae={kernelName:yC,backendName:"cpu",kernelFunc:iae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $k(t){const{backend:e,attrs:n}=t,{shape:s,value:i,dtype:r}=n,o=r||Nu(i),a=qt(o,re(s));return aae(a,i,o),e.makeTensorInfo(s,o,a)}const oae={kernelName:vC,backendName:"cpu",kernelFunc:$k};function aae(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lae={kernelName:xC,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,i=n,r=Wn(s.dtype,re(s.shape)),[o,a,l,c]=s.shape,h=i.data.get(s.dataId).values;for(let f=0;f<o;f++){const m=f*l*a*c;for(let g=0;g<a;g++){const x=g*(l*c);for(let _=0;_<l;_++){const v=_*c;for(let w=0;w<c;w++){const b=Math.round(l-_-1),I=m+x+v+w;let S=h[I];if(b>=0&&b<l){const T=b*c,$=m+x+T+w;S=h[$]}r[I]=S}}}}return{dataId:i.write(r,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s;let x=Oz({inputs:{x:i,filter:r},backend:n,attrs:{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f}});if(o){const _=x;if(h==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const v=It({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});x=pu({inputs:{a:x,b:v},backend:n}),n.disposeIntermediateTensorInfo(v)}else x=pu({inputs:{a:x,b:o},backend:n});n.disposeIntermediateTensorInfo(_)}if(m){const _=x;if(h==="NCHW"&&m==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const v=It({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});x=ny(n,x,m,v,g),n.disposeIntermediateTensorInfo(v)}else x=ny(n,x,m,a,g);n.disposeIntermediateTensorInfo(_)}return x}const uae={kernelName:Pg,backendName:"cpu",kernelFunc:cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s;let x=Lz({inputs:{x:i,filter:r},backend:n,attrs:{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f}});if(o){const _=x;x=pu({inputs:{a:x,b:o},backend:n}),n.disposeIntermediateTensorInfo(_)}if(m){const _=x;x=ny(n,x,m,a,g),n.disposeIntermediateTensorInfo(_)}return x}const dae={kernelName:kO,backendName:"cpu",kernelFunc:hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,r=re(s.shape),o=i.shape,a=o[o.length-1],[l,c,h,d]=SI(s,i);if(c===0)return n.makeTensorInfo(l,s.dtype,[]);const f=n.data.get(i.dataId).values,m=n.bufferSync(s),g=q3(f,m,s.dtype,c,a,h,d,s.shape,r);return n.makeTensorInfo(l,s.dtype,g.values)}const pae={kernelName:aO,backendName:"cpu",kernelFunc:fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:r}=e,{axis:o,batchDims:a}=s;Ie([i,r],"gatherV2");const l=Ge(o,i.shape)[0],c=n.data.get(r.dataId).values,h=i.shape[l];for(let I=0;I<c.length;++I){const S=c[I];R(S<=h-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${h-1}]`)}let d=a;a==null&&(d=0);const f=re(r.shape),m=ZI(i,r,l,d),g=It({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),x=It({inputs:{x:r},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),_=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],v=n.bufferSync(x),w=n.bufferSync(g),b=K3(w,v,_);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(m.outputShape,b.dtype,b.values)}const gae={kernelName:fv,backendName:"cpu",kernelFunc:mae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(t){const{inputs:e,backend:n}=t,{input:s}=e,i=re(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=It({inputs:{x:s},backend:n,attrs:{shape:[o,r]}}),l=Fz(a,!0,n),c=It({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const vae={kernelName:_C,backendName:"cpu",kernelFunc:yae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xae=mt(Tf,t=>Number.isFinite(t)?1:0,"bool"),_ae={kernelName:Tf,backendName:"cpu",kernelFunc:xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wae=mt(Ef,t=>Math.abs(t)===1/0?1:0,"bool"),bae={kernelName:Ef,backendName:"cpu",kernelFunc:wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cae=mt(Nf,t=>Number.isNaN(t)?1:0,"bool"),Iae={kernelName:Nf,backendName:"cpu",kernelFunc:Cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kae(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:r}=n,o=J3(s,i,r);return e.makeTensorInfo([o.length],"float32",o)}const Sae={kernelName:lO,backendName:"cpu",kernelFunc:kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tae=mt(Rf,t=>Math.log1p(t)),Eae={kernelName:Rf,backendName:"cpu",kernelFunc:Tae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nae=Qt((t,e)=>t&&e),$ae=mn(vv,Nae,null,"bool"),Rae={kernelName:vv,backendName:"cpu",kernelFunc:$ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aae=mt(xv,t=>t?0:1,"bool"),Dae={kernelName:xv,backendName:"cpu",kernelFunc:Aae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pae=Qt((t,e)=>t||e),Oae=mn(_v,Pae,null,"bool"),Lae={kernelName:_v,backendName:"cpu",kernelFunc:Oae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:r,bias:o,alpha:a,beta:l}=s;Ie(i,"LRN");const c=i.shape[3],h=c-1,d=n.data.get(i.dataId).values,f=re(i.shape),m=new Float32Array(f);function g(x){const _=x%c;let v=x-_+Math.max(0,_-r);const w=x-_+Math.min(_+r,h);let b=0;for(;v<=w;v++){const I=d[v];b+=I*I}return b}for(let x=0;x<f;x++){const _=g(x),v=d[x]*Math.pow(o+a*_,-l);m[x]=v}return n.makeTensorInfo(i.shape,i.dtype,m)}const Mae={kernelName:wv,backendName:"cpu",kernelFunc:Fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,y:r,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:h}=s;Ie(o,"LRNGrad");const d=re(o.shape),f=o.shape[3],m=n.data.get(o.dataId).values,g=n.data.get(i.dataId).values,x=n.data.get(r.dataId).values,_=new Float32Array(d),v=d;for(let w=0;w<v;w++){const b=w%f,I=w-b+Math.max(0,b-a),S=w-b+Math.min(f,b+a+1);let T=0;for(let $=I;$<S;$++)T+=Math.pow(g[$],2);T=c*T+l;for(let $=I;$<S;$++){let E=-2*c*h*g[$]*x[w]/T;w===$&&(E+=Math.pow(T,-h)),E*=m[w],_[$]+=E}}return n.makeTensorInfo(o.shape,i.dtype,_)}const Bae={kernelName:bC,backendName:"cpu",kernelFunc:zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:r,keepDims:o}=s,a=n;let l=i.shape;const c=l.length,h=Ge(r,l);let d=h;const f=Bt(d,c);let m=a.data.get(i.dataId).values;if(f!=null){const I=new Array(c);for(let S=0;S<I.length;S++)I[S]=l[f[S]];m=kk(m,l,i.dtype,f,I),d=Zt(d.length,c),l=I}Ie(i,"max"),On("max",d,c);const[g,x]=In(l,d),_=re(x),v=tz(m,_,g,i.dtype),w=a.write(v,g,i.dtype);let b=g;return o&&(b=sn(g,h)),{dataId:w,shape:b,dtype:i.dtype}}const Uae={kernelName:bv,backendName:"cpu",kernelFunc:Mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;Ie(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(Gn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=bi(i.shape,r,o,c,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))d=Ar({inputs:{x:i},backend:n});else{const f=n.data.get(i.dataId).values,m=Te(i.shape),g=Ek(f,i.shape,i.dtype,m,h,"max");d=n.makeTensorInfo(h.outShape,i.dtype,g.values)}return d}const Vae={kernelName:Cv,backendName:"cpu",kernelFunc:Wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;Ie(i,"maxPool3d");const h=mo(i.shape,r,o,1,a,l,c),d=n.data.get(i.dataId).values,f=Pz(d,i.shape,i.dtype,Te(i.shape),h,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const Gae={kernelName:Iv,backendName:"cpu",kernelFunc:jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hae(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;Ie([i,r],"maxPool3DGrad");const h=mo(r.shape,o,a,1,l,c),d=n.bufferSync(r),f=Pre(d,h),m=h.strideDepth,g=h.strideHeight,x=h.strideWidth,_=h.dilationDepth,v=h.dilationHeight,w=h.dilationWidth,b=h.effectiveFilterDepth,I=h.effectiveFilterHeight,S=h.effectiveFilterWidth,T=b-1-h.padInfo.front,$=S-1-h.padInfo.left,E=I-1-h.padInfo.top,D=je(r.shape,"float32"),P=n.bufferSync(i);for(let z=0;z<h.batchSize;++z)for(let V=0;V<h.inChannels;++V)for(let q=0;q<h.inDepth;++q)for(let K=0;K<h.inHeight;++K)for(let J=0;J<h.inWidth;++J){const X=q-T,oe=K-E,O=J-$;let Z=0;for(let j=0;j<b;j+=_){const te=(X+j)/m;if(!(te<0||te>=h.outDepth||Math.floor(te)!==te))for(let ae=0;ae<I;ae+=v){const ue=(oe+ae)/g;if(!(ue<0||ue>=h.outHeight||Math.floor(ue)!==ue))for(let he=0;he<S;he+=w){const le=(O+he)/x;if(le<0||le>=h.outWidth||Math.floor(le)!==le)continue;const ce=b*I*S-1-f.get(z,te,ue,le,V),we=j*I*S+ae*S+he,Se=ce===we?1:0;if(Se===0)continue;const Ee=P.get(z,te,ue,le,V);Z+=Ee*Se}}}D.set(Z,z,q,K,J,V)}return n.makeTensorInfo(D.shape,D.dtype,D.values)}const qae={kernelName:IC,backendName:"cpu",kernelFunc:Hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kae(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r,output:o}=e,a=r;Ie([r,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:d}=s,f=bi(a.shape,l,c,1,h,d),m=n.data.get(a.dataId).values,g=je(f.outShape,a.dtype,Dz(m,a.shape,a.dtype,f).values),x=f.strideHeight,_=f.strideWidth,v=f.dilationHeight,w=f.dilationWidth,b=f.effectiveFilterHeight,I=f.effectiveFilterWidth,S=I-1-f.padInfo.left,T=b-1-f.padInfo.top,$=je(a.shape,"float32"),E=n.data.get(i.dataId).values,D=je(i.shape,"float32",E);for(let P=0;P<f.batchSize;++P)for(let z=0;z<f.inChannels;++z)for(let V=0;V<f.inHeight;++V)for(let q=0;q<f.inWidth;++q){const K=V-T,J=q-S;let X=0;for(let oe=0;oe<b;oe+=v){const O=(K+oe)/x;if(!(O<0||O>=f.outHeight||Math.floor(O)!==O))for(let Z=0;Z<I;Z+=w){const j=(J+Z)/_;if(j<0||j>=f.outWidth||Math.floor(j)!==j)continue;const te=b*I-1-g.get(P,O,j,z),ae=oe*I+Z,ue=te===ae?1:0;if(ue===0)continue;const he=D.get(P,O,j,z);X+=he*ue}}$.set(X,P,V,q,z)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const Xae={kernelName:CC,backendName:"cpu",kernelFunc:Kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(t,e,n,s,i){const r=Te(e),o=Ek(t,e,n,r,i,"max"),a=Dz(t,e,n,i,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae={kernelName:cO,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=e,l=n;Ie(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,h=bi(s.shape,i,r,[1,1],o),[d,f]=Zae(c,s.shape,s.dtype,a,h),m=l.write(d,h.outShape,s.dtype),g=l.write(f,h.outShape,s.dtype);return[{dataId:m,shape:h.outShape,dtype:s.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=Ge(r,i.shape),c=In(i.shape,a)[1],h=re(c),d=[],f=n.makeTensorInfo([],"float32",new Float32Array([h]));d.push(f);const m=oa({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});d.push(m);const g=Nk({inputs:{a:m,b:f},backend:n});d.push(g);const x=vp({inputs:{x:g},backend:n,attrs:{axis:r,keepDims:o}});return d.forEach(_=>n.disposeIntermediateTensorInfo(_)),x}const Jae={kernelName:kv,backendName:"cpu",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;Ie(i,"min");const a=Ge(r,i.shape);let l=a;const c=Bt(l,i.shape.length);let h=i;c!=null&&(h=ms({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Zt(l.length,i.shape.length)),On("min",l,h.shape.length);const[d,f]=In(h.shape,l),m=re(f),g=Vn(re(d),h.dtype),x=n.data.get(h.dataId).values;for(let v=0;v<g.length;++v){const w=v*m;let b=x[w];for(let I=0;I<m;++I){const S=x[w+I];(Number.isNaN(S)||S<b)&&(b=S)}g[v]=b}c!=null&&n.disposeIntermediateTensorInfo(h);const _=n.makeTensorInfo(d,h.dtype,g);if(o){const v=sn(d,a),w=It({inputs:{x:_},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(_),w}return _}const tle={kernelName:Sv,backendName:"cpu",kernelFunc:ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,mode:o}=s;Ie(i,"mirrorPad");const a=r.map((b,I)=>b[0]+i.shape[I]+b[1]),l=r.map(b=>b[0]),c=r.map((b,I)=>b[0]+i.shape[I]),h=o==="reflect"?0:1,d=n.data.get(i.dataId).values,f=i.shape.length,m=Te(i.shape),g=re(a),x=a.length,_=Te(a),v=Wn(i.dtype,g);for(let b=0;b<g;b++){let I=$u(b,x,_);for(let T=0;T<x;T++)I[T]<l[T]?I[T]=l[T]*2-I[T]-h:I[T]>=c[T]&&(I[T]=(c[T]-1)*2-I[T]+h);I=I.map((T,$)=>T-l[$]);const S=wr(I,f,m);v[b]=d[S]}return{dataId:n.write(v,a,i.dtype),shape:a,dtype:i.dtype}}const sle={kernelName:Tv,backendName:"cpu",kernelFunc:nle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ile=Qt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),rle=mn(Pf,ile),ole={kernelName:Pf,backendName:"cpu",kernelFunc:rle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:r}=s,o=i.shape.length;let a=r;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=Ge([a],i.shape),c=Mz({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),h=sn(c.shape,l),d=It({inputs:{x:c},backend:n,attrs:{shape:h}}),f=Tk({inputs:{a:i,b:d},backend:n}),m=V3({inputs:{x:f},backend:n}),g=vp({inputs:{x:m},backend:n,attrs:{axis:l,keepDims:!1}}),x=It({inputs:{x:g},backend:n,attrs:{shape:h}}),_=Nk({inputs:{a:m,b:x},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),_}const ale={kernelName:Gv,backendName:"cpu",kernelFunc:zz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lle(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:r,seed:o,normalized:a}=s;Ie(i,"multinomial");const l=a?i:zz({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=l.shape[0],h=l.shape[1],d=n.data.get(l.dataId).values,f=[c,r],m=Vn(re(f),"int32");for(let g=0;g<c;++g){const x=g*h,_=new Float32Array(h-1);_[0]=d[x];for(let b=1;b<_.length;++b)_[b]=_[b-1]+d[x+b];const v=hI.alea(o.toString()),w=g*r;for(let b=0;b<r;++b){const I=v();m[w+b]=_.length;for(let S=0;S<_.length;S++)if(I<_[S]){m[w+b]=S;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(f,"int32",m)}const cle={kernelName:uO,backendName:"cpu",kernelFunc:lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ule=_I;function hle(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Ie(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,h=n.data.get(r.dataId).values,{selectedIndices:d}=ule(c,h,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const dle={kernelName:kC,backendName:"cpu",kernelFunc:hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fle=wI;function ple(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;Ie(i,"NonMaxSuppressionPadded");const h=n.data.get(i.dataId).values,d=n.data.get(r.dataId).values,{selectedIndices:f,validOutputs:m}=fle(h,d,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}const mle={kernelName:SC,backendName:"cpu",kernelFunc:ple};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gle=bI;function yle(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;Ie(i,"NonMaxSuppressionWithScore");const h=n.data.get(i.dataId).values,d=n.data.get(r.dataId).values,f=o,m=a,g=l,x=c,{selectedIndices:_,selectedScores:v}=gle(h,d,f,m,g,x);return[n.makeTensorInfo([_.length],"int32",new Int32Array(_)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const vle={kernelName:TC,backendName:"cpu",kernelFunc:yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{dtype:r,depth:o,onValue:a,offValue:l}=s;Ie(i,"oneHot");const c=re(i.shape),h=new Float32Array(c*o);h.fill(l);const d=n.data.get(i.dataId).values;for(let f=0;f<c;++f)d[f]>=0&&d[f]<o&&(h[f*o+d[f]]=a);return n.makeTensorInfo([...i.shape,o],r,h)}const _le={kernelName:Rv,backendName:"cpu",kernelFunc:xle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iy(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=$l({inputs:{input:s},backend:n}),r=iy({inputs:{x:i},backend:n}),o=mu({inputs:{input:s},backend:n}),a=iy({inputs:{x:o},backend:n}),l=bs({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return $k({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const wle={kernelName:Kv,backendName:"cpu",kernelFunc:iy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bz(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=$l({inputs:{input:s},backend:n}),r=Bz({inputs:{x:i},backend:n}),o=mu({inputs:{input:s},backend:n}),a=iy({inputs:{x:o},backend:n}),l=bs({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return $k({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const ble={kernelName:$v,backendName:"cpu",kernelFunc:Bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uz(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(e.length===1)return sy({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const r=e[0].shape,o=e[0].dtype;e.forEach(h=>{q1(r,h.shape,"All tensors passed to stack must have matching shapes"),R(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const d=sy({inputs:{input:h},backend:n,attrs:{dim:i}});return a.push(d),d}),c=gu({inputs:l,backend:n,attrs:{axis:i}});return a.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const Cle={kernelName:Av,backendName:"cpu",kernelFunc:Uz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,constantValue:o}=s;Ie(i,"pad");const a=r.map((w,b)=>w[0]+i.shape[b]+w[1]),l=r.map(w=>w[0]),c=n.data.get(i.dataId).values,h=re(i.shape),d=i.shape.length,f=Te(i.shape),m=re(a),g=a.length,x=Te(a),_=Wn(i.dtype,m);o!==0&&_.fill(o);for(let w=0;w<h;w++){const I=$u(w,d,f).map((T,$)=>T+l[$]),S=wr(I,g,x);_[S]=c[w]}return{dataId:n.write(_,a,i.dtype),shape:a,dtype:i.dtype}}const Wz={kernelName:Dv,backendName:"cpu",kernelFunc:Ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kle=Qt((t,e)=>Math.pow(t,e)),Sle=mn(Lf,kle),Tle={kernelName:Lf,backendName:"cpu",kernelFunc:Sle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:i,paramsDenseValues:r,indices:o}=e,{outputRaggedRank:a}=s,l=i.map(v=>n.data.get(v.dataId).values),c=i.map(v=>v.shape),h=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,[f,m,g]=az(l,c,h,r.shape,r.dtype,d,o.shape),x=f.map(v=>n.makeTensorInfo([v.length],"int32",v)),_=n.makeTensorInfo(g,r.dtype,m);return x.concat([_])}const Nle={kernelName:hO,backendName:"cpu",kernelFunc:Ele};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $le(t){const{inputs:e,backend:n}=t,{starts:s,limits:i,deltas:r}=e,o=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,[c,h]=lz(o,s.shape,s.dtype,a,i.shape,l,r.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([h.length],s.dtype,h);return[d,f]}const Rle={kernelName:dO,backendName:"cpu",kernelFunc:$le};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ale(t){const{inputs:e,backend:n,attrs:s}=t,{shape:i,values:r,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.data.get(i.dataId).values,h=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,f=a.map(_=>n.data.get(_.dataId).values),m=a.map(_=>_.shape),[g,x]=cz(c,i.shape,h,r.shape,r.dtype,d,o.shape,f,m,l);return n.makeTensorInfo(g,r.dtype,x)}const Dle={kernelName:fO,backendName:"cpu",kernelFunc:Ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t){const{backend:e,attrs:n}=t,{start:s,stop:i,dtype:r,step:o}=n,a=uz(s,i,o,r);return e.makeTensorInfo([a.length],r,a)}const Ole={kernelName:EC,backendName:"cpu",kernelFunc:Ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lle=mt(Ff,t=>1/t),Fle={kernelName:Ff,backendName:"cpu",kernelFunc:Lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mle(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s;Ie(i,"resizeBilinear");const l=Te(i.shape),[c,h]=a,[d,f,m,g]=i.shape,x=n.data.get(i.dataId).values,_=new Float32Array(re([d,c,h,g])),v=[r&&c>1?f-1:f,r&&h>1?m-1:m],w=[r&&c>1?c-1:c,r&&h>1?h-1:h];let b=0;const I=v[0]/w[0],S=v[1]/w[1];for(let T=0;T<d;T++)for(let $=0;$<c;$++){let E;o?E=I*($+.5)-.5:E=I*$;const D=Math.max(0,Math.floor(E)),P=E-D,z=Math.min(f-1,Math.ceil(E)),V=T*l[0]+D*l[1],q=T*l[0]+z*l[1];for(let K=0;K<h;K++){let J;o?J=S*(K+.5)-.5:J=S*K;const X=Math.max(0,Math.floor(J)),oe=J-X,O=Math.min(m-1,Math.ceil(J)),Z=V+X*l[2],j=q+X*l[2],te=V+O*l[2],ae=q+O*l[2];for(let ue=0;ue<g;ue++){const he=x[Z+ue],le=x[j+ue],ce=x[te+ue],we=x[ae+ue],Se=he+(ce-he)*oe,Ee=le+(we-le)*oe,Fe=Se+(Ee-Se)*P;_[b++]=Fe}}}return n.makeTensorInfo([d,c,h,g],"float32",_)}const zle={kernelName:Mv,backendName:"cpu",kernelFunc:Mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s;Ie([r,i],"resizeBilinearGrad");const a=Te(i.shape),[l,c,h,d]=i.shape,[,f,m]=r.shape,g=new Float32Array(l*c*h*d),x=[o&&f>1?c-1:c,o&&m>1?h-1:h],_=[o&&f>1?f-1:f,o&&m>1?m-1:m],v=x[0]/_[0],w=x[1]/_[1],b=n.data.get(r.dataId).values;let I=0;for(let S=0;S<l;S++){const T=S*a[0];for(let $=0;$<f;$++){const E=$*v,D=Math.floor(E),P=Math.min(Math.ceil(E),c-1),z=T+D*a[1],V=T+P*a[1],q=E-D,K=1-q;for(let J=0;J<m;J++){const X=J*w,oe=Math.floor(X),O=Math.min(Math.ceil(X),h-1),Z=X-oe,j=1-Z,te=z+oe*a[2],ae=z+O*a[2],ue=V+oe*a[2],he=V+O*a[2],le=K*j,ce=K*Z,we=q*j,Se=q*Z;for(let Ee=0;Ee<d;Ee++){const Fe=b[I++];g[te+Ee]+=Fe*le,g[ae+Ee]+=Fe*ce,g[ue+Ee]+=Fe*we,g[he+Ee]+=Fe*Se}}}}return n.makeTensorInfo([l,h,c,d],"float32",g)}const Ule={kernelName:RC,backendName:"cpu",kernelFunc:Ble};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s;Ie(i,"resizeNearestNeighbor");const l=Te(i.shape),[c,h]=a,[d,f,m,g]=i.shape,x=n.data.get(i.dataId).values,_=new Float32Array(d*c*h*g),v=[r&&c>1?f-1:f,r&&h>1?m-1:m],w=[r&&c>1?c-1:c,r&&h>1?h-1:h],b=v[0]/w[0],I=v[1]/w[1];let S=0;for(let T=0;T<d;T++){const $=T*l[0];for(let E=0;E<c;E++){const D=o?b*(E+.5):b*E;let P=Math.min(f-1,r?Math.round(D):Math.floor(D));o&&(P=Math.max(0,P));const z=$+P*l[1];for(let V=0;V<h;V++){const q=o?I*(V+.5):I*V;let K=Math.min(m-1,r?Math.round(q):Math.floor(q));o&&(K=Math.max(0,K));const J=z+K*l[2];for(let X=0;X<g;X++){const oe=x[J+X];_[S++]=oe}}}}return n.makeTensorInfo([d,c,h,g],i.dtype,_)}const Vle={kernelName:Fv,backendName:"cpu",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jle(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s;Ie([r,i],"resizeNearestNeighborGrad");const a=Te(i.shape),l=Te(r.shape),[c,h,d,f]=i.shape,[,m,g]=r.shape,x=new Float32Array(c*h*d*f),_=n.data.get(r.dataId).values,v=[o&&m>1?h-1:h,o&&g>1?d-1:d],w=[o&&m>1?m-1:m,o&&g>1?g-1:g],b=v[0]/w[0],I=v[1]/w[1],S=1/b,T=1/I,$=Math.ceil(S)*2+2,E=Math.ceil(T)*2+2;for(let D=0;D<c;D++){const P=D*a[0];for(let z=0;z<h;z++){const V=P+z*a[1],q=Math.floor(z*S),K=Math.floor(q-$/2);for(let J=0;J<d;J++){const X=V+J*a[2],oe=Math.floor(J*T),O=Math.floor(oe-E/2);for(let Z=0;Z<f;Z++){let j=0;for(let te=0;te<$;te++){const ae=te+K;if(ae<0||ae>=m)continue;const ue=P+ae*l[1],he=ae*b,le=Math.min(h-1,o?Math.round(he):Math.floor(he));if(z===le)for(let ce=0;ce<E;ce++){const we=ce+O;if(we<0||we>=g)continue;const Se=ue+we*l[2],Ee=we*I,Fe=Math.min(d-1,o?Math.round(Ee):Math.floor(Ee));J===Fe&&(j+=_[Se+Z])}}x[X+Z]=j}}}}return n.makeTensorInfo(i.shape,i.dtype,x)}const Gle={kernelName:$C,backendName:"cpu",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hle(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:r}=s;Ie(i,"reverse");const o=i.shape.length,a=Ge(r,i.shape);if(o===0)return Ar({inputs:{x:i},backend:n});const l=new An(i.shape,i.dtype),c=n.bufferSync(i);for(let h=0;h<l.size;h++){const d=l.indexToLoc(h),f=d.slice();a.forEach(m=>f[m]=i.shape[m]-1-f[m]),l.set(c.get(...f),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const qle={kernelName:zv,backendName:"cpu",kernelFunc:Hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kle={kernelName:MC,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:r,center:o}=e,a=n,l=Wn(s.dtype,re(s.shape)),[c,h,d,f]=s.shape,[m,g]=PI(o,h,d),x=255,_=Math.sin(i),v=Math.cos(i),w=a.data.get(s.dataId).values;for(let I=0;I<c;I++){const S=I*d*h*f;for(let T=0;T<h;T++){const $=T*(d*f);for(let E=0;E<d;E++){const D=E*f;for(let P=0;P<f;P++){const z=[c,T,E,P],V=z[2],q=z[1];let K=(V-m)*v-(q-g)*_,J=(V-m)*_+(q-g)*v;K=Math.round(K+m),J=Math.round(J+g);let X=r;if(typeof r!="number"&&(P===3?X=x:X=r[P]),K>=0&&K<d&&J>=0&&J<h){const O=J*(d*f),Z=K*f,j=S+O+Z+P;X=w[j]}const oe=S+$+D+P;l[oe]=X}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle=mt(Bf,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),Zle={kernelName:Bf,backendName:"cpu",kernelFunc:Xle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:r}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=Xl(r,i,o),f=!0,m=n.bufferSync(i),g=n.bufferSync(r),x=el(m,g,o,d,c,l,a,h,0,f);return n.makeTensorInfo(o,x.dtype,x.values)}const Qle={kernelName:pO,backendName:"cpu",kernelFunc:Yle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t,e){let n=0,s=t.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),t[i]<e?n=i+1:s=i;return s}function ece(t,e){let n=0,s=t.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),t[i]<=e?n=i+1:s=i;return s}function tce(t,e,n,s,i,r){const o=qt("int32",n*i);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),c=a*i;for(let h=0;h<i;++h)o[c+h]=r==="left"?Jle(l,e[h+c]):ece(l,e[h+c])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nce(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:i,values:r}=e,{side:o}=s,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=tce(a,l,i.shape[0],i.shape[1],r.shape[1],o);return n.makeTensorInfo(r.shape,"int32",c)}const sce={kernelName:gO,backendName:"cpu",kernelFunc:nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:r}=e;Ie([s,i,r],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,h=Ds(i.dtype,r.dtype),d=Vn(re(i.shape),h);let f=0;const m=o===0||o>1||i.shape.length===1?1:re(i.shape.slice(1));for(let g=0;g<a.length;g++)for(let x=0;x<m;x++)a[g]===1?d[f++]=l[g]:d[f++]=c[g];return n.makeTensorInfo(i.shape,h,d)}const rce={kernelName:Bv,backendName:"cpu",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=ix,ace=rx,lce=mt(Wf,t=>t>=0?ace*t:oce*(Math.exp(t)-1)),cce={kernelName:Wf,backendName:"cpu",kernelFunc:lce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uce=mt(Gf,t=>t<0?-1:t>0?1:0),hce={kernelName:Gf,backendName:"cpu",kernelFunc:uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dce=mt(Vf,t=>Math.sin(t)),fce={kernelName:Vf,backendName:"cpu",kernelFunc:dce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pce=mt(jf,t=>Math.sinh(t)),mce={kernelName:jf,backendName:"cpu",kernelFunc:pce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce=11920928955078125e-23,M2=Math.log(gce)+2,yce=mt(qf,t=>{const e=t>-M2,n=t<M2,s=Math.exp(t);let i;return n?i=s:e?i=t:i=Math.log(1+s),i}),vce={kernelName:qf,backendName:"cpu",kernelFunc:yce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,paddings:o}=s;Ie([i],"spaceToBatchND");const a=re(r),l=[[0,0]];l.push(...o);for(let T=1+r.length;T<i.shape.length;++T)l.push([0,0]);const c=Wz.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),h=lp(c.shape,r,a,!1),d=cp(h.length,r.length,!1),f=up(c.shape,r,a,!1),x=It({inputs:{x:c},backend:n,attrs:{shape:h}}),w=ms({inputs:{x},backend:n,attrs:{perm:d}}),S=It({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),S}const _ce={kernelName:Vv,backendName:"cpu",kernelFunc:xce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t){const{inputs:e,backend:n}=t,{indices:s,values:i,denseShape:r,defaultValue:o}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values[0],[d,f,m,g,x]=pz(a,s.shape,s.dtype,l,i.dtype,c,h);return[n.makeTensorInfo(f,s.dtype,d),n.makeTensorInfo([f[0]],i.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(_=>Number(_)))),n.makeTensorInfo([x.length],s.dtype,new Int32Array(x))]}const bce={kernelName:yO,backendName:"cpu",kernelFunc:wce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cce(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:i,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(r.dataId).values),[c,h,d]=mz(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(h,s.dtype,c),n.makeTensorInfo([d.length],r.dtype,new Int32Array(d))]}const Ice={kernelName:vO,backendName:"cpu",kernelFunc:Cce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kce(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${r.shape}`);if(i.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,[c,h]=Sk(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(h,s.dtype,c)}const Sce={kernelName:xO,backendName:"cpu",kernelFunc:kce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tce(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${r.shape}`);if(i.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,[c,h]=Sk(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(h,s.dtype,c)}const Ece={kernelName:_O,backendName:"cpu",kernelFunc:Tce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:r,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:d,outputSize:f}=Xl(r,i,a),m=!1,g=n.bufferSync(i);let x;switch(r.dtype){case"bool":{const _=n.bufferSync(r),v=!!n.data.get(o.dataId).values[0];x=el(g,_,a,f,h,c,l,d,v,m);break}case"float32":{const _=n.bufferSync(r),v=n.data.get(o.dataId).values[0];x=el(g,_,a,f,h,c,l,d,v,m);break}case"int32":{const _=n.bufferSync(r),v=n.data.get(o.dataId).values[0];x=el(g,_,a,f,h,c,l,d,v,m);break}case"string":{const _=n.bufferSync(r),v=ta(n.data.get(o.dataId).values[0]);x=el(g,_,a,f,h,c,l,d,v,m);break}default:throw new Error(`Unsupported type ${r.dtype}`)}return n.makeTensorInfo(a,x.dtype,x.values)}const $ce={kernelName:wO,backendName:"cpu",kernelFunc:Nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:r,axis:o}=s,a=Ge(o,i.shape)[0],l=XI(i,r,a),c=new Array(i.shape.length).fill(0),h=i.shape.slice();return l.map(d=>{const f=[...h];f[a]=d;const m=Rl({inputs:{x:i},backend:n,attrs:{begin:c,size:f}});return c[a]+=d,m})}const Ace={kernelName:jv,backendName:"cpu",kernelFunc:Rce};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dce={kernelName:AC,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Ie(n,"square");const i=s.data.get(n.dataId).values,r=new Float32Array(i.length);for(let a=0;a<i.length;++a){const l=i[a];r[a]=l*l}return{dataId:s.write(r,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pce=mt(ep,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),Oce={kernelName:ep,backendName:"cpu",kernelFunc:Pce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:f}=s;Ie(i,"stridedSlice");const{finalShapeSparse:m,finalShape:g,isIdentity:x,sliceDim0:_,isSimpleSlice:v,begin:w,end:b,strides:I}=RI(i.shape,r,o,a,l,c,h,d,f);let S;if(x)S=It({inputs:{x:i},backend:n,attrs:{shape:g}});else if(_||v){R(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const T=EI(w,b,I),$=Rl({inputs:{x:i},backend:n,attrs:{begin:w,size:T}});S=It({inputs:{x:$},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo($)}else{const T=n.bufferSync(i),$=vz(m,T,I,w);S=n.makeTensorInfo(g,$.dtype,$.values)}return S}const Fce={kernelName:PC,backendName:"cpu",kernelFunc:Lce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mce(t){const{inputs:e,backend:n,attrs:s}=t,{separator:i,nGramWidths:r,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:d}=e,f=n.data.get(h.dataId).values,m=n.data.get(d.dataId).values,[g,x]=xz(f,m,i,r,o,a,l,c);return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(d.shape,"int32",x)]}const zce={kernelName:bO,backendName:"cpu",kernelFunc:Mce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bce(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:i}=s,{input:r,delimiter:o}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values[0],[c,h,d]=_z(a,l,i),f=h.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const Uce={kernelName:CO,backendName:"cpu",kernelFunc:Bce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wce(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:i}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(r.dataId).values,a=wz(o,i);return n.makeTensorInfo(r.shape,"int32",a)}const Vce={kernelName:IO,backendName:"cpu",kernelFunc:Wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce=mt(Yf,t=>Math.tan(t)),Gce={kernelName:Yf,backendName:"cpu",kernelFunc:jce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce=mt(Qf,t=>Math.tanh(t)),qce={kernelName:Qf,backendName:"cpu",kernelFunc:Hce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(t){const{inputs:e,backend:n}=t,{tensor:s,indices:i,updates:r}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:c,outputSize:h}=Xl(r,i,s.shape),d=!1,f=n.bufferSync(i),m=n.bufferSync(r),g=n.bufferSync(s),x=el(f,m,s.shape,h,l,a,o,c,g,d);return n.makeTensorInfo(s.shape,x.dtype,x.values)}const Xce={kernelName:mO,backendName:"cpu",kernelFunc:Kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:r}=s;Ie(i,"tile");const o=Cz(n.bufferSync(i),r);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const Yce={kernelName:Jf,backendName:"cpu",kernelFunc:Zce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qce(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:r,sorted:o}=s;Ie(i,"topk");const a=n.data.get(i.dataId).values,[l,c]=kz(a,i.shape,i.dtype,r,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const Jce={kernelName:OC,backendName:"cpu",kernelFunc:Qce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(t){const{inputs:e,attrs:n,backend:s}=t,{image:i,transforms:r}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[h,d,f,m]=i.shape,[g,x]=c??[d,f],_=[h,g,x,m],v=Te(i.shape),w=v[0],b=v[1],I=v[2],S=Te(_),T=S[0],$=S[1],E=S[2],D=Wn(i.dtype,re(_));D.fill(l);const P=s.data.get(i.dataId).values,z=s.data.get(r.dataId).values;for(let q=0;q<h;++q){const K=r.shape[0]===1?z:z.subarray(q*8,q*8+8);for(let J=0;J<g;++J)for(let X=0;X<x;++X)for(let oe=0;oe<m;++oe){let O;const Z=K[6]*X+K[7]*J+1;if(Z===0)continue;const j=(K[0]*X+K[1]*J+K[2])/Z,te=(K[3]*X+K[4]*J+K[5])/Z,ae=z2(j,f,a),ue=z2(te,d,a);switch(o){case"nearest":O=oue(P,d,f,w,b,I,q,ue,ae,oe,l);break;case"bilinear":O=aue(P,d,f,w,b,I,q,ue,ae,oe,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const he=q*T+J*$+X*E+oe;D[he]=O}return s.makeTensorInfo(_,i.dtype,D)}return{dataId:s.write(D,_,i.dtype),shape:i.shape,dtype:i.dtype}}const tue={kernelName:LC,backendName:"cpu",kernelFunc:eue};function z2(t,e,n){switch(n){case"reflect":return nue(t,e);case"wrap":return sue(t,e);case"nearest":return rue(t,e);case"constant":default:return iue(t)}}function nue(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return vl(0,n,e-1)}function sue(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return vl(0,n,e-1)}function iue(t,e){return t}function rue(t,e){return vl(0,t,e-1)}function Fh(t,e,n,s,i,r,o,a,l,c,h){const d=o*s+a*i+l*r+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:h}function oue(t,e,n,s,i,r,o,a,l,c,h){const d=Math.round(a),f=Math.round(l);return Fh(t,e,n,s,i,r,o,d,f,c,h)}function aue(t,e,n,s,i,r,o,a,l,c,h){const d=Math.floor(a),f=Math.floor(l),m=d+1,g=f+1,x=(g-l)*Fh(t,e,n,s,i,r,o,d,f,c,h)+(l-f)*Fh(t,e,n,s,i,r,o,d,g,c,h),_=(g-l)*Fh(t,e,n,s,i,r,o,m,f,c,h)+(l-f)*Fh(t,e,n,s,i,r,o,m,g,c,h);return(m-a)*x+(a-d)*_}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:r}=e;Ie(r,"unique");const o=s.data.get(r.dataId).values,{outputValues:a,outputShape:l,indices:c}=Sz(o,i,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const cue={kernelName:FC,backendName:"cpu",kernelFunc:lue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i.shape.length,a=i.shape[r],l=new Array(o-1);let c=0;for(let m=0;m<o;m++)m!==r&&(l[c++]=i.shape[m]);const h=new Array(o).fill(0),d=i.shape.slice();d[r]=1;const f=new Array(a);for(let m=0;m<f.length;m++){h[r]=m;const g=Rl({inputs:{x:i},backend:n,attrs:{begin:h,size:d}});f[m]=It({inputs:{x:g},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(g)}return f}const hue={kernelName:Hv,backendName:"cpu",kernelFunc:uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:r}=e,{numSegments:o}=s;Ie(i,"unsortedSegmentSum");const a=i.shape.length,l=r.shape.length,c=[],h=[],d=a-l;let f=r;for(let g=0;g<d;++g){const x=sy({inputs:{input:f},backend:n,attrs:{dim:g+1}});f=x,h.push(x)}for(let g=0;g<o;++g){const x=ya(g,"int32"),_=n.makeTensorInfo([],"int32",x),v=U3({inputs:{a:_,b:f},backend:n}),w=oa({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),b=vx({inputs:{a:w,b:i},backend:n}),I=vp({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});c.push(I),h.push(_),h.push(v),h.push(w),h.push(b),h.push(I)}const m=Uz({inputs:c,backend:n,attrs:{axis:0}});return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const fue={kernelName:qv,backendName:"cpu",kernelFunc:due};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue=[lre,Wse,ure,dre,Kse,pre,gre,vre,_re,bre,Ire,Sre,Ere,Rre,Dre,Lre,Mre,Bre,Wre,ore,jre,Hre,Kre,Zse,Zre,Hse,Qse,Qre,Vse,eoe,noe,soe,roe,aoe,coe,hoe,foe,moe,yoe,xoe,woe,Coe,koe,Toe,Eoe,$oe,Aoe,Poe,Ooe,Loe,Foe,zoe,Woe,Jie,joe,Jse,Qoe,eie,Joe,nie,rae,oae,lae,iie,oie,uae,dae,pae,gae,lie,uie,jse,vae,toe,_ae,bae,Iae,ere,die,pie,Sae,gie,Eae,Rae,Dae,Lae,Mae,Bae,Uae,vie,Vae,Gae,qae,Xae,Yae,Jae,tle,_ie,sle,ole,cle,bie,Iie,dle,mle,vle,Sie,_le,ble,Cle,Wz,Tle,nre,Nie,Nle,Rle,Dle,Ole,Gse,ab,Fle,sre,ire,rre,zle,Ule,Vle,Gle,qle,Kle,Zle,Fie,Qle,sce,rce,cce,zie,hce,fce,mce,Bie,ale,vce,_ce,bce,Ice,Sce,Ece,$ce,Ace,Vie,Dce,Gie,qie,Oce,Fce,zce,Uce,Vce,Yie,Boe,Gce,qce,Xce,Yce,Jce,tue,Tie,cue,hue,fue,wle];for(const t of pue)SO(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qa={},xm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function mue(t,e){qa[t]=e}function er(t,e){if(!(t in qa)||e!=null){const s=yue(t,e);if(s!==null)qa[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=qa[t];return n==null||n.isContextLost()?(delete qa[t],er(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),qa[t])}function gue(t){if(!ee().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function yue(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??gue(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete qa[t]},!1),ee().getBool("SOFTWARE_WEBGL_ENABLED")&&(xm.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",xm)||n.getContext("experimental-webgl",xm):n.getContext("webgl2",xm)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fd;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Fd||(Fd={}));var Ws;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Ws||(Ws={}));var $n;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})($n||($n={}));function xp(t,e){return[e,t]}function vue(t,e){return t*e}function _m(t){const e=re(t),n=Math.ceil(e/4);return Ew(n)}function Mu(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function xue(t,e){const[n,s]=Mu(t,e);return n*s*4}function Rk(t,e){const n=t;let s,i,r,o,a,l,c,h,d,f;return ee().getNumber("WEBGL_VERSION")===2?(s=n.R32F,i=n.R16F,r=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,h=1,d=n.HALF_FLOAT,f=n.FLOAT,l=n.RGBA8):(s=t.RGBA,i=t.RGBA,r=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,h=4,d=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:h,textureTypeHalfFloat:d,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xe(t,e){const n=e();return ee().getBool("DEBUG")&&_ue(t),n}function _ue(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Iue(t,e))}const wue=596e-10,bue=65504;function Cue(t){return!!(ee().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||wue<Math.abs(t)&&Math.abs(t)<bue)}function Iue(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function wm(t,e){return yo(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function kue(t,e){const n=yo(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(xe(t,()=>t.shaderSource(n,e)),xe(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Sue(t,e){const n=yo(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(xe(t,()=>t.shaderSource(n,e)),xe(t,()=>t.compileShader(n)),ee().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw Vz(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Tue=/ERROR: [0-9]+:([0-9]+):/g;function Vz(t,e){const n=Tue.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],i=t.split(`
`),r=i.length.toString().length+2,o=i.map((d,f)=>Gc((f+1).toString(),r)+d);let a=0;for(let d=0;d<o.length;d++)a=Math.max(o[d].length,a);const l=o.slice(0,s-1),c=o.slice(s-1,s),h=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Gc(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function Eue(t){return yo(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function Nue(t,e){if(xe(t,()=>t.linkProgram(e)),!ee().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function o0(t,e){if(xe(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function $ue(t,e){const n=yo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return xe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),xe(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Rue(t,e){const n=yo(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return xe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),xe(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Aue(t){return yo(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Due(t,e){const n=ee().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function Pue(t){return yo(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function B2(t,e,n,s,i,r,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(xe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),xe(t,()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,r,o)),xe(t,()=>t.enableVertexAttribArray(a)),!0)}function Oue(t,e,n){Bue(t,n),xe(t,()=>t.activeTexture(t.TEXTURE0+n)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function Lue(t,e,n){return yo(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function Fue(t,e,n){return t.getUniformLocation(e,n)}function Mue(t,e,n,s){xe(t,()=>Oue(t,e,s)),xe(t,()=>t.uniform1i(n,s))}function a0(t,e,n){xe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),xe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function U2(t,e){xe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),xe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function bm(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+zue(t,e))}function zue(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function yo(t,e,n){const s=xe(t,()=>e());if(s==null)throw new Error(n);return s}function Bue(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function yu(t,e=2){return re(t.slice(0,t.length-e))}function vu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Cm(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[yu(t),...vu(t)]),e}function Uue(t,e=!1){let n=ee().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ee().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ee().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?H1(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=ga(t).newShape);let i=re(t),r=null;t.length<=1&&i<=n?r=[1,i]:t.length===2&&t[0]<=n&&t[1]<=n?r=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?r=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?r=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?r=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(r=[t[0],t[1]*t[2]*t[3]]);const o=r!=null&&Math.max(...r)>s&&Math.min(...r)<=(e?2:1)&&Math.min(...r)>0;if(r==null||o)if(e){const a=yu(t);let l=2,c=2;t.length&&([l,c]=vu(t)),i=a*(l/2)*(c/2),r=Ew(i).map(h=>h*2)}else r=Ew(i);return r}function Im(t){return t%2===0}function ry(t,e){if(t=t.slice(-2),e=e.slice(-2),ct(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Im(n)&&Im(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Im(t[0])&&Im(e[0])}let l0,c0;function Wue(t){if(l0==null){const e=er(t);l0=e.getParameter(e.MAX_TEXTURE_SIZE)}return l0}function Vue(t){if(c0==null){const e=er(t);c0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,c0)}function jue(t){if(t===0)return 0;let e;const n=er(t);return mi(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:mi(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function mi(t,e){return t.getExtension(e)!=null}function W2(t){try{if(er(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Gue(t){if(t===0)return!1;const e=er(t);if(t===1){if(!mi(e,"OES_texture_float"))return!1}else if(!mi(e,"EXT_color_buffer_float"))return!1;return cb(e)}function Hue(t){if(t===0)return!1;const e=er(t);if(t===1){if(!mi(e,"OES_texture_float")||!mi(e,"WEBGL_color_buffer_float"))return!1}else{if(mi(e,"EXT_color_buffer_float"))return cb(e);const s="EXT_color_buffer_half_float";if(mi(e,s)){const i=e.getExtension(s);return que(e,i)}return!1}return cb(e)}function cb(t){const e=Rk(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function que(t,e){const n=Rk(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function Kue(t){return t!==2?!1:er(t).fenceSync!=null}function _p(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&R(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ke=ee();ke.registerFlag("HAS_WEBGL",()=>ke.getNumber("WEBGL_VERSION")>0);ke.registerFlag("WEBGL_VERSION",()=>W2(2)?2:W2(1)?1:0);ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ke.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ke.get("WEBGL_VERSION")===2);ke.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ke.registerFlag("WEBGL_PACK",()=>ke.getBool("HAS_WEBGL"));ke.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_CLIP",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_REDUCE",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_LAZILY_UNPACK",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_CONV_IM2COL",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ke.getBool("WEBGL_PACK"));ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Wue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Vue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=ke.getNumber("WEBGL_VERSION");return t===0?0:jue(t)});ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!VO());ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Gue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Hue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Kue(ke.getNumber("WEBGL_VERSION")));ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});ke.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>VO()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ke.registerFlag("WEBGL_EXP_CONV",()=>!1);ke.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ke.getBool("IS_TEST"));ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ke.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ke.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(){let t,e,n,s,i,r,o,a,l,c;return ee().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",i="texture",r="outputColor",o="out vec4 outputColor;",a=ee().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",i="texture2D",r="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:i,output:r,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(t,e,n="index"){const s=Te(e);return s.map((i,r)=>{const o=`int ${t[r]} = ${n} / ${i}`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${i}`:`index -= ${t[r]} * ${i}`;return`${o}; ${a};`}).join("")}function xx(t,e,n="index"){const s=Te(e);return s.map((i,r)=>{const o=`int ${t[r]} = ${n} / outShapeStrides[${r}]`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * outShapeStrides[${r}]`:`index -= ${t[r]} * outShapeStrides[${r}]`;return`${o}; ${a};`}).join("")}function Xue(t,e){const n=t.length,s=t.map(r=>`${e}[${r}]`),i=new Array(n-1);i[n-2]=s[n-1];for(let r=n-3;r>=0;--r)i[r]=`(${i[r+1]} * ${s[r+1]})`;return i}function Zue(t,e,n="index"){const s=t.map((r,o)=>o),i=Xue(s,e);return i.map((r,o)=>{const a=`int ${t[o]} = ${n} / ${i[o]}`,l=o===i.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${i[o]}`:`index -= ${t[o]} * ${i[o]}`;return`${a}; ${l};`}).join("")}function Ak(t){const e=Te(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Dk(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const jz=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:Gz}=OJ;function Yue(t,e,n){const s=[];if(t.forEach(m=>{const g=re(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?s.push(`uniform float ${m.name}${g>1?`[${g}]`:""};`):(s.push(`uniform sampler2D ${m.name};`),s.push(`uniform int offset${m.name};`)),n.enableShapeUniforms){const{uniformShape:x}=Pk(n.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(x.length){case 1:s.push(`uniform int ${m.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${m.name}Shape;`);break}s.push(`uniform ivec2 ${m.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(m=>{s.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});const i=s.join(`
`),r=t.map(m=>Que(m,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=rs(),l=the(a);let c,h,d=ihe(a);return e.isPacked?(c=Jue(e.logicalShape,o,n.enableShapeUniforms),h=she(a)):(c=ehe(e.logicalShape,o,n.enableShapeUniforms),h=nhe(a)),n.packedInputs&&(d+=lhe),[d,l,h,i,c,r,n.userCode].join(`
`)}function zu(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return _he(t,e);case 1:return bhe(t,e);case 2:return Ihe(t,e);case 3:return She(t,e);case 4:return Ehe(t,e);case 5:return Nhe(t);case 6:return $he(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Hz(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return xhe(t);case 1:return whe(t,e);case 2:return Che(t,e);case 3:return khe(t,e);default:return The(t,e)}}function Que(t,e,n=!1,s){let i="";n?i+=Hz(t,s):i+=zu(t,s);const r=t.shapeInfo.logicalShape,o=e.logicalShape;return r.length<=o.length&&(n?i+=Rhe(t,e):i+=Ahe(t,e)),i}function Jue(t,e,n){switch(t.length){case 0:return qz();case 1:return che(t,e,n);case 2:return yhe(t,e,n);case 3:return hhe(t,e,n);default:return fhe(t,e,n)}}function ehe(t,e,n){switch(t.length){case 0:return qz();case 1:return uhe(t,e,n);case 2:return vhe(t,e,n);case 3:return dhe(t,e,n);case 4:return phe(t,e,n);case 5:return mhe(t,e);case 6:return ghe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function the(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function nhe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function she(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function ihe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${rhe}
    ${ohe}
    ${ahe}
  `}const rhe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ohe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ahe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lhe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function qz(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function che(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function uhe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function hhe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),r=i*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function dhe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${xx(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Ql(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function fhe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),r=i*Math.ceil(t[t.length-2]/2);let o=r,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${t.length}(${l});
    }
  `}function phe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${xx(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ql(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function mhe(t,e){const n=Ql(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function ghe(t,e){const n=Ql(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function yhe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(ct(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const i=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function vhe(t,e,n){return ct(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Jl(t){return`offset${t}`}function xhe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=rs();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function _he(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[i,r]=t.shapeInfo.texShape;if(i===1&&r===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Jl(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function whe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,r=rs();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${r.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${r.texture2D}(${n}, uv);
    }
  `}function bhe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Bu(t)}
      }
    `;const i=t.shapeInfo.texShape,r=i[0],o=i[1];if(o===1&&r===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Jl(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${r}.0);
        return sampleTexture(${n}, uv);
      }
    `:r===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${r}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Che(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,o=r[0],a=r[1],l=rs();if(r!=null&&ct(n,r))return e?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],h=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function Ihe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape;if(r!=null&&ct(n,r)){if(e)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=r[0],m=r[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=ga(n),l=o;if(l.length<n.length){const f=Uu(t,l),m=["row","col"];return`
      ${zu(f,e)}
      float ${i}(int row, int col) {
        return ${i}(${Wu(m,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Bu(t)}
      }
    `;const c=r[0],h=r[1],d=Jl(s);return h===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function khe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(n[0]===1){const f=n.slice(1),m=[1,2],g=Uu(t,f),x=["b","row","col"];return`
        ${Hz(g,e)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${Wu(x,m)});
        }
      `}const a=rs();if(e)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],c=o[1],h=Math.ceil(n[2]/2),d=h*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${h}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function She(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=ga(n),c=a;if(c.length<n.length){const x=Uu(t,c),_=["row","col","depth"];return`
        ${zu(x,e)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${Wu(_,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${r}, ${o}, 1)));
        ${Bu(t)}
      }
    `;const h=t.shapeInfo.texShape,d=h[0],f=h[1],m=t.shapeInfo.flatOffset;if(f===r&&m==null)return e?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===o&&m==null)return e?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const g=Jl(s);return e?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${g};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r} + col * ${o} + depth + ${g};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function The(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=rs();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const r=t.shapeInfo.logicalShape,o=r.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],h=l[1],d=Math.ceil(r[o-1]/2);let f=d*Math.ceil(r[o-2]/2),m="int b, int row, int col",g=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let x=2;x<o-1;x++)m=`int b${x}, `+m,f*=r[o-x-1],g=`b${x} * ${f} + `+g;return`
    vec4 ${s}(${m}) {
      int index = ${g};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${c});
      return ${i.texture2D}(${n}, uv);
    }
  `}function Ehe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[3],o=n[2]*r,a=n[1]*o,{newShape:l,keptDims:c}=ga(n);if(l.length<n.length){const w=Uu(t,l),b=["row","col","depth","depth2"];return`
      ${zu(w,e)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${Wu(b,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${r}, 1)));
        ${Bu(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],m=d[1],g=`int stride2 = ${s}Shape[3];`,x=`int stride1 = ${s}Shape[2] * stride2;`,_=`int stride0 = ${s}Shape[1] * stride1;`;if(m===a&&h==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${g}
        ${x}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(m===r&&h==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const v=Jl(s);return e?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${g}
      ${x}
      ${_}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${v});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${r} + depth2;
      vec2 uv = uvFromFlat(${f}, ${m}, index + ${v});
      return sampleTexture(${s}, uv);
    }
  `}function Nhe(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],r=e[3]*i,o=e[2]*r,a=e[1]*o,{newShape:l,keptDims:c}=ga(e);if(l.length<e.length){const x=Uu(t,l),_=["row","col","depth","depth2","depth3"];return`
      ${zu(x)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Wu(_,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${r}, ${i})) +
          depth3;
        ${Bu(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],m=d[1];if(m===a&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${r}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(m===i&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=Jl(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${r} +
          depth2 * ${i} + depth3 + ${g};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${n}, uv);
    }
  `}function $he(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:r}=ga(e);if(i.length<e.length){const _=Uu(t,i),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${zu(_)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Wu(v,r)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,h=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Bu(t)}
      }
    `;const d=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,m=f[0],g=f[1];if(g===h&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(g===o&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;const x=Jl(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${x};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Bu(t){const e=t.name,n=re(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Rhe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",r=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=Gz(t.shapeInfo.logicalShape,e.logicalShape),l=yt(o),c=o-r;let h;const d=["x","y","z","w","u","v"];r===0?h="":o<2&&a.length>=1?h="coords = 0;":h=a.map(w=>`coords.${d[w+c]} = 0;`).join(`
`);let f="";o<2&&r>0?f="coords":f=t.shapeInfo.logicalShape.map((w,b)=>`coords.${d[b+c]}`).join(", ");let m="return outputValue;";const x=re(t.shapeInfo.logicalShape)===1,v=re(e.logicalShape)===1;if(r===1&&!x&&!v)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(x&&!v)o===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=r-2,b=r-1;a.indexOf(w)>-1&&a.indexOf(b)>-1?m="return vec4(outputValue.x);":a.indexOf(w)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${f});
      ${m}
    }
  `}function Ahe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",r=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&ct(o,r))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=yt(l),h=Gz(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let f;const m=["x","y","z","w","u","v"];a===0?f="":l<2&&h.length>=1?f="coords = 0;":f=h.map(x=>`coords.${m[x+d]} = 0;`).join(`
`);let g="";return l<2&&a>0?g="coords":g=t.shapeInfo.logicalShape.map((x,_)=>`coords.${m[_+d]}`).join(", "),`
    float ${i}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${s}(${g});
    }
  `}function yt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Pk(t,e,n){const{newShape:s,keptDims:i}=ga(e),r=e.length,o=t&&r===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&r>1&&!ct(e,n)&&s.length<r||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:i}}function Uu(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Wu(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dhe(t,e,n,s){const i=n.map((h,d)=>{const f={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(f.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:f}}),r=i.map(h=>h.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=Yue(i,o,e),l=Sue(t.gl,a),c=t.createProgram(l);return ee().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:r,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:r,outShapeInfo:o},Kz(t,e,c)))}function Kz(t,e,n){const s=[],i=[];let r,o,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),ee().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const h=!1;for(const d of e.variableNames){const f={name:d,uniform:t.getUniformLocation(n,d,h),offset:t.getUniformLocation(n,`offset${d}`,h)};e.enableShapeUniforms&&(f.shape=t.getUniformLocation(n,`${d}Shape`,h),f.texShape=t.getUniformLocation(n,`${d}TexShape`,h)),s.push(f)}if(e.enableShapeUniforms&&(r=t.getUniformLocation(n,"outShape",h),a=t.getUniformLocation(n,"outShapeStrides",h),o=t.getUniformLocation(n,"outTexShape",h)),e.customUniforms)for(const d of e.customUniforms)i.push(t.getUniformLocation(n,d.name,h));return{variablesLocations:s,customUniformLocations:i,infLoc:l,nanLoc:c,outShapeLocation:r,outShapeStridesLocation:a,outTexShapeLocation:o}}function V2(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const i=n.logicalShape,r=e[s],o=r.shape;if(!ct(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(n.isUniform&&r.isUniform)return;const a=n.texShape,l=r.isUniform?null:r.texData.texShape;if(!ct(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Phe(t,e,n,s,i){e.program.enableShapeUniforms||(V2(e.inShapeInfos,n),V2([e.outShapeInfo],[s]));const r=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(r.texture,o[0],o[1]):t.setOutputMatrixTexture(r.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),ee().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:h,offset:d,shape:f,texShape:m}=e.variablesLocations[l];if(f){const{uniformShape:g}=Pk(e.program.packedInputs,c.shape,c.texData.texShape);switch(g.length){case 1:t.gl.uniform1iv(f,new Int32Array(g));break;case 2:t.gl.uniform2iv(f,new Int32Array(g));break;case 3:t.gl.uniform3iv(f,new Int32Array(g));break;case 4:t.gl.uniform4iv(f,new Int32Array(g));break}}if(m&&t.gl.uniform2i(m,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(re(c.shape)<2)t.gl.uniform1f(h,c.uniformValues[0]);else{let g=c.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),t.gl.uniform1fv(h,g)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,h,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Te(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&i)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],h=e.customUniformLocations[l],d=i[l];if(c.type==="float")t.gl.uniform1fv(h,d);else if(c.type==="vec2")t.gl.uniform2fv(h,d);else if(c.type==="vec3")t.gl.uniform3fv(h,d);else if(c.type==="vec4")t.gl.uniform4fv(h,d);else if(c.type==="int")t.gl.uniform1iv(h,d);else if(c.type==="ivec2")t.gl.uniform2iv(h,d);else if(c.type==="ivec3")t.gl.uniform3iv(h,d);else if(c.type==="ivec4")t.gl.uniform4iv(h,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function Ohe(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:h,keptDims:d}=Pk(t.packedInputs,o.shape,l);let f="",m="",g="";if(h.length===1&&t.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${S[0]>1}_${S[1]>1}`}else if(h.length===2&&!t.packedInputs)m=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!t.packedInputs){const S=Te(h);g=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const x=o.shape.length,_=h.length===2&&ct(o.shape,l),v=re(o.shape)===1,w=uu(o.shape,n.shape),b=!t.packedInputs&&x===n.shape.length&&ct(l,n.texData.texShape),I=t.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${x}_${b}_${c?d:""}_${h.length}_${v}_${w}_${_}_${f}_${m}_${g}_${I}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const i=t.userCode;let r=t.constructor.name;return r+="_"+s+"_"+i+`${ee().getNumber("WEBGL_VERSION")}`,r}function qn(t){return ee().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lhe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Fd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xx(["r","c","d"],e):Ql(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fhe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Fd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xx(["r","c","d"],e):Ql(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mhe{constructor(e){this.variableNames=["A"],this.outTexUsage=Ws.DOWNLOAD;const n=rs();this.outputShape=e,this.userCode=`
      ${jz}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zhe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ws.DOWNLOAD;const n=rs();this.outputShape=e,this.userCode=`
      ${jz}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bhe={R:0,G:1,B:2,A:3};class j2{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);let r="result";n&&(r="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Bhe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Dk():Ak(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${o}
        }
        ${i.output} = vec4(${r}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uhe{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=rs();this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);let i="",r="result";n&&(r="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Dk():Ak(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${s.output} = ${r};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Whe(t){const e=rs(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return kue(t,n)}function Vhe(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return $ue(t,e)}function jhe(t){const e=new Uint16Array([0,1,2,2,1,3]);return Rue(t,e)}function wp(t,e,n,s,i,r){Due(e,n);const o=Aue(t),a=t.TEXTURE_2D;return xe(t,()=>t.bindTexture(a,o)),xe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),xe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),xe(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),xe(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ee().getNumber("WEBGL_VERSION")===1?xe(t,()=>t.texImage2D(a,0,s,e,n,0,i,r,null)):xe(t,()=>t.texStorage2D(a,1,s,e,n)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function Xz(t){return t.internalFormatFloat}function Ghe(t,e,n,s){const[i,r]=xp(e,n);return wp(t,i,r,Xz(s),s.textureFormatFloat,t.FLOAT)}function Zz(t){return t.internalFormatHalfFloat}function Hhe(t,e,n,s){const[i,r]=xp(e,n);return wp(t,i,r,Zz(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function Yz(t){return t.downloadTextureFormat}function qhe(t,e,n,s){const[i,r]=xp(e,n);return wp(t,i,r,Yz(s),t.RGBA,t.UNSIGNED_BYTE)}function Qz(t){return t.internalFormatPackedFloat}function Khe(t,e,n,s){const[i,r]=Mu(e,n);return wp(t,i,r,Qz(s),t.RGBA,t.FLOAT)}function Jz(t){return t.internalFormatPackedHalfFloat}function Xhe(t,e,n,s){const[i,r]=Mu(e,n);return wp(t,i,r,Jz(s),t.RGBA,s.textureTypeHalfFloat)}function Zhe(t,e,n){return xe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),B2(t,e,"clipSpacePos",n,3,20,0)&&B2(t,e,"uv",n,2,20,12)}function Yhe(t,e,n,s,i,r){xe(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;i instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=r.internalFormatPackedFloat),o.set(i),ee().getNumber("WEBGL_VERSION")===2?xe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):xe(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Qhe(t,e,n){xe(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?ee().getNumber("WEBGL_VERSION")===2?xe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):xe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):ee().getNumber("WEBGL_VERSION")===2?xe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):xe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),xe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Jhe(t,e,n,s){const i=t.createBuffer();xe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i));const a=4*4*e*n;return xe(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),xe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),xe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),i}function ede(t,e,n){const s=t,i=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function tde(t,e,n,s){const[i,r]=xp(e,n),o=4,a=new Uint8Array(vue(e*n,o));return xe(t,()=>t.readPixels(0,0,i,r,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function nde(t,e,n,s,i,r,o,a){const l=t,c=new Float32Array(xue(r,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function sde(t,e,n){const s=new Float32Array(e*n*4);return xe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ee().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,mue(n,e)):this.gl=er(n),e=this.gl,ee().getNumber("WEBGL_VERSION")===2){const r=e;this.createVertexArray=()=>xe(r,()=>r.createVertexArray()),this.bindVertexArray=o=>xe(r,()=>r.bindVertexArray(o)),this.deleteVertexArray=o=>xe(r,()=>r.deleteVertexArray(o)),this.getVertexArray=()=>xe(r,()=>r.getParameter(r.VERTEX_ARRAY_BINDING))}else if(e!=null){const r=e.getExtension("OES_vertex_array_object");if(r==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>xe(e,()=>r.createVertexArrayOES()),this.bindVertexArray=o=>xe(e,()=>r.bindVertexArrayOES(o)),this.deleteVertexArray=o=>xe(e,()=>r.deleteVertexArrayOES(o)),this.getVertexArray=()=>xe(e,()=>e.getParameter(r.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ee().getNumber("WEBGL_VERSION")===1){const r="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=wm(this.gl,r),mi(this.gl,o))this.textureHalfFloatExtension=wm(this.gl,o);else if(ee().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),mi(this.gl,i))this.colorBufferHalfFloatExtension=wm(this.gl,i);else if(ee().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",mi(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(mi(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Vhe(this.gl),this.indexBuffer=jhe(this.gl),this.framebuffer=Pue(this.gl),this.textureConfig=Rk(this.gl,this.textureHalfFloatExtension)}get debug(){return ee().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;xe(e,()=>e.finish()),xe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),xe(e,()=>e.deleteFramebuffer(this.framebuffer)),xe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),xe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),xe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),Ghe(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),Hhe(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),qhe(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),Qhe(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,i){this.throwIfDisposed(),Yhe(this.gl,e,n,s,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),Xhe(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),Khe(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(U2(this.gl,this.framebuffer),this.outputTexture=null),xe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>tde(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,i,r,o){return nde(this.gl,e,n,s,i,r,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return ede(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const i=Jhe(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(ee().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=i.clientWaitSync(r,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},n=r}else ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>sde(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Whe(n));const s=Eue(n);xe(n,()=>n.attachShader(s,this.vertexShader)),xe(n,()=>n.attachShader(s,e)),Nue(n,s);const i=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&o0(n,i),i}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;xe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Zhe(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(xe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&o0(this.gl,this.program),xe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?Lue(this.gl,e,n):Fue(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),xe(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),Mue(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[i,r]=Mu(n,s);this.setOutputMatrixTextureDriver(e,i,r)}setOutputMatrixWriteRegion(e,n,s,i){this.setOutputMatrixWriteRegionDriver(s,e,i,n)}setOutputPackedMatrixWriteRegion(e,n,s,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&o0(this.gl,this.program),bm(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}xe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),xe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=wm(this.gl,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),r=s.createQuery();return s.beginQuery(i.TIME_ELAPSED_EXT,r),r}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await NN(()=>this.disposed||this.isQueryAvailable(e,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),r=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),r&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),i=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=ide(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ee().platform&&(s=ee().platform.setTimeoutCustom.bind(ee().platform)),NN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),a0(this.gl,e,this.framebuffer),this.debug&&bm(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(a0(this.gl,this.outputTexture,this.framebuffer),this.debug&&bm(this.gl)):U2(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const i=this.gl;a0(i,e,this.framebuffer),this.debug&&bm(i),this.outputTexture=e,xe(i,()=>i.viewport(0,0,n,s)),xe(i,()=>i.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,i){this.throwIfDisposed(),xe(this.gl,()=>this.gl.scissor(e,n,s,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function ide(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:rde,bincountImpl:eB,bincountReduceImpl:ode,bitwiseAndImpl:ade,castImpl:lde,ceilImpl:cde,concatImpl:ude,equalImpl:hde,expImpl:dde,expm1Impl:fde,floorImpl:pde,gatherNdImpl:mde,gatherV2Impl:gde,greaterImpl:yde,greaterEqualImpl:vde,lessImpl:xde,lessEqualImpl:_de,linSpaceImpl:wde,logImpl:bde,maxImpl:Cde,maximumImpl:Ide,minimumImpl:kde,multiplyImpl:Sde,negImpl:Tde,notEqualImpl:Ede,prodImpl:Nde,raggedGatherImpl:$de,raggedRangeImpl:Rde,raggedTensorToTensorImpl:Ade,rangeImpl:Dde,rsqrtImpl:Pde,scatterImpl:Ode,sigmoidImpl:Lde,simpleAbsImpl:tB,sliceImpl:Fde,sparseFillEmptyRowsImpl:Mde,sparseReshapeImpl:zde,sparseSegmentReductionImpl:nB,sqrtImpl:Bde,staticRegexReplaceImpl:Ude,stridedSliceImpl:Wde,stringNGramsImpl:Vde,stringSplitImpl:jde,stringToHashBucketFastImpl:Gde,subImpl:Hde,tileImpl:qde,topKImpl:Kde,transposeImpl:Ok,uniqueImpl:Xde}=Qie;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sB(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function ts(t,e){return e===1?[t]:sB(t,e)}function Zde(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yde{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=qn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=ts("rc",this.rank),s=yt(this.rank),i=this.getOutOfBoundsCondition(n),r=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${r}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let r=`${s===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)r=`${e[e.length-1-o]},`+r;n.push(r)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${i};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iB{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);let s="";for(let i=0;i<4;i++){let r="thisRC = rc;";i%2===1&&(r+="thisRC.z += 1;"),i>1&&(r+="thisRC.y += 1;"),s+=`
        ${r}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${Qde(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Dk():Ak(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function Qde(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Zue(["r","c","d"],"inputShape"):Ql(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jde{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const i=H2(n,s),r=q2(e,i,s);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const o=G2(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[r].pop();return this.usedTextures[r].push(l),l}let a;return i===$n.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===$n.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===$n.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===$n.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===$n.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,i){if(this.freeTextures==null)return;const r=H2(s,i),o=q2(n,r,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=G2(n,r,this.gpgpu.gl,this.gpgpu.textureConfig,i),l=ee().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],h=c&&c.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[h]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function efe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function G2(t,e,n,s,i){const r=tfe(e,s);let o;if(i){const[l,c]=Mu(t[0],t[1]);o=l*c}else{const[l,c]=xp(t[0],t[1]);o=l*c}const a=efe(n,r);return o*a}function tfe(t,e){switch(t){case $n.PACKED_2X2_FLOAT32:return Qz(e);case $n.PACKED_2X2_FLOAT16:return Jz(e);case $n.UNPACKED_FLOAT32:return Xz(e);case $n.UNPACKED_FLOAT16:return Zz(e);case $n.PACKED_4X1_UNSIGNED_BYTE:return Yz(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function nfe(t){return ee().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?$n.PACKED_2X2_FLOAT32:$n.UNPACKED_FLOAT32:t?$n.PACKED_2X2_FLOAT16:$n.UNPACKED_FLOAT16}function H2(t,e){if(t===Ws.UPLOAD)return $n.PACKED_2X2_FLOAT32;if(t===Ws.RENDER||t==null)return nfe(e);if(t===Ws.DOWNLOAD||t===Ws.PIXELS)return $n.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function q2(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gr{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Ii="if (isnan(x)) return x;",sfe="return x;",K2="return abs(x);",ife="return (x >= 0.0) ? x : (exp(x) - 1.0);",rfe=Ii+`
  return (x < 0.0) ? 0.0 : x;
`,ofe=Ii+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Io="return x;",afe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lfe="return x;",cfe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ufe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hfe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,dfe="return 1.0 / (1.0 + exp(-1.0 * x));";class Lo{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ffe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);const n=e.length,s=ts("rc",n),i=yt(n),r=Zde(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${r});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pfe=$L,mfe=1e-7,gfe=1e-4,km={};function yfe(t){return t in km||(km[t]={}),km[t]}const vfe=ee().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),xfe=600;function _fe(){return ee().global.screen==null?1024:ee().global.screen.height*ee().global.screen.width*window.devicePixelRatio*xfe/1024/1024}class _x extends G1{nextDataId(){return _x.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ee().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof u0)n=e;else{const s=er(ee().getNumber("WEBGL_VERSION"),e);n=new u0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=er(ee().getNumber("WEBGL_VERSION"));n=new u0(s),this.binaryCache=yfe(ee().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Jde(this.gpgpu),this.numMBBeforeWarning=_fe(),this.texData=new QP(this,ur())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,i,r,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[i,r]},l.texShape=[i,r];const c=Cm(n),h=new j2(c,!1,o),d=this.runWebGLProgram(h,[a],s,[[i,r]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((ee().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ee().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:s,values:e,usage:Ws.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,i,r){if(ee().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:i,values:n,usage:Ws.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:i,complexTensorInfos:r,slice:o,shape:a,isPacked:l}=n;if(o!=null){let f;l?f=new Lo(a,Io):f=new gr(a,Io);const m=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:i}],i),g=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return s;const c=this.activeTimers!=null;let h;c&&(h=ls());let d;if(i==="complex64"){const f=this.readSync(r.real.dataId),m=this.readSync(r.imag.dataId);d=lo(f,m)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=ls()-h),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const g=this.pendingRead.get(e);return new Promise(x=>g.push(x))}const n=this.texData.get(e),{values:s,shape:i,slice:r,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(r!=null){let g;l?g=new Lo(i,Io):g=new gr(i,Io);const x=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:o}],o),_=this.read(x.dataId);return this.disposeIntermediateTensorInfo(x),_}if(s!=null)return this.convertAndCacheOnCPU(e);if(ee().getBool("DEBUG")&&!ee().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ee().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,h;if(o!=="complex64"&&ee().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const g=this.texData.get(h.dataId);c=this.gpgpu.createBufferFromTexture(g.texture.texture,..._m(i))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(o==="complex64"){const g=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),x=g[0],_=g[1];d=lo(x,_)}else if(c==null)d=this.getValuesFromTexture(e);else{const g=re(i);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,g)}if(h!=null&&this.disposeIntermediateTensorInfo(h),c!=null){const g=this.gpgpu.gl;xe(g,()=>g.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,d),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(g=>g(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ur().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,n={}){const s=this.texData.get(e),{values:i,shape:r,slice:o,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let m;l?m=new Lo(r,Io):m=new gr(r,Io);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:a}],a),x=this.readToGPU(g,n);return this.disposeIntermediateTensorInfo(g),x}if(c==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,n.customTexShape),d=ur().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(i=>ta(i));return je(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return je(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!Cue(s))throw ee().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:i}=this.texData.get(e),r=re(n);if(ee().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),m=this.texData.get(f.dataId),g=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,..._m(n)).subarray(0,r);return this.disposeIntermediateTensorInfo(f),g}const o=ee().getBool("WEBGL_PACK")&&i===!0,a=o?Cm(n):n,l=o?new zhe(a):new Mhe(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),h=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,e();const r=xl(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=xl(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(r);a.kernelMs=O8(l),a.getExtraProfileInfo=()=>l.map((c,h)=>({name:o[h],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ls(),endMs:null}}endTimer(e){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ls(),e)}async getQueryTime(e){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:i,usage:r,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(n,i,r,o)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=vfe){return ee().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&re(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Bs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return pfe(e.shape,n)}packedUnaryOp(e,n,s){const i=new Lo(e.shape,n),r=this.compileAndRun(i,[e],s);return ur().makeTensorFromTensorInfo(r)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const i=tB(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(ee().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,K2,e.dtype);const n=new gr(e.shape,K2),s=this.compileAndRun(n,[e]);return ur().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&rf(s[0])){const r=s.map(o=>Xo(o));i=this.write(r,e,n)}else i=this.write(s,e,n);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:n}}makeOutput(e,n,s){return ur().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new ffe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new Yde(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[yu(e.shape),...vu(e.shape)],i={dtype:e.dtype,shape:s,dataId:e.dataId},r=[yu(n),...vu(n)],o=new iB(r,s),a=!0,l=[s],c=this.runWebGLProgram(o,[i],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:i,shape:r,dtype:o}=s;if(n!=null){const f=re(r),m=n[0]*n[1]*4;R(f<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Cm(r);let l;i?l=new Fhe(a):l=new Lhe(a);const c=!0,h=[n??_m(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,h,c,n);return{dtype:o,shape:r,dataId:d.dataId}}runWebGLProgram(e,n,s,i,r=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Fd.DENSE){const v=o??_m(e.outputShape);l.texShape=v.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),re(a.shape)===0)return l.values=Wn(a.dtype,0),a;const c=[],h=n.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(v.dataId);if(w.texture==null){if(!e.packedInputs&&re(v.shape)<=ee().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!w.isPacked!=!!e.packedInputs)v=w.isPacked?this.unpackTensor(v):this.packTensor(v),c.push(v),w=this.texData.get(v.dataId);else if(w.isPacked&&!ry(w.shape,v.shape)){const b=v,I=v.shape;v.shape=w.shape,v=this.packedReshape(v,I),c.push(v),w=this.texData.get(v.dataId),b.shape=I}return{shape:v.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},f=Ohe(e,h,d),m=this.getAndSaveBinary(f,()=>Dhe(this.gpgpu,e,h,d)),g=this.activeTimers!=null;let x;g&&(x=this.startTimer()),ee().get("ENGINE_COMPILE_ONLY")||Phe(this.gpgpu,m,h,d,i),c.forEach(v=>this.disposeIntermediateTensorInfo(v)),g&&(x=this.endTimer(x),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(x)}));const _=ee().getNumber("WEBGL_FLUSH_THRESHOLD");if(_>0){const v=ls();v-this.lastGlFlushTime>_&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!ee().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&r===!1){const v=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),v}return a}compileAndRun(e,n,s,i,r=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,i,r)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ee().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Q(()=>{if(!ee().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ee().getBool("DEBUG");ee().set("DEBUG",!1);const n=this.abs(rt(1e-8)).dataSync()[0];if(ee().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?mfe:gfe}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:i,values:r,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let h;c&&(h=ls());let d=n.texShape;if(d==null&&(d=Uue(s,l),n.texShape=d),r!=null){const f=Cm(s);let m,g=d[1],x=d[0];const _=r instanceof Uint8Array||r instanceof Uint8ClampedArray;(l||!_)&&([g,x]=Mu(d[0],d[1])),l?m=new Uhe(f,_):m=new j2(f,_);const v=_?[x,g]:d,w=this.makeTensorInfo(v,i),b=this.texData.get(w.dataId);_?b.usage=Ws.PIXELS:b.usage=Ws.UPLOAD,b.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),g,x,r);const I=[[x,g]],T=this.runWebGLProgram(m,[w],i,I,!0),$=this.texData.get(T.dataId);n.texShape=$.texShape,n.isPacked=$.isPacked,n.usage=$.usage,ee().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(n.texture=$.texture,n.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(w),c&&(this.uploadWaitMs+=ls()-h)}else{const f=this.acquireTexture(d,a,i,l);n.texture=f}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:i}=s;return n!=null&&(s.values=wfe(n,i)),s.values}acquireTexture(e,n,s,i){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const r=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${r} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,i)}computeBytes(e,n){return e[0]*e[1]*Ag(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(r){throw r}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await XL(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Vz(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:i,nanLoc:r,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=Kz(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=i,e.nanLoc=r,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:i,height:r,width:o,channels:a}=e,l=ur().backend;if(!l.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(i,n,s,r,o,a);return ur().makeTensorFromDataId(c,n,s,l)}}_x.nextDataId=0;function wfe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jO()&&qO("webgl",()=>new _x,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lk=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Al{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=ze(n,s),this.enableShapeUniforms=qn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Vu{constructor(e,n,s,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ze(n,s);const r=this.outputShape.length;this.enableShapeUniforms=qn(r);let o="";if(i)if(r===0||re(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${yt(r)} coords = getOutputCoords();
        `,r===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=ts("coords",r);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= outShape[${r} - 2];
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= outShape[${r} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= ${this.outputShape[r-2]};
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= ${this.outputShape[r-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Os(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const bfe={kernelName:Sf,backendName:"webgl",kernelFunc:Os};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,r=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(r.dataId),a=Os({inputs:{x:s},backend:n}),l=Os({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:l},r}const Cfe={kernelName:rC,backendName:"webgl",kernelFunc:Sa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rB="return (a < 0.) ? b * a : a;",oB=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Ife(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:r}=s,o=n.makeTensorInfo([],"float32",ya(r,"float32")),a=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(oB,i.shape,o.shape):new Al(rB,i.shape,o.shape),l=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const kfe={kernelName:mv,backendName:"webgl",kernelFunc:Ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aB="return (a < 0.) ? b * a : a;",lB=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Sfe(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e,r=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(lB,s.shape,i.shape):new Al(aB,s.shape,i.shape);return n.runWebGLProgram(r,[s,i],"float32")}const Tfe={kernelName:Pv,backendName:"webgl",kernelFunc:Sfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ju="if (isnan(x)) return x;";function tt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:i,backend:r})=>{const{x:o}=i,a=r,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const d=a.texData.get(o.dataId),f=n(d.values,l);return a.makeTensorInfo(o.shape,l,f)}const c=ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return c?h=new Lo(o.shape,e):h=new gr(o.shape,t),a.runWebGLProgram(h,[o],l)}}function Ln({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:r}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,h=a;if(s&&l.dtype==="complex64"){const g=h.texData.get(l.dataId),x=h.texData.get(c.dataId),[_,v]=[[g.complexTensorInfos.real,x.complexTensorInfos.real],[g.complexTensorInfos.imag,x.complexTensorInfos.imag]].map(b=>{const[I,S]=b,T={dataId:I.dataId,dtype:I.dtype,shape:l.shape},$={dataId:S.dataId,dtype:S.dtype,shape:c.shape},E=new Al(t,l.shape,c.shape);return h.runWebGLProgram(E,[T,$],Ds(I.dtype,S.dtype))}),w=Sa({inputs:{real:_,imag:v},backend:h});return h.disposeIntermediateTensorInfo(_),h.disposeIntermediateTensorInfo(v),w}const d=r||Ds(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||h.shouldExecuteOnCPU([l,c]))&&i!=null){const g=h.texData.get(l.dataId).values,x=h.texData.get(c.dataId).values,_=l.dtype==="string"?co(g):g,v=l.dtype==="string"?co(x):x,[w,b]=i(l.shape,c.shape,_,v,d),I=h.makeTensorInfo(b,d),S=h.texData.get(I.dataId);return S.values=w,I}const f=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let m;return f?m=new Vu(e,l.shape,c.shape,n):m=new Al(t,l.shape,c.shape),h.runWebGLProgram(m,[l,c],d)}}function Md(t,e=!1){if(t==="linear")return e?lfe:sfe;if(t==="relu")return e?ufe:rfe;if(t==="elu")return e?cfe:ife;if(t==="relu6")return e?hfe:ofe;if(t==="prelu")return e?lB:aB;if(t==="leakyrelu")return e?oB:rB;if(t==="sigmoid")return e?dfe:afe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cB{constructor(e,n,s,i=!1,r=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=qn(this.outputShape.length);const h=i?e[1]:e[2],d=Math.ceil(h/2),f=i?"i * 2, rc.y":"rc.y, i * 2",m=r?"rc.z, i * 2":"i * 2, rc.z",g=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],x=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let _="",v="";a&&(l?_=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?_=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:_=`vec4 activation(vec4 x) {
          ${a}
        }`,v="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",I="rc.x";e[0]<n[0]?b=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(I=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${_}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${I};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${x[0]});
          result += (${g[1]} * ${x[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${v}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X2={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class Z2{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ze(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2="return a * b;";function Fk(t){const{inputs:e,backend:n}=t,{a:s,b:i}=e,r=Ds(s.dtype,i.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(i.dataId),c=new Z2(X2.REAL,s.shape,i.shape),h=new Z2(X2.IMAG,s.shape,i.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:i.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:i.shape}],f=n.runWebGLProgram(c,d,"float32"),m=n.runWebGLProgram(h,d,"float32"),g=Sa({inputs:{real:f,imag:m},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}if(n.shouldExecuteOnCPU([s,i])){const a=n.texData.get(s.dataId),l=n.texData.get(i.dataId),[c,h]=Sde(s.shape,i.shape,a.values,l.values,r),d=n.makeTensorInfo(h,r),f=n.texData.get(d.dataId);return f.values=c,d}let o;return ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Vu(Y2,s.shape,i.shape):o=new Al(Y2,s.shape,i.shape),n.runWebGLProgram(o,[s,i],r)}const Efe={kernelName:Of,backendName:"webgl",kernelFunc:Fk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(t,e,n){const s=[yu(t.shape),...vu(t.shape)],i={dtype:t.dtype,shape:s,dataId:t.dataId},r=[yu(e),...vu(e)],o=new iB(r,s),a=!0,l=[s],c=n.runWebGLProgram(o,[i],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:r}=s,o=n,a=re(i.shape),l=JP(r,a),c=re(l);R(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const h=o.texData.get(i.dataId);return h.isPacked&&!ry(i.shape,l)&&!(h.texture!==null&&ry(h.shape,l))?Nfe(i,l,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype})}const $fe={kernelName:Lv,backendName:"webgl",kernelFunc:ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q2{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:r,outSize:o}=e;this.outputShape=[i,o];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${ou(d)?d.toPrecision(2):d}, ones);`}let h="";r%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rfe{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:r,outSize:o}=e;this.outputShape=[i,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const h=Math.floor(s/4)*4,d=s%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let g="";r%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Afe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=sx(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function tc(t,e,n,s){const i=Afe(t.shape);let r=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:l,outSize:c}=i[o];let h,d;n==="mean"?h=o===0?new Q2({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new Q2({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):h=new Rfe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=r,r=s.runWebGLProgram(h,[r],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dfe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const i=yt(this.rank),r=Pfe(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${r}));
    }
    `}}function Pfe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let i=0;i<t.length;i++)s[t[i]]=n[i];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ofe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let h=0;h<s.length;h++)s[h]=e[n[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=yt(this.rank),r=sB("rc",this.rank),o=new Array(this.rank);for(let h=0;h<n.length;h++)o[n[h]]=r[h];const a=`vec2(${o.slice(-2).join()})`,l=`++${r[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${r[this.rank-1]};
      if(++${r[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wx(t,e,n){const s=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ofe(t.shape,e):new Dfe(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lfe(t,e,n,s){const i=e,r=t.shape.length,o=Ge(i,t.shape);let a=o;const l=Bt(a,r),c=l!=null;let h=t;c&&(h=wx(t,l,s),a=Zt(a.length,r)),On("sum",a,r);const[d,f]=In(h.shape,a);let m=d;n&&(m=sn(d,o));const g=re(f),_=re(t.shape)/g,v=ye({inputs:{x:h},attrs:{shape:[_,g]},backend:s}),w=BC(t.dtype),b=tc(v,w,"sum",s),I=ye({inputs:{x:b},attrs:{shape:m},backend:s});return s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(b),c&&s.disposeIntermediateTensorInfo(h),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bx(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;return Lfe(i,r,o,n)}const Ffe={kernelName:Wv,backendName:"webgl",kernelFunc:bx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function is(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{perm:r}=s,o=n,a=i.shape.length,l=new Array(a);for(let h=0;h<l.length;h++)l[h]=i.shape[r[h]];let c;if(o.shouldExecuteOnCPU([i])){const d=o.texData.get(i.dataId).values,f=Ok(d,i.shape,i.dtype,r,l);c=o.makeTensorInfo(l,i.dtype);const m=o.texData.get(c.dataId);m.values=f}else c=wx(i,r,o);return c}const Mfe={kernelName:Hc,backendName:"webgl",kernelFunc:is};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uB=1e3;function oy({a:t,b:e,transposeA:n,transposeB:s,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,h=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],f=s?e.shape[h-1]:e.shape[h-2],m=n?t.shape[c-1]:t.shape[c-2],g=s?e.shape[h-2]:e.shape[h-1],x=t.shape.slice(0,-2),_=e.shape.slice(0,-2),v=re(x),w=re(_),I=ze(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([m,g]);R(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=n?[v,d,m]:[v,m,d],T=s?[w,g,f]:[w,f,g],$=ye({inputs:{x:t},backend:i,attrs:{shape:S}}),E=ye({inputs:{x:e},backend:i,attrs:{shape:T}}),D=[$,E],P=Math.max(v,w),z=n?$.shape[1]:$.shape[2],V=r!=null,q=o!=null,K=l==="leakyrelu",J=l!=null?Md(l,!0):null,X=V||q||K||J!=null;let oe;if((m===1||g===1)&&z>uB&&X===!1){let Z=$,j=E;n&&(Z=is({inputs:{x:$},backend:i,attrs:{perm:[0,2,1]}}),D.push(Z)),s&&(j=is({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),D.push(j));const te=g!==1,ae=g===1;let ue=Z;te&&(ue=ye({inputs:{x:Z},backend:i,attrs:{shape:[P,z,1]}}),D.push(ue));const he=g===1?2:1;let le=j;ae&&(le=ye({inputs:{x:j},backend:i,attrs:{shape:[P,1,z]}}),D.push(le));const ce=Fk({inputs:{a:ue,b:le},backend:i});oe=bx({inputs:{x:ce},backend:i,attrs:{axis:he,keepDims:!0}}),D.push(ce)}else{const Z=Ds(t.dtype,e.dtype),j=new cB(S,T,[P,m,g],n,s,V,J,q,K),te=[$,E];if(r!=null&&te.push(r),q&&te.push(o),K){const ae=i.makeTensorInfo([],"float32",ya(a,"float32"));te.push(ae),D.push(ae)}oe=i.runWebGLProgram(j,te,Z)}const O=ye({inputs:{x:oe},backend:i,attrs:{shape:I}});D.push(oe);for(const Z of D)i.disposeIntermediateTensorInfo(Z);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zfe(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:d}=s;return oy({a:i,b:r,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:d,activation:h})}const Bfe={kernelName:Dg,backendName:"webgl",kernelFunc:zfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2="return abs(x);";function Ufe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const r=n.texData.get(s.dataId),o=tB(r.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let i;return ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Lo(s.shape,J2):i=new gr(s.shape,J2),n.runWebGLProgram(i,[s],s.dtype)}const Wfe={kernelName:Xy,backendName:"webgl",kernelFunc:Ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vfe=Ii+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,jfe=tt({opSnippet:Vfe}),Gfe={kernelName:of,backendName:"webgl",kernelFunc:jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hfe=Ii+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,qfe=tt({opSnippet:Hfe}),Kfe={kernelName:af,backendName:"webgl",kernelFunc:qfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e$="return a + b;",Xfe=Ln({opSnippet:e$,packedOpSnippet:e$,supportsComplex:!0,cpuKernelImpl:rde}),Zfe={kernelName:Ru,backendName:"webgl",kernelFunc:Xfe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yfe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((r,o)=>`T${o}`);const s=[];this.variableNames.forEach(r=>{s.push(`float v${r} = get${r}AtOutCoords();`)});const i=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qfe{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((r,o)=>`T${o}`);const s=[];this.variableNames.forEach(r=>{s.push(`vec4 v${r} = get${r}AtOutCoords();`)});const i=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hm(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Os({inputs:{x:s[0]},backend:n});if(s.length>ee().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=Hm({inputs:s.slice(0,l),backend:n}),h=Hm({inputs:s.slice(l),backend:n});return Hm({inputs:[c,h],backend:n})}const i=s.map(l=>l.dtype).reduce((l,c)=>Ds(l,c)),r=s.map(l=>l.shape),a=ee().getBool("WEBGL_PACK")?new Qfe(s[0].shape,r):new Yfe(s[0].shape,r);return n.runWebGLProgram(a,s,i)}const Jfe={kernelName:Q1,backendName:"webgl",kernelFunc:Hm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=Ge(r,i.shape);let c=l;const h=Bt(c,a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Zt(c.length,a)),On("all",c,a);const[f,m]=In(d.shape,c),g=re(m),x=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),_=tc(x,x.dtype,"all",n);let v;if(o){const w=sn(f,l);v=ye({inputs:{x:_},backend:n,attrs:{shape:w}})}else v=ye({inputs:{x:_},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(_),h!=null&&n.disposeIntermediateTensorInfo(d),v}const tpe={kernelName:J1,backendName:"webgl",kernelFunc:epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function npe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=Ge(r,i.shape);let c=l;const h=Bt(c,a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Zt(c.length,a)),On("any",c,a);const[f,m]=In(d.shape,c),g=re(m),x=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),_=tc(x,x.dtype,"any",n);let v;if(o){const w=sn(f,l);v=ye({inputs:{x:_},backend:n,attrs:{shape:w}})}else v=ye({inputs:{x:_},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(_),h!=null&&n.disposeIntermediateTensorInfo(d),v}const spe={kernelName:eC,backendName:"webgl",kernelFunc:npe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ipe{constructor(e,n,s){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[r,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rpe{constructor(e,n,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,R(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const r=e[e.length-1],o=Math.ceil(r/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=yt(l),h=ts("coords",l);let d,f;if(o===1){f=l+1;const E=yt(f);d=`
        ${E} sourceLocR = ${E}(${h.join()}, 0);
        ++${h[l-1]};
        ${E} sourceLocG = ${E}(${h.join()}, 0);
        ++${h[l-2]};
        ${E} sourceLocA = ${E}(${h.join()}, 0);
        --${h[l-1]};
        ${E} sourceLocB = ${E}(${h.join()}, 0);
        --${h[l-2]};`}else f=l,d=`
        ${c} sourceLocR = coords;
        ++${h[l-1]};
        ${c} sourceLocG = coords;
        ++${h[l-2]};
        ${c} sourceLocA = coords;
        --${h[l-1]};
        ${c} sourceLocB = coords;
        --${h[l-2]};`;const m=["x","y","z","w","u","v"].slice(0,f),g="."+m[f-1],x=m.map(E=>"int "+E),_=ts("sourceLocR",f-1).concat("inIdx.r"),v=ts("sourceLocG",f-1).concat("inIdx.g"),w=ts("sourceLocB",f-1).concat("inIdx.b"),b=ts("sourceLocA",f-1).concat("inIdx.a"),I=s==="max"?"greaterThan":"lessThan",S=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${_.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${b.join()})));`,T=`vec4(
            getAChannel(${_.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,$=i?"":`
      float getBestIndicesAChannel(${x.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${x.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${$}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${T};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${T};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${I}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(t,e,n,s=null){let i=e.shape[0],r=e.shape[1];s!=null&&(i=s.shape[0],r=s.shape[1]);const o=sx(r),a={windowSize:o,inSize:r,batchSize:i,outSize:Math.ceil(r/o)},l=new ipe(a,n,s==null),c=[e];s!=null&&c.push(s);const h=t.runWebGLProgram(l,c,"int32");if(h.shape[1]===1)return h;const d=hB(t,e,n,h);return t.disposeIntermediateTensorInfo(h),d}function dB(t,e,n,s=null){const i=s!=null?s.shape:e.shape,r=i[i.length-1],o=sx(r),a=new rpe(i,o,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const h=dB(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}return c}function fB(t,e,n,s){const i=[n];if(On("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,e.shape.length),!ee().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const r=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),r.push(l));const[c,h]=In(l.shape,i),d=re(h),f=ye({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});r.push(f);const m=hB(t,f,s);r.push(m);const g=ye({inputs:{x:m},backend:t,attrs:{shape:c}});return r.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}return dB(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ope(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;let o=Ge(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=is({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),On("argMax",[o[0]],l.shape.length);const h=fB(n,l,o[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),h}const ape={kernelName:Zy,backendName:"webgl",kernelFunc:ope};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;let o=Ge(r,i.shape);const a=Bt(o,i.shape.length);let l=i;const c=[];a!=null&&(l=is({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Zt(o.length,l.shape.length)),On("argMin",[o[0]],l.shape.length);const h=fB(n,l,o[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),h}const cpe={kernelName:Yy,backendName:"webgl",kernelFunc:lpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const upe=Ii+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,hpe=tt({opSnippet:upe}),dpe={kernelName:lf,backendName:"webgl",kernelFunc:hpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fpe=Ii+"return log(x + sqrt(x * x + 1.0));",ppe=tt({opSnippet:fpe}),mpe={kernelName:cf,backendName:"webgl",kernelFunc:ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gpe=Ii+`
  return atan(x);
`,ype=tt({opSnippet:gpe}),vpe={kernelName:uf,backendName:"webgl",kernelFunc:ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xpe=Lk+`
  return atan(a, b);
`,_pe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ec+`
  return result;
`,wpe=Ln({opSnippet:xpe,packedOpSnippet:_pe}),bpe={kernelName:df,backendName:"webgl",kernelFunc:wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cpe=Ii+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ipe=tt({opSnippet:Cpe}),kpe={kernelName:hf,backendName:"webgl",kernelFunc:Ipe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zd{constructor(e,n,s,i=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;const x=n==="avg",_=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,v=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(x||(w="-1.0 / 1e-20"),s){const E=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${m}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${E} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?r?_:v:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let I=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(I="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,T=o%4,$=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${m}, ${g});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${$}
          }

          int xC = xCCorner + ${S};
          if (${T===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${T===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${T===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${$}
          }
        }
        setOutput(${I});
      }
    `}}class Mk{constructor(e,n,s,i=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=e.dilationDepth,d=e.dilationHeight,f=e.dilationWidth,m=e.effectiveFilterDepth,g=e.effectiveFilterHeight,x=e.effectiveFilterWidth,_=e.padInfo.front,v=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg";let I="0.0";if(b||(I="-1.0 / 1e-20"),s){const P=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${_}, ${v}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${x};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${P} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?r?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${g} * ${x} +
                      wR * ${x} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let T=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(T="avgValue / max(count, 1.0)");const $=Math.floor(o/4)*4,E=o%4,D=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${_}, ${v}, ${w});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${$}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${D}
            }

            int xC = xCCorner + ${$};
            if (${E===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${E===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${E===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${D}
            }
          }
        }
        setOutput(${T});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;_p(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(Gn(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=bi(i.shape,r,o,c,a,l);if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))return Os({inputs:{x:i},backend:n});const d=new zd(h,"avg",!1);return n.runWebGLProgram(d,[i],"float32")}const Tpe={kernelName:Qy,backendName:"webgl",kernelFunc:Spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Epe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s,h=[1,1,1],d=mo(i.shape,r,o,h,a,l,c),f=new Mk(d,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const Npe={kernelName:Jy,backendName:"webgl",kernelFunc:Epe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $pe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.top,d=c-1-e.padInfo.left,f=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Rpe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,i=e.filterWidth,r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=d-1-e.padInfo.front,x=f-1-e.padInfo.top,_=m-1-e.padInfo.left,v=1/(n*s*i);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${x}, ${_});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ape(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r,{filterSize:a,strides:l,pad:c,dimRoundingMode:h}=s,d=[1,1,1],f=mo(o.shape,a,l,d,c,h),m=new Rpe(f);return n.runWebGLProgram(m,[i],o.dtype)}const Dpe={kernelName:nC,backendName:"webgl",kernelFunc:Ape};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ppe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r;_p([i,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,h=bi(o.shape,a,l,1,c),d=new $pe(h);return n.runWebGLProgram(d,[i],o.dtype)}const Ope={kernelName:tC,backendName:"webgl",kernelFunc:Ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lpe(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r}=e,{transposeA:o,transposeB:a}=s;return oy({a:i,b:r,transposeA:o,transposeB:a,backend:n})}const Fpe={kernelName:ev,backendName:"webgl",kernelFunc:Lpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mpe{constructor(e,n,s,i,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ze(e,n),ze(e,s);let a="0.0";i!=null&&(ze(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";r!=null&&(ze(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zpe{constructor(e,n,s,i,r,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ze(e,n),ze(e,s);let a="vec4(0.0)";i!=null&&(ze(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";r!=null&&(ze(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bpe=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:i,variance:r,offset:o,scale:a}=t;R(i.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,i,r];let h=null;o!=null&&(h=o.shape,c.push(o));let d=null;a!=null&&(d=a.shape,c.push(a));const f=ee().getBool("WEBGL_PACK_NORMALIZATION")?new zpe(s.shape,i.shape,r.shape,h,d,l):new Mpe(s.shape,i.shape,r.shape,h,d,l);return e.runWebGLProgram(f,c,c[0].dtype)},Upe={kernelName:dv,backendName:"webgl",kernelFunc:Bpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wpe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=yt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Vpe(this.rank);let i;const r=e.map((o,a)=>`sourceLoc.${ub[a]} = start[${a}] + coords.${ub[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${r.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${s}));
      }
    `}}const ub=["x","y","z","w","u","v"];function Vpe(t){if(t===1)return"sourceLoc";if(t<=6)return ub.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jpe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=yt(this.rank),s=ts("coords",this.rank),i=ts("sourceLoc",this.rank),r=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${r})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((h,d)=>`start[${d}]`).join()});`:e.map((h,d)=>`${i[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gpe(t,e,n,s){const i=s.texData.get(t.dataId),r=s.makeTensorInfo(n,t.dtype),o=s.texData.get(r.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=$I(e,Te(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),r}function Gu(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,size:o}=s,[a,l]=nx(i,r,o);if(TI(i,a,l),re(l)===0)return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const d=n.texData.get(i.dataId),f=Fde(d.values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,f)}const{isPacked:c}=n.texData.get(i.dataId),h=NI(i.shape,a,l);if(c||!h){const d=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jpe(l):new Wpe(l),f=[a];return n.runWebGLProgram(d,[i],i.dtype,f)}return n.uploadToGPU(i.dataId),Gpe(i,a,l,n)}const Hpe={kernelName:Uv,backendName:"webgl",kernelFunc:Gu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qpe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,crops:o}=s;R(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((w,b)=>w*b),l=lp(i.shape,r,a),c=cp(l.length,r.length),h=up(i.shape,r,a),d=OI(o,r.length),f=LI(h,o,r.length),m=[],g=ye({inputs:{x:i},backend:n,attrs:{shape:l}}),x=is({inputs:{x:g},backend:n,attrs:{perm:c}}),_=ye({inputs:{x},backend:n,attrs:{shape:h}}),v=Gu({inputs:{x:_},backend:n,attrs:{begin:d,size:f}});return m.push(g),m.push(x),m.push(_),m.forEach(w=>n.disposeIntermediateTensorInfo(w)),v},Kpe={kernelName:tv,backendName:"webgl",kernelFunc:qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o}=s,a=n.readSync(i.dataId),l=n.readSync(r.dataId),c=eB(a,l,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,c)}const Zpe={kernelName:sC,backendName:"webgl",kernelFunc:Xpe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ype=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Qpe=`
  return float(int(a.r) & int(b.r));
`;function Jpe(t){const{inputs:e,backend:n}=t,{a:s,b:i}=e,r=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=ee().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,i])||o===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(i.dataId).values,[h,d]=ade(s.shape,i.shape,l,c,s.dtype),f=n.makeTensorInfo(d,s.dtype),m=n.texData.get(f.dataId);return m.values=h,f}let a;return r?a=new Vu(Ype,s.shape,i.shape,!1):a=new Al(Qpe,s.shape,i.shape),n.runWebGLProgram(a,[s,i],s.dtype)}const eme={kernelName:iC,backendName:"webgl",kernelFunc:Jpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tme(t){const{inputs:e,backend:n}=t,{s0:s,s1:i}=e,r=n.readSync(s.dataId),o=n.readSync(i.dataId),a=ze(Array.from(r),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const nme={kernelName:rO,backendName:"webgl",kernelFunc:tme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sme="return float(a != b);",pB=Ln({opSnippet:sme,cpuKernelImpl:Ede,dtype:"bool"}),ime={kernelName:Nv,backendName:"webgl",kernelFunc:pB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bp(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return Os({inputs:{x:i.complexTensorInfos.real},backend:n})}const rme={kernelName:NC,backendName:"webgl",kernelFunc:bp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ome="return float(int(x));";function ame(t,e){const n=new gr(t.shape,ome),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hb(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:r}=s;if(r==="complex64"){if(i.dtype==="complex64")return Os({inputs:{x:i},backend:n});const o=_n(i.shape),a=hb({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),l=Sa({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(i.dtype==="complex64"){const o=bp({inputs:{input:i},backend:n}),a=hb({inputs:{x:o},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(o),a}if(!eO(i.dtype,r)){const o=Os({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:r}}if(n.shouldExecuteOnCPU([i])){const o=n.texData.get(i.dataId).values,[a,l,c]=lde(o,i.shape,i.dtype,r);return n.makeTensorInfo(a,l,c)}if(r==="int32")return ame(i,n);if(r==="bool"){const o=n.makeTensorInfo([],"bool",Wn("bool",1)),l=pB({inputs:{a:i,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${r}`)}const lme={kernelName:ff,backendName:"webgl",kernelFunc:hb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t$="return ceil(x);",cme=tt({opSnippet:t$,packedOpSnippet:t$,cpuKernelImpl:cde}),ume={kernelName:pf,backendName:"webgl",kernelFunc:cme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hme{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dme{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{clipValueMin:r,clipValueMax:o}=s;let a;ee().getBool("WEBGL_PACK_CLIP")?a=new dme(i.shape):a=new hme(i.shape);const l=[[r],[o]];return n.runWebGLProgram(a,[i],i.dtype,l)}const pme={kernelName:mf,backendName:"webgl",kernelFunc:fme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mme{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function gme(t){const{inputs:e,backend:n}=t,{x:s}=e,i=n.texData.get(s.dataId),r=new mme(s.shape),o=[n$(s,i.complexTensorInfos.real),n$(s,i.complexTensorInfos.imag)];return n.runWebGLProgram(r,o,o[0].dtype)}const yme={kernelName:nv,backendName:"webgl",kernelFunc:gme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vme{constructor(e){this.outputShape=[],this.outputShape=Cr(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=n.length,r=n[n.length-1];s.push(`else setOutput(getT${i}(yR, yC-${r}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xme{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Cr(e,n);const s=this.outputShape,i=s.length,r=yt(i),o=ts("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((x,_)=>`T${_}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let x=1;x<l.length;x++)l[x]=l[x-1]+e[x][n];const c=a[n],h=a.slice(-2),d=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${h.join()}));
        }`;for(let x=1;x<l.length;x++){const _=l[x-1];f+=`
        if (${c} < ${l[x]}  && ${c} >= ${l[x-1]}) {
          return getChannel(
            getT${x}(${Sm(a,c,_)}),
            vec2(${Sm(h,c,_)}));
        }`}const m=l.length,g=l[l.length-1];f+=`
        return getChannel(
          getT${m}(${Sm(a,c,g)}),
          vec2(${Sm(h,c,g)}));`,this.userCode=`
      float getValue(${a.map(x=>"int "+x)}) {
        ${f}
      }

      void main() {
        ${r} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${s[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${s[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${s[i-2]} &&
            ${o[i-1]} < ${s[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Sm(t,e,n){const s=t.indexOf(e);return t.map((r,o)=>o===s?`${r} - ${n}`:r).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cx(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return Os({inputs:{x:i.complexTensorInfos.imag},backend:n})}const _me={kernelName:wC,backendName:"webgl",kernelFunc:Cx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(t,e,n){const s=t[0].dtype;if(s==="complex64"){const m=t.map(w=>bp({inputs:{input:w},backend:n})),g=t.map(w=>Cx({inputs:{input:w},backend:n})),x=Mh(m,e,n),_=Mh(g,e,n),v=Sa({inputs:{real:x,imag:_},backend:n});return m.forEach(w=>n.disposeIntermediateTensorInfo(w)),g.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(_),v}let i=n.shouldExecuteOnCPU(t);if(s==="string"&&(i=!0),i){const m=t.map(I=>{const T=[-1,re(I.shape.slice(e))];return ye({inputs:{x:I},backend:n,attrs:{shape:T}})}),g=m.map(I=>({vals:n.readSync(I.dataId),shape:I.shape})),x=Cr(m.map(I=>I.shape),1),_=m[0].shape[0]===1,v=ude(g,x,s,_),w=Cr(t.map(I=>I.shape),e),b=n.makeTensorInfo(w,s,v);return m.forEach(I=>n.disposeIntermediateTensorInfo(I)),b}const r=t.filter(m=>re(m.shape)>0),o=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1;if(r.length===1){const m=o?new gr(t[0].shape,Io):new Lo(t[0].shape,Io);return n.runWebGLProgram(m,t,s)}const a=ee().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>a){const m=[];for(let x=0;x<r.length;x+=a){const _=r.slice(x,x+a);m.push(Mh(_,e,n))}const g=Mh(m,e,n);for(const x of m)n.disposeIntermediateTensorInfo(x);return g}if(o){const m=new xme(r.map(g=>g.shape),e);return n.runWebGLProgram(m,r,s)}const{tensors2D:l,outShape:c}=wme(r,e,n),h=new vme(l.map(m=>m.shape)),d=n.runWebGLProgram(h,l,s);l.forEach(m=>n.disposeIntermediateTensorInfo(m));const f=ye({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),f}function wme(t,e,n){const s=Cr(t.map(r=>r.shape),e);return{tensors2D:t.map(r=>ye({inputs:{x:r},attrs:{shape:[-1,re(r.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,r=Ge(i,e[0].shape)[0],o=e.map(c=>c.shape);AI(o,r);const a=Cr(e.map(c=>c.shape),r);if(re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>re(c.shape)>0);return l.length===1?Os({inputs:{x:l[0]},backend:n}):Mh(l,r,n)}const bme={kernelName:sv,backendName:"webgl",kernelFunc:mB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,h=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,m=e.filterWidth,g=Math.floor(e.inChannels/4)*4,x=e.inChannels%4,_=e.dataFormat==="channelsLast",v=_?1:2,w=_?2:3,b=_?3:1;let I="",S="";s&&(i?I=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?I=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const T=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${_}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${x===1}) {

              if (${_}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${x===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${_}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${x===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${_}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${T}
        ${S}
        setOutput(result);
      }
    `}}class Cme{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,i=e.padInfo.left,r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterDepth,f=e.filterHeight,m=e.filterWidth,g=Math.floor(e.inChannels/4)*4,x=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${r}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${x===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${x===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${x===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=qn(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=h;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let _=0;_<h;_++)f+=`
           vec4 xTexelC${_*2};
           int xTexelC${_*2}Ready;
           vec4 xTexelC${_*2+1};
           int xTexelC${_*2+1}Ready;
           vec4 xC${_};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let _=0;_<h;_++)f+=`
           xTexelC${_*2} = vec4(0.0);
           xTexelC${_*2}Ready = 0;
           xTexelC${_*2+1} = vec4(0.0);
           xTexelC${_*2+1}Ready = 0;
           xC${_} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let _=0;_<(d+1)/2;_++){const v=_*2;if(f+=`
           xC = xCCorner + ${v*l};
           `,a===1){if(v<h&&(o%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }
               `,l===1&&v>0?f+=`
                 xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                   } else {
                     xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xC${v} = xTexelC${v};
                 `,v+1<h)){const w=o%2===0?H1(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                     xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${v+1}.zw = vec2(0.0);
                     }
                     xTexelC${v+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                     } else {
                      xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                     }
                     `:f+=`
                     xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                     `):w===1?f+=`
                     xC${v+1} = xTexelC${v};
                     `:f+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                       xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${v+1}.zw = vec2(0.0);
                       }
                       xTexelC${v+1}Ready = 1;
                     }

                     xC${v+1} = xTexelC${v+1};
                     `}}else v<h&&(o%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.0);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
               `,v+1<h&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(
                   xTexelC${v}.xy, xTexelC${v+1}.xy);
               `,v+1<h&&(f+=`
                   xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                 `)));v<h&&(f+=`
             wTexel = getW(r, ${v}, d1, d2);
             dotProd += xC${v}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${v}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<h&&(f+=`
               wTexel = getW(r, ${v+1}, d1, d2);
               dotProd += xC${v+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${v+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let m="",g="";s&&(i?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:r?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:m=`vec4 activation(vec4 x) {
           ${s}
         }`,g="result = activation(result);");const x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${x}
         ${g}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ime{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=qn(this.outputShape.length);const{dataFormat:s}=n,i=rs(),r=s==="channelsLast",o=r?1:2,a=r?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let h=0;h<=1;h++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${r}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ay(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function vB({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),h=n.inChannels,d=l[0]*l[1]*l[2],f=n.outChannels,m=n.dataFormat==="channelsLast",g=!1,x=!1;let _;const v=[];if(r!=null){const I=ay(r.shape,m);I!=null&&(r=ye({inputs:{x:r},backend:s,attrs:{shape:I}}),v.push(r))}if(i!=null){const I=ay(i.shape,m);I!=null&&(i=ye({inputs:{x:i},backend:s,attrs:{shape:I}}),v.push(i))}if(!((d===1||f===1)&&h>uB)&&c.isPacked&&m&&c.texture!=null&&l[2]%2!==0&&ct(c.shape.slice(-3),l.slice(-3))){const I=l[0]*l[1]*(l[2]+1),S={dataId:t.dataId,shape:[1,I,n.inChannels],dtype:t.dtype},T=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,R(ry(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);const $=ye({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});v.push($);const E=oy({a:S,b:$,backend:s,transposeA:g,transposeB:x,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o}),D=s.texData.get(E.dataId);R(D.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=T,D.shape=n.outShape,_=Os({inputs:{x:E},backend:s}),_.shape=n.outShape,v.push(E)}else{const I=n.outHeight*n.outWidth,S=ye({inputs:{x:t},backend:s,attrs:{shape:m?[n.batchSize,I,n.inChannels]:[n.batchSize,n.inChannels,I]}}),T=ye({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),$=oy({a:m?S:T,b:m?T:S,transposeA:!m,transposeB:x,backend:s,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o});_=ye({inputs:{x:$},backend:s,attrs:{shape:n.outShape}}),v.push(S),v.push(T),v.push($)}for(const I of v)s.disposeIntermediateTensorInfo(I);return _}function xB({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:h,outWidth:d,outHeight:f,dataFormat:m}=n,g=m==="channelsLast",x=l*c*h,_=f*d,v=[n.batchSize,x,_],w=!0,b=!1,I=[];if(r!=null){const O=ay(r.shape,g);O!=null&&(r=ye({inputs:{x:r},backend:s,attrs:{shape:O}}),I.push(r))}if(i!=null){const O=ay(i.shape,g);O!=null&&(i=ye({inputs:{x:i},backend:s,attrs:{shape:O}}),I.push(i))}const S=ye({inputs:{x:e},backend:s,attrs:{shape:[1,x,re(e.shape)/x]}});I.push(S);const T=new Ime(v,n),$=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],E=s.runWebGLProgram(T,[t],"float32",$),D=ye({inputs:{x:E},backend:s,attrs:{shape:v}});I.push(E),I.push(D);const P=i!=null,z=r!=null,V=a==="leakyrelu",q=a?Md(a,!0):null,K=new cB(g?D.shape:S.shape,g?S.shape:D.shape,g?[n.batchSize,_,n.outChannels]:[n.batchSize,n.outChannels,_],w,b,P,q,z,V),J=g?[D,S]:[S,D];if(i&&J.push(i),z&&J.push(r),V){const O=s.makeTensorInfo([],"float32",ya(o,"float32"));J.push(O),I.push(O)}const X=s.runWebGLProgram(K,J,"float32"),oe=ye({inputs:{x:X},backend:s,attrs:{shape:n.outShape}});I.push(X);for(const O of I)s.disposeIntermediateTensorInfo(O);return oe}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:h}=s,d=go(l),f=Pn(i.shape,r.shape,o,c,a,h,!1,d);let m;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))m=vB({x:i,filter:r,convInfo:f,backend:n});else if(f.strideWidth<=2&&d==="channelsLast"&&ee().getBool("WEBGL_EXP_CONV")){const x=new yB(f),_=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];m=n.runWebGLProgram(x,[i,r],"float32",_)}else if(ee().getBool("WEBGL_CONV_IM2COL"))m=xB({x:i,filter:r,convInfo:f,backend:n});else{const x=new gB(f);m=n.runWebGLProgram(x,[i,r],"float32")}const g=ye({inputs:{x:m},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(m),g}const Sme={kernelName:iv,backendName:"webgl",kernelFunc:kme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tme{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Eme{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,r=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o?1:2,h=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Nme{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,i=e.strideWidth,r=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${r};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class $me{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,i=e.filterWidth,r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,h=i-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${r}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:h}=s,d=go(l),f=Pn(i.shape,h,o,1,a,c,!1,d),m=new Tme(f);return n.runWebGLProgram(m,[i,r],"float32")}const Ame={kernelName:oC,backendName:"webgl",kernelFunc:Rme};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dme{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=qn(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,i=n-1-e.padInfo.top,r=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pme(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:h}=s,d=go(c),f=Pn(o,r.shape,a,1,l,h,!1,d);if(ee().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const m=[[f.strideHeight,f.strideWidth]],g=new Dme(f);return n.runWebGLProgram(g,[i,r],"float32",m)}else{const m=new Eme(f);return n.runWebGLProgram(m,[i,r],"float32")}}const Ome={kernelName:rv,backendName:"webgl",kernelFunc:Pme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l}=s,c=xa(i.shape,r.shape,o,l,a),h=new Cme(c);return n.runWebGLProgram(h,[i,r],"float32")}const Fme={kernelName:ov,backendName:"webgl",kernelFunc:Lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,filterShape:l}=s,c=xa(i.shape,l,o,1,a),h=new Nme(c);return n.runWebGLProgram(h,[i,r],"float32")}const zme={kernelName:aC,backendName:"webgl",kernelFunc:Mme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bme(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{pad:o,strides:a,inputShape:l}=s,c=xa(l,r.shape,a,1,o),h=new $me(c);return n.runWebGLProgram(h,[i,r],"float32")}const Ume={kernelName:lC,backendName:"webgl",kernelFunc:Bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wme=ju+`
  return cos(x);
`,Vme=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ec}
  return result;
`,jme=tt({opSnippet:Wme,packedOpSnippet:Vme}),Gme={kernelName:gf,backendName:"webgl",kernelFunc:jme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hme=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,qme=tt({opSnippet:Hme}),Kme={kernelName:yf,backendName:"webgl",kernelFunc:qme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xme{constructor(e,n,s,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[h]=n,[d,f]=s;this.outputShape=[h,d,f,c];const m=i==="bilinear"?1:0,[g,x]=[`${a-1}.0`,`${l-1}.0`],[_,v,w]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[b,I,S]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${x} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${x}`];this.userCode=`
      const float height_ratio = float(${_});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${I};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${r}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${x} ) {
          setOutput(float(${r}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zme=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:r,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,h=new Xme(i.shape,r.shape,a,l,c);return n.runWebGLProgram(h,[i,r,o],"float32")},Yme={kernelName:uC,backendName:"webgl",kernelFunc:Zme};var Bd;(function(t){t.Prod="*",t.Sum="+"})(Bd||(Bd={}));class s${constructor(e,n,s,i){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,o=this.op===Bd.Prod?"1.0":"0.0",a=s?o:`getX(${i$(r,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",h="";s?(c=i?`end != ${l-1}`:"end != 0",h=i?"end + 1":"end - 1"):(c=i?`end + pow2 < ${l}`:"end >= pow2",h=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${yt(r)} coords = getOutputCoords();
        int end = ${r$(r,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${h};
          ${r$(r,"coords",this.op)} = idx;
          val ${this.op}= getX(${i$(r,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function i$(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function r$(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(t,e,n,s,i,r){const o=e.shape.length,a=Bt([s],o);let l=e;a!=null&&(l=is({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Zt(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const h=l.shape[c];let d=Os({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(h))-1;f++){const m=new s$(t,l.shape,!1,r),g=[[f]],x=d;d=n.runWebGLProgram(m,[d],d.dtype,g),n.disposeIntermediateTensorInfo(x)}if(i){const f=new s$(t,l.shape,i,r),m=d;d=n.runWebGLProgram(f,[d],d.dtype),n.disposeIntermediateTensorInfo(m)}if(a!=null){const f=_a(a),m=is({inputs:{x:d},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),m}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;return _B(Bd.Prod,i,n,r,o,a)}const Jme={kernelName:cC,backendName:"webgl",kernelFunc:Qme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ege(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;return _B(Bd.Sum,i,n,r,o,a)}const tge={kernelName:av,backendName:"webgl",kernelFunc:ege};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o,binaryOutput:a}=s;if(i.shape.length===1){const l=n.readSync(i.dataId),c=n.readSync(r.dataId),h=eB(l,c,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,h)}else if(i.shape.length===2){const l=n.bufferSync(i),c=n.bufferSync(r),h=ode(l,c,o,a);return n.makeTensorInfo(h.shape,r.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const sge={kernelName:hC,backendName:"webgl",kernelFunc:nge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ige{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:r,dataFormat:o}=s,a=i.shape[0],l=o==="NHWC"?i.shape[1]:i.shape[2],c=o==="NHWC"?i.shape[2]:i.shape[3],h=o==="NHWC"?i.shape[3]:i.shape[1],d=l*r,f=c*r,m=h/(r*r),g=o==="NHWC"?[a,d,f,m]:[a,m,d,f],x=new ige(g,r,o);return n.runWebGLProgram(x,[i],i.dtype)}const oge={kernelName:dC,backendName:"webgl",kernelFunc:rge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=qn(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",h="";s&&(i?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bB{constructor(e,n=!1,s=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=qn(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,f=d;let m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)m+=`
          vec4 xTexelC${v*2};
          int xTexelC${v*2}Ready;
          vec4 xTexelC${v*2+1};
          int xTexelC${v*2+1}Ready;
          vec4 xC${v};`;m+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let v=0;v<d;v++)m+=`
          xTexelC${v*2} = vec4(0.0);
          xTexelC${v*2}Ready = 0;
          xTexelC${v*2+1} = vec4(0.0);
          xTexelC${v*2+1}Ready = 0;
          xC${v} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let v=0;v<(f+1)/2;v++){const w=v*2;if(m+=`
          xC = xCCorner + ${w*c};
          `,l===1){if(w<d&&(a%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,c===1&&w>0?m+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<d)){const b=a%2===0?H1(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,c>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:m+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):b===1?m+=`
                    xC${w+1} = xTexelC${w};
                    `:m+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<d&&(a%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<d&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<d&&(m+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<d&&(m+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<d&&(m+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let g="",x="";s&&(i?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:g=`vec4 activation(vec4 x) {
          ${s}
        }`,x="result = activation(result);");const _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${_}
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function age(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;let h=l;h==null&&(h=[1,1]),R(Gn(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Pn(i.shape,r.shape,o,h,a,c,!0);let f;ee().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new bB(d):f=new wB(d);const m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(f,[i,r],"float32",m)}const lge={kernelName:lv,backendName:"webgl",kernelFunc:age};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cge{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class uge{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,r=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:h}=s,d=Pn(i.shape,h,o,a,l,c,!0),f=new cge(d);return n.runWebGLProgram(f,[i,r],"float32")}const dge={kernelName:fC,backendName:"webgl",kernelFunc:hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fge(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:h}=s,d=Pn(h,r.shape,o,a,l,c,!0),f=new uge(d);return n.runWebGLProgram(f,[i,r],"float32")}const pge={kernelName:pC,backendName:"webgl",kernelFunc:fge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mge{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gge(t){const{inputs:e,backend:n}=t,{x:s}=e,i=[...s.shape,...s.shape],r=re(s.shape),o=ye({inputs:{x:s},backend:n,attrs:{shape:[r]}}),a=new mge(r),l=n.runWebGLProgram(a,[o],o.dtype),c=ye({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const yge={kernelName:oO,backendName:"webgl",kernelFunc:gge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vge{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:i,strideHeight:r,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:h}=e,{top:d,left:f}=i;this.userCode=`
      const ivec2 strides = ivec2(${r}, ${o});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:l}=s,c=sp(i.shape,r.shape,o,a,"NHWC",l);let h;const d=new vge(c);h=n.runWebGLProgram(d,[i,r],"float32");const f=ye({inputs:{x:h},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(h),f}const _ge={kernelName:cv,backendName:"webgl",kernelFunc:xge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(t){const{inputs:e,backend:n,attrs:s}=t,{equation:i}=s,r=e,{allDims:o,summedDims:a,idDims:l}=jI(i,r.length);HI(o.length,l,r);const{path:c,steps:h}=qI(a,l),d=h.length;let f=null,m=o.length;const g=[];for(let x=0;x<d;++x){for(const _ of h[x]){const{permutationIndices:v,expandDims:w}=GI(m,l[_]);let b;KI(v)?b=r[_]:(b=is({inputs:{x:r[_]},backend:n,attrs:{perm:v}}),g.push(b));const I=b.shape.slice();for(let S=0;S<w.length;++S)I.splice(w[S],0,1);ct(b.shape,I)||(b=ye({inputs:{x:b},backend:n,attrs:{shape:I}}),g.push(b)),f===null?f=b:(f=Fk({inputs:{a:b,b:f},backend:n}),g.push(f))}x<d-1&&(c[x]>=0&&(f=bx({inputs:{x:f},backend:n,attrs:{axis:c[x]-(o.length-m),keepDims:!1}}),g.push(f)),m--)}for(const x of g)x!==f&&n.disposeIntermediateTensorInfo(x);return f}const bge={kernelName:mC,backendName:"webgl",kernelFunc:wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cge="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ige=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,kge=tt({opSnippet:Cge,packedOpSnippet:Ige}),Sge={kernelName:xf,backendName:"webgl",kernelFunc:kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tge="return (b >= 0.0) ? a : a * (b + 1.0);",Ege=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Nge=t=>{const{inputs:e,backend:n}=t,{dy:s,y:i}=e,r=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(Ege,s.shape,i.shape):new Al(Tge,s.shape,i.shape);return n.runWebGLProgram(r,[s,i],s.dtype)},$ge={kernelName:gC,backendName:"webgl",kernelFunc:Nge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rge=`
  return vec4(equal(a, b));
`,Age="return float(a == b);",Dge=Ln({opSnippet:Age,packedOpSnippet:Rge,dtype:"bool",cpuKernelImpl:hde}),Pge={kernelName:uv,backendName:"webgl",kernelFunc:Dge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oge=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${FI};
  float a1 = ${MI};
  float a2 = ${zI};
  float a3 = ${BI};
  float a4 = ${UI};
  float a5 = ${WI};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Lge=tt({opSnippet:Oge}),Fge={kernelName:_f,backendName:"webgl",kernelFunc:Lge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mge=ju+`
  return exp(x);
`,zge=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,CB=tt({opSnippet:Mge,packedOpSnippet:zge,cpuKernelImpl:dde,dtype:"float32"}),Bge={kernelName:wf,backendName:"webgl",kernelFunc:CB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function db(t){const{inputs:e,attrs:n,backend:s}=t,{dim:i}=n,{input:r}=e,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(R(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),ye({inputs:{x:r},backend:s,attrs:{shape:a}})}const Uge={kernelName:hv,backendName:"webgl",kernelFunc:db};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o$="return exp(x) - 1.0;",Wge=tt({opSnippet:o$,packedOpSnippet:o$,cpuKernelImpl:fde}),Vge={kernelName:bf,backendName:"webgl",kernelFunc:Wge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a${constructor(e,n,s){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const r=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${i}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${r};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(t,e,n){const s=n.texData.get(t.dataId),i=re(t.shape),r=t.shape[t.shape.length-1],o=i/r,a=ye({inputs:{x:t},backend:n,attrs:{shape:[o,r]}}),l=a.shape,c=new a$("real",l,e),h=new a$("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],f=n.runWebGLProgram(c,d,"float32"),m=n.runWebGLProgram(h,d,"float32"),g=Sa({inputs:{real:f,imag:m},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m);const x=ye({inputs:{x:g},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(g),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jge(t){const{inputs:e,backend:n}=t,{input:s}=e;return IB(s,!1,n)}const Gge={kernelName:yC,backendName:"webgl",kernelFunc:jge};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hge{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cp(t){const{backend:e,attrs:n}=t,{shape:s,value:i}=n;let{dtype:r}=n;if(r=r||Nu(i),r==="string"){const o=qt(r,re(s));return o.fill(i),e.makeTensorInfo(s,r,o)}else{const o=new Hge(s,i),a=[[i]];return e.runWebGLProgram(o,[],r,a)}}const qge={kernelName:vC,backendName:"webgl",kernelFunc:Cp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kge{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xge={kernelName:xC,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,i=new Kge(n.shape);return s.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l$="return floor(x);",Zge=tt({opSnippet:l$,packedOpSnippet:l$,cpuKernelImpl:pde}),Yge={kernelName:Cf,backendName:"webgl",kernelFunc:Zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qge=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Jge=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,eye=Ln({opSnippet:Qge,packedOpSnippet:Jge,dtype:"int32"}),tye={kernelName:If,backendName:"webgl",kernelFunc:eye};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nye{constructor(e){this.variableNames=["A"];const n=rs(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sye{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=rs(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iye={kernelName:Pw,backendName:"webgl",kernelFunc:rye};let gc,h0=ee().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function rye(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:i}=e;const{numChannels:r}=s,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[l,c]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=[c,l],d=[c,l,r];if(a||o){const x=ee().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(gc==null||x!==h0)&&(h0=x,gc=document.createElement("canvas").getContext("2d",{willReadFrequently:h0})),gc.canvas.width=l,gc.canvas.height=c,gc.drawImage(i,0,0,l,c),i=gc.canvas}const f=n.makeTensorInfo(h,"int32");n.texData.get(f.dataId).usage=Ws.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),i);const m=ee().getBool("WEBGL_PACK")?new sye(d):new nye(d),g=n.runWebGLProgram(m,[f],"int32");return n.disposeData(f.dataId),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s,x=go(h),_=Pn(i.shape,r.shape,l,d,c,f,!1,x);let v;const w=[],b=o!=null,I=a!=null,S=m==="leakyrelu",T=()=>{const E=[i,r],D=(P,z)=>{if(z==="NCHW"&&P.shape.length===1&&P.shape[0]!==1){const V=ye({inputs:{x:P},backend:n,attrs:{shape:[P.shape[0],1,1]}});return w.push(V),V}return P};if(b&&E.push(D(o,h)),I&&E.push(D(a,h)),S){const P=n.makeTensorInfo([],"float32",ya(g,"float32"));E.push(P),w.push(P)}return E};if(_.filterHeight===1&&_.filterWidth===1&&_.dilationHeight===1&&_.dilationWidth===1&&_.strideHeight===1&&_.strideWidth===1&&(_.padInfo.type==="SAME"||_.padInfo.type==="VALID"))v=vB({x:i,filter:r,convInfo:_,backend:n,bias:o,activation:m,preluActivationWeights:a,leakyreluAlpha:g});else if(_.strideWidth<=2&&x==="channelsLast"&&ee().getBool("WEBGL_EXP_CONV")){const E=m?Md(m,!0):null,D=new yB(_,b,E,I,S),P=[[_.padInfo.top,_.padInfo.left],[_.strideHeight,_.strideWidth],[_.dilationHeight,_.dilationWidth],[_.inHeight,_.inWidth]],z=T();v=n.runWebGLProgram(D,z,"float32",P)}else if(ee().getBool("WEBGL_CONV_IM2COL"))v=xB({x:i,filter:r,convInfo:_,backend:n,bias:o,activation:m,preluActivationWeights:a,leakyreluAlpha:g});else{const E=m?Md(m,!1):null,D=new gB(_,b,E,I,S),P=T();v=n.runWebGLProgram(D,P,"float32")}const $=ye({inputs:{x:v},backend:n,attrs:{shape:_.outShape}});return w.push(v),w.forEach(E=>n.disposeIntermediateTensorInfo(E)),$}const aye={kernelName:Pg,backendName:"webgl",kernelFunc:oye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:m}=s,g=[];let x=h;x==null&&(x=[1,1]),R(Gn(l,x),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${x}'`);const _=Pn(i.shape,r.shape,l,x,c,d,!0),v=ee().getBool("WEBGL_PACK_DEPTHWISECONV")&&_.strideWidth<=2&&_.outChannels/_.inChannels===1,w=f?Md(f,v):null,b=[i,r],I=o!=null,S=a!=null,T=f==="leakyrelu";if(I&&b.push(o),S&&b.push(a),T){const P=n.makeTensorInfo([],"float32",ya(m,"float32"));b.push(P),g.push(P)}let $;v?$=new bB(_,I,w,S,T):$=new wB(_,I,w,S,T);const E=[[_.padInfo.top,_.padInfo.left],[_.strideHeight,_.strideWidth],[_.dilationHeight,_.dilationWidth],[_.inHeight,_.inWidth]],D=n.runWebGLProgram($,b,"float32",E);return g.forEach(P=>n.disposeIntermediateTensorInfo(P)),D}const cye={kernelName:kO,backendName:"webgl",kernelFunc:lye};class uye{constructor(e,n,s,i){this.sliceDim=e,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=s;const r=yt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${r} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hye(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,r=i.shape,o=r[r.length-1],a=re(s.shape),[l,c,h,d]=SI(s,i),f=ye({inputs:{x:i},backend:n,attrs:{shape:[c,o]}}),m=ye({inputs:{x:s},backend:n,attrs:{shape:[re(s.shape)/h,h]}});if(n.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const v=n.readSync(i.dataId),w=n.bufferSync(s),b=mde(v,w,s.dtype,c,o,h,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,b.values)}const g=new uye(o,d,[c,h],s.shape),x=n.runWebGLProgram(g,[m,f],m.dtype),_=ye({inputs:{x},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),_}const dye={kernelName:aO,backendName:"webgl",kernelFunc:hye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fye{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=yt(this.rank),i=pye(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function pye(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<t.length;i++)i===2?s.push("index"):s.push(`${n[i]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:r}=e,{axis:o,batchDims:a}=s,l=Ge(o,i.shape)[0];if(ee().get("DEBUG")){const w=n.readSync(r.dataId),b=i.shape[l];for(let I=0;I<w.length;++I){const S=w[I];R(S<=b-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${b-1}]`)}}const c=ZI(i,r,l,a),h=re(r.shape),d=[],f=ye({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),m=ye({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,h/c.batchSize]}});d.push(f),d.push(m);const g=[c.batchSize,c.outerSize,h/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([i,r])||i.dtype==="string"){const w=n.bufferSync(m),b=n.bufferSync(f),I=gde(b,w,g);return d.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.makeTensorInfo(c.outputShape,I.dtype,I.values)}const x=new fye(f.shape,g),_=n.runWebGLProgram(x,[f,m],f.dtype);d.push(_);const v=ye({inputs:{x:_},backend:n,attrs:{shape:c.outputShape}});return d.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}const mye={kernelName:fv,backendName:"webgl",kernelFunc:kB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gye="return float(a > b);",yye=`
  return vec4(greaterThan(a, b));
`,vye=Ln({opSnippet:gye,packedOpSnippet:yye,cpuKernelImpl:yde,dtype:"bool"}),xye={kernelName:pv,backendName:"webgl",kernelFunc:vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ye="return float(a >= b);",wye=`
  return vec4(greaterThanEqual(a, b));
`,bye=Ln({opSnippet:_ye,packedOpSnippet:wye,dtype:"bool",cpuKernelImpl:vde}),Cye={kernelName:kf,backendName:"webgl",kernelFunc:bye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iye(t){const{inputs:e,backend:n}=t,{input:s}=e;return IB(s,!0,n)}const kye={kernelName:_C,backendName:"webgl",kernelFunc:Iye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sye="return float(!isnan(x) && !isinf(x));",Tye=tt({opSnippet:Sye,dtype:"bool"}),Eye={kernelName:Tf,backendName:"webgl",kernelFunc:Tye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nye="return float(isinf(x));",$ye=tt({opSnippet:Nye,dtype:"bool"}),Rye={kernelName:Ef,backendName:"webgl",kernelFunc:$ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aye="return float(isnan(x));",Dye=tt({opSnippet:Aye,dtype:"bool"}),Pye={kernelName:Nf,backendName:"webgl",kernelFunc:Dye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oye="return float(a < b);",Lye=`
  return vec4(lessThan(a, b));
`,Fye=Ln({opSnippet:Oye,packedOpSnippet:Lye,cpuKernelImpl:xde,dtype:"bool"}),Mye={kernelName:gv,backendName:"webgl",kernelFunc:Fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zye="return float(a <= b);",Bye=`
  return vec4(lessThanEqual(a, b));
`,Uye=Ln({opSnippet:zye,packedOpSnippet:Bye,cpuKernelImpl:_de,dtype:"bool"}),Wye={kernelName:yv,backendName:"webgl",kernelFunc:Uye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vye(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:r}=n,o=wde(s,i,r);return e.makeTensorInfo([o.length],"float32",o)}const jye={kernelName:lO,backendName:"webgl",kernelFunc:Vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gye=ju+`
  return x < 0.0 ? 0./0. : log(x);
`,Hye=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,qye=tt({opSnippet:Gye,packedOpSnippet:Hye,cpuKernelImpl:bde}),Kye={kernelName:$f,backendName:"webgl",kernelFunc:qye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xye=ju+`
  return log(1.0 + x);
`,Zye=tt({opSnippet:Xye}),Yye={kernelName:Rf,backendName:"webgl",kernelFunc:Zye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qye="return float(a >= 1.0 && b >= 1.0);",Jye=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,eve=Ln({opSnippet:Qye,packedOpSnippet:Jye,dtype:"bool"}),tve={kernelName:vv,backendName:"webgl",kernelFunc:eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nve="return float(!(x >= 1.0));",sve=tt({opSnippet:nve}),ive={kernelName:xv,backendName:"webgl",kernelFunc:sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rve="return float(a >= 1.0 || b >= 1.0);",ove=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,ave=Ln({opSnippet:rve,packedOpSnippet:ove,dtype:"bool"}),lve={kernelName:_v,backendName:"webgl",kernelFunc:ave};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cve{constructor(e,n,s,i,r){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${i}) * sum`;r===.5?l=`inversesqrt(${c})`:r===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uve{constructor(e,n,s,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${i}) * sum`;r===.5?l=`inversesqrt(${c})`:r===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hve=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:r,bias:o,alpha:a,beta:l}=s,c=ee().getBool("WEBGL_PACK_NORMALIZATION")?new uve(i.shape,r,o,a,l):new cve(i.shape,r,o,a,l);return n.runWebGLProgram(c,[i],i.dtype)},dve={kernelName:wv,backendName:"webgl",kernelFunc:hve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fve{constructor(e,n,s,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=i,this.beta=r,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${r})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${r});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pve=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i,y:r,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:h}=s,d=new fve(i.shape,a,l,c,h);return n.runWebGLProgram(d,[i,r,o],i.dtype)},mve={kernelName:bC,backendName:"webgl",kernelFunc:pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gve(t,e,n,s){const i=re(e),o=re(t.shape)/i,a=ye({inputs:{x:t},attrs:{shape:[o,i]},backend:s}),l=tc(a,t.dtype,"max",s),c=ye({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:r,keepDims:o}=s,a=i.shape.length,l=Ge(r,i.shape);let c=l;const h=Bt(c,a),d=h!=null,f=n.shouldExecuteOnCPU([i]);let m=i;if(d){if(f){const b=n.texData.get(m.dataId).values,I=new Array(a);for(let $=0;$<I.length;$++)I[$]=i.shape[h[$]];const S=Ok(b,i.shape,i.dtype,h,I);m=n.makeTensorInfo(I,i.dtype);const T=n.texData.get(m.dataId);T.values=S}else m=wx(i,h,n);c=Zt(c.length,a)}On("max",c,a);const[g,x]=In(m.shape,c);let _=g;o&&(_=sn(g,l));let v;if(f){const b=n.texData.get(m.dataId).values,I=Cde(b,re(x),_,i.dtype);v=n.makeTensorInfo(_,i.dtype);const S=n.texData.get(v.dataId);S.values=I}else v=gve(m,x,_,n);return d&&n.disposeIntermediateTensorInfo(m),v}const yve={kernelName:bv,backendName:"webgl",kernelFunc:SB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vve=Lk+`
  return max(a, b);
`,xve=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ec+`
  return result;
`,_ve=Ln({opSnippet:vve,packedOpSnippet:xve,cpuKernelImpl:Ide}),wve={kernelName:Af,backendName:"webgl",kernelFunc:_ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;_p(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:l}=s,c=1;R(Gn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=bi(i.shape,r,o,c,a,l);if(h.filterWidth===1&&h.filterHeight===1&&ct(h.inShape,h.outShape))return Os({inputs:{x:i},backend:n});const d=new zd(h,"max",!1);return n.runWebGLProgram(d,[i],i.dtype)}const Cve={kernelName:Cv,backendName:"webgl",kernelFunc:bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,h=[1,1,1],d=mo(i.shape,r,o,h,a,c,l),f=new Mk(d,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const kve={kernelName:Iv,backendName:"webgl",kernelFunc:Ive};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sve{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,r=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=r-1-e.padInfo.top,l=o-1-e.padInfo.left,c=r*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Tve{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,i=e.strideWidth,r=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=l-1-e.padInfo.front,f=c-1-e.padInfo.top,m=h-1-e.padInfo.left,g=l*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${r}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r,{filterSize:a,strides:l,pad:c,dimRoundingMode:h}=s,d=[1,1,1],f=mo(o.shape,a,l,d,c,h),m=new Mk(f,"max",!0),g=n.runWebGLProgram(m,[o],o.dtype),x=new Tve(f),_=n.runWebGLProgram(x,[i,g],o.dtype);return n.disposeIntermediateTensorInfo(g),_}const Nve={kernelName:IC,backendName:"webgl",kernelFunc:Eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r,output:o}=e,a=r;_p([r,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:d}=s,f=bi(a.shape,l,c,1,h,d),m=!0,g=new zd(f,"max",m),x=n.runWebGLProgram(g,[a],a.dtype),_=new Sve(f),v=n.runWebGLProgram(_,[i,x],a.dtype);return n.disposeIntermediateTensorInfo(x),v}const Rve={kernelName:CC,backendName:"webgl",kernelFunc:$ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ave(t,e,n,s){let i=new zd(n,"max",!1);const r=s.runWebGLProgram(i,[t],"float32");i=new zd(n,"max",!0,!0,e);const o=s.runWebGLProgram(i,[t],"float32");return[r,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dve={kernelName:cO,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=e,l=n;R(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];R(Gn(r,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const h=bi(s.shape,i,r,c,o),[d,f]=Ave(s,a,h,l);return[d,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pve(t,e,n,s){const i=re(e),o=re(t.shape)/i,a=ye({inputs:{x:t},attrs:{shape:[o,i]},backend:s}),l=tc(a,"float32","mean",s),c=ye({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ove={kernelName:kv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:i,axis:r}=e,o=n,a=s.shape.length,l=Ge(r,s.shape);let c=l;const h=Bt(c,a),d=h!=null,f=o.shouldExecuteOnCPU([s]),m=[];let g=s;if(d){if(f){const I=o.texData.get(g.dataId).values,S=new Array(a);for(let E=0;E<S.length;E++)S[E]=s.shape[h[E]];const T=Ok(I,s.shape,s.dtype,h,S);g=o.makeTensorInfo(S,s.dtype);const $=o.texData.get(g.dataId);$.values=T}else g=wx(s,h,o);m.push(g),c=Zt(c.length,a)}On("sum",c,a);const[x,_]=In(g.shape,c);let v=x;i&&(v=sn(x,l));const w=Pve(g,_,v,o);for(const b of m)o.disposeIntermediateTensorInfo(b);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=Ge(r,i.shape);let c=l;const h=Bt(c,a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),c=Zt(c.length,i.shape.length)),On("min",c,a);const[f,m]=In(d.shape,c),g=re(m),x=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),_=tc(x,x.dtype,"min",n);let v;if(o){const w=sn(f,l);v=ye({inputs:{x:_},backend:n,attrs:{shape:w}})}else v=ye({inputs:{x:_},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(_),h!=null&&n.disposeIntermediateTensorInfo(d),v}const Fve={kernelName:Sv,backendName:"webgl",kernelFunc:Lve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mve=Lk+`
  return min(a, b);
`,zve=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ec+`
  return result;
`,Bve=Ln({opSnippet:Mve,packedOpSnippet:zve,cpuKernelImpl:kde}),Uve={kernelName:Df,backendName:"webgl",kernelFunc:Bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wve{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((h,d)=>h[0]+e[d]+h[1]);const i=e.length,r=yt(i),o=n.map(h=>h[0]).join(","),a=n.map((h,d)=>h[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),c=s==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${o});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${r} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vve{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((g,x)=>g[0]+e[x]+g[1]);const i=e.length,r=yt(i),o=n.map(g=>g[0]).join(","),a=n.map((g,x)=>g[0]+e[x]).join(","),l=ts("rc",i),c=ts("source",i),h=`${l[i-1]} < ${this.outputShape[i-1]}`,d=i===1?"source":`vec2(${c.slice(-2).join()})`,f=s==="reflect"?0:1;let m="";if(i===1){const g=`
        ${r} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;m=`
        ${r} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[i-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const g=`
        ${r} source = rc;
        ${r} lt = ${r}(lessThan(source, start));
        ${r} gte = ${r}(greaterThanEqual(source, end));
        ${r} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;m=`
        ${r} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[i-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[i-2]} += 1;
        if(${l[i-2]} < ${this.outputShape[i-2]}) {
          ${g}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[i-1]} += 1;
          if(${h}) {
            ${g}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${r} start = ${r}(${o});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jve=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:i,mode:r}=n,o=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vve(s.shape,i,r):new Wve(s.shape,i,r);return e.runWebGLProgram(o,[s],s.dtype)},Gve={kernelName:Tv,backendName:"webgl",kernelFunc:jve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hve=`if (b == 0.0) return NAN;
  return mod(a, b);`,qve=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ec+`
  return result;
`,Kve=Ln({opSnippet:Hve,packedOpSnippet:qve}),Xve={kernelName:Pf,backendName:"webgl",kernelFunc:Kve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zve{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yve=`
if (a == b) {
  return 1.0;
};
return a / b;`,Qve=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,TB=Ln({opSnippet:Yve,packedOpSnippet:Qve,checkOutOfBounds:!0}),Jve={kernelName:vf,backendName:"webgl",kernelFunc:TB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c$="return a - b;",EB=Ln({opSnippet:c$,packedOpSnippet:c$,supportsComplex:!0,cpuKernelImpl:Hde}),exe={kernelName:Zf,backendName:"webgl",kernelFunc:EB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:r}=s,o=Ge([r],i.shape),a=SB({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=sn(a.shape,o),c=ye({inputs:{x:a},backend:n,attrs:{shape:l}}),h=EB({inputs:{a:i,b:c},backend:n}),d=CB({inputs:{x:h},backend:n}),f=bx({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),m=ye({inputs:{x:f},backend:n,attrs:{shape:l}}),g=TB({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const txe={kernelName:Gv,backendName:"webgl",kernelFunc:NB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nxe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:r,seed:o,normalized:a}=s,l=a?i:NB({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=l.shape[0],h=l.shape[1],d=new Zve(c,h,r),f=[[o]],m=n.runWebGLProgram(d,[l],"int32",f);return a||n.disposeIntermediateTensorInfo(l),m}const sxe={kernelName:uO,backendName:"webgl",kernelFunc:nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ixe=Ii+`
  return -x;
`,rxe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function oxe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const r=n.texData.get(s.dataId),[o,a]=Tde(r.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let i;return ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Lo(s.shape,rxe):i=new gr(s.shape,ixe),n.runWebGLProgram(i,[s],s.dtype)}const axe={kernelName:Ev,backendName:"webgl",kernelFunc:oxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lxe=_I;function cxe(t){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(i.dataId),h=n.readSync(r.dataId),{selectedIndices:d}=lxe(c,h,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const uxe={kernelName:kC,backendName:"webgl",kernelFunc:cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hxe=wI;function dxe(t){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,h=n.readSync(i.dataId),d=n.readSync(r.dataId),{selectedIndices:f,validOutputs:m}=hxe(h,d,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}const fxe={kernelName:SC,backendName:"webgl",kernelFunc:dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pxe=bI;function mxe(t){Bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,h=n.readSync(i.dataId),d=n.readSync(r.dataId),f=o,m=a,g=l,x=c,{selectedIndices:_,selectedScores:v}=pxe(h,d,f,m,g,x);return[n.makeTensorInfo([_.length],"int32",new Int32Array(_)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const gxe={kernelName:TC,backendName:"webgl",kernelFunc:mxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yxe{constructor(e,n,s,i){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vxe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{dtype:r,depth:o,onValue:a,offValue:l}=s,c=re(i.shape),h=new yxe(c,o,a,l),d=ye({inputs:{x:i},backend:n,attrs:{shape:[c]}}),f=n.runWebGLProgram(h,[d],r);n.disposeIntermediateTensorInfo(d);const m=[...i.shape,o],g=ye({inputs:{x:f},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(f),g},xxe={kernelName:Rv,backendName:"webgl",kernelFunc:vxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ly(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const i=bp({inputs:{input:s},backend:n}),r=ly({inputs:{x:i},backend:n}),o=Cx({inputs:{input:s},backend:n}),a=ly({inputs:{x:o},backend:n}),l=Sa({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Cp({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const _xe={kernelName:Kv,backendName:"webgl",kernelFunc:ly};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const i=bp({inputs:{input:s},backend:n}),r=$B({inputs:{x:i},backend:n}),o=Cx({inputs:{input:s},backend:n}),a=ly({inputs:{x:o},backend:n}),l=Sa({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Cp({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const wxe={kernelName:$v,backendName:"webgl",kernelFunc:$B};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(e.length===1)return db({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const r=e[0].shape,o=e[0].dtype;e.forEach(h=>{q1(r,h.shape,"All tensors passed to stack must have matching shapes"),R(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const d=db({inputs:{input:h},backend:n,attrs:{dim:i}});return a.push(d),d}),c=mB({inputs:l,backend:n,attrs:{axis:i}});return a.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const Cxe={kernelName:Av,backendName:"webgl",kernelFunc:bxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ixe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,h)=>c[0]+e[h]+c[1]);const i=e.length,r=yt(i),o=n.map(c=>c[0]).join(","),a=n.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${o});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${r} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kxe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((x,_)=>x[0]+e[_]+x[1]);const i=e.length,r=yt(i),o=n.map(x=>x[0]).join(","),a=n.map((x,_)=>x[0]+e[_]).join(","),l=ts("rc",i),c=ts("source",i),h=`${l[i-1]} < ${this.outputShape[i-1]}`,d=i===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${r} rc = outputLoc;`,`${l[i-1]} += 1;
       if(${h}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${l[i-2]} += 1;
       if(${l[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${l[i-1]} += 1;
         if(${h}) {`],m=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let g="";for(let x=0,_=i===1?2:4;x<_;x++)g+=`
        ${f[x]}
        if (${m}) {
          result[${x}] = float(value);
        } else {
          ${r} source = rc - start;
          result[${x}] = getChannel(getX(${c.join()}), ${d});
        }
      `;g+=i===1?"} ":"}}",this.userCode=`
      const ${r} start = ${r}(${o});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RB=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,constantValue:o}=s;if(re(i.shape)===0){const c=r.map((h,d)=>h[0]+i.shape[d]+h[1]);return Cp({backend:n,attrs:{shape:c,value:o,dtype:i.dtype}})}const a=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kxe(i.shape,r,o):new Ixe(i.shape,r,o),l=[[o]];return n.runWebGLProgram(a,[i],i.dtype,l)},Sxe={kernelName:Dv,backendName:"webgl",kernelFunc:RB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Txe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Exe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ec+`
  return result;
`,Nxe=Ln({opSnippet:Txe,packedOpSnippet:Exe}),$xe={kernelName:Lf,backendName:"webgl",kernelFunc:Nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,l=[],c=Ge(r,i.shape);let h=c;const d=Bt(h,a);let f=i;d!=null&&(f=is({inputs:{x:i},backend:n,attrs:{perm:d}}),h=Zt(h.length,a),l.push(f)),On("prod",h,a);let m;if(n.shouldExecuteOnCPU([f])){const g=n.texData.get(f.dataId).values,{outVals:x,outShape:_,outDtype:v}=Nde(f.shape,f.dtype,g,h);m=n.makeTensorInfo(_,v,x)}else{const[g,x]=In(f.shape,h),_=re(x),v=ye({inputs:{x:f},backend:n,attrs:{shape:[-1,_]}}),w=BC(i.dtype),b=tc(v,w,"prod",n);m=ye({inputs:{x:b},backend:n,attrs:{shape:g}}),l.push(v),l.push(b)}if(o){l.push(m);const g=sn(m.shape,c);m=ye({inputs:{x:m},backend:n,attrs:{shape:g}})}return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const Axe={kernelName:Ov,backendName:"webgl",kernelFunc:Rxe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:i,paramsDenseValues:r,indices:o}=e,{outputRaggedRank:a}=s,l=i.map(v=>n.readSync(v.dataId)),c=i.map(v=>v.shape),h=n.readSync(r.dataId),d=n.readSync(o.dataId),[f,m,g]=$de(l,c,h,r.shape,r.dtype,d,o.shape,a),x=f.map(v=>n.makeTensorInfo([v.length],"int32",v)),_=n.makeTensorInfo(g,r.dtype,m);return x.concat([_])}const Pxe={kernelName:hO,backendName:"webgl",kernelFunc:Dxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oxe(t){const{inputs:e,backend:n}=t,{starts:s,limits:i,deltas:r}=e,o=n.readSync(s.dataId),a=n.readSync(i.dataId),l=n.readSync(r.dataId),[c,h]=Rde(o,s.shape,s.dtype,a,i.shape,l,r.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([h.length],s.dtype,h);return[d,f]}const Lxe={kernelName:dO,backendName:"webgl",kernelFunc:Oxe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fxe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:i,values:r,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(i.dataId),h=n.readSync(r.dataId),d=n.readSync(o.dataId),f=a.map(_=>n.readSync(_.dataId)),m=a.map(_=>_.shape),[g,x]=Ade(c,i.shape,h,r.shape,r.dtype,d,o.shape,f,m,l);return n.makeTensorInfo(g,r.dtype,x)}const Mxe={kernelName:fO,backendName:"webgl",kernelFunc:Fxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AB=t=>{const{backend:e,attrs:n}=t,{start:s,stop:i,step:r,dtype:o}=n,a=Dde(s,i,r,o);return e.makeTensorInfo([a.length],o,a)},zxe={kernelName:EC,backendName:"webgl",kernelFunc:AB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bxe="return 1.0 / x;",Uxe=tt({opSnippet:Bxe}),Wxe={kernelName:Ff,backendName:"webgl",kernelFunc:Uxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vxe=Ii+`
  return (x < 0.0) ? 0.0 : x;
`,jxe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gxe=tt({opSnippet:Vxe,packedOpSnippet:jxe}),Hxe={kernelName:Mf,backendName:"webgl",kernelFunc:Gxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qxe=Ii+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Kxe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Xxe=tt({opSnippet:qxe,packedOpSnippet:Kxe}),Zxe={kernelName:zf,backendName:"webgl",kernelFunc:Xxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yxe{constructor(e,n,s,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s];let f;r?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qxe{constructor(e,n,s,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s];let f;r?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s,[l,c]=a,h=ee().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Qxe(i.shape,l,c,r,o):new Yxe(i.shape,l,c,r,o);return n.runWebGLProgram(h,[i],"float32")}const e_e={kernelName:Mv,backendName:"webgl",kernelFunc:Jxe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t_e{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,r]=n,[,o,a]=e,l=[s&&o>1?i-1:i,s&&a>1?r-1:r],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/c[0],d=l[1]/c[1],f=1/h,m=1/d,g=Math.ceil(f)*2+2,x=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_e(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s,a=new t_e(r.shape,i.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const s_e={kernelName:RC,backendName:"webgl",kernelFunc:n_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i_e{constructor(e,n,s,i,r){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s],f=i?"0.5":"0.0";let m;r?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r_e{constructor(e,n,s,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const h=[i&&n>1?a-1:a,i&&s>1?l-1:l],d=[i&&n>1?n-1:n,i&&s>1?s-1:s],f=i?"0.5":"0.0";let m;r?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s,[l,c]=a,h=ee().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new r_e(i.shape,l,c,r,o):new i_e(i.shape,l,c,r,o);return n.runWebGLProgram(h,[i],i.dtype)}const a_e={kernelName:Fv,backendName:"webgl",kernelFunc:o_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l_e{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,r]=n,[,o,a]=e,l=[s&&o>1?i-1:i,s&&a>1?r-1:r],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/c[0],d=l[1]/c[1],f=1/h,m=1/d,g=Math.ceil(f)*2+2,x=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_e(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s,a=new l_e(r.shape,i.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const u_e={kernelName:$C,backendName:"webgl",kernelFunc:c_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h_e{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,r=e.map((a,l)=>i(l)).join(","),o=yt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${r}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d_e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const i=ts("rc",s),r=`${i[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${i[s-2]} + 1 < ${this.outputShape[s-2]}`,a=yt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${r}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(i.slice())};
          if(${r}){
            result.g = ${c(i.slice())};
          }
          if(${o}) {
            result.b = ${h(i.slice())};
            if(${r}) {
              result.a = ${d(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(g){return f(g)}function c(g){return g[s-1]="("+g[s-1]+" + 1)",f(g)}function h(g){return g[s-2]="("+g[s-2]+" + 1)",f(g)}function d(g){return g[s-1]="("+g[s-1]+" + 1)",g[s-2]="("+g[s-2]+" + 1)",f(g)}function f(g){const x=e.map((w,b)=>m(b,g)),_=x.join(","),v=x.slice(-2).join(",");return`getChannel(getX(${_}), vec2(${v}))`}function m(g,x){return n.indexOf(g)!==-1&&e[g]!==1?`${e[g]} - ${x[g]} - 1`:`${x[g]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:r}=s,o=i.shape.length,a=Ge(r,i.shape);if(o===0)return Os({inputs:{x:i},backend:n});const l=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new d_e(i.shape,a):new h_e(i.shape,a);return n.runWebGLProgram(l,[i],i.dtype)}const p_e={kernelName:zv,backendName:"webgl",kernelFunc:f_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m_e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],i=e[2];this.outputShape=e;let r="";typeof n=="number"?r=`float outputValue = ${n.toFixed(2)};`:r=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${r}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_e={kernelName:MC,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:r,center:o}=e,a=n,l=new m_e(s.shape,r),[c,h]=PI(o,s.shape[1],s.shape[2]),d=[[c,h,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,v_e=tt({opSnippet:y_e}),x_e={kernelName:Bf,backendName:"webgl",kernelFunc:v_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __e="return inversesqrt(x);",w_e=tt({opSnippet:__e,cpuKernelImpl:Pde}),b_e={kernelName:Uf,backendName:"webgl",kernelFunc:w_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zk{constructor(e,n,s,i,r,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=yt(r.length),h=yt(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";i===1?m="i":i===2&&(m="i, coords[1]");const g=`getUpdates(${m})`;let x="";l&&(x="coords[0], coords[1]");const _=`getDefaultValue(${x})`,v=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${r});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${v};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(${_}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C_e{constructor(e,n,s,i,r,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=yt(r.length),h=yt(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";i===1?m="i":i===2&&(m="i, coords[1]");const g=`getUpdates(${m})`;let x="";l&&(x="coords[0], coords[1]");const _=`getDefaultValue(${x})`,v=n>1?"strides[j]":"strides",w=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${r});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${v};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${g};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${_}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:r}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=Xl(r,i,o),f=[d/c,c];if(d===0)return n.makeTensorInfo(o,i.dtype);const m=ye({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),g=ye({inputs:{x:r},backend:n,attrs:{shape:[l,c]}}),x=n.makeTensorInfo([],"float32",new Float32Array([0]));let _;ee().getBool("WEBGL_PACK")?_=new C_e(l,a,m.shape.length,g.shape.length,h,f):_=new zk(l,a,m.shape.length,g.shape.length,h,f);const v=n.runWebGLProgram(_,[g,m,x],g.dtype),w=ye({inputs:{x:v},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),w}const k_e={kernelName:pO,backendName:"webgl",kernelFunc:I_e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S_e{constructor(e,n,s,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const r="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ee().getNumber("WEBGL_VERSION")===2?r:o,l=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:i,values:r}=e,{side:o}=s,a=new S_e(i.shape[0],i.shape[1],r.shape[1],o),l=[[i.shape[1]]];return n.runWebGLProgram(a,[i,r],"int32",l)}const E_e={kernelName:gO,backendName:"webgl",kernelFunc:T_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N_e{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let i,r;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)r="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let h=0;h<n.length;h++)c.push(`${a[h]}`),h<e&&l.push(`${a[h]}`);i=l.join(),r=c.join()}const o=yt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${r}));
        } else {
          setOutput(getB(${r}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_e(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:r}=e,o=new N_e(s.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[s,i,r],Ds(i.dtype,r.dtype))}const R_e={kernelName:Bv,backendName:"webgl",kernelFunc:$_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${ix};
  float scale = ${rx};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,D_e=tt({opSnippet:A_e}),P_e={kernelName:Wf,backendName:"webgl",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_e=ju+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,L_e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,F_e=tt({opSnippet:O_e,packedOpSnippet:L_e,cpuKernelImpl:Lde}),M_e={kernelName:Hf,backendName:"webgl",kernelFunc:F_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,B_e=tt({opSnippet:z_e}),U_e={kernelName:Gf,backendName:"webgl",kernelFunc:B_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W_e=ju+`
  return sin(x);
`,V_e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ec}
  return result;
`,j_e=tt({opSnippet:W_e,packedOpSnippet:V_e}),G_e={kernelName:Vf,backendName:"webgl",kernelFunc:j_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,q_e=tt({opSnippet:H_e}),K_e={kernelName:jf,backendName:"webgl",kernelFunc:q_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Z_e=tt({opSnippet:X_e}),Y_e={kernelName:qf,backendName:"webgl",kernelFunc:Z_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,paddings:o}=s;R(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((v,w)=>v*w),l=[[0,0]];l.push(...o);for(let v=1+r.length;v<i.shape.length;++v)l.push([0,0]);const c=[],h=RB({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),d=lp(h.shape,r,a,!1),f=cp(d.length,r.length,!1),m=up(h.shape,r,a,!1),g=ye({inputs:{x:h},backend:n,attrs:{shape:d}}),x=is({inputs:{x:g},backend:n,attrs:{perm:f}}),_=ye({inputs:{x},backend:n,attrs:{shape:m}});return c.push(h),c.push(g),c.push(x),c.forEach(v=>n.disposeIntermediateTensorInfo(v)),_},J_e={kernelName:Vv,backendName:"webgl",kernelFunc:Q_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0e(t){const{inputs:e,backend:n}=t,{indices:s,values:i,denseShape:r,defaultValue:o}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(i.dataId),c=n.readSync(r.dataId),h=n.readSync(o.dataId)[0],[d,f,m,g,x]=Mde(a,s.shape,s.dtype,l,i.dtype,c,h);return[n.makeTensorInfo(f,s.dtype,d),n.makeTensorInfo([f[0]],i.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(_=>Number(_)))),n.makeTensorInfo([x.length],s.dtype,new Int32Array(x))]}const t0e={kernelName:yO,backendName:"webgl",kernelFunc:e0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:i,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(r.dataId)),[c,h,d]=zde(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(h,s.dtype,c),n.makeTensorInfo([d.length],r.dtype,new Int32Array(d))]}const s0e={kernelName:vO,backendName:"webgl",kernelFunc:n0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0e(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${r.shape}`);const o=n.readSync(s.dataId),a=n.readSync(i.dataId),l=n.readSync(r.dataId),[c,h]=nB(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(h,s.dtype,c)}const r0e={kernelName:xO,backendName:"webgl",kernelFunc:i0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${r.shape}`);const o=n.readSync(s.dataId),a=n.readSync(i.dataId),l=n.readSync(r.dataId),[c,h]=nB(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(h,s.dtype,c)}const a0e={kernelName:_O,backendName:"webgl",kernelFunc:o0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0e(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:r,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:d,outputSize:f}=Xl(r,i,a),m=!1;if(r.dtype==="string"){const v=n.bufferSync(i),w=n.bufferSync(r),b=ta(n.readSync(o.dataId)[0]),I=Ode(v,w,a,f,h,c,l,d,b,m);return n.makeTensorInfo(a,I.dtype,I.values)}const g=new zk(c,l,i.shape.length,r.shape.length,d,[f,1],m),x=n.runWebGLProgram(g,[r,i,o],r.dtype),_=ye({inputs:{x},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(x),_}const c0e={kernelName:wO,backendName:"webgl",kernelFunc:l0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:r,axis:o}=s,a=Ge(o,i.shape)[0],l=XI(i,r,a),c=i.shape.length,h=new Array(c).fill(0),d=i.shape.slice();return l.map(f=>{const m=[...d];m[a]=f;const g=Gu({inputs:{x:i},backend:n,attrs:{begin:h,size:m}});return h[a]+=f,g})}const h0e={kernelName:jv,backendName:"webgl",kernelFunc:u0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u$="return sqrt(x);",d0e=tt({opSnippet:u$,packedOpSnippet:u$,cpuKernelImpl:Bde}),f0e={kernelName:Kf,backendName:"webgl",kernelFunc:d0e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p0e="return x * x;",m0e=tt({opSnippet:p0e}),g0e={kernelName:AC,backendName:"webgl",kernelFunc:m0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h$="return (a - b) * (a - b);",y0e=Ln({opSnippet:h$,packedOpSnippet:h$}),v0e={kernelName:Xf,backendName:"webgl",kernelFunc:y0e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const r=n.readSync(i.dataId),o=co(r),a=Ude(o,"string",s);return n.makeTensorInfo(i.shape,"string",a)}const _0e={kernelName:DC,backendName:"webgl",kernelFunc:x0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0e({inputs:t,attrs:e,backend:n}){const{x:s}=t,i=Ii+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,r=new gr(s.shape,i);return n.runWebGLProgram(r,[s],s.dtype)}const b0e={kernelName:ep,backendName:"webgl",kernelFunc:w0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C0e{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const i=s.length,r=yt(s.length),o=yt(s.length);let a="";if(i===1)a="coords * strides + begin";else{let l=0;a=s.map((c,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${r} begin = ${r}(${e});
      ${r} strides = ${r}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:f}=s,{finalShapeSparse:m,finalShape:g,isIdentity:x,sliceDim0:_,isSimpleSlice:v,begin:w,end:b,strides:I}=RI(i.shape,r,o,a,l,c,h,d,f);let S;if(x)S=ye({inputs:{x:i},backend:n,attrs:{shape:g}});else if(_||v){R(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const $=EI(w,b,I),E=Gu({inputs:{x:i},backend:n,attrs:{begin:w,size:$}});S=ye({inputs:{x:E},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(E)}else if(n.shouldExecuteOnCPU([i])){const E=n.readSync(i.dataId),D=je(i.shape,i.dtype,E),P=Wde(m,D,I,w);S=n.makeTensorInfo(g,i.dtype,P.values)}else{const E=new C0e(w,I,m);S=n.runWebGLProgram(E,[i],i.dtype)}const T=ye({inputs:{x:S},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(S),T}const k0e={kernelName:PC,backendName:"webgl",kernelFunc:I0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0e(t){const{inputs:e,backend:n,attrs:s}=t,{separator:i,nGramWidths:r,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:d}=e,f=n.readSync(h.dataId),m=n.readSync(d.dataId),[g,x]=Vde(f,m,i,r,o,a,l,c);return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(d.shape,"int32",x)]}const T0e={kernelName:bO,backendName:"webgl",kernelFunc:S0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0e(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:i}=s,{input:r,delimiter:o}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(r.dataId),l=n.readSync(o.dataId)[0],[c,h,d]=jde(a,l,i),f=h.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",h),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const N0e={kernelName:CO,backendName:"webgl",kernelFunc:E0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0e(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:i}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(r.dataId),a=Gde(o,i);return n.makeTensorInfo(r.shape,"int32",a)}const R0e={kernelName:IO,backendName:"webgl",kernelFunc:$0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0e="return tan(x);",D0e=tt({opSnippet:A0e}),P0e={kernelName:Yf,backendName:"webgl",kernelFunc:D0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O0e=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,L0e=tt({opSnippet:O0e}),F0e={kernelName:Qf,backendName:"webgl",kernelFunc:L0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:i,indices:r,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=Xl(o,r,i.shape),f=[d/c,c];if(d===0)return n.makeTensorInfo(i.shape,r.dtype);const m=ye({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),g=ye({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),x=ye({inputs:{x:i},backend:n,attrs:{shape:f}}),_=new zk(l,a,m.shape.length,g.shape.length,h,f,!1,!0),v=n.runWebGLProgram(_,[g,m,x],x.dtype),w=ye({inputs:{x:v},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v),w}const z0e={kernelName:mO,backendName:"webgl",kernelFunc:M0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B0e{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const i=yt(this.rank),r=U0e(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${r}));
      }
    `}}function U0e(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<t.length;i++)s.push(`imod(${n[i]}, ${t[i]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:r}=s;if(i.dtype==="string"||i.shape.length>5){const l=n.readSync(i.dataId),c=i.dtype==="string"?l.map(f=>ta(f)):l,h=je(i.shape,i.dtype,c),d=qde(h,r);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const o=new B0e(i.shape,r);return n.runWebGLProgram(o,[i],i.dtype)}const W0e={kernelName:Jf,backendName:"webgl",kernelFunc:DB};class V0e{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class j0e{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fa(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function d$(t){let e=1;for(;e<t;)e*=2;return e}function G0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:r,sorted:o}=s,a=ee().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ee().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,h=c[c.length-1];if(n.shouldExecuteOnCPU([i])||h<a||r>l){const P=n.readSync(i.dataId),[z,V]=Kde(P,c,i.dtype,r,o);return[n.makeTensorInfo(z.shape,z.dtype,z.values),n.makeTensorInfo(V.shape,V.dtype,V.values)]}if(r===0)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(h===1)return[i,Cp({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(i.dataId),f=d!==null&&d.isPacked,m=f?n.unpackTensor(i):i,x=re(c)/h,_=ye({inputs:{x:m},attrs:{shape:[x,h]},backend:n});f&&Fa(n,m);const v=d$(r),w=d$(h);let b=null;const I=()=>b===null?[_,_]:[_,b],S=(P,z,V)=>{const q=I(),K=new V0e(V),X=[[h],[b===null?1:0],[Number.NEGATIVE_INFINITY],[P],[z]],oe=b;b=n.runWebGLProgram(K,q,"int32",X),Fa(n,oe)};for(let P=1;P<v;P*=2){const z=P*2;for(let V=P;V>=1;V/=2)S(z,V,[x,w])}for(let P=w;P>v;P/=2){const z=I(),V=new j0e([x,P/2]),K=[[h],[b===null?1:0],[v]],J=b;b=n.runWebGLProgram(V,z,"int32",K),Fa(n,J);const X=v/2,oe=X*2;for(let O=X;O>=1;O/=2)S(oe,O,b.shape)}let T=b;b=Gu({inputs:{x:b},backend:n,attrs:{begin:0,size:[x,r]}}),Fa(n,T);let $=kB({inputs:{x:_,indices:b},backend:n,attrs:{axis:1,batchDims:1}});Fa(n,_);const E=c.slice(0,-1);E.push(r),T=b,b=ye({inputs:{x:b},attrs:{shape:E},backend:n}),Fa(n,T);const D=$;return $=ye({inputs:{x:$},attrs:{shape:E},backend:n}),Fa(n,D),[$,b]}const H0e={kernelName:OC,backendName:"webgl",kernelFunc:G0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q0e{constructor(e,n,s,i,r,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(i){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${r});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${r});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,transforms:r}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[h,d,f,m]=i.shape,[g,x]=c??[d,f],_=[h,g,x,m],v=new q0e(d,f,o,a,l,_);return n.runWebGLProgram(v,[i,r],"float32")}const X0e={kernelName:LC,backendName:"webgl",kernelFunc:K0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0e(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:r}=e;_p(r,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(r.dataId),{outputValues:a,outputShape:l,indices:c}=Xde(o,i,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const Y0e={kernelName:FC,backendName:"webgl",kernelFunc:Z0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0e(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i,a=o.shape.length,l=i.shape[r],c=new Array(a-1);let h=0;for(let x=0;x<a;x++)x!==r&&(c[h++]=o.shape[x]);const d=[],f=new Array(a).fill(0),m=o.shape.slice();m[r]=1;const g=new Array(l);for(let x=0;x<g.length;x++){f[r]=x;const _=Gu({inputs:{x:o},backend:n,attrs:{begin:f,size:m}}),v=ye({inputs:{x:_},backend:n,attrs:{shape:c}});g[x]=v,d.push(_)}return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}const J0e={kernelName:Hv,backendName:"webgl",kernelFunc:Q0e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ewe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,i=e.batchSize,r=e.inSize,o=e.numSegments,a=o*Math.ceil(r/s);this.outputShape=[i,a];const l="0.0",c="sumValue",h=Math.floor(s/4)*4,d=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let m="";r%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `);let g="";r%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function twe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:r}=e,{numSegments:o}=s,a=i.shape.length,l=[];let c=0;const h=Bt([c],a);let d=i;h!=null&&(d=is({inputs:{x:i},backend:n,attrs:{perm:h}}),l.push(d),c=Zt(1,a)[0]);const f=vF(d.shape,c,o),m=re([d.shape[c]]),g=ye({inputs:{x:d},backend:n,attrs:{shape:[-1,m]}});l.push(g);const x=BC(i.dtype),_=(I,S,T,$,E)=>{const D=I.shape[0],P=I.shape[1],z=yF(P,E),V={windowSize:z,inSize:P,batchSize:D,numSegments:E},q=new ewe(V,S),K=n.compileAndRun(q,[I,T],$);if(l.push(K),K.shape[1]===E)return K;const J=AB({backend:n,attrs:{start:0,stop:E,step:1,dtype:"float32"}}),X=DB({inputs:{x:J},backend:n,attrs:{reps:[P/z]}});return l.push(J),l.push(X),_(K,S,X,$,E)},v=_(g,"unsortedSegmentSum",r,x,o),w=ye({inputs:{x:v},backend:n,attrs:{shape:f}});let b=w;if(h!=null){l.push(w);const I=_a(h);b=is({inputs:{x:b},backend:n,attrs:{perm:I}})}return l.forEach(I=>n.disposeIntermediateTensorInfo(I)),b}const nwe={kernelName:qv,backendName:"webgl",kernelFunc:twe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const swe=[Bfe,Wfe,Gfe,Kfe,Zfe,Jfe,tpe,spe,ape,cpe,dpe,mpe,vpe,bpe,kpe,Tpe,Npe,Dpe,Ope,Fpe,Upe,Kpe,Zpe,eme,nme,lme,ume,pme,Cfe,yme,bme,Sme,Ame,Ome,Fme,zme,Ume,Gme,Kme,Yme,Jme,tge,sge,oge,lge,dge,pge,yge,_ge,bge,Sge,$ge,Pge,Fge,Bge,Uge,Vge,Gge,qge,Xge,Yge,tye,iye,aye,cye,dye,mye,xye,Cye,bfe,kye,_me,Eye,Rye,Pye,kfe,Mye,Wye,jye,Kye,Yye,tve,ive,lve,dve,mve,yve,wve,Cve,kve,Nve,Rve,Dve,Ove,Fve,Uve,Gve,Xve,sxe,Efe,axe,uxe,fxe,gxe,ime,xxe,wxe,Cxe,Sxe,$xe,Tfe,Axe,Pxe,Lxe,Mxe,zxe,rme,Jve,Wxe,Hxe,Zxe,$fe,e_e,s_e,a_e,u_e,p_e,g_e,x_e,b_e,k_e,E_e,R_e,P_e,M_e,U_e,G_e,K_e,Hpe,txe,Y_e,J_e,t0e,s0e,r0e,a0e,c0e,h0e,f0e,g0e,v0e,_0e,b0e,k0e,T0e,N0e,R0e,exe,Ffe,P0e,F0e,z0e,W0e,H0e,X0e,Mfe,Y0e,J0e,nwe,_xe];for(const t of swe)SO(t);const iwe=t=>{if(!t||!t.complete||!t.naturalHeight)throw new Error("Invalid image element");return Q(()=>{const e=IJ(t);if(e.shape[0]===0||e.shape[1]===0)throw e.dispose(),new Error("Invalid image dimensions");return e.resizeNearestNeighbor([224,224]).toFloat().div(rt(255)).expandDims()})},rwe=(t,e)=>new Promise((n,s)=>{if(!t||!t.videoWidth||!t.videoHeight){s(new Error("Invalid video element"));return}if(!e){s(new Error("Canvas element is required"));return}try{e.width=t.videoWidth,e.height=t.videoHeight;const i=e.getContext("2d");if(!i){s(new Error("Failed to get canvas context"));return}i.drawImage(t,0,0);const r=e.toDataURL("image/jpeg",.9),o=new Image;o.onload=()=>{if(o.width===0||o.height===0){s(new Error("Invalid captured image dimensions"));return}n({src:r,element:o})},o.onerror=()=>{s(new Error("Failed to load captured image"))},o.src=r}catch(i){s(new Error(`Capture processing failed: ${i.message}`))}}),owe=()=>{const[t,e]=ne.useState(null),[n,s]=ne.useState(!0),[i,r]=ne.useState(null),o=ne.useCallback(async()=>{try{s(!0),r(null),await IX();try{const c=await yse("indexeddb://injury-detection-model");await c.summary(),e(c);return}catch(c){console.log("Creating new model:",c.message)}const l=_se();l.add(n0({inputShape:[224,224,3],filters:32,kernelSize:3,activation:"relu",padding:"same"})),l.add(i0()),l.add(r0({poolSize:2})),l.add(n0({filters:64,kernelSize:3,activation:"relu",padding:"same"})),l.add(i0()),l.add(r0({poolSize:2})),l.add(n0({filters:128,kernelSize:3,activation:"relu",padding:"same"})),l.add(i0()),l.add(r0({poolSize:2})),l.add(Mse()),l.add(s0({units:128,activation:"relu"})),l.add($2({rate:.5})),l.add(s0({units:64,activation:"relu"})),l.add($2({rate:.3})),l.add(s0({units:4,activation:"softmax"})),l.compile({optimizer:Va.adam(1e-4),loss:"categoricalCrossentropy",metrics:["accuracy"]}),await l.save("indexeddb://injury-detection-model"),e(l)}catch(l){if(console.error("Error initializing model:",l),r(l.message),t)try{t.dispose()}catch(c){console.error("Model cleanup error:",c)}}finally{s(!1)}},[]);return ne.useEffect(()=>(o(),()=>{if(t)try{t.dispose()}catch(l){console.error("Model disposal error:",l)}}),[o]),{model:t,isLoading:n,error:i,classifyImage:async l=>{if(!t)throw new Error("Model not initialized");let c=null;try{if(c=iwe(l),!c)throw new Error("Failed to preprocess image");const h=await t.predict(c).data();return Array.from(h)}catch(h){throw console.error("Classification error:",h),new Error(`Failed to analyze image: ${h.message}`)}finally{if(c)try{c.dispose()}catch(h){console.error("Tensor cleanup error:",h)}}}}},PB=ne.createContext(),d0={0:{id:0,label:"No Injury",severity:"low",color:"green",precautions:["No immediate action required","Monitor for any changes"],description:"No visible signs of injury detected."},1:{id:1,label:"Minor Wound",severity:"low",color:"yellow",precautions:["Clean wound with mild antiseptic","Apply sterile bandage","Keep wound dry","Change bandage daily"],description:"Small superficial injury requiring basic first aid."},2:{id:2,label:"Moderate Injury",severity:"medium",color:"orange",precautions:["Clean thoroughly with antiseptic","Control bleeding","Apply pressure bandage","Seek medical consultation","Consider tetanus shot"],description:"Significant wound that may require professional medical assessment."},3:{id:3,label:"Severe Injury",severity:"high",color:"red",precautions:["Call emergency services immediately","Do not move if serious injury suspected","Apply direct pressure to wound","Prevent patient from going into shock","Keep patient warm and still"],description:"Critical injury requiring immediate professional medical intervention."}},awe=({children:t})=>{const e=n=>d0[n]||d0[0];return A.jsx(PB.Provider,{value:{getInjuryClassification:e,INJURY_CLASSIFICATIONS:d0},children:t})},lwe=()=>{const t=ne.useContext(PB);if(!t)throw new Error("useInjuryClassification must be used within an InjuryClassificationProvider");return t};function cwe(){const[t,e]=ne.useState(null),[n,s]=ne.useState(null),[i,r]=ne.useState(!1),[o,a]=ne.useState(!1),[l,c]=ne.useState(null),[h,d]=ne.useState(null),f=ne.useRef(null),m=ne.useRef(null),g=ne.useRef(null),{model:x,isLoading:_,classifyImage:v}=owe(),{getInjuryClassification:w}=lwe(),b=async E=>{const D=E.target.files[0];if(D)try{const P=new FileReader,z=new Promise((J,X)=>{P.onload=J,P.onerror=X});P.readAsDataURL(D);const V=await z,q=new Image,K=new Promise((J,X)=>{q.onload=J,q.onerror=X});if(q.src=V.target.result,await K,q.width===0||q.height===0)throw new Error("Invalid image dimensions");e(V.target.result),s(null),c(null)}catch(P){console.error("Image upload error:",P),c("Failed to load image. Please try another image.")}},I=async()=>{var E;if(c(null),!m.current)throw new Error("Video element not initialized. Please ensure the video element is rendered.");h&&h.getTracks().forEach(D=>D.stop());try{if(!((E=navigator.mediaDevices)!=null&&E.getUserMedia))throw new Error("Camera API not supported in this browser");const D={video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"}};let P;try{P=await navigator.mediaDevices.getUserMedia(D)}catch(q){console.warn("Failed with ideal constraints, trying fallback:",q),P=await navigator.mediaDevices.getUserMedia({video:!0})}if(!P||!P.getVideoTracks().length)throw new Error("No video track available in media stream");m.current.srcObject=P,m.current.setAttribute("playsinline",!0),m.current.setAttribute("autoplay",!0),await new Promise((q,K)=>{const J=setTimeout(()=>{K(new Error("Video metadata load timeout"))},5e3);m.current.onloadedmetadata=()=>{clearTimeout(J),q()}});const V=P.getVideoTracks()[0].getSettings();V.width&&V.height&&(m.current.width=V.width,m.current.height=V.height);try{await m.current.play()}catch(q){throw new Error(`Failed to play video: ${q.message}`)}d(P),a(!0),c(null)}catch(D){handleCameraError(D)}},S=async()=>{if(!m.current||!g.current){c("Camera initialization failed");return}try{const E=await rwe(m.current,g.current),D=new Image,P=new Promise((z,V)=>{D.onload=z,D.onerror=V});if(D.src=E.src,await P,D.width===0||D.height===0)throw new Error("Invalid captured image dimensions");e(E.src),T()}catch(E){console.error("Image capture error:",E),c("Failed to capture image. Please try again.")}},T=()=>{if(h&&(h.getTracks().forEach(E=>{try{E.stop()}catch(D){console.error("Error stopping track:",D)}}),d(null)),m.current)try{m.current.srcObject=null}catch(E){console.error("Error clearing video source:",E)}a(!1)},$=async()=>{if(!x||!t){c("Model not ready or no image selected");return}r(!0),c(null);try{const E=new Image,D=new Promise((q,K)=>{E.onload=q,E.onerror=K});if(E.src=t,await D,E.width===0||E.height===0)throw new Error("Invalid image dimensions");const P=await v(E);if(!P||!Array.isArray(P))throw new Error("Invalid prediction data received");const z=P.indexOf(Math.max(...P)),V=w(z);s(V)}catch(E){console.error("Image analysis error:",E),c("Image analysis failed. Please try again with a different image.")}finally{r(!1)}};return ne.useEffect(()=>()=>{T(),c(null),a(!1)},[]),ne.useEffect(()=>()=>{t&&URL.revokeObjectURL(t)},[t]),A.jsx("div",{className:"container mx-auto px-4 py-8",children:A.jsxs("div",{className:"max-w-3xl mx-auto",children:[A.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Injury Detection"}),A.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[l&&A.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 flex items-center",children:[A.jsx(mw,{className:"mr-2",size:20}),A.jsx("span",{children:l})]}),A.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[A.jsxs("button",{onClick:()=>{var E;return(E=f.current)==null?void 0:E.click()},disabled:i||_,className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[A.jsx(oH,{size:20})," Upload Image"]}),A.jsxs("button",{onClick:o?S:I,disabled:i||_,className:"flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[A.jsx(wg,{size:20})," ",o?"Capture":"Use Camera"]})]}),A.jsx("input",{type:"file",ref:f,onChange:b,accept:"image/*",className:"hidden"}),A.jsx("canvas",{ref:g,className:"hidden"}),A.jsxs("div",{className:"relative aspect-video mb-6 bg-gray-100 rounded-lg overflow-hidden",children:[A.jsx("video",{ref:m,className:`w-full h-full object-cover ${o?"block":"hidden"}`,playsInline:!0,autoPlay:!0,muted:!0,style:{transform:"scaleX(-1)",maxWidth:"100%",maxHeight:"100%"}}),!o&&t&&A.jsx("img",{src:t,alt:"Uploaded injury",className:"w-full h-full object-cover"}),!o&&!t&&A.jsx("div",{className:"w-full h-full flex items-center justify-center",children:A.jsx("p",{className:"text-gray-500",children:"No image selected"})})]}),t&&!o&&A.jsx("button",{onClick:$,disabled:i||_,className:"w-full bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Analyzing...":"Analyze Image"}),n&&A.jsxs("div",{className:`mt-6 p-4 bg-${n.color}-50 rounded-lg border border-${n.color}-200`,children:[A.jsxs("h3",{className:"font-semibold mb-2 flex items-center",children:[n.severity==="high"?A.jsx(mw,{className:"mr-2 text-red-600"}):A.jsx(ZG,{className:"mr-2 text-green-600"}),"Analysis Results"]}),A.jsxs("p",{className:"mb-2",children:[A.jsx("strong",{children:"Detected:"})," ",n.label]}),A.jsxs("p",{className:"mb-2",children:[A.jsx("strong",{children:"Severity:"})," ",n.severity]}),A.jsxs("div",{className:"mt-4 font-medium",children:[A.jsx("h4",{children:"Recommended Precautions:"}),A.jsx("ul",{className:"list-disc list-inside mt-2",children:n.precautions.map((E,D)=>A.jsx("li",{className:"mb-1",children:E},D))})]})]})]})]})})}function OB(t,e){const n=ne.useRef(e);ne.useEffect(function(){e!==n.current&&t.attributionControl!=null&&(n.current!=null&&t.attributionControl.removeAttribution(n.current),e!=null&&t.attributionControl.addAttribution(e)),n.current=e},[t,e])}const uwe=1;function hwe(t){return Object.freeze({__version:uwe,map:t})}function dwe(t,e){return Object.freeze({...t,...e})}const LB=ne.createContext(null),FB=LB.Provider;function Bk(){const t=ne.useContext(LB);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function fwe(t){function e(n,s){const{instance:i,context:r}=t(n).current;return ne.useImperativeHandle(s,()=>i),n.children==null?null:Km.createElement(FB,{value:r},n.children)}return ne.forwardRef(e)}function pwe(t){function e(n,s){const[i,r]=ne.useState(!1),{instance:o}=t(n,r).current;ne.useImperativeHandle(s,()=>o),ne.useEffect(function(){i&&o.update()},[o,i,n.children]);const a=o._contentNode;return a?pD.createPortal(n.children,a):null}return ne.forwardRef(e)}function mwe(t){function e(n,s){const{instance:i}=t(n).current;return ne.useImperativeHandle(s,()=>i),null}return ne.forwardRef(e)}function MB(t,e){const n=ne.useRef();ne.useEffect(function(){return e!=null&&t.instance.on(e),n.current=e,function(){n.current!=null&&t.instance.off(n.current),n.current=null}},[t,e])}function Uk(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function gwe(t,e){return function(s,i){const r=Bk(),o=t(Uk(s,r),r);return OB(r.map,s.attribution),MB(o.current,s.eventHandlers),e(o.current,r,s,i),o}}var fb={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(n,s){s(e)})(ua,function(n){var s="1.9.4";function i(u){var p,y,C,k;for(y=1,C=arguments.length;y<C;y++){k=arguments[y];for(p in k)u[p]=k[p]}return u}var r=Object.create||function(){function u(){}return function(p){return u.prototype=p,new u}}();function o(u,p){var y=Array.prototype.slice;if(u.bind)return u.bind.apply(u,y.call(arguments,1));var C=y.call(arguments,2);return function(){return u.apply(p,C.length?C.concat(y.call(arguments)):arguments)}}var a=0;function l(u){return"_leaflet_id"in u||(u._leaflet_id=++a),u._leaflet_id}function c(u,p,y){var C,k,N,M;return M=function(){C=!1,k&&(N.apply(y,k),k=!1)},N=function(){C?k=arguments:(u.apply(y,arguments),setTimeout(M,p),C=!0)},N}function h(u,p,y){var C=p[1],k=p[0],N=C-k;return u===C&&y?u:((u-k)%N+N)%N+k}function d(){return!1}function f(u,p){if(p===!1)return u;var y=Math.pow(10,p===void 0?6:p);return Math.round(u*y)/y}function m(u){return u.trim?u.trim():u.replace(/^\s+|\s+$/g,"")}function g(u){return m(u).split(/\s+/)}function x(u,p){Object.prototype.hasOwnProperty.call(u,"options")||(u.options=u.options?r(u.options):{});for(var y in p)u.options[y]=p[y];return u.options}function _(u,p,y){var C=[];for(var k in u)C.push(encodeURIComponent(y?k.toUpperCase():k)+"="+encodeURIComponent(u[k]));return(!p||p.indexOf("?")===-1?"?":"&")+C.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function w(u,p){return u.replace(v,function(y,C){var k=p[C];if(k===void 0)throw new Error("No value provided for variable "+y);return typeof k=="function"&&(k=k(p)),k})}var b=Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"};function I(u,p){for(var y=0;y<u.length;y++)if(u[y]===p)return y;return-1}var S="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function T(u){return window["webkit"+u]||window["moz"+u]||window["ms"+u]}var $=0;function E(u){var p=+new Date,y=Math.max(0,16-(p-$));return $=p+y,window.setTimeout(u,y)}var D=window.requestAnimationFrame||T("RequestAnimationFrame")||E,P=window.cancelAnimationFrame||T("CancelAnimationFrame")||T("CancelRequestAnimationFrame")||function(u){window.clearTimeout(u)};function z(u,p,y){if(y&&D===E)u.call(p);else return D.call(window,o(u,p))}function V(u){u&&P.call(window,u)}var q={__proto__:null,extend:i,create:r,bind:o,get lastId(){return a},stamp:l,throttle:c,wrapNum:h,falseFn:d,formatNum:f,trim:m,splitWords:g,setOptions:x,getParamString:_,template:w,isArray:b,indexOf:I,emptyImageUrl:S,requestFn:D,cancelFn:P,requestAnimFrame:z,cancelAnimFrame:V};function K(){}K.extend=function(u){var p=function(){x(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},y=p.__super__=this.prototype,C=r(y);C.constructor=p,p.prototype=C;for(var k in this)Object.prototype.hasOwnProperty.call(this,k)&&k!=="prototype"&&k!=="__super__"&&(p[k]=this[k]);return u.statics&&i(p,u.statics),u.includes&&(J(u.includes),i.apply(null,[C].concat(u.includes))),i(C,u),delete C.statics,delete C.includes,C.options&&(C.options=y.options?r(y.options):{},i(C.options,u.options)),C._initHooks=[],C.callInitHooks=function(){if(!this._initHooksCalled){y.callInitHooks&&y.callInitHooks.call(this),this._initHooksCalled=!0;for(var N=0,M=C._initHooks.length;N<M;N++)C._initHooks[N].call(this)}},p},K.include=function(u){var p=this.prototype.options;return i(this.prototype,u),u.options&&(this.prototype.options=p,this.mergeOptions(u.options)),this},K.mergeOptions=function(u){return i(this.prototype.options,u),this},K.addInitHook=function(u){var p=Array.prototype.slice.call(arguments,1),y=typeof u=="function"?u:function(){this[u].apply(this,p)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(y),this};function J(u){if(!(typeof L>"u"||!L||!L.Mixin)){u=b(u)?u:[u];for(var p=0;p<u.length;p++)u[p]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var X={on:function(u,p,y){if(typeof u=="object")for(var C in u)this._on(C,u[C],p);else{u=g(u);for(var k=0,N=u.length;k<N;k++)this._on(u[k],p,y)}return this},off:function(u,p,y){if(!arguments.length)delete this._events;else if(typeof u=="object")for(var C in u)this._off(C,u[C],p);else{u=g(u);for(var k=arguments.length===1,N=0,M=u.length;N<M;N++)k?this._off(u[N]):this._off(u[N],p,y)}return this},_on:function(u,p,y,C){if(typeof p!="function"){console.warn("wrong listener type: "+typeof p);return}if(this._listens(u,p,y)===!1){y===this&&(y=void 0);var k={fn:p,ctx:y};C&&(k.once=!0),this._events=this._events||{},this._events[u]=this._events[u]||[],this._events[u].push(k)}},_off:function(u,p,y){var C,k,N;if(this._events&&(C=this._events[u],!!C)){if(arguments.length===1){if(this._firingCount)for(k=0,N=C.length;k<N;k++)C[k].fn=d;delete this._events[u];return}if(typeof p!="function"){console.warn("wrong listener type: "+typeof p);return}var M=this._listens(u,p,y);if(M!==!1){var Y=C[M];this._firingCount&&(Y.fn=d,this._events[u]=C=C.slice()),C.splice(M,1)}}},fire:function(u,p,y){if(!this.listens(u,y))return this;var C=i({},p,{type:u,target:this,sourceTarget:p&&p.sourceTarget||this});if(this._events){var k=this._events[u];if(k){this._firingCount=this._firingCount+1||1;for(var N=0,M=k.length;N<M;N++){var Y=k[N],se=Y.fn;Y.once&&this.off(u,se,Y.ctx),se.call(Y.ctx||this,C)}this._firingCount--}}return y&&this._propagateEvent(C),this},listens:function(u,p,y,C){typeof u!="string"&&console.warn('"string" type argument expected');var k=p;typeof p!="function"&&(C=!!p,k=void 0,y=void 0);var N=this._events&&this._events[u];if(N&&N.length&&this._listens(u,k,y)!==!1)return!0;if(C){for(var M in this._eventParents)if(this._eventParents[M].listens(u,p,y,C))return!0}return!1},_listens:function(u,p,y){if(!this._events)return!1;var C=this._events[u]||[];if(!p)return!!C.length;y===this&&(y=void 0);for(var k=0,N=C.length;k<N;k++)if(C[k].fn===p&&C[k].ctx===y)return k;return!1},once:function(u,p,y){if(typeof u=="object")for(var C in u)this._on(C,u[C],p,!0);else{u=g(u);for(var k=0,N=u.length;k<N;k++)this._on(u[k],p,y,!0)}return this},addEventParent:function(u){return this._eventParents=this._eventParents||{},this._eventParents[l(u)]=u,this},removeEventParent:function(u){return this._eventParents&&delete this._eventParents[l(u)],this},_propagateEvent:function(u){for(var p in this._eventParents)this._eventParents[p].fire(u.type,i({layer:u.target,propagatedFrom:u.target},u),!0)}};X.addEventListener=X.on,X.removeEventListener=X.clearAllEventListeners=X.off,X.addOneTimeEventListener=X.once,X.fireEvent=X.fire,X.hasEventListeners=X.listens;var oe=K.extend(X);function O(u,p,y){this.x=y?Math.round(u):u,this.y=y?Math.round(p):p}var Z=Math.trunc||function(u){return u>0?Math.floor(u):Math.ceil(u)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(u){return this.clone()._add(j(u))},_add:function(u){return this.x+=u.x,this.y+=u.y,this},subtract:function(u){return this.clone()._subtract(j(u))},_subtract:function(u){return this.x-=u.x,this.y-=u.y,this},divideBy:function(u){return this.clone()._divideBy(u)},_divideBy:function(u){return this.x/=u,this.y/=u,this},multiplyBy:function(u){return this.clone()._multiplyBy(u)},_multiplyBy:function(u){return this.x*=u,this.y*=u,this},scaleBy:function(u){return new O(this.x*u.x,this.y*u.y)},unscaleBy:function(u){return new O(this.x/u.x,this.y/u.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Z(this.x),this.y=Z(this.y),this},distanceTo:function(u){u=j(u);var p=u.x-this.x,y=u.y-this.y;return Math.sqrt(p*p+y*y)},equals:function(u){return u=j(u),u.x===this.x&&u.y===this.y},contains:function(u){return u=j(u),Math.abs(u.x)<=Math.abs(this.x)&&Math.abs(u.y)<=Math.abs(this.y)},toString:function(){return"Point("+f(this.x)+", "+f(this.y)+")"}};function j(u,p,y){return u instanceof O?u:b(u)?new O(u[0],u[1]):u==null?u:typeof u=="object"&&"x"in u&&"y"in u?new O(u.x,u.y):new O(u,p,y)}function te(u,p){if(u)for(var y=p?[u,p]:u,C=0,k=y.length;C<k;C++)this.extend(y[C])}te.prototype={extend:function(u){var p,y;if(!u)return this;if(u instanceof O||typeof u[0]=="number"||"x"in u)p=y=j(u);else if(u=ae(u),p=u.min,y=u.max,!p||!y)return this;return!this.min&&!this.max?(this.min=p.clone(),this.max=y.clone()):(this.min.x=Math.min(p.x,this.min.x),this.max.x=Math.max(y.x,this.max.x),this.min.y=Math.min(p.y,this.min.y),this.max.y=Math.max(y.y,this.max.y)),this},getCenter:function(u){return j((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,u)},getBottomLeft:function(){return j(this.min.x,this.max.y)},getTopRight:function(){return j(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(u){var p,y;return typeof u[0]=="number"||u instanceof O?u=j(u):u=ae(u),u instanceof te?(p=u.min,y=u.max):p=y=u,p.x>=this.min.x&&y.x<=this.max.x&&p.y>=this.min.y&&y.y<=this.max.y},intersects:function(u){u=ae(u);var p=this.min,y=this.max,C=u.min,k=u.max,N=k.x>=p.x&&C.x<=y.x,M=k.y>=p.y&&C.y<=y.y;return N&&M},overlaps:function(u){u=ae(u);var p=this.min,y=this.max,C=u.min,k=u.max,N=k.x>p.x&&C.x<y.x,M=k.y>p.y&&C.y<y.y;return N&&M},isValid:function(){return!!(this.min&&this.max)},pad:function(u){var p=this.min,y=this.max,C=Math.abs(p.x-y.x)*u,k=Math.abs(p.y-y.y)*u;return ae(j(p.x-C,p.y-k),j(y.x+C,y.y+k))},equals:function(u){return u?(u=ae(u),this.min.equals(u.getTopLeft())&&this.max.equals(u.getBottomRight())):!1}};function ae(u,p){return!u||u instanceof te?u:new te(u,p)}function ue(u,p){if(u)for(var y=p?[u,p]:u,C=0,k=y.length;C<k;C++)this.extend(y[C])}ue.prototype={extend:function(u){var p=this._southWest,y=this._northEast,C,k;if(u instanceof le)C=u,k=u;else if(u instanceof ue){if(C=u._southWest,k=u._northEast,!C||!k)return this}else return u?this.extend(ce(u)||he(u)):this;return!p&&!y?(this._southWest=new le(C.lat,C.lng),this._northEast=new le(k.lat,k.lng)):(p.lat=Math.min(C.lat,p.lat),p.lng=Math.min(C.lng,p.lng),y.lat=Math.max(k.lat,y.lat),y.lng=Math.max(k.lng,y.lng)),this},pad:function(u){var p=this._southWest,y=this._northEast,C=Math.abs(p.lat-y.lat)*u,k=Math.abs(p.lng-y.lng)*u;return new ue(new le(p.lat-C,p.lng-k),new le(y.lat+C,y.lng+k))},getCenter:function(){return new le((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new le(this.getNorth(),this.getWest())},getSouthEast:function(){return new le(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(u){typeof u[0]=="number"||u instanceof le||"lat"in u?u=ce(u):u=he(u);var p=this._southWest,y=this._northEast,C,k;return u instanceof ue?(C=u.getSouthWest(),k=u.getNorthEast()):C=k=u,C.lat>=p.lat&&k.lat<=y.lat&&C.lng>=p.lng&&k.lng<=y.lng},intersects:function(u){u=he(u);var p=this._southWest,y=this._northEast,C=u.getSouthWest(),k=u.getNorthEast(),N=k.lat>=p.lat&&C.lat<=y.lat,M=k.lng>=p.lng&&C.lng<=y.lng;return N&&M},overlaps:function(u){u=he(u);var p=this._southWest,y=this._northEast,C=u.getSouthWest(),k=u.getNorthEast(),N=k.lat>p.lat&&C.lat<y.lat,M=k.lng>p.lng&&C.lng<y.lng;return N&&M},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(u,p){return u?(u=he(u),this._southWest.equals(u.getSouthWest(),p)&&this._northEast.equals(u.getNorthEast(),p)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function he(u,p){return u instanceof ue?u:new ue(u,p)}function le(u,p,y){if(isNaN(u)||isNaN(p))throw new Error("Invalid LatLng object: ("+u+", "+p+")");this.lat=+u,this.lng=+p,y!==void 0&&(this.alt=+y)}le.prototype={equals:function(u,p){if(!u)return!1;u=ce(u);var y=Math.max(Math.abs(this.lat-u.lat),Math.abs(this.lng-u.lng));return y<=(p===void 0?1e-9:p)},toString:function(u){return"LatLng("+f(this.lat,u)+", "+f(this.lng,u)+")"},distanceTo:function(u){return Se.distance(this,ce(u))},wrap:function(){return Se.wrapLatLng(this)},toBounds:function(u){var p=180*u/40075017,y=p/Math.cos(Math.PI/180*this.lat);return he([this.lat-p,this.lng-y],[this.lat+p,this.lng+y])},clone:function(){return new le(this.lat,this.lng,this.alt)}};function ce(u,p,y){return u instanceof le?u:b(u)&&typeof u[0]!="object"?u.length===3?new le(u[0],u[1],u[2]):u.length===2?new le(u[0],u[1]):null:u==null?u:typeof u=="object"&&"lat"in u?new le(u.lat,"lng"in u?u.lng:u.lon,u.alt):p===void 0?null:new le(u,p,y)}var we={latLngToPoint:function(u,p){var y=this.projection.project(u),C=this.scale(p);return this.transformation._transform(y,C)},pointToLatLng:function(u,p){var y=this.scale(p),C=this.transformation.untransform(u,y);return this.projection.unproject(C)},project:function(u){return this.projection.project(u)},unproject:function(u){return this.projection.unproject(u)},scale:function(u){return 256*Math.pow(2,u)},zoom:function(u){return Math.log(u/256)/Math.LN2},getProjectedBounds:function(u){if(this.infinite)return null;var p=this.projection.bounds,y=this.scale(u),C=this.transformation.transform(p.min,y),k=this.transformation.transform(p.max,y);return new te(C,k)},infinite:!1,wrapLatLng:function(u){var p=this.wrapLng?h(u.lng,this.wrapLng,!0):u.lng,y=this.wrapLat?h(u.lat,this.wrapLat,!0):u.lat,C=u.alt;return new le(y,p,C)},wrapLatLngBounds:function(u){var p=u.getCenter(),y=this.wrapLatLng(p),C=p.lat-y.lat,k=p.lng-y.lng;if(C===0&&k===0)return u;var N=u.getSouthWest(),M=u.getNorthEast(),Y=new le(N.lat-C,N.lng-k),se=new le(M.lat-C,M.lng-k);return new ue(Y,se)}},Se=i({},we,{wrapLng:[-180,180],R:6371e3,distance:function(u,p){var y=Math.PI/180,C=u.lat*y,k=p.lat*y,N=Math.sin((p.lat-u.lat)*y/2),M=Math.sin((p.lng-u.lng)*y/2),Y=N*N+Math.cos(C)*Math.cos(k)*M*M,se=2*Math.atan2(Math.sqrt(Y),Math.sqrt(1-Y));return this.R*se}}),Ee=6378137,Fe={R:Ee,MAX_LATITUDE:85.0511287798,project:function(u){var p=Math.PI/180,y=this.MAX_LATITUDE,C=Math.max(Math.min(y,u.lat),-y),k=Math.sin(C*p);return new O(this.R*u.lng*p,this.R*Math.log((1+k)/(1-k))/2)},unproject:function(u){var p=180/Math.PI;return new le((2*Math.atan(Math.exp(u.y/this.R))-Math.PI/2)*p,u.x*p/this.R)},bounds:function(){var u=Ee*Math.PI;return new te([-u,-u],[u,u])}()};function Me(u,p,y,C){if(b(u)){this._a=u[0],this._b=u[1],this._c=u[2],this._d=u[3];return}this._a=u,this._b=p,this._c=y,this._d=C}Me.prototype={transform:function(u,p){return this._transform(u.clone(),p)},_transform:function(u,p){return p=p||1,u.x=p*(this._a*u.x+this._b),u.y=p*(this._c*u.y+this._d),u},untransform:function(u,p){return p=p||1,new O((u.x/p-this._b)/this._a,(u.y/p-this._d)/this._c)}};function Qe(u,p,y,C){return new Me(u,p,y,C)}var ut=i({},Se,{code:"EPSG:3857",projection:Fe,transformation:function(){var u=.5/(Math.PI*Fe.R);return Qe(u,.5,-u,.5)}()}),Rt=i({},ut,{code:"EPSG:900913"});function dt(u){return document.createElementNS("http://www.w3.org/2000/svg",u)}function ot(u,p){var y="",C,k,N,M,Y,se;for(C=0,N=u.length;C<N;C++){for(Y=u[C],k=0,M=Y.length;k<M;k++)se=Y[k],y+=(k?"L":"M")+se.x+" "+se.y;y+=p?Ne.svg?"z":"x":""}return y||"M0 0"}var vt=document.documentElement.style,ft="ActiveXObject"in window,ki=ft&&!document.addEventListener,Jt="msLaunchUri"in navigator&&!("documentMode"in document),Qs=ir("webkit"),Kn=ir("android"),sr=ir("android 2")||ir("android 3"),Ms=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Si=Kn&&ir("Google")&&Ms<537&&!("AudioNode"in window),Js=!!window.opera,Ti=!Jt&&ir("chrome"),Ei=ir("gecko")&&!Qs&&!Js&&!ft,Ea=!Ti&&ir("safari"),sc=ir("phantom"),ic="OTransition"in vt,Dx=navigator.platform.indexOf("Win")===0,Na=ft&&"transition"in vt,Zu="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!sr,$p="MozPerspective"in vt,nU=!window.L_DISABLE_3D&&(Na||Zu||$p)&&!ic&&!sc,Yu=typeof orientation<"u"||ir("mobile"),sU=Yu&&Qs,iU=Yu&&Zu,kS=!window.PointerEvent&&window.MSPointerEvent,SS=!!(window.PointerEvent||kS),TS="ontouchstart"in window||!!window.TouchEvent,rU=!window.L_NO_TOUCH&&(TS||SS),oU=Yu&&Js,aU=Yu&&Ei,lU=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,cU=function(){var u=!1;try{var p=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("testPassiveEventSupport",d,p),window.removeEventListener("testPassiveEventSupport",d,p)}catch{}return u}(),uU=function(){return!!document.createElement("canvas").getContext}(),Px=!!(document.createElementNS&&dt("svg").createSVGRect),hU=!!Px&&function(){var u=document.createElement("div");return u.innerHTML="<svg/>",(u.firstChild&&u.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),dU=!Px&&function(){try{var u=document.createElement("div");u.innerHTML='<v:shape adj="1"/>';var p=u.firstChild;return p.style.behavior="url(#default#VML)",p&&typeof p.adj=="object"}catch{return!1}}(),fU=navigator.platform.indexOf("Mac")===0,pU=navigator.platform.indexOf("Linux")===0;function ir(u){return navigator.userAgent.toLowerCase().indexOf(u)>=0}var Ne={ie:ft,ielt9:ki,edge:Jt,webkit:Qs,android:Kn,android23:sr,androidStock:Si,opera:Js,chrome:Ti,gecko:Ei,safari:Ea,phantom:sc,opera12:ic,win:Dx,ie3d:Na,webkit3d:Zu,gecko3d:$p,any3d:nU,mobile:Yu,mobileWebkit:sU,mobileWebkit3d:iU,msPointer:kS,pointer:SS,touch:rU,touchNative:TS,mobileOpera:oU,mobileGecko:aU,retina:lU,passiveEvents:cU,canvas:uU,svg:Px,vml:dU,inlineSvg:hU,mac:fU,linux:pU},ES=Ne.msPointer?"MSPointerDown":"pointerdown",NS=Ne.msPointer?"MSPointerMove":"pointermove",$S=Ne.msPointer?"MSPointerUp":"pointerup",RS=Ne.msPointer?"MSPointerCancel":"pointercancel",Ox={touchstart:ES,touchmove:NS,touchend:$S,touchcancel:RS},AS={touchstart:_U,touchmove:Rp,touchend:Rp,touchcancel:Rp},rc={},DS=!1;function mU(u,p,y){return p==="touchstart"&&xU(),AS[p]?(y=AS[p].bind(this,y),u.addEventListener(Ox[p],y,!1),y):(console.warn("wrong event specified:",p),d)}function gU(u,p,y){if(!Ox[p]){console.warn("wrong event specified:",p);return}u.removeEventListener(Ox[p],y,!1)}function yU(u){rc[u.pointerId]=u}function vU(u){rc[u.pointerId]&&(rc[u.pointerId]=u)}function PS(u){delete rc[u.pointerId]}function xU(){DS||(document.addEventListener(ES,yU,!0),document.addEventListener(NS,vU,!0),document.addEventListener($S,PS,!0),document.addEventListener(RS,PS,!0),DS=!0)}function Rp(u,p){if(p.pointerType!==(p.MSPOINTER_TYPE_MOUSE||"mouse")){p.touches=[];for(var y in rc)p.touches.push(rc[y]);p.changedTouches=[p],u(p)}}function _U(u,p){p.MSPOINTER_TYPE_TOUCH&&p.pointerType===p.MSPOINTER_TYPE_TOUCH&&Fn(p),Rp(u,p)}function wU(u){var p={},y,C;for(C in u)y=u[C],p[C]=y&&y.bind?y.bind(u):y;return u=p,p.type="dblclick",p.detail=2,p.isTrusted=!1,p._simulated=!0,p}var bU=200;function CU(u,p){u.addEventListener("dblclick",p);var y=0,C;function k(N){if(N.detail!==1){C=N.detail;return}if(!(N.pointerType==="mouse"||N.sourceCapabilities&&!N.sourceCapabilities.firesTouchEvents)){var M=zS(N);if(!(M.some(function(se){return se instanceof HTMLLabelElement&&se.attributes.for})&&!M.some(function(se){return se instanceof HTMLInputElement||se instanceof HTMLSelectElement}))){var Y=Date.now();Y-y<=bU?(C++,C===2&&p(wU(N))):C=1,y=Y}}}return u.addEventListener("click",k),{dblclick:p,simDblclick:k}}function IU(u,p){u.removeEventListener("dblclick",p.dblclick),u.removeEventListener("click",p.simDblclick)}var Lx=Pp(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Qu=Pp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),OS=Qu==="webkitTransition"||Qu==="OTransition"?Qu+"End":"transitionend";function LS(u){return typeof u=="string"?document.getElementById(u):u}function Ju(u,p){var y=u.style[p]||u.currentStyle&&u.currentStyle[p];if((!y||y==="auto")&&document.defaultView){var C=document.defaultView.getComputedStyle(u,null);y=C?C[p]:null}return y==="auto"?null:y}function at(u,p,y){var C=document.createElement(u);return C.className=p||"",y&&y.appendChild(C),C}function Ut(u){var p=u.parentNode;p&&p.removeChild(u)}function Ap(u){for(;u.firstChild;)u.removeChild(u.firstChild)}function oc(u){var p=u.parentNode;p&&p.lastChild!==u&&p.appendChild(u)}function ac(u){var p=u.parentNode;p&&p.firstChild!==u&&p.insertBefore(u,p.firstChild)}function Fx(u,p){if(u.classList!==void 0)return u.classList.contains(p);var y=Dp(u);return y.length>0&&new RegExp("(^|\\s)"+p+"(\\s|$)").test(y)}function Ve(u,p){if(u.classList!==void 0)for(var y=g(p),C=0,k=y.length;C<k;C++)u.classList.add(y[C]);else if(!Fx(u,p)){var N=Dp(u);Mx(u,(N?N+" ":"")+p)}}function en(u,p){u.classList!==void 0?u.classList.remove(p):Mx(u,m((" "+Dp(u)+" ").replace(" "+p+" "," ")))}function Mx(u,p){u.className.baseVal===void 0?u.className=p:u.className.baseVal=p}function Dp(u){return u.correspondingElement&&(u=u.correspondingElement),u.className.baseVal===void 0?u.className:u.className.baseVal}function ei(u,p){"opacity"in u.style?u.style.opacity=p:"filter"in u.style&&kU(u,p)}function kU(u,p){var y=!1,C="DXImageTransform.Microsoft.Alpha";try{y=u.filters.item(C)}catch{if(p===1)return}p=Math.round(p*100),y?(y.Enabled=p!==100,y.Opacity=p):u.style.filter+=" progid:"+C+"(opacity="+p+")"}function Pp(u){for(var p=document.documentElement.style,y=0;y<u.length;y++)if(u[y]in p)return u[y];return!1}function $a(u,p,y){var C=p||new O(0,0);u.style[Lx]=(Ne.ie3d?"translate("+C.x+"px,"+C.y+"px)":"translate3d("+C.x+"px,"+C.y+"px,0)")+(y?" scale("+y+")":"")}function rn(u,p){u._leaflet_pos=p,Ne.any3d?$a(u,p):(u.style.left=p.x+"px",u.style.top=p.y+"px")}function Ra(u){return u._leaflet_pos||new O(0,0)}var eh,th,zx;if("onselectstart"in document)eh=function(){Be(window,"selectstart",Fn)},th=function(){kt(window,"selectstart",Fn)};else{var nh=Pp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);eh=function(){if(nh){var u=document.documentElement.style;zx=u[nh],u[nh]="none"}},th=function(){nh&&(document.documentElement.style[nh]=zx,zx=void 0)}}function Bx(){Be(window,"dragstart",Fn)}function Ux(){kt(window,"dragstart",Fn)}var Op,Wx;function Vx(u){for(;u.tabIndex===-1;)u=u.parentNode;u.style&&(Lp(),Op=u,Wx=u.style.outlineStyle,u.style.outlineStyle="none",Be(window,"keydown",Lp))}function Lp(){Op&&(Op.style.outlineStyle=Wx,Op=void 0,Wx=void 0,kt(window,"keydown",Lp))}function FS(u){do u=u.parentNode;while((!u.offsetWidth||!u.offsetHeight)&&u!==document.body);return u}function jx(u){var p=u.getBoundingClientRect();return{x:p.width/u.offsetWidth||1,y:p.height/u.offsetHeight||1,boundingClientRect:p}}var SU={__proto__:null,TRANSFORM:Lx,TRANSITION:Qu,TRANSITION_END:OS,get:LS,getStyle:Ju,create:at,remove:Ut,empty:Ap,toFront:oc,toBack:ac,hasClass:Fx,addClass:Ve,removeClass:en,setClass:Mx,getClass:Dp,setOpacity:ei,testProp:Pp,setTransform:$a,setPosition:rn,getPosition:Ra,get disableTextSelection(){return eh},get enableTextSelection(){return th},disableImageDrag:Bx,enableImageDrag:Ux,preventOutline:Vx,restoreOutline:Lp,getSizedParentNode:FS,getScale:jx};function Be(u,p,y,C){if(p&&typeof p=="object")for(var k in p)Hx(u,k,p[k],y);else{p=g(p);for(var N=0,M=p.length;N<M;N++)Hx(u,p[N],y,C)}return this}var rr="_leaflet_events";function kt(u,p,y,C){if(arguments.length===1)MS(u),delete u[rr];else if(p&&typeof p=="object")for(var k in p)qx(u,k,p[k],y);else if(p=g(p),arguments.length===2)MS(u,function(Y){return I(p,Y)!==-1});else for(var N=0,M=p.length;N<M;N++)qx(u,p[N],y,C);return this}function MS(u,p){for(var y in u[rr]){var C=y.split(/\d/)[0];(!p||p(C))&&qx(u,C,null,null,y)}}var Gx={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Hx(u,p,y,C){var k=p+l(y)+(C?"_"+l(C):"");if(u[rr]&&u[rr][k])return this;var N=function(Y){return y.call(C||u,Y||window.event)},M=N;!Ne.touchNative&&Ne.pointer&&p.indexOf("touch")===0?N=mU(u,p,N):Ne.touch&&p==="dblclick"?N=CU(u,N):"addEventListener"in u?p==="touchstart"||p==="touchmove"||p==="wheel"||p==="mousewheel"?u.addEventListener(Gx[p]||p,N,Ne.passiveEvents?{passive:!1}:!1):p==="mouseenter"||p==="mouseleave"?(N=function(Y){Y=Y||window.event,Xx(u,Y)&&M(Y)},u.addEventListener(Gx[p],N,!1)):u.addEventListener(p,M,!1):u.attachEvent("on"+p,N),u[rr]=u[rr]||{},u[rr][k]=N}function qx(u,p,y,C,k){k=k||p+l(y)+(C?"_"+l(C):"");var N=u[rr]&&u[rr][k];if(!N)return this;!Ne.touchNative&&Ne.pointer&&p.indexOf("touch")===0?gU(u,p,N):Ne.touch&&p==="dblclick"?IU(u,N):"removeEventListener"in u?u.removeEventListener(Gx[p]||p,N,!1):u.detachEvent("on"+p,N),u[rr][k]=null}function Aa(u){return u.stopPropagation?u.stopPropagation():u.originalEvent?u.originalEvent._stopped=!0:u.cancelBubble=!0,this}function Kx(u){return Hx(u,"wheel",Aa),this}function sh(u){return Be(u,"mousedown touchstart dblclick contextmenu",Aa),u._leaflet_disable_click=!0,this}function Fn(u){return u.preventDefault?u.preventDefault():u.returnValue=!1,this}function Da(u){return Fn(u),Aa(u),this}function zS(u){if(u.composedPath)return u.composedPath();for(var p=[],y=u.target;y;)p.push(y),y=y.parentNode;return p}function BS(u,p){if(!p)return new O(u.clientX,u.clientY);var y=jx(p),C=y.boundingClientRect;return new O((u.clientX-C.left)/y.x-p.clientLeft,(u.clientY-C.top)/y.y-p.clientTop)}var TU=Ne.linux&&Ne.chrome?window.devicePixelRatio:Ne.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function US(u){return Ne.edge?u.wheelDeltaY/2:u.deltaY&&u.deltaMode===0?-u.deltaY/TU:u.deltaY&&u.deltaMode===1?-u.deltaY*20:u.deltaY&&u.deltaMode===2?-u.deltaY*60:u.deltaX||u.deltaZ?0:u.wheelDelta?(u.wheelDeltaY||u.wheelDelta)/2:u.detail&&Math.abs(u.detail)<32765?-u.detail*20:u.detail?u.detail/-32765*60:0}function Xx(u,p){var y=p.relatedTarget;if(!y)return!0;try{for(;y&&y!==u;)y=y.parentNode}catch{return!1}return y!==u}var EU={__proto__:null,on:Be,off:kt,stopPropagation:Aa,disableScrollPropagation:Kx,disableClickPropagation:sh,preventDefault:Fn,stop:Da,getPropagationPath:zS,getMousePosition:BS,getWheelDelta:US,isExternalTarget:Xx,addListener:Be,removeListener:kt},WS=oe.extend({run:function(u,p,y,C){this.stop(),this._el=u,this._inProgress=!0,this._duration=y||.25,this._easeOutPower=1/Math.max(C||.5,.2),this._startPos=Ra(u),this._offset=p.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=z(this._animate,this),this._step()},_step:function(u){var p=+new Date-this._startTime,y=this._duration*1e3;p<y?this._runFrame(this._easeOut(p/y),u):(this._runFrame(1),this._complete())},_runFrame:function(u,p){var y=this._startPos.add(this._offset.multiplyBy(u));p&&y._round(),rn(this._el,y),this.fire("step")},_complete:function(){V(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(u){return 1-Math.pow(1-u,this._easeOutPower)}}),nt=oe.extend({options:{crs:ut,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(u,p){p=x(this,p),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(u),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),p.maxBounds&&this.setMaxBounds(p.maxBounds),p.zoom!==void 0&&(this._zoom=this._limitZoom(p.zoom)),p.center&&p.zoom!==void 0&&this.setView(ce(p.center),p.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Qu&&Ne.any3d&&!Ne.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Be(this._proxy,OS,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(u,p,y){if(p=p===void 0?this._zoom:this._limitZoom(p),u=this._limitCenter(ce(u),p,this.options.maxBounds),y=y||{},this._stop(),this._loaded&&!y.reset&&y!==!0){y.animate!==void 0&&(y.zoom=i({animate:y.animate},y.zoom),y.pan=i({animate:y.animate,duration:y.duration},y.pan));var C=this._zoom!==p?this._tryAnimatedZoom&&this._tryAnimatedZoom(u,p,y.zoom):this._tryAnimatedPan(u,y.pan);if(C)return clearTimeout(this._sizeTimer),this}return this._resetView(u,p,y.pan&&y.pan.noMoveStart),this},setZoom:function(u,p){return this._loaded?this.setView(this.getCenter(),u,{zoom:p}):(this._zoom=u,this)},zoomIn:function(u,p){return u=u||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+u,p)},zoomOut:function(u,p){return u=u||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-u,p)},setZoomAround:function(u,p,y){var C=this.getZoomScale(p),k=this.getSize().divideBy(2),N=u instanceof O?u:this.latLngToContainerPoint(u),M=N.subtract(k).multiplyBy(1-1/C),Y=this.containerPointToLatLng(k.add(M));return this.setView(Y,p,{zoom:y})},_getBoundsCenterZoom:function(u,p){p=p||{},u=u.getBounds?u.getBounds():he(u);var y=j(p.paddingTopLeft||p.padding||[0,0]),C=j(p.paddingBottomRight||p.padding||[0,0]),k=this.getBoundsZoom(u,!1,y.add(C));if(k=typeof p.maxZoom=="number"?Math.min(p.maxZoom,k):k,k===1/0)return{center:u.getCenter(),zoom:k};var N=C.subtract(y).divideBy(2),M=this.project(u.getSouthWest(),k),Y=this.project(u.getNorthEast(),k),se=this.unproject(M.add(Y).divideBy(2).add(N),k);return{center:se,zoom:k}},fitBounds:function(u,p){if(u=he(u),!u.isValid())throw new Error("Bounds are not valid.");var y=this._getBoundsCenterZoom(u,p);return this.setView(y.center,y.zoom,p)},fitWorld:function(u){return this.fitBounds([[-90,-180],[90,180]],u)},panTo:function(u,p){return this.setView(u,this._zoom,{pan:p})},panBy:function(u,p){if(u=j(u).round(),p=p||{},!u.x&&!u.y)return this.fire("moveend");if(p.animate!==!0&&!this.getSize().contains(u))return this._resetView(this.unproject(this.project(this.getCenter()).add(u)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new WS,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),p.noMoveStart||this.fire("movestart"),p.animate!==!1){Ve(this._mapPane,"leaflet-pan-anim");var y=this._getMapPanePos().subtract(u).round();this._panAnim.run(this._mapPane,y,p.duration||.25,p.easeLinearity)}else this._rawPanBy(u),this.fire("move").fire("moveend");return this},flyTo:function(u,p,y){if(y=y||{},y.animate===!1||!Ne.any3d)return this.setView(u,p,y);this._stop();var C=this.project(this.getCenter()),k=this.project(u),N=this.getSize(),M=this._zoom;u=ce(u),p=p===void 0?M:p;var Y=Math.max(N.x,N.y),se=Y*this.getZoomScale(M,p),fe=k.distanceTo(C)||1,be=1.42,Pe=be*be;function qe(on){var Kp=on?-1:1,gW=on?se:Y,yW=se*se-Y*Y+Kp*Pe*Pe*fe*fe,vW=2*gW*Pe*fe,o_=yW/vW,bT=Math.sqrt(o_*o_+1)-o_,xW=bT<1e-9?-18:Math.log(bT);return xW}function os(on){return(Math.exp(on)-Math.exp(-on))/2}function kn(on){return(Math.exp(on)+Math.exp(-on))/2}function ni(on){return os(on)/kn(on)}var xs=qe(0);function fc(on){return Y*(kn(xs)/kn(xs+be*on))}function dW(on){return Y*(kn(xs)*ni(xs+be*on)-os(xs))/Pe}function fW(on){return 1-Math.pow(1-on,1.5)}var pW=Date.now(),_T=(qe(1)-xs)/be,mW=y.duration?1e3*y.duration:1e3*_T*.8;function wT(){var on=(Date.now()-pW)/mW,Kp=fW(on)*_T;on<=1?(this._flyToFrame=z(wT,this),this._move(this.unproject(C.add(k.subtract(C).multiplyBy(dW(Kp)/fe)),M),this.getScaleZoom(Y/fc(Kp),M),{flyTo:!0})):this._move(u,p)._moveEnd(!0)}return this._moveStart(!0,y.noMoveStart),wT.call(this),this},flyToBounds:function(u,p){var y=this._getBoundsCenterZoom(u,p);return this.flyTo(y.center,y.zoom,p)},setMaxBounds:function(u){return u=he(u),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),u.isValid()?(this.options.maxBounds=u,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(u){var p=this.options.minZoom;return this.options.minZoom=u,this._loaded&&p!==u&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(u):this},setMaxZoom:function(u){var p=this.options.maxZoom;return this.options.maxZoom=u,this._loaded&&p!==u&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(u):this},panInsideBounds:function(u,p){this._enforcingBounds=!0;var y=this.getCenter(),C=this._limitCenter(y,this._zoom,he(u));return y.equals(C)||this.panTo(C,p),this._enforcingBounds=!1,this},panInside:function(u,p){p=p||{};var y=j(p.paddingTopLeft||p.padding||[0,0]),C=j(p.paddingBottomRight||p.padding||[0,0]),k=this.project(this.getCenter()),N=this.project(u),M=this.getPixelBounds(),Y=ae([M.min.add(y),M.max.subtract(C)]),se=Y.getSize();if(!Y.contains(N)){this._enforcingBounds=!0;var fe=N.subtract(Y.getCenter()),be=Y.extend(N).getSize().subtract(se);k.x+=fe.x<0?-be.x:be.x,k.y+=fe.y<0?-be.y:be.y,this.panTo(this.unproject(k),p),this._enforcingBounds=!1}return this},invalidateSize:function(u){if(!this._loaded)return this;u=i({animate:!1,pan:!0},u===!0?{animate:!0}:u);var p=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var y=this.getSize(),C=p.divideBy(2).round(),k=y.divideBy(2).round(),N=C.subtract(k);return!N.x&&!N.y?this:(u.animate&&u.pan?this.panBy(N):(u.pan&&this._rawPanBy(N),this.fire("move"),u.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:p,newSize:y}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(u){if(u=this._locateOptions=i({timeout:1e4,watch:!1},u),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var p=o(this._handleGeolocationResponse,this),y=o(this._handleGeolocationError,this);return u.watch?this._locationWatchId=navigator.geolocation.watchPosition(p,y,u):navigator.geolocation.getCurrentPosition(p,y,u),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(u){if(this._container._leaflet_id){var p=u.code,y=u.message||(p===1?"permission denied":p===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:p,message:"Geolocation error: "+y+"."})}},_handleGeolocationResponse:function(u){if(this._container._leaflet_id){var p=u.coords.latitude,y=u.coords.longitude,C=new le(p,y),k=C.toBounds(u.coords.accuracy*2),N=this._locateOptions;if(N.setView){var M=this.getBoundsZoom(k);this.setView(C,N.maxZoom?Math.min(M,N.maxZoom):M)}var Y={latlng:C,bounds:k,timestamp:u.timestamp};for(var se in u.coords)typeof u.coords[se]=="number"&&(Y[se]=u.coords[se]);this.fire("locationfound",Y)}},addHandler:function(u,p){if(!p)return this;var y=this[u]=new p(this);return this._handlers.push(y),this.options[u]&&y.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ut(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(V(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var u;for(u in this._layers)this._layers[u].remove();for(u in this._panes)Ut(this._panes[u]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(u,p){var y="leaflet-pane"+(u?" leaflet-"+u.replace("Pane","")+"-pane":""),C=at("div",y,p||this._mapPane);return u&&(this._panes[u]=C),C},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var u=this.getPixelBounds(),p=this.unproject(u.getBottomLeft()),y=this.unproject(u.getTopRight());return new ue(p,y)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(u,p,y){u=he(u),y=j(y||[0,0]);var C=this.getZoom()||0,k=this.getMinZoom(),N=this.getMaxZoom(),M=u.getNorthWest(),Y=u.getSouthEast(),se=this.getSize().subtract(y),fe=ae(this.project(Y,C),this.project(M,C)).getSize(),be=Ne.any3d?this.options.zoomSnap:1,Pe=se.x/fe.x,qe=se.y/fe.y,os=p?Math.max(Pe,qe):Math.min(Pe,qe);return C=this.getScaleZoom(os,C),be&&(C=Math.round(C/(be/100))*(be/100),C=p?Math.ceil(C/be)*be:Math.floor(C/be)*be),Math.max(k,Math.min(N,C))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(u,p){var y=this._getTopLeftPoint(u,p);return new te(y,y.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(u){return this.options.crs.getProjectedBounds(u===void 0?this.getZoom():u)},getPane:function(u){return typeof u=="string"?this._panes[u]:u},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(u,p){var y=this.options.crs;return p=p===void 0?this._zoom:p,y.scale(u)/y.scale(p)},getScaleZoom:function(u,p){var y=this.options.crs;p=p===void 0?this._zoom:p;var C=y.zoom(u*y.scale(p));return isNaN(C)?1/0:C},project:function(u,p){return p=p===void 0?this._zoom:p,this.options.crs.latLngToPoint(ce(u),p)},unproject:function(u,p){return p=p===void 0?this._zoom:p,this.options.crs.pointToLatLng(j(u),p)},layerPointToLatLng:function(u){var p=j(u).add(this.getPixelOrigin());return this.unproject(p)},latLngToLayerPoint:function(u){var p=this.project(ce(u))._round();return p._subtract(this.getPixelOrigin())},wrapLatLng:function(u){return this.options.crs.wrapLatLng(ce(u))},wrapLatLngBounds:function(u){return this.options.crs.wrapLatLngBounds(he(u))},distance:function(u,p){return this.options.crs.distance(ce(u),ce(p))},containerPointToLayerPoint:function(u){return j(u).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(u){return j(u).add(this._getMapPanePos())},containerPointToLatLng:function(u){var p=this.containerPointToLayerPoint(j(u));return this.layerPointToLatLng(p)},latLngToContainerPoint:function(u){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ce(u)))},mouseEventToContainerPoint:function(u){return BS(u,this._container)},mouseEventToLayerPoint:function(u){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(u))},mouseEventToLatLng:function(u){return this.layerPointToLatLng(this.mouseEventToLayerPoint(u))},_initContainer:function(u){var p=this._container=LS(u);if(p){if(p._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Be(p,"scroll",this._onScroll,this),this._containerId=l(p)},_initLayout:function(){var u=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ne.any3d,Ve(u,"leaflet-container"+(Ne.touch?" leaflet-touch":"")+(Ne.retina?" leaflet-retina":"")+(Ne.ielt9?" leaflet-oldie":"")+(Ne.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var p=Ju(u,"position");p!=="absolute"&&p!=="relative"&&p!=="fixed"&&p!=="sticky"&&(u.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var u=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),rn(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ve(u.markerPane,"leaflet-zoom-hide"),Ve(u.shadowPane,"leaflet-zoom-hide"))},_resetView:function(u,p,y){rn(this._mapPane,new O(0,0));var C=!this._loaded;this._loaded=!0,p=this._limitZoom(p),this.fire("viewprereset");var k=this._zoom!==p;this._moveStart(k,y)._move(u,p)._moveEnd(k),this.fire("viewreset"),C&&this.fire("load")},_moveStart:function(u,p){return u&&this.fire("zoomstart"),p||this.fire("movestart"),this},_move:function(u,p,y,C){p===void 0&&(p=this._zoom);var k=this._zoom!==p;return this._zoom=p,this._lastCenter=u,this._pixelOrigin=this._getNewPixelOrigin(u),C?y&&y.pinch&&this.fire("zoom",y):((k||y&&y.pinch)&&this.fire("zoom",y),this.fire("move",y)),this},_moveEnd:function(u){return u&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return V(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(u){rn(this._mapPane,this._getMapPanePos().subtract(u))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(u){this._targets={},this._targets[l(this._container)]=this;var p=u?kt:Be;p(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&p(window,"resize",this._onResize,this),Ne.any3d&&this.options.transform3DLimit&&(u?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){V(this._resizeRequest),this._resizeRequest=z(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var u=this._getMapPanePos();Math.max(Math.abs(u.x),Math.abs(u.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(u,p){for(var y=[],C,k=p==="mouseout"||p==="mouseover",N=u.target||u.srcElement,M=!1;N;){if(C=this._targets[l(N)],C&&(p==="click"||p==="preclick")&&this._draggableMoved(C)){M=!0;break}if(C&&C.listens(p,!0)&&(k&&!Xx(N,u)||(y.push(C),k))||N===this._container)break;N=N.parentNode}return!y.length&&!M&&!k&&this.listens(p,!0)&&(y=[this]),y},_isClickDisabled:function(u){for(;u&&u!==this._container;){if(u._leaflet_disable_click)return!0;u=u.parentNode}},_handleDOMEvent:function(u){var p=u.target||u.srcElement;if(!(!this._loaded||p._leaflet_disable_events||u.type==="click"&&this._isClickDisabled(p))){var y=u.type;y==="mousedown"&&Vx(p),this._fireDOMEvent(u,y)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(u,p,y){if(u.type==="click"){var C=i({},u);C.type="preclick",this._fireDOMEvent(C,C.type,y)}var k=this._findEventTargets(u,p);if(y){for(var N=[],M=0;M<y.length;M++)y[M].listens(p,!0)&&N.push(y[M]);k=N.concat(k)}if(k.length){p==="contextmenu"&&Fn(u);var Y=k[0],se={originalEvent:u};if(u.type!=="keypress"&&u.type!=="keydown"&&u.type!=="keyup"){var fe=Y.getLatLng&&(!Y._radius||Y._radius<=10);se.containerPoint=fe?this.latLngToContainerPoint(Y.getLatLng()):this.mouseEventToContainerPoint(u),se.layerPoint=this.containerPointToLayerPoint(se.containerPoint),se.latlng=fe?Y.getLatLng():this.layerPointToLatLng(se.layerPoint)}for(M=0;M<k.length;M++)if(k[M].fire(p,se,!0),se.originalEvent._stopped||k[M].options.bubblingMouseEvents===!1&&I(this._mouseEvents,p)!==-1)return}},_draggableMoved:function(u){return u=u.dragging&&u.dragging.enabled()?u:this,u.dragging&&u.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var u=0,p=this._handlers.length;u<p;u++)this._handlers[u].disable()},whenReady:function(u,p){return this._loaded?u.call(p||this,{target:this}):this.on("load",u,p),this},_getMapPanePos:function(){return Ra(this._mapPane)||new O(0,0)},_moved:function(){var u=this._getMapPanePos();return u&&!u.equals([0,0])},_getTopLeftPoint:function(u,p){var y=u&&p!==void 0?this._getNewPixelOrigin(u,p):this.getPixelOrigin();return y.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(u,p){var y=this.getSize()._divideBy(2);return this.project(u,p)._subtract(y)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(u,p,y){var C=this._getNewPixelOrigin(y,p);return this.project(u,p)._subtract(C)},_latLngBoundsToNewLayerBounds:function(u,p,y){var C=this._getNewPixelOrigin(y,p);return ae([this.project(u.getSouthWest(),p)._subtract(C),this.project(u.getNorthWest(),p)._subtract(C),this.project(u.getSouthEast(),p)._subtract(C),this.project(u.getNorthEast(),p)._subtract(C)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(u){return this.latLngToLayerPoint(u).subtract(this._getCenterLayerPoint())},_limitCenter:function(u,p,y){if(!y)return u;var C=this.project(u,p),k=this.getSize().divideBy(2),N=new te(C.subtract(k),C.add(k)),M=this._getBoundsOffset(N,y,p);return Math.abs(M.x)<=1&&Math.abs(M.y)<=1?u:this.unproject(C.add(M),p)},_limitOffset:function(u,p){if(!p)return u;var y=this.getPixelBounds(),C=new te(y.min.add(u),y.max.add(u));return u.add(this._getBoundsOffset(C,p))},_getBoundsOffset:function(u,p,y){var C=ae(this.project(p.getNorthEast(),y),this.project(p.getSouthWest(),y)),k=C.min.subtract(u.min),N=C.max.subtract(u.max),M=this._rebound(k.x,-N.x),Y=this._rebound(k.y,-N.y);return new O(M,Y)},_rebound:function(u,p){return u+p>0?Math.round(u-p)/2:Math.max(0,Math.ceil(u))-Math.max(0,Math.floor(p))},_limitZoom:function(u){var p=this.getMinZoom(),y=this.getMaxZoom(),C=Ne.any3d?this.options.zoomSnap:1;return C&&(u=Math.round(u/C)*C),Math.max(p,Math.min(y,u))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){en(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(u,p){var y=this._getCenterOffset(u)._trunc();return(p&&p.animate)!==!0&&!this.getSize().contains(y)?!1:(this.panBy(y,p),!0)},_createAnimProxy:function(){var u=this._proxy=at("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(u),this.on("zoomanim",function(p){var y=Lx,C=this._proxy.style[y];$a(this._proxy,this.project(p.center,p.zoom),this.getZoomScale(p.zoom,1)),C===this._proxy.style[y]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ut(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var u=this.getCenter(),p=this.getZoom();$a(this._proxy,this.project(u,p),this.getZoomScale(p,1))},_catchTransitionEnd:function(u){this._animatingZoom&&u.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(u,p,y){if(this._animatingZoom)return!0;if(y=y||{},!this._zoomAnimated||y.animate===!1||this._nothingToAnimate()||Math.abs(p-this._zoom)>this.options.zoomAnimationThreshold)return!1;var C=this.getZoomScale(p),k=this._getCenterOffset(u)._divideBy(1-1/C);return y.animate!==!0&&!this.getSize().contains(k)?!1:(z(function(){this._moveStart(!0,y.noMoveStart||!1)._animateZoom(u,p,!0)},this),!0)},_animateZoom:function(u,p,y,C){this._mapPane&&(y&&(this._animatingZoom=!0,this._animateToCenter=u,this._animateToZoom=p,Ve(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:u,zoom:p,noUpdate:C}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&en(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function NU(u,p){return new nt(u,p)}var Ni=K.extend({options:{position:"topright"},initialize:function(u){x(this,u)},getPosition:function(){return this.options.position},setPosition:function(u){var p=this._map;return p&&p.removeControl(this),this.options.position=u,p&&p.addControl(this),this},getContainer:function(){return this._container},addTo:function(u){this.remove(),this._map=u;var p=this._container=this.onAdd(u),y=this.getPosition(),C=u._controlCorners[y];return Ve(p,"leaflet-control"),y.indexOf("bottom")!==-1?C.insertBefore(p,C.firstChild):C.appendChild(p),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ut(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(u){this._map&&u&&u.screenX>0&&u.screenY>0&&this._map.getContainer().focus()}}),ih=function(u){return new Ni(u)};nt.include({addControl:function(u){return u.addTo(this),this},removeControl:function(u){return u.remove(),this},_initControlPos:function(){var u=this._controlCorners={},p="leaflet-",y=this._controlContainer=at("div",p+"control-container",this._container);function C(k,N){var M=p+k+" "+p+N;u[k+N]=at("div",M,y)}C("top","left"),C("top","right"),C("bottom","left"),C("bottom","right")},_clearControlPos:function(){for(var u in this._controlCorners)Ut(this._controlCorners[u]);Ut(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var VS=Ni.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(u,p,y,C){return y<C?-1:C<y?1:0}},initialize:function(u,p,y){x(this,y),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var C in u)this._addLayer(u[C],C);for(C in p)this._addLayer(p[C],C,!0)},onAdd:function(u){this._initLayout(),this._update(),this._map=u,u.on("zoomend",this._checkDisabledLayers,this);for(var p=0;p<this._layers.length;p++)this._layers[p].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(u){return Ni.prototype.addTo.call(this,u),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var u=0;u<this._layers.length;u++)this._layers[u].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(u,p){return this._addLayer(u,p),this._map?this._update():this},addOverlay:function(u,p){return this._addLayer(u,p,!0),this._map?this._update():this},removeLayer:function(u){u.off("add remove",this._onLayerChange,this);var p=this._getLayer(l(u));return p&&this._layers.splice(this._layers.indexOf(p),1),this._map?this._update():this},expand:function(){Ve(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var u=this._map.getSize().y-(this._container.offsetTop+50);return u<this._section.clientHeight?(Ve(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=u+"px"):en(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return en(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var u="leaflet-control-layers",p=this._container=at("div",u),y=this.options.collapsed;p.setAttribute("aria-haspopup",!0),sh(p),Kx(p);var C=this._section=at("section",u+"-list");y&&(this._map.on("click",this.collapse,this),Be(p,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var k=this._layersLink=at("a",u+"-toggle",p);k.href="#",k.title="Layers",k.setAttribute("role","button"),Be(k,{keydown:function(N){N.keyCode===13&&this._expandSafely()},click:function(N){Fn(N),this._expandSafely()}},this),y||this.expand(),this._baseLayersList=at("div",u+"-base",C),this._separator=at("div",u+"-separator",C),this._overlaysList=at("div",u+"-overlays",C),p.appendChild(C)},_getLayer:function(u){for(var p=0;p<this._layers.length;p++)if(this._layers[p]&&l(this._layers[p].layer)===u)return this._layers[p]},_addLayer:function(u,p,y){this._map&&u.on("add remove",this._onLayerChange,this),this._layers.push({layer:u,name:p,overlay:y}),this.options.sortLayers&&this._layers.sort(o(function(C,k){return this.options.sortFunction(C.layer,k.layer,C.name,k.name)},this)),this.options.autoZIndex&&u.setZIndex&&(this._lastZIndex++,u.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ap(this._baseLayersList),Ap(this._overlaysList),this._layerControlInputs=[];var u,p,y,C,k=0;for(y=0;y<this._layers.length;y++)C=this._layers[y],this._addItem(C),p=p||C.overlay,u=u||!C.overlay,k+=C.overlay?0:1;return this.options.hideSingleBase&&(u=u&&k>1,this._baseLayersList.style.display=u?"":"none"),this._separator.style.display=p&&u?"":"none",this},_onLayerChange:function(u){this._handlingClick||this._update();var p=this._getLayer(l(u.target)),y=p.overlay?u.type==="add"?"overlayadd":"overlayremove":u.type==="add"?"baselayerchange":null;y&&this._map.fire(y,p)},_createRadioElement:function(u,p){var y='<input type="radio" class="leaflet-control-layers-selector" name="'+u+'"'+(p?' checked="checked"':"")+"/>",C=document.createElement("div");return C.innerHTML=y,C.firstChild},_addItem:function(u){var p=document.createElement("label"),y=this._map.hasLayer(u.layer),C;u.overlay?(C=document.createElement("input"),C.type="checkbox",C.className="leaflet-control-layers-selector",C.defaultChecked=y):C=this._createRadioElement("leaflet-base-layers_"+l(this),y),this._layerControlInputs.push(C),C.layerId=l(u.layer),Be(C,"click",this._onInputClick,this);var k=document.createElement("span");k.innerHTML=" "+u.name;var N=document.createElement("span");p.appendChild(N),N.appendChild(C),N.appendChild(k);var M=u.overlay?this._overlaysList:this._baseLayersList;return M.appendChild(p),this._checkDisabledLayers(),p},_onInputClick:function(){if(!this._preventClick){var u=this._layerControlInputs,p,y,C=[],k=[];this._handlingClick=!0;for(var N=u.length-1;N>=0;N--)p=u[N],y=this._getLayer(p.layerId).layer,p.checked?C.push(y):p.checked||k.push(y);for(N=0;N<k.length;N++)this._map.hasLayer(k[N])&&this._map.removeLayer(k[N]);for(N=0;N<C.length;N++)this._map.hasLayer(C[N])||this._map.addLayer(C[N]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var u=this._layerControlInputs,p,y,C=this._map.getZoom(),k=u.length-1;k>=0;k--)p=u[k],y=this._getLayer(p.layerId).layer,p.disabled=y.options.minZoom!==void 0&&C<y.options.minZoom||y.options.maxZoom!==void 0&&C>y.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var u=this._section;this._preventClick=!0,Be(u,"click",Fn),this.expand();var p=this;setTimeout(function(){kt(u,"click",Fn),p._preventClick=!1})}}),$U=function(u,p,y){return new VS(u,p,y)},Zx=Ni.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(u){var p="leaflet-control-zoom",y=at("div",p+" leaflet-bar"),C=this.options;return this._zoomInButton=this._createButton(C.zoomInText,C.zoomInTitle,p+"-in",y,this._zoomIn),this._zoomOutButton=this._createButton(C.zoomOutText,C.zoomOutTitle,p+"-out",y,this._zoomOut),this._updateDisabled(),u.on("zoomend zoomlevelschange",this._updateDisabled,this),y},onRemove:function(u){u.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(u){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(u.shiftKey?3:1))},_zoomOut:function(u){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(u.shiftKey?3:1))},_createButton:function(u,p,y,C,k){var N=at("a",y,C);return N.innerHTML=u,N.href="#",N.title=p,N.setAttribute("role","button"),N.setAttribute("aria-label",p),sh(N),Be(N,"click",Da),Be(N,"click",k,this),Be(N,"click",this._refocusOnMap,this),N},_updateDisabled:function(){var u=this._map,p="leaflet-disabled";en(this._zoomInButton,p),en(this._zoomOutButton,p),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||u._zoom===u.getMinZoom())&&(Ve(this._zoomOutButton,p),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||u._zoom===u.getMaxZoom())&&(Ve(this._zoomInButton,p),this._zoomInButton.setAttribute("aria-disabled","true"))}});nt.mergeOptions({zoomControl:!0}),nt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Zx,this.addControl(this.zoomControl))});var RU=function(u){return new Zx(u)},jS=Ni.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(u){var p="leaflet-control-scale",y=at("div",p),C=this.options;return this._addScales(C,p+"-line",y),u.on(C.updateWhenIdle?"moveend":"move",this._update,this),u.whenReady(this._update,this),y},onRemove:function(u){u.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(u,p,y){u.metric&&(this._mScale=at("div",p,y)),u.imperial&&(this._iScale=at("div",p,y))},_update:function(){var u=this._map,p=u.getSize().y/2,y=u.distance(u.containerPointToLatLng([0,p]),u.containerPointToLatLng([this.options.maxWidth,p]));this._updateScales(y)},_updateScales:function(u){this.options.metric&&u&&this._updateMetric(u),this.options.imperial&&u&&this._updateImperial(u)},_updateMetric:function(u){var p=this._getRoundNum(u),y=p<1e3?p+" m":p/1e3+" km";this._updateScale(this._mScale,y,p/u)},_updateImperial:function(u){var p=u*3.2808399,y,C,k;p>5280?(y=p/5280,C=this._getRoundNum(y),this._updateScale(this._iScale,C+" mi",C/y)):(k=this._getRoundNum(p),this._updateScale(this._iScale,k+" ft",k/p))},_updateScale:function(u,p,y){u.style.width=Math.round(this.options.maxWidth*y)+"px",u.innerHTML=p},_getRoundNum:function(u){var p=Math.pow(10,(Math.floor(u)+"").length-1),y=u/p;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,p*y}}),AU=function(u){return new jS(u)},DU='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Yx=Ni.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ne.inlineSvg?DU+" ":"")+"Leaflet</a>"},initialize:function(u){x(this,u),this._attributions={}},onAdd:function(u){u.attributionControl=this,this._container=at("div","leaflet-control-attribution"),sh(this._container);for(var p in u._layers)u._layers[p].getAttribution&&this.addAttribution(u._layers[p].getAttribution());return this._update(),u.on("layeradd",this._addAttribution,this),this._container},onRemove:function(u){u.off("layeradd",this._addAttribution,this)},_addAttribution:function(u){u.layer.getAttribution&&(this.addAttribution(u.layer.getAttribution()),u.layer.once("remove",function(){this.removeAttribution(u.layer.getAttribution())},this))},setPrefix:function(u){return this.options.prefix=u,this._update(),this},addAttribution:function(u){return u?(this._attributions[u]||(this._attributions[u]=0),this._attributions[u]++,this._update(),this):this},removeAttribution:function(u){return u?(this._attributions[u]&&(this._attributions[u]--,this._update()),this):this},_update:function(){if(this._map){var u=[];for(var p in this._attributions)this._attributions[p]&&u.push(p);var y=[];this.options.prefix&&y.push(this.options.prefix),u.length&&y.push(u.join(", ")),this._container.innerHTML=y.join(' <span aria-hidden="true">|</span> ')}}});nt.mergeOptions({attributionControl:!0}),nt.addInitHook(function(){this.options.attributionControl&&new Yx().addTo(this)});var PU=function(u){return new Yx(u)};Ni.Layers=VS,Ni.Zoom=Zx,Ni.Scale=jS,Ni.Attribution=Yx,ih.layers=$U,ih.zoom=RU,ih.scale=AU,ih.attribution=PU;var or=K.extend({initialize:function(u){this._map=u},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});or.addTo=function(u,p){return u.addHandler(p,this),this};var OU={Events:X},GS=Ne.touch?"touchstart mousedown":"mousedown",vo=oe.extend({options:{clickTolerance:3},initialize:function(u,p,y,C){x(this,C),this._element=u,this._dragStartTarget=p||u,this._preventOutline=y},enable:function(){this._enabled||(Be(this._dragStartTarget,GS,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(vo._dragging===this&&this.finishDrag(!0),kt(this._dragStartTarget,GS,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(u){if(this._enabled&&(this._moved=!1,!Fx(this._element,"leaflet-zoom-anim"))){if(u.touches&&u.touches.length!==1){vo._dragging===this&&this.finishDrag();return}if(!(vo._dragging||u.shiftKey||u.which!==1&&u.button!==1&&!u.touches)&&(vo._dragging=this,this._preventOutline&&Vx(this._element),Bx(),eh(),!this._moving)){this.fire("down");var p=u.touches?u.touches[0]:u,y=FS(this._element);this._startPoint=new O(p.clientX,p.clientY),this._startPos=Ra(this._element),this._parentScale=jx(y);var C=u.type==="mousedown";Be(document,C?"mousemove":"touchmove",this._onMove,this),Be(document,C?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(u){if(this._enabled){if(u.touches&&u.touches.length>1){this._moved=!0;return}var p=u.touches&&u.touches.length===1?u.touches[0]:u,y=new O(p.clientX,p.clientY)._subtract(this._startPoint);!y.x&&!y.y||Math.abs(y.x)+Math.abs(y.y)<this.options.clickTolerance||(y.x/=this._parentScale.x,y.y/=this._parentScale.y,Fn(u),this._moved||(this.fire("dragstart"),this._moved=!0,Ve(document.body,"leaflet-dragging"),this._lastTarget=u.target||u.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ve(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(y),this._moving=!0,this._lastEvent=u,this._updatePosition())}},_updatePosition:function(){var u={originalEvent:this._lastEvent};this.fire("predrag",u),rn(this._element,this._newPos),this.fire("drag",u)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(u){en(document.body,"leaflet-dragging"),this._lastTarget&&(en(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),kt(document,"mousemove touchmove",this._onMove,this),kt(document,"mouseup touchend touchcancel",this._onUp,this),Ux(),th();var p=this._moved&&this._moving;this._moving=!1,vo._dragging=!1,p&&this.fire("dragend",{noInertia:u,distance:this._newPos.distanceTo(this._startPos)})}});function HS(u,p,y){var C,k=[1,4,2,8],N,M,Y,se,fe,be,Pe,qe;for(N=0,be=u.length;N<be;N++)u[N]._code=Pa(u[N],p);for(Y=0;Y<4;Y++){for(Pe=k[Y],C=[],N=0,be=u.length,M=be-1;N<be;M=N++)se=u[N],fe=u[M],se._code&Pe?fe._code&Pe||(qe=Fp(fe,se,Pe,p,y),qe._code=Pa(qe,p),C.push(qe)):(fe._code&Pe&&(qe=Fp(fe,se,Pe,p,y),qe._code=Pa(qe,p),C.push(qe)),C.push(se));u=C}return u}function qS(u,p){var y,C,k,N,M,Y,se,fe,be;if(!u||u.length===0)throw new Error("latlngs not passed");ti(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var Pe=ce([0,0]),qe=he(u),os=qe.getNorthWest().distanceTo(qe.getSouthWest())*qe.getNorthEast().distanceTo(qe.getNorthWest());os<1700&&(Pe=Qx(u));var kn=u.length,ni=[];for(y=0;y<kn;y++){var xs=ce(u[y]);ni.push(p.project(ce([xs.lat-Pe.lat,xs.lng-Pe.lng])))}for(Y=se=fe=0,y=0,C=kn-1;y<kn;C=y++)k=ni[y],N=ni[C],M=k.y*N.x-N.y*k.x,se+=(k.x+N.x)*M,fe+=(k.y+N.y)*M,Y+=M*3;Y===0?be=ni[0]:be=[se/Y,fe/Y];var fc=p.unproject(j(be));return ce([fc.lat+Pe.lat,fc.lng+Pe.lng])}function Qx(u){for(var p=0,y=0,C=0,k=0;k<u.length;k++){var N=ce(u[k]);p+=N.lat,y+=N.lng,C++}return ce([p/C,y/C])}var LU={__proto__:null,clipPolygon:HS,polygonCenter:qS,centroid:Qx};function KS(u,p){if(!p||!u.length)return u.slice();var y=p*p;return u=zU(u,y),u=MU(u,y),u}function XS(u,p,y){return Math.sqrt(rh(u,p,y,!0))}function FU(u,p,y){return rh(u,p,y)}function MU(u,p){var y=u.length,C=typeof Uint8Array<"u"?Uint8Array:Array,k=new C(y);k[0]=k[y-1]=1,Jx(u,k,p,0,y-1);var N,M=[];for(N=0;N<y;N++)k[N]&&M.push(u[N]);return M}function Jx(u,p,y,C,k){var N=0,M,Y,se;for(Y=C+1;Y<=k-1;Y++)se=rh(u[Y],u[C],u[k],!0),se>N&&(M=Y,N=se);N>y&&(p[M]=1,Jx(u,p,y,C,M),Jx(u,p,y,M,k))}function zU(u,p){for(var y=[u[0]],C=1,k=0,N=u.length;C<N;C++)BU(u[C],u[k])>p&&(y.push(u[C]),k=C);return k<N-1&&y.push(u[N-1]),y}var ZS;function YS(u,p,y,C,k){var N=C?ZS:Pa(u,y),M=Pa(p,y),Y,se,fe;for(ZS=M;;){if(!(N|M))return[u,p];if(N&M)return!1;Y=N||M,se=Fp(u,p,Y,y,k),fe=Pa(se,y),Y===N?(u=se,N=fe):(p=se,M=fe)}}function Fp(u,p,y,C,k){var N=p.x-u.x,M=p.y-u.y,Y=C.min,se=C.max,fe,be;return y&8?(fe=u.x+N*(se.y-u.y)/M,be=se.y):y&4?(fe=u.x+N*(Y.y-u.y)/M,be=Y.y):y&2?(fe=se.x,be=u.y+M*(se.x-u.x)/N):y&1&&(fe=Y.x,be=u.y+M*(Y.x-u.x)/N),new O(fe,be,k)}function Pa(u,p){var y=0;return u.x<p.min.x?y|=1:u.x>p.max.x&&(y|=2),u.y<p.min.y?y|=4:u.y>p.max.y&&(y|=8),y}function BU(u,p){var y=p.x-u.x,C=p.y-u.y;return y*y+C*C}function rh(u,p,y,C){var k=p.x,N=p.y,M=y.x-k,Y=y.y-N,se=M*M+Y*Y,fe;return se>0&&(fe=((u.x-k)*M+(u.y-N)*Y)/se,fe>1?(k=y.x,N=y.y):fe>0&&(k+=M*fe,N+=Y*fe)),M=u.x-k,Y=u.y-N,C?M*M+Y*Y:new O(k,N)}function ti(u){return!b(u[0])||typeof u[0][0]!="object"&&typeof u[0][0]<"u"}function QS(u){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ti(u)}function JS(u,p){var y,C,k,N,M,Y,se,fe;if(!u||u.length===0)throw new Error("latlngs not passed");ti(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var be=ce([0,0]),Pe=he(u),qe=Pe.getNorthWest().distanceTo(Pe.getSouthWest())*Pe.getNorthEast().distanceTo(Pe.getNorthWest());qe<1700&&(be=Qx(u));var os=u.length,kn=[];for(y=0;y<os;y++){var ni=ce(u[y]);kn.push(p.project(ce([ni.lat-be.lat,ni.lng-be.lng])))}for(y=0,C=0;y<os-1;y++)C+=kn[y].distanceTo(kn[y+1])/2;if(C===0)fe=kn[0];else for(y=0,N=0;y<os-1;y++)if(M=kn[y],Y=kn[y+1],k=M.distanceTo(Y),N+=k,N>C){se=(N-C)/k,fe=[Y.x-se*(Y.x-M.x),Y.y-se*(Y.y-M.y)];break}var xs=p.unproject(j(fe));return ce([xs.lat+be.lat,xs.lng+be.lng])}var UU={__proto__:null,simplify:KS,pointToSegmentDistance:XS,closestPointOnSegment:FU,clipSegment:YS,_getEdgeIntersection:Fp,_getBitCode:Pa,_sqClosestPointOnSegment:rh,isFlat:ti,_flat:QS,polylineCenter:JS},e_={project:function(u){return new O(u.lng,u.lat)},unproject:function(u){return new le(u.y,u.x)},bounds:new te([-180,-90],[180,90])},t_={R:6378137,R_MINOR:6356752314245179e-9,bounds:new te([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(u){var p=Math.PI/180,y=this.R,C=u.lat*p,k=this.R_MINOR/y,N=Math.sqrt(1-k*k),M=N*Math.sin(C),Y=Math.tan(Math.PI/4-C/2)/Math.pow((1-M)/(1+M),N/2);return C=-y*Math.log(Math.max(Y,1e-10)),new O(u.lng*p*y,C)},unproject:function(u){for(var p=180/Math.PI,y=this.R,C=this.R_MINOR/y,k=Math.sqrt(1-C*C),N=Math.exp(-u.y/y),M=Math.PI/2-2*Math.atan(N),Y=0,se=.1,fe;Y<15&&Math.abs(se)>1e-7;Y++)fe=k*Math.sin(M),fe=Math.pow((1-fe)/(1+fe),k/2),se=Math.PI/2-2*Math.atan(N*fe)-M,M+=se;return new le(M*p,u.x*p/y)}},WU={__proto__:null,LonLat:e_,Mercator:t_,SphericalMercator:Fe},VU=i({},Se,{code:"EPSG:3395",projection:t_,transformation:function(){var u=.5/(Math.PI*t_.R);return Qe(u,.5,-u,.5)}()}),eT=i({},Se,{code:"EPSG:4326",projection:e_,transformation:Qe(1/180,1,-1/180,.5)}),jU=i({},we,{projection:e_,transformation:Qe(1,0,-1,0),scale:function(u){return Math.pow(2,u)},zoom:function(u){return Math.log(u)/Math.LN2},distance:function(u,p){var y=p.lng-u.lng,C=p.lat-u.lat;return Math.sqrt(y*y+C*C)},infinite:!0});we.Earth=Se,we.EPSG3395=VU,we.EPSG3857=ut,we.EPSG900913=Rt,we.EPSG4326=eT,we.Simple=jU;var $i=oe.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(u){return u.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(u){return u&&u.removeLayer(this),this},getPane:function(u){return this._map.getPane(u?this.options[u]||u:this.options.pane)},addInteractiveTarget:function(u){return this._map._targets[l(u)]=this,this},removeInteractiveTarget:function(u){return delete this._map._targets[l(u)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(u){var p=u.target;if(p.hasLayer(this)){if(this._map=p,this._zoomAnimated=p._zoomAnimated,this.getEvents){var y=this.getEvents();p.on(y,this),this.once("remove",function(){p.off(y,this)},this)}this.onAdd(p),this.fire("add"),p.fire("layeradd",{layer:this})}}});nt.include({addLayer:function(u){if(!u._layerAdd)throw new Error("The provided object is not a Layer.");var p=l(u);return this._layers[p]?this:(this._layers[p]=u,u._mapToAdd=this,u.beforeAdd&&u.beforeAdd(this),this.whenReady(u._layerAdd,u),this)},removeLayer:function(u){var p=l(u);return this._layers[p]?(this._loaded&&u.onRemove(this),delete this._layers[p],this._loaded&&(this.fire("layerremove",{layer:u}),u.fire("remove")),u._map=u._mapToAdd=null,this):this},hasLayer:function(u){return l(u)in this._layers},eachLayer:function(u,p){for(var y in this._layers)u.call(p,this._layers[y]);return this},_addLayers:function(u){u=u?b(u)?u:[u]:[];for(var p=0,y=u.length;p<y;p++)this.addLayer(u[p])},_addZoomLimit:function(u){(!isNaN(u.options.maxZoom)||!isNaN(u.options.minZoom))&&(this._zoomBoundLayers[l(u)]=u,this._updateZoomLevels())},_removeZoomLimit:function(u){var p=l(u);this._zoomBoundLayers[p]&&(delete this._zoomBoundLayers[p],this._updateZoomLevels())},_updateZoomLevels:function(){var u=1/0,p=-1/0,y=this._getZoomSpan();for(var C in this._zoomBoundLayers){var k=this._zoomBoundLayers[C].options;u=k.minZoom===void 0?u:Math.min(u,k.minZoom),p=k.maxZoom===void 0?p:Math.max(p,k.maxZoom)}this._layersMaxZoom=p===-1/0?void 0:p,this._layersMinZoom=u===1/0?void 0:u,y!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var lc=$i.extend({initialize:function(u,p){x(this,p),this._layers={};var y,C;if(u)for(y=0,C=u.length;y<C;y++)this.addLayer(u[y])},addLayer:function(u){var p=this.getLayerId(u);return this._layers[p]=u,this._map&&this._map.addLayer(u),this},removeLayer:function(u){var p=u in this._layers?u:this.getLayerId(u);return this._map&&this._layers[p]&&this._map.removeLayer(this._layers[p]),delete this._layers[p],this},hasLayer:function(u){var p=typeof u=="number"?u:this.getLayerId(u);return p in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(u){var p=Array.prototype.slice.call(arguments,1),y,C;for(y in this._layers)C=this._layers[y],C[u]&&C[u].apply(C,p);return this},onAdd:function(u){this.eachLayer(u.addLayer,u)},onRemove:function(u){this.eachLayer(u.removeLayer,u)},eachLayer:function(u,p){for(var y in this._layers)u.call(p,this._layers[y]);return this},getLayer:function(u){return this._layers[u]},getLayers:function(){var u=[];return this.eachLayer(u.push,u),u},setZIndex:function(u){return this.invoke("setZIndex",u)},getLayerId:function(u){return l(u)}}),GU=function(u,p){return new lc(u,p)},Lr=lc.extend({addLayer:function(u){return this.hasLayer(u)?this:(u.addEventParent(this),lc.prototype.addLayer.call(this,u),this.fire("layeradd",{layer:u}))},removeLayer:function(u){return this.hasLayer(u)?(u in this._layers&&(u=this._layers[u]),u.removeEventParent(this),lc.prototype.removeLayer.call(this,u),this.fire("layerremove",{layer:u})):this},setStyle:function(u){return this.invoke("setStyle",u)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var u=new ue;for(var p in this._layers){var y=this._layers[p];u.extend(y.getBounds?y.getBounds():y.getLatLng())}return u}}),HU=function(u,p){return new Lr(u,p)},cc=K.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(u){x(this,u)},createIcon:function(u){return this._createIcon("icon",u)},createShadow:function(u){return this._createIcon("shadow",u)},_createIcon:function(u,p){var y=this._getIconUrl(u);if(!y){if(u==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var C=this._createImg(y,p&&p.tagName==="IMG"?p:null);return this._setIconStyles(C,u),(this.options.crossOrigin||this.options.crossOrigin==="")&&(C.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),C},_setIconStyles:function(u,p){var y=this.options,C=y[p+"Size"];typeof C=="number"&&(C=[C,C]);var k=j(C),N=j(p==="shadow"&&y.shadowAnchor||y.iconAnchor||k&&k.divideBy(2,!0));u.className="leaflet-marker-"+p+" "+(y.className||""),N&&(u.style.marginLeft=-N.x+"px",u.style.marginTop=-N.y+"px"),k&&(u.style.width=k.x+"px",u.style.height=k.y+"px")},_createImg:function(u,p){return p=p||document.createElement("img"),p.src=u,p},_getIconUrl:function(u){return Ne.retina&&this.options[u+"RetinaUrl"]||this.options[u+"Url"]}});function qU(u){return new cc(u)}var oh=cc.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(u){return typeof oh.imagePath!="string"&&(oh.imagePath=this._detectIconPath()),(this.options.imagePath||oh.imagePath)+cc.prototype._getIconUrl.call(this,u)},_stripUrl:function(u){var p=function(y,C,k){var N=C.exec(y);return N&&N[k]};return u=p(u,/^url\((['"])?(.+)\1\)$/,2),u&&p(u,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var u=at("div","leaflet-default-icon-path",document.body),p=Ju(u,"background-image")||Ju(u,"backgroundImage");if(document.body.removeChild(u),p=this._stripUrl(p),p)return p;var y=document.querySelector('link[href$="leaflet.css"]');return y?y.href.substring(0,y.href.length-11-1):""}}),tT=or.extend({initialize:function(u){this._marker=u},addHooks:function(){var u=this._marker._icon;this._draggable||(this._draggable=new vo(u,u,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ve(u,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&en(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(u){var p=this._marker,y=p._map,C=this._marker.options.autoPanSpeed,k=this._marker.options.autoPanPadding,N=Ra(p._icon),M=y.getPixelBounds(),Y=y.getPixelOrigin(),se=ae(M.min._subtract(Y).add(k),M.max._subtract(Y).subtract(k));if(!se.contains(N)){var fe=j((Math.max(se.max.x,N.x)-se.max.x)/(M.max.x-se.max.x)-(Math.min(se.min.x,N.x)-se.min.x)/(M.min.x-se.min.x),(Math.max(se.max.y,N.y)-se.max.y)/(M.max.y-se.max.y)-(Math.min(se.min.y,N.y)-se.min.y)/(M.min.y-se.min.y)).multiplyBy(C);y.panBy(fe,{animate:!1}),this._draggable._newPos._add(fe),this._draggable._startPos._add(fe),rn(p._icon,this._draggable._newPos),this._onDrag(u),this._panRequest=z(this._adjustPan.bind(this,u))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(u){this._marker.options.autoPan&&(V(this._panRequest),this._panRequest=z(this._adjustPan.bind(this,u)))},_onDrag:function(u){var p=this._marker,y=p._shadow,C=Ra(p._icon),k=p._map.layerPointToLatLng(C);y&&rn(y,C),p._latlng=k,u.latlng=k,u.oldLatLng=this._oldLatLng,p.fire("move",u).fire("drag",u)},_onDragEnd:function(u){V(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",u)}}),Mp=$i.extend({options:{icon:new oh,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(u,p){x(this,p),this._latlng=ce(u)},onAdd:function(u){this._zoomAnimated=this._zoomAnimated&&u.options.markerZoomAnimation,this._zoomAnimated&&u.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(u){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&u.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(u){var p=this._latlng;return this._latlng=ce(u),this.update(),this.fire("move",{oldLatLng:p,latlng:this._latlng})},setZIndexOffset:function(u){return this.options.zIndexOffset=u,this.update()},getIcon:function(){return this.options.icon},setIcon:function(u){return this.options.icon=u,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var u=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(u)}return this},_initIcon:function(){var u=this.options,p="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),y=u.icon.createIcon(this._icon),C=!1;y!==this._icon&&(this._icon&&this._removeIcon(),C=!0,u.title&&(y.title=u.title),y.tagName==="IMG"&&(y.alt=u.alt||"")),Ve(y,p),u.keyboard&&(y.tabIndex="0",y.setAttribute("role","button")),this._icon=y,u.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Be(y,"focus",this._panOnFocus,this);var k=u.icon.createShadow(this._shadow),N=!1;k!==this._shadow&&(this._removeShadow(),N=!0),k&&(Ve(k,p),k.alt=""),this._shadow=k,u.opacity<1&&this._updateOpacity(),C&&this.getPane().appendChild(this._icon),this._initInteraction(),k&&N&&this.getPane(u.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&kt(this._icon,"focus",this._panOnFocus,this),Ut(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ut(this._shadow),this._shadow=null},_setPos:function(u){this._icon&&rn(this._icon,u),this._shadow&&rn(this._shadow,u),this._zIndex=u.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(u){this._icon&&(this._icon.style.zIndex=this._zIndex+u)},_animateZoom:function(u){var p=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center).round();this._setPos(p)},_initInteraction:function(){if(this.options.interactive&&(Ve(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),tT)){var u=this.options.draggable;this.dragging&&(u=this.dragging.enabled(),this.dragging.disable()),this.dragging=new tT(this),u&&this.dragging.enable()}},setOpacity:function(u){return this.options.opacity=u,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var u=this.options.opacity;this._icon&&ei(this._icon,u),this._shadow&&ei(this._shadow,u)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var u=this._map;if(u){var p=this.options.icon.options,y=p.iconSize?j(p.iconSize):j(0,0),C=p.iconAnchor?j(p.iconAnchor):j(0,0);u.panInside(this._latlng,{paddingTopLeft:C,paddingBottomRight:y.subtract(C)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function KU(u,p){return new Mp(u,p)}var xo=$i.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(u){this._renderer=u.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(u){return x(this,u),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&u&&Object.prototype.hasOwnProperty.call(u,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),zp=xo.extend({options:{fill:!0,radius:10},initialize:function(u,p){x(this,p),this._latlng=ce(u),this._radius=this.options.radius},setLatLng:function(u){var p=this._latlng;return this._latlng=ce(u),this.redraw(),this.fire("move",{oldLatLng:p,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(u){return this.options.radius=this._radius=u,this.redraw()},getRadius:function(){return this._radius},setStyle:function(u){var p=u&&u.radius||this._radius;return xo.prototype.setStyle.call(this,u),this.setRadius(p),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var u=this._radius,p=this._radiusY||u,y=this._clickTolerance(),C=[u+y,p+y];this._pxBounds=new te(this._point.subtract(C),this._point.add(C))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(u){return u.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function XU(u,p){return new zp(u,p)}var n_=zp.extend({initialize:function(u,p,y){if(typeof p=="number"&&(p=i({},y,{radius:p})),x(this,p),this._latlng=ce(u),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(u){return this._mRadius=u,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var u=[this._radius,this._radiusY||this._radius];return new ue(this._map.layerPointToLatLng(this._point.subtract(u)),this._map.layerPointToLatLng(this._point.add(u)))},setStyle:xo.prototype.setStyle,_project:function(){var u=this._latlng.lng,p=this._latlng.lat,y=this._map,C=y.options.crs;if(C.distance===Se.distance){var k=Math.PI/180,N=this._mRadius/Se.R/k,M=y.project([p+N,u]),Y=y.project([p-N,u]),se=M.add(Y).divideBy(2),fe=y.unproject(se).lat,be=Math.acos((Math.cos(N*k)-Math.sin(p*k)*Math.sin(fe*k))/(Math.cos(p*k)*Math.cos(fe*k)))/k;(isNaN(be)||be===0)&&(be=N/Math.cos(Math.PI/180*p)),this._point=se.subtract(y.getPixelOrigin()),this._radius=isNaN(be)?0:se.x-y.project([fe,u-be]).x,this._radiusY=se.y-M.y}else{var Pe=C.unproject(C.project(this._latlng).subtract([this._mRadius,0]));this._point=y.latLngToLayerPoint(this._latlng),this._radius=this._point.x-y.latLngToLayerPoint(Pe).x}this._updateBounds()}});function ZU(u,p,y){return new n_(u,p,y)}var Fr=xo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(u,p){x(this,p),this._setLatLngs(u)},getLatLngs:function(){return this._latlngs},setLatLngs:function(u){return this._setLatLngs(u),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(u){for(var p=1/0,y=null,C=rh,k,N,M=0,Y=this._parts.length;M<Y;M++)for(var se=this._parts[M],fe=1,be=se.length;fe<be;fe++){k=se[fe-1],N=se[fe];var Pe=C(u,k,N,!0);Pe<p&&(p=Pe,y=C(u,k,N))}return y&&(y.distance=Math.sqrt(p)),y},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return JS(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(u,p){return p=p||this._defaultShape(),u=ce(u),p.push(u),this._bounds.extend(u),this.redraw()},_setLatLngs:function(u){this._bounds=new ue,this._latlngs=this._convertLatLngs(u)},_defaultShape:function(){return ti(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(u){for(var p=[],y=ti(u),C=0,k=u.length;C<k;C++)y?(p[C]=ce(u[C]),this._bounds.extend(p[C])):p[C]=this._convertLatLngs(u[C]);return p},_project:function(){var u=new te;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,u),this._bounds.isValid()&&u.isValid()&&(this._rawPxBounds=u,this._updateBounds())},_updateBounds:function(){var u=this._clickTolerance(),p=new O(u,u);this._rawPxBounds&&(this._pxBounds=new te([this._rawPxBounds.min.subtract(p),this._rawPxBounds.max.add(p)]))},_projectLatlngs:function(u,p,y){var C=u[0]instanceof le,k=u.length,N,M;if(C){for(M=[],N=0;N<k;N++)M[N]=this._map.latLngToLayerPoint(u[N]),y.extend(M[N]);p.push(M)}else for(N=0;N<k;N++)this._projectLatlngs(u[N],p,y)},_clipPoints:function(){var u=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}var p=this._parts,y,C,k,N,M,Y,se;for(y=0,k=0,N=this._rings.length;y<N;y++)for(se=this._rings[y],C=0,M=se.length;C<M-1;C++)Y=YS(se[C],se[C+1],u,C,!0),Y&&(p[k]=p[k]||[],p[k].push(Y[0]),(Y[1]!==se[C+1]||C===M-2)&&(p[k].push(Y[1]),k++))}},_simplifyPoints:function(){for(var u=this._parts,p=this.options.smoothFactor,y=0,C=u.length;y<C;y++)u[y]=KS(u[y],p)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(u,p){var y,C,k,N,M,Y,se=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(y=0,N=this._parts.length;y<N;y++)for(Y=this._parts[y],C=0,M=Y.length,k=M-1;C<M;k=C++)if(!(!p&&C===0)&&XS(u,Y[k],Y[C])<=se)return!0;return!1}});function YU(u,p){return new Fr(u,p)}Fr._flat=QS;var uc=Fr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return qS(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(u){var p=Fr.prototype._convertLatLngs.call(this,u),y=p.length;return y>=2&&p[0]instanceof le&&p[0].equals(p[y-1])&&p.pop(),p},_setLatLngs:function(u){Fr.prototype._setLatLngs.call(this,u),ti(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ti(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var u=this._renderer._bounds,p=this.options.weight,y=new O(p,p);if(u=new te(u.min.subtract(y),u.max.add(y)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}for(var C=0,k=this._rings.length,N;C<k;C++)N=HS(this._rings[C],u,!0),N.length&&this._parts.push(N)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(u){var p=!1,y,C,k,N,M,Y,se,fe;if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(N=0,se=this._parts.length;N<se;N++)for(y=this._parts[N],M=0,fe=y.length,Y=fe-1;M<fe;Y=M++)C=y[M],k=y[Y],C.y>u.y!=k.y>u.y&&u.x<(k.x-C.x)*(u.y-C.y)/(k.y-C.y)+C.x&&(p=!p);return p||Fr.prototype._containsPoint.call(this,u,!0)}});function QU(u,p){return new uc(u,p)}var Mr=Lr.extend({initialize:function(u,p){x(this,p),this._layers={},u&&this.addData(u)},addData:function(u){var p=b(u)?u:u.features,y,C,k;if(p){for(y=0,C=p.length;y<C;y++)k=p[y],(k.geometries||k.geometry||k.features||k.coordinates)&&this.addData(k);return this}var N=this.options;if(N.filter&&!N.filter(u))return this;var M=Bp(u,N);return M?(M.feature=Vp(u),M.defaultOptions=M.options,this.resetStyle(M),N.onEachFeature&&N.onEachFeature(u,M),this.addLayer(M)):this},resetStyle:function(u){return u===void 0?this.eachLayer(this.resetStyle,this):(u.options=i({},u.defaultOptions),this._setLayerStyle(u,this.options.style),this)},setStyle:function(u){return this.eachLayer(function(p){this._setLayerStyle(p,u)},this)},_setLayerStyle:function(u,p){u.setStyle&&(typeof p=="function"&&(p=p(u.feature)),u.setStyle(p))}});function Bp(u,p){var y=u.type==="Feature"?u.geometry:u,C=y?y.coordinates:null,k=[],N=p&&p.pointToLayer,M=p&&p.coordsToLatLng||s_,Y,se,fe,be;if(!C&&!y)return null;switch(y.type){case"Point":return Y=M(C),nT(N,u,Y,p);case"MultiPoint":for(fe=0,be=C.length;fe<be;fe++)Y=M(C[fe]),k.push(nT(N,u,Y,p));return new Lr(k);case"LineString":case"MultiLineString":return se=Up(C,y.type==="LineString"?0:1,M),new Fr(se,p);case"Polygon":case"MultiPolygon":return se=Up(C,y.type==="Polygon"?1:2,M),new uc(se,p);case"GeometryCollection":for(fe=0,be=y.geometries.length;fe<be;fe++){var Pe=Bp({geometry:y.geometries[fe],type:"Feature",properties:u.properties},p);Pe&&k.push(Pe)}return new Lr(k);case"FeatureCollection":for(fe=0,be=y.features.length;fe<be;fe++){var qe=Bp(y.features[fe],p);qe&&k.push(qe)}return new Lr(k);default:throw new Error("Invalid GeoJSON object.")}}function nT(u,p,y,C){return u?u(p,y):new Mp(y,C&&C.markersInheritOptions&&C)}function s_(u){return new le(u[1],u[0],u[2])}function Up(u,p,y){for(var C=[],k=0,N=u.length,M;k<N;k++)M=p?Up(u[k],p-1,y):(y||s_)(u[k]),C.push(M);return C}function i_(u,p){return u=ce(u),u.alt!==void 0?[f(u.lng,p),f(u.lat,p),f(u.alt,p)]:[f(u.lng,p),f(u.lat,p)]}function Wp(u,p,y,C){for(var k=[],N=0,M=u.length;N<M;N++)k.push(p?Wp(u[N],ti(u[N])?0:p-1,y,C):i_(u[N],C));return!p&&y&&k.length>0&&k.push(k[0].slice()),k}function hc(u,p){return u.feature?i({},u.feature,{geometry:p}):Vp(p)}function Vp(u){return u.type==="Feature"||u.type==="FeatureCollection"?u:{type:"Feature",properties:{},geometry:u}}var r_={toGeoJSON:function(u){return hc(this,{type:"Point",coordinates:i_(this.getLatLng(),u)})}};Mp.include(r_),n_.include(r_),zp.include(r_),Fr.include({toGeoJSON:function(u){var p=!ti(this._latlngs),y=Wp(this._latlngs,p?1:0,!1,u);return hc(this,{type:(p?"Multi":"")+"LineString",coordinates:y})}}),uc.include({toGeoJSON:function(u){var p=!ti(this._latlngs),y=p&&!ti(this._latlngs[0]),C=Wp(this._latlngs,y?2:p?1:0,!0,u);return p||(C=[C]),hc(this,{type:(y?"Multi":"")+"Polygon",coordinates:C})}}),lc.include({toMultiPoint:function(u){var p=[];return this.eachLayer(function(y){p.push(y.toGeoJSON(u).geometry.coordinates)}),hc(this,{type:"MultiPoint",coordinates:p})},toGeoJSON:function(u){var p=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(p==="MultiPoint")return this.toMultiPoint(u);var y=p==="GeometryCollection",C=[];return this.eachLayer(function(k){if(k.toGeoJSON){var N=k.toGeoJSON(u);if(y)C.push(N.geometry);else{var M=Vp(N);M.type==="FeatureCollection"?C.push.apply(C,M.features):C.push(M)}}}),y?hc(this,{geometries:C,type:"GeometryCollection"}):{type:"FeatureCollection",features:C}}});function sT(u,p){return new Mr(u,p)}var JU=sT,jp=$i.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(u,p,y){this._url=u,this._bounds=he(p),x(this,y)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ve(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ut(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(u){return this.options.opacity=u,this._image&&this._updateOpacity(),this},setStyle:function(u){return u.opacity&&this.setOpacity(u.opacity),this},bringToFront:function(){return this._map&&oc(this._image),this},bringToBack:function(){return this._map&&ac(this._image),this},setUrl:function(u){return this._url=u,this._image&&(this._image.src=u),this},setBounds:function(u){return this._bounds=he(u),this._map&&this._reset(),this},getEvents:function(){var u={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var u=this._url.tagName==="IMG",p=this._image=u?this._url:at("img");if(Ve(p,"leaflet-image-layer"),this._zoomAnimated&&Ve(p,"leaflet-zoom-animated"),this.options.className&&Ve(p,this.options.className),p.onselectstart=d,p.onmousemove=d,p.onload=o(this.fire,this,"load"),p.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(p.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),u){this._url=p.src;return}p.src=this._url,p.alt=this.options.alt},_animateZoom:function(u){var p=this._map.getZoomScale(u.zoom),y=this._map._latLngBoundsToNewLayerBounds(this._bounds,u.zoom,u.center).min;$a(this._image,y,p)},_reset:function(){var u=this._image,p=new te(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),y=p.getSize();rn(u,p.min),u.style.width=y.x+"px",u.style.height=y.y+"px"},_updateOpacity:function(){ei(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var u=this.options.errorOverlayUrl;u&&this._url!==u&&(this._url=u,this._image.src=u)},getCenter:function(){return this._bounds.getCenter()}}),eW=function(u,p,y){return new jp(u,p,y)},iT=jp.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var u=this._url.tagName==="VIDEO",p=this._image=u?this._url:at("video");if(Ve(p,"leaflet-image-layer"),this._zoomAnimated&&Ve(p,"leaflet-zoom-animated"),this.options.className&&Ve(p,this.options.className),p.onselectstart=d,p.onmousemove=d,p.onloadeddata=o(this.fire,this,"load"),u){for(var y=p.getElementsByTagName("source"),C=[],k=0;k<y.length;k++)C.push(y[k].src);this._url=y.length>0?C:[p.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(p.style,"objectFit")&&(p.style.objectFit="fill"),p.autoplay=!!this.options.autoplay,p.loop=!!this.options.loop,p.muted=!!this.options.muted,p.playsInline=!!this.options.playsInline;for(var N=0;N<this._url.length;N++){var M=at("source");M.src=this._url[N],p.appendChild(M)}}});function tW(u,p,y){return new iT(u,p,y)}var rT=jp.extend({_initImage:function(){var u=this._image=this._url;Ve(u,"leaflet-image-layer"),this._zoomAnimated&&Ve(u,"leaflet-zoom-animated"),this.options.className&&Ve(u,this.options.className),u.onselectstart=d,u.onmousemove=d}});function nW(u,p,y){return new rT(u,p,y)}var ar=$i.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(u,p){u&&(u instanceof le||b(u))?(this._latlng=ce(u),x(this,p)):(x(this,u),this._source=p),this.options.content&&(this._content=this.options.content)},openOn:function(u){return u=arguments.length?u:this._source._map,u.hasLayer(this)||u.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(u){return this._map?this.close():(arguments.length?this._source=u:u=this._source,this._prepareOpen(),this.openOn(u._map)),this},onAdd:function(u){this._zoomAnimated=u._zoomAnimated,this._container||this._initLayout(),u._fadeAnimated&&ei(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),u._fadeAnimated&&ei(this._container,1),this.bringToFront(),this.options.interactive&&(Ve(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(u){u._fadeAnimated?(ei(this._container,0),this._removeTimeout=setTimeout(o(Ut,void 0,this._container),200)):Ut(this._container),this.options.interactive&&(en(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(u){return this._latlng=ce(u),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(u){return this._content=u,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var u={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&oc(this._container),this},bringToBack:function(){return this._map&&ac(this._container),this},_prepareOpen:function(u){var p=this._source;if(!p._map)return!1;if(p instanceof Lr){p=null;var y=this._source._layers;for(var C in y)if(y[C]._map){p=y[C];break}if(!p)return!1;this._source=p}if(!u)if(p.getCenter)u=p.getCenter();else if(p.getLatLng)u=p.getLatLng();else if(p.getBounds)u=p.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(u),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var u=this._contentNode,p=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof p=="string")u.innerHTML=p;else{for(;u.hasChildNodes();)u.removeChild(u.firstChild);u.appendChild(p)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var u=this._map.latLngToLayerPoint(this._latlng),p=j(this.options.offset),y=this._getAnchor();this._zoomAnimated?rn(this._container,u.add(y)):p=p.add(u).add(y);var C=this._containerBottom=-p.y,k=this._containerLeft=-Math.round(this._containerWidth/2)+p.x;this._container.style.bottom=C+"px",this._container.style.left=k+"px"}},_getAnchor:function(){return[0,0]}});nt.include({_initOverlay:function(u,p,y,C){var k=p;return k instanceof u||(k=new u(C).setContent(p)),y&&k.setLatLng(y),k}}),$i.include({_initOverlay:function(u,p,y,C){var k=y;return k instanceof u?(x(k,C),k._source=this):(k=p&&!C?p:new u(C,this),k.setContent(y)),k}});var Gp=ar.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(u){return u=arguments.length?u:this._source._map,!u.hasLayer(this)&&u._popup&&u._popup.options.autoClose&&u.removeLayer(u._popup),u._popup=this,ar.prototype.openOn.call(this,u)},onAdd:function(u){ar.prototype.onAdd.call(this,u),u.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof xo||this._source.on("preclick",Aa))},onRemove:function(u){ar.prototype.onRemove.call(this,u),u.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof xo||this._source.off("preclick",Aa))},getEvents:function(){var u=ar.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(u.preclick=this.close),this.options.keepInView&&(u.moveend=this._adjustPan),u},_initLayout:function(){var u="leaflet-popup",p=this._container=at("div",u+" "+(this.options.className||"")+" leaflet-zoom-animated"),y=this._wrapper=at("div",u+"-content-wrapper",p);if(this._contentNode=at("div",u+"-content",y),sh(p),Kx(this._contentNode),Be(p,"contextmenu",Aa),this._tipContainer=at("div",u+"-tip-container",p),this._tip=at("div",u+"-tip",this._tipContainer),this.options.closeButton){var C=this._closeButton=at("a",u+"-close-button",p);C.setAttribute("role","button"),C.setAttribute("aria-label","Close popup"),C.href="#close",C.innerHTML='<span aria-hidden="true">&#215;</span>',Be(C,"click",function(k){Fn(k),this.close()},this)}},_updateLayout:function(){var u=this._contentNode,p=u.style;p.width="",p.whiteSpace="nowrap";var y=u.offsetWidth;y=Math.min(y,this.options.maxWidth),y=Math.max(y,this.options.minWidth),p.width=y+1+"px",p.whiteSpace="",p.height="";var C=u.offsetHeight,k=this.options.maxHeight,N="leaflet-popup-scrolled";k&&C>k?(p.height=k+"px",Ve(u,N)):en(u,N),this._containerWidth=this._container.offsetWidth},_animateZoom:function(u){var p=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center),y=this._getAnchor();rn(this._container,p.add(y))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var u=this._map,p=parseInt(Ju(this._container,"marginBottom"),10)||0,y=this._container.offsetHeight+p,C=this._containerWidth,k=new O(this._containerLeft,-y-this._containerBottom);k._add(Ra(this._container));var N=u.layerPointToContainerPoint(k),M=j(this.options.autoPanPadding),Y=j(this.options.autoPanPaddingTopLeft||M),se=j(this.options.autoPanPaddingBottomRight||M),fe=u.getSize(),be=0,Pe=0;N.x+C+se.x>fe.x&&(be=N.x+C-fe.x+se.x),N.x-be-Y.x<0&&(be=N.x-Y.x),N.y+y+se.y>fe.y&&(Pe=N.y+y-fe.y+se.y),N.y-Pe-Y.y<0&&(Pe=N.y-Y.y),(be||Pe)&&(this.options.keepInView&&(this._autopanning=!0),u.fire("autopanstart").panBy([be,Pe]))}},_getAnchor:function(){return j(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),sW=function(u,p){return new Gp(u,p)};nt.mergeOptions({closePopupOnClick:!0}),nt.include({openPopup:function(u,p,y){return this._initOverlay(Gp,u,p,y).openOn(this),this},closePopup:function(u){return u=arguments.length?u:this._popup,u&&u.close(),this}}),$i.include({bindPopup:function(u,p){return this._popup=this._initOverlay(Gp,this._popup,u,p),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(u){return this._popup&&(this instanceof Lr||(this._popup._source=this),this._popup._prepareOpen(u||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(u){return this._popup&&this._popup.setContent(u),this},getPopup:function(){return this._popup},_openPopup:function(u){if(!(!this._popup||!this._map)){Da(u);var p=u.layer||u.target;if(this._popup._source===p&&!(p instanceof xo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(u.latlng);return}this._popup._source=p,this.openPopup(u.latlng)}},_movePopup:function(u){this._popup.setLatLng(u.latlng)},_onKeyPress:function(u){u.originalEvent.keyCode===13&&this._openPopup(u)}});var Hp=ar.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(u){ar.prototype.onAdd.call(this,u),this.setOpacity(this.options.opacity),u.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(u){ar.prototype.onRemove.call(this,u),u.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var u=ar.prototype.getEvents.call(this);return this.options.permanent||(u.preclick=this.close),u},_initLayout:function(){var u="leaflet-tooltip",p=u+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=at("div",p),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(u){var p,y,C=this._map,k=this._container,N=C.latLngToContainerPoint(C.getCenter()),M=C.layerPointToContainerPoint(u),Y=this.options.direction,se=k.offsetWidth,fe=k.offsetHeight,be=j(this.options.offset),Pe=this._getAnchor();Y==="top"?(p=se/2,y=fe):Y==="bottom"?(p=se/2,y=0):Y==="center"?(p=se/2,y=fe/2):Y==="right"?(p=0,y=fe/2):Y==="left"?(p=se,y=fe/2):M.x<N.x?(Y="right",p=0,y=fe/2):(Y="left",p=se+(be.x+Pe.x)*2,y=fe/2),u=u.subtract(j(p,y,!0)).add(be).add(Pe),en(k,"leaflet-tooltip-right"),en(k,"leaflet-tooltip-left"),en(k,"leaflet-tooltip-top"),en(k,"leaflet-tooltip-bottom"),Ve(k,"leaflet-tooltip-"+Y),rn(k,u)},_updatePosition:function(){var u=this._map.latLngToLayerPoint(this._latlng);this._setPosition(u)},setOpacity:function(u){this.options.opacity=u,this._container&&ei(this._container,u)},_animateZoom:function(u){var p=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center);this._setPosition(p)},_getAnchor:function(){return j(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),iW=function(u,p){return new Hp(u,p)};nt.include({openTooltip:function(u,p,y){return this._initOverlay(Hp,u,p,y).openOn(this),this},closeTooltip:function(u){return u.close(),this}}),$i.include({bindTooltip:function(u,p){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Hp,this._tooltip,u,p),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(u){if(!(!u&&this._tooltipHandlersAdded)){var p=u?"off":"on",y={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?y.add=this._openTooltip:(y.mouseover=this._openTooltip,y.mouseout=this.closeTooltip,y.click=this._openTooltip,this._map?this._addFocusListeners():y.add=this._addFocusListeners),this._tooltip.options.sticky&&(y.mousemove=this._moveTooltip),this[p](y),this._tooltipHandlersAdded=!u}},openTooltip:function(u){return this._tooltip&&(this instanceof Lr||(this._tooltip._source=this),this._tooltip._prepareOpen(u)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(u){return this._tooltip&&this._tooltip.setContent(u),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(u){var p=typeof u.getElement=="function"&&u.getElement();p&&(Be(p,"focus",function(){this._tooltip._source=u,this.openTooltip()},this),Be(p,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(u){var p=typeof u.getElement=="function"&&u.getElement();p&&p.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(u){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var p=this;this._map.once("moveend",function(){p._openOnceFlag=!1,p._openTooltip(u)});return}this._tooltip._source=u.layer||u.target,this.openTooltip(this._tooltip.options.sticky?u.latlng:void 0)}},_moveTooltip:function(u){var p=u.latlng,y,C;this._tooltip.options.sticky&&u.originalEvent&&(y=this._map.mouseEventToContainerPoint(u.originalEvent),C=this._map.containerPointToLayerPoint(y),p=this._map.layerPointToLatLng(C)),this._tooltip.setLatLng(p)}});var oT=cc.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(u){var p=u&&u.tagName==="DIV"?u:document.createElement("div"),y=this.options;if(y.html instanceof Element?(Ap(p),p.appendChild(y.html)):p.innerHTML=y.html!==!1?y.html:"",y.bgPos){var C=j(y.bgPos);p.style.backgroundPosition=-C.x+"px "+-C.y+"px"}return this._setIconStyles(p,"icon"),p},createShadow:function(){return null}});function rW(u){return new oT(u)}cc.Default=oh;var ah=$i.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ne.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(u){x(this,u)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(u){u._addZoomLimit(this)},onRemove:function(u){this._removeAllTiles(),Ut(this._container),u._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(oc(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ac(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(u){return this.options.opacity=u,this._updateOpacity(),this},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var u=this._clampZoom(this._map.getZoom());u!==this._tileZoom&&(this._tileZoom=u,this._updateLevels()),this._update()}return this},getEvents:function(){var u={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),u.move=this._onMove),this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},createTile:function(){return document.createElement("div")},getTileSize:function(){var u=this.options.tileSize;return u instanceof O?u:new O(u,u)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(u){for(var p=this.getPane().children,y=-u(-1/0,1/0),C=0,k=p.length,N;C<k;C++)N=p[C].style.zIndex,p[C]!==this._container&&N&&(y=u(y,+N));isFinite(y)&&(this.options.zIndex=y+u(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ne.ielt9){ei(this._container,this.options.opacity);var u=+new Date,p=!1,y=!1;for(var C in this._tiles){var k=this._tiles[C];if(!(!k.current||!k.loaded)){var N=Math.min(1,(u-k.loaded)/200);ei(k.el,N),N<1?p=!0:(k.active?y=!0:this._onOpaqueTile(k),k.active=!0)}}y&&!this._noPrune&&this._pruneTiles(),p&&(V(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=at("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var u=this._tileZoom,p=this.options.maxZoom;if(u!==void 0){for(var y in this._levels)y=Number(y),this._levels[y].el.children.length||y===u?(this._levels[y].el.style.zIndex=p-Math.abs(u-y),this._onUpdateLevel(y)):(Ut(this._levels[y].el),this._removeTilesAtZoom(y),this._onRemoveLevel(y),delete this._levels[y]);var C=this._levels[u],k=this._map;return C||(C=this._levels[u]={},C.el=at("div","leaflet-tile-container leaflet-zoom-animated",this._container),C.el.style.zIndex=p,C.origin=k.project(k.unproject(k.getPixelOrigin()),u).round(),C.zoom=u,this._setZoomTransform(C,k.getCenter(),k.getZoom()),d(C.el.offsetWidth),this._onCreateLevel(C)),this._level=C,C}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var u,p,y=this._map.getZoom();if(y>this.options.maxZoom||y<this.options.minZoom){this._removeAllTiles();return}for(u in this._tiles)p=this._tiles[u],p.retain=p.current;for(u in this._tiles)if(p=this._tiles[u],p.current&&!p.active){var C=p.coords;this._retainParent(C.x,C.y,C.z,C.z-5)||this._retainChildren(C.x,C.y,C.z,C.z+2)}for(u in this._tiles)this._tiles[u].retain||this._removeTile(u)}},_removeTilesAtZoom:function(u){for(var p in this._tiles)this._tiles[p].coords.z===u&&this._removeTile(p)},_removeAllTiles:function(){for(var u in this._tiles)this._removeTile(u)},_invalidateAll:function(){for(var u in this._levels)Ut(this._levels[u].el),this._onRemoveLevel(Number(u)),delete this._levels[u];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(u,p,y,C){var k=Math.floor(u/2),N=Math.floor(p/2),M=y-1,Y=new O(+k,+N);Y.z=+M;var se=this._tileCoordsToKey(Y),fe=this._tiles[se];return fe&&fe.active?(fe.retain=!0,!0):(fe&&fe.loaded&&(fe.retain=!0),M>C?this._retainParent(k,N,M,C):!1)},_retainChildren:function(u,p,y,C){for(var k=2*u;k<2*u+2;k++)for(var N=2*p;N<2*p+2;N++){var M=new O(k,N);M.z=y+1;var Y=this._tileCoordsToKey(M),se=this._tiles[Y];if(se&&se.active){se.retain=!0;continue}else se&&se.loaded&&(se.retain=!0);y+1<C&&this._retainChildren(k,N,y+1,C)}},_resetView:function(u){var p=u&&(u.pinch||u.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),p,p)},_animateZoom:function(u){this._setView(u.center,u.zoom,!0,u.noUpdate)},_clampZoom:function(u){var p=this.options;return p.minNativeZoom!==void 0&&u<p.minNativeZoom?p.minNativeZoom:p.maxNativeZoom!==void 0&&p.maxNativeZoom<u?p.maxNativeZoom:u},_setView:function(u,p,y,C){var k=Math.round(p);this.options.maxZoom!==void 0&&k>this.options.maxZoom||this.options.minZoom!==void 0&&k<this.options.minZoom?k=void 0:k=this._clampZoom(k);var N=this.options.updateWhenZooming&&k!==this._tileZoom;(!C||N)&&(this._tileZoom=k,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),k!==void 0&&this._update(u),y||this._pruneTiles(),this._noPrune=!!y),this._setZoomTransforms(u,p)},_setZoomTransforms:function(u,p){for(var y in this._levels)this._setZoomTransform(this._levels[y],u,p)},_setZoomTransform:function(u,p,y){var C=this._map.getZoomScale(y,u.zoom),k=u.origin.multiplyBy(C).subtract(this._map._getNewPixelOrigin(p,y)).round();Ne.any3d?$a(u.el,k,C):rn(u.el,k)},_resetGrid:function(){var u=this._map,p=u.options.crs,y=this._tileSize=this.getTileSize(),C=this._tileZoom,k=this._map.getPixelWorldBounds(this._tileZoom);k&&(this._globalTileRange=this._pxBoundsToTileRange(k)),this._wrapX=p.wrapLng&&!this.options.noWrap&&[Math.floor(u.project([0,p.wrapLng[0]],C).x/y.x),Math.ceil(u.project([0,p.wrapLng[1]],C).x/y.y)],this._wrapY=p.wrapLat&&!this.options.noWrap&&[Math.floor(u.project([p.wrapLat[0],0],C).y/y.x),Math.ceil(u.project([p.wrapLat[1],0],C).y/y.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(u){var p=this._map,y=p._animatingZoom?Math.max(p._animateToZoom,p.getZoom()):p.getZoom(),C=p.getZoomScale(y,this._tileZoom),k=p.project(u,this._tileZoom).floor(),N=p.getSize().divideBy(C*2);return new te(k.subtract(N),k.add(N))},_update:function(u){var p=this._map;if(p){var y=this._clampZoom(p.getZoom());if(u===void 0&&(u=p.getCenter()),this._tileZoom!==void 0){var C=this._getTiledPixelBounds(u),k=this._pxBoundsToTileRange(C),N=k.getCenter(),M=[],Y=this.options.keepBuffer,se=new te(k.getBottomLeft().subtract([Y,-Y]),k.getTopRight().add([Y,-Y]));if(!(isFinite(k.min.x)&&isFinite(k.min.y)&&isFinite(k.max.x)&&isFinite(k.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var fe in this._tiles){var be=this._tiles[fe].coords;(be.z!==this._tileZoom||!se.contains(new O(be.x,be.y)))&&(this._tiles[fe].current=!1)}if(Math.abs(y-this._tileZoom)>1){this._setView(u,y);return}for(var Pe=k.min.y;Pe<=k.max.y;Pe++)for(var qe=k.min.x;qe<=k.max.x;qe++){var os=new O(qe,Pe);if(os.z=this._tileZoom,!!this._isValidTile(os)){var kn=this._tiles[this._tileCoordsToKey(os)];kn?kn.current=!0:M.push(os)}}if(M.sort(function(xs,fc){return xs.distanceTo(N)-fc.distanceTo(N)}),M.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ni=document.createDocumentFragment();for(qe=0;qe<M.length;qe++)this._addTile(M[qe],ni);this._level.el.appendChild(ni)}}}},_isValidTile:function(u){var p=this._map.options.crs;if(!p.infinite){var y=this._globalTileRange;if(!p.wrapLng&&(u.x<y.min.x||u.x>y.max.x)||!p.wrapLat&&(u.y<y.min.y||u.y>y.max.y))return!1}if(!this.options.bounds)return!0;var C=this._tileCoordsToBounds(u);return he(this.options.bounds).overlaps(C)},_keyToBounds:function(u){return this._tileCoordsToBounds(this._keyToTileCoords(u))},_tileCoordsToNwSe:function(u){var p=this._map,y=this.getTileSize(),C=u.scaleBy(y),k=C.add(y),N=p.unproject(C,u.z),M=p.unproject(k,u.z);return[N,M]},_tileCoordsToBounds:function(u){var p=this._tileCoordsToNwSe(u),y=new ue(p[0],p[1]);return this.options.noWrap||(y=this._map.wrapLatLngBounds(y)),y},_tileCoordsToKey:function(u){return u.x+":"+u.y+":"+u.z},_keyToTileCoords:function(u){var p=u.split(":"),y=new O(+p[0],+p[1]);return y.z=+p[2],y},_removeTile:function(u){var p=this._tiles[u];p&&(Ut(p.el),delete this._tiles[u],this.fire("tileunload",{tile:p.el,coords:this._keyToTileCoords(u)}))},_initTile:function(u){Ve(u,"leaflet-tile");var p=this.getTileSize();u.style.width=p.x+"px",u.style.height=p.y+"px",u.onselectstart=d,u.onmousemove=d,Ne.ielt9&&this.options.opacity<1&&ei(u,this.options.opacity)},_addTile:function(u,p){var y=this._getTilePos(u),C=this._tileCoordsToKey(u),k=this.createTile(this._wrapCoords(u),o(this._tileReady,this,u));this._initTile(k),this.createTile.length<2&&z(o(this._tileReady,this,u,null,k)),rn(k,y),this._tiles[C]={el:k,coords:u,current:!0},p.appendChild(k),this.fire("tileloadstart",{tile:k,coords:u})},_tileReady:function(u,p,y){p&&this.fire("tileerror",{error:p,tile:y,coords:u});var C=this._tileCoordsToKey(u);y=this._tiles[C],y&&(y.loaded=+new Date,this._map._fadeAnimated?(ei(y.el,0),V(this._fadeFrame),this._fadeFrame=z(this._updateOpacity,this)):(y.active=!0,this._pruneTiles()),p||(Ve(y.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:y.el,coords:u})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ne.ielt9||!this._map._fadeAnimated?z(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(u){return u.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(u){var p=new O(this._wrapX?h(u.x,this._wrapX):u.x,this._wrapY?h(u.y,this._wrapY):u.y);return p.z=u.z,p},_pxBoundsToTileRange:function(u){var p=this.getTileSize();return new te(u.min.unscaleBy(p).floor(),u.max.unscaleBy(p).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var u in this._tiles)if(!this._tiles[u].loaded)return!1;return!0}});function oW(u){return new ah(u)}var dc=ah.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(u,p){this._url=u,p=x(this,p),p.detectRetina&&Ne.retina&&p.maxZoom>0?(p.tileSize=Math.floor(p.tileSize/2),p.zoomReverse?(p.zoomOffset--,p.minZoom=Math.min(p.maxZoom,p.minZoom+1)):(p.zoomOffset++,p.maxZoom=Math.max(p.minZoom,p.maxZoom-1)),p.minZoom=Math.max(0,p.minZoom)):p.zoomReverse?p.minZoom=Math.min(p.maxZoom,p.minZoom):p.maxZoom=Math.max(p.minZoom,p.maxZoom),typeof p.subdomains=="string"&&(p.subdomains=p.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(u,p){return this._url===u&&p===void 0&&(p=!0),this._url=u,p||this.redraw(),this},createTile:function(u,p){var y=document.createElement("img");return Be(y,"load",o(this._tileOnLoad,this,p,y)),Be(y,"error",o(this._tileOnError,this,p,y)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(y.referrerPolicy=this.options.referrerPolicy),y.alt="",y.src=this.getTileUrl(u),y},getTileUrl:function(u){var p={r:Ne.retina?"@2x":"",s:this._getSubdomain(u),x:u.x,y:u.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var y=this._globalTileRange.max.y-u.y;this.options.tms&&(p.y=y),p["-y"]=y}return w(this._url,i(p,this.options))},_tileOnLoad:function(u,p){Ne.ielt9?setTimeout(o(u,this,null,p),0):u(null,p)},_tileOnError:function(u,p,y){var C=this.options.errorTileUrl;C&&p.getAttribute("src")!==C&&(p.src=C),u(y,p)},_onTileRemove:function(u){u.tile.onload=null},_getZoomForUrl:function(){var u=this._tileZoom,p=this.options.maxZoom,y=this.options.zoomReverse,C=this.options.zoomOffset;return y&&(u=p-u),u+C},_getSubdomain:function(u){var p=Math.abs(u.x+u.y)%this.options.subdomains.length;return this.options.subdomains[p]},_abortLoading:function(){var u,p;for(u in this._tiles)if(this._tiles[u].coords.z!==this._tileZoom&&(p=this._tiles[u].el,p.onload=d,p.onerror=d,!p.complete)){p.src=S;var y=this._tiles[u].coords;Ut(p),delete this._tiles[u],this.fire("tileabort",{tile:p,coords:y})}},_removeTile:function(u){var p=this._tiles[u];if(p)return p.el.setAttribute("src",S),ah.prototype._removeTile.call(this,u)},_tileReady:function(u,p,y){if(!(!this._map||y&&y.getAttribute("src")===S))return ah.prototype._tileReady.call(this,u,p,y)}});function aT(u,p){return new dc(u,p)}var lT=dc.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(u,p){this._url=u;var y=i({},this.defaultWmsParams);for(var C in p)C in this.options||(y[C]=p[C]);p=x(this,p);var k=p.detectRetina&&Ne.retina?2:1,N=this.getTileSize();y.width=N.x*k,y.height=N.y*k,this.wmsParams=y},onAdd:function(u){this._crs=this.options.crs||u.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var p=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[p]=this._crs.code,dc.prototype.onAdd.call(this,u)},getTileUrl:function(u){var p=this._tileCoordsToNwSe(u),y=this._crs,C=ae(y.project(p[0]),y.project(p[1])),k=C.min,N=C.max,M=(this._wmsVersion>=1.3&&this._crs===eT?[k.y,k.x,N.y,N.x]:[k.x,k.y,N.x,N.y]).join(","),Y=dc.prototype.getTileUrl.call(this,u);return Y+_(this.wmsParams,Y,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+M},setParams:function(u,p){return i(this.wmsParams,u),p||this.redraw(),this}});function aW(u,p){return new lT(u,p)}dc.WMS=lT,aT.wms=aW;var zr=$i.extend({options:{padding:.1},initialize:function(u){x(this,u),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ve(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var u={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(u.zoomanim=this._onAnimZoom),u},_onAnimZoom:function(u){this._updateTransform(u.center,u.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(u,p){var y=this._map.getZoomScale(p,this._zoom),C=this._map.getSize().multiplyBy(.5+this.options.padding),k=this._map.project(this._center,p),N=C.multiplyBy(-y).add(k).subtract(this._map._getNewPixelOrigin(u,p));Ne.any3d?$a(this._container,N,y):rn(this._container,N)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var u in this._layers)this._layers[u]._reset()},_onZoomEnd:function(){for(var u in this._layers)this._layers[u]._project()},_updatePaths:function(){for(var u in this._layers)this._layers[u]._update()},_update:function(){var u=this.options.padding,p=this._map.getSize(),y=this._map.containerPointToLayerPoint(p.multiplyBy(-u)).round();this._bounds=new te(y,y.add(p.multiplyBy(1+u*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),cT=zr.extend({options:{tolerance:0},getEvents:function(){var u=zr.prototype.getEvents.call(this);return u.viewprereset=this._onViewPreReset,u},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var u=this._container=document.createElement("canvas");Be(u,"mousemove",this._onMouseMove,this),Be(u,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Be(u,"mouseout",this._handleMouseOut,this),u._leaflet_disable_events=!0,this._ctx=u.getContext("2d")},_destroyContainer:function(){V(this._redrawRequest),delete this._ctx,Ut(this._container),kt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var u;this._redrawBounds=null;for(var p in this._layers)u=this._layers[p],u._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zr.prototype._update.call(this);var u=this._bounds,p=this._container,y=u.getSize(),C=Ne.retina?2:1;rn(p,u.min),p.width=C*y.x,p.height=C*y.y,p.style.width=y.x+"px",p.style.height=y.y+"px",Ne.retina&&this._ctx.scale(2,2),this._ctx.translate(-u.min.x,-u.min.y),this.fire("update")}},_reset:function(){zr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(u){this._updateDashArray(u),this._layers[l(u)]=u;var p=u._order={layer:u,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=p),this._drawLast=p,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(u){this._requestRedraw(u)},_removePath:function(u){var p=u._order,y=p.next,C=p.prev;y?y.prev=C:this._drawLast=C,C?C.next=y:this._drawFirst=y,delete u._order,delete this._layers[l(u)],this._requestRedraw(u)},_updatePath:function(u){this._extendRedrawBounds(u),u._project(),u._update(),this._requestRedraw(u)},_updateStyle:function(u){this._updateDashArray(u),this._requestRedraw(u)},_updateDashArray:function(u){if(typeof u.options.dashArray=="string"){var p=u.options.dashArray.split(/[, ]+/),y=[],C,k;for(k=0;k<p.length;k++){if(C=Number(p[k]),isNaN(C))return;y.push(C)}u.options._dashArray=y}else u.options._dashArray=u.options.dashArray},_requestRedraw:function(u){this._map&&(this._extendRedrawBounds(u),this._redrawRequest=this._redrawRequest||z(this._redraw,this))},_extendRedrawBounds:function(u){if(u._pxBounds){var p=(u.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new te,this._redrawBounds.extend(u._pxBounds.min.subtract([p,p])),this._redrawBounds.extend(u._pxBounds.max.add([p,p]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var u=this._redrawBounds;if(u){var p=u.getSize();this._ctx.clearRect(u.min.x,u.min.y,p.x,p.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var u,p=this._redrawBounds;if(this._ctx.save(),p){var y=p.getSize();this._ctx.beginPath(),this._ctx.rect(p.min.x,p.min.y,y.x,y.y),this._ctx.clip()}this._drawing=!0;for(var C=this._drawFirst;C;C=C.next)u=C.layer,(!p||u._pxBounds&&u._pxBounds.intersects(p))&&u._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(u,p){if(this._drawing){var y,C,k,N,M=u._parts,Y=M.length,se=this._ctx;if(Y){for(se.beginPath(),y=0;y<Y;y++){for(C=0,k=M[y].length;C<k;C++)N=M[y][C],se[C?"lineTo":"moveTo"](N.x,N.y);p&&se.closePath()}this._fillStroke(se,u)}}},_updateCircle:function(u){if(!(!this._drawing||u._empty())){var p=u._point,y=this._ctx,C=Math.max(Math.round(u._radius),1),k=(Math.max(Math.round(u._radiusY),1)||C)/C;k!==1&&(y.save(),y.scale(1,k)),y.beginPath(),y.arc(p.x,p.y/k,C,0,Math.PI*2,!1),k!==1&&y.restore(),this._fillStroke(y,u)}},_fillStroke:function(u,p){var y=p.options;y.fill&&(u.globalAlpha=y.fillOpacity,u.fillStyle=y.fillColor||y.color,u.fill(y.fillRule||"evenodd")),y.stroke&&y.weight!==0&&(u.setLineDash&&u.setLineDash(p.options&&p.options._dashArray||[]),u.globalAlpha=y.opacity,u.lineWidth=y.weight,u.strokeStyle=y.color,u.lineCap=y.lineCap,u.lineJoin=y.lineJoin,u.stroke())},_onClick:function(u){for(var p=this._map.mouseEventToLayerPoint(u),y,C,k=this._drawFirst;k;k=k.next)y=k.layer,y.options.interactive&&y._containsPoint(p)&&(!(u.type==="click"||u.type==="preclick")||!this._map._draggableMoved(y))&&(C=y);this._fireEvent(C?[C]:!1,u)},_onMouseMove:function(u){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var p=this._map.mouseEventToLayerPoint(u);this._handleMouseHover(u,p)}},_handleMouseOut:function(u){var p=this._hoveredLayer;p&&(en(this._container,"leaflet-interactive"),this._fireEvent([p],u,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(u,p){if(!this._mouseHoverThrottled){for(var y,C,k=this._drawFirst;k;k=k.next)y=k.layer,y.options.interactive&&y._containsPoint(p)&&(C=y);C!==this._hoveredLayer&&(this._handleMouseOut(u),C&&(Ve(this._container,"leaflet-interactive"),this._fireEvent([C],u,"mouseover"),this._hoveredLayer=C)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,u),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(u,p,y){this._map._fireDOMEvent(p,y||p.type,u)},_bringToFront:function(u){var p=u._order;if(p){var y=p.next,C=p.prev;if(y)y.prev=C;else return;C?C.next=y:y&&(this._drawFirst=y),p.prev=this._drawLast,this._drawLast.next=p,p.next=null,this._drawLast=p,this._requestRedraw(u)}},_bringToBack:function(u){var p=u._order;if(p){var y=p.next,C=p.prev;if(C)C.next=y;else return;y?y.prev=C:C&&(this._drawLast=C),p.prev=null,p.next=this._drawFirst,this._drawFirst.prev=p,this._drawFirst=p,this._requestRedraw(u)}}});function uT(u){return Ne.canvas?new cT(u):null}var lh=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(u){return document.createElement("<lvml:"+u+' class="lvml">')}}catch{}return function(u){return document.createElement("<"+u+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),lW={_initContainer:function(){this._container=at("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zr.prototype._update.call(this),this.fire("update"))},_initPath:function(u){var p=u._container=lh("shape");Ve(p,"leaflet-vml-shape "+(this.options.className||"")),p.coordsize="1 1",u._path=lh("path"),p.appendChild(u._path),this._updateStyle(u),this._layers[l(u)]=u},_addPath:function(u){var p=u._container;this._container.appendChild(p),u.options.interactive&&u.addInteractiveTarget(p)},_removePath:function(u){var p=u._container;Ut(p),u.removeInteractiveTarget(p),delete this._layers[l(u)]},_updateStyle:function(u){var p=u._stroke,y=u._fill,C=u.options,k=u._container;k.stroked=!!C.stroke,k.filled=!!C.fill,C.stroke?(p||(p=u._stroke=lh("stroke")),k.appendChild(p),p.weight=C.weight+"px",p.color=C.color,p.opacity=C.opacity,C.dashArray?p.dashStyle=b(C.dashArray)?C.dashArray.join(" "):C.dashArray.replace(/( *, *)/g," "):p.dashStyle="",p.endcap=C.lineCap.replace("butt","flat"),p.joinstyle=C.lineJoin):p&&(k.removeChild(p),u._stroke=null),C.fill?(y||(y=u._fill=lh("fill")),k.appendChild(y),y.color=C.fillColor||C.color,y.opacity=C.fillOpacity):y&&(k.removeChild(y),u._fill=null)},_updateCircle:function(u){var p=u._point.round(),y=Math.round(u._radius),C=Math.round(u._radiusY||y);this._setPath(u,u._empty()?"M0 0":"AL "+p.x+","+p.y+" "+y+","+C+" 0,"+65535*360)},_setPath:function(u,p){u._path.v=p},_bringToFront:function(u){oc(u._container)},_bringToBack:function(u){ac(u._container)}},qp=Ne.vml?lh:dt,ch=zr.extend({_initContainer:function(){this._container=qp("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=qp("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ut(this._container),kt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zr.prototype._update.call(this);var u=this._bounds,p=u.getSize(),y=this._container;(!this._svgSize||!this._svgSize.equals(p))&&(this._svgSize=p,y.setAttribute("width",p.x),y.setAttribute("height",p.y)),rn(y,u.min),y.setAttribute("viewBox",[u.min.x,u.min.y,p.x,p.y].join(" ")),this.fire("update")}},_initPath:function(u){var p=u._path=qp("path");u.options.className&&Ve(p,u.options.className),u.options.interactive&&Ve(p,"leaflet-interactive"),this._updateStyle(u),this._layers[l(u)]=u},_addPath:function(u){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(u._path),u.addInteractiveTarget(u._path)},_removePath:function(u){Ut(u._path),u.removeInteractiveTarget(u._path),delete this._layers[l(u)]},_updatePath:function(u){u._project(),u._update()},_updateStyle:function(u){var p=u._path,y=u.options;p&&(y.stroke?(p.setAttribute("stroke",y.color),p.setAttribute("stroke-opacity",y.opacity),p.setAttribute("stroke-width",y.weight),p.setAttribute("stroke-linecap",y.lineCap),p.setAttribute("stroke-linejoin",y.lineJoin),y.dashArray?p.setAttribute("stroke-dasharray",y.dashArray):p.removeAttribute("stroke-dasharray"),y.dashOffset?p.setAttribute("stroke-dashoffset",y.dashOffset):p.removeAttribute("stroke-dashoffset")):p.setAttribute("stroke","none"),y.fill?(p.setAttribute("fill",y.fillColor||y.color),p.setAttribute("fill-opacity",y.fillOpacity),p.setAttribute("fill-rule",y.fillRule||"evenodd")):p.setAttribute("fill","none"))},_updatePoly:function(u,p){this._setPath(u,ot(u._parts,p))},_updateCircle:function(u){var p=u._point,y=Math.max(Math.round(u._radius),1),C=Math.max(Math.round(u._radiusY),1)||y,k="a"+y+","+C+" 0 1,0 ",N=u._empty()?"M0 0":"M"+(p.x-y)+","+p.y+k+y*2+",0 "+k+-y*2+",0 ";this._setPath(u,N)},_setPath:function(u,p){u._path.setAttribute("d",p)},_bringToFront:function(u){oc(u._path)},_bringToBack:function(u){ac(u._path)}});Ne.vml&&ch.include(lW);function hT(u){return Ne.svg||Ne.vml?new ch(u):null}nt.include({getRenderer:function(u){var p=u.options.renderer||this._getPaneRenderer(u.options.pane)||this.options.renderer||this._renderer;return p||(p=this._renderer=this._createRenderer()),this.hasLayer(p)||this.addLayer(p),p},_getPaneRenderer:function(u){if(u==="overlayPane"||u===void 0)return!1;var p=this._paneRenderers[u];return p===void 0&&(p=this._createRenderer({pane:u}),this._paneRenderers[u]=p),p},_createRenderer:function(u){return this.options.preferCanvas&&uT(u)||hT(u)}});var dT=uc.extend({initialize:function(u,p){uc.prototype.initialize.call(this,this._boundsToLatLngs(u),p)},setBounds:function(u){return this.setLatLngs(this._boundsToLatLngs(u))},_boundsToLatLngs:function(u){return u=he(u),[u.getSouthWest(),u.getNorthWest(),u.getNorthEast(),u.getSouthEast()]}});function cW(u,p){return new dT(u,p)}ch.create=qp,ch.pointsToPath=ot,Mr.geometryToLayer=Bp,Mr.coordsToLatLng=s_,Mr.coordsToLatLngs=Up,Mr.latLngToCoords=i_,Mr.latLngsToCoords=Wp,Mr.getFeature=hc,Mr.asFeature=Vp,nt.mergeOptions({boxZoom:!0});var fT=or.extend({initialize:function(u){this._map=u,this._container=u._container,this._pane=u._panes.overlayPane,this._resetStateTimeout=0,u.on("unload",this._destroy,this)},addHooks:function(){Be(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){kt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ut(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(u){if(!u.shiftKey||u.which!==1&&u.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),eh(),Bx(),this._startPoint=this._map.mouseEventToContainerPoint(u),Be(document,{contextmenu:Da,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(u){this._moved||(this._moved=!0,this._box=at("div","leaflet-zoom-box",this._container),Ve(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(u);var p=new te(this._point,this._startPoint),y=p.getSize();rn(this._box,p.min),this._box.style.width=y.x+"px",this._box.style.height=y.y+"px"},_finish:function(){this._moved&&(Ut(this._box),en(this._container,"leaflet-crosshair")),th(),Ux(),kt(document,{contextmenu:Da,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(u){if(!(u.which!==1&&u.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var p=new ue(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(p).fire("boxzoomend",{boxZoomBounds:p})}},_onKeyDown:function(u){u.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nt.addInitHook("addHandler","boxZoom",fT),nt.mergeOptions({doubleClickZoom:!0});var pT=or.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(u){var p=this._map,y=p.getZoom(),C=p.options.zoomDelta,k=u.originalEvent.shiftKey?y-C:y+C;p.options.doubleClickZoom==="center"?p.setZoom(k):p.setZoomAround(u.containerPoint,k)}});nt.addInitHook("addHandler","doubleClickZoom",pT),nt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var mT=or.extend({addHooks:function(){if(!this._draggable){var u=this._map;this._draggable=new vo(u._mapPane,u._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),u.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),u.on("zoomend",this._onZoomEnd,this),u.whenReady(this._onZoomEnd,this))}Ve(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){en(this._map._container,"leaflet-grab"),en(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var u=this._map;if(u._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var p=he(this._map.options.maxBounds);this._offsetLimit=ae(this._map.latLngToContainerPoint(p.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(p.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;u.fire("movestart").fire("dragstart"),u.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(u){if(this._map.options.inertia){var p=this._lastTime=+new Date,y=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(y),this._times.push(p),this._prunePositions(p)}this._map.fire("move",u).fire("drag",u)},_prunePositions:function(u){for(;this._positions.length>1&&u-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var u=this._map.getSize().divideBy(2),p=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=p.subtract(u).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(u,p){return u-(u-p)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var u=this._draggable._newPos.subtract(this._draggable._startPos),p=this._offsetLimit;u.x<p.min.x&&(u.x=this._viscousLimit(u.x,p.min.x)),u.y<p.min.y&&(u.y=this._viscousLimit(u.y,p.min.y)),u.x>p.max.x&&(u.x=this._viscousLimit(u.x,p.max.x)),u.y>p.max.y&&(u.y=this._viscousLimit(u.y,p.max.y)),this._draggable._newPos=this._draggable._startPos.add(u)}},_onPreDragWrap:function(){var u=this._worldWidth,p=Math.round(u/2),y=this._initialWorldOffset,C=this._draggable._newPos.x,k=(C-p+y)%u+p-y,N=(C+p+y)%u-p-y,M=Math.abs(k+y)<Math.abs(N+y)?k:N;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=M},_onDragEnd:function(u){var p=this._map,y=p.options,C=!y.inertia||u.noInertia||this._times.length<2;if(p.fire("dragend",u),C)p.fire("moveend");else{this._prunePositions(+new Date);var k=this._lastPos.subtract(this._positions[0]),N=(this._lastTime-this._times[0])/1e3,M=y.easeLinearity,Y=k.multiplyBy(M/N),se=Y.distanceTo([0,0]),fe=Math.min(y.inertiaMaxSpeed,se),be=Y.multiplyBy(fe/se),Pe=fe/(y.inertiaDeceleration*M),qe=be.multiplyBy(-Pe/2).round();!qe.x&&!qe.y?p.fire("moveend"):(qe=p._limitOffset(qe,p.options.maxBounds),z(function(){p.panBy(qe,{duration:Pe,easeLinearity:M,noMoveStart:!0,animate:!0})}))}}});nt.addInitHook("addHandler","dragging",mT),nt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var gT=or.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(u){this._map=u,this._setPanDelta(u.options.keyboardPanDelta),this._setZoomDelta(u.options.zoomDelta)},addHooks:function(){var u=this._map._container;u.tabIndex<=0&&(u.tabIndex="0"),Be(u,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),kt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var u=document.body,p=document.documentElement,y=u.scrollTop||p.scrollTop,C=u.scrollLeft||p.scrollLeft;this._map._container.focus(),window.scrollTo(C,y)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(u){var p=this._panKeys={},y=this.keyCodes,C,k;for(C=0,k=y.left.length;C<k;C++)p[y.left[C]]=[-1*u,0];for(C=0,k=y.right.length;C<k;C++)p[y.right[C]]=[u,0];for(C=0,k=y.down.length;C<k;C++)p[y.down[C]]=[0,u];for(C=0,k=y.up.length;C<k;C++)p[y.up[C]]=[0,-1*u]},_setZoomDelta:function(u){var p=this._zoomKeys={},y=this.keyCodes,C,k;for(C=0,k=y.zoomIn.length;C<k;C++)p[y.zoomIn[C]]=u;for(C=0,k=y.zoomOut.length;C<k;C++)p[y.zoomOut[C]]=-u},_addHooks:function(){Be(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){kt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(u){if(!(u.altKey||u.ctrlKey||u.metaKey)){var p=u.keyCode,y=this._map,C;if(p in this._panKeys){if(!y._panAnim||!y._panAnim._inProgress)if(C=this._panKeys[p],u.shiftKey&&(C=j(C).multiplyBy(3)),y.options.maxBounds&&(C=y._limitOffset(j(C),y.options.maxBounds)),y.options.worldCopyJump){var k=y.wrapLatLng(y.unproject(y.project(y.getCenter()).add(C)));y.panTo(k)}else y.panBy(C)}else if(p in this._zoomKeys)y.setZoom(y.getZoom()+(u.shiftKey?3:1)*this._zoomKeys[p]);else if(p===27&&y._popup&&y._popup.options.closeOnEscapeKey)y.closePopup();else return;Da(u)}}});nt.addInitHook("addHandler","keyboard",gT),nt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var yT=or.extend({addHooks:function(){Be(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){kt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(u){var p=US(u),y=this._map.options.wheelDebounceTime;this._delta+=p,this._lastMousePos=this._map.mouseEventToContainerPoint(u),this._startTime||(this._startTime=+new Date);var C=Math.max(y-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),C),Da(u)},_performZoom:function(){var u=this._map,p=u.getZoom(),y=this._map.options.zoomSnap||0;u._stop();var C=this._delta/(this._map.options.wheelPxPerZoomLevel*4),k=4*Math.log(2/(1+Math.exp(-Math.abs(C))))/Math.LN2,N=y?Math.ceil(k/y)*y:k,M=u._limitZoom(p+(this._delta>0?N:-N))-p;this._delta=0,this._startTime=null,M&&(u.options.scrollWheelZoom==="center"?u.setZoom(p+M):u.setZoomAround(this._lastMousePos,p+M))}});nt.addInitHook("addHandler","scrollWheelZoom",yT);var uW=600;nt.mergeOptions({tapHold:Ne.touchNative&&Ne.safari&&Ne.mobile,tapTolerance:15});var vT=or.extend({addHooks:function(){Be(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){kt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(u){if(clearTimeout(this._holdTimeout),u.touches.length===1){var p=u.touches[0];this._startPos=this._newPos=new O(p.clientX,p.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(Be(document,"touchend",Fn),Be(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",p))},this),uW),Be(document,"touchend touchcancel contextmenu",this._cancel,this),Be(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function u(){kt(document,"touchend",Fn),kt(document,"touchend touchcancel",u)},_cancel:function(){clearTimeout(this._holdTimeout),kt(document,"touchend touchcancel contextmenu",this._cancel,this),kt(document,"touchmove",this._onMove,this)},_onMove:function(u){var p=u.touches[0];this._newPos=new O(p.clientX,p.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(u,p){var y=new MouseEvent(u,{bubbles:!0,cancelable:!0,view:window,screenX:p.screenX,screenY:p.screenY,clientX:p.clientX,clientY:p.clientY});y._simulated=!0,p.target.dispatchEvent(y)}});nt.addInitHook("addHandler","tapHold",vT),nt.mergeOptions({touchZoom:Ne.touch,bounceAtZoomLimits:!0});var xT=or.extend({addHooks:function(){Ve(this._map._container,"leaflet-touch-zoom"),Be(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){en(this._map._container,"leaflet-touch-zoom"),kt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(u){var p=this._map;if(!(!u.touches||u.touches.length!==2||p._animatingZoom||this._zooming)){var y=p.mouseEventToContainerPoint(u.touches[0]),C=p.mouseEventToContainerPoint(u.touches[1]);this._centerPoint=p.getSize()._divideBy(2),this._startLatLng=p.containerPointToLatLng(this._centerPoint),p.options.touchZoom!=="center"&&(this._pinchStartLatLng=p.containerPointToLatLng(y.add(C)._divideBy(2))),this._startDist=y.distanceTo(C),this._startZoom=p.getZoom(),this._moved=!1,this._zooming=!0,p._stop(),Be(document,"touchmove",this._onTouchMove,this),Be(document,"touchend touchcancel",this._onTouchEnd,this),Fn(u)}},_onTouchMove:function(u){if(!(!u.touches||u.touches.length!==2||!this._zooming)){var p=this._map,y=p.mouseEventToContainerPoint(u.touches[0]),C=p.mouseEventToContainerPoint(u.touches[1]),k=y.distanceTo(C)/this._startDist;if(this._zoom=p.getScaleZoom(k,this._startZoom),!p.options.bounceAtZoomLimits&&(this._zoom<p.getMinZoom()&&k<1||this._zoom>p.getMaxZoom()&&k>1)&&(this._zoom=p._limitZoom(this._zoom)),p.options.touchZoom==="center"){if(this._center=this._startLatLng,k===1)return}else{var N=y._add(C)._divideBy(2)._subtract(this._centerPoint);if(k===1&&N.x===0&&N.y===0)return;this._center=p.unproject(p.project(this._pinchStartLatLng,this._zoom).subtract(N),this._zoom)}this._moved||(p._moveStart(!0,!1),this._moved=!0),V(this._animRequest);var M=o(p._move,p,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=z(M,this,!0),Fn(u)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,V(this._animRequest),kt(document,"touchmove",this._onTouchMove,this),kt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});nt.addInitHook("addHandler","touchZoom",xT),nt.BoxZoom=fT,nt.DoubleClickZoom=pT,nt.Drag=mT,nt.Keyboard=gT,nt.ScrollWheelZoom=yT,nt.TapHold=vT,nt.TouchZoom=xT,n.Bounds=te,n.Browser=Ne,n.CRS=we,n.Canvas=cT,n.Circle=n_,n.CircleMarker=zp,n.Class=K,n.Control=Ni,n.DivIcon=oT,n.DivOverlay=ar,n.DomEvent=EU,n.DomUtil=SU,n.Draggable=vo,n.Evented=oe,n.FeatureGroup=Lr,n.GeoJSON=Mr,n.GridLayer=ah,n.Handler=or,n.Icon=cc,n.ImageOverlay=jp,n.LatLng=le,n.LatLngBounds=ue,n.Layer=$i,n.LayerGroup=lc,n.LineUtil=UU,n.Map=nt,n.Marker=Mp,n.Mixin=OU,n.Path=xo,n.Point=O,n.PolyUtil=LU,n.Polygon=uc,n.Polyline=Fr,n.Popup=Gp,n.PosAnimation=WS,n.Projection=WU,n.Rectangle=dT,n.Renderer=zr,n.SVG=ch,n.SVGOverlay=rT,n.TileLayer=dc,n.Tooltip=Hp,n.Transformation=Me,n.Util=q,n.VideoOverlay=iT,n.bind=o,n.bounds=ae,n.canvas=uT,n.circle=ZU,n.circleMarker=XU,n.control=ih,n.divIcon=rW,n.extend=i,n.featureGroup=HU,n.geoJSON=sT,n.geoJson=JU,n.gridLayer=oW,n.icon=qU,n.imageOverlay=eW,n.latLng=ce,n.latLngBounds=he,n.layerGroup=GU,n.map=NU,n.marker=KU,n.point=j,n.polygon=QU,n.polyline=YU,n.popup=sW,n.rectangle=cW,n.setOptions=x,n.stamp=l,n.svg=hT,n.svgOverlay=nW,n.tileLayer=aT,n.tooltip=iW,n.transformation=Qe,n.version=s,n.videoOverlay=tW;var hW=window.L;n.noConflict=function(){return window.L=hW,this},window.L=n})})(fb,fb.exports);var Ip=fb.exports;const Hu=Tb(Ip);function Wk(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function Vk(t,e){return e==null?function(s,i){const r=ne.useRef();return r.current||(r.current=t(s,i)),r}:function(s,i){const r=ne.useRef();r.current||(r.current=t(s,i));const o=ne.useRef(s),{instance:a}=r.current;return ne.useEffect(function(){o.current!==s&&(e(a,s,o.current),o.current=s)},[a,s,i]),r}}function ywe(t,e){ne.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var r;(r=e.layerContainer)==null||r.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function zB(t){return function(n){const s=Bk(),i=t(Uk(n,s),s);return OB(s.map,n.attribution),MB(i.current,n.eventHandlers),ywe(i.current,s),i}}function vwe(t,e){const n=Vk(t,e),s=zB(n);return fwe(s)}function xwe(t,e){const n=Vk(t),s=gwe(n,e);return pwe(s)}function _we(t,e){const n=Vk(t,e),s=zB(n);return mwe(s)}function wwe(t,e,n){const{opacity:s,zIndex:i}=e;s!=null&&s!==n.opacity&&t.setOpacity(s),i!=null&&i!==n.zIndex&&t.setZIndex(i)}function bwe(){return Bk().map}function pb(){return pb=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},pb.apply(this,arguments)}function Cwe({bounds:t,boundsOptions:e,center:n,children:s,className:i,id:r,placeholder:o,style:a,whenReady:l,zoom:c,...h},d){const[f]=ne.useState({className:i,id:r,style:a}),[m,g]=ne.useState(null);ne.useImperativeHandle(d,()=>(m==null?void 0:m.map)??null,[m]);const x=ne.useCallback(v=>{if(v!==null&&m===null){const w=new Ip.Map(v,h);n!=null&&c!=null?w.setView(n,c):t!=null&&w.fitBounds(t,e),l!=null&&w.whenReady(l),g(hwe(w))}},[]);ne.useEffect(()=>()=>{m==null||m.map.remove()},[m]);const _=m?Km.createElement(FB,{value:m},s):o??null;return Km.createElement("div",pb({},f,{ref:x}),_)}const Iwe=ne.forwardRef(Cwe),f$=vwe(function({position:e,...n},s){const i=new Ip.Marker(e,n);return Wk(i,dwe(s,{overlayContainer:i}))},function(e,n,s){n.position!==s.position&&e.setLatLng(n.position),n.icon!=null&&n.icon!==s.icon&&e.setIcon(n.icon),n.zIndexOffset!=null&&n.zIndexOffset!==s.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),n.opacity!=null&&n.opacity!==s.opacity&&e.setOpacity(n.opacity),e.dragging!=null&&n.draggable!==s.draggable&&(n.draggable===!0?e.dragging.enable():e.dragging.disable())}),p$=xwe(function(e,n){const s=new Ip.Popup(e,n.overlayContainer);return Wk(s,n)},function(e,n,{position:s},i){ne.useEffect(function(){const{instance:o}=e;function a(c){c.popup===o&&(o.update(),i(!0))}function l(c){c.popup===o&&i(!1)}return n.map.on({popupopen:a,popupclose:l}),n.overlayContainer==null?(s!=null&&o.setLatLng(s),o.openOn(n.map)):n.overlayContainer.bindPopup(o),function(){var h;n.map.off({popupopen:a,popupclose:l}),(h=n.overlayContainer)==null||h.unbindPopup(),n.map.removeLayer(o)}},[e,n,i,s])}),kwe=_we(function({url:e,...n},s){const i=new Ip.TileLayer(e,Uk(n,s));return Wk(i,s)},function(e,n,s){wwe(e,n,s);const{url:i}=n;i!=null&&i!==s.url&&e.setUrl(i)});delete Hu.Icon.Default.prototype._getIconUrl;Hu.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Swe=new Hu.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),m$=new Hu.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Twe=new Hu.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Ewe=new Hu.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function Nwe({position:t}){const e=bwe();return ne.useEffect(()=>{t&&e.setView(t,14)},[t,e]),null}function $we(){const[t,e]=ne.useState(null),[n,s]=ne.useState([]),[i,r]=ne.useState(!0),[o,a]=ne.useState(null),[l,c]=ne.useState(3e4),[h,d]=ne.useState("hospital"),f=[{value:"hospital",label:"Hospitals",icon:m$},{value:"clinic",label:"Clinics",icon:Twe},{value:"pharmacy",label:"Pharmacies",icon:Ewe}];ne.useEffect(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(v=>{const w={lat:v.coords.latitude,lng:v.coords.longitude};console.log("User location:",w),e(w),m(w,l,h)},v=>{console.error("Error getting location:",v),a("Unable to get your location. Please enable location services and refresh the page."),r(!1)}):(a("Geolocation is not supported by your browser."),r(!1))},[]);const m=async(v,w,b)=>{try{const I=`
        [out:json][timeout:25];
        (
          node["amenity"="${b}"](around:${w},${v.lat},${v.lng});
          way["amenity"="${b}"](around:${w},${v.lat},${v.lng});
          relation["amenity"="${b}"](around:${w},${v.lat},${v.lng});
        );
        out body;
        >;
        out skel qt;
      `,S=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:I,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const T=await S.json();if(console.log("Overpass API response:",T),!T||!T.elements)throw new Error("Invalid data received from Overpass API");const $=T.elements.filter(E=>E.tags&&E.lat&&E.lon).map(E=>({id:E.id,name:E.tags.name||`Unnamed ${b}`,lat:E.lat,lng:E.lon,address:E.tags["addr:street"]?`${E.tags["addr:street"]} ${E.tags["addr:housenumber"]||""}`:"Address not available",phone:E.tags.phone||null}));s($),$.length===0?a(`No ${b}s found within ${w/1e3} km. Try increasing the search radius.`):a(null)}catch(I){console.error("Error fetching places:",I),a(`Unable to fetch nearby ${b}s. Please try again later.`)}finally{r(!1)}},g=v=>{if(t){const w=`https://www.openstreetmap.org/directions?engine=osrm_car&route=${t.lat},${t.lng};${v.lat},${v.lng}`;window.open(w,"_blank")}else a("Unable to get your current location for directions.")},x=v=>{const w=Number(v.target.value);c(w),t&&m(t,w,h)},_=v=>{const w=v.target.value;d(w),t&&m(t,l,w)};return o?A.jsx("div",{className:"container mx-auto px-4 py-8",children:A.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 rounded",children:A.jsxs("div",{className:"flex",children:[A.jsx("div",{className:"flex-shrink-0",children:A.jsx(_g,{className:"h-5 w-5 text-red-400"})}),A.jsx("div",{className:"ml-3",children:A.jsx("p",{className:"text-sm text-red-700",children:o})})]})})}):A.jsxs("div",{className:"container mx-auto px-4 py-8",children:[A.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Nearby Hospitals & Pharmacies"}),A.jsxs("div",{className:"mb-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"placeType",className:"block text-sm font-medium text-gray-700",children:"Place Type:"}),A.jsx("select",{id:"placeType",value:h,onChange:_,className:"mt-1 block w-full p-2 border rounded",children:f.map(v=>A.jsx("option",{value:v.value,children:v.label},v.value))})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"searchRadius",className:"block text-sm font-medium text-gray-700",children:"Search Radius (km):"}),A.jsxs("select",{id:"searchRadius",value:l,onChange:x,className:"mt-1 block w-full p-2 border rounded",children:[A.jsx("option",{value:5e3,children:"5 km"}),A.jsx("option",{value:1e4,children:"10 km"}),A.jsx("option",{value:2e4,children:"20 km"}),A.jsx("option",{value:5e4,children:"50 km"})]})]})]}),i?A.jsx("div",{className:"flex justify-center items-center h-64",children:A.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):A.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[A.jsx("div",{className:"md:col-span-2 h-[600px] relative",children:t&&A.jsxs(Iwe,{center:[t.lat,t.lng],zoom:14,style:{height:"100%",width:"100%"},className:"rounded-lg shadow-md",children:[A.jsx(kwe,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),A.jsx(Nwe,{position:[t.lat,t.lng]}),A.jsx(f$,{position:[t.lat,t.lng],icon:Swe,children:A.jsx(p$,{children:"You are here"})}),n.map(v=>{var w;return A.jsx(f$,{position:[v.lat,v.lng],icon:((w=f.find(b=>b.value===h))==null?void 0:w.icon)||m$,children:A.jsx(p$,{children:A.jsxs("div",{className:"min-w-[200px]",children:[A.jsx("h3",{className:"font-semibold",children:v.name}),A.jsx("p",{className:"text-sm text-gray-600",children:v.address})]})})},v.id)})]},`${t.lat}-${t.lng}`)}),A.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:n.length===0?A.jsxs("div",{className:"text-center text-gray-500",children:["No ",h,"s found in your area"]}):n.map(v=>A.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow",children:[A.jsx("h3",{className:"font-semibold mb-2",children:v.name}),A.jsxs("p",{className:"text-sm text-gray-600 mb-2 flex items-center gap-2",children:[A.jsx(eH,{size:16}),v.address]}),A.jsxs("div",{className:"flex gap-2 mt-4",children:[v.phone&&A.jsxs("a",{href:`tel:${v.phone}`,className:"flex items-center gap-1 bg-green-500 text-white px-3 py-1 rounded-md text-sm hover:bg-green-600 transition-colors","aria-label":"Call place",children:[A.jsx(sH,{size:16}),"Call"]}),A.jsxs("button",{onClick:()=>g(v),className:"flex items-center gap-1 bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors","aria-label":"Get directions to place",children:[A.jsx(nH,{size:16}),"Directions"]})]})]},v.id))})]})]})}var g$={};const y$="@firebase/database",v$="1.0.12";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BB="";function Rwe(t){BB=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Awe{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Nn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Cd(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dwe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Pr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UB=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Awe(e)}}catch{}return new Dwe},tl=UB("localStorage"),Pwe=UB("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new Wy("@firebase/database"),Owe=function(){let t=1;return function(){return t++}}(),WB=function(t){const e=AH(t),n=new EH;n.update(e);const s=n.digest();return I1.encodeByteArray(s)},kp=function(...t){let e="";for(let n=0;n<t.length;n++){const s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=kp.apply(null,s):typeof s=="object"?e+=Nn(s):e+=s,e+=" "}return e};let Jh=null,x$=!0;const Lwe=function(t,e){ge(!0,"Can't turn on custom loggers persistently."),Zc.logLevel=xt.VERBOSE,Jh=Zc.log.bind(Zc)},es=function(...t){if(x$===!0&&(x$=!1,Jh===null&&Pwe.get("logging_enabled")===!0&&Lwe()),Jh){const e=kp.apply(null,t);Jh(e)}},Sp=function(t){return function(...e){es(t,...e)}},mb=function(...t){const e="FIREBASE INTERNAL ERROR: "+kp(...t);Zc.error(e)},uo=function(...t){const e=`FIREBASE FATAL ERROR: ${kp(...t)}`;throw Zc.error(e),new Error(e)},As=function(...t){const e="FIREBASE WARNING: "+kp(...t);Zc.warn(e)},Fwe=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&As("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},jk=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Mwe=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Dl="[MIN_NAME]",aa="[MAX_NAME]",qu=function(t,e){if(t===e)return 0;if(t===Dl||e===aa)return-1;if(e===Dl||t===aa)return 1;{const n=_$(t),s=_$(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},zwe=function(t,e){return t===e?0:t<e?-1:1},Ch=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Nn(e))},Gk=function(t){if(typeof t!="object"||t===null)return Nn(t);const e=[];for(const s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=Nn(e[s]),n+=":",n+=Gk(t[e[s]]);return n+="}",n},VB=function(t,e){const n=t.length;if(n<=e)return[t];const s=[];for(let i=0;i<n;i+=e)i+e>n?s.push(t.substring(i,n)):s.push(t.substring(i,i+e));return s};function Ls(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const jB=function(t){ge(!jk(t),"Invalid JSON number");const e=11,n=52,s=(1<<e-1)-1;let i,r,o,a,l;t===0?(r=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),r=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-s-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();const h=c.join("");let d="";for(l=0;l<64;l+=8){let f=parseInt(h.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},Bwe=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Uwe=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Wwe(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}const Vwe=new RegExp("^-?(0*)\\d{1,10}$"),jwe=-2147483648,Gwe=2147483647,_$=function(t){if(Vwe.test(t)){const e=Number(t);if(e>=jwe&&e<=Gwe)return e}return null},Ku=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw As("Exception was thrown by user callback.",n),e},Math.floor(0))}},Hwe=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ed=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qwe{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,li(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){As(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kwe{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(es("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',As(e)}}class qm{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}qm.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk="5",GB="v",HB="s",qB="r",KB="f",XB=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ZB="ls",YB="p",gb="ac",QB="websocket",JB="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(e,n,s,i,r=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=tl.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&tl.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Xwe(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function t4(t,e,n){ge(typeof e=="string","typeof type must == string"),ge(typeof n=="object","typeof params must == object");let s;if(e===QB)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===JB)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Xwe(t)&&(n.ns=t.namespace);const i=[];return Ls(n,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zwe{constructor(){this.counters_={}}incrementCounter(e,n=1){Pr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return hH(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f0={},p0={};function qk(t){const e=t.toString();return f0[e]||(f0[e]=new Zwe),f0[e]}function Ywe(t,e){const n=t.toString();return p0[n]||(p0[n]=e()),p0[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qwe{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Ku(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w$="start",Jwe="close",ebe="pLPCommand",tbe="pRTLPCB",n4="id",s4="pw",i4="ser",nbe="cb",sbe="seg",ibe="ts",rbe="d",obe="dframe",r4=1870,o4=30,abe=r4-o4,lbe=25e3,cbe=3e4;class Oc{constructor(e,n,s,i,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Sp(e),this.stats_=qk(n),this.urlFn=l=>(this.appCheckToken&&(l[gb]=this.appCheckToken),t4(n,JB,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Qwe(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(cbe)),Mwe(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Kk((...r)=>{const[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===w$)this.id=a,this.password=l;else if(o===Jwe)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[w$]="t",s[i4]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[nbe]=this.scriptTagHolder.uniqueCallbackIdentifier),s[GB]=Hk,this.transportSessionId&&(s[HB]=this.transportSessionId),this.lastSessionId&&(s[ZB]=this.lastSessionId),this.applicationId&&(s[YB]=this.applicationId),this.appCheckToken&&(s[gb]=this.appCheckToken),typeof location<"u"&&location.hostname&&XB.test(location.hostname)&&(s[qB]=KB);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Oc.forceAllow_=!0}static forceDisallow(){Oc.forceDisallow_=!0}static isAvailable(){return Oc.forceAllow_?!0:!Oc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Bwe()&&!Uwe()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Nn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=AD(n),i=VB(s,abe);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const s={};s[obe]="t",s[n4]=e,s[s4]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Nn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Kk{constructor(e,n,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Owe(),window[ebe+this.uniqueCallbackIdentifier]=e,window[tbe+this.uniqueCallbackIdentifier]=n,this.myIFrame=Kk.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){es("frame writing exception"),a.stack&&es(a.stack),es(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||es("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[n4]=this.myID,e[s4]=this.myPW,e[i4]=this.currentSerial;let n=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+o4+s.length<=r4;){const o=this.pendingSegs.shift();s=s+"&"+sbe+i+"="+o.seg+"&"+ibe+i+"="+o.ts+"&"+rbe+i+"="+o.d,i++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(s,Math.floor(lbe)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{es("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ube=16384,hbe=45e3;let cy=null;typeof MozWebSocket<"u"?cy=MozWebSocket:typeof WebSocket<"u"&&(cy=WebSocket);class zi{constructor(e,n,s,i,r,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Sp(this.connId),this.stats_=qk(n),this.connURL=zi.connectionURL_(n,o,a,i,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,s,i,r){const o={};return o[GB]=Hk,typeof location<"u"&&location.hostname&&XB.test(location.hostname)&&(o[qB]=KB),n&&(o[HB]=n),s&&(o[ZB]=s),i&&(o[gb]=i),r&&(o[YB]=r),t4(e,QB,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tl.set("previous_websocket_failure",!0);try{let s;wH(),this.mySock=new cy(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){zi.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&cy!==null&&!zi.forceDisallow_}static previouslyFailed(){return tl.isInMemoryStorage||tl.get("previous_websocket_failure")===!0}markConnectionHealthy(){tl.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const s=Cd(n);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ge(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const n=Nn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=VB(n,ube);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(hbe))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}zi.responsesRequiredToBeHealthy=2;zi.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{static get ALL_TRANSPORTS(){return[Oc,zi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=zi&&zi.isAvailable();let s=n&&!zi.previouslyFailed();if(e.webSocketOnly&&(n||As("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[zi];else{const i=this.transports_=[];for(const r of Ud.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Ud.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ud.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dbe=6e4,fbe=5e3,pbe=10*1024,mbe=100*1024,m0="t",b$="d",gbe="s",C$="r",ybe="e",I$="o",k$="a",S$="n",T$="p",vbe="h";class xbe{constructor(e,n,s,i,r,o,a,l,c,h){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Sp("c:"+this.id+":"),this.transportManager_=new Ud(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ed(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>mbe?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>pbe?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(m0 in e){const n=e[m0];n===k$?this.upgradeIfSecondaryHealthy_():n===C$?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===I$&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Ch("t",e),s=Ch("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:T$,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:k$,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:S$,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Ch("t",e),s=Ch("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Ch(m0,e);if(b$ in e){const s=e[b$];if(n===vbe){const i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===S$){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===gbe?this.onConnectionShutdown_(s):n===C$?this.onReset_(s):n===ybe?mb("Server Error: "+s):n===I$?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):mb("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Hk!==s&&As("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),ed(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(dbe))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ed(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(fbe))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:T$,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tl.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{put(e,n,s,i){}merge(e,n,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4{constructor(e){this.allowedEvents_=e,this.listeners_={},ge(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});const i=this.getInitialEvent(e);i&&n.apply(s,i)}off(e,n,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===n&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){ge(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy extends l4{static getInstance(){return new uy}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!S1()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ge(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E$=32,N$=768;class wt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function ht(){return new wt("")}function Ke(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function la(t){return t.pieces_.length-t.pieceNum_}function St(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new wt(t.pieces_,e)}function c4(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function _be(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function u4(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function h4(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new wt(e,0)}function wn(t,e){const n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof wt)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&n.push(s[i])}return new wt(n,0)}function Xe(t){return t.pieceNum_>=t.pieces_.length}function Ss(t,e){const n=Ke(t),s=Ke(e);if(n===null)return e;if(n===s)return Ss(St(t),St(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Xk(t,e){if(la(t)!==la(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function Ui(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(la(t)>la(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}class wbe{constructor(e,n){this.errorPrefix_=n,this.parts_=u4(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Uy(this.parts_[s]);d4(this)}}function bbe(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Uy(e),d4(t)}function Cbe(t){const e=t.parts_.pop();t.byteLength_-=Uy(e),t.parts_.length>0&&(t.byteLength_-=1)}function d4(t){if(t.byteLength_>N$)throw new Error(t.errorPrefix_+"has a key path longer than "+N$+" bytes ("+t.byteLength_+").");if(t.parts_.length>E$)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+E$+") or object contains a cycle "+ja(t))}function ja(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk extends l4{static getInstance(){return new Zk}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return ge(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih=1e3,Ibe=60*5*1e3,$$=30*1e3,kbe=1.3,Sbe=3e4,Tbe="server_kill",R$=3;class Jr extends a4{constructor(e,n,s,i,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Jr.nextPersistentConnectionId_++,this.log_=Sp("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ih,this.maxReconnectDelay_=Ibe,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Zk.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&uy.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,s){const i=++this.requestNumber_,r={r:i,a:e,b:n};this.log_(Nn(r)),ge(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const n=new By,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ge(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:e,tag:s};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(e){const n=e.query,s=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;Jr.warnOnListenWarnings_(l,n),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Pr(e,"w")){const s=ru(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();As(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||TH(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=$$)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=SH(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,s=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(e,n){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,n)}sendUnlisten_(e,n,s,i){this.log_("Unlisten on "+e+" for "+n);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:s})}onDisconnectMerge(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:s})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,s,i){const r={p:n,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,n,s,i){this.putInternal("p",e,n,s,i)}merge(e,n,s,i){this.putInternal("m",e,n,s,i)}putInternal(e,n,s,i,r){this.initConnection_();const o={p:n,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,s,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Nn(e));const n=e.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):mb("Unrecognized action received from server: "+Nn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ge(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ih,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ih,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Sbe&&(this.reconnectDelay_=Ih),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*kbe)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Jr.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},c=function(d){ge(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?es("getToken() completed but was canceled"):(es("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new xbe(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,s,m=>{As(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(Tbe)},r))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&As(d),l())}}}interrupt(e){es("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){es("Resuming connection for reason: "+e),delete this.interruptReasons_[e],yw(this.interruptReasons_)&&(this.reconnectDelay_=Ih,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let s;n?s=n.map(r=>Gk(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const s=new wt(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(n),r.delete(n),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,n){es("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=R$&&(this.reconnectDelay_=$$,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){es("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=R$&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+BB.replace(/\./g,"-")]=1,S1()?e["framework.cordova"]=1:MD()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=uy.getInstance().currentlyOnline();return yw(this.interruptReasons_)&&e}}Jr.nextPersistentConnectionId_=0;Jr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Ze(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const s=new Ze(Dl,e),i=new Ze(Dl,n);return this.compare(s,i)!==0}minPost(){return Ze.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tm;class f4 extends Ix{static get __EMPTY_NODE(){return Tm}static set __EMPTY_NODE(e){Tm=e}compare(e,n){return qu(e.name,n.name)}isDefinedOn(e){throw ku("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Ze.MIN}maxPost(){return new Ze(aa,Tm)}makePost(e,n){return ge(typeof e=="string","KeyIndex indexValue must always be a string."),new Ze(e,Tm)}toString(){return".key"}}const ll=new f4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,n,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class En{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s??En.RED,this.left=i??Ts.EMPTY_NODE,this.right=r??Ts.EMPTY_NODE}copy(e,n,s,i,r){return new En(e??this.key,n??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ts.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let s,i;if(s=this,n(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(e,s.key)===0){if(s.right.isEmpty())return Ts.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,En.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,En.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}En.RED=!0;En.BLACK=!1;class Ebe{copy(e,n,s,i,r){return this}insert(e,n,s){return new En(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ts{constructor(e,n=Ts.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Ts(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,En.BLACK,null,null))}remove(e){return new Ts(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,En.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,i=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Em(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Em(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Em(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Em(this.root_,null,this.comparator_,!0,e)}}Ts.EMPTY_NODE=new Ebe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nbe(t,e){return qu(t.name,e.name)}function Yk(t,e){return qu(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yb;function $be(t){yb=t}const p4=function(t){return typeof t=="number"?"number:"+jB(t):"string:"+t},m4=function(t){if(t.isLeafNode()){const e=t.val();ge(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Pr(e,".sv"),"Priority must be a string or number.")}else ge(t===yb||t.isEmpty(),"priority of unexpected type.");ge(t===yb||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let A$;class Sn{static set __childrenNodeConstructor(e){A$=e}static get __childrenNodeConstructor(){return A$}constructor(e,n=Sn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ge(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),m4(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Sn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Sn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Xe(e)?this:Ke(e)===".priority"?this.priorityNode_:Sn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Sn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const s=Ke(e);return s===null?n:n.isEmpty()&&s!==".priority"?this:(ge(s!==".priority"||la(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Sn.__childrenNodeConstructor.EMPTY_NODE.updateChild(St(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+p4(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=jB(this.value_):e+=this.value_,this.lazyHash_=WB(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Sn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Sn.__childrenNodeConstructor?-1:(ge(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,s=typeof this.value_,i=Sn.VALUE_TYPE_ORDER.indexOf(n),r=Sn.VALUE_TYPE_ORDER.indexOf(s);return ge(i>=0,"Unknown leaf type: "+n),ge(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Sn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g4,y4;function Rbe(t){g4=t}function Abe(t){y4=t}class Dbe extends Ix{compare(e,n){const s=e.node.getPriority(),i=n.node.getPriority(),r=s.compareTo(i);return r===0?qu(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Ze.MIN}maxPost(){return new Ze(aa,new Sn("[PRIORITY-POST]",y4))}makePost(e,n){const s=g4(e);return new Ze(n,new Sn("[PRIORITY-POST]",s))}toString(){return".priority"}}const Vt=new Dbe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pbe=Math.log(2);class Obe{constructor(e){const n=r=>parseInt(Math.log(r)/Pbe,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const hy=function(t,e,n,s){t.sort(e);const i=function(l,c){const h=c-l;let d,f;if(h===0)return null;if(h===1)return d=t[l],f=n?n(d):d,new En(f,d.node,En.BLACK,null,null);{const m=parseInt(h/2,10)+l,g=i(l,m),x=i(m+1,c);return d=t[m],f=n?n(d):d,new En(f,d.node,En.BLACK,g,x)}},r=function(l){let c=null,h=null,d=t.length;const f=function(g,x){const _=d-g,v=d;d-=g;const w=i(_+1,v),b=t[_],I=n?n(b):b;m(new En(I,b.node,x,null,w))},m=function(g){c?(c.left=g,c=g):(h=g,c=g)};for(let g=0;g<l.count;++g){const x=l.nextBitIsOne(),_=Math.pow(2,l.count-(g+1));x?f(_,En.BLACK):(f(_,En.BLACK),f(_,En.RED))}return h},o=new Obe(t.length),a=r(o);return new Ts(s||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g0;const yc={};class Zr{static get Default(){return ge(yc&&Vt,"ChildrenNode.ts has not been loaded"),g0=g0||new Zr({".priority":yc},{".priority":Vt}),g0}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ru(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Ts?n:null}hasIndex(e){return Pr(this.indexSet_,e.toString())}addIndex(e,n){ge(e!==ll,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=n.getIterator(Ze.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=hy(s,e.getCompare()):a=yc;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Zr(h,c)}addToIndexes(e,n){const s=Ig(this.indexes_,(i,r)=>{const o=ru(this.indexSet_,r);if(ge(o,"Missing index implementation for "+r),i===yc)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(Ze.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),hy(a,o.getCompare())}else return yc;else{const a=n.get(e.name);let l=i;return a&&(l=l.remove(new Ze(e.name,a))),l.insert(e,e.node)}});return new Zr(s,this.indexSet_)}removeFromIndexes(e,n){const s=Ig(this.indexes_,i=>{if(i===yc)return i;{const r=n.get(e.name);return r?i.remove(new Ze(e.name,r)):i}});return new Zr(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kh;class Le{static get EMPTY_NODE(){return kh||(kh=new Le(new Ts(Yk),null,Zr.Default))}constructor(e,n,s){this.children_=e,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&m4(this.priorityNode_),this.children_.isEmpty()&&ge(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||kh}updatePriority(e){return this.children_.isEmpty()?this:new Le(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?kh:n}}getChild(e){const n=Ke(e);return n===null?this:this.getImmediateChild(n).getChild(St(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ge(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const s=new Ze(e,n);let i,r;n.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?kh:this.priorityNode_;return new Le(i,o,r)}}updateChild(e,n){const s=Ke(e);if(s===null)return n;{ge(Ke(e)!==".priority"||la(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(St(e),n);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let s=0,i=0,r=!0;if(this.forEachChild(Vt,(o,a)=>{n[o]=a.val(e),s++,r&&Le.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+p4(this.getPriority().val())+":"),this.forEachChild(Vt,(n,s)=>{const i=s.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":WB(e)}return this.lazyHash_}getPredecessorChildName(e,n,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new Ze(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Ze(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Ze(n,this.children_.get(n)):null}forEachChild(e,n){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ze.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ze.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Tp?-1:0}withIndex(e){if(e===ll||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Le(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===ll||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const s=this.getIterator(Vt),i=n.getIterator(Vt);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ll?null:this.indexMap_.get(e.toString())}}Le.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Lbe extends Le{constructor(){super(new Ts(Yk),Le.EMPTY_NODE,Zr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Le.EMPTY_NODE}isEmpty(){return!1}}const Tp=new Lbe;Object.defineProperties(Ze,{MIN:{value:new Ze(Dl,Le.EMPTY_NODE)},MAX:{value:new Ze(aa,Tp)}});f4.__EMPTY_NODE=Le.EMPTY_NODE;Sn.__childrenNodeConstructor=Le;$be(Tp);Abe(Tp);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fbe=!0;function zn(t,e=null){if(t===null)return Le.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ge(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Sn(n,zn(e))}if(!(t instanceof Array)&&Fbe){const n=[];let s=!1;if(Ls(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=zn(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new Ze(o,l)))}}),n.length===0)return Le.EMPTY_NODE;const r=hy(n,Nbe,o=>o.name,Yk);if(s){const o=hy(n,Vt.getCompare());return new Le(r,zn(e),new Zr({".priority":o},{".priority":Vt}))}else return new Le(r,zn(e),Zr.Default)}else{let n=Le.EMPTY_NODE;return Ls(t,(s,i)=>{if(Pr(t,s)&&s.substring(0,1)!=="."){const r=zn(i);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(s,r))}}),n.updatePriority(zn(e))}}Rbe(zn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk extends Ix{constructor(e){super(),this.indexPath_=e,ge(!Xe(e)&&Ke(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const s=this.extractChild(e.node),i=this.extractChild(n.node),r=s.compareTo(i);return r===0?qu(e.name,n.name):r}makePost(e,n){const s=zn(e),i=Le.EMPTY_NODE.updateChild(this.indexPath_,s);return new Ze(n,i)}maxPost(){const e=Le.EMPTY_NODE.updateChild(this.indexPath_,Tp);return new Ze(aa,e)}toString(){return u4(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mbe extends Ix{compare(e,n){const s=e.node.compareTo(n.node);return s===0?qu(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Ze.MIN}maxPost(){return Ze.MAX}makePost(e,n){const s=zn(e);return new Ze(n,s)}toString(){return".value"}}const v4=new Mbe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x4(t){return{type:"value",snapshotNode:t}}function xu(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Wd(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Vd(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function zbe(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e){this.index_=e}updateChild(e,n,s,i,r,o){ge(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(Wd(n,a)):ge(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(xu(n,s)):o.trackChildChange(Vd(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Vt,(i,r)=>{n.hasChild(i)||s.trackChildChange(Wd(i,r))}),n.isLeafNode()||n.forEachChild(Vt,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Vd(i,r,o))}else s.trackChildChange(xu(i,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Le.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e){this.indexedFilter_=new Jk(e.getIndex()),this.index_=e.getIndex(),this.startPost_=jd.getStartPost_(e),this.endPost_=jd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,i,r,o){return this.matches(new Ze(n,s))||(s=Le.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,i,r,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=Le.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(Le.EMPTY_NODE);const r=this;return n.forEachChild(Vt,(o,a)=>{r.matches(new Ze(o,a))||(i=i.updateImmediateChild(o,Le.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bbe{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{const s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new jd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,i,r,o){return this.rangedFilter_.matches(new Ze(n,s))||(s=Le.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,i,r,o):this.fullLimitUpdateChild_(e,n,s,r,o)}updateFullNode(e,n,s){let i;if(n.isLeafNode()||n.isEmpty())i=Le.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=Le.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(Le.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,Le.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,i,r){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,m)=>d(m,f)}else o=this.index_.getCompare();const a=e;ge(a.numChildren()===this.limit_,"");const l=new Ze(n,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(n)){const d=a.getImmediateChild(n);let f=i.getChildAfterChild(this.index_,c,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=i.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,l);if(h&&!s.isEmpty()&&m>=0)return r!=null&&r.trackChildChange(Vd(n,s,d)),a.updateImmediateChild(n,s);{r!=null&&r.trackChildChange(Wd(n,d));const x=a.updateImmediateChild(n,Le.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r!=null&&r.trackChildChange(xu(f.name,f.node)),x.updateImmediateChild(f.name,f.node)):x}}else return s.isEmpty()?e:h&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Wd(c.name,c.node)),r.trackChildChange(xu(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(c.name,Le.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Vt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ge(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ge(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Dl}hasEnd(){return this.endSet_}getIndexEndValue(){return ge(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ge(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:aa}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ge(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Vt}copy(){const e=new eS;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ube(t){return t.loadsAllData()?new Jk(t.getIndex()):t.hasLimit()?new Bbe(t):new jd(t)}function Wbe(t,e){const n=t.copy();return n.index_=e,n}function D$(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Vt?n="$priority":t.index_===v4?n="$value":t.index_===ll?n="$key":(ge(t.index_ instanceof Qk,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Nn(n),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=Nn(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+Nn(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=Nn(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+Nn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function P$(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Vt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy extends a4{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ge(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Sp("p:rest:"),this.listens_={}}listen(e,n,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=dy.getListenId_(e,s),a={};this.listens_[o]=a;const l=D$(e._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let d=h;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(r,d,!1,s),ru(this.listens_,o)===a){let f;c?c===401?f="permission_denied":f="rest_error:"+c:f="ok",i(f,null)}})}unlisten(e,n){const s=dy.getListenId_(e,n);delete this.listens_[s]}get(e){const n=D$(e._queryParams),s=e._path.toString(),i=new By;return this.restRequest_(s+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(n.auth=i.accessToken),r&&r.token&&(n.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Su(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Cd(a.responseText)}catch{As("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&As("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vbe{constructor(){this.rootNode_=Le.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy(){return{value:null,children:new Map}}function _4(t,e,n){if(Xe(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const s=Ke(e);t.children.has(s)||t.children.set(s,fy());const i=t.children.get(s);e=St(e),_4(i,e,n)}}function vb(t,e,n){t.value!==null?n(e,t.value):jbe(t,(s,i)=>{const r=new wt(e.toString()+"/"+s);vb(i,r,n)})}function jbe(t,e){t.children.forEach((n,s)=>{e(s,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gbe{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Ls(this.last_,(s,i)=>{n[s]=n[s]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O$=10*1e3,Hbe=30*1e3,qbe=5*60*1e3;class Kbe{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Gbe(e);const s=O$+(Hbe-O$)*Math.random();ed(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),n={};let s=!1;Ls(e,(i,r)=>{r>0&&Pr(this.statsToReport_,i)&&(n[i]=r,s=!0)}),s&&this.server_.reportStats(n),ed(this.reportStats_.bind(this),Math.floor(Math.random()*2*qbe))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wi;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Wi||(Wi={}));function w4(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tS(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nS(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=Wi.ACK_USER_WRITE,this.source=w4()}operationForChild(e){if(Xe(this.path)){if(this.affectedTree.value!=null)return ge(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new wt(e));return new py(ht(),n,this.revert)}}else return ge(Ke(this.path)===e,"operationForChild called for unrelated child."),new py(St(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,n){this.source=e,this.path=n,this.type=Wi.LISTEN_COMPLETE}operationForChild(e){return Xe(this.path)?new Gd(this.source,ht()):new Gd(this.source,St(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=Wi.OVERWRITE}operationForChild(e){return Xe(this.path)?new Pl(this.source,ht(),this.snap.getImmediateChild(e)):new Pl(this.source,St(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=Wi.MERGE}operationForChild(e){if(Xe(this.path)){const n=this.children.subtree(new wt(e));return n.isEmpty()?null:n.value?new Pl(this.source,ht(),n.value):new Hd(this.source,ht(),n)}else return ge(Ke(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Hd(this.source,St(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Xe(e))return this.isFullyInitialized()&&!this.filtered_;const n=Ke(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xbe{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Zbe(t,e,n,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(zbe(o.childName,o.snapshotNode))}),Sh(t,i,"child_removed",e,s,n),Sh(t,i,"child_added",e,s,n),Sh(t,i,"child_moved",r,s,n),Sh(t,i,"child_changed",e,s,n),Sh(t,i,"value",e,s,n),i}function Sh(t,e,n,s,i,r){const o=s.filter(a=>a.type===n);o.sort((a,l)=>Qbe(t,a,l)),o.forEach(a=>{const l=Ybe(t,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function Ybe(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Qbe(t,e,n){if(e.childName==null||n.childName==null)throw ku("Should only compare child_ events.");const s=new Ze(e.childName,e.snapshotNode),i=new Ze(n.childName,n.snapshotNode);return t.index_.compare(s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kx(t,e){return{eventCache:t,serverCache:e}}function td(t,e,n,s){return kx(new Ol(e,n,s),t.serverCache)}function b4(t,e,n,s){return kx(t.eventCache,new Ol(e,n,s))}function xb(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ll(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let y0;const Jbe=()=>(y0||(y0=new Ts(zwe)),y0);class Dt{static fromObject(e){let n=new Dt(null);return Ls(e,(s,i)=>{n=n.set(new wt(s),i)}),n}constructor(e,n=Jbe()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:ht(),value:this.value};if(Xe(e))return null;{const s=Ke(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(St(e),n);return r!=null?{path:wn(new wt(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Xe(e))return this;{const n=Ke(e),s=this.children.get(n);return s!==null?s.subtree(St(e)):new Dt(null)}}set(e,n){if(Xe(e))return new Dt(n,this.children);{const s=Ke(e),r=(this.children.get(s)||new Dt(null)).set(St(e),n),o=this.children.insert(s,r);return new Dt(this.value,o)}}remove(e){if(Xe(e))return this.children.isEmpty()?new Dt(null):new Dt(null,this.children);{const n=Ke(e),s=this.children.get(n);if(s){const i=s.remove(St(e));let r;return i.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,i),this.value===null&&r.isEmpty()?new Dt(null):new Dt(this.value,r)}else return this}}get(e){if(Xe(e))return this.value;{const n=Ke(e),s=this.children.get(n);return s?s.get(St(e)):null}}setTree(e,n){if(Xe(e))return n;{const s=Ke(e),r=(this.children.get(s)||new Dt(null)).setTree(St(e),n);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new Dt(this.value,o)}}fold(e){return this.fold_(ht(),e)}fold_(e,n){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(wn(e,i),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,ht(),n)}findOnPath_(e,n,s){const i=this.value?s(n,this.value):!1;if(i)return i;if(Xe(e))return null;{const r=Ke(e),o=this.children.get(r);return o?o.findOnPath_(St(e),wn(n,r),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,ht(),n)}foreachOnPath_(e,n,s){if(Xe(e))return this;{this.value&&s(n,this.value);const i=Ke(e),r=this.children.get(i);return r?r.foreachOnPath_(St(e),wn(n,i),s):new Dt(null)}}foreach(e){this.foreach_(ht(),e)}foreach_(e,n){this.children.inorderTraversal((s,i)=>{i.foreach_(wn(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(e){this.writeTree_=e}static empty(){return new Ki(new Dt(null))}}function nd(t,e,n){if(Xe(e))return new Ki(new Dt(n));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=Ss(i,e);return r=r.updateChild(o,n),new Ki(t.writeTree_.set(i,r))}else{const i=new Dt(n),r=t.writeTree_.setTree(e,i);return new Ki(r)}}}function L$(t,e,n){let s=t;return Ls(n,(i,r)=>{s=nd(s,wn(e,i),r)}),s}function F$(t,e){if(Xe(e))return Ki.empty();{const n=t.writeTree_.setTree(e,new Dt(null));return new Ki(n)}}function _b(t,e){return nc(t,e)!=null}function nc(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Ss(n.path,e)):null}function M$(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Vt,(s,i)=>{e.push(new Ze(s,i))}):t.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new Ze(s,i.value))}),e}function Qo(t,e){if(Xe(e))return t;{const n=nc(t,e);return n!=null?new Ki(new Dt(n)):new Ki(t.writeTree_.subtree(e))}}function wb(t){return t.writeTree_.isEmpty()}function _u(t,e){return C4(ht(),t.writeTree_,e)}function C4(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(ge(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):n=C4(wn(t,i),r,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(wn(t,".priority"),s)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sS(t,e){return T4(e,t)}function e1e(t,e,n,s,i){ge(s>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:i}),i&&(t.visibleWrites=nd(t.visibleWrites,e,n)),t.lastWriteId=s}function t1e(t,e){for(let n=0;n<t.allWrites.length;n++){const s=t.allWrites[n];if(s.writeId===e)return s}return null}function n1e(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ge(n>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[n];t.allWrites.splice(n,1);let i=s.visible,r=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&s1e(a,s.path)?i=!1:Ui(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return i1e(t),!0;if(s.snap)t.visibleWrites=F$(t.visibleWrites,s.path);else{const a=s.children;Ls(a,l=>{t.visibleWrites=F$(t.visibleWrites,wn(s.path,l))})}return!0}else return!1}function s1e(t,e){if(t.snap)return Ui(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Ui(wn(t.path,n),e))return!0;return!1}function i1e(t){t.visibleWrites=I4(t.allWrites,r1e,ht()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function r1e(t){return t.visible}function I4(t,e,n){let s=Ki.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const o=r.path;let a;if(r.snap)Ui(n,o)?(a=Ss(n,o),s=nd(s,a,r.snap)):Ui(o,n)&&(a=Ss(o,n),s=nd(s,ht(),r.snap.getChild(a)));else if(r.children){if(Ui(n,o))a=Ss(n,o),s=L$(s,a,r.children);else if(Ui(o,n))if(a=Ss(o,n),Xe(a))s=L$(s,ht(),r.children);else{const l=ru(r.children,Ke(a));if(l){const c=l.getChild(St(a));s=nd(s,ht(),c)}}}else throw ku("WriteRecord should have .snap or .children")}}return s}function k4(t,e,n,s,i){if(!s&&!i){const r=nc(t.visibleWrites,e);if(r!=null)return r;{const o=Qo(t.visibleWrites,e);if(wb(o))return n;if(n==null&&!_b(o,ht()))return null;{const a=n||Le.EMPTY_NODE;return _u(o,a)}}}else{const r=Qo(t.visibleWrites,e);if(!i&&wb(r))return n;if(!i&&n==null&&!_b(r,ht()))return null;{const o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(Ui(c.path,e)||Ui(e,c.path))},a=I4(t.allWrites,o,e),l=n||Le.EMPTY_NODE;return _u(a,l)}}}function o1e(t,e,n){let s=Le.EMPTY_NODE;const i=nc(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Vt,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(n){const r=Qo(t.visibleWrites,e);return n.forEachChild(Vt,(o,a)=>{const l=_u(Qo(r,new wt(o)),a);s=s.updateImmediateChild(o,l)}),M$(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=Qo(t.visibleWrites,e);return M$(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function a1e(t,e,n,s,i){ge(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=wn(e,n);if(_b(t.visibleWrites,r))return null;{const o=Qo(t.visibleWrites,r);return wb(o)?i.getChild(n):_u(o,i.getChild(n))}}function l1e(t,e,n,s){const i=wn(e,n),r=nc(t.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(n)){const o=Qo(t.visibleWrites,i);return _u(o,s.getNode().getImmediateChild(n))}else return null}function c1e(t,e){return nc(t.visibleWrites,e)}function u1e(t,e,n,s,i,r,o){let a;const l=Qo(t.visibleWrites,e),c=nc(l,ht());if(c!=null)a=c;else if(n!=null)a=_u(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),f=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let m=f.getNext();for(;m&&h.length<i;)d(m,s)!==0&&h.push(m),m=f.getNext();return h}else return[]}function h1e(){return{visibleWrites:Ki.empty(),allWrites:[],lastWriteId:-1}}function my(t,e,n,s){return k4(t.writeTree,t.treePath,e,n,s)}function iS(t,e){return o1e(t.writeTree,t.treePath,e)}function z$(t,e,n,s){return a1e(t.writeTree,t.treePath,e,n,s)}function gy(t,e){return c1e(t.writeTree,wn(t.treePath,e))}function d1e(t,e,n,s,i,r){return u1e(t.writeTree,t.treePath,e,n,s,i,r)}function rS(t,e,n){return l1e(t.writeTree,t.treePath,e,n)}function S4(t,e){return T4(wn(t.treePath,e),t.writeTree)}function T4(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f1e{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,s=e.childName;ge(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ge(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(s,Vd(s,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(s,Wd(s,i.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(s,xu(s,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(s,Vd(s,e.snapshotNode,i.oldSnap));else throw ku("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1e{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}}const E4=new p1e;class oS{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Ol(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return rS(this.writes_,e,s)}}getChildAfterChild(e,n,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ll(this.viewCache_),r=d1e(this.writes_,i,n,1,s,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m1e(t){return{filter:t}}function g1e(t,e){ge(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ge(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function y1e(t,e,n,s,i){const r=new f1e;let o,a;if(n.type===Wi.OVERWRITE){const c=n;c.source.fromUser?o=bb(t,e,c.path,c.snap,s,i,r):(ge(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!Xe(c.path),o=yy(t,e,c.path,c.snap,s,i,a,r))}else if(n.type===Wi.MERGE){const c=n;c.source.fromUser?o=x1e(t,e,c.path,c.children,s,i,r):(ge(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Cb(t,e,c.path,c.children,s,i,a,r))}else if(n.type===Wi.ACK_USER_WRITE){const c=n;c.revert?o=b1e(t,e,c.path,s,i,r):o=_1e(t,e,c.path,c.affectedTree,s,i,r)}else if(n.type===Wi.LISTEN_COMPLETE)o=w1e(t,e,n.path,s,r);else throw ku("Unknown operation type: "+n.type);const l=r.getChanges();return v1e(e,o,l),{viewCache:o,changes:l}}function v1e(t,e,n){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=xb(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&n.push(x4(xb(e)))}}function N4(t,e,n,s,i,r){const o=e.eventCache;if(gy(s,n)!=null)return e;{let a,l;if(Xe(n))if(ge(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Ll(e),h=c instanceof Le?c:Le.EMPTY_NODE,d=iS(s,h);a=t.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{const c=my(s,Ll(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=Ke(n);if(c===".priority"){ge(la(n)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=z$(s,n,h,l);d!=null?a=t.filter.updatePriority(h,d):a=o.getNode()}else{const h=St(n);let d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const f=z$(s,n,o.getNode(),l);f!=null?d=o.getNode().getImmediateChild(c).updateChild(h,f):d=o.getNode().getImmediateChild(c)}else d=rS(s,c,e.serverCache);d!=null?a=t.filter.updateChild(o.getNode(),c,d,h,i,r):a=o.getNode()}}return td(e,a,o.isFullyInitialized()||Xe(n),t.filter.filtersNodes())}}function yy(t,e,n,s,i,r,o,a){const l=e.serverCache;let c;const h=o?t.filter:t.filter.getIndexedFilter();if(Xe(n))c=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const m=l.getNode().updateChild(n,s);c=h.updateFullNode(l.getNode(),m,null)}else{const m=Ke(n);if(!l.isCompleteForPath(n)&&la(n)>1)return e;const g=St(n),_=l.getNode().getImmediateChild(m).updateChild(g,s);m===".priority"?c=h.updatePriority(l.getNode(),_):c=h.updateChild(l.getNode(),m,_,g,E4,null)}const d=b4(e,c,l.isFullyInitialized()||Xe(n),h.filtersNodes()),f=new oS(i,d,r);return N4(t,d,n,i,f,a)}function bb(t,e,n,s,i,r,o){const a=e.eventCache;let l,c;const h=new oS(i,e,r);if(Xe(n))c=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=td(e,c,!0,t.filter.filtersNodes());else{const d=Ke(n);if(d===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),s),l=td(e,c,a.isFullyInitialized(),a.isFiltered());else{const f=St(n),m=a.getNode().getImmediateChild(d);let g;if(Xe(f))g=s;else{const x=h.getCompleteChild(d);x!=null?c4(f)===".priority"&&x.getChild(h4(f)).isEmpty()?g=x:g=x.updateChild(f,s):g=Le.EMPTY_NODE}if(m.equals(g))l=e;else{const x=t.filter.updateChild(a.getNode(),d,g,f,h,o);l=td(e,x,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function B$(t,e){return t.eventCache.isCompleteForChild(e)}function x1e(t,e,n,s,i,r,o){let a=e;return s.foreach((l,c)=>{const h=wn(n,l);B$(e,Ke(h))&&(a=bb(t,a,h,c,i,r,o))}),s.foreach((l,c)=>{const h=wn(n,l);B$(e,Ke(h))||(a=bb(t,a,h,c,i,r,o))}),a}function U$(t,e,n){return n.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Cb(t,e,n,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;Xe(n)?c=s:c=new Dt(null).setTree(n,s);const h=e.serverCache.getNode();return c.children.inorderTraversal((d,f)=>{if(h.hasChild(d)){const m=e.serverCache.getNode().getImmediateChild(d),g=U$(t,m,f);l=yy(t,l,new wt(d),g,i,r,o,a)}}),c.children.inorderTraversal((d,f)=>{const m=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!h.hasChild(d)&&!m){const g=e.serverCache.getNode().getImmediateChild(d),x=U$(t,g,f);l=yy(t,l,new wt(d),x,i,r,o,a)}}),l}function _1e(t,e,n,s,i,r,o){if(gy(i,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Xe(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return yy(t,e,n,l.getNode().getChild(n),i,r,a,o);if(Xe(n)){let c=new Dt(null);return l.getNode().forEachChild(ll,(h,d)=>{c=c.set(new wt(h),d)}),Cb(t,e,n,c,i,r,a,o)}else return e}else{let c=new Dt(null);return s.foreach((h,d)=>{const f=wn(n,h);l.isCompleteForPath(f)&&(c=c.set(h,l.getNode().getChild(f)))}),Cb(t,e,n,c,i,r,a,o)}}function w1e(t,e,n,s,i){const r=e.serverCache,o=b4(e,r.getNode(),r.isFullyInitialized()||Xe(n),r.isFiltered());return N4(t,o,n,s,E4,i)}function b1e(t,e,n,s,i,r){let o;if(gy(s,n)!=null)return e;{const a=new oS(s,e,i),l=e.eventCache.getNode();let c;if(Xe(n)||Ke(n)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=my(s,Ll(e));else{const d=e.serverCache.getNode();ge(d instanceof Le,"serverChildren would be complete if leaf node"),h=iS(s,d)}h=h,c=t.filter.updateFullNode(l,h,r)}else{const h=Ke(n);let d=rS(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?c=t.filter.updateChild(l,h,d,St(n),a,r):e.eventCache.getNode().hasChild(h)?c=t.filter.updateChild(l,h,Le.EMPTY_NODE,St(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=my(s,Ll(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||gy(s,ht())!=null,td(e,c,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1e{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new Jk(s.getIndex()),r=Ube(s);this.processor_=m1e(r);const o=n.serverCache,a=n.eventCache,l=i.updateFullNode(Le.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(Le.EMPTY_NODE,a.getNode(),null),h=new Ol(l,o.isFullyInitialized(),i.filtersNodes()),d=new Ol(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=kx(d,h),this.eventGenerator_=new Xbe(this.query_)}get query(){return this.query_}}function I1e(t){return t.viewCache_.serverCache.getNode()}function k1e(t,e){const n=Ll(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Xe(e)&&!n.getImmediateChild(Ke(e)).isEmpty())?n.getChild(e):null}function W$(t){return t.eventRegistrations_.length===0}function S1e(t,e){t.eventRegistrations_.push(e)}function V$(t,e,n){const s=[];if(n){ge(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(n,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){const o=t.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return s}function j$(t,e,n,s){e.type===Wi.MERGE&&e.source.queryId!==null&&(ge(Ll(t.viewCache_),"We should always have a full cache before handling merges"),ge(xb(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=y1e(t.processor_,i,e,n,s);return g1e(t.processor_,r.viewCache),ge(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,$4(t,r.changes,r.viewCache.eventCache.getNode(),null)}function T1e(t,e){const n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Vt,(r,o)=>{s.push(xu(r,o))}),n.isFullyInitialized()&&s.push(x4(n.getNode())),$4(t,s,n.getNode(),e)}function $4(t,e,n,s){const i=s?[s]:t.eventRegistrations_;return Zbe(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vy;class E1e{constructor(){this.views=new Map}}function N1e(t){ge(!vy,"__referenceConstructor has already been defined"),vy=t}function $1e(){return ge(vy,"Reference.ts has not been loaded"),vy}function R1e(t){return t.views.size===0}function aS(t,e,n,s){const i=e.source.queryId;if(i!==null){const r=t.views.get(i);return ge(r!=null,"SyncTree gave us an op for an invalid query."),j$(r,e,n,s)}else{let r=[];for(const o of t.views.values())r=r.concat(j$(o,e,n,s));return r}}function A1e(t,e,n,s,i){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=my(n,i?s:null),l=!1;a?l=!0:s instanceof Le?(a=iS(n,s),l=!1):(a=Le.EMPTY_NODE,l=!1);const c=kx(new Ol(a,l,!1),new Ol(s,i,!1));return new C1e(e,c)}return o}function D1e(t,e,n,s,i,r){const o=A1e(t,e,s,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),S1e(o,n),T1e(o,n)}function P1e(t,e,n,s){const i=e._queryIdentifier,r=[];let o=[];const a=ca(t);if(i==="default")for(const[l,c]of t.views.entries())o=o.concat(V$(c,n,s)),W$(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=t.views.get(i);l&&(o=o.concat(V$(l,n,s)),W$(l)&&(t.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ca(t)&&r.push(new($1e())(e._repo,e._path)),{removed:r,events:o}}function R4(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Yc(t,e){let n=null;for(const s of t.views.values())n=n||k1e(s,e);return n}function A4(t,e){if(e._queryParams.loadsAllData())return Sx(t);{const s=e._queryIdentifier;return t.views.get(s)}}function D4(t,e){return A4(t,e)!=null}function ca(t){return Sx(t)!=null}function Sx(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xy;function O1e(t){ge(!xy,"__referenceConstructor has already been defined"),xy=t}function L1e(){return ge(xy,"Reference.ts has not been loaded"),xy}let F1e=1;class G${constructor(e){this.listenProvider_=e,this.syncPointTree_=new Dt(null),this.pendingWriteTree_=h1e(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function P4(t,e,n,s,i){return e1e(t.pendingWriteTree_,e,n,s,i),i?Ep(t,new Pl(w4(),e,n)):[]}function nl(t,e,n=!1){const s=t1e(t.pendingWriteTree_,e);if(n1e(t.pendingWriteTree_,e)){let r=new Dt(null);return s.snap!=null?r=r.set(ht(),!0):Ls(s.children,o=>{r=r.set(new wt(o),!0)}),Ep(t,new py(s.path,r,n))}else return[]}function Tx(t,e,n){return Ep(t,new Pl(tS(),e,n))}function M1e(t,e,n){const s=Dt.fromObject(n);return Ep(t,new Hd(tS(),e,s))}function z1e(t,e){return Ep(t,new Gd(tS(),e))}function B1e(t,e,n){const s=cS(t,n);if(s){const i=uS(s),r=i.path,o=i.queryId,a=Ss(r,e),l=new Gd(nS(o),a);return hS(t,r,l)}else return[]}function Ib(t,e,n,s,i=!1){const r=e._path,o=t.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||D4(o,e))){const l=P1e(o,e,n,s);R1e(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!i){const h=c.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=t.syncPointTree_.findOnPath(r,(f,m)=>ca(m));if(h&&!d){const f=t.syncPointTree_.subtree(r);if(!f.isEmpty()){const m=V1e(f);for(let g=0;g<m.length;++g){const x=m[g],_=x.query,v=F4(t,x);t.listenProvider_.startListening(sd(_),_y(t,_),v.hashFn,v.onComplete)}}}!d&&c.length>0&&!s&&(h?t.listenProvider_.stopListening(sd(e),null):c.forEach(f=>{const m=t.queryToTagMap.get(Ex(f));t.listenProvider_.stopListening(sd(f),m)}))}j1e(t,c)}return a}function U1e(t,e,n,s){const i=cS(t,s);if(i!=null){const r=uS(i),o=r.path,a=r.queryId,l=Ss(o,e),c=new Pl(nS(a),l,n);return hS(t,o,c)}else return[]}function W1e(t,e,n,s){const i=cS(t,s);if(i){const r=uS(i),o=r.path,a=r.queryId,l=Ss(o,e),c=Dt.fromObject(n),h=new Hd(nS(a),l,c);return hS(t,o,h)}else return[]}function H$(t,e,n,s=!1){const i=e._path;let r=null,o=!1;t.syncPointTree_.foreachOnPath(i,(f,m)=>{const g=Ss(f,i);r=r||Yc(m,g),o=o||ca(m)});let a=t.syncPointTree_.get(i);a?(o=o||ca(a),r=r||Yc(a,ht())):(a=new E1e,t.syncPointTree_=t.syncPointTree_.set(i,a));let l;r!=null?l=!0:(l=!1,r=Le.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((m,g)=>{const x=Yc(g,ht());x&&(r=r.updateImmediateChild(m,x))}));const c=D4(a,e);if(!c&&!e._queryParams.loadsAllData()){const f=Ex(e);ge(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=G1e();t.queryToTagMap.set(f,m),t.tagToQueryMap.set(m,f)}const h=sS(t.pendingWriteTree_,i);let d=D1e(a,e,n,h,r,l);if(!c&&!o&&!s){const f=A4(a,e);d=d.concat(H1e(t,e,f))}return d}function lS(t,e,n){const i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=Ss(o,e),c=Yc(a,l);if(c)return c});return k4(i,e,r,n,!0)}function Ep(t,e){return O4(e,t.syncPointTree_,null,sS(t.pendingWriteTree_,ht()))}function O4(t,e,n,s){if(Xe(t.path))return L4(t,e,n,s);{const i=e.get(ht());n==null&&i!=null&&(n=Yc(i,ht()));let r=[];const o=Ke(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,h=S4(s,o);r=r.concat(O4(a,l,c,h))}return i&&(r=r.concat(aS(i,t,s,n))),r}}function L4(t,e,n,s){const i=e.get(ht());n==null&&i!=null&&(n=Yc(i,ht()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=S4(s,o),h=t.operationForChild(o);h&&(r=r.concat(L4(h,a,l,c)))}),i&&(r=r.concat(aS(i,t,s,n))),r}function F4(t,e){const n=e.query,s=_y(t,n);return{hashFn:()=>(I1e(e)||Le.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?B1e(t,n._path,s):z1e(t,n._path);{const r=Wwe(i,n);return Ib(t,n,null,r)}}}}function _y(t,e){const n=Ex(e);return t.queryToTagMap.get(n)}function Ex(t){return t._path.toString()+"$"+t._queryIdentifier}function cS(t,e){return t.tagToQueryMap.get(e)}function uS(t){const e=t.indexOf("$");return ge(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new wt(t.substr(0,e))}}function hS(t,e,n){const s=t.syncPointTree_.get(e);ge(s,"Missing sync point for query tag that we're tracking");const i=sS(t.pendingWriteTree_,e);return aS(s,n,i,null)}function V1e(t){return t.fold((e,n,s)=>{if(n&&ca(n))return[Sx(n)];{let i=[];return n&&(i=R4(n)),Ls(s,(r,o)=>{i=i.concat(o)}),i}})}function sd(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(L1e())(t._repo,t._path):t}function j1e(t,e){for(let n=0;n<e.length;++n){const s=e[n];if(!s._queryParams.loadsAllData()){const i=Ex(s),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function G1e(){return F1e++}function H1e(t,e,n){const s=e._path,i=_y(t,e),r=F4(t,n),o=t.listenProvider_.startListening(sd(e),i,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(s);if(i)ge(!ca(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,d)=>{if(!Xe(c)&&h&&ca(h))return[Sx(h).query];{let f=[];return h&&(f=f.concat(R4(h).map(m=>m.query))),Ls(d,(m,g)=>{f=f.concat(g)}),f}});for(let c=0;c<l.length;++c){const h=l[c];t.listenProvider_.stopListening(sd(h),_y(t,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dS{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new dS(n)}node(){return this.node_}}class fS{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=wn(this.path_,e);return new fS(this.syncTree_,n)}node(){return lS(this.syncTree_,this.path_)}}const q1e=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},q$=function(t,e,n){if(!t||typeof t!="object")return t;if(ge(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return K1e(t[".sv"],e,n);if(typeof t[".sv"]=="object")return X1e(t[".sv"],e);ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},K1e=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ge(!1,"Unexpected server value: "+t)}},X1e=function(t,e,n){t.hasOwnProperty("increment")||ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&ge(!1,"Unexpected increment value: "+s);const i=e.node();if(ge(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},Z1e=function(t,e,n,s){return pS(e,new fS(n,t),s)},M4=function(t,e,n){return pS(t,new dS(e),n)};function pS(t,e,n){const s=t.getPriority().val(),i=q$(s,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const o=t,a=q$(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new Sn(a,zn(i)):t}else{const o=t;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new Sn(i))),o.forEachChild(Vt,(a,l)=>{const c=pS(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}}function gS(t,e){let n=e instanceof wt?e:new wt(e),s=t,i=Ke(n);for(;i!==null;){const r=ru(s.node.children,i)||{children:{},childCount:0};s=new mS(i,s,r),n=St(n),i=Ke(n)}return s}function Xu(t){return t.node.value}function z4(t,e){t.node.value=e,kb(t)}function B4(t){return t.node.childCount>0}function Y1e(t){return Xu(t)===void 0&&!B4(t)}function Nx(t,e){Ls(t.node.children,(n,s)=>{e(new mS(n,t,s))})}function U4(t,e,n,s){n&&e(t),Nx(t,i=>{U4(i,e,!0)})}function Q1e(t,e,n){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Np(t){return new wt(t.parent===null?t.name:Np(t.parent)+"/"+t.name)}function kb(t){t.parent!==null&&J1e(t.parent,t.name,t)}function J1e(t,e,n){const s=Y1e(n),i=Pr(t.node.children,e);s&&i?(delete t.node.children[e],t.node.childCount--,kb(t)):!s&&!i&&(t.node.children[e]=n.node,t.node.childCount++,kb(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eCe=/[\[\].#$\/\u0000-\u001F\u007F]/,tCe=/[\[\].#$\u0000-\u001F\u007F]/,v0=10*1024*1024,W4=function(t){return typeof t=="string"&&t.length!==0&&!eCe.test(t)},V4=function(t){return typeof t=="string"&&t.length!==0&&!tCe.test(t)},nCe=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),V4(t)},K$=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!jk(t)||t&&typeof t=="object"&&Pr(t,".sv")},j4=function(t,e,n,s){s&&e===void 0||yS(T1(t,"value"),e,n)},yS=function(t,e,n){const s=n instanceof wt?new wbe(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+ja(s));if(typeof e=="function")throw new Error(t+"contains a function "+ja(s)+" with contents = "+e.toString());if(jk(e))throw new Error(t+"contains "+e.toString()+" "+ja(s));if(typeof e=="string"&&e.length>v0/3&&Uy(e)>v0)throw new Error(t+"contains a string greater than "+v0+" utf8 bytes "+ja(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(Ls(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!W4(o)))throw new Error(t+" contains an invalid key ("+o+") "+ja(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);bbe(s,o),yS(t,a,s),Cbe(s)}),i&&r)throw new Error(t+' contains ".value" child '+ja(s)+" in addition to actual children.")}},vS=function(t,e,n,s){if(!V4(n))throw new Error(T1(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},sCe=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vS(t,e,n)},G4=function(t,e){if(Ke(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},iCe=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!W4(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!nCe(n))throw new Error(T1(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rCe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function xS(t,e){let n=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();n!==null&&!Xk(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(i)}n&&t.eventLists_.push(n)}function H4(t,e,n){xS(t,n),q4(t,s=>Xk(s,e))}function ho(t,e,n){xS(t,n),q4(t,s=>Ui(s,e)||Ui(e,s))}function q4(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){const i=t.eventLists_[s];if(i){const r=i.path;e(r)?(oCe(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function oCe(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const s=n.getEventRunner();Jh&&es("event: "+n.toString()),Ku(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aCe="repo_interrupt",lCe=25;class cCe{constructor(e,n,s,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rCe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=fy(),this.transactionQueueTree_=new mS,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function uCe(t,e,n){if(t.stats_=qk(t.repoInfo_),t.forceRestClient_||Hwe())t.server_=new dy(t.repoInfo_,(s,i,r,o)=>{X$(t,s,i,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Z$(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Nn(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Jr(t.repoInfo_,e,(s,i,r,o)=>{X$(t,s,i,r,o)},s=>{Z$(t,s)},s=>{hCe(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=Ywe(t.repoInfo_,()=>new Kbe(t.stats_,t.server_)),t.infoData_=new Vbe,t.infoSyncTree_=new G$({startListening:(s,i,r,o)=>{let a=[];const l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=Tx(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),wS(t,"connected",!1),t.serverSyncTree_=new G$({startListening:(s,i,r,o)=>(t.server_.listen(s,r,i,(a,l)=>{const c=o(a,l);ho(t.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{t.server_.unlisten(s,i)}})}function K4(t){const n=t.infoData_.getNode(new wt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function _S(t){return q1e({timestamp:K4(t)})}function X$(t,e,n,s,i){t.dataUpdateCount++;const r=new wt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(s){const l=Ig(n,c=>zn(c));o=W1e(t.serverSyncTree_,r,l,i)}else{const l=zn(n);o=U1e(t.serverSyncTree_,r,l,i)}else if(s){const l=Ig(n,c=>zn(c));o=M1e(t.serverSyncTree_,r,l)}else{const l=zn(n);o=Tx(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=$x(t,r)),ho(t.eventQueue_,a,o)}function Z$(t,e){wS(t,"connected",e),e===!1&&fCe(t)}function hCe(t,e){Ls(e,(n,s)=>{wS(t,n,s)})}function wS(t,e,n){const s=new wt("/.info/"+e),i=zn(n);t.infoData_.updateSnapshot(s,i);const r=Tx(t.infoSyncTree_,s,i);ho(t.eventQueue_,s,r)}function X4(t){return t.nextWriteId_++}function dCe(t,e,n,s,i){bS(t,"set",{path:e.toString(),value:n,priority:s});const r=_S(t),o=zn(n,s),a=lS(t.serverSyncTree_,e),l=M4(o,a,r),c=X4(t),h=P4(t.serverSyncTree_,e,l,c,!0);xS(t.eventQueue_,h),t.server_.put(e.toString(),o.val(!0),(f,m)=>{const g=f==="ok";g||As("set at "+e+" failed: "+f);const x=nl(t.serverSyncTree_,c,!g);ho(t.eventQueue_,e,x),yCe(t,i,f,m)});const d=eU(t,e);$x(t,d),ho(t.eventQueue_,d,[])}function fCe(t){bS(t,"onDisconnectEvents");const e=_S(t),n=fy();vb(t.onDisconnect_,ht(),(i,r)=>{const o=Z1e(i,r,t.serverSyncTree_,e);_4(n,i,o)});let s=[];vb(n,ht(),(i,r)=>{s=s.concat(Tx(t.serverSyncTree_,i,r));const o=eU(t,i);$x(t,o)}),t.onDisconnect_=fy(),ho(t.eventQueue_,ht(),s)}function pCe(t,e,n){let s;Ke(e._path)===".info"?s=H$(t.infoSyncTree_,e,n):s=H$(t.serverSyncTree_,e,n),H4(t.eventQueue_,e._path,s)}function mCe(t,e,n){let s;Ke(e._path)===".info"?s=Ib(t.infoSyncTree_,e,n):s=Ib(t.serverSyncTree_,e,n),H4(t.eventQueue_,e._path,s)}function gCe(t){t.persistentConnection_&&t.persistentConnection_.interrupt(aCe)}function bS(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),es(n,...e)}function yCe(t,e,n,s){e&&Ku(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function Z4(t,e,n){return lS(t.serverSyncTree_,e,n)||Le.EMPTY_NODE}function CS(t,e=t.transactionQueueTree_){if(e||Rx(t,e),Xu(e)){const n=Q4(t,e);ge(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&vCe(t,Np(e),n)}else B4(e)&&Nx(e,n=>{CS(t,n)})}function vCe(t,e,n){const s=n.map(c=>c.currentWriteId),i=Z4(t,e,s);let r=i;const o=i.hash();for(let c=0;c<n.length;c++){const h=n[c];ge(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=Ss(e,h.path);r=r.updateChild(d,h.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{bS(t,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const d=[];for(let f=0;f<n.length;f++)n[f].status=2,h=h.concat(nl(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&d.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Rx(t,gS(t.transactionQueueTree_,e)),CS(t,t.transactionQueueTree_),ho(t.eventQueue_,e,h);for(let f=0;f<d.length;f++)Ku(d[f])}else{if(c==="datastale")for(let d=0;d<n.length;d++)n[d].status===3?n[d].status=4:n[d].status=0;else{As("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<n.length;d++)n[d].status=4,n[d].abortReason=c}$x(t,e)}},o)}function $x(t,e){const n=Y4(t,e),s=Np(n),i=Q4(t,n);return xCe(t,i,s),s}function xCe(t,e,n){if(e.length===0)return;const s=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=Ss(n,l.path);let h=!1,d;if(ge(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,i=i.concat(nl(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=lCe)h=!0,d="maxretry",i=i.concat(nl(t.serverSyncTree_,l.currentWriteId,!0));else{const f=Z4(t,l.path,o);l.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){yS("transaction failed: Data returned ",m,l.path);let g=zn(m);typeof m=="object"&&m!=null&&Pr(m,".priority")||(g=g.updatePriority(f.getPriority()));const _=l.currentWriteId,v=_S(t),w=M4(g,f,v);l.currentOutputSnapshotRaw=g,l.currentOutputSnapshotResolved=w,l.currentWriteId=X4(t),o.splice(o.indexOf(_),1),i=i.concat(P4(t.serverSyncTree_,l.path,w,l.currentWriteId,l.applyLocally)),i=i.concat(nl(t.serverSyncTree_,_,!0))}else h=!0,d="nodata",i=i.concat(nl(t.serverSyncTree_,l.currentWriteId,!0))}ho(t.eventQueue_,n,i),i=[],h&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}Rx(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)Ku(s[a]);CS(t,t.transactionQueueTree_)}function Y4(t,e){let n,s=t.transactionQueueTree_;for(n=Ke(e);n!==null&&Xu(s)===void 0;)s=gS(s,n),e=St(e),n=Ke(e);return s}function Q4(t,e){const n=[];return J4(t,e,n),n.sort((s,i)=>s.order-i.order),n}function J4(t,e,n){const s=Xu(e);if(s)for(let i=0;i<s.length;i++)n.push(s[i]);Nx(e,i=>{J4(t,i,n)})}function Rx(t,e){const n=Xu(e);if(n){let s=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[s]=n[i],s++);n.length=s,z4(e,n.length>0?n:void 0)}Nx(e,s=>{Rx(t,s)})}function eU(t,e){const n=Np(Y4(t,e)),s=gS(t.transactionQueueTree_,e);return Q1e(s,i=>{x0(t,i)}),x0(t,s),U4(s,i=>{x0(t,i)}),n}function x0(t,e){const n=Xu(e);if(n){const s=[];let i=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ge(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(ge(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(nl(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?z4(e,void 0):n.length=r+1,ho(t.eventQueue_,Np(e),i);for(let o=0;o<s.length;o++)Ku(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Ce(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let i=n[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function wCe(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):As(`Invalid query segment '${n}' in query '${t}'`)}return e}const Y$=function(t,e){const n=bCe(t),s=n.namespace;n.domain==="firebase.com"&&uo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&uo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Fwe();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new e4(n.host,n.secure,s,i,e,"",s!==n.subdomain),path:new wt(n.pathString)}},bCe=function(t){let e="",n="",s="",i="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let h=t.indexOf("/");h===-1&&(h=t.length);let d=t.indexOf("?");d===-1&&(d=t.length),e=t.substring(0,Math.min(h,d)),h<d&&(i=_Ce(t.substring(h,d)));const f=wCe(t.substring(Math.min(t.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const m=e.slice(0,c);if(m.toLowerCase()==="localhost")n="localhost";else if(m.split(".").length<=2)n=m;else{const g=e.indexOf(".");s=e.substring(0,g).toLowerCase(),n=e.substring(g+1),r=s}"ns"in f&&(r=f.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q$="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",CCe=function(){let t=0;const e=[];return function(n){const s=n===t;t=n;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=Q$.charAt(n%64),n=Math.floor(n/64);ge(n===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Q$.charAt(e[i]);return ge(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ICe{constructor(e,n,s,i){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Nn(this.snapshot.exportVal())}}class kCe{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SCe{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ge(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(e,n,s,i){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=i}get key(){return Xe(this._path)?null:c4(this._path)}get ref(){return new Ta(this._repo,this._path)}get _queryIdentifier(){const e=P$(this._queryParams),n=Gk(e);return n==="{}"?"default":n}get _queryObject(){return P$(this._queryParams)}isEqual(e){if(e=Dn(e),!(e instanceof Ax))return!1;const n=this._repo===e._repo,s=Xk(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+_be(this._path)}}function TCe(t,e){if(t._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function ECe(t){let e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ll){const s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==Dl)throw new Error(s);if(typeof e!="string")throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==aa)throw new Error(s);if(typeof n!="string")throw new Error(i)}}else if(t.getIndex()===Vt){if(e!=null&&!K$(e)||n!=null&&!K$(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ge(t.getIndex()instanceof Qk||t.getIndex()===v4,"unknown index type."),e!=null&&typeof e=="object"||n!=null&&typeof n=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}class Ta extends Ax{constructor(e,n){super(e,n,new eS,!1)}get parent(){const e=h4(this._path);return e===null?null:new Ta(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class wy{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new wt(e),s=qd(this.ref,e);return new wy(this._node.getChild(n),s,Vt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new wy(i,qd(this.ref,s),Vt)))}hasChild(e){const n=new wt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function J$(t,e){return t=Dn(t),t._checkNotDeleted("ref"),qd(t._root,e)}function qd(t,e){return t=Dn(t),Ke(t._path)===null?sCe("child","path",e):vS("child","path",e),new Ta(t._repo,wn(t._path,e))}function NCe(t,e){t=Dn(t),G4("push",t._path),j4("push",e,t._path,!0);const n=K4(t._repo),s=CCe(n),i=qd(t,s),r=qd(t,s);let o;return e!=null?o=$Ce(r,e).then(()=>r):o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function $Ce(t,e){t=Dn(t),G4("set",t._path),j4("set",e,t._path,!1);const n=new By;return dCe(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}class IS{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const s=n._queryParams.getIndex();return new ICe("value",this,new wy(e.snapshotNode,new Ta(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new kCe(this,e,n):null}matches(e){return e instanceof IS?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function RCe(t,e,n,s,i){const r=new SCe(n,void 0),o=new IS(r);return pCe(t._repo,t,o),()=>mCe(t._repo,t,o)}function ACe(t,e,n,s){return RCe(t,"value",e)}class DCe{}class PCe extends DCe{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){TCe(e,"orderByChild");const n=new wt(this._path);if(Xe(n))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const s=new Qk(n),i=Wbe(e._queryParams,s);return ECe(i),new Ax(e._repo,e._path,i,!0)}}function OCe(t){return vS("orderByChild","path",t),new PCe(t)}function LCe(t,...e){let n=Dn(t);for(const s of e)n=s._apply(n);return n}N1e(Ta);O1e(Ta);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FCe="FIREBASE_DATABASE_EMULATOR_HOST",Sb={};let MCe=!1;function zCe(t,e,n,s){t.repoInfo_=new e4(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function BCe(t,e,n,s,i){let r=s||t.options.databaseURL;r===void 0&&(t.options.projectId||uo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),es("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Y$(r,i),a=o.repoInfo,l;typeof process<"u"&&g$&&(l=g$[FCe]),l?(r=`http://${l}?ns=${a.namespace}`,o=Y$(r,i),a=o.repoInfo):o.repoInfo.secure;const c=new Kwe(t.name,t.options,e);iCe("Invalid Firebase Database URL",o),Xe(o.path)||uo("Database URL must point to the root of a Firebase Database (not including a child path).");const h=WCe(a,t,c,new qwe(t,n));return new VCe(h,t)}function UCe(t,e){const n=Sb[e];(!n||n[t.key]!==t)&&uo(`Database ${e}(${t.repoInfo_}) has already been deleted.`),gCe(t),delete n[t.key]}function WCe(t,e,n,s){let i=Sb[e.name];i||(i={},Sb[e.name]=i);let r=i[t.toURLString()];return r&&uo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new cCe(t,MCe,n,s),i[t.toURLString()]=r,r}class VCe{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(uCe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ta(this._repo,ht())),this._rootInternal}_delete(){return this._rootInternal!==null&&(UCe(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&uo("Cannot call "+e+" on a deleted database.")}}function jCe(t=Vy(),e){const n=Wl(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const s=yH("database");s&&GCe(n,...s)}return n}function GCe(t,e,n,s={}){t=Dn(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&uo("Cannot call useEmulator() after instance has already been initialized.");const i=t._repoInternal;let r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&uo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new qm(qm.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:vH(s.mockUserToken,t.app.options.projectId);r=new qm(o)}zCe(i,e,n,r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HCe(t){Rwe(Tu),Tr(new Zi("database",(e,{instanceIdentifier:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return BCe(s,i,r,n)},"PUBLIC").setMultipleInstances(!0)),yi(y$,v$,t),yi(y$,v$,"esm2017")}Jr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Jr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};HCe();const qCe={apiKey:"AIzaSyAsKLxAzdt_Wf3CyoUCE4izrSdNh50SLto",authDomain:"firstaid-ai-4a1fd.firebaseapp.com",projectId:"firstaid-ai-4a1fd",storageBucket:"firstaid-ai-4a1fd.firebasestorage.app",messagingSenderId:"407902398252",appId:"1:407902398252:web:a51757f1b013738eb2ae89",measurementId:"G-G8DVPBMB94"},KCe=P6().length?Vy():N1(qCe),eR=jCe(KCe),tU=ne.createContext(null);function XCe({children:t}){const e=async({text:s,type:i})=>{try{console.log("🔥 Sending message:",{text:s,type:i});const r=J$(eR,"chats"),o=await NCe(r,{text:s,type:i,timestamp:Date.now()});return console.log("✅ Message sent successfully!",o.key),o.key}catch(r){throw console.error("❌ Error sending message:",r),r}},n=s=>{const i=J$(eR,"chats"),r=LCe(i,OCe("timestamp"));return ACe(r,o=>{const a=[];o.forEach(l=>{a.push({id:l.key,...l.val()})}),console.log("📥 Received messages from Firebase:",a),s(a)})};return A.jsx(tU.Provider,{value:{sendMessage:e,subscribeToMessages:n},children:t})}function ZCe(){const t=ne.useContext(tU);if(!t)throw new Error("useFirebase must be used within a FirebaseProvider");return t}const YCe={bleeding:{steps:["Apply direct pressure to the wound with a clean cloth","Keep the injured area elevated above the heart if possible","Apply a sterile bandage","Seek medical attention if bleeding is severe or doesn't stop"],warning:"For severe bleeding, call emergency services immediately"},burn:{steps:["Cool the burn under cool (not cold) running water for 10-20 minutes","Remove any jewelry or tight items from the burned area","Cover with a sterile gauze bandage","Do not apply ice, butter, or oils to the burn"],warning:"Seek medical attention for severe or chemical burns"},choking:{steps:["Encourage coughing if the person can breathe","Perform back blows if coughing doesn't help","Perform abdominal thrusts (Heimlich maneuver) if back blows don't work","Call emergency services if the person loses consciousness"],warning:"This is a medical emergency - call for help if the person cannot breathe"},fracture:{steps:["Keep the injured area still and immobilized","Apply a cold compress to reduce swelling","Do not attempt to realign the bone or joint","Seek immediate medical attention","If possible, support the injured area during transport"],warning:"Do not move the person if you suspect a serious injury to the head, neck, or spine"},heatExhaustion:{steps:["Move the person to a cool, shaded area","Loosen tight clothing","Apply cool, wet cloths to the skin","Provide small sips of cool water if the person is conscious","Use fans to help lower body temperature"],warning:"If symptoms worsen or the person becomes unresponsive, call emergency services immediately"},anaphylaxis:{steps:["Call emergency services immediately","Help the person use their epinephrine auto-injector if available","Have the person lie down with legs elevated","Loosen tight clothing","Monitor breathing and perform CPR if necessary"],warning:"Anaphylaxis is a life-threatening emergency that requires immediate medical attention"},shock:{steps:["Call emergency services immediately","Lay the person down on their back","Elevate legs about 12 inches if no head, neck, or back injuries are suspected","Keep the person warm with a blanket","Do not give anything to drink"],warning:"Shock can be life-threatening - professional medical help is crucial"},noseBleed:{steps:["Sit upright and lean slightly forward","Pinch the soft part of the nose just below the bony bridge","Breathe through the mouth and hold pressure for 10-15 minutes","Apply a cold compress to the bridge of the nose","Avoid lying down or tilting the head back"],warning:"Seek medical attention if bleeding is severe or doesn't stop after 30 minutes"},poisoning:{steps:["Call poison control or emergency services immediately","Do not induce vomiting unless instructed by a professional","If the person is unconscious, check for breathing and prepare to perform CPR","Collect information about the poison for medical professionals"],warning:"Poisoning can be extremely dangerous - always seek professional medical advice"},seizure:{steps:["Keep the person safe from further injury","Do not restrain the person","Remove any nearby objects that could cause harm","Place the person on their side if possible","Time the seizure if you can"],warning:"Call emergency services if the seizure lasts longer than 5 minutes or the person doesn't regain consciousness"},heartAttack:{steps:["Call emergency services immediately","Help the person sit in a comfortable position","Loosen any tight clothing","If the person is not allergic and emergency services agree, give one adult aspirin","Prepare to perform CPR if the person becomes unresponsive"],warning:"Every minute counts during a heart attack - immediate medical attention is critical"},stroke:{steps:["Remember FAST: Face drooping, Arm weakness, Speech difficulty, Time to call emergency services","Note the time symptoms started","Help the person sit or lie down","Do not give them anything to eat or drink","Monitor breathing and consciousness"],warning:"Stroke is a medical emergency - rapid response can minimize brain damage"},hypothermia:{steps:["Move the person to a warm area","Remove wet clothing","Warm the core of the body first (chest, neck, head)","Use warm blankets or body heat","Provide warm (not hot) beverages if the person is conscious"],warning:"Severe hypothermia is life-threatening - seek immediate medical attention"},heatStroke:{steps:["Call emergency services immediately","Move the person to a cool area","Remove excess clothing","Apply cool, wet cloths or ice packs to skin","Do not give liquids if the person is not fully conscious"],warning:"Heat stroke can cause permanent organ damage or death if not treated quickly"},snakeBite:{steps:["Keep the person calm and still","Remove any tight clothing or jewelry near the bite","Position the bite below the level of the heart","Clean the wound gently","Do not attempt to suck out venom or apply a tourniquet"],warning:"Identify the snake if possible without risking further injury - seek immediate medical help"},concussion:{steps:["Remove the person from activity","Check for signs of serious brain injury","Apply a cold compress to reduce swelling","Monitor for confusion, dizziness, or memory problems","Avoid sleep for the first few hours if possible"],warning:"Some concussion symptoms may not appear immediately - medical evaluation is crucial"},electricShock:{steps:["Ensure personal safety first - do not touch the person if they are still in contact with electrical source","Turn off power source if possible","Call emergency services","Check for breathing and pulse","Treat for burns and prepare to perform CPR if necessary"],warning:"Electrical injuries can cause internal damage not visible externally"},diabeticEmergency:{steps:["If the person is conscious and can swallow, give them sugary food or drink","If they are unconscious, do not try to give anything by mouth","Place the person on their side","Call emergency services","Monitor breathing and be prepared to perform CPR"],warning:"Diabetic emergencies can quickly become life-threatening"},waterRescue:{steps:["Do not enter the water unless you are trained in water rescue","Call emergency services","Try to reach the person with a long object","If possible, throw a flotation device","Keep visual contact with the person"],warning:"Drowning can occur quickly and silently - immediate professional help is critical"},severeAllergicReaction:{steps:["Identify and remove the allergen if possible","Help the person use their epinephrine auto-injector","Lay the person flat with legs elevated","Loosen tight clothing","Monitor breathing and be prepared to perform CPR"],warning:"Severe allergic reactions can rapidly lead to anaphylactic shock"}};function QCe(t){if(t=t.toLowerCase(),t.includes("emergency")||t.includes("dying")||t.includes("unconscious")||t.includes("not breathing"))return"🚨 EMERGENCY: Call emergency services immediately (911 or your local emergency number). This situation requires immediate professional medical attention.";const e=[{keywords:["bleeding","blood","cut"],topic:"bleeding"},{keywords:["burn","scalded","hot"],topic:"burn"},{keywords:["choking","can't breathe","heimlich"],topic:"choking"},{keywords:["fracture","broken","bone"],topic:"fracture"},{keywords:["heat","exhaustion","overheated"],topic:"heatExhaustion"},{keywords:["allergic","reaction","swelling","breathing"],topic:"anaphylaxis"},{keywords:["shock","pale","weak"],topic:"shock"},{keywords:["nosebleed","nose bleed"],topic:"noseBleed"},{keywords:["poison","ingested"],topic:"poisoning"},{keywords:["seizure","convulsing"],topic:"seizure"},{keywords:["heart attack","chest pain","heart pain"],topic:"heartAttack"},{keywords:["stroke","drooping","speech"],topic:"stroke"},{keywords:["cold","freezing","hypothermia"],topic:"hypothermia"},{keywords:["heat stroke","overheating"],topic:"heatStroke"},{keywords:["snake bite","snake"],topic:"snakeBite"},{keywords:["concussion","head injury"],topic:"concussion"},{keywords:["electric shock","electrocution"],topic:"electricShock"},{keywords:["diabetes","sugar","diabetic"],topic:"diabeticEmergency"},{keywords:["drowning","water rescue"],topic:"waterRescue"},{keywords:["severe allergy","anaphylaxis"],topic:"severeAllergicReaction"}];for(const n of e)if(n.keywords.some(s=>t.includes(s)))return JCe(YCe[n.topic]);return t.includes("help")||t.includes("hi")||t.includes("hello")?"Hello! I'm FirstAid.AI, your first aid assistant. I can provide guidance for common first aid situations. What kind of help do you need?":"I'm not sure about that specific situation. Please try to describe the emergency or injury more specifically, or in case of serious emergency, contact professional medical services immediately."}function JCe(t){let e=`Here's what you should do:

`;return t.steps.forEach((n,s)=>{e+=`${s+1}. ${n}
`}),e+=`
⚠️ IMPORTANT: ${t.warning}`,e}function eIe(){const[t,e]=ne.useState(""),[n,s]=ne.useState([]),[i,r]=ne.useState(!1),[o,a]=ne.useState(null),{sendMessage:l,subscribeToMessages:c}=ZCe(),{user:h}=j1(),d=ne.useRef(null);ne.useEffect(()=>{if(!h)return;console.log("👀 Subscribing to messages...");const m=c(g=>{s(g)});return()=>{console.log("👋 Unsubscribing from messages..."),m&&m()}},[h,c]),ne.useEffect(()=>{var m;(m=d.current)==null||m.scrollIntoView({behavior:"smooth"})},[n]);const f=async m=>{if(m.preventDefault(),!(!t.trim()||!h)){a(null),r(!0);try{await l({text:t.trim(),type:"user"});const g=QCe(t.trim());e(""),await new Promise(x=>setTimeout(x,1e3)),await l({text:g,type:"ai"})}catch(g){console.error("Error in chat:",g),a("Failed to send message. Please try again.")}finally{r(!1)}}};return h?A.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:A.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[A.jsxs("div",{className:"p-4 bg-red-500 text-white",children:[A.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[A.jsx(mw,{}),"FirstAid.AI Emergency Assistant"]}),A.jsx("p",{className:"text-sm mt-1 opacity-90",children:"For life-threatening emergencies, always call emergency services first!"})]}),A.jsxs("div",{className:"h-[60vh] overflow-y-auto p-4 space-y-4 bg-gray-50",children:[o&&A.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:o}),n.map(m=>A.jsx("div",{className:`flex ${m.type==="user"?"justify-end":"justify-start"}`,children:A.jsxs("div",{className:`max-w-[80%] rounded-lg p-4 ${m.type==="user"?"bg-blue-500 text-white":"bg-white shadow-md text-gray-800"}`,children:[A.jsx("div",{className:"text-sm opacity-75 mb-1",children:m.type==="user"?"You":"FirstAid.AI"}),A.jsx("div",{className:"whitespace-pre-line",children:m.text})]})},m.id)),i&&A.jsx("div",{className:"flex justify-start",children:A.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 max-w-[80%]",children:[A.jsx("div",{className:"text-sm opacity-75 mb-1",children:"FirstAid.AI"}),A.jsxs("div",{className:"flex gap-1",children:[A.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),A.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:0.2s]"}),A.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce [animation-delay:0.4s]"})]})]})}),A.jsx("div",{ref:d})]}),A.jsx("form",{onSubmit:f,className:"p-4 border-t bg-white",children:A.jsxs("div",{className:"flex gap-2",children:[A.jsx("input",{type:"text",value:t,onChange:m=>e(m.target.value),placeholder:"Describe the emergency or ask for first aid advice...",className:"flex-1 rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:i}),A.jsx("button",{type:"submit",disabled:i||!t.trim(),className:"bg-red-500 text-white rounded-lg px-4 py-2 hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:A.jsx(rH,{size:20})})]})})]})}):A.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-4rem)]",children:A.jsxs("div",{className:"text-center",children:[A.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Please Login"}),A.jsx("p",{className:"text-gray-600",children:"You need to be logged in to use the chat."})]})})}function tIe(){const[t,e]=ne.useState(""),[n,s]=ne.useState(""),[i,r]=ne.useState(!1),[o,a]=ne.useState(""),[l,c]=ne.useState(!1),h=ID(),{signIn:d,signUp:f}=j1(),m=async g=>{g.preventDefault(),a(""),c(!0);try{i?await f(t,n):await d(t,n),h("/")}catch(x){a(x.message)}finally{c(!1)}};return A.jsx("div",{className:"min-h-[calc(100vh-4rem)] flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:A.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-xl shadow-lg",children:[A.jsx("div",{children:A.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:i?"Create your account":"Sign in to your account"})}),o&&A.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:A.jsxs("div",{className:"flex",children:[A.jsx(_g,{className:"text-red-500 mr-2 flex-shrink-0"}),A.jsx("p",{className:"text-sm text-red-700",children:o})]})}),A.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[A.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),A.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:g=>e(g.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-red-500 focus:border-red-500 focus:z-10 sm:text-sm",placeholder:"Email address"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),A.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:n,onChange:g=>s(g.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-red-500 focus:border-red-500 focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),A.jsx("div",{children:A.jsxs("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-red-300",children:[l?A.jsx("span",{className:"absolute left-0 inset-y-0 flex items-center pl-3",children:A.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"})}):i?A.jsx(aH,{className:"absolute left-0 inset-y-0 flex items-center pl-3 h-5 w-5"}):A.jsx(JG,{className:"absolute left-0 inset-y-0 flex items-center pl-3 h-5 w-5"}),i?"Sign up":"Sign in"]})}),A.jsx("div",{className:"text-center",children:A.jsx("button",{type:"button",onClick:()=>r(!i),className:"text-sm text-red-600 hover:text-red-500",children:i?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})})}function nIe(){return A.jsx(XCe,{children:A.jsx(T8,{children:A.jsxs(awe,{children:[" ",A.jsx(jG,{children:A.jsxs("div",{className:"min-h-screen bg-gray-50",children:[A.jsx(E8,{}),A.jsxs(FG,{children:[A.jsx(Ba,{path:"/",element:A.jsx($8,{})}),A.jsx(Ba,{path:"/first-aid",element:A.jsx(R8,{})}),A.jsx(Ba,{path:"/injury-detection",element:A.jsx(cwe,{})}),A.jsx(Ba,{path:"/nearby-hospitals",element:A.jsx($we,{})}),A.jsx(Ba,{path:"/chat",element:A.jsx(eIe,{})}),A.jsx(Ba,{path:"/login",element:A.jsx(tIe,{})})]})]})})]})})})}mD(document.getElementById("root")).render(A.jsx(ne.StrictMode,{children:A.jsx(nIe,{})}));
